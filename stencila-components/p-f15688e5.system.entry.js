var __extends=this&&this.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]};return e(t,n)};return function(t,n){if(typeof n!=="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function o(e){try{s(r.next(e))}catch(t){a(t)}}function u(e){try{s(r["throw"](e))}catch(t){a(t)}}function s(e){e.done?n(e.value):i(e.value).then(o,u)}s((r=r.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(e){return function(t){return s([e,t])}}function s(o){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(a=o[0]&2?i["return"]:o[0]?i["throw"]||((a=i["return"])&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;if(i=0,a)o=[o[0]&2,a.value];switch(o[0]){case 0:case 1:a=o;break;case 4:n.label++;return{value:o[1],done:false};case 5:n.label++;i=o[1];o=[0];continue;case 7:o=n.ops.pop();n.trys.pop();continue;default:if(!(a=n.trys,a=a.length>0&&a[a.length-1])&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!a||o[1]>a[0]&&o[1]<a[3])){n.label=o[1];break}if(o[0]===6&&n.label<a[1]){n.label=a[1];a=o;break}if(a&&n.label<a[2]){n.label=a[2];n.ops.push(o);break}if(a[2])n.ops.pop();n.trys.pop();continue}o=t.call(e,n)}catch(u){o=[6,u];i=0}finally{r=a=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};var __rest=this&&this.__rest||function(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n};var __spreadArray=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};var __values=this&&this.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};System.register(["./p-c4c9d738.system.js","./p-216a0e8d.system.js","./p-1ba9f457.system.js"],(function(e){"use strict";var t,n,r,i,a,o,u,s,l,f;return{setters:[function(e){t=e.r;n=e.h;r=e.c;i=e.a;a=e.H},function(e){o=e.p;u=e.g;s=e.v;l=e.b},function(e){f=e.c}],execute:function(){var c,d,h,v,p,g,m,y,_,b;var x='[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default{border-collapse:collapse;display:block;font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.875rem;line-height:1.25rem;overflow:auto}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default td.sc-stencila-data-table-default,[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default th.sc-stencila-data-table-default{padding:.25rem .5rem}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default th.sc-stencila-data-table-default{font-weight:700}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default tbody.sc-stencila-data-table-default tr.sc-stencila-data-table-default:nth-child(2n),[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default th.sc-stencila-data-table-default{background-color:#e9eaf1;background-color:var(--color-neutral-50,#e9eaf1)}';var w='[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material{border-collapse:collapse;display:block;font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.875rem;line-height:1.25rem;overflow:auto}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material td.sc-stencila-data-table-material,[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material th.sc-stencila-data-table-material{padding:.25rem .5rem}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material th.sc-stencila-data-table-material{font-weight:700}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material tbody.sc-stencila-data-table-material tr.sc-stencila-data-table-material:nth-child(2n),[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material th.sc-stencila-data-table-material{background-color:#e9eaf1;background-color:var(--color-neutral-50,#e9eaf1)}';var k=e("stencila_data_table",function(){function e(e){t(this,e)}e.prototype.render=function(){var e;var t=this.table.columns;var r=(e=t===null||t===void 0?void 0:t[0].values.map((function(e,t){return t})))!==null&&e!==void 0?e:[];return n("table",{itemtype:"https://schema.stenci.la/Datatable"},n("thead",null,n("tr",null,t.map((function(e){return n("th",null,e.name)})))),n("tbody",null,r.map((function(e,r){return n("tr",null,t.map((function(e){return n("td",null,e.values[r])})))}))))};return e}());k.style={default:x,material:w};var A=".sc-stencila-image-object-default-h img.sc-stencila-image-object-default,stencila-image-object.sc-stencila-image-object-default img.sc-stencila-image-object-default{height:auto;max-width:100%}";var E=".sc-stencila-image-object-material-h img.sc-stencila-image-object-material,stencila-image-object.sc-stencila-image-object-material img.sc-stencila-image-object-material{height:auto;max-width:100%}";var D=e("stencila_image_object",function(){function e(e){t(this,e)}e.prototype.render=function(){return n("img",{alt:this.image.text,itemscope:true,itemtype:"http://schema.org/ImageObject",src:this.image.contentUrl})};return e}());D.style={default:A,material:E};var S=function(e){return document.querySelector('head script[src="'+e+'"]')!==null};var C=function(e){var t=e.src,n=e.onInit,r=e.onLoad;var i;if(S(t))return;var a=document.createElement("script");a.setAttribute("src",t);n===null||n===void 0?void 0:n();a.addEventListener("load",r);(i=document.querySelector("head"))===null||i===void 0?void 0:i.appendChild(a)};var M=function(e){var t=document.createElement("div");var n=e.querySelector("picture");var r=n!==null&&n!==void 0?n:e;r.appendChild(t);return t};var F=".sc-stencila-image-plotly-default-h{display:block}.sc-stencila-image-plotly-default-h.imgHidden.sc-stencila-image-plotly-default-s>picture>:not(.js-plotly-plot){display:none}";var O=".sc-stencila-image-plotly-material-h{display:block}.sc-stencila-image-plotly-material-h.imgHidden.sc-stencila-image-plotly-material-s>picture>:not(.js-plotly-plot){display:none}";var N="https://cdn.plot.ly/plotly-latest.min.js";var T;var z=e("stencila_image_plotly",function(){function e(e){var n=this;t(this,e);this.plotlyLoaded=r(this,"plotlyLoaded",7);this.plotIsRendered=false;this.renderPlot=function(){var e,t,r;var i=(e=n.getPlotContent())!==null&&e!==void 0?e:{},a=i.data,o=i.layout,u=o===void 0?n.layout:o,s=i.config,l=s===void 0?n.config:s;if(!a)return;n.plotContainer=(t=n.plotContainer)!==null&&t!==void 0?t:M(n.el);(r=window.Plotly)===null||r===void 0?void 0:r.react(n.plotContainer,a,u,l).then((function(){if(!n.plotIsRendered){n.plotIsRendered=true}})).catch((function(e){console.error("Failed to render plot",e)}))};this.getPlotContent=function(){if(n.data){return{data:n.data,layout:n.layout,config:n.config}}var e=n.el.querySelector('[type="'+o+'"]');if(e){try{var t=e.textContent;var r=JSON.parse(t!==null&&t!==void 0?t:"");return Array.isArray(r)?{data:r}:r}catch(i){console.error("Could not parse plot data")}}return undefined}}e.prototype.onPlotlyLoaded=function(){if(!this.plotIsRendered){this.renderPlot()}};e.prototype.componentWillLoad=function(){var e=this;if(!this.plotIsRendered&&T){this.renderPlot()}else{C({src:N,onLoad:function(){T=true;e.plotlyLoaded.emit()}})}};e.prototype.componentShouldUpdate=function(e,t,n){if(n==="plotIsRendered"&&t===e){return false}return true};e.prototype.componentWillUpdate=function(){this.renderPlot()};e.prototype.render=function(){return n(a,{class:{imgHidden:this.plotIsRendered}})};Object.defineProperty(e.prototype,"el",{get:function(){return i(this)},enumerable:false,configurable:true});return e}());z.style={default:F,material:O};
/*!
       * https://github.com/Starcounter-Jack/JSON-Patch
       * (c) 2017 Joachim Wester
       * MIT license
       */var R=undefined&&undefined.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();var P=Object.prototype.hasOwnProperty;function L(e,t){return P.call(e,t)}function j(e){if(Array.isArray(e)){var t=new Array(e.length);for(var n=0;n<t.length;n++){t[n]=""+n}return t}if(Object.keys){return Object.keys(e)}var t=[];for(var r in e){if(L(e,r)){t.push(r)}}return t}function B(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function I(e){var t=0;var n=e.length;var r;while(t<n){r=e.charCodeAt(t);if(r>=48&&r<=57){t++;continue}return false}return true}function U(e){if(e.indexOf("/")===-1&&e.indexOf("~")===-1)return e;return e.replace(/~/g,"~0").replace(/\//g,"~1")}function q(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function W(e){if(e===undefined){return true}if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++){if(W(e[t])){return true}}}else if(typeof e==="object"){var r=j(e);var i=r.length;for(var t=0;t<i;t++){if(W(e[r[t]])){return true}}}}return false}function H(e,t){var n=[e];for(var r in t){var i=typeof t[r]==="object"?JSON.stringify(t[r],null,2):t[r];if(typeof i!=="undefined"){n.push(r+": "+i)}}return n.join("\n")}var G=function(e){R(t,e);function t(t,n,r,i,a){var o=this.constructor;var u=e.call(this,H(t,{name:n,index:r,operation:i,tree:a}))||this;u.name=n;u.index=r;u.operation=i;u.tree=a;Object.setPrototypeOf(u,o.prototype);u.message=H(t,{name:n,index:r,operation:i,tree:a});return u}return t}(Error);var $=G;var V=B;var Y={add:function(e,t,n){e[t]=this.value;return{newDocument:n}},remove:function(e,t,n){var r=e[t];delete e[t];return{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];e[t]=this.value;return{newDocument:n,removed:r}},move:function(e,t,n){var r=J(n,this.path);if(r){r=B(r)}var i=Q(n,{op:"remove",path:this.from}).removed;Q(n,{op:"add",path:this.path,value:i});return{newDocument:n,removed:r}},copy:function(e,t,n){var r=J(n,this.from);Q(n,{op:"add",path:this.path,value:B(r)});return{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:ne(e[t],this.value)}},_get:function(e,t,n){this.value=e[t];return{newDocument:n}}};var X={add:function(e,t,n){if(I(t)){e.splice(t,0,this.value)}else{e[t]=this.value}return{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];e[t]=this.value;return{newDocument:n,removed:r}},move:Y.move,copy:Y.copy,test:Y.test,_get:Y._get};function J(e,t){if(t==""){return e}var n={op:"_get",path:t};Q(e,n);return n.value}function Q(e,t,n,r,i,a){if(n===void 0){n=false}if(r===void 0){r=true}if(i===void 0){i=true}if(a===void 0){a=0}if(n){if(typeof n=="function"){n(t,0,e,t.path)}else{ee(t,0)}}if(t.path===""){var o={newDocument:e};if(t.op==="add"){o.newDocument=t.value;return o}else if(t.op==="replace"){o.newDocument=t.value;o.removed=e;return o}else if(t.op==="move"||t.op==="copy"){o.newDocument=J(e,t.from);if(t.op==="move"){o.removed=e}return o}else if(t.op==="test"){o.test=ne(e,t.value);if(o.test===false){throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e)}o.newDocument=e;return o}else if(t.op==="remove"){o.removed=e;o.newDocument=null;return o}else if(t.op==="_get"){t.value=e;return o}else{if(n){throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e)}else{return o}}}else{if(!r){e=B(e)}var u=t.path||"";var s=u.split("/");var l=e;var f=1;var c=s.length;var d=undefined;var h=void 0;var v=void 0;if(typeof n=="function"){v=n}else{v=ee}while(true){h=s[f];if(i&&h=="__proto__"){throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README")}if(n){if(d===undefined){if(l[h]===undefined){d=s.slice(0,f).join("/")}else if(f==c-1){d=t.path}if(d!==undefined){v(t,0,e,d)}}}f++;if(Array.isArray(l)){if(h==="-"){h=l.length}else{if(n&&!I(h)){throw new $("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e)}else if(I(h)){h=~~h}}if(f>=c){if(n&&t.op==="add"&&h>l.length){throw new $("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e)}var o=X[t.op].call(t,l,h,e);if(o.test===false){throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e)}return o}}else{if(h&&h.indexOf("~")!=-1){h=q(h)}if(f>=c){var o=Y[t.op].call(t,l,h,e);if(o.test===false){throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e)}return o}}l=l[h]}}}function Z(e,t,n,r,i){if(r===void 0){r=true}if(i===void 0){i=true}if(n){if(!Array.isArray(t)){throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY")}}if(!r){e=B(e)}var a=new Array(t.length);for(var o=0,u=t.length;o<u;o++){a[o]=Q(e,t[o],n,true,i,o);e=a[o].newDocument}a.newDocument=e;return a}function K(e,t,n){var r=Q(e,t);if(r.test===false){throw new $("Test operation failed","TEST_OPERATION_FAILED",n,t,e)}return r.newDocument}function ee(e,t,n,r){if(typeof e!=="object"||e===null||Array.isArray(e)){throw new $("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n)}else if(!Y[e.op]){throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}else if(typeof e.path!=="string"){throw new $("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n)}else if(e.path.indexOf("/")!==0&&e.path.length>0){throw new $('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n)}else if((e.op==="move"||e.op==="copy")&&typeof e.from!=="string"){throw new $("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n)}else if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===undefined){throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n)}else if((e.op==="add"||e.op==="replace"||e.op==="test")&&W(e.value)){throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n)}else if(n){if(e.op=="add"){var i=e.path.split("/").length;var a=r.split("/").length;if(i!==a+1&&i!==a){throw new $("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r){throw new $("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:undefined};var u=te([o],n);if(u&&u.name==="OPERATION_PATH_UNRESOLVABLE"){throw new $("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}}function te(e,t,n){try{if(!Array.isArray(e)){throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY")}if(t){Z(B(t),B(e),n||true)}else{n=n||ee;for(var r=0;r<e.length;r++){n(e[r],r,t,undefined)}}}catch(Afe){if(Afe instanceof $){return Afe}else{throw Afe}}}function ne(e,t){if(e===t)return true;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,a,o;if(n&&r){a=e.length;if(a!=t.length)return false;for(i=a;i--!==0;)if(!ne(e[i],t[i]))return false;return true}if(n!=r)return false;var u=Object.keys(e);a=u.length;if(a!==Object.keys(t).length)return false;for(i=a;i--!==0;)if(!t.hasOwnProperty(u[i]))return false;for(i=a;i--!==0;){o=u[i];if(!ne(e[o],t[o]))return false}return true}return e!==e&&t!==t}var re=Object.freeze({__proto__:null,JsonPatchError:$,deepClone:V,getValueByPointer:J,applyOperation:Q,applyPatch:Z,applyReducer:K,validator:ee,validate:te,_areEquals:ne});
/*!
       * https://github.com/Starcounter-Jack/JSON-Patch
       * (c) 2017 Joachim Wester
       * MIT license
       */var ie=new WeakMap;var ae=function(){function e(e){this.observers=new Map;this.obj=e}return e}();var oe=function(){function e(e,t){this.callback=e;this.observer=t}return e}();function ue(e){return ie.get(e)}function se(e,t){return e.observers.get(t)}function le(e,t){e.observers.delete(t.callback)}function fe(e,t){t.unobserve()}function ce(e,t){var n=[];var r;var i=ue(e);if(!i){i=new ae(e);ie.set(e,i)}else{var a=se(i,t);r=a&&a.observer}if(r){return r}r={};i.value=B(e);if(t){r.callback=t;r.next=null;var o=function(){de(r)};var u=function(){clearTimeout(r.next);r.next=setTimeout(o)};if(typeof window!=="undefined"){window.addEventListener("mouseup",u);window.addEventListener("keyup",u);window.addEventListener("mousedown",u);window.addEventListener("keydown",u);window.addEventListener("change",u)}}r.patches=n;r.object=e;r.unobserve=function(){de(r);clearTimeout(r.next);le(i,r);if(typeof window!=="undefined"){window.removeEventListener("mouseup",u);window.removeEventListener("keyup",u);window.removeEventListener("mousedown",u);window.removeEventListener("keydown",u);window.removeEventListener("change",u)}};i.observers.set(t,new oe(t,r));return r}function de(e,t){if(t===void 0){t=false}var n=ie.get(e.object);he(n.value,e.object,e.patches,"",t);if(e.patches.length){Z(n.value,e.patches)}var r=e.patches;if(r.length>0){e.patches=[];if(e.callback){e.callback(r)}}return r}function he(e,t,n,r,i){if(t===e){return}if(typeof t.toJSON==="function"){t=t.toJSON()}var a=j(t);var o=j(e);var u=false;for(var s=o.length-1;s>=0;s--){var l=o[s];var f=e[l];if(L(t,l)&&!(t[l]===undefined&&f!==undefined&&Array.isArray(t)===false)){var c=t[l];if(typeof f=="object"&&f!=null&&typeof c=="object"&&c!=null){he(f,c,n,r+"/"+U(l),i)}else{if(f!==c){if(i){n.push({op:"test",path:r+"/"+U(l),value:B(f)})}n.push({op:"replace",path:r+"/"+U(l),value:B(c)})}}}else if(Array.isArray(e)===Array.isArray(t)){if(i){n.push({op:"test",path:r+"/"+U(l),value:B(f)})}n.push({op:"remove",path:r+"/"+U(l)});u=true}else{if(i){n.push({op:"test",path:r,value:e})}n.push({op:"replace",path:r,value:t})}}if(!u&&a.length==o.length){return}for(var s=0;s<a.length;s++){var l=a[s];if(!L(e,l)&&t[l]!==undefined){n.push({op:"add",path:r+"/"+U(l),value:B(t[l])})}}}function ve(e,t,n){if(n===void 0){n=false}var r=[];he(e,t,r,"",n);return r}var pe=Object.freeze({__proto__:null,unobserve:fe,observe:ce,generate:de,compare:ve});Object.assign({},re,pe,{JsonPatchError:G,deepClone:B,escapePathComponent:U,unescapePathComponent:q});var ge=/("(?:[^\\"]|\\.)*")|[:,]/g;var me=function e(t,n){var r,i,a;n=n||{};r=JSON.stringify([1],undefined,n.indent===undefined?2:n.indent).slice(2,-3);i=r===""?Infinity:n.maxLength===undefined?80:n.maxLength;a=n.replacer;return function e(t,n,o){var u,s,l,f,c,d,h,v,p,g,m,y;if(t&&typeof t.toJSON==="function"){t=t.toJSON()}m=JSON.stringify(t,a);if(m===undefined){return m}h=i-n.length-o;if(m.length<=h){p=m.replace(ge,(function(e,t){return t||e+" "}));if(p.length<=h){return p}}if(a!=null){t=JSON.parse(m);a=undefined}if(typeof t==="object"&&t!==null){v=n+r;l=[];s=0;if(Array.isArray(t)){g="[";u="]";h=t.length;for(;s<h;s++){l.push(e(t[s],v,s===h-1?0:1)||"null")}}else{g="{";u="}";d=Object.keys(t);h=d.length;for(;s<h;s++){f=d[s];c=JSON.stringify(f)+": ";y=e(t[f],v,c.length+(s===h-1?0:1));if(y!==undefined){l.push(c+y)}}}if(l.length>0){return[g,r+l.join(",\n"+v),u].join("\n"+n)}}return m}(t,"",0)};var ye="2.0.0";var _e=256;var be=Number.MAX_SAFE_INTEGER||9007199254740991;var xe=16;var we={SEMVER_SPEC_VERSION:ye,MAX_LENGTH:_e,MAX_SAFE_INTEGER:be,MAX_SAFE_COMPONENT_LENGTH:xe};var ke=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return console.error.apply(console,__spreadArray(["SEMVER"],e))}:function(){};var Ae=ke;var Ee=f((function(e,t){var n=we.MAX_SAFE_COMPONENT_LENGTH;t=e.exports={};var r=t.re=[];var i=t.src=[];var a=t.t={};var o=0;var u=function(e,t,n){var u=o++;Ae(u,t);a[e]=u;i[u]=t;r[u]=new RegExp(t,n?"g":undefined)};u("NUMERICIDENTIFIER","0|[1-9]\\d*");u("NUMERICIDENTIFIERLOOSE","[0-9]+");u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");u("MAINVERSION","("+i[a.NUMERICIDENTIFIER]+")\\."+("("+i[a.NUMERICIDENTIFIER]+")\\.")+("("+i[a.NUMERICIDENTIFIER]+")"));u("MAINVERSIONLOOSE","("+i[a.NUMERICIDENTIFIERLOOSE]+")\\."+("("+i[a.NUMERICIDENTIFIERLOOSE]+")\\.")+("("+i[a.NUMERICIDENTIFIERLOOSE]+")"));u("PRERELEASEIDENTIFIER","(?:"+i[a.NUMERICIDENTIFIER]+"|"+i[a.NONNUMERICIDENTIFIER]+")");u("PRERELEASEIDENTIFIERLOOSE","(?:"+i[a.NUMERICIDENTIFIERLOOSE]+"|"+i[a.NONNUMERICIDENTIFIER]+")");u("PRERELEASE","(?:-("+i[a.PRERELEASEIDENTIFIER]+"(?:\\."+i[a.PRERELEASEIDENTIFIER]+")*))");u("PRERELEASELOOSE","(?:-?("+i[a.PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+i[a.PRERELEASEIDENTIFIERLOOSE]+")*))");u("BUILDIDENTIFIER","[0-9A-Za-z-]+");u("BUILD","(?:\\+("+i[a.BUILDIDENTIFIER]+"(?:\\."+i[a.BUILDIDENTIFIER]+")*))");u("FULLPLAIN","v?"+i[a.MAINVERSION]+i[a.PRERELEASE]+"?"+i[a.BUILD]+"?");u("FULL","^"+i[a.FULLPLAIN]+"$");u("LOOSEPLAIN","[v=\\s]*"+i[a.MAINVERSIONLOOSE]+i[a.PRERELEASELOOSE]+"?"+i[a.BUILD]+"?");u("LOOSE","^"+i[a.LOOSEPLAIN]+"$");u("GTLT","((?:<|>)?=?)");u("XRANGEIDENTIFIERLOOSE",i[a.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*");u("XRANGEIDENTIFIER",i[a.NUMERICIDENTIFIER]+"|x|X|\\*");u("XRANGEPLAIN","[v=\\s]*("+i[a.XRANGEIDENTIFIER]+")"+("(?:\\.("+i[a.XRANGEIDENTIFIER]+")")+("(?:\\.("+i[a.XRANGEIDENTIFIER]+")")+("(?:"+i[a.PRERELEASE]+")?"+i[a.BUILD]+"?")+")?)?");u("XRANGEPLAINLOOSE","[v=\\s]*("+i[a.XRANGEIDENTIFIERLOOSE]+")"+("(?:\\.("+i[a.XRANGEIDENTIFIERLOOSE]+")")+("(?:\\.("+i[a.XRANGEIDENTIFIERLOOSE]+")")+("(?:"+i[a.PRERELEASELOOSE]+")?"+i[a.BUILD]+"?")+")?)?");u("XRANGE","^"+i[a.GTLT]+"\\s*"+i[a.XRANGEPLAIN]+"$");u("XRANGELOOSE","^"+i[a.GTLT]+"\\s*"+i[a.XRANGEPLAINLOOSE]+"$");u("COERCE",""+"(^|[^\\d])"+"(\\d{1,"+n+"})"+("(?:\\.(\\d{1,"+n+"}))?")+("(?:\\.(\\d{1,"+n+"}))?")+"(?:$|[^\\d])");u("COERCERTL",i[a.COERCE],true);u("LONETILDE","(?:~>?)");u("TILDETRIM","(\\s*)"+i[a.LONETILDE]+"\\s+",true);t.tildeTrimReplace="$1~";u("TILDE","^"+i[a.LONETILDE]+i[a.XRANGEPLAIN]+"$");u("TILDELOOSE","^"+i[a.LONETILDE]+i[a.XRANGEPLAINLOOSE]+"$");u("LONECARET","(?:\\^)");u("CARETTRIM","(\\s*)"+i[a.LONECARET]+"\\s+",true);t.caretTrimReplace="$1^";u("CARET","^"+i[a.LONECARET]+i[a.XRANGEPLAIN]+"$");u("CARETLOOSE","^"+i[a.LONECARET]+i[a.XRANGEPLAINLOOSE]+"$");u("COMPARATORLOOSE","^"+i[a.GTLT]+"\\s*("+i[a.LOOSEPLAIN]+")$|^$");u("COMPARATOR","^"+i[a.GTLT]+"\\s*("+i[a.FULLPLAIN]+")$|^$");u("COMPARATORTRIM","(\\s*)"+i[a.GTLT]+"\\s*("+i[a.LOOSEPLAIN]+"|"+i[a.XRANGEPLAIN]+")",true);t.comparatorTrimReplace="$1$2$3";u("HYPHENRANGE","^\\s*("+i[a.XRANGEPLAIN]+")"+"\\s+-\\s+"+("("+i[a.XRANGEPLAIN]+")")+"\\s*$");u("HYPHENRANGELOOSE","^\\s*("+i[a.XRANGEPLAINLOOSE]+")"+"\\s+-\\s+"+("("+i[a.XRANGEPLAINLOOSE]+")")+"\\s*$");u("STAR","(<|>)?=?\\s*\\*");u("GTE0","^\\s*>=\\s*0.0.0\\s*$");u("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}));var De=["includePrerelease","loose","rtl"];var Se=function(e){return!e?{}:typeof e!=="object"?{loose:true}:De.filter((function(t){return e[t]})).reduce((function(e,t){e[t]=true;return e}),{})};var Ce=Se;var Me=/^[0-9]+$/;var Fe=function(e,t){var n=Me.test(e);var r=Me.test(t);if(n&&r){e=+e;t=+t}return e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var Oe=function(e,t){return Fe(t,e)};var Ne={compareIdentifiers:Fe,rcompareIdentifiers:Oe};var Te=we.MAX_LENGTH,ze=we.MAX_SAFE_INTEGER;var Re=Ee.re,Pe=Ee.t;var Le=Ne.compareIdentifiers;var je=function(){function e(t,n){n=Ce(n);if(t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease){return t}else{t=t.version}}else if(typeof t!=="string"){throw new TypeError("Invalid Version: "+t)}if(t.length>Te){throw new TypeError("version is longer than "+Te+" characters")}Ae("SemVer",t,n);this.options=n;this.loose=!!n.loose;this.includePrerelease=!!n.includePrerelease;var r=t.trim().match(n.loose?Re[Pe.LOOSE]:Re[Pe.FULL]);if(!r){throw new TypeError("Invalid Version: "+t)}this.raw=t;this.major=+r[1];this.minor=+r[2];this.patch=+r[3];if(this.major>ze||this.major<0){throw new TypeError("Invalid major version")}if(this.minor>ze||this.minor<0){throw new TypeError("Invalid minor version")}if(this.patch>ze||this.patch<0){throw new TypeError("Invalid patch version")}if(!r[4]){this.prerelease=[]}else{this.prerelease=r[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<ze){return t}}return e}))}this.build=r[5]?r[5].split("."):[];this.format()}e.prototype.format=function(){this.version=this.major+"."+this.minor+"."+this.patch;if(this.prerelease.length){this.version+="-"+this.prerelease.join(".")}return this.version};e.prototype.toString=function(){return this.version};e.prototype.compare=function(t){Ae("SemVer.compare",this.version,this.options,t);if(!(t instanceof e)){if(typeof t==="string"&&t===this.version){return 0}t=new e(t,this.options)}if(t.version===this.version){return 0}return this.compareMain(t)||this.comparePre(t)};e.prototype.compareMain=function(t){if(!(t instanceof e)){t=new e(t,this.options)}return Le(this.major,t.major)||Le(this.minor,t.minor)||Le(this.patch,t.patch)};e.prototype.comparePre=function(t){if(!(t instanceof e)){t=new e(t,this.options)}if(this.prerelease.length&&!t.prerelease.length){return-1}else if(!this.prerelease.length&&t.prerelease.length){return 1}else if(!this.prerelease.length&&!t.prerelease.length){return 0}var n=0;do{var r=this.prerelease[n];var i=t.prerelease[n];Ae("prerelease compare",n,r,i);if(r===undefined&&i===undefined){return 0}else if(i===undefined){return 1}else if(r===undefined){return-1}else if(r===i){continue}else{return Le(r,i)}}while(++n)};e.prototype.compareBuild=function(t){if(!(t instanceof e)){t=new e(t,this.options)}var n=0;do{var r=this.build[n];var i=t.build[n];Ae("prerelease compare",n,r,i);if(r===undefined&&i===undefined){return 0}else if(i===undefined){return 1}else if(r===undefined){return-1}else if(r===i){continue}else{return Le(r,i)}}while(++n)};e.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc("pre",t);break;case"preminor":this.prerelease.length=0;this.patch=0;this.minor++;this.inc("pre",t);break;case"prepatch":this.prerelease.length=0;this.inc("patch",t);this.inc("pre",t);break;case"prerelease":if(this.prerelease.length===0){this.inc("patch",t)}this.inc("pre",t);break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0){this.major++}this.minor=0;this.patch=0;this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0){this.minor++}this.patch=0;this.prerelease=[];break;case"patch":if(this.prerelease.length===0){this.patch++}this.prerelease=[];break;case"pre":if(this.prerelease.length===0){this.prerelease=[0]}else{var n=this.prerelease.length;while(--n>=0){if(typeof this.prerelease[n]==="number"){this.prerelease[n]++;n=-2}}if(n===-1){this.prerelease.push(0)}}if(t){if(this.prerelease[0]===t){if(isNaN(this.prerelease[1])){this.prerelease=[t,0]}}else{this.prerelease=[t,0]}}break;default:throw new Error("invalid increment argument: "+e)}this.format();this.raw=this.version;return this};return e}();var Be=je;var Ie=we.MAX_LENGTH;var Ue=Ee.re,qe=Ee.t;var We=function(e,t){t=Ce(t);if(e instanceof Be){return e}if(typeof e!=="string"){return null}if(e.length>Ie){return null}var n=t.loose?Ue[qe.LOOSE]:Ue[qe.FULL];if(!n.test(e)){return null}try{return new Be(e,t)}catch(r){return null}};var He=We;var Ge=function(e,t){var n=He(e,t);return n?n.version:null};var $e=Ge;var Ve=function(e,t){var n=He(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var Ye=Ve;var Xe=function(e,t,n,r){if(typeof n==="string"){r=n;n=undefined}try{return new Be(e,n).inc(t,r).version}catch(i){return null}};var Je=Xe;var Qe=function(e,t,n){return new Be(e,n).compare(new Be(t,n))};var Ze=Qe;var Ke=function(e,t,n){return Ze(e,t,n)===0};var et=Ke;var tt=function(e,t){if(et(e,t)){return null}else{var n=He(e);var r=He(t);var i=n.prerelease.length||r.prerelease.length;var a=i?"pre":"";var o=i?"prerelease":"";for(var u in n){if(u==="major"||u==="minor"||u==="patch"){if(n[u]!==r[u]){return a+u}}}return o}};var nt=tt;var rt=function(e,t){return new Be(e,t).major};var it=rt;var at=function(e,t){return new Be(e,t).minor};var ot=at;var ut=function(e,t){return new Be(e,t).patch};var st=ut;var lt=function(e,t){var n=He(e,t);return n&&n.prerelease.length?n.prerelease:null};var ft=lt;var ct=function(e,t,n){return Ze(t,e,n)};var dt=ct;var ht=function(e,t){return Ze(e,t,true)};var vt=ht;var pt=function(e,t,n){var r=new Be(e,n);var i=new Be(t,n);return r.compare(i)||r.compareBuild(i)};var gt=pt;var mt=function(e,t){return e.sort((function(e,n){return gt(e,n,t)}))};var yt=mt;var _t=function(e,t){return e.sort((function(e,n){return gt(n,e,t)}))};var bt=_t;var xt=function(e,t,n){return Ze(e,t,n)>0};var wt=xt;var kt=function(e,t,n){return Ze(e,t,n)<0};var At=kt;var Et=function(e,t,n){return Ze(e,t,n)!==0};var Dt=Et;var St=function(e,t,n){return Ze(e,t,n)>=0};var Ct=St;var Mt=function(e,t,n){return Ze(e,t,n)<=0};var Ft=Mt;var Ot=function(e,t,n,r){switch(t){case"===":if(typeof e==="object")e=e.version;if(typeof n==="object")n=n.version;return e===n;case"!==":if(typeof e==="object")e=e.version;if(typeof n==="object")n=n.version;return e!==n;case"":case"=":case"==":return et(e,n,r);case"!=":return Dt(e,n,r);case">":return wt(e,n,r);case">=":return Ct(e,n,r);case"<":return At(e,n,r);case"<=":return Ft(e,n,r);default:throw new TypeError("Invalid operator: "+t)}};var Nt=Ot;var Tt=Ee.re,zt=Ee.t;var Rt=function(e,t){if(e instanceof Be){return e}if(typeof e==="number"){e=String(e)}if(typeof e!=="string"){return null}t=t||{};var n=null;if(!t.rtl){n=e.match(Tt[zt.COERCE])}else{var r=void 0;while((r=Tt[zt.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length)){if(!n||r.index+r[0].length!==n.index+n[0].length){n=r}Tt[zt.COERCERTL].lastIndex=r.index+r[1].length+r[2].length}Tt[zt.COERCERTL].lastIndex=-1}if(n===null)return null;return He(n[2]+"."+(n[3]||"0")+"."+(n[4]||"0"),t)};var Pt=Rt;var Lt=function(e){e.prototype[Symbol.iterator]=function(){var e;return __generator(this,(function(t){switch(t.label){case 0:e=this.head;t.label=1;case 1:if(!e)return[3,4];return[4,e.value];case 2:t.sent();t.label=3;case 3:e=e.next;return[3,1];case 4:return[2]}}))}};var jt=Bt;Bt.Node=Wt;Bt.create=Bt;function Bt(e){var t=this;if(!(t instanceof Bt)){t=new Bt}t.tail=null;t.head=null;t.length=0;if(e&&typeof e.forEach==="function"){e.forEach((function(e){t.push(e)}))}else if(arguments.length>0){for(var n=0,r=arguments.length;n<r;n++){t.push(arguments[n])}}return t}Bt.prototype.removeNode=function(e){if(e.list!==this){throw new Error("removing node which does not belong to this list")}var t=e.next;var n=e.prev;if(t){t.prev=n}if(n){n.next=t}if(e===this.head){this.head=t}if(e===this.tail){this.tail=n}e.list.length--;e.next=null;e.prev=null;e.list=null;return t};Bt.prototype.unshiftNode=function(e){if(e===this.head){return}if(e.list){e.list.removeNode(e)}var t=this.head;e.list=this;e.next=t;if(t){t.prev=e}this.head=e;if(!this.tail){this.tail=e}this.length++};Bt.prototype.pushNode=function(e){if(e===this.tail){return}if(e.list){e.list.removeNode(e)}var t=this.tail;e.list=this;e.prev=t;if(t){t.next=e}this.tail=e;if(!this.head){this.head=e}this.length++};Bt.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++){Ut(this,arguments[e])}return this.length};Bt.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++){qt(this,arguments[e])}return this.length};Bt.prototype.pop=function(){if(!this.tail){return undefined}var e=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null}else{this.head=null}this.length--;return e};Bt.prototype.shift=function(){if(!this.head){return undefined}var e=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null}else{this.tail=null}this.length--;return e};Bt.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;n!==null;r++){e.call(t,n.value,r,this);n=n.next}};Bt.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;n!==null;r--){e.call(t,n.value,r,this);n=n.prev}};Bt.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++){n=n.next}if(t===e&&n!==null){return n.value}};Bt.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++){n=n.prev}if(t===e&&n!==null){return n.value}};Bt.prototype.map=function(e,t){t=t||this;var n=new Bt;for(var r=this.head;r!==null;){n.push(e.call(t,r.value,this));r=r.next}return n};Bt.prototype.mapReverse=function(e,t){t=t||this;var n=new Bt;for(var r=this.tail;r!==null;){n.push(e.call(t,r.value,this));r=r.prev}return n};Bt.prototype.reduce=function(e,t){var n;var r=this.head;if(arguments.length>1){n=t}else if(this.head){r=this.head.next;n=this.head.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=0;r!==null;i++){n=e(n,r.value,i);r=r.next}return n};Bt.prototype.reduceReverse=function(e,t){var n;var r=this.tail;if(arguments.length>1){n=t}else if(this.tail){r=this.tail.prev;n=this.tail.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=this.length-1;r!==null;i--){n=e(n,r.value,i);r=r.prev}return n};Bt.prototype.toArray=function(){var e=new Array(this.length);for(var t=0,n=this.head;n!==null;t++){e[t]=n.value;n=n.next}return e};Bt.prototype.toArrayReverse=function(){var e=new Array(this.length);for(var t=0,n=this.tail;n!==null;t++){e[t]=n.value;n=n.prev}return e};Bt.prototype.slice=function(e,t){t=t||this.length;if(t<0){t+=this.length}e=e||0;if(e<0){e+=this.length}var n=new Bt;if(t<e||t<0){return n}if(e<0){e=0}if(t>this.length){t=this.length}for(var r=0,i=this.head;i!==null&&r<e;r++){i=i.next}for(;i!==null&&r<t;r++,i=i.next){n.push(i.value)}return n};Bt.prototype.sliceReverse=function(e,t){t=t||this.length;if(t<0){t+=this.length}e=e||0;if(e<0){e+=this.length}var n=new Bt;if(t<e||t<0){return n}if(e<0){e=0}if(t>this.length){t=this.length}for(var r=this.length,i=this.tail;i!==null&&r>t;r--){i=i.prev}for(;i!==null&&r>e;r--,i=i.prev){n.push(i.value)}return n};Bt.prototype.splice=function(e,t){var n=[];for(var r=2;r<arguments.length;r++){n[r-2]=arguments[r]}if(e>this.length){e=this.length-1}if(e<0){e=this.length+e}for(var i=0,a=this.head;a!==null&&i<e;i++){a=a.next}var o=[];for(var i=0;a&&i<t;i++){o.push(a.value);a=this.removeNode(a)}if(a===null){a=this.tail}if(a!==this.head&&a!==this.tail){a=a.prev}for(var i=0;i<n.length;i++){a=It(this,a,n[i])}return o};Bt.prototype.reverse=function(){var e=this.head;var t=this.tail;for(var n=e;n!==null;n=n.prev){var r=n.prev;n.prev=n.next;n.next=r}this.head=t;this.tail=e;return this};function It(e,t,n){var r=t===e.head?new Wt(n,null,t,e):new Wt(n,t,t.next,e);if(r.next===null){e.tail=r}if(r.prev===null){e.head=r}e.length++;return r}function Ut(e,t){e.tail=new Wt(t,e.tail,null,e);if(!e.head){e.head=e.tail}e.length++}function qt(e,t){e.head=new Wt(t,null,e.head,e);if(!e.tail){e.tail=e.head}e.length++}function Wt(e,t,n,r){if(!(this instanceof Wt)){return new Wt(e,t,n,r)}this.list=r;this.value=e;if(t){t.next=this;this.prev=t}else{this.prev=null}if(n){n.prev=this;this.next=n}else{this.next=null}}try{Lt(Bt)}catch(che){}var Ht=Symbol("max");var Gt=Symbol("length");var $t=Symbol("lengthCalculator");var Vt=Symbol("allowStale");var Yt=Symbol("maxAge");var Xt=Symbol("dispose");var Jt=Symbol("noDisposeOnSet");var Qt=Symbol("lruList");var Zt=Symbol("cache");var Kt=Symbol("updateAgeOnGet");var en=function(){return 1};var tn=function(){function e(e){if(typeof e==="number")e={max:e};if(!e)e={};if(e.max&&(typeof e.max!=="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[Ht]=e.max||Infinity;var t=e.length||en;this[$t]=typeof t!=="function"?en:t;this[Vt]=e.stale||false;if(e.maxAge&&typeof e.maxAge!=="number")throw new TypeError("maxAge must be a number");this[Yt]=e.maxAge||0;this[Xt]=e.dispose;this[Jt]=e.noDisposeOnSet||false;this[Kt]=e.updateAgeOnGet||false;this.reset()}Object.defineProperty(e.prototype,"max",{get:function(){return this[Ht]},set:function(e){if(typeof e!=="number"||e<0)throw new TypeError("max must be a non-negative number");this[Ht]=e||Infinity;an(this)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"allowStale",{get:function(){return this[Vt]},set:function(e){this[Vt]=!!e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"maxAge",{get:function(){return this[Yt]},set:function(e){if(typeof e!=="number")throw new TypeError("maxAge must be a non-negative number");this[Yt]=e;an(this)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lengthCalculator",{get:function(){return this[$t]},set:function(e){var t=this;if(typeof e!=="function")e=en;if(e!==this[$t]){this[$t]=e;this[Gt]=0;this[Qt].forEach((function(e){e.length=t[$t](e.value,e.key);t[Gt]+=e.length}))}an(this)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"length",{get:function(){return this[Gt]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"itemCount",{get:function(){return this[Qt].length},enumerable:false,configurable:true});e.prototype.rforEach=function(e,t){t=t||this;for(var n=this[Qt].tail;n!==null;){var r=n.prev;sn(this,e,n,t);n=r}};e.prototype.forEach=function(e,t){t=t||this;for(var n=this[Qt].head;n!==null;){var r=n.next;sn(this,e,n,t);n=r}};e.prototype.keys=function(){return this[Qt].toArray().map((function(e){return e.key}))};e.prototype.values=function(){return this[Qt].toArray().map((function(e){return e.value}))};e.prototype.reset=function(){var e=this;if(this[Xt]&&this[Qt]&&this[Qt].length){this[Qt].forEach((function(t){return e[Xt](t.key,t.value)}))}this[Zt]=new Map;this[Qt]=new jt;this[Gt]=0};e.prototype.dump=function(){var e=this;return this[Qt].map((function(t){return rn(e,t)?false:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}})).toArray().filter((function(e){return e}))};e.prototype.dumpLru=function(){return this[Qt]};e.prototype.set=function(e,t,n){n=n||this[Yt];if(n&&typeof n!=="number")throw new TypeError("maxAge must be a number");var r=n?Date.now():0;var i=this[$t](t,e);if(this[Zt].has(e)){if(i>this[Ht]){on(this,this[Zt].get(e));return false}var a=this[Zt].get(e);var o=a.value;if(this[Xt]){if(!this[Jt])this[Xt](e,o.value)}o.now=r;o.maxAge=n;o.value=t;this[Gt]+=i-o.length;o.length=i;this.get(e);an(this);return true}var u=new un(e,t,i,r,n);if(u.length>this[Ht]){if(this[Xt])this[Xt](e,t);return false}this[Gt]+=u.length;this[Qt].unshift(u);this[Zt].set(e,this[Qt].head);an(this);return true};e.prototype.has=function(e){if(!this[Zt].has(e))return false;var t=this[Zt].get(e).value;return!rn(this,t)};e.prototype.get=function(e){return nn(this,e,true)};e.prototype.peek=function(e){return nn(this,e,false)};e.prototype.pop=function(){var e=this[Qt].tail;if(!e)return null;on(this,e);return e.value};e.prototype.del=function(e){on(this,this[Zt].get(e))};e.prototype.load=function(e){this.reset();var t=Date.now();for(var n=e.length-1;n>=0;n--){var r=e[n];var i=r.e||0;if(i===0)this.set(r.k,r.v);else{var a=i-t;if(a>0){this.set(r.k,r.v,a)}}}};e.prototype.prune=function(){var e=this;this[Zt].forEach((function(t,n){return nn(e,n,false)}))};return e}();var nn=function(e,t,n){var r=e[Zt].get(t);if(r){var i=r.value;if(rn(e,i)){on(e,r);if(!e[Vt])return undefined}else{if(n){if(e[Kt])r.value.now=Date.now();e[Qt].unshiftNode(r)}}return i.value}};var rn=function(e,t){if(!t||!t.maxAge&&!e[Yt])return false;var n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Yt]&&n>e[Yt]};var an=function(e){if(e[Gt]>e[Ht]){for(var t=e[Qt].tail;e[Gt]>e[Ht]&&t!==null;){var n=t.prev;on(e,t);t=n}}};var on=function(e,t){if(t){var n=t.value;if(e[Xt])e[Xt](n.key,n.value);e[Gt]-=n.length;e[Zt].delete(n.key);e[Qt].removeNode(t)}};var un=function(){function e(e,t,n,r,i){this.key=e;this.value=t;this.length=n;this.now=r;this.maxAge=i||0}return e}();var sn=function(e,t,n,r){var i=n.value;if(rn(e,i)){on(e,n);if(!e[Vt])i=undefined}if(i)t.call(r,i.value,i.key,e)};var ln=tn;var fn=function(){function e(t,n){var r=this;n=Ce(n);if(t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease){return t}else{return new e(t.raw,n)}}if(t instanceof Rn){this.raw=t.value;this.set=[[t]];this.format();return this}this.options=n;this.loose=!!n.loose;this.includePrerelease=!!n.includePrerelease;this.raw=t;this.set=t.split(/\s*\|\|\s*/).map((function(e){return r.parseRange(e.trim())})).filter((function(e){return e.length}));if(!this.set.length){throw new TypeError("Invalid SemVer Range: "+t)}if(this.set.length>1){var i=this.set[0];this.set=this.set.filter((function(e){return!yn(e[0])}));if(this.set.length===0)this.set=[i];else if(this.set.length>1){for(var a=0,o=this.set;a<o.length;a++){var u=o[a];if(u.length===1&&_n(u[0])){this.set=[u];break}}}}this.format()}e.prototype.format=function(){this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim();return this.range};e.prototype.toString=function(){return this.range};e.prototype.parseRange=function(e){var t=this;e=e.trim();var n=Object.keys(this.options).join(",");var r="parseRange:"+n+":"+e;var i=dn.get(r);if(i)return i;var a=this.options.loose;var o=a?hn[vn.HYPHENRANGELOOSE]:hn[vn.HYPHENRANGE];e=e.replace(o,On(this.options.includePrerelease));Ae("hyphen replace",e);e=e.replace(hn[vn.COMPARATORTRIM],pn);Ae("comparator trim",e,hn[vn.COMPARATORTRIM]);e=e.replace(hn[vn.TILDETRIM],gn);e=e.replace(hn[vn.CARETTRIM],mn);e=e.split(/\s+/).join(" ");var u=a?hn[vn.COMPARATORLOOSE]:hn[vn.COMPARATOR];var s=e.split(" ").map((function(e){return xn(e,t.options)})).join(" ").split(/\s+/).map((function(e){return Fn(e,t.options)})).filter(this.options.loose?function(e){return!!e.match(u)}:function(){return true}).map((function(e){return new Rn(e,t.options)}));var l=new Map;for(var f=0,c=s;f<c.length;f++){var d=c[f];if(yn(d))return[d];l.set(d.value,d)}if(l.size>1&&l.has(""))l.delete("");var h=__spreadArray([],l.values());dn.set(r,h);return h};e.prototype.intersects=function(t,n){if(!(t instanceof e)){throw new TypeError("a Range is required")}return this.set.some((function(e){return bn(e,n)&&t.set.some((function(t){return bn(t,n)&&e.every((function(e){return t.every((function(t){return e.intersects(t,n)}))}))}))}))};e.prototype.test=function(e){if(!e){return false}if(typeof e==="string"){try{e=new Be(e,this.options)}catch(che){return false}}for(var t=0;t<this.set.length;t++){if(Nn(this.set[t],e,this.options)){return true}}return false};return e}();var cn=fn;var dn=new ln({max:1e3});var hn=Ee.re,vn=Ee.t,pn=Ee.comparatorTrimReplace,gn=Ee.tildeTrimReplace,mn=Ee.caretTrimReplace;var yn=function(e){return e.value==="<0.0.0-0"};var _n=function(e){return e.value===""};var bn=function(e,t){var n=true;var r=e.slice();var i=r.pop();while(n&&r.length){n=r.every((function(e){return i.intersects(e,t)}));i=r.pop()}return n};var xn=function(e,t){Ae("comp",e,t);e=En(e,t);Ae("caret",e);e=kn(e,t);Ae("tildes",e);e=Sn(e,t);Ae("xrange",e);e=Mn(e,t);Ae("stars",e);return e};var wn=function(e){return!e||e.toLowerCase()==="x"||e==="*"};var kn=function(e,t){return e.trim().split(/\s+/).map((function(e){return An(e,t)})).join(" ")};var An=function(e,t){var n=t.loose?hn[vn.TILDELOOSE]:hn[vn.TILDE];return e.replace(n,(function(t,n,r,i,a){Ae("tilde",e,t,n,r,i,a);var o;if(wn(n)){o=""}else if(wn(r)){o=">="+n+".0.0 <"+(+n+1)+".0.0-0"}else if(wn(i)){o=">="+n+"."+r+".0 <"+n+"."+(+r+1)+".0-0"}else if(a){Ae("replaceTilde pr",a);o=">="+n+"."+r+"."+i+"-"+a+" <"+n+"."+(+r+1)+".0-0"}else{o=">="+n+"."+r+"."+i+" <"+n+"."+(+r+1)+".0-0"}Ae("tilde return",o);return o}))};var En=function(e,t){return e.trim().split(/\s+/).map((function(e){return Dn(e,t)})).join(" ")};var Dn=function(e,t){Ae("caret",e,t);var n=t.loose?hn[vn.CARETLOOSE]:hn[vn.CARET];var r=t.includePrerelease?"-0":"";return e.replace(n,(function(t,n,i,a,o){Ae("caret",e,t,n,i,a,o);var u;if(wn(n)){u=""}else if(wn(i)){u=">="+n+".0.0"+r+" <"+(+n+1)+".0.0-0"}else if(wn(a)){if(n==="0"){u=">="+n+"."+i+".0"+r+" <"+n+"."+(+i+1)+".0-0"}else{u=">="+n+"."+i+".0"+r+" <"+(+n+1)+".0.0-0"}}else if(o){Ae("replaceCaret pr",o);if(n==="0"){if(i==="0"){u=">="+n+"."+i+"."+a+"-"+o+" <"+n+"."+i+"."+(+a+1)+"-0"}else{u=">="+n+"."+i+"."+a+"-"+o+" <"+n+"."+(+i+1)+".0-0"}}else{u=">="+n+"."+i+"."+a+"-"+o+" <"+(+n+1)+".0.0-0"}}else{Ae("no pr");if(n==="0"){if(i==="0"){u=">="+n+"."+i+"."+a+r+" <"+n+"."+i+"."+(+a+1)+"-0"}else{u=">="+n+"."+i+"."+a+r+" <"+n+"."+(+i+1)+".0-0"}}else{u=">="+n+"."+i+"."+a+" <"+(+n+1)+".0.0-0"}}Ae("caret return",u);return u}))};var Sn=function(e,t){Ae("replaceXRanges",e,t);return e.split(/\s+/).map((function(e){return Cn(e,t)})).join(" ")};var Cn=function(e,t){e=e.trim();var n=t.loose?hn[vn.XRANGELOOSE]:hn[vn.XRANGE];return e.replace(n,(function(n,r,i,a,o,u){Ae("xRange",e,n,r,i,a,o,u);var s=wn(i);var l=s||wn(a);var f=l||wn(o);var c=f;if(r==="="&&c){r=""}u=t.includePrerelease?"-0":"";if(s){if(r===">"||r==="<"){n="<0.0.0-0"}else{n="*"}}else if(r&&c){if(l){a=0}o=0;if(r===">"){r=">=";if(l){i=+i+1;a=0;o=0}else{a=+a+1;o=0}}else if(r==="<="){r="<";if(l){i=+i+1}else{a=+a+1}}if(r==="<")u="-0";n=r+i+"."+a+"."+o+u}else if(l){n=">="+i+".0.0"+u+" <"+(+i+1)+".0.0-0"}else if(f){n=">="+i+"."+a+".0"+u+" <"+i+"."+(+a+1)+".0-0"}Ae("xRange return",n);return n}))};var Mn=function(e,t){Ae("replaceStars",e,t);return e.trim().replace(hn[vn.STAR],"")};var Fn=function(e,t){Ae("replaceGTE0",e,t);return e.trim().replace(hn[t.includePrerelease?vn.GTE0PRE:vn.GTE0],"")};var On=function(e){return function(t,n,r,i,a,o,u,s,l,f,c,d,h){if(wn(r)){n=""}else if(wn(i)){n=">="+r+".0.0"+(e?"-0":"")}else if(wn(a)){n=">="+r+"."+i+".0"+(e?"-0":"")}else if(o){n=">="+n}else{n=">="+n+(e?"-0":"")}if(wn(l)){s=""}else if(wn(f)){s="<"+(+l+1)+".0.0-0"}else if(wn(c)){s="<"+l+"."+(+f+1)+".0-0"}else if(d){s="<="+l+"."+f+"."+c+"-"+d}else if(e){s="<"+l+"."+f+"."+(+c+1)+"-0"}else{s="<="+s}return(n+" "+s).trim()}};var Nn=function(e,t,n){for(var r=0;r<e.length;r++){if(!e[r].test(t)){return false}}if(t.prerelease.length&&!n.includePrerelease){for(var r=0;r<e.length;r++){Ae(e[r].semver);if(e[r].semver===Rn.ANY){continue}if(e[r].semver.prerelease.length>0){var i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch){return true}}}return false}return true};var Tn=Symbol("SemVer ANY");var zn=function(){function e(t,n){n=Ce(n);if(t instanceof e){if(t.loose===!!n.loose){return t}else{t=t.value}}Ae("comparator",t,n);this.options=n;this.loose=!!n.loose;this.parse(t);if(this.semver===Tn){this.value=""}else{this.value=this.operator+this.semver.version}Ae("comp",this)}Object.defineProperty(e,"ANY",{get:function(){return Tn},enumerable:false,configurable:true});e.prototype.parse=function(e){var t=this.options.loose?Pn[Ln.COMPARATORLOOSE]:Pn[Ln.COMPARATOR];var n=e.match(t);if(!n){throw new TypeError("Invalid comparator: "+e)}this.operator=n[1]!==undefined?n[1]:"";if(this.operator==="="){this.operator=""}if(!n[2]){this.semver=Tn}else{this.semver=new Be(n[2],this.options.loose)}};e.prototype.toString=function(){return this.value};e.prototype.test=function(e){Ae("Comparator.test",e,this.options.loose);if(this.semver===Tn||e===Tn){return true}if(typeof e==="string"){try{e=new Be(e,this.options)}catch(che){return false}}return Nt(e,this.operator,this.semver,this.options)};e.prototype.intersects=function(t,n){if(!(t instanceof e)){throw new TypeError("a Comparator is required")}if(!n||typeof n!=="object"){n={loose:!!n,includePrerelease:false}}if(this.operator===""){if(this.value===""){return true}return new cn(t.value,n).test(this.value)}else if(t.operator===""){if(t.value===""){return true}return new cn(this.value,n).test(t.semver)}var r=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">");var i=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<");var a=this.semver.version===t.semver.version;var o=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<=");var u=Nt(this.semver,"<",t.semver,n)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<");var s=Nt(this.semver,">",t.semver,n)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return r||i||a&&o||u||s};return e}();var Rn=zn;var Pn=Ee.re,Ln=Ee.t;var jn=function(e,t,n){try{t=new cn(t,n)}catch(che){return false}return t.test(e)};var Bn=jn;var In=function(e,t){return new cn(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))};var Un=In;var qn=function(e,t,n){var r=null;var i=null;var a=null;try{a=new cn(t,n)}catch(che){return null}e.forEach((function(e){if(a.test(e)){if(!r||i.compare(e)===-1){r=e;i=new Be(r,n)}}}));return r};var Wn=qn;var Hn=function(e,t,n){var r=null;var i=null;var a=null;try{a=new cn(t,n)}catch(che){return null}e.forEach((function(e){if(a.test(e)){if(!r||i.compare(e)===1){r=e;i=new Be(r,n)}}}));return r};var Gn=Hn;var $n=function(e,t){e=new cn(e,t);var n=new Be("0.0.0");if(e.test(n)){return n}n=new Be("0.0.0-0");if(e.test(n)){return n}n=null;var r=function(t){var r=e.set[t];var i=null;r.forEach((function(e){var t=new Be(e.semver.version);switch(e.operator){case">":if(t.prerelease.length===0){t.patch++}else{t.prerelease.push(0)}t.raw=t.format();case"":case">=":if(!i||wt(t,i)){i=t}break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}));if(i&&(!n||wt(n,i)))n=i};for(var i=0;i<e.set.length;++i){r(i)}if(n&&e.test(n)){return n}return null};var Vn=$n;var Yn=function(e,t){try{return new cn(e,t).range||"*"}catch(che){return null}};var Xn=Yn;var Jn=Rn.ANY;var Qn=function(e,t,n,r){e=new Be(e,r);t=new cn(t,r);var i,a,o,u,s;switch(n){case">":i=wt;a=Ft;o=At;u=">";s=">=";break;case"<":i=At;a=Ct;o=wt;u="<";s="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Bn(e,t,r)){return false}var l=function(n){var l=t.set[n];var f=null;var c=null;l.forEach((function(e){if(e.semver===Jn){e=new Rn(">=0.0.0")}f=f||e;c=c||e;if(i(e.semver,f.semver,r)){f=e}else if(o(e.semver,c.semver,r)){c=e}}));if(f.operator===u||f.operator===s){return{value:false}}if((!c.operator||c.operator===u)&&a(e,c.semver)){return{value:false}}else if(c.operator===s&&o(e,c.semver)){return{value:false}}};for(var f=0;f<t.set.length;++f){var c=l(f);if(typeof c==="object")return c.value}return true};var Zn=Qn;var Kn=function(e,t,n){return Zn(e,t,">",n)};var er=Kn;var tr=function(e,t,n){return Zn(e,t,"<",n)};var nr=tr;var rr=function(e,t,n){e=new cn(e,n);t=new cn(t,n);return e.intersects(t)};var ir=rr;var ar=function(e,t,n){var r=[];var i=null;var a=null;var o=e.sort((function(e,t){return Ze(e,t,n)}));for(var u=0,s=o;u<s.length;u++){var l=s[u];var f=Bn(l,t,n);if(f){a=l;if(!i)i=l}else{if(a){r.push([i,a])}a=null;i=null}}if(i)r.push([i,null]);var c=[];for(var d=0,h=r;d<h.length;d++){var v=h[d],p=v[0],g=v[1];if(p===g)c.push(p);else if(!g&&p===o[0])c.push("*");else if(!g)c.push(">="+p);else if(p===o[0])c.push("<="+g);else c.push(p+" - "+g)}var m=c.join(" || ");var y=typeof t.raw==="string"?t.raw:String(t);return m.length<y.length?m:t};var or=Rn.ANY;var ur=function(e,t,n){if(n===void 0){n={}}if(e===t)return true;e=new cn(e,n);t=new cn(t,n);var r=false;e:for(var i=0,a=e.set;i<a.length;i++){var o=a[i];for(var u=0,s=t.set;u<s.length;u++){var l=s[u];var f=sr(o,l,n);r=r||f!==null;if(f)continue e}if(r)return false}return true};var sr=function(e,t,n){if(e===t)return true;if(e.length===1&&e[0].semver===or){if(t.length===1&&t[0].semver===or)return true;else if(n.includePrerelease)e=[new Rn(">=0.0.0-0")];else e=[new Rn(">=0.0.0")]}if(t.length===1&&t[0].semver===or){if(n.includePrerelease)return true;else t=[new Rn(">=0.0.0")]}var r=new Set;var i,a;for(var o=0,u=e;o<u.length;o++){var s=u[o];if(s.operator===">"||s.operator===">=")i=lr(i,s,n);else if(s.operator==="<"||s.operator==="<=")a=fr(a,s,n);else r.add(s.semver)}if(r.size>1)return null;var l;if(i&&a){l=Ze(i.semver,a.semver,n);if(l>0)return null;else if(l===0&&(i.operator!==">="||a.operator!=="<="))return null}for(var f=0,c=r;f<c.length;f++){var d=c[f];if(i&&!Bn(d,String(i),n))return null;if(a&&!Bn(d,String(a),n))return null;for(var h=0,v=t;h<v.length;h++){var p=v[h];if(!Bn(d,String(p),n))return false}return true}var g,m;var y,_;var b=a&&!n.includePrerelease&&a.semver.prerelease.length?a.semver:false;var x=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:false;if(b&&b.prerelease.length===1&&a.operator==="<"&&b.prerelease[0]===0){b=false}for(var w=0,k=t;w<k.length;w++){var A=k[w];_=_||A.operator===">"||A.operator===">=";y=y||A.operator==="<"||A.operator==="<=";if(i){if(x){if(A.semver.prerelease&&A.semver.prerelease.length&&A.semver.major===x.major&&A.semver.minor===x.minor&&A.semver.patch===x.patch){x=false}}if(A.operator===">"||A.operator===">="){g=lr(i,A,n);if(g===A&&g!==i)return false}else if(i.operator===">="&&!Bn(i.semver,String(A),n))return false}if(a){if(b){if(A.semver.prerelease&&A.semver.prerelease.length&&A.semver.major===b.major&&A.semver.minor===b.minor&&A.semver.patch===b.patch){b=false}}if(A.operator==="<"||A.operator==="<="){m=fr(a,A,n);if(m===A&&m!==a)return false}else if(a.operator==="<="&&!Bn(a.semver,String(A),n))return false}if(!A.operator&&(a||i)&&l!==0)return false}if(i&&y&&!a&&l!==0)return false;if(a&&_&&!i&&l!==0)return false;if(x||b)return false;return true};var lr=function(e,t,n){if(!e)return t;var r=Ze(e.semver,t.semver,n);return r>0?e:r<0?t:t.operator===">"&&e.operator===">="?t:e};var fr=function(e,t,n){if(!e)return t;var r=Ze(e.semver,t.semver,n);return r<0?e:r>0?t:t.operator==="<"&&e.operator==="<="?t:e};var cr=ur;var dr={re:Ee.re,src:Ee.src,tokens:Ee.t,SEMVER_SPEC_VERSION:we.SEMVER_SPEC_VERSION,SemVer:Be,compareIdentifiers:Ne.compareIdentifiers,rcompareIdentifiers:Ne.rcompareIdentifiers,parse:He,valid:$e,clean:Ye,inc:Je,diff:nt,major:it,minor:ot,patch:st,prerelease:ft,compare:Ze,rcompare:dt,compareLoose:vt,compareBuild:gt,sort:yt,rsort:bt,gt:wt,lt:At,eq:et,neq:Dt,gte:Ct,lte:Ft,cmp:Nt,coerce:Pt,Comparator:Rn,Range:cn,satisfies:Bn,toComparators:Un,maxSatisfying:Wn,minSatisfying:Gn,minVersion:Vn,validRange:Xn,outside:Zn,gtr:er,ltr:nr,intersects:ir,simplifyRange:ar,subset:cr};function hr(e,t,n){e.fields=t||[];e.fname=n;return e}function vr(e){return e==null?null:e.fname}function pr(e){return e==null?null:e.fields}function gr(e){return e.length===1?mr(e[0]):yr(e)}var mr=function(e){return function(t){return t[e]}};var yr=function(e){var t=e.length;return function(n){for(var r=0;r<t;++r){n=n[e[r]]}return n}};function _r(e){throw Error(e)}function br(e){var t=[],n=e.length;var r=null,i=0,a="",o,u,s;e=e+"";function l(){t.push(a+e.substring(o,u));a="";o=u+1}for(o=u=0;u<n;++u){s=e[u];if(s==="\\"){a+=e.substring(o,u);a+=e.substring(++u,++u);o=u}else if(s===r){l();r=null;i=-1}else if(r){continue}else if(o===i&&s==='"'){o=u+1;r=s}else if(o===i&&s==="'"){o=u+1;r=s}else if(s==="."&&!i){if(u>o){l()}else{o=u+1}}else if(s==="["){if(u>o)l();i=o=u+1}else if(s==="]"){if(!i)_r("Access path missing open bracket: "+e);if(i>0)l();i=0;o=u+1}}if(i)_r("Access path missing closing bracket: "+e);if(r)_r("Access path missing closing quote: "+e);if(u>o){u++;l()}return t}function xr(e,t,n){var r=br(e);e=r.length===1?r[0]:e;return hr((n&&n.get||gr)(r),[e],t||e)}var wr=xr("id");var kr=hr((function(e){return e}),[],"identity");var Ar=hr((function(){return 0}),[],"zero");var Er=hr((function(){return 1}),[],"one");var Dr=hr((function(){return true}),[],"true");var Sr=hr((function(){return false}),[],"false");function Cr(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var Mr=0;var Fr=1;var Or=2;var Nr=3;var Tr=4;function zr(e,t){var n=e||Mr;return{level:function(e){if(arguments.length){n=+e;return this}else{return n}},error:function(){if(n>=Fr)Cr(t||"error","ERROR",arguments);return this},warn:function(){if(n>=Or)Cr(t||"warn","WARN",arguments);return this},info:function(){if(n>=Nr)Cr(t||"log","INFO",arguments);return this},debug:function(){if(n>=Tr)Cr(t||"log","DEBUG",arguments);return this}}}var Rr=Array.isArray;function Pr(e){return e===Object(e)}var Lr=function(e){return e!=="__proto__"};function jr(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e.reduce((function(e,t){for(var n in t){if(n==="signals"){e.signals=Ir(e.signals,t.signals)}else{var r=n==="legend"?{layout:1}:n==="style"?true:null;Br(e,n,t[n],r)}}return e}),{})}function Br(e,t,n,r){if(!Lr(t))return;var i,a;if(Pr(n)&&!Rr(n)){a=Pr(e[t])?e[t]:e[t]={};for(i in n){if(r&&(r===true||r[i])){Br(a,i,n[i])}else if(Lr(i)){a[i]=n[i]}}}else{e[t]=n}}function Ir(e,t){if(e==null)return t;var n={},r=[];function i(e){if(!n[e.name]){n[e.name]=1;r.push(e)}}t.forEach(i);e.forEach(i);return r}function Ur(e){return e[e.length-1]}function qr(e){return e==null||e===""?null:+e}var Wr=function(e){return function(t){return e*Math.exp(t)}};var Hr=function(e){return function(t){return Math.log(e*t)}};var Gr=function(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}};var $r=function(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}};var Vr=function(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}};function Yr(e,t,n,r){var i=n(e[0]),a=n(Ur(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function Xr(e,t){return Yr(e,t,qr,kr)}function Jr(e,t){var n=Math.sign(e[0]);return Yr(e,t,Hr(n),Wr(n))}function Qr(e,t,n){return Yr(e,t,Vr(n),Vr(1/n))}function Zr(e,t,n){return Yr(e,t,Gr(n),$r(n))}function Kr(e,t,n,r,i){var a=r(e[0]),o=r(Ur(e)),u=t!=null?r(t):(a+o)/2;return[i(u+(a-u)*n),i(u+(o-u)*n)]}function ei(e,t,n){return Kr(e,t,n,qr,kr)}function ti(e,t,n){var r=Math.sign(e[0]);return Kr(e,t,n,Hr(r),Wr(r))}function ni(e,t,n,r){return Kr(e,t,n,Vr(r),Vr(1/r))}function ri(e,t,n,r){return Kr(e,t,n,Gr(r),$r(r))}function ii(e){return 1+~~(new Date(e).getMonth()/3)}function ai(e){return 1+~~(new Date(e).getUTCMonth()/3)}function oi(e){return e!=null?Rr(e)?e:[e]:[]}function ui(e,t,n){var r=e[0],i=e[1],a;if(i<r){a=i;i=r;r=a}a=i-r;return a>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-a),r+a]}function si(e){return typeof e==="function"}var li="descending";function fi(e,t,n){n=n||{};t=oi(t)||[];var r=[],i=[],a={},o=n.comparator||di;oi(e).forEach((function(e,o){if(e==null)return;r.push(t[o]===li?-1:1);i.push(e=si(e)?e:xr(e,null,n));(pr(e)||[]).forEach((function(e){return a[e]=1}))}));return i.length===0?null:hr(o(i,r),Object.keys(a))}var ci=function(e,t){return(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0};var di=function(e,t){return e.length===1?hi(e[0],t[0]):vi(e,t,e.length)};var hi=function(e,t){return function(n,r){return ci(e(n),e(r))*t}};var vi=function(e,t,n){t.push(0);return function(r,i){var a,o=0,u=-1;while(o===0&&++u<n){a=e[u];o=ci(a(r),a(i))}return o*t[u]}};function pi(e){return si(e)?e:function(){return e}}function gi(e,t){var n;return function(r){if(n)clearTimeout(n);n=setTimeout((function(){return t(r),n=null}),e)}}function mi(e){for(var t,n=void 0,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t){e[n]=t[n]}}return e}function yi(e,t){var n=0,r,i,a,o;if(e&&(r=e.length)){if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);a=o=i;for(;n<r;++n){i=e[n];if(i!=null){if(i<a)a=i;if(i>o)o=i}}}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));a=o=i;for(;n<r;++n){i=t(e[n]);if(i!=null){if(i<a)a=i;if(i>o)o=i}}}}return[a,o]}function _i(e,t){var n=e.length;var r=-1,i,a,o,u,s;if(t==null){while(++r<n){a=e[r];if(a!=null&&a>=a){i=o=a;break}}if(r===n)return[-1,-1];u=s=r;while(++r<n){a=e[r];if(a!=null){if(i>a){i=a;u=r}if(o<a){o=a;s=r}}}}else{while(++r<n){a=t(e[r],r,e);if(a!=null&&a>=a){i=o=a;break}}if(r===n)return[-1,-1];u=s=r;while(++r<n){a=t(e[r],r,e);if(a!=null){if(i>a){i=a;u=r}if(o<a){o=a;s=r}}}}return[u,s]}var bi=Object.prototype.hasOwnProperty;function xi(e,t){return bi.call(e,t)}var wi={};function ki(e){var t={},n;function r(e){return xi(t,e)&&t[e]!==wi}var i={size:0,empty:0,object:t,has:r,get:function(e){return r(e)?t[e]:undefined},set:function(e,n){if(!r(e)){++i.size;if(t[e]===wi)--i.empty}t[e]=n;return this},delete:function(e){if(r(e)){--i.size;++i.empty;t[e]=wi}return this},clear:function(){i.size=i.empty=0;i.object=t={}},test:function(e){if(arguments.length){n=e;return i}else{return n}},clean:function(){var e={};var r=0;for(var a in t){var o=t[a];if(o!==wi&&(!n||!n(o))){e[a]=o;++r}}i.size=r;i.empty=0;i.object=t=e}};if(e)Object.keys(e).forEach((function(t){i.set(t,e[t])}));return i}function Ai(e,t,n,r,i,a){if(!n&&n!==0)return a;var o=+n;var u=e[0],s=Ur(e),l;if(s<u){l=u;u=s;s=l}l=Math.abs(t-u);var f=Math.abs(s-t);return l<f&&l<=o?r:f<=o?i:a}function Ei(e,t,n){var r=e.prototype=Object.create(t.prototype);Object.defineProperty(r,"constructor",{value:e,writable:true,enumerable:true,configurable:true});return mi(r,n)}function Di(e,t,n,r){var i=t[0],a=t[t.length-1],o;if(i>a){o=i;i=a;a=o}n=n===undefined||n;r=r===undefined||r;return(n?i<=e:i<e)&&(r?e<=a:e<a)}function Si(e){return typeof e==="boolean"}function Ci(e){return Object.prototype.toString.call(e)==="[object Date]"}function Mi(e){return e&&si(e[Symbol.iterator])}function Fi(e){return typeof e==="number"}function Oi(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Ni(e){return typeof e==="string"}function Ti(e,t,n){if(e){e=t?oi(e).map((function(e){return e.replace(/\\(.)/g,"$1")})):oi(e)}var r=e&&e.length,i=n&&n.get||gr,a=function(e){return i(t?[e]:br(e))};var o;if(!r){o=function(){return""}}else if(r===1){var u=a(e[0]);o=function(e){return""+u(e)}}else{var s=e.map(a);o=function(e){var t=""+s[0](e),n=0;while(++n<r)t+="|"+s[n](e);return t}}return hr(o,e,"key")}function zi(e,t){var n=e[0],r=Ur(e),i=+t;return!i?n:i===1?r:n+i*(r-n)}var Ri=1e4;function Pi(e){e=+e||Ri;var t,n,r;var i=function(){t={};n={};r=0};var a=function(i,a){if(++r>e){n=t;t={};r=1}return t[i]=a};i();return{clear:i,has:function(e){return xi(t,e)||xi(n,e)},get:function(e){return xi(t,e)?t[e]:xi(n,e)?a(e,n[e]):undefined},set:function(e,n){return xi(t,e)?t[e]=n:a(e,n)}}}function Li(e,t,n,r){var i=t.length,a=n.length;if(!a)return t;if(!i)return n;var o=r||new t.constructor(i+a);var u=0,s=0,l=0;for(;u<i&&s<a;++l){o[l]=e(t[u],n[s])>0?n[s++]:t[u++]}for(;u<i;++u,++l){o[l]=t[u]}for(;s<a;++s,++l){o[l]=n[s]}return o}function ji(e,t){var n="";while(--t>=0)n+=e;return n}function Bi(e,t,n,r){var i=n||" ",a=e+"",o=t-a.length;return o<=0?a:r==="left"?ji(i,o)+a:r==="center"?ji(i,~~(o/2))+a+ji(i,Math.ceil(o/2)):a+ji(i,o)}function Ii(e){return e&&Ur(e)-e[0]||0}function Ui(e){return Rr(e)?"["+e.map(Ui)+"]":Pr(e)||Ni(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function qi(e){return e==null||e===""?null:!e||e==="false"||e==="0"?false:!!e}var Wi=function(e){return Fi(e)?e:Ci(e)?e:Date.parse(e)};function Hi(e,t){t=t||Wi;return e==null||e===""?null:t(e)}function Gi(e){return e==null||e===""?null:e+""}function $i(e){var t={},n=e.length;for(var r=0;r<n;++r)t[e[r]]=true;return t}function Vi(e,t,n,r){var i=r!=null?r:"…",a=e+"",o=a.length,u=Math.max(0,t-i.length);return o<=t?a:n==="left"?i+a.slice(o-u):n==="center"?a.slice(0,Math.ceil(u/2))+i+a.slice(o-~~(u/2)):a.slice(0,u)+i}function Yi(e,t,n){if(e){if(t){var r=e.length;for(var i=0;i<r;++i){var a=t(e[i]);if(a)n(a,i,e)}}else{e.forEach(n)}}}var Xi=/^([A-Za-z]+:)?\/\//;var Ji=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i;var Qi=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;var Zi="file://";function Ki(e,t){return function(n){return{options:n||{},sanitize:ta,load:ea,fileAccess:!!t,file:na(t),http:ia(e)}}}function ea(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.sanitize(e,t)];case 1:n=i.sent(),r=n.href;return[2,n.localFile?this.file(r):this.http(r,t)]}}))}))}function ta(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i,a,o,u,s;return __generator(this,(function(l){t=mi({},this.options,t);n=this.fileAccess,r={href:null};u=Ji.test(e.replace(Qi,""));if(e==null||typeof e!=="string"||!u){_r("Sanitize failure, invalid URI: "+Ui(e))}s=Xi.test(e);if((o=t.baseURL)&&!s){if(!e.startsWith("/")&&o[o.length-1]!=="/"){e="/"+e}e=o+e}a=(i=e.startsWith(Zi))||t.mode==="file"||t.mode!=="http"&&!s&&n;if(i){e=e.slice(Zi.length)}else if(e.startsWith("//")){if(t.defaultProtocol==="file"){e=e.slice(2);a=true}else{e=(t.defaultProtocol||"http")+":"+e}}Object.defineProperty(r,"localFile",{value:!!a});r.href=e;if(t.target){r.target=t.target+""}if(t.rel){r.rel=t.rel+""}if(t.context==="image"&&t.crossOrigin){r.crossOrigin=t.crossOrigin+""}return[2,r]}))}))}function na(e){return e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){if(e)r(e);else n(t)}))}))}:ra}function ra(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){_r("No file system access.");return[2]}))}))}function ia(e){return e?function(t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,a;return __generator(this,(function(o){switch(o.label){case 0:r=mi({},this.options.http,n),i=n&&n.response;return[4,e(t,r)];case 1:a=o.sent();return[2,!a.ok?_r(a.status+""+a.statusText):si(a[i])?a[i]():a.text()]}}))}))}:aa}function aa(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){_r("No HTTP fetch method available.");return[2]}))}))}var oa=function(e){return e!=null&&e===e};var ua=function(e){return e==="true"||e==="false"||e===true||e===false};var sa=function(e){return!Number.isNaN(Date.parse(e))};var la=function(e){return!Number.isNaN(+e)&&!(e instanceof Date)};var fa=function(e){return la(e)&&Number.isInteger(+e)};var ca={boolean:qi,integer:qr,number:qr,date:Hi,string:Gi,unknown:kr};var da=[ua,fa,la,sa];var ha=["boolean","integer","number","date"];function va(e,t){if(!e||!e.length)return"unknown";var n=e.length,r=da.length,i=da.map((function(e,t){return t+1}));for(var a=0,o=0,u=void 0,s;a<n;++a){s=t?e[a][t]:e[a];for(u=0;u<r;++u){if(i[u]&&oa(s)&&!da[u](s)){i[u]=0;++o;if(o===da.length)return"string"}}}return ha[i.reduce((function(e,t){return e===0?t:e}),0)-1]}function pa(e,t){return t.reduce((function(t,n){t[n]=va(e,n);return t}),{})}var ga={},ma={},ya=34,_a=10,ba=13;function xa(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function wa(e,t){var n=xa(e);return function(r,i){return t(n(r),i,e)}}function ka(e){var t=Object.create(null),n=[];e.forEach((function(e){for(var r in e){if(!(r in t)){n.push(t[r]=r)}}}));return n}function Aa(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Ea(e){return e<0?"-"+Aa(-e,6):e>9999?"+"+Aa(e,6):Aa(e,4)}function Da(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Ea(e.getUTCFullYear())+"-"+Aa(e.getUTCMonth()+1,2)+"-"+Aa(e.getUTCDate(),2)+(i?"T"+Aa(t,2)+":"+Aa(n,2)+":"+Aa(r,2)+"."+Aa(i,3)+"Z":r?"T"+Aa(t,2)+":"+Aa(n,2)+":"+Aa(r,2)+"Z":n||t?"T"+Aa(t,2)+":"+Aa(n,2)+"Z":"")}function Sa(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var n,r,a=i(e,(function(e,i){if(n)return n(e,i-1);r=e,n=t?wa(e,t):xa(e)}));a.columns=r||[];return a}function i(e,t){var r=[],i=e.length,a=0,o=0,u,s=i<=0,l=false;if(e.charCodeAt(i-1)===_a)--i;if(e.charCodeAt(i-1)===ba)--i;function f(){if(s)return ma;if(l)return l=false,ga;var t,r=a,o;if(e.charCodeAt(r)===ya){while(a++<i&&e.charCodeAt(a)!==ya||e.charCodeAt(++a)===ya);if((t=a)>=i)s=true;else if((o=e.charCodeAt(a++))===_a)l=true;else if(o===ba){l=true;if(e.charCodeAt(a)===_a)++a}return e.slice(r+1,t-1).replace(/""/g,'"')}while(a<i){if((o=e.charCodeAt(t=a++))===_a)l=true;else if(o===ba){l=true;if(e.charCodeAt(a)===_a)++a}else if(o!==n)continue;return e.slice(r,t)}return s=true,e.slice(r,i)}while((u=f())!==ma){var c=[];while(u!==ga&&u!==ma)c.push(u),u=f();if(t&&(c=t(c,o++))==null)continue;r.push(c)}return r}function a(t,n){return t.map((function(t){return n.map((function(e){return f(t[e])})).join(e)}))}function o(t,n){if(n==null)n=ka(t);return[n.map(f).join(e)].concat(a(t,n)).join("\n")}function u(e,t){if(t==null)t=ka(e);return a(e,t).join("\n")}function s(e){return e.map(l).join("\n")}function l(t){return t.map(f).join(e)}function f(e){return e==null?"":e instanceof Date?Da(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:r,parseRows:i,format:o,formatBody:u,formatRows:s,formatRow:l,formatValue:f}}function Ca(e){var t=function(t,n){var r={delimiter:e};return Ma(t,n?mi(n,r):r)};t.responseType="text";return t}function Ma(e,t){if(t.header){e=t.header.map(Ui).join(t.delimiter)+"\n"+e}return Sa(t.delimiter).parse(e+"")}Ma.responseType="text";function Fa(e){return typeof Buffer==="function"&&si(Buffer.isBuffer)?Buffer.isBuffer(e):false}function Oa(e,t){var n=t&&t.property?xr(t.property):kr;return Pr(e)&&!Fa(e)?Na(n(e),t):n(JSON.parse(e))}Oa.responseType="json";function Na(e,t){if(!Rr(e)&&Mi(e)){e=__spreadArray([],e)}return t&&t.copy?JSON.parse(JSON.stringify(e)):e}function Ta(e){return e}function za(e){if(e==null)return Ta;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,u){if(!u)t=n=0;var s=2,l=e.length,f=new Array(l);f[0]=(t+=e[0])*r+a;f[1]=(n+=e[1])*i+o;while(s<l)f[s]=e[s],++s;return f}}function Ra(e,t){var n,r=e.length,i=r-t;while(i<--r)n=e[i],e[i++]=e[r],e[r]=n}function Pa(e,t){if(typeof t==="string")t=e.objects[t];return t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map((function(t){return La(e,t)}))}:La(e,t)}function La(e,t){var n=t.id,r=t.bbox,i=t.properties==null?{}:t.properties,a=ja(e,t);return n==null&&r==null?{type:"Feature",properties:i,geometry:a}:r==null?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function ja(e,t){var n=za(e.transform),r=e.arcs;function i(e,t){if(t.length)t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a){t.push(n(i[a],a))}if(e<0)Ra(t,o)}function a(e){return n(e)}function o(e){var t=[];for(var n=0,r=e.length;n<r;++n)i(e[n],t);if(t.length<2)t.push(t[0]);return t}function u(e){var t=o(e);while(t.length<4)t.push(t[0]);return t}function s(e){return e.map(u)}function l(e){var t=e.type,n;switch(t){case"GeometryCollection":return{type:t,geometries:e.geometries.map(l)};case"Point":n=a(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(a);break;case"LineString":n=o(e.arcs);break;case"MultiLineString":n=e.arcs.map(o);break;case"Polygon":n=s(e.arcs);break;case"MultiPolygon":n=e.arcs.map(s);break;default:return null}return{type:t,coordinates:n}}return l(t)}function Ba(e,t){var n={},r={},i={},a=[],o=-1;t.forEach((function(n,r){var i=e.arcs[n<0?~n:n],a;if(i.length<3&&!i[1][0]&&!i[1][1]){a=t[++o],t[o]=n,t[r]=a}}));t.forEach((function(e){var t=u(e),n=t[0],a=t[1],o,s;if(o=i[n]){delete i[o.end];o.push(e);o.end=a;if(s=r[a]){delete r[s.start];var l=s===o?o:o.concat(s);r[l.start=o.start]=i[l.end=s.end]=l}else{r[o.start]=i[o.end]=o}}else if(o=r[a]){delete r[o.start];o.unshift(e);o.start=n;if(s=i[n]){delete i[s.end];var f=s===o?o:s.concat(o);r[f.start=s.start]=i[f.end=o.end]=f}else{r[o.start]=i[o.end]=o}}else{o=[e];r[o.start=n]=i[o.end=a]=o}}));function u(t){var n=e.arcs[t<0?~t:t],r=n[0],i;if(e.transform)i=[0,0],n.forEach((function(e){i[0]+=e[0],i[1]+=e[1]}));else i=n[n.length-1];return t<0?[i,r]:[r,i]}function s(e,t){for(var r in e){var i=e[r];delete t[i.start];delete i.start;delete i.end;i.forEach((function(e){n[e<0?~e:e]=1}));a.push(i)}}s(i,r);s(r,i);t.forEach((function(e){if(!n[e<0?~e:e])a.push([e])}));return a}function Ia(e){return ja(e,Ua.apply(this,arguments))}function Ua(e,t,n){var r,i,a;if(arguments.length>1)r=qa(e,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:Ba(e,r)}}function qa(e,t,n){var r=[],i=[],a;function o(e){var t=e<0?~e:e;(i[t]||(i[t]=[])).push({i:e,g:a})}function u(e){e.forEach(o)}function s(e){e.forEach(u)}function l(e){e.forEach(s)}function f(e){switch(a=e,e.type){case"GeometryCollection":e.geometries.forEach(f);break;case"LineString":u(e.arcs);break;case"MultiLineString":case"Polygon":s(e.arcs);break;case"MultiPolygon":l(e.arcs);break}}f(t);i.forEach(n==null?function(e){r.push(e[0].i)}:function(e){if(n(e[0].g,e[e.length-1].g))r.push(e[0].i)});return r}var Wa={interior:function(e,t){return e!==t},exterior:function(e,t){return e===t}};function Ha(e,t){var n,r,i,a;e=Oa(e,t);if(t&&t.feature){n=Pa;i=t.feature}else if(t&&t.mesh){n=Ia;i=t.mesh;a=Wa[t.filter]}else{_r("Missing TopoJSON feature or mesh parameter.")}r=(r=e.objects[i])?n(e,r,a):_r("Invalid TopoJSON object: "+i);return r&&r.features||[r]}Ha.responseType="json";var Ga={dsv:Ma,csv:Ca(","),tsv:Ca("\t"),json:Oa,topojson:Ha};function $a(e,t){if(arguments.length>1){Ga[e]=t;return this}else{return xi(Ga,e)?Ga[e]:null}}function Va(e){var t=$a(e);return t&&t.responseType||"text"}function Ya(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Xa(e){var t=e;var n=e;if(e.length===1){t=function(t,n){return e(t)-n};n=Ja(e)}function r(e,t,r,i){if(r==null)r=0;if(i==null)i=e.length;while(r<i){var a=r+i>>>1;if(n(e[a],t)<0)r=a+1;else i=a}return r}function i(e,t,r,i){if(r==null)r=0;if(i==null)i=e.length;while(r<i){var a=r+i>>>1;if(n(e[a],t)>0)i=a;else r=a+1}return r}function a(e,n,i,a){if(i==null)i=0;if(a==null)a=e.length;var o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o}return{left:r,center:a,right:i}}function Ja(e){return function(t,n){return Ya(e(t),n)}}function Qa(e){return e===null?NaN:+e}function Za(e,t){var n,r,i,a,o,u,s;return __generator(this,(function(l){switch(l.label){case 0:if(!(t===undefined))return[3,5];n=0,r=e;l.label=1;case 1:if(!(n<r.length))return[3,4];i=r[n];if(!(i!=null&&(i=+i)>=i))return[3,3];return[4,i];case 2:l.sent();l.label=3;case 3:n++;return[3,1];case 4:return[3,9];case 5:a=-1;o=0,u=e;l.label=6;case 6:if(!(o<u.length))return[3,9];s=u[o];if(!((s=t(s,++a,e))!=null&&(s=+s)>=s))return[3,8];return[4,s];case 7:l.sent();l.label=8;case 8:o++;return[3,6];case 9:return[2]}}))}var Ka=Xa(Ya);var eo=Ka.right;var to=Ka.left;Xa(Qa).center;function no(e,t){var n=0;var r;var i=0;var a=0;if(t===undefined){for(var o=0,u=e;o<u.length;o++){var s=u[o];if(s!=null&&(s=+s)>=s){r=s-i;i+=r/++n;a+=r*(s-i)}}}else{var l=-1;for(var f=0,c=e;f<c.length;f++){var d=c[f];if((d=t(d,++l,e))!=null&&(d=+d)>=d){r=d-i;i+=r/++n;a+=r*(d-i)}}}if(n>1)return a/(n-1)}function ro(e,t){var n=no(e,t);return n?Math.sqrt(n):n}var io=function(){function e(){this._partials=new Float64Array(32);this._n=0}e.prototype.add=function(e){var t=this._partials;var n=0;for(var r=0;r<this._n&&r<32;r++){var i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);if(o)t[n++]=o;e=a}t[n]=e;this._n=n+1;return this};e.prototype.valueOf=function(){var e=this._partials;var t=this._n,n,r,i,a=0;if(t>0){a=e[--t];while(t>0){n=a;r=e[--t];a=n+r;i=r-(a-n);if(i)break}if(t>0&&(i<0&&e[t-1]<0||i>0&&e[t-1]>0)){r=i*2;n=a+r;if(r==n-a)a=n}}return a};return e}();function ao(e,t){return Array.from(t,(function(t){return e[t]}))}var oo=Math.sqrt(50),uo=Math.sqrt(10),so=Math.sqrt(2);function lo(e,t,n){var r,i=-1,a,o,u;t=+t,e=+e,n=+n;if(e===t&&n>0)return[e];if(r=t<e)a=e,e=t,t=a;if((u=fo(e,t,n))===0||!isFinite(u))return[];if(u>0){var s=Math.round(e/u),l=Math.round(t/u);if(s*u<e)++s;if(l*u>t)--l;o=new Array(a=l-s+1);while(++i<a)o[i]=(s+i)*u}else{u=-u;var s=Math.round(e*u),l=Math.round(t*u);if(s/u<e)++s;if(l/u>t)--l;o=new Array(a=l-s+1);while(++i<a)o[i]=(s+i)/u}if(r)o.reverse();return o}function fo(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=oo?10:a>=uo?5:a>=so?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=oo?10:a>=uo?5:a>=so?2:1)}function co(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;if(a>=oo)i*=10;else if(a>=uo)i*=5;else if(a>=so)i*=2;return t<e?-i:i}function ho(e,t){var n;if(t===undefined){for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a!=null&&(n<a||n===undefined&&a>=a)){n=a}}}else{var o=-1;for(var u=0,s=e;u<s.length;u++){var l=s[u];if((l=t(l,++o,e))!=null&&(n<l||n===undefined&&l>=l)){n=l}}}return n}function vo(e,t){var n;if(t===undefined){for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a!=null&&(n>a||n===undefined&&a>=a)){n=a}}}else{var o=-1;for(var u=0,s=e;u<s.length;u++){var l=s[u];if((l=t(l,++o,e))!=null&&(n>l||n===undefined&&l>=l)){n=l}}}return n}function po(e,t,n,r,i){if(n===void 0){n=0}if(r===void 0){r=e.length-1}if(i===void 0){i=Ya}while(r>n){if(r-n>600){var a=r-n+1;var o=t-n+1;var u=Math.log(a);var s=.5*Math.exp(2*u/3);var l=.5*Math.sqrt(u*s*(a-s)/a)*(o-a/2<0?-1:1);var f=Math.max(n,Math.floor(t-o*s/a+l));var c=Math.min(r,Math.floor(t+(a-o)*s/a+l));po(e,t,f,c,i)}var d=e[t];var h=n;var v=r;go(e,n,t);if(i(e[r],d)>0)go(e,n,r);while(h<v){go(e,h,v),++h,--v;while(i(e[h],d)<0)++h;while(i(e[v],d)>0)--v}if(i(e[n],d)===0)go(e,n,v);else++v,go(e,v,r);if(v<=t)n=v+1;if(t<=v)r=v-1}return e}function go(e,t,n){var r=e[t];e[t]=e[n];e[n]=r}function mo(e,t,n){e=Float64Array.from(Za(e,n));if(!(r=e.length))return;if((t=+t)<=0||r<2)return vo(e);if(t>=1)return ho(e);var r,i=(r-1)*t,a=Math.floor(i),o=ho(po(e,a).subarray(0,a+1)),u=vo(e.subarray(a+1));return o+(u-o)*(i-a)}function yo(e,t,n){if(n===void 0){n=Qa}if(!(r=e.length))return;if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e),u=+n(e[a+1],a+1,e);return o+(u-o)*(i-a)}function _o(e,t){var n=0;var r=0;if(t===undefined){for(var i=0,a=e;i<a.length;i++){var o=a[i];if(o!=null&&(o=+o)>=o){++n,r+=o}}}else{var u=-1;for(var s=0,l=e;s<l.length;s++){var f=l[s];if((f=t(f,++u,e))!=null&&(f=+f)>=f){++n,r+=f}}}if(n)return r/n}function bo(e,t){return mo(e,.5,t)}function xo(e){var t,n,r;return __generator(this,(function(i){switch(i.label){case 0:t=0,n=e;i.label=1;case 1:if(!(t<n.length))return[3,4];r=n[t];return[5,__values(r)];case 2:i.sent();i.label=3;case 3:t++;return[3,1];case 4:return[2]}}))}function wo(e){return Array.from(xo(e))}function ko(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(i);while(++r<i){a[r]=e+r*n}return a}function Ao(e,t){var n=0;if(t===undefined){for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a=+a){n+=a}}}else{var o=-1;for(var u=0,s=e;u<s.length;u++){var l=s[u];if(l=+t(l,++o,e)){n+=l}}}return n}function Eo(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Do(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function So(e){return e=Do(Math.abs(e)),e?e[1]:NaN}function Co(e,t){return function(n,r){var i=n.length,a=[],o=0,u=e[0],s=0;while(i>0&&u>0){if(s+u+1>r)u=Math.max(1,r-s);a.push(n.substring(i-=u,i+u));if((s+=u+1)>r)break;u=e[o=(o+1)%e.length]}return a.reverse().join(t)}}function Mo(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}var Fo=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Oo(e){if(!(t=Fo.exec(e)))throw new Error("invalid format: "+e);var t;return new No({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Oo.prototype=No.prototype;function No(e){this.fill=e.fill===undefined?" ":e.fill+"";this.align=e.align===undefined?">":e.align+"";this.sign=e.sign===undefined?"-":e.sign+"";this.symbol=e.symbol===undefined?"":e.symbol+"";this.zero=!!e.zero;this.width=e.width===undefined?undefined:+e.width;this.comma=!!e.comma;this.precision=e.precision===undefined?undefined:+e.precision;this.trim=!!e.trim;this.type=e.type===undefined?"":e.type+""}No.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===undefined?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===undefined?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function To(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n){switch(e[n]){case".":r=i=n;break;case"0":if(r===0)r=n;i=n;break;default:if(!+e[n])break e;if(r>0)r=0;break}}return r>0?e.slice(0,r)+e.slice(i+1):e}var zo;function Ro(e,t){var n=Do(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(zo=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Do(e,Math.max(0,t+a-1))[0]}function Po(e,t){var n=Do(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var Lo={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Eo,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Po(e*100,t)},r:Po,s:Ro,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function jo(e){return e}var Bo=Array.prototype.map,Io=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Uo(e){var t=e.grouping===undefined||e.thousands===undefined?jo:Co(Bo.call(e.grouping,Number),e.thousands+""),n=e.currency===undefined?"":e.currency[0]+"",r=e.currency===undefined?"":e.currency[1]+"",i=e.decimal===undefined?".":e.decimal+"",a=e.numerals===undefined?jo:Mo(Bo.call(e.numerals,String)),o=e.percent===undefined?"%":e.percent+"",u=e.minus===undefined?"−":e.minus+"",s=e.nan===undefined?"NaN":e.nan+"";function l(e){e=Oo(e);var l=e.fill,f=e.align,c=e.sign,d=e.symbol,h=e.zero,v=e.width,p=e.comma,g=e.precision,m=e.trim,y=e.type;if(y==="n")p=true,y="g";else if(!Lo[y])g===undefined&&(g=12),m=true,y="g";if(h||l==="0"&&f==="=")h=true,l="0",f="=";var _=d==="$"?n:d==="#"&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b=d==="$"?r:/[%p]/.test(y)?o:"";var x=Lo[y],w=/[defgprs%]/.test(y);g=g===undefined?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g));function k(e){var n=_,r=b,o,d,k;if(y==="c"){r=x(e)+r;e=""}else{e=+e;var A=e<0||1/e<0;e=isNaN(e)?s:x(Math.abs(e),g);if(m)e=To(e);if(A&&+e===0&&c!=="+")A=false;n=(A?c==="("?c:u:c==="-"||c==="("?"":c)+n;r=(y==="s"?Io[8+zo/3]:"")+r+(A&&c==="("?")":"");if(w){o=-1,d=e.length;while(++o<d){if(k=e.charCodeAt(o),48>k||k>57){r=(k===46?i+e.slice(o+1):e.slice(o))+r;e=e.slice(0,o);break}}}}if(p&&!h)e=t(e,Infinity);var E=n.length+e.length+r.length,D=E<v?new Array(v-E+1).join(l):"";if(p&&h)e=t(D+e,D.length?v-r.length:Infinity),D="";switch(f){case"<":e=n+e+r+D;break;case"=":e=n+D+e+r;break;case"^":e=D.slice(0,E=D.length>>1)+n+e+r+D.slice(E);break;default:e=D+n+e+r;break}return a(e)}k.toString=function(){return e+""};return k}function f(e,t){var n=l((e=Oo(e),e.type="f",e)),r=Math.max(-8,Math.min(8,Math.floor(So(t)/3)))*3,i=Math.pow(10,-r),a=Io[8+r/3];return function(e){return n(i*e)+a}}return{format:l,formatPrefix:f}}var qo;var Wo;var Ho;Go({thousands:",",grouping:[3],currency:["$",""]});function Go(e){qo=Uo(e);Wo=qo.format;Ho=qo.formatPrefix;return qo}function $o(e){return Math.max(0,-So(Math.abs(e)))}function Vo(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(So(t)/3)))*3-So(Math.abs(e)))}function Yo(e,t){e=Math.abs(e),t=Math.abs(t)-e;return Math.max(0,So(t)-So(e))+1}var Xo=new Date,Jo=new Date;function Qo(e,t,n,r){function i(t){return e(t=arguments.length===0?new Date:new Date(+t)),t}i.floor=function(t){return e(t=new Date(+t)),t};i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n};i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n};i.offset=function(e,n){return t(e=new Date(+e),n==null?1:Math.floor(n)),e};i.range=function(n,r,a){var o=[],u;n=i.ceil(n);a=a==null?1:Math.floor(a);if(!(n<r)||!(a>0))return o;do{o.push(u=new Date(+n)),t(n,a),e(n)}while(u<n&&n<r);return o};i.filter=function(n){return Qo((function(t){if(t>=t)while(e(t),!n(t))t.setTime(t-1)}),(function(e,r){if(e>=e){if(r<0)while(++r<=0){while(t(e,-1),!n(e)){}}else while(--r>=0){while(t(e,+1),!n(e)){}}}}))};if(n){i.count=function(t,r){Xo.setTime(+t),Jo.setTime(+r);e(Xo),e(Jo);return Math.floor(n(Xo,Jo))};i.every=function(e){e=Math.floor(e);return!isFinite(e)||!(e>0)?null:!(e>1)?i:i.filter(r?function(t){return r(t)%e===0}:function(t){return i.count(0,t)%e===0})}}return i}var Zo=Qo((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));Zo.every=function(e){e=Math.floor(e);if(!isFinite(e)||!(e>0))return null;if(!(e>1))return Zo;return Qo((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e}))};var Ko=1e3;var eu=Ko*60;var tu=eu*60;var nu=tu*24;var ru=nu*7;var iu=nu*30;var au=nu*365;var ou=Qo((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*Ko)}),(function(e,t){return(t-e)/Ko}),(function(e){return e.getUTCSeconds()}));var uu=Qo((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ko)}),(function(e,t){e.setTime(+e+t*eu)}),(function(e,t){return(t-e)/eu}),(function(e){return e.getMinutes()}));var su=Qo((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ko-e.getMinutes()*eu)}),(function(e,t){e.setTime(+e+t*tu)}),(function(e,t){return(t-e)/tu}),(function(e){return e.getHours()}));var lu=Qo((function(e){return e.setHours(0,0,0,0)}),(function(e,t){return e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*eu)/nu}),(function(e){return e.getDate()-1}));function fu(e){return Qo((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7);t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t*7)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*eu)/ru}))}var cu=fu(0);var du=fu(1);fu(2);fu(3);var hu=fu(4);fu(5);fu(6);var vu=Qo((function(e){e.setDate(1);e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12}),(function(e){return e.getMonth()}));var pu=Qo((function(e){e.setMonth(0,1);e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));pu.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Qo((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e);t.setMonth(0,1);t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)}))};var gu=Qo((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*eu)}),(function(e,t){return(t-e)/eu}),(function(e){return e.getUTCMinutes()}));var mu=Qo((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*tu)}),(function(e,t){return(t-e)/tu}),(function(e){return e.getUTCHours()}));var yu=Qo((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/nu}),(function(e){return e.getUTCDate()-1}));function _u(e){return Qo((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7);t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t*7)}),(function(e,t){return(t-e)/ru}))}var bu=_u(0);var xu=_u(1);_u(2);_u(3);var wu=_u(4);_u(5);_u(6);var ku=Qo((function(e){e.setUTCDate(1);e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12}),(function(e){return e.getUTCMonth()}));var Au=Qo((function(e){e.setUTCMonth(0,1);e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));Au.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Qo((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e);t.setUTCMonth(0,1);t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)}))};function Eu(e,t,n,r,i,a){var o=[[ou,1,Ko],[ou,5,5*Ko],[ou,15,15*Ko],[ou,30,30*Ko],[a,1,eu],[a,5,5*eu],[a,15,15*eu],[a,30,30*eu],[i,1,tu],[i,3,3*tu],[i,6,6*tu],[i,12,12*tu],[r,1,nu],[r,2,2*nu],[n,1,ru],[t,1,iu],[t,3,3*iu],[e,1,au]];function u(e,t,n){var r;var i=t<e;if(i)r=[t,e],e=r[0],t=r[1];var a=n&&typeof n.range==="function"?n:s(e,t,n);var o=a?a.range(e,+t+1):[];return i?o.reverse():o}function s(t,n,r){var i=Math.abs(n-t)/r;var a=Xa((function(e){var t=e[2];return t})).right(o,i);if(a===o.length)return e.every(co(t/au,n/au,r));if(a===0)return Zo.every(Math.max(co(t,n,r),1));var u=o[i/o[a-1][2]<o[a][2]/i?a-1:a],s=u[0],l=u[1];return s.every(l)}return[u,s]}var Du=Eu(Au,ku,bu,yu,mu,gu),Su=Du[0],Cu=Du[1];var Mu=Eu(pu,vu,cu,lu,su,uu),Fu=Mu[0],Ou=Mu[1];var Nu="year";var Tu="quarter";var zu="month";var Ru="week";var Pu="date";var Lu="day";var ju="dayofyear";var Bu="hours";var Iu="minutes";var Uu="seconds";var qu="milliseconds";var Wu=[Nu,Tu,zu,Ru,Pu,Lu,ju,Bu,Iu,Uu,qu];var Hu=Wu.reduce((function(e,t,n){return e[t]=1+n,e}),{});function Gu(e){var t=oi(e).slice(),n={};if(!t.length)_r("Missing time unit.");t.forEach((function(e){if(xi(Hu,e)){n[e]=1}else{_r("Invalid time unit: ".concat(e,"."))}}));var r=(n[Ru]||n[Lu]?1:0)+(n[Tu]||n[zu]||n[Pu]?1:0)+(n[ju]?1:0);if(r>1){_r("Incompatible time units: ".concat(e))}t.sort((function(e,t){return Hu[e]-Hu[t]}));return t}var $u=(c={},c[Nu]="%Y ",c[Tu]="Q%q ",c[zu]="%b ",c[Pu]="%d ",c[Ru]="W%U ",c[Lu]="%a ",c[ju]="%j ",c[Bu]="%H:00",c[Iu]="00:%M",c[Uu]=":%S",c[qu]=".%L",c["".concat(Nu,"-").concat(zu)]="%Y-%m ",c["".concat(Nu,"-").concat(zu,"-").concat(Pu)]="%Y-%m-%d ",c["".concat(Bu,"-").concat(Iu)]="%H:%M",c);function Vu(e,t){var n=mi({},$u,t),r=Gu(e),i=r.length;var a="",o=0,u,s;for(o=0;o<i;){for(u=r.length;u>o;--u){s=r.slice(o,u).join("-");if(n[s]!=null){a+=n[s];o=u;break}}}return a.trim()}var Yu=new Date;function Xu(e){Yu.setFullYear(e);Yu.setMonth(0);Yu.setDate(1);Yu.setHours(0,0,0,0);return Yu}function Ju(e){return Zu(new Date(e))}function Qu(e){return Ku(new Date(e))}function Zu(e){return lu.count(Xu(e.getFullYear())-1,e)}function Ku(e){return cu.count(Xu(e.getFullYear())-1,e)}function es(e){return Xu(e).getDay()}function ts(e,t,n,r,i,a,o){if(0<=e&&e<100){var u=new Date(-1,t,n,r,i,a,o);u.setFullYear(e);return u}return new Date(e,t,n,r,i,a,o)}function ns(e){return is(new Date(e))}function rs(e){return as(new Date(e))}function is(e){var t=Date.UTC(e.getUTCFullYear(),0,1);return yu.count(t-1,e)}function as(e){var t=Date.UTC(e.getUTCFullYear(),0,1);return bu.count(t-1,e)}function os(e){Yu.setTime(Date.UTC(e,0,1));return Yu.getUTCDay()}function us(e,t,n,r,i,a,o){if(0<=e&&e<100){var u=new Date(Date.UTC(-1,t,n,r,i,a,o));u.setUTCFullYear(n.y);return u}return new Date(Date.UTC(e,t,n,r,i,a,o))}function ss(e,t,n,r,i){var a=t||1,o=Ur(e),u=function(e,t,i){i=i||e;return ls(n[i],r[i],e===o&&a,t)};var s=new Date,l=$i(e),f=l[Nu]?u(Nu):pi(2012),c=l[zu]?u(zu):l[Tu]?u(Tu):Ar,d=l[Ru]&&l[Lu]?u(Lu,1,Ru+Lu):l[Ru]?u(Ru,1):l[Lu]?u(Lu,1):l[Pu]?u(Pu,1):l[ju]?u(ju,1):Er,h=l[Bu]?u(Bu):Ar,v=l[Iu]?u(Iu):Ar,p=l[Uu]?u(Uu):Ar,g=l[qu]?u(qu):Ar;return function(e){s.setTime(+e);var t=f(s);return i(t,c(s),d(s,t),h(s),v(s),p(s),g(s))}}function ls(e,t,n,r){var i=n<=1?e:r?function(t,i){return r+n*Math.floor((e(t,i)-r)/n)}:function(t,r){return n*Math.floor(e(t,r)/n)};return t?function(e,n){return t(i(e,n),n)}:i}function fs(e,t,n){return t+e*7-(n+6)%7}var cs=(d={},d[Nu]=function(e){return e.getFullYear()},d[Tu]=function(e){return Math.floor(e.getMonth()/3)},d[zu]=function(e){return e.getMonth()},d[Pu]=function(e){return e.getDate()},d[Bu]=function(e){return e.getHours()},d[Iu]=function(e){return e.getMinutes()},d[Uu]=function(e){return e.getSeconds()},d[qu]=function(e){return e.getMilliseconds()},d[ju]=function(e){return Zu(e)},d[Ru]=function(e){return Ku(e)},d[Ru+Lu]=function(e,t){return fs(Ku(e),e.getDay(),es(t))},d[Lu]=function(e,t){return fs(1,e.getDay(),es(t))},d);var ds=(h={},h[Tu]=function(e){return 3*e},h[Ru]=function(e,t){return fs(e,0,es(t))},h);function hs(e,t){return ss(e,t||1,cs,ds,ts)}var vs=(v={},v[Nu]=function(e){return e.getUTCFullYear()},v[Tu]=function(e){return Math.floor(e.getUTCMonth()/3)},v[zu]=function(e){return e.getUTCMonth()},v[Pu]=function(e){return e.getUTCDate()},v[Bu]=function(e){return e.getUTCHours()},v[Iu]=function(e){return e.getUTCMinutes()},v[Uu]=function(e){return e.getUTCSeconds()},v[qu]=function(e){return e.getUTCMilliseconds()},v[ju]=function(e){return is(e)},v[Ru]=function(e){return as(e)},v[Lu]=function(e,t){return fs(1,e.getUTCDay(),os(t))},v[Ru+Lu]=function(e,t){return fs(as(e),e.getUTCDay(),os(t))},v);var ps=(p={},p[Tu]=function(e){return 3*e},p[Ru]=function(e,t){return fs(e,0,os(t))},p);function gs(e,t){return ss(e,t||1,vs,ps,us)}var ms=(g={},g[Nu]=pu,g[Tu]=vu.every(3),g[zu]=vu,g[Ru]=cu,g[Pu]=lu,g[Lu]=lu,g[ju]=lu,g[Bu]=su,g[Iu]=uu,g[Uu]=ou,g[qu]=Zo,g);var ys=(m={},m[Nu]=Au,m[Tu]=ku.every(3),m[zu]=ku,m[Ru]=bu,m[Pu]=yu,m[Lu]=yu,m[ju]=yu,m[Bu]=mu,m[Iu]=gu,m[Uu]=ou,m[qu]=Zo,m);function _s(e){return ms[e]}function bs(e){return ys[e]}function xs(e,t,n){return e?e.offset(t,n):undefined}function ws(e,t,n){return xs(_s(e),t,n)}function ks(e,t,n){return xs(bs(e),t,n)}function As(e,t,n,r){return e?e.range(t,n,r):undefined}function Es(e,t,n,r){return As(_s(e),t,n,r)}function Ds(e,t,n,r){return As(bs(e),t,n,r)}var Ss=1e3,Cs=Ss*60,Ms=Cs*60,Fs=Ms*24,Os=Fs*7,Ns=Fs*30,Ts=Fs*365;var zs=[Nu,zu,Pu,Bu,Iu,Uu,qu],Rs=zs.slice(0,-1),Ps=Rs.slice(0,-1),Ls=Ps.slice(0,-1),js=Ls.slice(0,-1),Bs=[Nu,Ru],Is=[Nu,zu],Us=[Nu];var qs=[[Rs,1,Ss],[Rs,5,5*Ss],[Rs,15,15*Ss],[Rs,30,30*Ss],[Ps,1,Cs],[Ps,5,5*Cs],[Ps,15,15*Cs],[Ps,30,30*Cs],[Ls,1,Ms],[Ls,3,3*Ms],[Ls,6,6*Ms],[Ls,12,12*Ms],[js,1,Fs],[Bs,1,Os],[Is,1,Ns],[Is,3,3*Ns],[Us,1,Ts]];function Ws(e){var t=e.extent,n=e.maxbins||40,r=Math.abs(Ii(t))/n;var i=Xa((function(e){return e[2]})).right(qs,r),a,o;if(i===qs.length){a=Us,o=co(t[0]/Ts,t[1]/Ts,n)}else if(i){i=qs[r/qs[i-1][2]<qs[i][2]/r?i-1:i];a=i[0];o=i[1]}else{a=zs;o=Math.max(co(t[0],t[1],n),1)}return{units:a,step:o}}function Hs(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);t.setFullYear(e.y);return t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Gs(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));t.setUTCFullYear(e.y);return t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function $s(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function Vs(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,u=e.months,s=e.shortMonths;var l=el(i),f=tl(i),c=el(a),d=tl(a),h=el(o),v=tl(o),p=el(u),g=tl(u),m=el(s),y=tl(s);var _={a:T,A:z,b:R,B:P,c:null,d:wl,e:wl,f:Sl,g:jl,G:Il,H:kl,I:Al,j:El,L:Dl,m:Cl,M:Ml,p:L,q:j,Q:ff,s:cf,S:Fl,u:Ol,U:Nl,V:zl,w:Rl,W:Pl,x:null,X:null,y:Ll,Y:Bl,Z:Ul,"%":lf};var b={a:B,A:I,b:U,B:q,c:null,d:ql,e:ql,f:Vl,g:af,G:uf,H:Wl,I:Hl,j:Gl,L:$l,m:Yl,M:Xl,p:W,q:H,Q:ff,s:cf,S:Jl,u:Ql,U:Zl,V:ef,w:tf,W:nf,x:null,X:null,y:rf,Y:of,Z:sf,"%":lf};var x={a:D,A:S,b:C,B:M,c:F,d:dl,e:dl,f:yl,g:sl,G:ul,H:vl,I:vl,j:hl,L:ml,m:cl,M:pl,p:E,q:fl,Q:bl,s:xl,S:gl,u:rl,U:il,V:al,w:nl,W:ol,x:O,X:N,y:sl,Y:ul,Z:ll,"%":_l};_.x=w(n,_);_.X=w(r,_);_.c=w(t,_);b.x=w(n,b);b.X=w(r,b);b.c=w(t,b);function w(e,t){return function(n){var r=[],i=-1,a=0,o=e.length,u,s,l;if(!(n instanceof Date))n=new Date(+n);while(++i<o){if(e.charCodeAt(i)===37){r.push(e.slice(a,i));if((s=Ys[u=e.charAt(++i)])!=null)u=e.charAt(++i);else s=u==="e"?" ":"0";if(l=t[u])u=l(n,s);r.push(u);a=i+1}}r.push(e.slice(a,i));return r.join("")}}function k(e,t){return function(n){var r=$s(1900,undefined,1),i=A(r,e,n+="",0),a,o;if(i!=n.length)return null;if("Q"in r)return new Date(r.Q);if("s"in r)return new Date(r.s*1e3+("L"in r?r.L:0));if(t&&!("Z"in r))r.Z=0;if("p"in r)r.H=r.H%12+r.p*12;if(r.m===undefined)r.m="q"in r?r.q:0;if("V"in r){if(r.V<1||r.V>53)return null;if(!("w"in r))r.w=1;if("Z"in r){a=Gs($s(r.y,0,1)),o=a.getUTCDay();a=o>4||o===0?xu.ceil(a):xu(a);a=yu.offset(a,(r.V-1)*7);r.y=a.getUTCFullYear();r.m=a.getUTCMonth();r.d=a.getUTCDate()+(r.w+6)%7}else{a=Hs($s(r.y,0,1)),o=a.getDay();a=o>4||o===0?du.ceil(a):du(a);a=lu.offset(a,(r.V-1)*7);r.y=a.getFullYear();r.m=a.getMonth();r.d=a.getDate()+(r.w+6)%7}}else if("W"in r||"U"in r){if(!("w"in r))r.w="u"in r?r.u%7:"W"in r?1:0;o="Z"in r?Gs($s(r.y,0,1)).getUTCDay():Hs($s(r.y,0,1)).getDay();r.m=0;r.d="W"in r?(r.w+6)%7+r.W*7-(o+5)%7:r.w+r.U*7-(o+6)%7}if("Z"in r){r.H+=r.Z/100|0;r.M+=r.Z%100;return Gs(r)}return Hs(r)}}function A(e,t,n,r){var i=0,a=t.length,o=n.length,u,s;while(i<a){if(r>=o)return-1;u=t.charCodeAt(i++);if(u===37){u=t.charAt(i++);s=x[u in Ys?t.charAt(i++):u];if(!s||(r=s(e,n,r))<0)return-1}else if(u!=n.charCodeAt(r++)){return-1}}return r}function E(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=f.get(r[0].toLowerCase()),n+r[0].length):-1}function D(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=v.get(r[0].toLowerCase()),n+r[0].length):-1}function S(e,t,n){var r=c.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1}function C(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1}function M(e,t,n){var r=p.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1}function F(e,n,r){return A(e,t,n,r)}function O(e,t,r){return A(e,n,t,r)}function N(e,t,n){return A(e,r,t,n)}function T(e){return o[e.getDay()]}function z(e){return a[e.getDay()]}function R(e){return s[e.getMonth()]}function P(e){return u[e.getMonth()]}function L(e){return i[+(e.getHours()>=12)]}function j(e){return 1+~~(e.getMonth()/3)}function B(e){return o[e.getUTCDay()]}function I(e){return a[e.getUTCDay()]}function U(e){return s[e.getUTCMonth()]}function q(e){return u[e.getUTCMonth()]}function W(e){return i[+(e.getUTCHours()>=12)]}function H(e){return 1+~~(e.getUTCMonth()/3)}return{format:function(e){var t=w(e+="",_);t.toString=function(){return e};return t},parse:function(e){var t=k(e+="",false);t.toString=function(){return e};return t},utcFormat:function(e){var t=w(e+="",b);t.toString=function(){return e};return t},utcParse:function(e){var t=k(e+="",true);t.toString=function(){return e};return t}}}var Ys={"-":"",_:" ",0:"0"},Xs=/^\s*\d+/,Js=/^%/,Qs=/[\\^$*+?|[\]().{}]/g;function Zs(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function Ks(e){return e.replace(Qs,"\\$&")}function el(e){return new RegExp("^(?:"+e.map(Ks).join("|")+")","i")}function tl(e){return new Map(e.map((function(e,t){return[e.toLowerCase(),t]})))}function nl(e,t,n){var r=Xs.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function rl(e,t,n){var r=Xs.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function il(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function al(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function ol(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function ul(e,t,n){var r=Xs.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function sl(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function ll(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function fl(e,t,n){var r=Xs.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function cl(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function dl(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function hl(e,t,n){var r=Xs.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function vl(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function pl(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function gl(e,t,n){var r=Xs.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function ml(e,t,n){var r=Xs.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function yl(e,t,n){var r=Xs.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function _l(e,t,n){var r=Js.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function bl(e,t,n){var r=Xs.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function xl(e,t,n){var r=Xs.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function wl(e,t){return Zs(e.getDate(),t,2)}function kl(e,t){return Zs(e.getHours(),t,2)}function Al(e,t){return Zs(e.getHours()%12||12,t,2)}function El(e,t){return Zs(1+lu.count(pu(e),e),t,3)}function Dl(e,t){return Zs(e.getMilliseconds(),t,3)}function Sl(e,t){return Dl(e,t)+"000"}function Cl(e,t){return Zs(e.getMonth()+1,t,2)}function Ml(e,t){return Zs(e.getMinutes(),t,2)}function Fl(e,t){return Zs(e.getSeconds(),t,2)}function Ol(e){var t=e.getDay();return t===0?7:t}function Nl(e,t){return Zs(cu.count(pu(e)-1,e),t,2)}function Tl(e){var t=e.getDay();return t>=4||t===0?hu(e):hu.ceil(e)}function zl(e,t){e=Tl(e);return Zs(hu.count(pu(e),e)+(pu(e).getDay()===4),t,2)}function Rl(e){return e.getDay()}function Pl(e,t){return Zs(du.count(pu(e)-1,e),t,2)}function Ll(e,t){return Zs(e.getFullYear()%100,t,2)}function jl(e,t){e=Tl(e);return Zs(e.getFullYear()%100,t,2)}function Bl(e,t){return Zs(e.getFullYear()%1e4,t,4)}function Il(e,t){var n=e.getDay();e=n>=4||n===0?hu(e):hu.ceil(e);return Zs(e.getFullYear()%1e4,t,4)}function Ul(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Zs(t/60|0,"0",2)+Zs(t%60,"0",2)}function ql(e,t){return Zs(e.getUTCDate(),t,2)}function Wl(e,t){return Zs(e.getUTCHours(),t,2)}function Hl(e,t){return Zs(e.getUTCHours()%12||12,t,2)}function Gl(e,t){return Zs(1+yu.count(Au(e),e),t,3)}function $l(e,t){return Zs(e.getUTCMilliseconds(),t,3)}function Vl(e,t){return $l(e,t)+"000"}function Yl(e,t){return Zs(e.getUTCMonth()+1,t,2)}function Xl(e,t){return Zs(e.getUTCMinutes(),t,2)}function Jl(e,t){return Zs(e.getUTCSeconds(),t,2)}function Ql(e){var t=e.getUTCDay();return t===0?7:t}function Zl(e,t){return Zs(bu.count(Au(e)-1,e),t,2)}function Kl(e){var t=e.getUTCDay();return t>=4||t===0?wu(e):wu.ceil(e)}function ef(e,t){e=Kl(e);return Zs(wu.count(Au(e),e)+(Au(e).getUTCDay()===4),t,2)}function tf(e){return e.getUTCDay()}function nf(e,t){return Zs(xu.count(Au(e)-1,e),t,2)}function rf(e,t){return Zs(e.getUTCFullYear()%100,t,2)}function af(e,t){e=Kl(e);return Zs(e.getUTCFullYear()%100,t,2)}function of(e,t){return Zs(e.getUTCFullYear()%1e4,t,4)}function uf(e,t){var n=e.getUTCDay();e=n>=4||n===0?wu(e):wu.ceil(e);return Zs(e.getUTCFullYear()%1e4,t,4)}function sf(){return"+0000"}function lf(){return"%"}function ff(e){return+e}function cf(e){return Math.floor(+e/1e3)}var df;var hf;var vf;var pf;var gf;mf({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function mf(e){df=Vs(e);hf=df.format;vf=df.parse;pf=df.utcFormat;gf=df.utcParse;return df}function yf(e){var t={};return function(n){return t[n]||(t[n]=e(n))}}function _f(e,t){return function(n){var r=e(n),i=r.indexOf(t);if(i<0)return r;var a=bf(r,i);var o=a<r.length?r.slice(a):"";while(--a>i)if(r[a]!=="0"){++a;break}return r.slice(0,a)+o}}function bf(e,t){var n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;){r=e.charCodeAt(n);if(r>=48&&r<=57)return n+1}}function xf(e){var t=yf(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat:function(e){var n=Oo(e||",");if(n.precision==null){n.precision=12;switch(n.type){case"%":n.precision-=2;break;case"e":n.precision-=1;break}return _f(t(n),t(".1f")(1)[1])}else{return t(n)}},formatSpan:function(e,r,i,a){a=Oo(a==null?",f":a);var o=co(e,r,i),u=Math.max(Math.abs(e),Math.abs(r));var s;if(a.precision==null){switch(a.type){case"s":{if(!isNaN(s=Vo(o,u))){a.precision=s}return n(a,u)}case"":case"e":case"g":case"p":case"r":{if(!isNaN(s=Yo(o,u))){a.precision=s-(a.type==="e")}break}case"f":case"%":{if(!isNaN(s=$o(o))){a.precision=s-(a.type==="%")*2}break}}}return t(a)}}}var wf;kf();function kf(){return wf=xf({format:Wo,formatPrefix:Ho})}function Af(e){return xf(Uo(e))}function Ef(e){return arguments.length?wf=Af(e):wf}function Df(e,t,n){n=n||{};if(!Pr(n)){_r("Invalid time multi-format specifier: ".concat(n))}var r=t(Uu),i=t(Iu),a=t(Bu),o=t(Pu),u=t(Ru),s=t(zu),l=t(Tu),f=t(Nu),c=e(n[qu]||".%L"),d=e(n[Uu]||":%S"),h=e(n[Iu]||"%I:%M"),v=e(n[Bu]||"%I %p"),p=e(n[Pu]||n[Lu]||"%a %d"),g=e(n[Ru]||"%b %d"),m=e(n[zu]||"%B"),y=e(n[Tu]||"%B"),_=e(n[Nu]||"%Y");return function(e){return(r(e)<e?c:i(e)<e?d:a(e)<e?h:o(e)<e?v:s(e)<e?u(e)<e?p:g:f(e)<e?l(e)<e?m:y:_)(e)}}function Sf(e){var t=yf(e.format),n=yf(e.utcFormat);return{timeFormat:function(e){return Ni(e)?t(e):Df(t,_s,e)},utcFormat:function(e){return Ni(e)?n(e):Df(n,bs,e)},timeParse:yf(e.parse),utcParse:yf(e.utcParse)}}var Cf;Mf();function Mf(){return Cf=Sf({format:hf,parse:vf,utcFormat:pf,utcParse:gf})}function Ff(e){return Sf(Vs(e))}function Of(e){return arguments.length?Cf=Ff(e):Cf}var Nf=function(e,t){return mi({},e,t)};function Tf(e,t){var n=e?Af(e):Ef();var r=t?Ff(t):Of();return Nf(n,r)}function zf(e,t){var n=arguments.length;if(n&&n!==2){_r("defaultLocale expects either zero or two arguments.")}return n?Nf(Ef(e),Of(t)):Nf(Ef(),Of())}function Rf(){kf();Mf();return zf()}function Pf(e,t,n,r){t=t||{};var i=$a(t.type||"json");if(!i)_r("Unknown data format type: "+t.type);e=i(e,t);if(t.parse)Lf(e,t.parse,n,r);if(xi(e,"columns"))delete e.columns;return e}function Lf(e,t,n,r){if(!e.length)return;var i=Of();n=n||i.timeParse;r=r||i.utcParse;var a=e.columns||Object.keys(e[0]),o,u,s,l,f,c;if(t==="auto")t=pa(e,a);a=Object.keys(t);var d=a.map((function(e){var i=t[e];var a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:"))){a=i.split(/:(.+)?/,2);o=a[1];if(o[0]==="'"&&o[o.length-1]==="'"||o[0]==='"'&&o[o.length-1]==='"'){o=o.slice(1,-1)}var u=a[0]==="utc"?r:n;return u(o)}if(!ca[i]){throw Error("Illegal format pattern: "+e+":"+i)}return ca[i]}));for(s=0,f=e.length,c=a.length;s<f;++s){o=e[s];for(l=0;l<c;++l){u=a[l];o[u]=d[l](o[u])}}}var jf=Ki(typeof fetch!=="undefined"&&fetch,null);function Bf(e){var t=e||kr,n=[],r={};n.add=function(e){var i=t(e);if(!r[i]){r[i]=1;n.push(e)}return n};n.remove=function(e){var i=t(e);if(r[i]){r[i]=0;var a=n.indexOf(e);if(a>=0)n.splice(a,1)}return n};return n}function If(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,t(e)];case 1:r.sent();return[3,3];case 2:n=r.sent();e.error(n);return[3,3];case 3:return[2]}}))}))}var Uf=Symbol("vega_id");var qf=1;function Wf(e){return!!(e&&Hf(e))}function Hf(e){return e[Uf]}function Gf(e,t){e[Uf]=t;return e}function $f(e){var t=e===Object(e)?e:{data:e};return Hf(t)?t:Gf(t,qf++)}function Vf(e){return Yf(e,$f({}))}function Yf(e,t){for(var n in e)t[n]=e[n];return t}function Xf(e,t){return Gf(t,Hf(e))}function Jf(e,t){return!e?null:t?function(n,r){return e(n,r)||Hf(t(n))-Hf(t(r))}:function(t,n){return e(t,n)||Hf(t)-Hf(n)}}function Qf(e){return e&&e.constructor===Zf}function Zf(){var e=[],t=[],n=[],r=[],i=[];var a=null,o=false;return{constructor:Zf,insert:function(t){var n=oi(t),r=n.length;for(var i=0;i<r;++i)e.push(n[i]);return this},remove:function(e){var n=si(e)?r:t,i=oi(e),a=i.length;for(var o=0;o<a;++o)n.push(i[o]);return this},modify:function(e,t,r){var a={field:t,value:pi(r)};if(si(e)){a.filter=e;i.push(a)}else{a.tuple=e;n.push(a)}return this},encode:function(e,t){if(si(e))i.push({filter:e,field:t});else n.push({tuple:e,field:t});return this},clean:function(e){a=e;return this},reflow:function(){o=true;return this},pulse:function(u,s){var l={},f={};var c,d,h,v,p,g;for(c=0,d=s.length;c<d;++c){l[Hf(s[c])]=1}for(c=0,d=t.length;c<d;++c){p=t[c];l[Hf(p)]=-1}for(c=0,d=r.length;c<d;++c){v=r[c];s.forEach((function(e){if(v(e))l[Hf(e)]=-1}))}for(c=0,d=e.length;c<d;++c){p=e[c];g=Hf(p);if(l[g]){l[g]=1}else{u.add.push($f(e[c]))}}for(c=0,d=s.length;c<d;++c){p=s[c];if(l[Hf(p)]<0)u.rem.push(p)}function m(e,t,n){if(n){e[t]=n(e)}else{u.encode=t}if(!o)f[Hf(e)]=e}for(c=0,d=n.length;c<d;++c){h=n[c];p=h.tuple;v=h.field;g=l[Hf(p)];if(g>0){m(p,v,h.value);u.modifies(v)}}for(c=0,d=i.length;c<d;++c){h=i[c];v=h.filter;s.forEach((function(e){if(v(e)&&l[Hf(e)]>0){m(e,h.field,h.value)}}));u.modifies(h.field)}if(o){u.mod=t.length||r.length?s.filter((function(e){return l[Hf(e)]>0})):s.slice()}else{for(g in f)u.mod.push(f[g])}if(a||a==null&&(t.length||r.length)){u.clean(true)}return u}}}var Kf="_:mod:_";function ec(){Object.defineProperty(this,Kf,{writable:true,value:{}})}ec.prototype={set:function(e,t,n,r){var i=this,a=i[e],o=i[Kf];if(t!=null&&t>=0){if(a[t]!==n||r){a[t]=n;o[t+":"+e]=-1;o[e]=-1}}else if(a!==n||r){i[e]=n;o[e]=Rr(n)?1+n.length:-1}return i},modified:function(e,t){var n=this[Kf];if(!arguments.length){for(var r in n){if(n[r])return true}return false}else if(Rr(e)){for(var r=0;r<e.length;++r){if(n[e[r]])return true}return false}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear:function(){this[Kf]={};return this}};var tc=0;var nc="pulse",rc=new ec;var ic=1,ac=2;function oc(e,t,n,r){this.id=++tc;this.value=e;this.stamp=-1;this.rank=-1;this.qrank=-1;this.flags=0;if(t){this._update=t}if(n)this.parameters(n,r)}function uc(e){return function(t){var n=this.flags;if(arguments.length===0)return!!(n&e);this.flags=t?n|e:n&~e;return this}}oc.prototype={targets:function(){return this._targets||(this._targets=Bf(wr))},set:function(e){if(this.value!==e){this.value=e;return 1}else{return 0}},skip:uc(ic),modified:uc(ac),parameters:function(e,t,n){var r=this;t=t!==false;var i=this._argval=this._argval||new ec,a=this._argops=this._argops||[],o=[];var u,s,l,f;var c=function(e,n,u){if(u instanceof oc){if(u!==r){if(t)u.targets().add(r);o.push(u)}a.push({op:u,name:e,index:n})}else{i.set(e,n,u)}};for(u in e){s=e[u];if(u===nc){oi(s).forEach((function(e){if(!(e instanceof oc)){_r("Pulse parameters must be operator instances.")}else if(e!==r){e.targets().add(r);o.push(e)}}));this.source=s}else if(Rr(s)){i.set(u,-1,Array(l=s.length));for(f=0;f<l;++f)c(u,f,s[f])}else{c(u,-1,s)}}this.marshall().clear();if(n)a.initonly=true;return o},marshall:function(e){var t=this._argval||rc,n=this._argops;var r,i,a,o;if(n){var u=n.length;for(i=0;i<u;++i){r=n[i];a=r.op;o=a.modified()&&a.stamp===e;t.set(r.name,r.index,a.value,o)}if(n.initonly){for(i=0;i<u;++i){r=n[i];r.op.targets().remove(this)}this._argops=null;this._update=null}}return t},detach:function(){var e=this._argops;var t,n,r,i;if(e){for(t=0,n=e.length;t<n;++t){r=e[t];i=r.op;if(i._targets){i._targets.remove(this)}}}this.pulse=null;this.source=null},evaluate:function(e){var t=this._update;if(t){var n=this.marshall(e.stamp),r=t.call(this,n,e);n.clear();if(r!==this.value){this.value=r}else if(!this.modified()){return e.StopPropagation}}},run:function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;if(this.skip()){this.skip(false);t=0}else{t=this.evaluate(e)}return this.pulse=t||e}};function sc(e,t,n,r){var i=1,a;if(e instanceof oc){a=e}else if(e&&e.prototype instanceof oc){a=new e}else if(si(e)){a=new oc(null,e)}else{i=0;a=new oc(e,t)}this.rank(a);if(i){r=n;n=t}if(n)this.connect(a,a.parameters(n,r));this.touch(a);return a}function lc(e,t){var n=e.rank,r=t.length;for(var i=0;i<r;++i){if(n<t[i].rank){this.rerank(e);return}}}var fc=0;function cc(e,t,n){this.id=++fc;this.value=null;if(n)this.receive=n;if(e)this._filter=e;if(t)this._apply=t}function dc(e,t,n){return new cc(e,t,n)}cc.prototype={_filter:Dr,_apply:kr,targets:function(){return this._targets||(this._targets=Bf(wr))},consume:function(e){if(!arguments.length)return!!this._consume;this._consume=!!e;return this},receive:function(e){if(this._filter(e)){var t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(var i=0;i<r;++i)n[i].receive(t);if(this._consume){e.preventDefault();e.stopPropagation()}}},filter:function(e){var t=dc(e);this.targets().add(t);return t},apply:function(e){var t=dc(null,e);this.targets().add(t);return t},merge:function(){var e=dc();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t){arguments[t].targets().add(e)}return e},throttle:function(e){var t=-1;return this.filter((function(){var n=Date.now();if(n-t>e){t=n;return 1}else{return 0}}))},debounce:function(e){var t=dc();this.targets().add(dc(null,null,gi(e,(function(e){var n=e.dataflow;t.receive(e);if(n&&n.run)n.run()}))));return t},between:function(e,t){var n=false;e.targets().add(dc(null,null,(function(){return n=true})));t.targets().add(dc(null,null,(function(){return n=false})));return this.filter((function(){return n}))},detach:function(){this._filter=Dr;this._targets=null}};function hc(e,t,n,r){var i=this,a=dc(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(_r){i.error(_r)}finally{i.run()}};var u;if(typeof e==="string"&&typeof document!=="undefined"){u=document.querySelectorAll(e)}else{u=oi(e)}var s=u.length;for(var l=0;l<s;++l){u[l].addEventListener(t,o)}return a}function vc(e,t){var n=this.locale();return Pf(e,t,n.timeParse,n.utcParse)}function pc(e,t,n){t=this.parse(t,n);return this.pulse(e,this.changeset().insert(t))}function gc(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i,a;return __generator(this,(function(o){switch(o.label){case 0:n=this;r=0;o.label=1;case 1:o.trys.push([1,3,,4]);return[4,n.loader().load(e,{context:"dataflow",response:Va(t&&t.type)})];case 2:i=o.sent();try{i=n.parse(i,t)}catch(u){r=-2;n.warn("Data ingestion failed",e,u)}return[3,4];case 3:a=o.sent();r=-1;n.warn("Loading failed",e,a);return[3,4];case 4:return[2,{data:i,status:r}]}}))}))}function mc(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,a;return __generator(this,(function(o){switch(o.label){case 0:r=this,i=r._pending||yc(r);i.requests+=1;return[4,r.request(t,n)];case 1:a=o.sent();r.pulse(e,r.changeset().remove(Dr).insert(a.data||[]));i.done();return[2,a]}}))}))}function yc(e){var t;var n=new Promise((function(e){return t=e}));n.requests=0;n.done=function(){if(--n.requests===0){e._pending=null;t(e)}};return e._pending=n}var _c={skip:true};function bc(e,t,n,r,i){var a=e instanceof oc?wc:xc;a(this,e,t,n,r,i);return this}function xc(e,t,n,r,i,a){var o=mi({},a,_c);var u,s;if(!si(n))n=pi(n);if(r===undefined){u=function(t){return e.touch(n(t))}}else if(si(r)){s=new oc(null,r,i,false);u=function(t){s.evaluate(t);var r=n(t),i=s.value;Qf(i)?e.pulse(r,i,a):e.update(r,i,o)}}else{u=function(t){return e.update(n(t),r,o)}}t.apply(u)}function wc(e,t,n,r,i,a){if(r===undefined){t.targets().add(n)}else{var o=a||{},u=new oc(null,kc(n,r),i,false);u.modified(o.force);u.rank=t.rank;t.targets().add(u);if(n){u.skip(true);u.value=n.value;u.targets().add(n);e.connect(n,[u])}}}function kc(e,t){t=si(t)?t:pi(t);return e?function(n,r){var i=t(n,r);if(!e.skip()){e.skip(i!==this.value).value=i}return i}:t}function Ac(e){e.rank=++this._rank}function Ec(e){var t=[e];var n,r,i;while(t.length){this.rank(n=t.pop());if(r=n._targets){for(i=r.length;--i>=0;){t.push(n=r[i]);if(n===e)_r("Cycle detected in dataflow graph.")}}}}var Dc={};var Sc=1<<0,Cc=1<<1,Mc=1<<2,Fc=Sc|Cc,Oc=Sc|Mc,Nc=Sc|Cc|Mc,Tc=1<<3,zc=1<<4,Rc=1<<5,Pc=1<<6;function Lc(e,t,n){this.dataflow=e;this.stamp=t==null?-1:t;this.add=[];this.rem=[];this.mod=[];this.fields=null;this.encode=n||null}function jc(e,t){var n=[];Yi(e,t,(function(e){return n.push(e)}));return n}function Bc(e,t){var n={};e.visit(t,(function(e){n[Hf(e)]=1}));return function(e){return n[Hf(e)]?null:e}}function Ic(e,t){return e?function(n,r){return e(n,r)&&t(n,r)}:t}Lc.prototype={StopPropagation:Dc,ADD:Sc,REM:Cc,MOD:Mc,ADD_REM:Fc,ADD_MOD:Oc,ALL:Nc,REFLOW:Tc,SOURCE:zc,NO_SOURCE:Rc,NO_FIELDS:Pc,fork:function(e){return new Lc(this.dataflow).init(this,e)},clone:function(){var e=this.fork(Nc);e.add=e.add.slice();e.rem=e.rem.slice();e.mod=e.mod.slice();if(e.source)e.source=e.source.slice();return e.materialize(Nc|zc)},addAll:function(){var e=this;var t=!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length;if(t){return e}else{e=new Lc(this.dataflow).init(this);e.add=e.source;e.rem=[];return e}},init:function(e,t){var n=this;n.stamp=e.stamp;n.encode=e.encode;if(e.fields&&!(t&Pc)){n.fields=e.fields}if(t&Sc){n.addF=e.addF;n.add=e.add}else{n.addF=null;n.add=[]}if(t&Cc){n.remF=e.remF;n.rem=e.rem}else{n.remF=null;n.rem=[]}if(t&Mc){n.modF=e.modF;n.mod=e.mod}else{n.modF=null;n.mod=[]}if(t&Rc){n.srcF=null;n.source=null}else{n.srcF=e.srcF;n.source=e.source;if(e.cleans)n.cleans=e.cleans}return n},runAfter:function(e){this.dataflow.runAfter(e)},changed:function(e){var t=e||Nc;return t&Sc&&this.add.length||t&Cc&&this.rem.length||t&Mc&&this.mod.length},reflow:function(e){if(e)return this.fork(Nc).reflow();var t=this.add.length,n=this.source&&this.source.length;if(n&&n!==t){this.mod=this.source;if(t)this.filter(Mc,Bc(this,Sc))}return this},clean:function(e){if(arguments.length){this.cleans=!!e;return this}else{return this.cleans}},modifies:function(e){var t=this.fields||(this.fields={});if(Rr(e)){e.forEach((function(e){return t[e]=true}))}else{t[e]=true}return this},modified:function(e,t){var n=this.fields;return!((t||this.mod.length)&&n)?false:!arguments.length?!!n:Rr(e)?e.some((function(e){return n[e]})):n[e]},filter:function(e,t){var n=this;if(e&Sc)n.addF=Ic(n.addF,t);if(e&Cc)n.remF=Ic(n.remF,t);if(e&Mc)n.modF=Ic(n.modF,t);if(e&zc)n.srcF=Ic(n.srcF,t);return n},materialize:function(e){e=e||Nc;var t=this;if(e&Sc&&t.addF){t.add=jc(t.add,t.addF);t.addF=null}if(e&Cc&&t.remF){t.rem=jc(t.rem,t.remF);t.remF=null}if(e&Mc&&t.modF){t.mod=jc(t.mod,t.modF);t.modF=null}if(e&zc&&t.srcF){t.source=t.source.filter(t.srcF);t.srcF=null}return t},visit:function(e,t){var n=this,r=t;if(e&zc){Yi(n.source,n.srcF,r);return n}if(e&Sc)Yi(n.add,n.addF,r);if(e&Cc)Yi(n.rem,n.remF,r);if(e&Mc)Yi(n.mod,n.modF,r);var i=n.source;if(e&Tc&&i){var a=n.add.length+n.mod.length;if(a===i.length);else if(a){Yi(i,Bc(n,Oc),r)}else{Yi(i,n.srcF,r)}}return n}};function Uc(e,t,n,r){var i=this,a=n.length;var o=0;this.dataflow=e;this.stamp=t;this.fields=null;this.encode=r||null;this.pulses=n;for(var u=0;u<a;++u){var s=n[u];if(s.stamp!==t)continue;if(s.fields){var l=i.fields||(i.fields={});for(var f in s.fields){l[f]=1}}if(s.changed(i.ADD))o|=i.ADD;if(s.changed(i.REM))o|=i.REM;if(s.changed(i.MOD))o|=i.MOD}this.changes=o}Ei(Uc,Lc,{fork:function(e){var t=new Lc(this.dataflow).init(this,e&this.NO_FIELDS);if(e!==undefined){if(e&t.ADD)this.visit(t.ADD,(function(e){return t.add.push(e)}));if(e&t.REM)this.visit(t.REM,(function(e){return t.rem.push(e)}));if(e&t.MOD)this.visit(t.MOD,(function(e){return t.mod.push(e)}))}return t},changed:function(e){return this.changes&e},modified:function(e){var t=this,n=t.fields;return!(n&&t.changes&t.MOD)?0:Rr(e)?e.some((function(e){return n[e]})):n[e]},filter:function(){_r("MultiPulse does not support filtering.")},materialize:function(){_r("MultiPulse does not support materialization.")},visit:function(e,t){var n=this,r=n.pulses,i=r.length;var a=0;if(e&n.SOURCE){for(;a<i;++a){r[a].visit(e,t)}}else{for(;a<i;++a){if(r[a].stamp===n.stamp){r[a].visit(e,t)}}}return n}});function qc(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,a,o,u,s,l,f,c,d;return __generator(this,(function(h){switch(h.label){case 0:r=this,i=[];if(r._pulse)return[2,$c(r)];if(!r._pending)return[3,2];return[4,r._pending];case 1:h.sent();h.label=2;case 2:if(!t)return[3,4];return[4,If(r,t)];case 3:h.sent();h.label=4;case 4:if(!r._touched.length){r.debug("Dataflow invoked, but nothing to do.");return[2,r]}a=++r._clock;r._pulse=new Lc(r,a,e);r._touched.forEach((function(e){return r._enqueue(e,true)}));r._touched=Bf(wr);o=0;h.label=5;case 5:h.trys.push([5,11,,12]);h.label=6;case 6:if(!(r._heap.size()>0))return[3,10];u=r._heap.pop();if(u.rank!==u.qrank){r._enqueue(u,true);return[3,6]}s=u.run(r._getPulse(u,e));if(!s.then)return[3,8];return[4,s];case 7:s=h.sent();return[3,9];case 8:if(s.async){i.push(s.async);s=Dc}h.label=9;case 9:if(s!==Dc){if(u._targets)u._targets.forEach((function(e){return r._enqueue(e)}))}++o;return[3,6];case 10:return[3,12];case 11:f=h.sent();r._heap.clear();l=f;return[3,12];case 12:r._input={};r._pulse=null;r.debug("Pulse "+a+": "+o+" operators");if(l){r._postrun=[];r.error(l)}if(!r._postrun.length)return[3,16];c=r._postrun.sort((function(e,t){return t.priority-e.priority}));r._postrun=[];d=0;h.label=13;case 13:if(!(d<c.length))return[3,16];return[4,If(r,c[d].callback)];case 14:h.sent();h.label=15;case 15:++d;return[3,13];case 16:if(!n)return[3,18];return[4,If(r,n)];case 17:h.sent();h.label=18;case 18:if(i.length){Promise.all(i).then((function(e){return r.runAsync(null,(function(){e.forEach((function(e){try{e(r)}catch(t){r.error(t)}}))}))}))}return[2,r]}}))}))}function Wc(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r;var i=this;return __generator(this,(function(a){switch(a.label){case 0:if(!this._running)return[3,2];return[4,this._running];case 1:a.sent();return[3,0];case 2:r=function(){return i._running=null};(this._running=this.evaluate(e,t,n)).then(r,r);return[2,this._running]}}))}))}function Hc(e,t,n){return this._pulse?$c(this):(this.evaluate(e,t,n),this)}function Gc(e,t,n){if(this._pulse||t){this._postrun.push({priority:n||0,callback:e})}else{try{e(this)}catch(r){this.error(r)}}}function $c(e){e.error("Dataflow already running. Use runAsync() to chain invocations.");return e}function Vc(e,t){var n=e.stamp<this._clock;if(n)e.stamp=this._clock;if(n||t){e.qrank=e.rank;this._heap.push(e)}}function Yc(e,t){var n=e.source,r=this._clock;return n&&Rr(n)?new Uc(this,r,n.map((function(e){return e.pulse})),t):this._input[e.id]||Xc(this._pulse,n&&n.pulse)}function Xc(e,t){if(t&&t.stamp===e.stamp){return t}e=e.fork();if(t&&t!==Dc){e.source=t.source}return e}var Jc={skip:false,force:false};function Qc(e,t){var n=t||Jc;if(this._pulse){this._enqueue(e)}else{this._touched.add(e)}if(n.skip)e.skip(true);return this}function Zc(e,t,n){var r=n||Jc;if(e.set(t)||r.force){this.touch(e,r)}return this}function Kc(e,t,n){this.touch(e,n||Jc);var r=new Lc(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];r.target=e;this._input[e.id]=t.pulse(r,i);return this}function ed(e){var t=[];return{clear:function(){return t=[]},size:function(){return t.length},peek:function(){return t[0]},push:function(n){t.push(n);return td(t,0,t.length-1,e)},pop:function(){var n=t.pop();var r;if(t.length){r=t[0];t[0]=n;nd(t,0,e)}else{r=n}return r}}}function td(e,t,n,r){var i,a;var o=e[n];while(n>t){a=n-1>>1;i=e[a];if(r(o,i)<0){e[n]=i;n=a;continue}break}return e[n]=o}function nd(e,t,n){var r=t,i=e.length,a=e[t];var o=(t<<1)+1,u;while(o<i){u=o+1;if(u<i&&n(e[o],e[u])>=0){o=u}e[t]=e[o];t=o;o=(t<<1)+1}e[t]=a;return td(e,r,t,n)}function rd(){this.logger(zr());this.logLevel(Fr);this._clock=0;this._rank=0;this._locale=zf();try{this._loader=jf()}catch(Afe){}this._touched=Bf(wr);this._input={};this._pulse=null;this._heap=ed((function(e,t){return e.qrank-t.qrank}));this._postrun=[]}function id(e){return function(){return this._log[e].apply(this,arguments)}}rd.prototype={stamp:function(){return this._clock},loader:function(e){if(arguments.length){this._loader=e;return this}else{return this._loader}},locale:function(e){if(arguments.length){this._locale=e;return this}else{return this._locale}},logger:function(e){if(arguments.length){this._log=e;return this}else{return this._log}},error:id("error"),warn:id("warn"),info:id("info"),debug:id("debug"),logLevel:id("level"),cleanThreshold:1e4,add:sc,connect:lc,rank:Ac,rerank:Ec,pulse:Kc,touch:Qc,update:Zc,changeset:Zf,ingest:pc,parse:vc,preload:mc,request:gc,events:hc,on:bc,evaluate:qc,run:Hc,runAsync:Wc,runAfter:Gc,_enqueue:Vc,_getPulse:Yc};function ad(e,t){oc.call(this,e,null,t)}Ei(ad,oc,{run:function(e){var t=this;if(e.stamp<this.stamp)return e.StopPropagation;var n;if(this.skip()){this.skip(false)}else{n=this.evaluate(e)}n=n||e;if(n.then){n=n.then((function(e){return t.pulse=e}))}else if(n!==e.StopPropagation){this.pulse=n}return n},evaluate:function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);t.clear();return n},transform:function(){}});var od={};function ud(e){var t=sd(e);return t&&t.Definition||null}function sd(e){e=e&&e.toLowerCase();return xi(od,e)?od[e]:null}function ld(e,t){var n,r,i,a,o,u,s;return __generator(this,(function(l){switch(l.label){case 0:if(!(t==null))return[3,5];n=0,r=e;l.label=1;case 1:if(!(n<r.length))return[3,4];i=r[n];if(!(i!=null&&i!==""&&(i=+i)>=i))return[3,3];return[4,i];case 2:l.sent();l.label=3;case 3:n++;return[3,1];case 4:return[3,9];case 5:a=-1;o=0,u=e;l.label=6;case 6:if(!(o<u.length))return[3,9];s=u[o];s=t(s,++a,e);if(!(s!=null&&s!==""&&(s=+s)>=s))return[3,8];return[4,s];case 7:l.sent();l.label=8;case 8:o++;return[3,6];case 9:return[2]}}))}function fd(e,t,n){var r=Float64Array.from(ld(e,n));r.sort(Ya);return t.map((function(e){return yo(r,e)}))}function cd(e,t){return fd(e,[.25,.5,.75],t)}function dd(e,t){var n=e.length,r=ro(e,t),i=cd(e,t),a=(i[2]-i[0])/1.34,o=Math.min(r,a)||r||Math.abs(i[0])||1;return 1.06*o*Math.pow(n,-.2)}function hd(e){var t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];var a=e.extent[0],o=e.extent[1],u,s,l,f,c,d;var h=e.span||o-a||Math.abs(a)||1;if(e.step){u=e.step}else if(e.steps){f=h/t;for(c=0,d=e.steps.length;c<d&&e.steps[c]<f;++c);u=e.steps[Math.max(0,c-1)]}else{s=Math.ceil(Math.log(t)/r);l=e.minstep||0;u=Math.max(l,Math.pow(n,Math.round(Math.log(h)/r)-s));while(Math.ceil(h/u)>t){u*=n}for(c=0,d=i.length;c<d;++c){f=u/i[c];if(f>=l&&h/f<=t)u=f}}f=Math.log(u);var v=f>=0?0:~~(-f/r)+1,p=Math.pow(n,-v-1);if(e.nice||e.nice===undefined){f=Math.floor(a/u+p)*u;a=a<f?f-u:f;o=Math.ceil(o/u)*u}return{start:a,stop:o===a?a+u:o,step:u}}var vd=Math.random;function pd(e){vd=e}function gd(e,t,n,r){if(!e.length)return[undefined,undefined];var i=Float64Array.from(ld(e,r)),a=i.length,o=t;var u,s,l,f;for(l=0,f=Array(o);l<o;++l){for(u=0,s=0;s<a;++s){u+=i[~~(vd()*a)]}f[l]=u/a}f.sort(Ya);return[mo(f,n/2),mo(f,1-n/2)]}function md(e,t,n,r){r=r||function(e){return e};var i=e.length,a=new Float64Array(i);var o=0,u=1,s=r(e[0]),l=s,f=s+t,c;for(;u<i;++u){c=r(e[u]);if(c>=f){l=(s+l)/2;for(;o<u;++o)a[o]=l;f=c+t;s=c}l=c}l=(s+l)/2;for(;o<u;++o)a[o]=l;return n?yd(a,t+t/4):a}function yd(e,t){var n=e.length;var r=0,i=1,a,o;while(e[r]===e[i])++i;while(i<n){a=i+1;while(e[i]===e[a])++a;if(e[i]-e[i-1]<t){o=i+(r+a-i-i>>1);while(o<i)e[o++]=e[i];while(o>i)e[o--]=e[r]}r=i;i=a}return e}function _d(e){return function(){e=(1103515245*e+12345)%2147483647;return e/2147483647}}function bd(e,t){if(t==null){t=e;e=0}var n,r,i;var a={min:function(e){if(arguments.length){n=e||0;i=r-n;return a}else{return n}},max:function(e){if(arguments.length){r=e||0;i=r-n;return a}else{return r}},sample:function(){return n+Math.floor(i*vd())},pdf:function(e){return e===Math.floor(e)&&e>=n&&e<r?1/i:0},cdf:function(e){var t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:function(e){return e>=0&&e<=1?n-1+Math.floor(e*i):NaN}};return a.min(e).max(t)}var xd=Math.sqrt(2*Math.PI);var wd=Math.SQRT2;var kd=NaN;function Ad(e,t){e=e||0;t=t==null?1:t;var n=0,r=0,i,a;if(kd===kd){n=kd;kd=NaN}else{do{n=vd()*2-1;r=vd()*2-1;i=n*n+r*r}while(i===0||i>1);a=Math.sqrt(-2*Math.log(i)/i);n*=a;kd=r*a}return e+n*t}function Ed(e,t,n){n=n==null?1:n;var r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*xd)}function Dd(e,t,n){t=t||0;n=n==null?1:n;var r=(e-t)/n,i=Math.abs(r);var a;if(i>37){a=0}else{var o=Math.exp(-i*i/2);var u;if(i<7.07106781186547){u=.0352624965998911*i+.700383064443688;u=u*i+6.37396220353165;u=u*i+33.912866078383;u=u*i+112.079291497871;u=u*i+221.213596169931;u=u*i+220.206867912376;a=o*u;u=.0883883476483184*i+1.75566716318264;u=u*i+16.064177579207;u=u*i+86.7807322029461;u=u*i+296.564248779674;u=u*i+637.333633378831;u=u*i+793.826512519948;u=u*i+440.413735824752;a=a/u}else{u=i+.65;u=i+4/u;u=i+3/u;u=i+2/u;u=i+1/u;a=o/u/2.506628274631}}return r>0?1-a:a}function Sd(e,t,n){if(e<0||e>1)return NaN;return(t||0)+(n==null?1:n)*wd*Cd(2*e-1)}function Cd(e){var t=-Math.log((1-e)*(1+e)),n;if(t<6.25){t-=3.125;n=-364441206401782e-35;n=-16850591381820166e-35+n*t;n=128584807152564e-32+n*t;n=11157877678025181e-33+n*t;n=-1333171662854621e-31+n*t;n=20972767875968562e-33+n*t;n=6637638134358324e-30+n*t;n=-4054566272975207e-29+n*t;n=-8151934197605472e-29+n*t;n=26335093153082323e-28+n*t;n=-12975133253453532e-27+n*t;n=-5415412054294628e-26+n*t;n=1.0512122733215323e-9+n*t;n=-4.112633980346984e-9+n*t;n=-2.9070369957882005e-8+n*t;n=4.2347877827932404e-7+n*t;n=-13654692000834679e-22+n*t;n=-13882523362786469e-21+n*t;n=.00018673420803405714+n*t;n=-.000740702534166267+n*t;n=-.006033670871430149+n*t;n=.24015818242558962+n*t;n=1.6536545626831027+n*t}else if(t<16){t=Math.sqrt(t)-3.25;n=2.2137376921775787e-9;n=9.075656193888539e-8+n*t;n=-2.7517406297064545e-7+n*t;n=1.8239629214389228e-8+n*t;n=15027403968909828e-22+n*t;n=-4013867526981546e-21+n*t;n=29234449089955446e-22+n*t;n=12475304481671779e-21+n*t;n=-47318229009055734e-21+n*t;n=6828485145957318e-20+n*t;n=24031110387097894e-21+n*t;n=-.0003550375203628475+n*t;n=.0009532893797373805+n*t;n=-.0016882755560235047+n*t;n=.002491442096107851+n*t;n=-.003751208507569241+n*t;n=.005370914553590064+n*t;n=1.0052589676941592+n*t;n=3.0838856104922208+n*t}else if(Number.isFinite(t)){t=Math.sqrt(t)-5;n=-27109920616438573e-27;n=-2.555641816996525e-10+n*t;n=1.5076572693500548e-9+n*t;n=-3.789465440126737e-9+n*t;n=7.61570120807834e-9+n*t;n=-1.496002662714924e-8+n*t;n=2.914795345090108e-8+n*t;n=-6.771199775845234e-8+n*t;n=2.2900482228026655e-7+n*t;n=-9.9298272942317e-7+n*t;n=4526062597223154e-21+n*t;n=-1968177810553167e-20+n*t;n=7599527703001776e-20+n*t;n=-.00021503011930044477+n*t;n=-.00013871931833623122+n*t;n=1.0103004648645344+n*t;n=4.849906401408584+n*t}else{n=Infinity}return n*e}function Md(e,t){var n,r;var i={mean:function(e){if(arguments.length){n=e||0;return i}else{return n}},stdev:function(e){if(arguments.length){r=e==null?1:e;return i}else{return r}},sample:function(){return Ad(n,r)},pdf:function(e){return Ed(e,n,r)},cdf:function(e){return Dd(e,n,r)},icdf:function(e){return Sd(e,n,r)}};return i.mean(e).stdev(t)}function Fd(e,t){var n=Md();var r=0;var i={data:function(n){if(arguments.length){e=n;r=n?n.length:0;return i.bandwidth(t)}else{return e}},bandwidth:function(n){if(!arguments.length)return t;t=n;if(!t&&e)t=dd(e);return i},sample:function(){return e[~~(vd()*r)]+t*n.sample()},pdf:function(i){var a=0,o=0;for(;o<r;++o){a+=n.pdf((i-e[o])/t)}return a/t/r},cdf:function(i){var a=0,o=0;for(;o<r;++o){a+=n.cdf((i-e[o])/t)}return a/r},icdf:function(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Od(e,t){e=e||0;t=t==null?1:t;return Math.exp(e+Ad()*t)}function Nd(e,t,n){if(e<=0)return 0;t=t||0;n=n==null?1:n;var r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*xd*e)}function Td(e,t,n){return Dd(Math.log(e),t,n)}function zd(e,t,n){return Math.exp(Sd(e,t,n))}function Rd(e,t){var n,r;var i={mean:function(e){if(arguments.length){n=e||0;return i}else{return n}},stdev:function(e){if(arguments.length){r=e==null?1:e;return i}else{return r}},sample:function(){return Od(n,r)},pdf:function(e){return Nd(e,n,r)},cdf:function(e){return Td(e,n,r)},icdf:function(e){return zd(e,n,r)}};return i.mean(e).stdev(t)}function Pd(e,t){var n=0,r;function i(e){var t=[];var r=0,i;for(i=0;i<n;++i){r+=t[i]=e[i]==null?1:+e[i]}for(i=0;i<n;++i){t[i]/=r}return t}var a={weights:function(e){if(arguments.length){r=i(t=e||[]);return a}return t},distributions:function(r){if(arguments.length){if(r){n=r.length;e=r}else{n=0;e=[]}return a.weights(t)}return e},sample:function(){var t=vd();var i=e[n-1],a=r[0],o=0;for(;o<n-1;a+=r[++o]){if(t<a){i=e[o];break}}return i.sample()},pdf:function(t){var i=0,a=0;for(;a<n;++a){i+=r[a]*e[a].pdf(t)}return i},cdf:function(t){var i=0,a=0;for(;a<n;++a){i+=r[a]*e[a].cdf(t)}return i},icdf:function(){throw Error("Mixture icdf not supported.")}};return a.distributions(e).weights(t)}function Ld(e,t){if(t==null){t=e==null?1:e;e=0}return e+(t-e)*vd()}function jd(e,t,n){if(n==null){n=t==null?1:t;t=0}return e>=t&&e<=n?1/(n-t):0}function Bd(e,t,n){if(n==null){n=t==null?1:t;t=0}return e<t?0:e>n?1:(e-t)/(n-t)}function Id(e,t,n){if(n==null){n=t==null?1:t;t=0}return e>=0&&e<=1?t+e*(n-t):NaN}function Ud(e,t){var n,r;var i={min:function(e){if(arguments.length){n=e||0;return i}else{return n}},max:function(e){if(arguments.length){r=e==null?1:e;return i}else{return r}},sample:function(){return Ld(n,r)},pdf:function(e){return jd(e,n,r)},cdf:function(e){return Bd(e,n,r)},icdf:function(e){return Id(e,n,r)}};if(t==null){t=e==null?1:e;e=0}return i.min(e).max(t)}function qd(e,t,n,r){var i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i,o=t-a*e;return[o,a]}function Wd(e,t,n,r){e=e.filter((function(e){var r=t(e),i=n(e);return r!=null&&(r=+r)>=r&&i!=null&&(i=+i)>=i}));if(r){e.sort((function(e,n){return t(e)-t(n)}))}var i=e.length,a=new Float64Array(i),o=new Float64Array(i);var u=0,s=0,l=0,f,c,d;for(var h=0,v=e;h<v.length;h++){d=v[h];a[u]=f=+t(d);o[u]=c=+n(d);++u;s+=(f-s)/u;l+=(c-l)/u}for(u=0;u<i;++u){a[u]-=s;o[u]-=l}return[a,o,s,l]}function Hd(e,t,n,r){var i=-1,a,o;for(var u=0,s=e;u<s.length;u++){var l=s[u];a=t(l);o=n(l);if(a!=null&&(a=+a)>=a&&o!=null&&(o=+o)>=o){r(a,o,++i)}}}function Gd(e,t,n,r,i){var a=0,o=0;Hd(e,t,n,(function(e,t){var n=t-i(e),u=t-r;a+=n*n;o+=u*u}));return 1-a/o}function $d(e,t,n){var r=0,i=0,a=0,o=0,u=0;Hd(e,t,n,(function(e,t){++u;r+=(e-r)/u;i+=(t-i)/u;a+=(e*t-a)/u;o+=(e*e-o)/u}));var s=qd(r,i,a,o),l=function(e){return s[0]+s[1]*e};return{coef:s,predict:l,rSquared:Gd(e,t,n,i,l)}}function Vd(e,t,n){var r=0,i=0,a=0,o=0,u=0;Hd(e,t,n,(function(e,t){++u;e=Math.log(e);r+=(e-r)/u;i+=(t-i)/u;a+=(e*t-a)/u;o+=(e*e-o)/u}));var s=qd(r,i,a,o),l=function(e){return s[0]+s[1]*Math.log(e)};return{coef:s,predict:l,rSquared:Gd(e,t,n,i,l)}}function Yd(e,t,n){var r=Wd(e,t,n),i=r[0],a=r[1],o=r[2],u=r[3];var s=0,l=0,f=0,c=0,d=0,h,v,p;Hd(e,t,n,(function(e,t){h=i[d++];v=Math.log(t);p=h*t;s+=(t*v-s)/d;l+=(p-l)/d;f+=(p*v-f)/d;c+=(h*p-c)/d}));var g=qd(l/u,s/u,f/u,c/u),m=g[0],y=g[1],_=function(e){return Math.exp(m+y*(e-o))};return{coef:[Math.exp(m-y*o),y],predict:_,rSquared:Gd(e,t,n,u,_)}}function Xd(e,t,n){var r=0,i=0,a=0,o=0,u=0,s=0;Hd(e,t,n,(function(e,t){var n=Math.log(e),l=Math.log(t);++s;r+=(n-r)/s;i+=(l-i)/s;a+=(n*l-a)/s;o+=(n*n-o)/s;u+=(t-u)/s}));var l=qd(r,i,a,o),f=function(e){return l[0]*Math.pow(e,l[1])};l[0]=Math.exp(l[0]);return{coef:l,predict:f,rSquared:Gd(e,t,n,u,f)}}function Jd(e,t,n){var r=Wd(e,t,n),i=r[0],a=r[1],o=r[2],u=r[3],s=i.length;var l=0,f=0,c=0,d=0,h=0,v,p,g,m;for(v=0;v<s;){p=i[v];g=a[v++];m=p*p;l+=(m-l)/v;f+=(m*p-f)/v;c+=(m*m-c)/v;d+=(p*g-d)/v;h+=(m*g-h)/v}var y=c-l*l,_=l*y-f*f,b=(h*l-d*f)/_,x=(d*y-h*f)/_,w=-b*l,k=function(e){e=e-o;return b*e*e+x*e+w+u};return{coef:[w-x*o+b*o*o+u,x-2*b*o,b],predict:k,rSquared:Gd(e,t,n,u,k)}}function Qd(e,t,n,r){if(r===1)return $d(e,t,n);if(r===2)return Jd(e,t,n);var i=Wd(e,t,n),a=i[0],o=i[1],u=i[2],s=i[3],l=a.length,f=[],c=[],d=r+1;var h,v,p,g,m;for(h=0;h<d;++h){for(p=0,g=0;p<l;++p){g+=Math.pow(a[p],h)*o[p]}f.push(g);m=new Float64Array(d);for(v=0;v<d;++v){for(p=0,g=0;p<l;++p){g+=Math.pow(a[p],h+v)}m[v]=g}c.push(m)}c.push(f);var y=Kd(c),_=function(e){e-=u;var t=s+y[0]+y[1]*e+y[2]*e*e;for(h=3;h<d;++h)t+=y[h]*Math.pow(e,h);return t};return{coef:Zd(d,y,-u,s),predict:_,rSquared:Gd(e,t,n,s,_)}}function Zd(e,t,n,r){var i=Array(e);var a,o,u,s;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a){u=t[a];s=1;i[a]+=u;for(o=1;o<=a;++o){s*=(a+1-o)/o;i[a-o]+=u*Math.pow(n,o)*s}}i[0]+=r;return i}function Kd(e){var t=e.length-1,n=[];var r,i,a,o,u;for(r=0;r<t;++r){o=r;for(i=r+1;i<t;++i){if(Math.abs(e[r][i])>Math.abs(e[r][o])){o=i}}for(a=r;a<t+1;++a){u=e[a][r];e[a][r]=e[a][o];e[a][o]=u}for(i=r+1;i<t;++i){for(a=t;a>=r;a--){e[a][i]-=e[a][r]*e[r][i]/e[r][r]}}}for(i=t-1;i>=0;--i){u=0;for(a=i+1;a<t;++a){u+=e[a][i]*n[a]}n[i]=(e[t][i]-u)/e[i][i]}return n}var eh=2,th=1e-12;function nh(e,t,n,r){var i=Wd(e,t,n,true),a=i[0],o=i[1],u=i[2],s=i[3],l=a.length,f=Math.max(2,~~(r*l)),c=new Float64Array(l),d=new Float64Array(l),h=new Float64Array(l).fill(1);for(var v=-1;++v<=eh;){var p=[0,f-1];for(var g=0;g<l;++g){var m=a[g],y=p[0],_=p[1],b=m-a[y]>a[_]-m?y:_;var x=0,w=0,k=0,A=0,E=0;var D=1/Math.abs(a[b]-m||1);for(var S=y;S<=_;++S){var C=a[S],M=o[S],F=rh(Math.abs(m-C)*D)*h[S],O=C*F;x+=F;w+=O;k+=M*F;A+=M*O;E+=C*O}var N=qd(w/x,k/x,A/x,E/x),T=N[0],z=N[1];c[g]=T+z*m;d[g]=Math.abs(o[g]-c[g]);ih(a,g+1,p)}if(v===eh){break}var R=bo(d);if(Math.abs(R)<th)break;for(var g=0,P=void 0,L;g<l;++g){P=d[g]/(6*R);h[g]=P>=1?th:(L=1-P*P)*L}}return ah(a,c,u,s)}function rh(e){return(e=1-e*e*e)*e*e}function ih(e,t,n){var r=e[t];var i=n[0],a=n[1]+1;if(a>=e.length)return;while(t>i&&e[a]-r<=r-e[i]){n[0]=++i;n[1]=a;++a}}function ah(e,t,n,r){var i=e.length,a=[];var o=0,u=0,s=[],l;for(;o<i;++o){l=e[o]+n;if(s[0]===l){s[1]+=(t[o]-s[1])/++u}else{u=0;s[1]+=r;s=[l,t[o]];a.push(s)}}s[1]+=r;return a}var oh=.1*Math.PI/180;function uh(e,t,n,r){n=n||25;r=Math.max(n,r||200);var i=function(t){return[t,e(t)]},a=t[0],o=t[1],u=o-a,s=u/r,l=[i(a)],f=[];if(n===r){for(var c=1;c<r;++c){l.push(i(a+c/n*u))}l.push(i(o));return l}else{f.push(i(o));for(var c=n;--c>0;){f.push(i(a+c/n*u))}}var d=l[0],h=f[f.length-1];while(h){var v=i((d[0]+h[0])/2);if(v[0]-d[0]>=s&&sh(d,v,h)>oh){f.push(v)}else{d=h;l.push(h);f.pop()}h=f[f.length-1]}return l}function sh(e,t,n){var r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}function lh(e){return function(t){var n=e.length;var r=1,i=String(e[0](t));for(;r<n;++r){i+="|"+e[r](t)}return i}}function fh(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:lh(e)}function ch(e,t,n){return n||e+(!t?"":"_"+t)}var dh=function(){};var hh={init:dh,add:dh,rem:dh,idx:0};var vh={values:{init:function(e){return e.cell.store=true},value:function(e){return e.cell.data.values()},idx:-1},count:{value:function(e){return e.cell.num}},__count__:{value:function(e){return e.missing+e.valid}},missing:{value:function(e){return e.missing}},valid:{value:function(e){return e.valid}},sum:{init:function(e){return e.sum=0},value:function(e){return e.sum},add:function(e,t){return e.sum+=+t},rem:function(e,t){return e.sum-=t}},product:{init:function(e){return e.product=1},value:function(e){return e.valid?e.product:undefined},add:function(e,t){return e.product*=t},rem:function(e,t){return e.product/=t}},mean:{init:function(e){return e.mean=0},value:function(e){return e.valid?e.mean:undefined},add:function(e,t){return e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid},rem:function(e,t){return e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean}},average:{value:function(e){return e.valid?e.mean:undefined},req:["mean"],idx:1},variance:{init:function(e){return e.dev=0},value:function(e){return e.valid>1?e.dev/(e.valid-1):undefined},add:function(e,t){return e.dev+=e.mean_d*(t-e.mean)},rem:function(e,t){return e.dev-=e.mean_d*(t-e.mean)},req:["mean"],idx:1},variancep:{value:function(e){return e.valid>1?e.dev/e.valid:undefined},req:["variance"],idx:2},stdev:{value:function(e){return e.valid>1?Math.sqrt(e.dev/(e.valid-1)):undefined},req:["variance"],idx:2},stdevp:{value:function(e){return e.valid>1?Math.sqrt(e.dev/e.valid):undefined},req:["variance"],idx:2},stderr:{value:function(e){return e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):undefined},req:["variance"],idx:2},distinct:{value:function(e){return e.cell.data.distinct(e.get)},req:["values"],idx:3},ci0:{value:function(e){return e.cell.data.ci0(e.get)},req:["values"],idx:3},ci1:{value:function(e){return e.cell.data.ci1(e.get)},req:["values"],idx:3},median:{value:function(e){return e.cell.data.q2(e.get)},req:["values"],idx:3},q1:{value:function(e){return e.cell.data.q1(e.get)},req:["values"],idx:3},q3:{value:function(e){return e.cell.data.q3(e.get)},req:["values"],idx:3},min:{init:function(e){return e.min=undefined},value:function(e){return e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min},add:function(e,t){if(t<e.min||e.min===undefined)e.min=t},rem:function(e,t){if(t<=e.min)e.min=NaN},req:["values"],idx:4},max:{init:function(e){return e.max=undefined},value:function(e){return e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max},add:function(e,t){if(t>e.max||e.max===undefined)e.max=t},rem:function(e,t){if(t>=e.max)e.max=NaN},req:["values"],idx:4},argmin:{init:function(e){return e.argmin=undefined},value:function(e){return e.argmin||e.cell.data.argmin(e.get)},add:function(e,t,n){if(t<e.min)e.argmin=n},rem:function(e,t){if(t<=e.min)e.argmin=undefined},req:["min","values"],idx:3},argmax:{init:function(e){return e.argmax=undefined},value:function(e){return e.argmax||e.cell.data.argmax(e.get)},add:function(e,t,n){if(t>e.max)e.argmax=n},rem:function(e,t){if(t>=e.max)e.argmax=undefined},req:["max","values"],idx:3}};var ph=Object.keys(vh);function gh(e,t){return function(n){return mi({name:e,out:n||e},hh,t)}}ph.forEach((function(e){vh[e]=gh(e,vh[e])}));function mh(e,t){return vh[e](t)}function yh(e,t){return e.idx-t.idx}function _h(e){var t={};e.forEach((function(e){return t[e.name]=e}));var n=function(e){if(!e.req)return;e.req.forEach((function(e){if(!t[e])n(t[e]=vh[e]())}))};e.forEach(n);return Object.values(t).sort(yh)}function bh(){var e=this;this.valid=0;this.missing=0;this._ops.forEach((function(t){return t.init(e)}))}function xh(e,t){var n=this;if(e==null||e===""){++this.missing;return}if(e!==e)return;++this.valid;this._ops.forEach((function(r){return r.add(n,e,t)}))}function wh(e,t){var n=this;if(e==null||e===""){--this.missing;return}if(e!==e)return;--this.valid;this._ops.forEach((function(r){return r.rem(n,e,t)}))}function kh(e){var t=this;this._out.forEach((function(n){return e[n.out]=n.value(t)}));return e}function Ah(e,t){var n=t||kr,r=_h(e),i=e.slice().sort(yh);function a(e){this._ops=r;this._out=i;this.cell=e;this.init()}a.prototype.init=bh;a.prototype.add=xh;a.prototype.rem=wh;a.prototype.set=kh;a.prototype.get=n;a.fields=e.map((function(e){return e.out}));return a}function Eh(e){this._key=e?xr(e):Hf;this.reset()}var Dh=Eh.prototype;Dh.reset=function(){this._add=[];this._rem=[];this._ext=null;this._get=null;this._q=null};Dh.add=function(e){this._add.push(e)};Dh.rem=function(e){this._rem.push(e)};Dh.values=function(){this._get=null;if(this._rem.length===0)return this._add;var e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};var u,s,l;for(u=0;u<i;++u){o[n(t[u])]=1}for(u=0,s=0;u<r;++u){if(o[n(l=e[u])]){o[n(l)]=0}else{a[s++]=l}}this._rem=[];return this._add=a};Dh.distinct=function(e){var t=this.values(),n={};var r=t.length,i=0,a;while(--r>=0){a=e(t[r])+"";if(!xi(n,a)){n[a]=1;++i}}return i};Dh.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=_i(t,e);this._ext=[t[n[0]],t[n[1]]];this._get=e}return this._ext};Dh.argmin=function(e){return this.extent(e)[0]||{}};Dh.argmax=function(e){return this.extent(e)[1]||{}};Dh.min=function(e){var t=this.extent(e)[0];return t!=null?e(t):undefined};Dh.max=function(e){var t=this.extent(e)[1];return t!=null?e(t):undefined};Dh.quartile=function(e){if(this._get!==e||!this._q){this._q=cd(this.values(),e);this._get=e}return this._q};Dh.q1=function(e){return this.quartile(e)[0]};Dh.q2=function(e){return this.quartile(e)[1]};Dh.q3=function(e){return this.quartile(e)[2]};Dh.ci=function(e){if(this._get!==e||!this._ci){this._ci=gd(this.values(),1e3,.05,e);this._get=e}return this._ci};Dh.ci0=function(e){return this.ci(e)[0]};Dh.ci1=function(e){return this.ci(e)[1]};function Sh(e){ad.call(this,null,e);this._adds=[];this._mods=[];this._alen=0;this._mlen=0;this._drop=true;this._cross=false;this._dims=[];this._dnames=[];this._measures=[];this._countOnly=false;this._counts=null;this._prev=null;this._inputs=null;this._outputs=null}Sh.Definition={type:"Aggregate",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:ph},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"drop",type:"boolean",default:true},{name:"cross",type:"boolean",default:false},{name:"key",type:"field"}]};Ei(Sh,ad,{transform:function(e,t){var n=this;var r=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=e.modified();r.stamp=i.stamp;if(r.value&&(a||t.modified(r._inputs,true))){r._prev=r.value;r.value=a?r.init(e):{};t.visit(t.SOURCE,(function(e){return r.add(e)}))}else{r.value=r.value||r.init(e);t.visit(t.REM,(function(e){return r.rem(e)}));t.visit(t.ADD,(function(e){return r.add(e)}))}i.modifies(r._outputs);r._drop=e.drop!==false;if(e.cross&&r._dims.length>1){r._drop=false;r.cross()}if(t.clean()&&r._drop){i.clean(true).runAfter((function(){return n.clean()}))}return r.changes(i)},cross:function(){var e=this,t=e.value,n=e._dnames,r=n.map((function(){return{}})),i=n.length;function a(e){var t,a,o,u;for(t in e){o=e[t].tuple;for(a=0;a<i;++a){r[a][u=o[n[a]]]=u}}}a(e._prev);a(t);function o(a,u,s){var l=n[s],f=r[s++];for(var c in f){var d=a?a+"|"+c:c;u[l]=f[c];if(s<i)o(d,u,s);else if(!t[d])e.cell(d,u)}}o("",{},0)},init:function(e){var t=this._inputs=[],n=this._outputs=[],r={};function i(e){var n=oi(pr(e)),i=n.length;var a=0,o;for(;a<i;++a){if(!r[o=n[a]]){r[o]=1;t.push(o)}}}this._dims=oi(e.groupby);this._dnames=this._dims.map((function(e){var t=vr(e);i(e);n.push(t);return t}));this.cellkey=e.key?e.key:fh(this._dims);this._countOnly=true;this._counts=[];this._measures=[];var a=e.fields||[null],o=e.ops||["count"],u=e.as||[],s=a.length,l={};var f,c,d,h,v,p;if(s!==o.length){_r("Unmatched number of fields and aggregate ops.")}for(p=0;p<s;++p){f=a[p];c=o[p];if(f==null&&c!=="count"){_r("Null aggregate field specified.")}h=vr(f);v=ch(c,h,u[p]);n.push(v);if(c==="count"){this._counts.push(v);continue}d=l[h];if(!d){i(f);d=l[h]=[];d.field=f;this._measures.push(d)}if(c!=="count")this._countOnly=false;d.push(mh(c,v))}this._measures=this._measures.map((function(e){return Ah(e,e.field)}));return{}},cellkey:fh(),cell:function(e,t){var n=this.value[e];if(!n){n=this.value[e]=this.newcell(e,t);this._adds[this._alen++]=n}else if(n.num===0&&this._drop&&n.stamp<this.stamp){n.stamp=this.stamp;this._adds[this._alen++]=n}else if(n.stamp<this.stamp){n.stamp=this.stamp;this._mods[this._mlen++]=n}return n},newcell:function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:false};if(!this._countOnly){var r=this._measures,i=r.length;n.agg=Array(i);for(var a=0;a<i;++a){n.agg[a]=new r[a](n)}}if(n.store){n.data=new Eh}return n},newtuple:function(e,t){var n=this._dnames,r=this._dims,i=r.length,a={};for(var o=0;o<i;++o){a[n[o]]=r[o](e)}return t?Xf(t.tuple,a):$f(a)},clean:function(){var e=this.value;for(var t in e){if(e[t].num===0){delete e[t]}}},add:function(e){var t=this.cellkey(e),n=this.cell(t,e);n.num+=1;if(this._countOnly)return;if(n.store)n.data.add(e);var r=n.agg;for(var i=0,a=r.length;i<a;++i){r[i].add(r[i].get(e),e)}},rem:function(e){var t=this.cellkey(e),n=this.cell(t,e);n.num-=1;if(this._countOnly)return;if(n.store)n.data.rem(e);var r=n.agg;for(var i=0,a=r.length;i<a;++i){r[i].rem(r[i].get(e),e)}},celltuple:function(e){var t=e.tuple,n=this._counts;if(e.store){e.data.values()}for(var r=0,i=n.length;r<i;++r){t[n[r]]=e.num}if(!this._countOnly){var a=e.agg;for(var r=0,i=a.length;r<i;++r){a[r].set(t)}}return t},changes:function(e){var t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,u=e.mod;var s,l,f,c;if(r)for(l in r){s=r[l];if(!i||s.num)o.push(s.tuple)}for(f=0,c=this._alen;f<c;++f){a.push(this.celltuple(t[f]));t[f]=null}for(f=0,c=this._mlen;f<c;++f){s=n[f];(s.num===0&&i?o:u).push(this.celltuple(s));n[f]=null}this._alen=this._mlen=0;this._prev=null;return e}});var Ch=1e-14;function Mh(e){ad.call(this,null,e)}Mh.Definition={type:"Bin",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"interval",type:"boolean",default:true},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:true,default:[5,2]},{name:"extent",type:"number",array:true,length:2,required:true},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:true},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:true},{name:"name",type:"string"},{name:"as",type:"string",array:true,length:2,default:["bin0","bin1"]}]};Ei(Mh,ad,{transform:function(e,t){var n=e.interval!==false,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],u=o[0],s=o[1];var l;if(e.modified()){t=t.reflow(true);l=t.SOURCE}else{l=t.modified(pr(e.field))?t.ADD_MOD:t.ADD}t.visit(l,n?function(e){var t=r(e);e[u]=t;e[s]=t==null?null:i+a*(1+(t-i)/a)}:function(e){return e[u]=r(e)});return t.modifies(n?o:u)},_bins:function(e){if(this.value&&!e.modified()){return this.value}var t=e.field,n=hd(e),r=n.step;var i=n.start,a=i+Math.ceil((n.stop-i)/r)*r,o,u;if((o=e.anchor)!=null){u=o-(i+r*Math.floor((o-i)/r));i+=u;a+=u}var s=function(e){var n=qr(t(e));return n==null?null:n<i?-Infinity:n>a?+Infinity:(n=Math.max(i,Math.min(n,a-r)),i+r*Math.floor(Ch+(n-i)/r))};s.start=i;s.stop=n.stop;s.step=r;return this.value=hr(s,pr(t),e.name||"bin_"+vr(t))}});function Fh(e,t,n){var r=e;var i=t||[],a=n||[],o={},u=0;return{add:function(e){return a.push(e)},remove:function(e){return o[r(e)]=++u},size:function(){return i.length},data:function(e,t){if(u){i=i.filter((function(e){return!o[r(e)]}));o={};u=0}if(t&&e){i.sort(e)}if(a.length){i=e?Li(e,i,a.sort(e)):i.concat(a);a=[]}return i}}}function Oh(e){ad.call(this,[],e)}Oh.Definition={type:"Collect",metadata:{source:true},params:[{name:"sort",type:"compare"}]};Ei(Oh,ad,{transform:function(e,t){var n=t.fork(t.ALL),r=Fh(Hf,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));n.visit(n.REM,r.remove);this.modified(a);this.value=n.source=r.data(Jf(i),a);if(t.source&&t.source.root){this.value.root=t.source.root}return n}});function Nh(e){oc.call(this,null,Th,e)}Ei(Nh,oc);function Th(e){return this.value&&!e.modified()?this.value:fi(e.fields,e.orders)}function zh(e){ad.call(this,null,e)}zh.Definition={type:"CountPattern",metadata:{generates:true,changes:true},params:[{name:"field",type:"field",required:true},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:true,length:2,default:["text","count"]}]};function Rh(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}Ei(zh,ad,{transform:function(e,t){var n=function(t){return function(n){var r=Rh(u(n),e.case,a)||[],i;for(var s=0,l=r.length;s<l;++s){if(!o.test(i=r[s]))t(i)}}};var r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,u=e.field,s=e.as||["text","count"],l=n((function(e){return i[e]=1+(i[e]||0)})),f=n((function(e){return i[e]-=1}));if(r){t.visit(t.SOURCE,l)}else{t.visit(t.ADD,l);t.visit(t.REM,f)}return this._finish(t,s)},_parameterCheck:function(e,t){var n=false;if(e.modified("stopwords")||!this._stop){this._stop=new RegExp("^"+(e.stopwords||"")+"$","i");n=true}if(e.modified("pattern")||!this._match){this._match=new RegExp(e.pattern||"[\\w']+","g");n=true}if(e.modified("field")||t.modified(e.field.fields)){n=true}if(n)this._counts={};return n},_finish:function(e,t){var n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);var u,s,l;for(u in n){s=r[u];l=n[u]||0;if(!s&&l){r[u]=s=$f({});s[i]=u;s[a]=l;o.add.push(s)}else if(l===0){if(s)o.rem.push(s);n[u]=null;r[u]=null}else if(s[a]!==l){s[a]=l;o.mod.push(s)}}return o.modifies(t)}});function Ph(e){ad.call(this,null,e)}Ph.Definition={type:"Cross",metadata:{generates:true},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:true,length:2,default:["a","b"]}]};Ei(Ph,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");var u=this.value;if(o){if(u)n.rem=u;u=t.materialize(t.SOURCE).source;n.add=this.value=Lh(u,i,a,e.filter||Dr)}else{n.mod=u}n.source=this.value;return n.modifies(r)}});function Lh(e,t,n,r){var i=[],a={},o=e.length,u=0,s,l;for(;u<o;++u){a[t]=l=e[u];for(s=0;s<o;++s){a[n]=e[s];if(r(a)){i.push($f(a));a={};a[t]=l}}}return i}var jh={kde:Fd,mixture:Pd,normal:Md,lognormal:Rd,uniform:Ud};var Bh="distributions",Ih="function",Uh="field";function qh(e,t){var n=e[Ih];if(!xi(jh,n)){_r("Unknown distribution function: "+n)}var r=jh[n]();for(var i in e){if(i===Uh){r.data((e.from||t()).map(e[i]))}else if(i===Bh){r[i](e[i].map((function(e){return qh(e,t)})))}else if(typeof r[i]===Ih){r[i](e[i])}}return r}function Wh(e){ad.call(this,null,e)}var Hh=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:true},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];var Gh={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:true,params:Hh},{name:"weights",type:"number",array:true}]};Wh.Definition={type:"Density",metadata:{generates:true},params:[{name:"extent",type:"number",array:true,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Hh.concat(Gh)},{name:"as",type:"string",array:true,default:["value","density"]}]};Ei(Wh,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=qh(e.distribution,$h(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;var o=e.method||"pdf";if(o!=="pdf"&&o!=="cdf"){_r("Invalid density method: "+o)}if(!e.extent&&!r.data){_r("Missing density extent parameter.")}o=r[o];var u=e.as||["value","density"],s=e.extent||yi(r.data()),l=uh(o,s,i,a).map((function(e){var t={};t[u[0]]=e[0];t[u[1]]=e[1];return $f(t)}));if(this.value)n.rem=this.value;this.value=n.add=n.source=l}return n}});function $h(e){return function(){return e.materialize(e.SOURCE).source}}function Vh(e,t){if(!e)return null;return e.map((function(e,n){return t[n]||vr(e)}))}function Yh(e,t,n){var r=[],i=function(e){return e(s)};var a,o,u,s,l,f;if(t==null){r.push(e.map(n))}else{for(a={},o=0,u=e.length;o<u;++o){s=e[o];l=t.map(i);f=a[l];if(!f){a[l]=f=[];f.dims=l;r.push(f)}f.push(n(s))}}return r}var Xh="bin";function Jh(e){ad.call(this,null,e)}Jh.Definition={type:"DotBin",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:false},{name:"as",type:"string",default:Xh}]};var Qh=function(e,t){return Ii(yi(e,t))/30};Ei(Jh,ad,{transform:function(e,t){if(this.value&&!(e.modified()||t.changed())){return t}var n=t.materialize(t.SOURCE).source,r=Yh(t.source,e.groupby,kr),i=e.smooth||false,a=e.field,o=e.step||Qh(n,a),u=Jf((function(e,t){return a(e)-a(t)})),s=e.as||Xh,l=r.length;var f=Infinity,c=-Infinity,d=0,h;for(;d<l;++d){var v=r[d].sort(u);h=-1;for(var p=0,g=md(v,o,i,a);p<g.length;p++){var m=g[p];if(m<f)f=m;if(m>c)c=m;v[++h][s]=m}}this.value={start:f,stop:c,step:o};return t.reflow(true).modifies(s)}});function Zh(e){oc.call(this,null,Kh,e);this.modified(true)}Ei(Zh,oc);function Kh(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:hr((function(n){return t(n,e)}),pr(t),vr(t))}function ev(e){ad.call(this,[undefined,undefined],e)}ev.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:true}]};Ei(ev,ad,{transform:function(e,t){var n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");var a=n[0],o=n[1];if(i||a==null){a=+Infinity;o=-Infinity}t.visit(i?t.SOURCE:t.ADD,(function(e){var t=qr(r(e));if(t!=null){if(t<a)a=t;if(t>o)o=t}}));if(!Number.isFinite(a)||!Number.isFinite(o)){var u=vr(r);if(u)u=' for field "'+u+'"';t.dataflow.warn("Infinite extent"+u+": ["+a+", "+o+"]");a=o=undefined}this.value=[a,o]}});function tv(e,t){oc.call(this,e);this.parent=t;this.count=0}Ei(tv,oc,{connect:function(e){this.detachSubflow=e.detachSubflow;this.targets().add(e);return e.source=this},add:function(e){this.count+=1;this.value.add.push(e)},rem:function(e){this.count-=1;this.value.rem.push(e)},mod:function(e){this.value.mod.push(e)},init:function(e){this.value.init(e,e.NO_SOURCE)},evaluate:function(){return this.value}});function nv(e){ad.call(this,{},e);this._keys=ki();var t=this._targets=[];t.active=0;t.forEach=function(e){for(var n=0,r=t.active;n<r;++n){e(t[n],n,t)}}}Ei(nv,ad,{activate:function(e){this._targets[this._targets.active++]=e},subflow:function(e,t,n,r){var i=this.value;var a=xi(i,e)&&i[e],o,u;if(!a){u=r||(u=this._group[e])&&u.tuple;o=n.dataflow;a=new tv(n.fork(n.NO_SOURCE),this);o.add(a).connect(t(o,e,u));i[e]=a;this.activate(a)}else if(a.value.stamp<n.stamp){a.init(n);this.activate(a)}return a},clean:function(){var e=this.value;var t=0;for(var n in e){if(e[n].count===0){var r=e[n].detachSubflow;if(r)r();delete e[n];++t}}if(t){var i=this._targets.filter((function(e){return e&&e.count>0}));this.initTargets(i)}},initTargets:function(e){var t=this._targets,n=t.length,r=e?e.length:0;var i=0;for(;i<r;++i){t[i]=e[i]}for(;i<n&&t[i]!=null;++i){t[i]=null}t.active=r},transform:function(e,t){var n=this;var r=t.dataflow,i=e.key,a=e.subflow,o=this._keys,u=e.modified("key"),s=function(e){return n.subflow(e,a,t)};this._group=e.group||{};this.initTargets();t.visit(t.REM,(function(e){var t=Hf(e),n=o.get(t);if(n!==undefined){o.delete(t);s(n).rem(e)}}));t.visit(t.ADD,(function(e){var t=i(e);o.set(Hf(e),t);s(t).add(e)}));if(u||t.modified(i.fields)){t.visit(t.MOD,(function(e){var t=Hf(e),n=o.get(t),r=i(e);if(n===r){s(r).mod(e)}else{o.set(t,r);s(n).rem(e);s(r).add(e)}}))}else if(t.changed(t.MOD)){t.visit(t.MOD,(function(e){s(o.get(Hf(e))).mod(e)}))}if(u){t.visit(t.REFLOW,(function(e){var t=Hf(e),n=o.get(t),r=i(e);if(n!==r){o.set(t,r);s(n).rem(e);s(r).add(e)}}))}if(t.clean()){r.runAfter((function(){n.clean();o.clean()}))}else if(o.empty>r.cleanThreshold){r.runAfter(o.clean)}return t}});function rv(e){oc.call(this,null,iv,e)}Ei(rv,oc);function iv(e){return this.value&&!e.modified()?this.value:Rr(e.name)?oi(e.name).map((function(e){return xr(e)})):xr(e.name,e.as)}function av(e){ad.call(this,ki(),e)}av.Definition={type:"Filter",metadata:{changes:true},params:[{name:"expr",type:"expr",required:true}]};Ei(av,ad,{transform:function(e,t){var n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,u=i.mod,s=e.expr;var l=true;t.visit(t.REM,(function(e){var t=Hf(e);if(!r.has(t))o.push(e);else r.delete(t)}));t.visit(t.ADD,(function(t){if(s(t,e))a.push(t);else r.set(Hf(t),1)}));function f(t){var n=Hf(t),i=s(t,e),f=r.get(n);if(i&&f){r.delete(n);a.push(t)}else if(!i&&!f){r.set(n,1);o.push(t)}else if(l&&i&&!f){u.push(t)}}t.visit(t.MOD,f);if(e.modified()){l=false;t.visit(t.REFLOW,f)}if(r.empty>n.cleanThreshold)n.runAfter(r.clean);return i}});function ov(e){ad.call(this,[],e)}ov.Definition={type:"Flatten",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"index",type:"string"},{name:"as",type:"string",array:true}]};Ei(ov,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=Vh(r,e.as||[]),a=e.index||null,o=i.length;n.rem=this.value;t.visit(t.SOURCE,(function(e){var t=r.map((function(t){return t(e)})),u=t.reduce((function(e,t){return Math.max(e,t.length)}),0);var s=0,l,f,c;for(;s<u;++s){f=Vf(e);for(l=0;l<o;++l){f[i[l]]=(c=t[l][s])==null?null:c}if(a){f[a]=s}n.add.push(f)}}));this.value=n.source=n.add;if(a)n.modifies(a);return n.modifies(i)}});function uv(e){ad.call(this,[],e)}uv.Definition={type:"Fold",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true,length:2,default:["key","value"]}]};Ei(uv,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(vr),a=e.as||["key","value"],o=a[0],u=a[1],s=r.length;n.rem=this.value;t.visit(t.SOURCE,(function(e){for(var t=0,a=void 0;t<s;++t){a=Vf(e);a[o]=i[t];a[u]=r[t](e);n.add.push(a)}}));this.value=n.source=n.add;return n.modifies(a)}});function sv(e){ad.call(this,null,e)}sv.Definition={type:"Formula",metadata:{modifies:true},params:[{name:"expr",type:"expr",required:true},{name:"as",type:"string",required:true},{name:"initonly",type:"boolean"}]};Ei(sv,ad,{transform:function(e,t){var n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;if(i){t=t.materialize().reflow(true)}if(!e.initonly){t.modifies(r)}return t.visit(a,(function(t){return t[r]=n(t,e)}))}});function lv(e){ad.call(this,[],e)}Ei(lv,ad,{transform:function(e,t){var n=t.fork(t.ALL),r=e.generator;var i=this.value,a=e.size-i.length,o,u,s;if(a>0){for(o=[];--a>=0;){o.push(s=$f(r(e)));i.push(s)}n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else{u=i.slice(0,-a);n.rem=n.rem.length?n.materialize(n.REM).rem.concat(u):u;i=i.slice(-a)}n.source=this.value=i;return n}});var fv={value:"value",median:bo,mean:_o,min:vo,max:ho};var cv=[];function dv(e){ad.call(this,[],e)}dv.Definition={type:"Impute",metadata:{changes:true},params:[{name:"field",type:"field",required:true},{name:"key",type:"field",required:true},{name:"keyvals",array:true},{name:"groupby",type:"field",array:true},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function hv(e){var t=e.method||fv.value,n;if(fv[t]==null){_r("Unrecognized imputation method: "+t)}else if(t===fv.value){n=e.value!==undefined?e.value:0;return function(){return n}}else{return fv[t]}}function vv(e){var t=e.field;return function(e){return e?t(e):NaN}}Ei(dv,ad,{transform:function(e,t){var n=t.fork(t.ALL),r=hv(e),i=vv(e),a=vr(e.field),o=vr(e.key),u=(e.groupby||[]).map(vr),s=pv(t.source,e.groupby,e.key,e.keyvals),l=[],f=this.value,c=s.domain.length,d,h,v,p,g,m,y,_,b,x;for(g=0,_=s.length;g<_;++g){d=s[g];v=d.values;h=NaN;for(y=0;y<c;++y){if(d[y]!=null)continue;p=s.domain[y];x={_impute:true};for(m=0,b=v.length;m<b;++m)x[u[m]]=v[m];x[o]=p;x[a]=Number.isNaN(h)?h=r(d,i):h;l.push($f(x))}}if(l.length)n.add=n.materialize(n.ADD).add.concat(l);if(f.length)n.rem=n.materialize(n.REM).rem.concat(f);this.value=l;return n}});function pv(e,t,n,r){var i=function(e){return e(g)},a=[],o=r?r.slice():[],u={},s={},l,f,c,d,h,v,p,g;o.forEach((function(e,t){return u[e]=t+1}));for(d=0,p=e.length;d<p;++d){g=e[d];v=n(g);h=u[v]||(u[v]=o.push(v));f=(l=t?t.map(i):cv)+"";if(!(c=s[f])){c=s[f]=[];a.push(c);c.values=l}c[h-1]=g}a.domain=o;return a}function gv(e){Sh.call(this,e)}gv.Definition={type:"JoinAggregate",metadata:{modifies:true},params:[{name:"groupby",type:"field",array:true},{name:"fields",type:"field",null:true,array:true},{name:"ops",type:"enum",array:true,values:ph},{name:"as",type:"string",null:true,array:true},{name:"key",type:"field"}]};Ei(gv,Sh,{transform:function(e,t){var n=this,r=e.modified();var i;if(n.value&&(r||t.modified(n._inputs,true))){i=n.value=r?n.init(e):{};t.visit(t.SOURCE,(function(e){return n.add(e)}))}else{i=n.value=n.value||this.init(e);t.visit(t.REM,(function(e){return n.rem(e)}));t.visit(t.ADD,(function(e){return n.add(e)}))}n.changes();t.visit(t.SOURCE,(function(e){mi(e,i[n.cellkey(e)].tuple)}));return t.reflow(r).modifies(this._outputs)},changes:function(){var e=this._adds,t=this._mods;var n,r;for(n=0,r=this._alen;n<r;++n){this.celltuple(e[n]);e[n]=null}for(n=0,r=this._mlen;n<r;++n){this.celltuple(t[n]);t[n]=null}this._alen=this._mlen=0}});function mv(e){ad.call(this,null,e)}mv.Definition={type:"KDE",metadata:{generates:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"cumulative",type:"boolean",default:false},{name:"counts",type:"boolean",default:false},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:true,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:true,default:["value","density"]}]};Ei(mv,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=t.materialize(t.SOURCE).source,i=Yh(r,e.groupby,e.field),a=(e.groupby||[]).map(vr),o=e.bandwidth,u=e.cumulative?"cdf":"pdf",s=e.as||["value","density"],l=[];var f=e.extent,c=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;if(u!=="pdf"&&u!=="cdf"){_r("Invalid density method: "+u)}if(e.resolve==="shared"){if(!f)f=yi(r,e.field);c=d=e.steps||d}i.forEach((function(t){var n=Fd(t,o)[u],r=e.counts?t.length:1,i=f||yi(t);uh(n,i,c,d).forEach((function(e){var n={};for(var i=0;i<a.length;++i){n[a[i]]=t.dims[i]}n[s[0]]=e[0];n[s[1]]=e[1]*r;l.push($f(n))}))}));if(this.value)n.rem=this.value;this.value=n.add=n.source=l}return n}});function yv(e){oc.call(this,null,_v,e)}Ei(yv,oc);function _v(e){return this.value&&!e.modified()?this.value:Ti(e.fields,e.flat)}function bv(e){ad.call(this,[],e);this._pending=null}Ei(bv,ad,{transform:function(e,t){var n=this;var r=t.dataflow;if(this._pending){return wv(this,t,this._pending)}if(xv(e))return t.StopPropagation;if(e.values){return wv(this,t,r.parse(e.values,e.format))}else if(e.async){var i=r.request(e.url,e.format).then((function(e){n._pending=oi(e.data);return function(e){return e.touch(n)}}));return{async:i}}else{return r.request(e.url,e.format).then((function(e){return wv(n,t,oi(e.data))}))}}});function xv(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function wv(e,t,n){n.forEach($f);var r=t.fork(t.NO_FIELDS&t.NO_SOURCE);r.rem=e.value;e.value=r.source=r.add=n;e._pending=null;if(r.rem.length)r.clean(true);return r}function kv(e){ad.call(this,{},e)}kv.Definition={type:"Lookup",metadata:{modifies:true},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:true},{name:"key",type:"field",required:true}]},{name:"values",type:"field",array:true},{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true},{name:"default",default:null}]};Ei(kv,ad,{transform:function(e,t){var n=e.fields,r=e.index,i=e.values,a=e.default==null?null:e.default,o=e.modified(),u=n.length;var s=o?t.SOURCE:t.ADD,l=t,f=e.as,c,d,h;if(i){d=i.length;if(u>1&&!f){_r('Multi-field lookup requires explicit "as" parameter.')}if(f&&f.length!==u*d){_r('The "as" parameter has too few output field names.')}f=f||i.map(vr);c=function(e){for(var t=0,o=0,s,l;t<u;++t){l=r.get(n[t](e));if(l==null)for(s=0;s<d;++s,++o)e[f[o]]=a;else for(s=0;s<d;++s,++o)e[f[o]]=i[s](l)}}}else{if(!f){_r("Missing output field names.")}c=function(e){for(var t=0,i;t<u;++t){i=r.get(n[t](e));e[f[t]]=i==null?a:i}}}if(o){l=t.reflow(true)}else{h=n.some((function(e){return t.modified(e.fields)}));s|=h?t.MOD:0}t.visit(s,c);return l.modifies(f)}});function Av(e){oc.call(this,null,Ev,e)}Ei(Av,oc);function Ev(e){if(this.value&&!e.modified()){return this.value}var t=e.extents,n=t.length;var r=+Infinity,i=-Infinity,a,o;for(a=0;a<n;++a){o=t[a];if(o[0]<r)r=o[0];if(o[1]>i)i=o[1]}return[r,i]}function Dv(e){oc.call(this,null,Sv,e)}Ei(Dv,oc);function Sv(e){return this.value&&!e.modified()?this.value:e.values.reduce((function(e,t){return e.concat(t)}),[])}function Cv(e){ad.call(this,null,e)}Ei(Cv,ad,{transform:function(e,t){this.modified(e.modified());this.value=e;return t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Mv(e){Sh.call(this,e)}Mv.Definition={type:"Pivot",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"value",type:"field",required:true},{name:"op",type:"enum",values:ph,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};Ei(Mv,Sh,{_transform:Sh.prototype.transform,transform:function(e,t){return this._transform(Fv(e,t),t)}});function Fv(e,t){var n=e.field,r=e.value,i=(e.op==="count"?"__count__":e.op)||"sum",a=pr(n).concat(pr(r)),o=Nv(n,e.limit||0,t);if(t.changed())e.set("__pivot__",null,null,true);return{key:e.key,groupby:e.groupby,ops:o.map((function(){return i})),fields:o.map((function(e){return Ov(e,n,r,a)})),as:o.map((function(e){return e+""})),modified:e.modified.bind(e)}}function Ov(e,t,n,r){return hr((function(r){return t(r)===e?n(r):NaN}),r,e+"")}function Nv(e,t,n){var r={},i=[];n.visit(n.SOURCE,(function(t){var n=e(t);if(!r[n]){r[n]=1;i.push(n)}}));i.sort(ci);return t?i.slice(0,t):i}function Tv(e){nv.call(this,e)}Ei(Tv,nv,{transform:function(e,t){var n=this;var r=e.subflow,i=e.field,a=function(e){return n.subflow(Hf(e),r,t,e)};if(e.modified("field")||i&&t.modified(pr(i))){_r("PreFacet does not support field modification.")}this.initTargets();if(i){t.visit(t.MOD,(function(e){var t=a(e);i(e).forEach((function(e){return t.mod(e)}))}));t.visit(t.ADD,(function(e){var t=a(e);i(e).forEach((function(e){return t.add($f(e))}))}));t.visit(t.REM,(function(e){var t=a(e);i(e).forEach((function(e){return t.rem(e)}))}))}else{t.visit(t.MOD,(function(e){return a(e).mod(e)}));t.visit(t.ADD,(function(e){return a(e).add(e)}));t.visit(t.REM,(function(e){return a(e).rem(e)}))}if(t.clean()){t.runAfter((function(){return n.clean()}))}return t}});function zv(e){ad.call(this,null,e)}zv.Definition={type:"Project",metadata:{generates:true,changes:true},params:[{name:"fields",type:"field",array:true},{name:"as",type:"string",null:true,array:true}]};Ei(zv,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=Vh(e.fields,e.as||[]),a=r?function(e,t){return Rv(e,t,r,i)}:Yf;var o;if(this.value){o=this.value}else{t=t.addAll();o=this.value={}}t.visit(t.REM,(function(e){var t=Hf(e);n.rem.push(o[t]);o[t]=null}));t.visit(t.ADD,(function(e){var t=a(e,$f({}));o[Hf(e)]=t;n.add.push(t)}));t.visit(t.MOD,(function(e){n.mod.push(a(e,o[Hf(e)]))}));return n}});function Rv(e,t,n,r){for(var i=0,a=n.length;i<a;++i){t[r[i]]=n[i](e)}return t}function Pv(e){ad.call(this,null,e)}Ei(Pv,ad,{transform:function(e,t){this.value=e.value;return e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Lv(e){ad.call(this,null,e)}Lv.Definition={type:"Quantile",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"probs",type:"number",array:true},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:true,default:["prob","value"]}]};var jv=1e-14;Ei(Lv,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed()){n.source=this.value;return n}var i=t.materialize(t.SOURCE).source,a=Yh(i,e.groupby,e.field),o=(e.groupby||[]).map(vr),u=[],s=e.step||.01,l=e.probs||ko(s/2,1-jv,s),f=l.length;a.forEach((function(e){var t=fd(e,l);for(var n=0;n<f;++n){var i={};for(var a=0;a<o.length;++a){i[o[a]]=e.dims[a]}i[r[0]]=l[n];i[r[1]]=t[n];u.push($f(i))}}));if(this.value)n.rem=this.value;this.value=n.add=n.source=u;return n}});function Bv(e){ad.call(this,null,e)}Ei(Bv,ad,{transform:function(e,t){var n,r;if(this.value){r=this.value}else{n=t=t.addAll();r=this.value={}}if(e.derive){n=t.fork(t.NO_SOURCE);t.visit(t.REM,(function(e){var t=Hf(e);n.rem.push(r[t]);r[t]=null}));t.visit(t.ADD,(function(e){var t=Vf(e);r[Hf(e)]=t;n.add.push(t)}));t.visit(t.MOD,(function(e){var t=r[Hf(e)];for(var i in e){t[i]=e[i];n.modifies(i)}n.mod.push(t)}))}return n}});function Iv(e){ad.call(this,[],e);this.count=0}Iv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};Ei(Iv,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce((function(e,t){return e[Hf(t)]=1,e}),{});var o=this.value,u=this.count,s=0;function l(e){var t,r;if(o.length<i){o.push(e)}else{r=~~((u+1)*vd());if(r<o.length&&r>=s){t=o[r];if(a[Hf(t)])n.rem.push(t);o[r]=e}}++u}if(t.rem.length){t.visit(t.REM,(function(e){var t=Hf(e);if(a[t]){a[t]=-1;n.rem.push(e)}--u}));o=o.filter((function(e){return a[Hf(e)]!==-1}))}if((t.rem.length||r)&&o.length<i&&t.source){s=u=o.length;t.visit(t.SOURCE,(function(e){if(!a[Hf(e)])l(e)}));s=-1}if(r&&o.length>i){var f=o.length-i;for(var c=0;c<f;++c){a[Hf(o[c])]=-1;n.rem.push(o[c])}o=o.slice(f)}if(t.mod.length){t.visit(t.MOD,(function(e){if(a[Hf(e)])n.mod.push(e)}))}if(t.add.length){t.visit(t.ADD,l)}if(t.add.length||s<0){n.add=o.filter((function(e){return!a[Hf(e)]}))}this.count=u;this.value=n.source=o;return n}});function Uv(e){ad.call(this,null,e)}Uv.Definition={type:"Sequence",metadata:{generates:true,changes:true},params:[{name:"start",type:"number",required:true},{name:"stop",type:"number",required:true},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};Ei(Uv,ad,{transform:function(e,t){if(this.value&&!e.modified())return;var n=t.materialize().fork(t.MOD),r=e.as||"data";n.rem=this.value?t.rem.concat(this.value):t.rem;this.value=ko(e.start,e.stop,e.step||1).map((function(e){var t={};t[r]=e;return $f(t)}));n.add=t.add.concat(this.value);return n}});function qv(e){ad.call(this,null,e);this.modified(true)}Ei(qv,ad,{transform:function(e,t){this.value=t.source;return t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Wv(e){ad.call(this,null,e)}var Hv=["unit0","unit1"];Wv.Definition={type:"TimeUnit",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"interval",type:"boolean",default:true},{name:"units",type:"enum",values:Wu,array:true},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:true},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:true,length:2,default:Hv}]};Ei(Wv,ad,{transform:function(e,t){var n=e.field,r=e.interval!==false,i=e.timezone==="utc",a=this._floor(e,t),o=(i?bs:_s)(a.unit).offset,u=e.as||Hv,s=u[0],l=u[1],f=a.step;var c=a.start||Infinity,d=a.stop||-Infinity,h=t.ADD;if(e.modified()||t.modified(pr(n))){t=t.reflow(true);h=t.SOURCE;c=Infinity;d=-Infinity}t.visit(h,(function(e){var t=n(e);var i,u;if(t==null){e[s]=null;if(r)e[l]=null}else{e[s]=i=u=a(t);if(r)e[l]=u=o(i,f);if(i<c)c=i;if(u>d)d=u}}));a.start=c;a.stop=d;return t.modifies(r?u:s)},_floor:function(e,t){var n=e.timezone==="utc";var r=e.units?{units:e.units,step:e.step||1}:Ws({extent:e.extent||yi(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),i=r.units,a=r.step;var o=Gu(i),u=this.value||{},s=(n?gs:hs)(o,a);s.unit=Ur(o);s.units=o;s.step=a;s.start=u.start;s.stop=u.stop;return this.value=s}});function Gv(e){ad.call(this,ki(),e)}Ei(Gv,ad,{transform:function(e,t){var n=t.dataflow,r=e.field,i=this.value,a=function(e){return i.set(r(e),e)};var o=true;if(e.modified("field")||t.modified(r.fields)){i.clear();t.visit(t.SOURCE,a)}else if(t.changed()){t.visit(t.REM,(function(e){return i.delete(r(e))}));t.visit(t.ADD,a)}else{o=false}this.modified(o);if(i.empty>n.cleanThreshold)n.runAfter(i.clean);return t.fork()}});function $v(e){ad.call(this,null,e)}Ei($v,ad,{transform:function(e,t){var n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);if(n){this.value=(e.sort?t.source.slice().sort(Jf(e.sort)):t.source).map(e.field)}}});function Vv(e,t,n,r){var i=Yv[e](t,n);return{init:i.init||Ar,update:function(e,t){t[r]=i.next(e)}}}var Yv={row_number:function(){return{next:function(e){return e.index+1}}},rank:function(){var e;return{init:function(){return e=1},next:function(t){var n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){var e;return{init:function(){return e=1},next:function(t){var n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){var e=Yv.rank(),t=e.next;return{init:e.init,next:function(e){return(t(e)-1)/(e.data.length-1)}}},cume_dist:function(){var e;return{init:function(){return e=0},next:function(t){var n=t.data,r=t.compare;var i=t.index;if(e<i){while(i+1<n.length&&!r(n[i],n[i+1]))++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){t=+t;if(!(t>0))_r("ntile num must be greater than zero.");var n=Yv.cume_dist(),r=n.next;return{init:n.init,next:function(e){return Math.ceil(t*r(e))}}},lag:function(e,t){t=+t||1;return{next:function(n){var r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){t=+t||1;return{next:function(n){var r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:function(t){return e(t.data[t.i0])}}},last_value:function(e){return{next:function(t){return e(t.data[t.i1-1])}}},nth_value:function(e,t){t=+t;if(!(t>0))_r("nth_value nth must be greater than zero.");return{next:function(n){var r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){var t;return{init:function(){return t=null},next:function(n){var r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){var t,n;return{init:function(){return t=null,n=-1},next:function(r){var i=r.data;return r.index<=n?t:(n=Xv(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};function Xv(e,t,n){for(var r=t.length;n<r;++n){var i=e(t[n]);if(i!=null)return n}return-1}var Jv=Object.keys(Yv);function Qv(e){var t=oi(e.ops),n=oi(e.fields),r=oi(e.params),i=oi(e.as),a=this.outputs=[],o=this.windows=[],u={},s={},l=[],f=[];var c=true;function d(e){oi(pr(e)).forEach((function(e){return u[e]=1}))}d(e.sort);t.forEach((function(e,t){var u=n[t],h=vr(u),v=ch(e,h,i[t]);d(u);a.push(v);if(xi(Yv,e)){o.push(Vv(e,n[t],r[t],v))}else{if(u==null&&e!=="count"){_r("Null aggregate field specified.")}if(e==="count"){l.push(v);return}c=false;var p=s[h];if(!p){p=s[h]=[];p.field=u;f.push(p)}p.push(mh(e,v))}}));if(l.length||f.length){this.cell=Kv(f,l,c)}this.inputs=Object.keys(u)}var Zv=Qv.prototype;Zv.init=function(){this.windows.forEach((function(e){return e.init()}));if(this.cell)this.cell.init()};Zv.update=function(e,t){var n=this.cell,r=this.windows,i=e.data,a=r&&r.length;var o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)};function Kv(e,t,n){e=e.map((function(e){return Ah(e,e.field)}));var r={num:0,agg:null,store:false,count:t};if(!n){var i=e.length,a=r.agg=Array(i),o=0;for(;o<i;++o)a[o]=new e[o](r)}if(r.store){var u=r.data=new Eh}r.add=function(e){r.num+=1;if(n)return;if(u)u.add(e);for(var t=0;t<i;++t){a[t].add(a[t].get(e),e)}};r.rem=function(e){r.num-=1;if(n)return;if(u)u.rem(e);for(var t=0;t<i;++t){a[t].rem(a[t].get(e),e)}};r.set=function(e){var i,o;if(u)u.values();for(i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)};r.init=function(){r.num=0;if(u)u.reset();for(var e=0;e<i;++e)a[e].init()};return r}function ep(e){ad.call(this,{},e);this._mlen=0;this._mods=[]}ep.Definition={type:"Window",metadata:{modifies:true},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:Jv.concat(ph)},{name:"params",type:"number",null:true,array:true},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"frame",type:"number",null:true,array:true,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:false}]};Ei(ep,ad,{transform:function(e,t){var n=this;this.stamp=t.stamp;var r=e.modified(),i=Jf(e.sort),a=fh(e.groupby),o=function(e){return n.group(a(e))};var u=this.state;if(!u||r){u=this.state=new Qv(e)}if(r||t.modified(u.inputs)){this.value={};t.visit(t.SOURCE,(function(e){return o(e).add(e)}))}else{t.visit(t.REM,(function(e){return o(e).remove(e)}));t.visit(t.ADD,(function(e){return o(e).add(e)}))}for(var s=0,l=this._mlen;s<l;++s){tp(this._mods[s],u,i,e)}this._mlen=0;this._mods=[];return t.reflow(r).modifies(u.outputs)},group:function(e){var t=this.value[e];if(!t){t=this.value[e]=Fh(Hf);t.stamp=-1}if(t.stamp<this.stamp){t.stamp=this.stamp;this._mods[this._mlen++]=t}return t}});function tp(e,t,n,r){var i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],u=e.data(n),s=u.length,l=a?Xa(i):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:u,compare:i||pi(-1)};t.init();for(var c=0;c<s;++c){np(f,o,c,s);if(a)rp(f,l);t.update(f,u[c])}}function np(e,t,n,r){e.p0=e.i0;e.p1=e.i1;e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0]));e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1);e.index=n}function rp(e,t){var n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;if(n>0&&!i(a[n],a[n-1]))e.i0=t.left(a,a[n]);if(r<o&&!i(a[r],a[r+1]))e.i1=t.right(a,a[r])}var ip=Object.freeze({__proto__:null,aggregate:Sh,bin:Mh,collect:Oh,compare:Nh,countpattern:zh,cross:Ph,density:Wh,dotbin:Jh,expression:Zh,extent:ev,facet:nv,field:rv,filter:av,flatten:ov,fold:uv,formula:sv,generate:lv,impute:dv,joinaggregate:gv,kde:mv,key:yv,load:bv,lookup:kv,multiextent:Av,multivalues:Dv,params:Cv,pivot:Mv,prefacet:Tv,project:zv,proxy:Pv,quantile:Lv,relay:Bv,sample:Iv,sequence:Uv,sieve:qv,subflow:tv,timeunit:Wv,tupleindex:Gv,values:$v,window:ep});var ap=Math.PI,op=2*ap,up=1e-6,sp=op-up;function lp(){this._x0=this._y0=this._x1=this._y1=null;this._=""}function fp(){return new lp}lp.prototype=fp.prototype={constructor:lp,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){if(this._x1!==null){this._x1=this._x0,this._y1=this._y0;this._+="Z"}},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,u=n-e,s=r-t,l=a-e,f=o-t,c=l*l+f*f;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null){this._+="M"+(this._x1=e)+","+(this._y1=t)}else if(!(c>up));else if(!(Math.abs(f*u-s*l)>up)||!i){this._+="L"+(this._x1=e)+","+(this._y1=t)}else{var d=n-a,h=r-o,v=u*u+s*s,p=d*d+h*h,g=Math.sqrt(v),m=Math.sqrt(c),y=i*Math.tan((ap-Math.acos((v+c-p)/(2*g*m)))/2),_=y/m,b=y/g;if(Math.abs(_-1)>up){this._+="L"+(e+_*l)+","+(t+_*f)}this._+="A"+i+","+i+",0,0,"+ +(f*d>l*h)+","+(this._x1=e+b*u)+","+(this._y1=t+b*s)}},arc:function(e,t,n,r,i,a){e=+e,t=+t,n=+n,a=!!a;var o=n*Math.cos(r),u=n*Math.sin(r),s=e+o,l=t+u,f=1^a,c=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);if(this._x1===null){this._+="M"+s+","+l}else if(Math.abs(this._x1-s)>up||Math.abs(this._y1-l)>up){this._+="L"+s+","+l}if(!n)return;if(c<0)c=c%op+op;if(c>sp){this._+="A"+n+","+n+",0,1,"+f+","+(e-o)+","+(t-u)+"A"+n+","+n+",0,1,"+f+","+(this._x1=s)+","+(this._y1=l)}else if(c>up){this._+="A"+n+","+n+",0,"+ +(c>=ap)+","+f+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))}},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function cp(e){return function t(){return e}}var dp=Math.abs;var hp=Math.atan2;var vp=Math.cos;var pp=Math.max;var gp=Math.min;var mp=Math.sin;var yp=Math.sqrt;var _p=1e-12;var bp=Math.PI;var xp=bp/2;var wp=2*bp;function kp(e){return e>1?0:e<-1?bp:Math.acos(e)}function Ap(e){return e>=1?xp:e<=-1?-xp:Math.asin(e)}function Ep(e){return e.innerRadius}function Dp(e){return e.outerRadius}function Sp(e){return e.startAngle}function Cp(e){return e.endAngle}function Mp(e){return e&&e.padAngle}function Fp(e,t,n,r,i,a,o,u){var s=n-e,l=r-t,f=o-i,c=u-a,d=c*s-f*l;if(d*d<_p)return;d=(f*(t-a)-c*(e-i))/d;return[e+d*s,t+d*l]}function Op(e,t,n,r,i,a,o){var u=e-n,s=t-r,l=(o?a:-a)/yp(u*u+s*s),f=l*s,c=-l*u,d=e+f,h=t+c,v=n+f,p=r+c,g=(d+v)/2,m=(h+p)/2,y=v-d,_=p-h,b=y*y+_*_,x=i-a,w=d*p-v*h,k=(_<0?-1:1)*yp(pp(0,x*x*b-w*w)),A=(w*_-y*k)/b,E=(-w*y-_*k)/b,D=(w*_+y*k)/b,S=(-w*y+_*k)/b,C=A-g,M=E-m,F=D-g,O=S-m;if(C*C+M*M>F*F+O*O)A=D,E=S;return{cx:A,cy:E,x01:-f,y01:-c,x11:A*(i/x-1),y11:E*(i/x-1)}}function Np(){var e=Ep,t=Dp,n=cp(0),r=null,i=Sp,a=Cp,o=Mp,u=null;function s(){var s,l,f=+e.apply(this,arguments),c=+t.apply(this,arguments),d=i.apply(this,arguments)-xp,h=a.apply(this,arguments)-xp,v=dp(h-d),p=h>d;if(!u)u=s=fp();if(c<f)l=c,c=f,f=l;if(!(c>_p))u.moveTo(0,0);else if(v>wp-_p){u.moveTo(c*vp(d),c*mp(d));u.arc(0,0,c,d,h,!p);if(f>_p){u.moveTo(f*vp(h),f*mp(h));u.arc(0,0,f,h,d,p)}}else{var g=d,m=h,y=d,_=h,b=v,x=v,w=o.apply(this,arguments)/2,k=w>_p&&(r?+r.apply(this,arguments):yp(f*f+c*c)),A=gp(dp(c-f)/2,+n.apply(this,arguments)),E=A,D=A,S,C;if(k>_p){var M=Ap(k/f*mp(w)),F=Ap(k/c*mp(w));if((b-=M*2)>_p)M*=p?1:-1,y+=M,_-=M;else b=0,y=_=(d+h)/2;if((x-=F*2)>_p)F*=p?1:-1,g+=F,m-=F;else x=0,g=m=(d+h)/2}var O=c*vp(g),N=c*mp(g),T=f*vp(_),z=f*mp(_);if(A>_p){var R=c*vp(m),P=c*mp(m),L=f*vp(y),j=f*mp(y),B;if(v<bp&&(B=Fp(O,N,L,j,R,P,T,z))){var I=O-B[0],U=N-B[1],q=R-B[0],W=P-B[1],H=1/mp(kp((I*q+U*W)/(yp(I*I+U*U)*yp(q*q+W*W)))/2),G=yp(B[0]*B[0]+B[1]*B[1]);E=gp(A,(f-G)/(H-1));D=gp(A,(c-G)/(H+1))}}if(!(x>_p))u.moveTo(O,N);else if(D>_p){S=Op(L,j,O,N,c,D,p);C=Op(R,P,T,z,c,D,p);u.moveTo(S.cx+S.x01,S.cy+S.y01);if(D<A)u.arc(S.cx,S.cy,D,hp(S.y01,S.x01),hp(C.y01,C.x01),!p);else{u.arc(S.cx,S.cy,D,hp(S.y01,S.x01),hp(S.y11,S.x11),!p);u.arc(0,0,c,hp(S.cy+S.y11,S.cx+S.x11),hp(C.cy+C.y11,C.cx+C.x11),!p);u.arc(C.cx,C.cy,D,hp(C.y11,C.x11),hp(C.y01,C.x01),!p)}}else u.moveTo(O,N),u.arc(0,0,c,g,m,!p);if(!(f>_p)||!(b>_p))u.lineTo(T,z);else if(E>_p){S=Op(T,z,R,P,f,-E,p);C=Op(O,N,L,j,f,-E,p);u.lineTo(S.cx+S.x01,S.cy+S.y01);if(E<A)u.arc(S.cx,S.cy,E,hp(S.y01,S.x01),hp(C.y01,C.x01),!p);else{u.arc(S.cx,S.cy,E,hp(S.y01,S.x01),hp(S.y11,S.x11),!p);u.arc(0,0,f,hp(S.cy+S.y11,S.cx+S.x11),hp(C.cy+C.y11,C.cx+C.x11),p);u.arc(C.cx,C.cy,E,hp(C.y11,C.x11),hp(C.y01,C.x01),!p)}}else u.arc(0,0,f,_,y,p)}u.closePath();if(s)return u=null,s+""||null}s.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-bp/2;return[vp(r)*n,mp(r)*n]};s.innerRadius=function(t){return arguments.length?(e=typeof t==="function"?t:cp(+t),s):e};s.outerRadius=function(e){return arguments.length?(t=typeof e==="function"?e:cp(+e),s):t};s.cornerRadius=function(e){return arguments.length?(n=typeof e==="function"?e:cp(+e),s):n};s.padRadius=function(e){return arguments.length?(r=e==null?null:typeof e==="function"?e:cp(+e),s):r};s.startAngle=function(e){return arguments.length?(i=typeof e==="function"?e:cp(+e),s):i};s.endAngle=function(e){return arguments.length?(a=typeof e==="function"?e:cp(+e),s):a};s.padAngle=function(e){return arguments.length?(o=typeof e==="function"?e:cp(+e),s):o};s.context=function(e){return arguments.length?(u=e==null?null:e,s):u};return s}function Tp(e){return typeof e==="object"&&"length"in e?e:Array.from(e)}function zp(e){this._context=e}zp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Rp(e){return new zp(e)}function Pp(e){return e[0]}function Lp(e){return e[1]}function jp(e,t){var n=cp(true),r=null,i=Rp,a=null;e=typeof e==="function"?e:e===undefined?Pp:cp(e);t=typeof t==="function"?t:t===undefined?Lp:cp(t);function o(o){var u,s=(o=Tp(o)).length,l,f=false,c;if(r==null)a=i(c=fp());for(u=0;u<=s;++u){if(!(u<s&&n(l=o[u],u,o))===f){if(f=!f)a.lineStart();else a.lineEnd()}if(f)a.point(+e(l,u,o),+t(l,u,o))}if(c)return a=null,c+""||null}o.x=function(t){return arguments.length?(e=typeof t==="function"?t:cp(+t),o):e};o.y=function(e){return arguments.length?(t=typeof e==="function"?e:cp(+e),o):t};o.defined=function(e){return arguments.length?(n=typeof e==="function"?e:cp(!!e),o):n};o.curve=function(e){return arguments.length?(i=e,r!=null&&(a=i(r)),o):i};o.context=function(e){return arguments.length?(e==null?r=a=null:a=i(r=e),o):r};return o}function Bp(e,t,n){var r=null,i=cp(true),a=null,o=Rp,u=null;e=typeof e==="function"?e:e===undefined?Pp:cp(+e);t=typeof t==="function"?t:t===undefined?cp(0):cp(+t);n=typeof n==="function"?n:n===undefined?Lp:cp(+n);function s(s){var l,f,c,d=(s=Tp(s)).length,h,v=false,p,g=new Array(d),m=new Array(d);if(a==null)u=o(p=fp());for(l=0;l<=d;++l){if(!(l<d&&i(h=s[l],l,s))===v){if(v=!v){f=l;u.areaStart();u.lineStart()}else{u.lineEnd();u.lineStart();for(c=l-1;c>=f;--c){u.point(g[c],m[c])}u.lineEnd();u.areaEnd()}}if(v){g[l]=+e(h,l,s),m[l]=+t(h,l,s);u.point(r?+r(h,l,s):g[l],n?+n(h,l,s):m[l])}}if(p)return u=null,p+""||null}function l(){return jp().defined(i).curve(o).context(a)}s.x=function(t){return arguments.length?(e=typeof t==="function"?t:cp(+t),r=null,s):e};s.x0=function(t){return arguments.length?(e=typeof t==="function"?t:cp(+t),s):e};s.x1=function(e){return arguments.length?(r=e==null?null:typeof e==="function"?e:cp(+e),s):r};s.y=function(e){return arguments.length?(t=typeof e==="function"?e:cp(+e),n=null,s):t};s.y0=function(e){return arguments.length?(t=typeof e==="function"?e:cp(+e),s):t};s.y1=function(e){return arguments.length?(n=e==null?null:typeof e==="function"?e:cp(+e),s):n};s.lineX0=s.lineY0=function(){return l().x(e).y(t)};s.lineY1=function(){return l().x(e).y(n)};s.lineX1=function(){return l().x(r).y(t)};s.defined=function(e){return arguments.length?(i=typeof e==="function"?e:cp(!!e),s):i};s.curve=function(e){return arguments.length?(o=e,a!=null&&(u=o(a)),s):o};s.context=function(e){return arguments.length?(e==null?a=u=null:u=o(a=e),s):a};return s}var Ip={draw:function(e,t){var n=Math.sqrt(t/bp);e.moveTo(n,0);e.arc(0,0,n,0,wp)}};function Up(e,t){var n=null;e=typeof e==="function"?e:cp(e||Ip);t=typeof t==="function"?t:cp(t===undefined?64:+t);function r(){var r;if(!n)n=r=fp();e.apply(this,arguments).draw(n,+t.apply(this,arguments));if(r)return n=null,r+""||null}r.type=function(t){return arguments.length?(e=typeof t==="function"?t:cp(t),r):e};r.size=function(e){return arguments.length?(t=typeof e==="function"?e:cp(+e),r):t};r.context=function(e){return arguments.length?(n=e==null?null:e,r):n};return r}function qp(){}function Wp(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Hp(e){this._context=e}Hp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){switch(this._point){case 3:Wp(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Wp(this,e,t);break}this._x0=this._x1,this._x1=e;this._y0=this._y1,this._y1=t}};function Gp(e){return new Hp(e)}function $p(e){this._context=e}$p.prototype={areaStart:qp,areaEnd:qp,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2);this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3);this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3);this._context.closePath();break}case 3:{this.point(this._x2,this._y2);this.point(this._x3,this._y3);this.point(this._x4,this._y4);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._x2=e,this._y2=t;break;case 1:this._point=2;this._x3=e,this._y3=t;break;case 2:this._point=3;this._x4=e,this._y4=t;this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Wp(this,e,t);break}this._x0=this._x1,this._x1=e;this._y0=this._y1,this._y1=t}};function Vp(e){return new $p(e)}function Yp(e){this._context=e}Yp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Wp(this,e,t);break}this._x0=this._x1,this._x1=e;this._y0=this._y1,this._y1=t}};function Xp(e){return new Yp(e)}function Jp(e,t){this._basis=new Hp(e);this._beta=t}Jp.prototype={lineStart:function(){this._x=[];this._y=[];this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0){var r=e[0],i=t[0],a=e[n]-r,o=t[n]-i,u=-1,s;while(++u<=n){s=u/n;this._basis.point(this._beta*e[u]+(1-this._beta)*(r+s*a),this._beta*t[u]+(1-this._beta)*(i+s*o))}}this._x=this._y=null;this._basis.lineEnd()},point:function(e,t){this._x.push(+e);this._y.push(+t)}};var Qp=function e(t){function n(e){return t===1?new Hp(e):new Jp(e,t)}n.beta=function(t){return e(+t)};return n}(.85);function Zp(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Kp(e,t){this._context=e;this._k=(1-t)/6}Kp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Zp(this,this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;this._x1=e,this._y1=t;break;case 2:this._point=3;default:Zp(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var eg=function e(t){function n(e){return new Kp(e,t)}n.tension=function(t){return e(+t)};return n}(0);function tg(e,t){this._context=e;this._k=(1-t)/6}tg.prototype={areaStart:qp,areaEnd:qp,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._x3=e,this._y3=t;break;case 1:this._point=2;this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3;this._x5=e,this._y5=t;break;default:Zp(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ng=function e(t){function n(e){return new tg(e,t)}n.tension=function(t){return e(+t)};return n}(0);function rg(e,t){this._context=e;this._k=(1-t)/6}rg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Zp(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ig=function e(t){function n(e){return new rg(e,t)}n.tension=function(t){return e(+t)};return n}(0);function ag(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>_p){var u=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,s=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*u-e._x0*e._l12_2a+e._x2*e._l01_2a)/s;i=(i*u-e._y0*e._l12_2a+e._y2*e._l01_2a)/s}if(e._l23_a>_p){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,f=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*l+e._x1*e._l23_2a-t*e._l12_2a)/f;o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/f}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function og(e,t){this._context=e;this._alpha=t}og.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;if(this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:ag(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ug=function e(t){function n(e){return t?new og(e,t):new Kp(e,0)}n.alpha=function(t){return e(+t)};return n}(.5);function sg(e,t){this._context=e;this._alpha=t}sg.prototype={areaStart:qp,areaEnd:qp,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;if(this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;this._x3=e,this._y3=t;break;case 1:this._point=2;this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3;this._x5=e,this._y5=t;break;default:ag(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var lg=function e(t){function n(e){return t?new sg(e,t):new tg(e,0)}n.alpha=function(t){return e(+t)};return n}(.5);function fg(e,t){this._context=e;this._alpha=t}fg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;if(this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ag(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var cg=function e(t){function n(e){return t?new fg(e,t):new rg(e,0)}n.alpha=function(t){return e(+t)};return n}(.5);function dg(e){this._context=e}dg.prototype={areaStart:qp,areaEnd:qp,lineStart:function(){this._point=0},lineEnd:function(){if(this._point)this._context.closePath()},point:function(e,t){e=+e,t=+t;if(this._point)this._context.lineTo(e,t);else this._point=1,this._context.moveTo(e,t)}};function hg(e){return new dg(e)}function vg(e){return e<0?-1:1}function pg(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),u=(a*i+o*r)/(r+i);return(vg(a)+vg(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(u))||0}function gg(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function mg(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,u=(a-r)/3;e._context.bezierCurveTo(r+u,i+u*t,a-u,o-u*n,a,o)}function yg(e){this._context=e}yg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:mg(this,this._t0,gg(this,this._t0));break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){var n=NaN;e=+e,t=+t;if(e===this._x1&&t===this._y1)return;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;mg(this,gg(this,n=pg(this,e,t)),n);break;default:mg(this,this._t0,n=pg(this,e,t));break}this._x0=this._x1,this._x1=e;this._y0=this._y1,this._y1=t;this._t0=n}};function _g(e){this._context=new bg(e)}(_g.prototype=Object.create(yg.prototype)).point=function(e,t){yg.prototype.point.call(this,t,e)};function bg(e){this._context=e}bg.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}};function xg(e){return new yg(e)}function wg(e){return new _g(e)}function kg(e){this._context=e}kg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[];this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n){this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]);if(n===2){this._context.lineTo(e[1],t[1])}else{var r=Ag(e),i=Ag(t);for(var a=0,o=1;o<n;++a,++o){this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o])}}}if(this._line||this._line!==0&&n===1)this._context.closePath();this._line=1-this._line;this._x=this._y=null},point:function(e,t){this._x.push(+e);this._y.push(+t)}};function Ag(e){var t,n=e.length-1,r,i=new Array(n),a=new Array(n),o=new Array(n);i[0]=0,a[0]=2,o[0]=e[0]+2*e[1];for(t=1;t<n-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];i[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n];for(t=1;t<n;++t)r=i[t]/a[t-1],a[t]-=r,o[t]-=r*o[t-1];i[n-1]=o[n-1]/a[n-1];for(t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];a[n-1]=(e[n]+i[n-1])/2;for(t=0;t<n-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function Eg(e){return new kg(e)}function Dg(e,t){this._context=e;this._t=t}Dg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN;this._point=0},lineEnd:function(){if(0<this._t&&this._t<1&&this._point===2)this._context.lineTo(this._x,this._y);if(this._line||this._line!==0&&this._point===1)this._context.closePath();if(this._line>=0)this._t=1-this._t,this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0){this._context.lineTo(this._x,t);this._context.lineTo(e,t)}else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y);this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function Sg(e){return new Dg(e,.5)}function Cg(e){return new Dg(e,0)}function Mg(e){return new Dg(e,1)}function Fg(e,t){if(typeof document!=="undefined"&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext){n.width=e;n.height=t;return n}}return null}var Og=function(){return typeof Image!=="undefined"?Image:null};function Ng(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Tg(e,t){switch(arguments.length){case 0:break;case 1:{if(typeof e==="function")this.interpolator(e);else this.range(e);break}default:{this.domain(e);if(typeof t==="function")this.interpolator(t);else this.range(t);break}}return this}var zg=Symbol("implicit");function Rg(){var e=new Map,t=[],n=[],r=zg;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==zg)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(var r=0,a=n;r<a.length;r++){var o=a[r];var u=o+"";if(e.has(u))continue;e.set(u,t.push(o))}return i};i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()};i.unknown=function(e){return arguments.length?(r=e,i):r};i.copy=function(){return Rg(t,n).unknown(r)};Ng.apply(i,arguments);return i}function Pg(e,t,n){e.prototype=t.prototype=n;n.constructor=e}function Lg(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function jg(){}var Bg=.7;var Ig=1/Bg;var Ug="\\s*([+-]?\\d+)\\s*",qg="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Wg="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Hg=/^#([0-9a-f]{3,8})$/,Gg=new RegExp("^rgb\\("+[Ug,Ug,Ug]+"\\)$"),$g=new RegExp("^rgb\\("+[Wg,Wg,Wg]+"\\)$"),Vg=new RegExp("^rgba\\("+[Ug,Ug,Ug,qg]+"\\)$"),Yg=new RegExp("^rgba\\("+[Wg,Wg,Wg,qg]+"\\)$"),Xg=new RegExp("^hsl\\("+[qg,Wg,Wg]+"\\)$"),Jg=new RegExp("^hsla\\("+[qg,Wg,Wg,qg]+"\\)$");var Qg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Pg(jg,tm,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Zg,formatHex:Zg,formatHsl:Kg,formatRgb:em,toString:em});function Zg(){return this.rgb().formatHex()}function Kg(){return cm(this).formatHsl()}function em(){return this.rgb().formatRgb()}function tm(e){var t,n;e=(e+"").trim().toLowerCase();return(t=Hg.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?nm(t):n===3?new om(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?rm(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?rm(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Gg.exec(e))?new om(t[1],t[2],t[3],1):(t=$g.exec(e))?new om(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Vg.exec(e))?rm(t[1],t[2],t[3],t[4]):(t=Yg.exec(e))?rm(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Xg.exec(e))?fm(t[1],t[2]/100,t[3]/100,1):(t=Jg.exec(e))?fm(t[1],t[2]/100,t[3]/100,t[4]):Qg.hasOwnProperty(e)?nm(Qg[e]):e==="transparent"?new om(NaN,NaN,NaN,0):null}function nm(e){return new om(e>>16&255,e>>8&255,e&255,1)}function rm(e,t,n,r){if(r<=0)e=t=n=NaN;return new om(e,t,n,r)}function im(e){if(!(e instanceof jg))e=tm(e);if(!e)return new om;e=e.rgb();return new om(e.r,e.g,e.b,e.opacity)}function am(e,t,n,r){return arguments.length===1?im(e):new om(e,t,n,r==null?1:r)}function om(e,t,n,r){this.r=+e;this.g=+t;this.b=+n;this.opacity=+r}Pg(om,am,Lg(jg,{brighter:function(e){e=e==null?Ig:Math.pow(Ig,e);return new om(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){e=e==null?Bg:Math.pow(Bg,e);return new om(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&(-.5<=this.g&&this.g<255.5)&&(-.5<=this.b&&this.b<255.5)&&(0<=this.opacity&&this.opacity<=1)},hex:um,formatHex:um,formatRgb:sm,toString:sm}));function um(){return"#"+lm(this.r)+lm(this.g)+lm(this.b)}function sm(){var e=this.opacity;e=isNaN(e)?1:Math.max(0,Math.min(1,e));return(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function lm(e){e=Math.max(0,Math.min(255,Math.round(e)||0));return(e<16?"0":"")+e.toString(16)}function fm(e,t,n,r){if(r<=0)e=t=n=NaN;else if(n<=0||n>=1)e=t=NaN;else if(t<=0)e=NaN;return new hm(e,t,n,r)}function cm(e){if(e instanceof hm)return new hm(e.h,e.s,e.l,e.opacity);if(!(e instanceof jg))e=tm(e);if(!e)return new hm;if(e instanceof hm)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,u=a-i,s=(a+i)/2;if(u){if(t===a)o=(n-r)/u+(n<r)*6;else if(n===a)o=(r-t)/u+2;else o=(t-n)/u+4;u/=s<.5?a+i:2-a-i;o*=60}else{u=s>0&&s<1?0:o}return new hm(o,u,s,e.opacity)}function dm(e,t,n,r){return arguments.length===1?cm(e):new hm(e,t,n,r==null?1:r)}function hm(e,t,n,r){this.h=+e;this.s=+t;this.l=+n;this.opacity=+r}Pg(hm,dm,Lg(jg,{brighter:function(e){e=e==null?Ig:Math.pow(Ig,e);return new hm(this.h,this.s,this.l*e,this.opacity)},darker:function(e){e=e==null?Bg:Math.pow(Bg,e);return new hm(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new om(vm(e>=240?e-240:e+120,i,r),vm(e,i,r),vm(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&(0<=this.l&&this.l<=1)&&(0<=this.opacity&&this.opacity<=1)},formatHsl:function(){var e=this.opacity;e=isNaN(e)?1:Math.max(0,Math.min(1,e));return(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function vm(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var pm=Math.PI/180;var gm=180/Math.PI;var mm=18,ym=.96422,_m=1,bm=.82521,xm=4/29,wm=6/29,km=3*wm*wm,Am=wm*wm*wm;function Em(e){if(e instanceof Sm)return new Sm(e.l,e.a,e.b,e.opacity);if(e instanceof zm)return Rm(e);if(!(e instanceof om))e=im(e);var t=Om(e.r),n=Om(e.g),r=Om(e.b),i=Cm((.2225045*t+.7168786*n+.0606169*r)/_m),a,o;if(t===n&&n===r)a=o=i;else{a=Cm((.4360747*t+.3850649*n+.1430804*r)/ym);o=Cm((.0139322*t+.0971045*n+.7141733*r)/bm)}return new Sm(116*i-16,500*(a-i),200*(i-o),e.opacity)}function Dm(e,t,n,r){return arguments.length===1?Em(e):new Sm(e,t,n,r==null?1:r)}function Sm(e,t,n,r){this.l=+e;this.a=+t;this.b=+n;this.opacity=+r}Pg(Sm,Dm,Lg(jg,{brighter:function(e){return new Sm(this.l+mm*(e==null?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Sm(this.l-mm*(e==null?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;t=ym*Mm(t);e=_m*Mm(e);n=bm*Mm(n);return new om(Fm(3.1338561*t-1.6168667*e-.4906146*n),Fm(-.9787684*t+1.9161415*e+.033454*n),Fm(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Cm(e){return e>Am?Math.pow(e,1/3):e/km+xm}function Mm(e){return e>wm?e*e*e:km*(e-xm)}function Fm(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Om(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Nm(e){if(e instanceof zm)return new zm(e.h,e.c,e.l,e.opacity);if(!(e instanceof Sm))e=Em(e);if(e.a===0&&e.b===0)return new zm(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*gm;return new zm(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Tm(e,t,n,r){return arguments.length===1?Nm(e):new zm(e,t,n,r==null?1:r)}function zm(e,t,n,r){this.h=+e;this.c=+t;this.l=+n;this.opacity=+r}function Rm(e){if(isNaN(e.h))return new Sm(e.l,0,0,e.opacity);var t=e.h*pm;return new Sm(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Pg(zm,Tm,Lg(jg,{brighter:function(e){return new zm(this.h,this.c,this.l+mm*(e==null?1:e),this.opacity)},darker:function(e){return new zm(this.h,this.c,this.l-mm*(e==null?1:e),this.opacity)},rgb:function(){return Rm(this).rgb()}}));var Pm=-.14861,Lm=+1.78277,jm=-.29227,Bm=-.90649,Im=+1.97294,Um=Im*Bm,qm=Im*Lm,Wm=Lm*jm-Bm*Pm;function Hm(e){if(e instanceof $m)return new $m(e.h,e.s,e.l,e.opacity);if(!(e instanceof om))e=im(e);var t=e.r/255,n=e.g/255,r=e.b/255,i=(Wm*r+Um*t-qm*n)/(Wm+Um-qm),a=r-i,o=(Im*(n-i)-jm*a)/Bm,u=Math.sqrt(o*o+a*a)/(Im*i*(1-i)),s=u?Math.atan2(o,a)*gm-120:NaN;return new $m(s<0?s+360:s,u,i,e.opacity)}function Gm(e,t,n,r){return arguments.length===1?Hm(e):new $m(e,t,n,r==null?1:r)}function $m(e,t,n,r){this.h=+e;this.s=+t;this.l=+n;this.opacity=+r}Pg($m,Gm,Lg(jg,{brighter:function(e){e=e==null?Ig:Math.pow(Ig,e);return new $m(this.h,this.s,this.l*e,this.opacity)},darker:function(e){e=e==null?Bg:Math.pow(Bg,e);return new $m(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*pm,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new om(255*(t+n*(Pm*r+Lm*i)),255*(t+n*(jm*r+Bm*i)),255*(t+n*(Im*r)),this.opacity)}}));function Vm(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function Ym(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,u=r<t-1?e[r+2]:2*a-i;return Vm((n-r/t)*t,o,i,a,u)}}function Xm(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],u=e[(r+2)%t];return Vm((n-r/t)*t,i,a,o,u)}}var Jm=function(e){return function(){return e}};function Qm(e,t){return function(n){return e+n*t}}function Zm(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function Km(e,t){var n=t-e;return n?Qm(e,n>180||n<-180?n-360*Math.round(n/360):n):Jm(isNaN(e)?t:e)}function ey(e){return(e=+e)===1?ty:function(t,n){return n-t?Zm(t,n,e):Jm(isNaN(t)?n:t)}}function ty(e,t){var n=t-e;return n?Qm(e,n):Jm(isNaN(e)?t:e)}var ny=function e(t){var n=ey(t);function r(e,t){var r=n((e=am(e)).r,(t=am(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=ty(e.opacity,t.opacity);return function(t){e.r=r(t);e.g=i(t);e.b=a(t);e.opacity=o(t);return e+""}}r.gamma=e;return r}(1);function ry(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),a=new Array(n),o,u;for(o=0;o<n;++o){u=am(t[o]);r[o]=u.r||0;i[o]=u.g||0;a[o]=u.b||0}r=e(r);i=e(i);a=e(a);u.opacity=1;return function(e){u.r=r(e);u.g=i(e);u.b=a(e);return u+""}}}var iy=ry(Ym);var ay=ry(Xm);function oy(e,t){if(!t)t=[];var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=e[i]*(1-a)+t[i]*a;return r}}function uy(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function sy(e,t){return(uy(t)?oy:ly)(e,t)}function ly(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=yy(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(e){for(o=0;o<r;++o)a[o]=i[o](e);return a}}function fy(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function cy(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function dy(e,t){var n={},r={},i;if(e===null||typeof e!=="object")e={};if(t===null||typeof t!=="object")t={};for(i in t){if(i in e){n[i]=yy(e[i],t[i])}else{r[i]=t[i]}}return function(e){for(i in n)r[i]=n[i](e);return r}}var hy=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,vy=new RegExp(hy.source,"g");function py(e){return function(){return e}}function gy(e){return function(t){return e(t)+""}}function my(e,t){var n=hy.lastIndex=vy.lastIndex=0,r,i,a,o=-1,u=[],s=[];e=e+"",t=t+"";while((r=hy.exec(e))&&(i=vy.exec(t))){if((a=i.index)>n){a=t.slice(n,a);if(u[o])u[o]+=a;else u[++o]=a}if((r=r[0])===(i=i[0])){if(u[o])u[o]+=i;else u[++o]=i}else{u[++o]=null;s.push({i:o,x:cy(r,i)})}n=vy.lastIndex}if(n<t.length){a=t.slice(n);if(u[o])u[o]+=a;else u[++o]=a}return u.length<2?s[0]?gy(s[0].x):py(t):(t=s.length,function(e){for(var n=0,r;n<t;++n)u[(r=s[n]).i]=r.x(e);return u.join("")})}function yy(e,t){var n=typeof t,r;return t==null||n==="boolean"?Jm(t):(n==="number"?cy:n==="string"?(r=tm(t))?(t=r,ny):my:t instanceof tm?ny:t instanceof Date?fy:uy(t)?oy:Array.isArray(t)?ly:typeof t.valueOf!=="function"&&typeof t.toString!=="function"||isNaN(t)?dy:cy)(e,t)}function _y(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function by(e,t){var n=Km(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}}function xy(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var wy=180/Math.PI;var ky={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ay(e,t,n,r,i,a){var o,u,s;if(o=Math.sqrt(e*e+t*t))e/=o,t/=o;if(s=e*n+t*r)n-=e*s,r-=t*s;if(u=Math.sqrt(n*n+r*r))n/=u,r/=u,s/=u;if(e*r<t*n)e=-e,t=-t,s=-s,o=-o;return{translateX:i,translateY:a,rotate:Math.atan2(t,e)*wy,skewX:Math.atan(s)*wy,scaleX:o,scaleY:u}}var Ey;function Dy(e){var t=new(typeof DOMMatrix==="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ky:Ay(t.a,t.b,t.c,t.d,t.e,t.f)}function Sy(e){if(e==null)return ky;if(!Ey)Ey=document.createElementNS("http://www.w3.org/2000/svg","g");Ey.setAttribute("transform",e);if(!(e=Ey.transform.baseVal.consolidate()))return ky;e=e.matrix;return Ay(e.a,e.b,e.c,e.d,e.e,e.f)}function Cy(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}function a(e,r,i,a,o,u){if(e!==i||r!==a){var s=o.push("translate(",null,t,null,n);u.push({i:s-4,x:cy(e,i)},{i:s-2,x:cy(r,a)})}else if(i||a){o.push("translate("+i+t+a+n)}}function o(e,t,n,a){if(e!==t){if(e-t>180)t+=360;else if(t-e>180)e+=360;a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:cy(e,t)})}else if(t){n.push(i(n)+"rotate("+t+r)}}function u(e,t,n,a){if(e!==t){a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:cy(e,t)})}else if(t){n.push(i(n)+"skewX("+t+r)}}function s(e,t,n,r,a,o){if(e!==n||t!==r){var u=a.push(i(a)+"scale(",null,",",null,")");o.push({i:u-4,x:cy(e,n)},{i:u-2,x:cy(t,r)})}else if(n!==1||r!==1){a.push(i(a)+"scale("+n+","+r+")")}}return function(t,n){var r=[],i=[];t=e(t),n=e(n);a(t.translateX,t.translateY,n.translateX,n.translateY,r,i);o(t.rotate,n.rotate,r,i);u(t.skewX,n.skewX,r,i);s(t.scaleX,t.scaleY,n.scaleX,n.scaleY,r,i);t=n=null;return function(e){var t=-1,n=i.length,a;while(++t<n)r[(a=i[t]).i]=a.x(e);return r.join("")}}}var My=Cy(Dy,"px, ","px)","deg)");var Fy=Cy(Sy,", ",")",")");var Oy=1e-12;function Ny(e){return((e=Math.exp(e))+1/e)/2}function Ty(e){return((e=Math.exp(e))-1/e)/2}function zy(e){return((e=Math.exp(2*e))-1)/(e+1)}var Ry=function e(t,n,r){function i(e,i){var a=e[0],o=e[1],u=e[2],s=i[0],l=i[1],f=i[2],c=s-a,d=l-o,h=c*c+d*d,v,p;if(h<Oy){p=Math.log(f/u)/t;v=function(e){return[a+e*c,o+e*d,u*Math.exp(t*e*p)]}}else{var g=Math.sqrt(h),m=(f*f-u*u+r*h)/(2*u*n*g),y=(f*f-u*u-r*h)/(2*f*n*g),_=Math.log(Math.sqrt(m*m+1)-m),b=Math.log(Math.sqrt(y*y+1)-y);p=(b-_)/t;v=function(e){var r=e*p,i=Ny(_),s=u/(n*g)*(i*zy(t*r+_)-Ty(_));return[a+s*c,o+s*d,u*i/Ny(t*r+_)]}}v.duration=p*1e3*t/Math.SQRT2;return v}i.rho=function(t){var n=Math.max(.001,+t),r=n*n,i=r*r;return e(n,r,i)};return i}(Math.SQRT2,2,4);function Py(e){return function(t,n){var r=e((t=dm(t)).h,(n=dm(n)).h),i=ty(t.s,n.s),a=ty(t.l,n.l),o=ty(t.opacity,n.opacity);return function(e){t.h=r(e);t.s=i(e);t.l=a(e);t.opacity=o(e);return t+""}}}var Ly=Py(Km);var jy=Py(ty);function By(e,t){var n=ty((e=Dm(e)).l,(t=Dm(t)).l),r=ty(e.a,t.a),i=ty(e.b,t.b),a=ty(e.opacity,t.opacity);return function(t){e.l=n(t);e.a=r(t);e.b=i(t);e.opacity=a(t);return e+""}}function Iy(e){return function(t,n){var r=e((t=Tm(t)).h,(n=Tm(n)).h),i=ty(t.c,n.c),a=ty(t.l,n.l),o=ty(t.opacity,n.opacity);return function(e){t.h=r(e);t.c=i(e);t.l=a(e);t.opacity=o(e);return t+""}}}var Uy=Iy(Km);var qy=Iy(ty);function Wy(e){return function t(n){n=+n;function r(t,r){var i=e((t=Gm(t)).h,(r=Gm(r)).h),a=ty(t.s,r.s),o=ty(t.l,r.l),u=ty(t.opacity,r.opacity);return function(e){t.h=i(e);t.s=a(e);t.l=o(Math.pow(e,n));t.opacity=u(e);return t+""}}r.gamma=t;return r}(1)}var Hy=Wy(Km);var Gy=Wy(ty);function $y(e,t){if(t===undefined)t=e,e=yy;var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);while(n<r)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}function Vy(e,t){var n=new Array(t);for(var r=0;r<t;++r)n[r]=e(r/(t-1));return n}var Yy=Object.freeze({__proto__:null,interpolate:yy,interpolateArray:sy,interpolateBasis:Ym,interpolateBasisClosed:Xm,interpolateDate:fy,interpolateDiscrete:_y,interpolateHue:by,interpolateNumber:cy,interpolateNumberArray:oy,interpolateObject:dy,interpolateRound:xy,interpolateString:my,interpolateTransformCss:My,interpolateTransformSvg:Fy,interpolateZoom:Ry,interpolateRgb:ny,interpolateRgbBasis:iy,interpolateRgbBasisClosed:ay,interpolateHsl:Ly,interpolateHslLong:jy,interpolateLab:By,interpolateHcl:Uy,interpolateHclLong:qy,interpolateCubehelix:Hy,interpolateCubehelixLong:Gy,piecewise:$y,quantize:Vy});function Xy(e){return function(){return e}}function Jy(e){return+e}var Qy=[0,1];function Zy(e){return e}function Ky(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Xy(isNaN(t)?NaN:.5)}function e_(e,t){var n;if(e>t)n=e,e=t,t=n;return function(n){return Math.max(e,Math.min(t,n))}}function t_(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];if(i<r)r=Ky(i,r),a=n(o,a);else r=Ky(r,i),a=n(a,o);return function(e){return a(r(e))}}function n_(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;if(e[r]<e[0]){e=e.slice().reverse();t=t.slice().reverse()}while(++o<r){i[o]=Ky(e[o],e[o+1]);a[o]=n(t[o],t[o+1])}return function(t){var n=eo(e,t,1,r)-1;return a[n](i[n](t))}}function r_(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function i_(){var e=Qy,t=Qy,n=yy,r,i,a,o=Zy,u,s,l;function f(){var n=Math.min(e.length,t.length);if(o!==Zy)o=e_(e[0],e[n-1]);u=n>2?n_:t_;s=l=null;return c}function c(i){return i==null||isNaN(i=+i)?a:(s||(s=u(e.map(r),t,n)))(r(o(i)))}c.invert=function(n){return o(i((l||(l=u(t,e.map(r),cy)))(n)))};c.domain=function(t){return arguments.length?(e=Array.from(t,Jy),f()):e.slice()};c.range=function(e){return arguments.length?(t=Array.from(e),f()):t.slice()};c.rangeRound=function(e){return t=Array.from(e),n=xy,f()};c.clamp=function(e){return arguments.length?(o=e?true:Zy,f()):o!==Zy};c.interpolate=function(e){return arguments.length?(n=e,f()):n};c.unknown=function(e){return arguments.length?(a=e,c):a};return function(e,t){r=e,i=t;return f()}}function a_(){return i_()(Zy,Zy)}function o_(e,t,n,r){var i=co(e,t,n),a;r=Oo(r==null?",f":r);switch(r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));if(r.precision==null&&!isNaN(a=Vo(i,o)))r.precision=a;return Ho(r,o)}case"":case"e":case"g":case"p":case"r":{if(r.precision==null&&!isNaN(a=Yo(i,Math.max(Math.abs(e),Math.abs(t)))))r.precision=a-(r.type==="e");break}case"f":case"%":{if(r.precision==null&&!isNaN(a=$o(i)))r.precision=a-(r.type==="%")*2;break}}return Wo(r)}function u_(e){var t=e.domain;e.ticks=function(e){var n=t();return lo(n[0],n[n.length-1],e==null?10:e)};e.tickFormat=function(e,n){var r=t();return o_(r[0],r[r.length-1],e==null?10:e,n)};e.nice=function(n){if(n==null)n=10;var r=t();var i=0;var a=r.length-1;var o=r[i];var u=r[a];var s;var l;var f=10;if(u<o){l=o,o=u,u=l;l=i,i=a,a=l}while(f-- >0){l=fo(o,u,n);if(l===s){r[i]=o;r[a]=u;return t(r)}else if(l>0){o=Math.floor(o/l)*l;u=Math.ceil(u/l)*l}else if(l<0){o=Math.ceil(o*l)/l;u=Math.floor(u*l)/l}else{break}s=l}return e};return e}function s_(){var e=a_();e.copy=function(){return r_(e,s_())};Ng.apply(e,arguments);return u_(e)}function l_(e){var t;function n(e){return e==null||isNaN(e=+e)?t:e}n.invert=n;n.domain=n.range=function(t){return arguments.length?(e=Array.from(t,Jy),n):e.slice()};n.unknown=function(e){return arguments.length?(t=e,n):t};n.copy=function(){return l_(e).unknown(t)};e=arguments.length?Array.from(e,Jy):[0,1];return u_(n)}function f_(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],a=e[r],o;if(a<i){o=n,n=r,r=o;o=i,i=a,a=o}e[n]=t.floor(i);e[r]=t.ceil(a);return e}function c_(e){return Math.log(e)}function d_(e){return Math.exp(e)}function h_(e){return-Math.log(-e)}function v_(e){return-Math.exp(-e)}function p_(e){return isFinite(e)?+("1e"+e):e<0?0:e}function g_(e){return e===10?p_:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function m_(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function y_(e){return function(t){return-e(-t)}}function __(e){var t=e(c_,d_),n=t.domain,r=10,i,a;function o(){i=m_(r),a=g_(r);if(n()[0]<0){i=y_(i),a=y_(a);e(h_,v_)}else{e(c_,d_)}return t}t.base=function(e){return arguments.length?(r=+e,o()):r};t.domain=function(e){return arguments.length?(n(e),o()):n()};t.ticks=function(e){var t=n(),o=t[0],u=t[t.length-1],s;if(s=u<o)l=o,o=u,u=l;var l=i(o),f=i(u),c,d,h,v=e==null?10:+e,p=[];if(!(r%1)&&f-l<v){l=Math.floor(l),f=Math.ceil(f);if(o>0)for(;l<=f;++l){for(d=1,c=a(l);d<r;++d){h=c*d;if(h<o)continue;if(h>u)break;p.push(h)}}else for(;l<=f;++l){for(d=r-1,c=a(l);d>=1;--d){h=c*d;if(h<o)continue;if(h>u)break;p.push(h)}}if(p.length*2<v)p=lo(o,u,v)}else{p=lo(l,f,Math.min(f-l,v)).map(a)}return s?p.reverse():p};t.tickFormat=function(e,n){if(n==null)n=r===10?".0e":",";if(typeof n!=="function")n=Wo(n);if(e===Infinity)return n;if(e==null)e=10;var o=Math.max(1,r*e/t.ticks().length);return function(e){var t=e/a(Math.round(i(e)));if(t*r<r-.5)t*=r;return t<=o?n(e):""}};t.nice=function(){return n(f_(n(),{floor:function(e){return a(Math.floor(i(e)))},ceil:function(e){return a(Math.ceil(i(e)))}}))};return t}function b_(){var e=__(i_()).domain([1,10]);e.copy=function(){return r_(e,b_()).base(e.base())};Ng.apply(e,arguments);return e}function x_(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function w_(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function k_(e){var t=1,n=e(x_(t),w_(t));n.constant=function(n){return arguments.length?e(x_(t=+n),w_(t)):t};return u_(n)}function A_(){var e=k_(i_());e.copy=function(){return r_(e,A_()).constant(e.constant())};return Ng.apply(e,arguments)}function E_(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function D_(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function S_(e){return e<0?-e*e:e*e}function C_(e){var t=e(Zy,Zy),n=1;function r(){return n===1?e(Zy,Zy):n===.5?e(D_,S_):e(E_(n),E_(1/n))}t.exponent=function(e){return arguments.length?(n=+e,r()):n};return u_(t)}function M_(){var e=C_(i_());e.copy=function(){return r_(e,M_()).exponent(e.exponent())};Ng.apply(e,arguments);return e}function F_(){return M_.apply(null,arguments).exponent(.5)}function O_(){var e=[],t=[],n=[],r;function i(){var r=0,i=Math.max(1,t.length);n=new Array(i-1);while(++r<i)n[r-1]=yo(e,r/i);return a}function a(e){return e==null||isNaN(e=+e)?r:t[eo(n,e)]}a.invertExtent=function(r){var i=t.indexOf(r);return i<0?[NaN,NaN]:[i>0?n[i-1]:e[0],i<n.length?n[i]:e[e.length-1]]};a.domain=function(t){if(!arguments.length)return e.slice();e=[];for(var n=0,r=t;n<r.length;n++){var a=r[n];if(a!=null&&!isNaN(a=+a))e.push(a)}e.sort(Ya);return i()};a.range=function(e){return arguments.length?(t=Array.from(e),i()):t.slice()};a.unknown=function(e){return arguments.length?(r=e,a):r};a.quantiles=function(){return n.slice()};a.copy=function(){return O_().domain(e).range(t).unknown(r)};return Ng.apply(a,arguments)}function N_(){var e=0,t=1,n=1,r=[.5],i=[0,1],a;function o(e){return e!=null&&e<=e?i[eo(r,e,0,n)]:a}function u(){var i=-1;r=new Array(n);while(++i<n)r[i]=((i+1)*t-(i-n)*e)/(n+1);return o}o.domain=function(n){return arguments.length?(e=n[0],t=n[1],e=+e,t=+t,u()):[e,t]};o.range=function(e){return arguments.length?(n=(i=Array.from(e)).length-1,u()):i.slice()};o.invertExtent=function(a){var o=i.indexOf(a);return o<0?[NaN,NaN]:o<1?[e,r[0]]:o>=n?[r[n-1],t]:[r[o-1],r[o]]};o.unknown=function(e){return arguments.length?(a=e,o):o};o.thresholds=function(){return r.slice()};o.copy=function(){return N_().domain([e,t]).range(i).unknown(a)};return Ng.apply(u_(o),arguments)}function T_(){var e=[.5],t=[0,1],n,r=1;function i(i){return i!=null&&i<=i?t[eo(e,i,0,r)]:n}i.domain=function(n){return arguments.length?(e=Array.from(n),r=Math.min(e.length,t.length-1),i):e.slice()};i.range=function(n){return arguments.length?(t=Array.from(n),r=Math.min(e.length,t.length-1),i):t.slice()};i.invertExtent=function(n){var r=t.indexOf(n);return[e[r-1],e[r]]};i.unknown=function(e){return arguments.length?(n=e,i):n};i.copy=function(){return T_().domain(e).range(t).unknown(n)};return Ng.apply(i,arguments)}function z_(e){return new Date(e)}function R_(e){return e instanceof Date?+e:+new Date(+e)}function P_(e,t,n,r,i,a,o,u,s,l){var f=a_(),c=f.invert,d=f.domain;var h=l(".%L"),v=l(":%S"),p=l("%I:%M"),g=l("%I %p"),m=l("%a %d"),y=l("%b %d"),_=l("%B"),b=l("%Y");function x(e){return(s(e)<e?h:u(e)<e?v:o(e)<e?p:a(e)<e?g:r(e)<e?i(e)<e?m:y:n(e)<e?_:b)(e)}f.invert=function(e){return new Date(c(e))};f.domain=function(e){return arguments.length?d(Array.from(e,R_)):d().map(z_)};f.ticks=function(t){var n=d();return e(n[0],n[n.length-1],t==null?10:t)};f.tickFormat=function(e,t){return t==null?x:l(t)};f.nice=function(e){var n=d();if(!e||typeof e.range!=="function")e=t(n[0],n[n.length-1],e==null?10:e);return e?d(f_(n,e)):f};f.copy=function(){return r_(f,P_(e,t,n,r,i,a,o,u,s,l))};return f}function L_(){return Ng.apply(P_(Fu,Ou,pu,vu,cu,lu,su,uu,ou,hf).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function j_(){return Ng.apply(P_(Su,Cu,Au,ku,bu,yu,mu,gu,ou,pf).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function B_(){var e=0,t=1,n,r,i,a,o=Zy,u=false,s;function l(e){return e==null||isNaN(e=+e)?s:o(i===0?.5:(e=(a(e)-n)*i,u?Math.max(0,Math.min(1,e)):e))}l.domain=function(o){return arguments.length?(e=o[0],t=o[1],n=a(e=+e),r=a(t=+t),i=n===r?0:1/(r-n),l):[e,t]};l.clamp=function(e){return arguments.length?(u=!!e,l):u};l.interpolator=function(e){return arguments.length?(o=e,l):o};function f(e){return function(t){var n,r;return arguments.length?(n=t[0],r=t[1],o=e(n,r),l):[o(0),o(1)]}}l.range=f(yy);l.rangeRound=f(xy);l.unknown=function(e){return arguments.length?(s=e,l):s};return function(o){a=o,n=o(e),r=o(t),i=n===r?0:1/(r-n);return l}}function I_(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function U_(){var e=u_(B_()(Zy));e.copy=function(){return I_(e,U_())};return Tg.apply(e,arguments)}function q_(){var e=__(B_()).domain([1,10]);e.copy=function(){return I_(e,q_()).base(e.base())};return Tg.apply(e,arguments)}function W_(){var e=k_(B_());e.copy=function(){return I_(e,W_()).constant(e.constant())};return Tg.apply(e,arguments)}function H_(){var e=C_(B_());e.copy=function(){return I_(e,H_()).exponent(e.exponent())};return Tg.apply(e,arguments)}function G_(){return H_.apply(null,arguments).exponent(.5)}function $_(){var e=0,t=.5,n=1,r=1,i,a,o,u,s,l=Zy,f,c=false,d;function h(e){return isNaN(e=+e)?d:(e=.5+((e=+f(e))-a)*(r*e<r*a?u:s),l(c?Math.max(0,Math.min(1,e)):e))}h.domain=function(l){return arguments.length?(e=l[0],t=l[1],n=l[2],i=f(e=+e),a=f(t=+t),o=f(n=+n),u=i===a?0:.5/(a-i),s=a===o?0:.5/(o-a),r=a<i?-1:1,h):[e,t,n]};h.clamp=function(e){return arguments.length?(c=!!e,h):c};h.interpolator=function(e){return arguments.length?(l=e,h):l};function v(e){return function(t){var n,r,i;return arguments.length?(n=t[0],r=t[1],i=t[2],l=$y(e,[n,r,i]),h):[l(0),l(.5),l(1)]}}h.range=v(yy);h.rangeRound=v(xy);h.unknown=function(e){return arguments.length?(d=e,h):d};return function(l){f=l,i=l(e),a=l(t),o=l(n),u=i===a?0:.5/(a-i),s=a===o?0:.5/(o-a),r=a<i?-1:1;return h}}function V_(){var e=u_($_()(Zy));e.copy=function(){return I_(e,V_())};return Tg.apply(e,arguments)}function Y_(){var e=__($_()).domain([.1,1,10]);e.copy=function(){return I_(e,Y_()).base(e.base())};return Tg.apply(e,arguments)}function X_(){var e=k_($_());e.copy=function(){return I_(e,X_()).constant(e.constant())};return Tg.apply(e,arguments)}function J_(){var e=C_($_());e.copy=function(){return I_(e,J_()).exponent(e.exponent())};return Tg.apply(e,arguments)}function Q_(){return J_.apply(null,arguments).exponent(.5)}function Z_(e,t,n){var r=e-t+n*2;return e?r>0?r:1:0}var K_="identity";var eb="linear";var tb="log";var nb="pow";var rb="sqrt";var ib="symlog";var ab="time";var ob="utc";var ub="sequential";var sb="diverging";var lb="quantile";var fb="quantize";var cb="threshold";var db="ordinal";var hb="point";var vb="band";var pb="bin-ordinal";var gb="continuous";var mb="discrete";var yb="discretizing";var _b="interpolating";var bb="temporal";function xb(e){return function(t){var n=t[0],r=t[1],i;if(r<n){i=n;n=r;r=i}return[e.invert(n),e.invert(r)]}}function wb(e){return function(t){var n=e.range();var r=t[0],i=t[1],a=-1,o,u,s,l;if(i<r){u=r;r=i;i=u}for(s=0,l=n.length;s<l;++s){if(n[s]>=r&&n[s]<=i){if(a<0)a=s;o=s}}if(a<0)return undefined;r=e.invertExtent(n[a]);i=e.invertExtent(n[o]);return[r[0]===undefined?r[1]:r[0],i[1]===undefined?i[0]:i[1]]}}function kb(){var e=Rg().unknown(undefined),t=e.domain,n=e.range;var r=[0,1],i,a,o=false,u=0,s=0,l=.5;delete e.unknown;function f(){var e=t().length,f=r[1]<r[0],c=r[1-f],d=Z_(e,u,s);var h=r[f-0];i=(c-h)/(d||1);if(o){i=Math.floor(i)}h+=(c-h-i*(e-u))*l;a=i*(1-u);if(o){h=Math.round(h);a=Math.round(a)}var v=ko(e).map((function(e){return h+i*e}));return n(f?v.reverse():v)}e.domain=function(e){if(arguments.length){t(e);return f()}else{return t()}};e.range=function(e){if(arguments.length){r=[+e[0],+e[1]];return f()}else{return r.slice()}};e.rangeRound=function(e){r=[+e[0],+e[1]];o=true;return f()};e.bandwidth=function(){return a};e.step=function(){return i};e.round=function(e){if(arguments.length){o=!!e;return f()}else{return o}};e.padding=function(e){if(arguments.length){s=Math.max(0,Math.min(1,e));u=s;return f()}else{return u}};e.paddingInner=function(e){if(arguments.length){u=Math.max(0,Math.min(1,e));return f()}else{return u}};e.paddingOuter=function(e){if(arguments.length){s=Math.max(0,Math.min(1,e));return f()}else{return s}};e.align=function(e){if(arguments.length){l=Math.max(0,Math.min(1,e));return f()}else{return l}};e.invertRange=function(e){if(e[0]==null||e[1]==null)return;var i=r[1]<r[0],o=i?n().reverse():n(),u=o.length-1;var s=+e[0],l=+e[1],f,c,d;if(s!==s||l!==l)return;if(l<s){d=s;s=l;l=d}if(l<o[0]||s>r[1-i])return;f=Math.max(0,eo(o,s)-1);c=s===l?f:eo(o,l)-1;if(s-o[f]>a+1e-10)++f;if(i){d=f;f=u-c;c=u-d}return f>c?undefined:t().slice(f,c+1)};e.invert=function(t){var n=e.invertRange([t,t]);return n?n[0]:n};e.copy=function(){return kb().domain(t()).range(r).round(o).paddingInner(u).paddingOuter(s).align(l)};return f()}function Ab(e){var t=e.copy;e.padding=e.paddingOuter;delete e.paddingInner;e.copy=function(){return Ab(t())};return e}function Eb(){return Ab(kb().paddingInner(1))}var Db=Array.prototype.map;function Sb(e){return Db.call(e,qr)}var Cb=Array.prototype.slice;function Mb(){var e=[],t=[];function n(n){return n==null||n!==n?undefined:t[(eo(e,n)-1)%t.length]}n.domain=function(t){if(arguments.length){e=Sb(t);return n}else{return e.slice()}};n.range=function(e){if(arguments.length){t=Cb.call(e);return n}else{return t.slice()}};n.tickFormat=function(t,n){return o_(e[0],Ur(e),t==null?10:t,n)};n.copy=function(){return Mb().domain(n.domain()).range(n.range())};return n}var Fb={};function Ob(e,t,n){var r=function n(){var r=t();if(!r.invertRange){r.invertRange=r.invert?xb(r):r.invertExtent?wb(r):undefined}r.type=e;return r};r.metadata=$i(oi(n));return r}function Nb(e,t,n){if(arguments.length>1){Fb[e]=Ob(e,t,n);return this}else{return Tb(e)?Fb[e]:undefined}}Nb(K_,l_);Nb(eb,s_,gb);Nb(tb,b_,[gb,tb]);Nb(nb,M_,gb);Nb(rb,F_,gb);Nb(ib,A_,gb);Nb(ab,L_,[gb,bb]);Nb(ob,j_,[gb,bb]);Nb(ub,U_,[gb,_b]);Nb("".concat(ub,"-").concat(eb),U_,[gb,_b]);Nb("".concat(ub,"-").concat(tb),q_,[gb,_b,tb]);Nb("".concat(ub,"-").concat(nb),H_,[gb,_b]);Nb("".concat(ub,"-").concat(rb),G_,[gb,_b]);Nb("".concat(ub,"-").concat(ib),W_,[gb,_b]);Nb("".concat(sb,"-").concat(eb),V_,[gb,_b]);Nb("".concat(sb,"-").concat(tb),Y_,[gb,_b,tb]);Nb("".concat(sb,"-").concat(nb),J_,[gb,_b]);Nb("".concat(sb,"-").concat(rb),Q_,[gb,_b]);Nb("".concat(sb,"-").concat(ib),X_,[gb,_b]);Nb(lb,O_,[yb,lb]);Nb(fb,N_,yb);Nb(cb,T_,yb);Nb(pb,Mb,[mb,yb]);Nb(db,Rg,mb);Nb(vb,kb,mb);Nb(hb,Eb,mb);function Tb(e){return xi(Fb,e)}function zb(e,t){var n=Fb[e];return n&&n.metadata[t]}function Rb(e){return zb(e,gb)}function Pb(e){return zb(e,mb)}function Lb(e){return zb(e,yb)}function jb(e){return zb(e,tb)}function Bb(e){return zb(e,bb)}function Ib(e){return zb(e,_b)}function Ub(e){return zb(e,lb)}var qb=["clamp","base","constant","exponent"];function Wb(e,t){var n=t[0],r=Ur(t)-n;return function(t){return e(n+t*r)}}function Hb(e,t,n){return $y(Vb(t||"rgb",n),e)}function Gb(e,t){var n=new Array(t),r=t+1;for(var i=0;i<t;)n[i]=e(++i/r);return n}function $b(e,t,n){var r=n-t;var i,a,o;if(!r||!Number.isFinite(r)){return pi(.5)}else{i=(a=e.type).indexOf("-");a=i<0?a:a.slice(i+1);o=Nb(a)().domain([t,n]).range([0,1]);qb.forEach((function(t){return e[t]?o[t](e[t]()):0}));return o}}function Vb(e,t){var n=Yy[Yb(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function Yb(e){return"interpolate"+e.toLowerCase().split("-").map((function(e){return e[0].toUpperCase()+e.slice(1)})).join("")}var Xb={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"};var Jb={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function Qb(e){var t=e.length/6|0,n=new Array(t);for(var r=0;r<t;){n[r]="#"+e.slice(r*6,++r*6)}return n}function Zb(e,t){for(var n in e)ex(n,t(e[n]))}var Kb={};Zb(Jb,Qb);Zb(Xb,(function(e){return Hb(Qb(e))}));function ex(e,t){e=e&&e.toLowerCase();if(arguments.length>1){Kb[e]=t;return this}else{return Kb[e]}}var tx="symbol";var nx="discrete";var rx="gradient";var ix=function(e){return Rr(e)?e.map((function(e){return String(e)})):String(e)};var ax=function(e,t){return e[1]-t[1]};var ox=function(e,t){return t[1]-e[1]};function ux(e,t,n){var r;if(Fi(t)){if(e.bins){t=Math.max(t,e.bins.length)}if(n!=null){t=Math.min(t,Math.floor(Ii(e.domain())/n||1))}}if(Pr(t)){r=t.step;t=t.interval}if(Ni(t)){t=e.type===ab?_s(t):e.type==ob?bs(t):_r("Only time and utc scales accept interval strings.");if(r)t=t.every(r)}return t}function sx(e,t,n){var r=e.range(),i=r[0],a=Ur(r),o=ax;if(i>a){r=a;a=i;i=r;o=ox}i=Math.floor(i);a=Math.ceil(a);t=t.map((function(t){return[t,e(t)]})).filter((function(e){return i<=e[1]&&e[1]<=a})).sort(o).map((function(e){return e[0]}));if(n>0&&t.length>1){var u=[t[0],Ur(t)];while(t.length>n&&t.length>=3){t=t.filter((function(e,t){return!(t%2)}))}if(t.length<3){t=u}}return t}function lx(e,t){return e.bins?sx(e,e.bins):e.ticks?e.ticks(t):e.domain()}function fx(e,t,n,r,i,a){var o=t.type;var u=ix;if(o===ab||i===ab){u=e.timeFormat(r)}else if(o===ob||i===ob){u=e.utcFormat(r)}else if(jb(o)){var s=e.formatFloat(r);if(a||t.bins){u=s}else{var l=cx(t,n,false);u=function(e){return l(e)?s(e):""}}}else if(t.tickFormat){var f=t.domain();u=e.formatSpan(f[0],f[f.length-1],n,r)}else if(r){u=e.format(r)}return u}function cx(e,t,n){var r=lx(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length);var u=function(e){var t=e/Math.pow(i,Math.round(Math.log(e)/a));if(t*i<i-.5)t*=i;return t<=o};return n?r.filter(u):u}var dx=(y={},y[lb]="quantiles",y[fb]="thresholds",y[cb]="domain",y);var hx=(_={},_[lb]="quantiles",_[fb]="domain",_);function vx(e,t){return e.bins?mx(e.bins):e.type===tb?cx(e,t,true):dx[e.type]?gx(e[dx[e.type]]()):lx(e,t)}function px(e,t,n){var r=t[hx[t.type]](),i=r.length;var a=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o){a=Math.min(a,r[o]-r[o-1])}return e.formatSpan(0,a,3*10,n)}function gx(e){var t=[-Infinity].concat(e);t.max=+Infinity;return t}function mx(e){var t=e.slice(0,-1);t.max=Ur(e);return t}var yx=function(e){return dx[e.type]||e.bins};function _x(e,t,n,r,i,a,o){var u=hx[t.type]&&a!==ab&&a!==ob?px(e,t,i):fx(e,t,n,i,a,o);return r===tx&&yx(t)?bx(u):r===nx?wx(u):kx(u)}var bx=function(e){return function(t,n,r){var i=xx(r[n+1],xx(r.max,+Infinity)),a=Ax(t,e),o=Ax(i,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a}};var xx=function(e,t){return e!=null?e:t};var wx=function(e){return function(t,n){return n?e(t):null}};var kx=function(e){return function(t){return e(t)}};var Ax=function(e,t){return Number.isFinite(e)?t(e):null};function Ex(e){var t=e.domain(),n=t.length-1;var r=+t[0],i=+Ur(t),a=i-r;if(e.type===cb){var o=n?a/n:.1;r-=o;i+=o;a=i-r}return function(e){return(e-r)/a}}function Dx(e,t,n,r){var i=r||t.type;if(Ni(n)&&Bb(i)){n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")}return!n&&i===ab?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===ob?e.utcFormat("%A, %d %B %Y, %X UTC"):_x(e,t,5,null,n,r,true)}function Sx(e,t,n){n=n||{};var r=Math.max(3,n.maxlen||7),i=Dx(e,t,n.format,n.formatType);if(Lb(t.type)){var a=vx(t).slice(1).map(i),o=a.length;return"".concat(o," boundar").concat(o===1?"y":"ies",": ").concat(a.join(", "))}else if(Pb(t.type)){var u=t.domain(),o=u.length,a=o>r?u.slice(0,r-2).map(i).join(", ")+", ending with "+u.slice(-1).map(i):u.map(i).join(", ");return"".concat(o," value").concat(o===1?"":"s",": ").concat(a)}else{var u=t.domain();return"values from ".concat(i(u[0])," to ").concat(i(Ur(u)))}}var Cx=0;function Mx(){Cx=0}var Fx="p_";function Ox(e){return e&&e.gradient}function Nx(e,t,n){var r=e.gradient;var i=e.id,a=r==="radial"?Fx:"";if(!i){i=e.id="gradient_"+Cx++;if(r==="radial"){e.x1=Tx(e.x1,.5);e.y1=Tx(e.y1,.5);e.r1=Tx(e.r1,0);e.x2=Tx(e.x2,.5);e.y2=Tx(e.y2,.5);e.r2=Tx(e.r2,.5);a=Fx}else{e.x1=Tx(e.x1,0);e.y1=Tx(e.y1,0);e.x2=Tx(e.x2,1);e.y2=Tx(e.y2,0)}}t[i]=e;return"url("+(n||"")+"#"+a+i+")"}function Tx(e,t){return e!=null?e:t}function zx(e,t){var n=[],r;return r={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(e,t){n.push({offset:e,color:t});return r}}}var Rx={basis:{curve:Gp},"basis-closed":{curve:Vp},"basis-open":{curve:Xp},bundle:{curve:Qp,tension:"beta",value:.85},cardinal:{curve:eg,tension:"tension",value:0},"cardinal-open":{curve:ig,tension:"tension",value:0},"cardinal-closed":{curve:ng,tension:"tension",value:0},"catmull-rom":{curve:ug,tension:"alpha",value:.5},"catmull-rom-closed":{curve:lg,tension:"alpha",value:.5},"catmull-rom-open":{curve:cg,tension:"alpha",value:.5},linear:{curve:Rp},"linear-closed":{curve:hg},monotone:{horizontal:wg,vertical:xg},natural:{curve:Eg},step:{curve:Sg},"step-after":{curve:Mg},"step-before":{curve:Cg}};function Px(e,t,n){var r=xi(Rx,e)&&Rx[e],i=null;if(r){i=r.curve||r[t||"vertical"];if(r.tension&&n!=null){i=i[r.tension](n)}}return i}var Lx={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},jx=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Bx(e){var t=[];var n,r,i,a,o,u,s,l,f,c;var d=e.slice().replace(jx[0],"###$1").split(jx[1]).slice(1);for(s=0,f=d.length;s<f;++s){n=d[s];r=n.slice(1).trim().replace(jx[2],"$1###$2").replace(jx[3],"$1###$2").split(jx[4]);o=n.charAt(0);i=[o];for(l=0,c=r.length;l<c;++l){if((a=+r[l])===a){i.push(a)}}u=Lx[o.toLowerCase()];if(i.length-1>u){var h=i.length;l=1;t.push([o].concat(i.slice(l,l+=u)));o=o==="M"?"L":o==="m"?"l":o;for(;l<h;l+=u){t.push([o].concat(i.slice(l,l+u)))}}else{t.push(i)}}return t}var Ix=Math.PI/180;var Ux=1e-14;var qx=Math.PI/2;var Wx=Math.PI*2;var Hx=Math.sqrt(3)/2;var Gx={};var $x={};var Vx=[].join;function Yx(e,t,n,r,i,a,o,u,s){var l=Vx.call(arguments);if(Gx[l]){return Gx[l]}var f=o*Ix;var c=Math.sin(f);var d=Math.cos(f);n=Math.abs(n);r=Math.abs(r);var h=d*(u-e)*.5+c*(s-t)*.5;var v=d*(s-t)*.5-c*(u-e)*.5;var p=h*h/(n*n)+v*v/(r*r);if(p>1){p=Math.sqrt(p);n*=p;r*=p}var g=d/n;var m=c/n;var y=-c/r;var _=d/r;var b=g*u+m*s;var x=y*u+_*s;var w=g*e+m*t;var k=y*e+_*t;var A=(w-b)*(w-b)+(k-x)*(k-x);var E=1/A-.25;if(E<0)E=0;var D=Math.sqrt(E);if(a==i)D=-D;var S=.5*(b+w)-D*(k-x);var C=.5*(x+k)+D*(w-b);var M=Math.atan2(x-C,b-S);var F=Math.atan2(k-C,w-S);var O=F-M;if(O<0&&a===1){O+=Wx}else if(O>0&&a===0){O-=Wx}var N=Math.ceil(Math.abs(O/(qx+.001)));var T=[];for(var z=0;z<N;++z){var R=M+z*O/N;var P=M+(z+1)*O/N;T[z]=[S,C,R,P,n,r,c,d]}return Gx[l]=T}function Xx(e){var t=Vx.call(e);if($x[t]){return $x[t]}var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],l=e[7];var f=l*o;var c=-s*u;var d=s*o;var h=l*u;var v=Math.cos(i);var p=Math.sin(i);var g=Math.cos(a);var m=Math.sin(a);var y=.5*(a-i);var _=Math.sin(y*.5);var b=8/3*_*_/Math.sin(y);var x=n+v-b*p;var w=r+p+b*v;var k=n+g;var A=r+m;var E=k+b*m;var D=A-b*g;return $x[t]=[f*x+c*w,d*x+h*w,f*E+c*D,d*E+h*D,f*k+c*A,d*k+h*A]}var Jx=["l",0,0,0,0,0,0,0];function Qx(e,t,n){var r=Jx[0]=e[0];if(r==="a"||r==="A"){Jx[1]=t*e[1];Jx[2]=n*e[2];Jx[3]=e[3];Jx[4]=e[4];Jx[5]=e[5];Jx[6]=t*e[6];Jx[7]=n*e[7]}else if(r==="h"||r==="H"){Jx[1]=t*e[1]}else if(r==="v"||r==="V"){Jx[1]=n*e[1]}else{for(var i=1,a=e.length;i<a;++i){Jx[i]=(i%2==1?t:n)*e[i]}}return Jx}function Zx(e,t,n,r,i,a){var o,u=null,s=0,l=0,f=0,c=0,d,h,v,p;if(n==null)n=0;if(r==null)r=0;if(i==null)i=1;if(a==null)a=i;if(e.beginPath)e.beginPath();for(var g=0,m=t.length;g<m;++g){o=t[g];if(i!==1||a!==1){o=Qx(o,i,a)}switch(o[0]){case"l":s+=o[1];l+=o[2];e.lineTo(s+n,l+r);break;case"L":s=o[1];l=o[2];e.lineTo(s+n,l+r);break;case"h":s+=o[1];e.lineTo(s+n,l+r);break;case"H":s=o[1];e.lineTo(s+n,l+r);break;case"v":l+=o[1];e.lineTo(s+n,l+r);break;case"V":l=o[1];e.lineTo(s+n,l+r);break;case"m":s+=o[1];l+=o[2];e.moveTo(s+n,l+r);break;case"M":s=o[1];l=o[2];e.moveTo(s+n,l+r);break;case"c":d=s+o[5];h=l+o[6];f=s+o[3];c=l+o[4];e.bezierCurveTo(s+o[1]+n,l+o[2]+r,f+n,c+r,d+n,h+r);s=d;l=h;break;case"C":s=o[5];l=o[6];f=o[3];c=o[4];e.bezierCurveTo(o[1]+n,o[2]+r,f+n,c+r,s+n,l+r);break;case"s":d=s+o[3];h=l+o[4];f=2*s-f;c=2*l-c;e.bezierCurveTo(f+n,c+r,s+o[1]+n,l+o[2]+r,d+n,h+r);f=s+o[1];c=l+o[2];s=d;l=h;break;case"S":d=o[3];h=o[4];f=2*s-f;c=2*l-c;e.bezierCurveTo(f+n,c+r,o[1]+n,o[2]+r,d+n,h+r);s=d;l=h;f=o[1];c=o[2];break;case"q":d=s+o[3];h=l+o[4];f=s+o[1];c=l+o[2];e.quadraticCurveTo(f+n,c+r,d+n,h+r);s=d;l=h;break;case"Q":d=o[3];h=o[4];e.quadraticCurveTo(o[1]+n,o[2]+r,d+n,h+r);s=d;l=h;f=o[1];c=o[2];break;case"t":d=s+o[1];h=l+o[2];if(u[0].match(/[QqTt]/)===null){f=s;c=l}else if(u[0]==="t"){f=2*s-v;c=2*l-p}else if(u[0]==="q"){f=2*s-f;c=2*l-c}v=f;p=c;e.quadraticCurveTo(f+n,c+r,d+n,h+r);s=d;l=h;f=s+o[1];c=l+o[2];break;case"T":d=o[1];h=o[2];f=2*s-f;c=2*l-c;e.quadraticCurveTo(f+n,c+r,d+n,h+r);s=d;l=h;break;case"a":Kx(e,s+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+s+n,o[7]+l+r]);s+=o[6];l+=o[7];break;case"A":Kx(e,s+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]);s=o[6];l=o[7];break;case"z":case"Z":e.closePath();break}u=o}}function Kx(e,t,n,r){var i=Yx(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(var a=0;a<i.length;++a){var o=Xx(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var ew=.5773502691896257;var tw={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0);e.arc(0,0,n,0,Wx)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r);e.lineTo(-n,r);e.lineTo(-r,r);e.lineTo(-r,n);e.lineTo(r,n);e.lineTo(r,r);e.lineTo(n,r);e.lineTo(n,-r);e.lineTo(r,-r);e.lineTo(r,-n);e.lineTo(-r,-n);e.lineTo(-r,-r);e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0);e.lineTo(0,-n);e.lineTo(n,0);e.lineTo(0,n);e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n);e.lineTo(r,n);e.lineTo(r,-a);e.lineTo(i,-a);e.lineTo(0,-n);e.lineTo(-i,-a);e.lineTo(-r,-a);e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Hx*n,i=r-n*ew,a=n/4;e.moveTo(0,-r-i);e.lineTo(-a,r-i);e.lineTo(a,r-i);e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Hx*n,i=r-n*ew;e.moveTo(0,-r-i);e.lineTo(-n,r-i);e.lineTo(n,r-i);e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Hx*n;e.moveTo(0,-r);e.lineTo(-n,r);e.lineTo(n,r);e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Hx*n;e.moveTo(0,r);e.lineTo(-n,-r);e.lineTo(n,-r);e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Hx*n;e.moveTo(r,0);e.lineTo(-r,-n);e.lineTo(-r,n);e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Hx*n;e.moveTo(-r,0);e.lineTo(r,-n);e.lineTo(r,n);e.closePath()}},stroke:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0);e.lineTo(n,0)}}};function nw(e){return xi(tw,e)?tw[e]:iw(e)}var rw={};function iw(e){if(!xi(rw,e)){var t=Bx(e);rw[e]={draw:function(e,n){Zx(e,t,0,0,Math.sqrt(n)/2)}}}return rw[e]}var aw=.448084975506;function ow(e){return e.x}function uw(e){return e.y}function sw(e){return e.width}function lw(e){return e.height}function fw(e){return typeof e==="function"?e:function(){return+e}}function cw(e,t,n){return Math.max(t,Math.min(e,n))}function dw(){var e=ow,t=uw,n=sw,r=lw,i=fw(0),a=i,o=i,u=i,s=null;function l(l,f,c){var d,h=f!=null?f:+e.call(this,l),v=c!=null?c:+t.call(this,l),p=+n.call(this,l),g=+r.call(this,l),m=Math.min(p,g)/2,y=cw(+i.call(this,l),0,m),_=cw(+a.call(this,l),0,m),b=cw(+o.call(this,l),0,m),x=cw(+u.call(this,l),0,m);if(!s)s=d=fp();if(y<=0&&_<=0&&b<=0&&x<=0){s.rect(h,v,p,g)}else{var w=h+p,k=v+g;s.moveTo(h+y,v);s.lineTo(w-_,v);s.bezierCurveTo(w-aw*_,v,w,v+aw*_,w,v+_);s.lineTo(w,k-x);s.bezierCurveTo(w,k-aw*x,w-aw*x,k,w-x,k);s.lineTo(h+b,k);s.bezierCurveTo(h+aw*b,k,h,k-aw*b,h,k-b);s.lineTo(h,v+y);s.bezierCurveTo(h,v+aw*y,h+aw*y,v,h+y,v);s.closePath()}if(d){s=null;return d+""||null}}l.x=function(t){if(arguments.length){e=fw(t);return l}else{return e}};l.y=function(e){if(arguments.length){t=fw(e);return l}else{return t}};l.width=function(e){if(arguments.length){n=fw(e);return l}else{return n}};l.height=function(e){if(arguments.length){r=fw(e);return l}else{return r}};l.cornerRadius=function(e,t,n,r){if(arguments.length){i=fw(e);a=t!=null?fw(t):i;u=n!=null?fw(n):i;o=r!=null?fw(r):a;return l}else{return i}};l.context=function(e){if(arguments.length){s=e==null?null:e;return l}else{return s}};return l}function hw(){var e,t,n,r,i=null,a,o,u,s;function l(e,t,n){var r=n/2;if(a){var l=u-t,f=e-o;if(l||f){var c=Math.sqrt(l*l+f*f),d=(l/=c)*s,h=(f/=c)*s,v=Math.atan2(f,l);i.moveTo(o-d,u-h);i.lineTo(e-l*r,t-f*r);i.arc(e,t,r,v-Math.PI,v);i.lineTo(o+d,u+h);i.arc(o,u,s,v,v+Math.PI)}else{i.arc(e,t,r,0,Wx)}i.closePath()}else{a=1}o=e;u=t;s=r}function f(o){var u,s=o.length,f,c=false,d;if(i==null)i=d=fp();for(u=0;u<=s;++u){if(!(u<s&&r(f=o[u],u,o))===c){if(c=!c)a=0}if(c)l(+e(f,u,o),+t(f,u,o),+n(f,u,o))}if(d){i=null;return d+""||null}}f.x=function(t){if(arguments.length){e=t;return f}else{return e}};f.y=function(e){if(arguments.length){t=e;return f}else{return t}};f.size=function(e){if(arguments.length){n=e;return f}else{return n}};f.defined=function(e){if(arguments.length){r=e;return f}else{return r}};f.context=function(e){if(arguments.length){if(e==null){i=null}else{i=e}return f}else{return i}};return f}function vw(e,t){return e!=null?e:t}var pw=function(e){return e.x||0},gw=function(e){return e.y||0},mw=function(e){return e.width||0},yw=function(e){return e.height||0},_w=function(e){return(e.x||0)+(e.width||0)},bw=function(e){return(e.y||0)+(e.height||0)},xw=function(e){return e.startAngle||0},ww=function(e){return e.endAngle||0},kw=function(e){return e.padAngle||0},Aw=function(e){return e.innerRadius||0},Ew=function(e){return e.outerRadius||0},Dw=function(e){return e.cornerRadius||0},Sw=function(e){return vw(e.cornerRadiusTopLeft,e.cornerRadius)||0},Cw=function(e){return vw(e.cornerRadiusTopRight,e.cornerRadius)||0},Mw=function(e){return vw(e.cornerRadiusBottomRight,e.cornerRadius)||0},Fw=function(e){return vw(e.cornerRadiusBottomLeft,e.cornerRadius)||0},Ow=function(e){return vw(e.size,64)},Nw=function(e){return e.size||1},Tw=function(e){return!(e.defined===false)},zw=function(e){return nw(e.shape||"circle")};var Rw=Np().startAngle(xw).endAngle(ww).padAngle(kw).innerRadius(Aw).outerRadius(Ew).cornerRadius(Dw),Pw=Bp().x(pw).y1(gw).y0(bw).defined(Tw),Lw=Bp().y(gw).x1(pw).x0(_w).defined(Tw),jw=jp().x(pw).y(gw).defined(Tw),Bw=dw().x(pw).y(gw).width(mw).height(yw).cornerRadius(Sw,Cw,Mw,Fw),Iw=Up().type(zw).size(Ow),Uw=hw().x(pw).y(gw).defined(Tw).size(Nw);function qw(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Ww(e,t){return Rw.context(e)(t)}function Hw(e,t){var n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?Lw:Pw).curve(Px(r,n.orient,n.tension)).context(e)(t)}function Gw(e,t){var n=t[0],r=n.interpolate||"linear";return jw.curve(Px(r,n.orient,n.tension)).context(e)(t)}function $w(e,t,n,r){return Bw.context(e)(t,n,r)}function Vw(e,t){return(t.mark.shape||t.shape).context(e)(t)}function Yw(e,t){return Iw.context(e)(t)}function Xw(e,t){return Uw.context(e)(t)}var Jw=1;function Qw(){Jw=1}function Zw(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+Jw++),o=i.clipping[a]||(i.clipping[a]={id:a});if(si(r)){o.path=r(null)}else if(qw(n)){o.path=$w(null,n,0,0)}else{o.width=n.width||0;o.height=n.height||0}return"url(#"+a+")"}function Kw(e){this.clear();if(e)this.union(e)}Kw.prototype={clone:function(){return new Kw(this)},clear:function(){this.x1=+Number.MAX_VALUE;this.y1=+Number.MAX_VALUE;this.x2=-Number.MAX_VALUE;this.y2=-Number.MAX_VALUE;return this},empty:function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals:function(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set:function(e,t,n,r){if(n<e){this.x2=e;this.x1=n}else{this.x1=e;this.x2=n}if(r<t){this.y2=t;this.y1=r}else{this.y1=t;this.y2=r}return this},add:function(e,t){if(e<this.x1)this.x1=e;if(t<this.y1)this.y1=t;if(e>this.x2)this.x2=e;if(t>this.y2)this.y2=t;return this},expand:function(e){this.x1-=e;this.y1-=e;this.x2+=e;this.y2+=e;return this},round:function(){this.x1=Math.floor(this.x1);this.y1=Math.floor(this.y1);this.x2=Math.ceil(this.x2);this.y2=Math.ceil(this.y2);return this},scale:function(e){this.x1*=e;this.y1*=e;this.x2*=e;this.y2*=e;return this},translate:function(e,t){this.x1+=e;this.x2+=e;this.y1+=t;this.y2+=t;return this},rotate:function(e,t,n){var r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints:function(e,t,n){var r=this,i=r.x1,a=r.y1,o=r.x2,u=r.y2,s=Math.cos(e),l=Math.sin(e),f=t-t*s+n*l,c=n-t*l-n*s;return[s*i-l*a+f,l*i+s*a+c,s*i-l*u+f,l*i+s*u+c,s*o-l*a+f,l*o+s*a+c,s*o-l*u+f,l*o+s*u+c]},union:function(e){if(e.x1<this.x1)this.x1=e.x1;if(e.y1<this.y1)this.y1=e.y1;if(e.x2>this.x2)this.x2=e.x2;if(e.y2>this.y2)this.y2=e.y2;return this},intersect:function(e){if(e.x1>this.x1)this.x1=e.x1;if(e.y1>this.y1)this.y1=e.y1;if(e.x2<this.x2)this.x2=e.x2;if(e.y2<this.y2)this.y2=e.y2;return this},encloses:function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith:function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects:function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains:function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width:function(){return this.x2-this.x1},height:function(){return this.y2-this.y1}};function ek(e){this.mark=e;this.bounds=this.bounds||new Kw}function tk(e){ek.call(this,e);this.items=this.items||[]}Ei(tk,ek);function nk(e){this._pending=0;this._loader=e||jf()}function rk(e){e._pending+=1}function ik(e){e._pending-=1}nk.prototype={pending:function(){return this._pending},sanitizeURL:function(e){var t=this;rk(t);return t._loader.sanitize(e,{context:"href"}).then((function(e){ik(t);return e})).catch((function(){ik(t);return null}))},loadImage:function(e){var t=this,n=Og();rk(t);return t._loader.sanitize(e,{context:"image"}).then((function(e){var r=e.href;if(!r||!n)throw{url:r};var i=new n;var a=xi(e,"crossOrigin")?e.crossOrigin:"anonymous";if(a!=null)i.crossOrigin=a;i.onload=function(){return ik(t)};i.onerror=function(){return ik(t)};i.src=r;return i})).catch((function(e){ik(t);return{complete:false,width:0,height:0,src:e&&e.url||""}}))},ready:function(){var e=this;return new Promise((function(t){function n(r){if(!e.pending())t(r);else setTimeout((function(){n(true)}),10)}n(false)}))}};function ak(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){var r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?ok(t,r):0))}return e}function ok(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}var uk=Wx-1e-8;var sk,lk,fk,ck,dk,hk,vk,pk;var gk=function(e,t){return sk.add(e,t)};var mk=function(e,t){return gk(lk=e,fk=t)};var yk=function(e){return gk(e,sk.y1)};var _k=function(e){return gk(sk.x1,e)};var bk=function(e,t){return dk*e+vk*t};var xk=function(e,t){return hk*e+pk*t};var wk=function(e,t){return gk(bk(e,t),xk(e,t))};var kk=function(e,t){return mk(bk(e,t),xk(e,t))};function Ak(e,t){sk=e;if(t){ck=t*Ix;dk=pk=Math.cos(ck);hk=Math.sin(ck);vk=-hk}else{dk=pk=1;ck=hk=vk=0}return Ek}var Ek={beginPath:function(){},closePath:function(){},moveTo:kk,lineTo:kk,rect:function(e,t,n,r){if(ck){wk(e+n,t);wk(e+n,t+r);wk(e,t+r);kk(e,t)}else{gk(e+n,t+r);mk(e,t)}},quadraticCurveTo:function(e,t,n,r){var i=bk(e,t),a=xk(e,t),o=bk(n,r),u=xk(n,r);Dk(lk,i,o,yk);Dk(fk,a,u,_k);mk(o,u)},bezierCurveTo:function(e,t,n,r,i,a){var o=bk(e,t),u=xk(e,t),s=bk(n,r),l=xk(n,r),f=bk(i,a),c=xk(i,a);Sk(lk,o,s,f,yk);Sk(fk,u,l,c,_k);mk(f,c)},arc:function(e,t,n,r,i,a){r+=ck;i+=ck;lk=n*Math.cos(i)+e;fk=n*Math.sin(i)+t;if(Math.abs(i-r)>uk){gk(e-n,t-n);gk(e+n,t+n)}else{var o=function(r){return gk(n*Math.cos(r)+e,n*Math.sin(r)+t)};var u=void 0,s=void 0;o(r);o(i);if(i!==r){r=r%Wx;if(r<0)r+=Wx;i=i%Wx;if(i<0)i+=Wx;if(i<r){a=!a;u=r;r=i;i=u}if(a){i-=Wx;u=r-r%qx;for(s=0;s<4&&u>i;++s,u-=qx)o(u)}else{u=r-r%qx+qx;for(s=0;s<4&&u<i;++s,u=u+qx)o(u)}}}}};function Dk(e,t,n,r){var i=(e-t)/(e+n-2*t);if(0<i&&i<1)r(e+(t-e)*i)}function Sk(e,t,n,r,i){var a=r-e+3*t-3*n,o=e+n-2*t,u=e-t;var s=0,l=0,f;if(Math.abs(a)>Ux){f=o*o+u*a;if(f>=0){f=Math.sqrt(f);s=(-o+f)/a;l=(-o-f)/a}}else{s=.5*u/o}if(0<s&&s<1)i(Ck(s,e,t,n,r));if(0<l&&l<1)i(Ck(l,e,t,n,r))}function Ck(e,t,n,r,i){var a=1-e,o=a*a,u=e*e;return o*a*t+3*o*e*n+3*a*u*r+u*e*i}var Mk=(Mk=Fg(1,1))?Mk.getContext("2d"):null;var Fk=new Kw;function Ok(e){return function(t,n){if(!Mk)return true;e(Mk,t);Fk.clear().union(t.bounds).intersect(n).round();var r=Fk.x1,i=Fk.y1,a=Fk.x2,o=Fk.y2;for(var u=i;u<=o;++u){for(var s=r;s<=a;++s){if(Mk.isPointInPath(s,u)){return true}}}return false}}function Nk(e,t){return t.contains(e.x||0,e.y||0)}function Tk(e,t){var n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(Fk.set(n,r,n+i,r+a))}function zk(e,t){var n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,a=e.y2!=null?e.y2:r;return Rk(t,n,r,i,a)}function Rk(e,t,n,r,i){var a=e.x1,o=e.y1,u=e.x2,s=e.y2,l=r-t,f=i-n;var c=0,d=1,h,v,p,g;for(g=0;g<4;++g){if(g===0){h=-l;v=-(a-t)}if(g===1){h=l;v=u-t}if(g===2){h=-f;v=-(o-n)}if(g===3){h=f;v=s-n}if(Math.abs(h)<1e-10&&v<0)return false;p=v/h;if(h<0){if(p>d)return false;else if(p>c)c=p}else if(h>0){if(p<c)return false;else if(p<d)d=p}}return true}function Pk(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Lk(e,t){return e==null?t:e}function jk(e,t){var n=t.length;for(var r=0;r<n;++r){e.addColorStop(t[r].offset,t[r].color)}return e}function Bk(e,t,n){var r=n.width(),i=n.height();var a;if(t.gradient==="radial"){a=e.createRadialGradient(n.x1+Lk(t.x1,.5)*r,n.y1+Lk(t.y1,.5)*i,Math.max(r,i)*Lk(t.r1,0),n.x1+Lk(t.x2,.5)*r,n.y1+Lk(t.y2,.5)*i,Math.max(r,i)*Lk(t.r2,.5))}else{var o=Lk(t.x1,0),u=Lk(t.y1,0),s=Lk(t.x2,1),l=Lk(t.y2,0);if(o===s||u===l||r===i){a=e.createLinearGradient(n.x1+o*r,n.y1+u*i,n.x1+s*r,n.y1+l*i)}else{var f=Fg(Math.ceil(r),Math.ceil(i)),c=f.getContext("2d");c.scale(r,i);c.fillStyle=jk(c.createLinearGradient(o,u,s,l),t.stops);c.fillRect(0,0,r,i);return e.createPattern(f,"no-repeat")}}return jk(a,t.stops)}function Ik(e,t,n){return Ox(n)?Bk(e,n,t.bounds):n}function Uk(e,t,n){n*=t.fillOpacity==null?1:t.fillOpacity;if(n>0){e.globalAlpha=n;e.fillStyle=Ik(e,t,t.fill);return true}else{return false}}var qk=[];function Wk(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;if(r<=0)return false;n*=t.strokeOpacity==null?1:t.strokeOpacity;if(n>0){e.globalAlpha=n;e.strokeStyle=Ik(e,t,t.stroke);e.lineWidth=r;e.lineCap=t.strokeCap||"butt";e.lineJoin=t.strokeJoin||"miter";e.miterLimit=t.strokeMiterLimit||10;if(e.setLineDash){e.setLineDash(t.strokeDash||qk);e.lineDashOffset=t.strokeDashOffset||0}return true}else{return false}}function Hk(e,t){return e.zindex-t.zindex||e.index-t.index}function Gk(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,a;for(i=0,a=t.length;i<a;++i){r=t[i];r.index=i;if(r.zindex)n.push(r)}e.zdirty=false;return e.zitems=n.sort(Hk)}function $k(e,t){var n=e.items,r,i;if(!n||!n.length)return;var a=Gk(e);if(a&&a.length){for(r=0,i=n.length;r<i;++r){if(!n[r].zindex)t(n[r])}n=a}for(r=0,i=n.length;r<i;++r){t(n[r])}}function Vk(e,t){var n=e.items,r,i;if(!n||!n.length)return null;var a=Gk(e);if(a&&a.length)n=a;for(i=n.length;--i>=0;){if(r=t(n[i]))return r}if(n===a){for(n=e.items,i=n.length;--i>=0;){if(!n[i].zindex){if(r=t(n[i]))return r}}}return null}function Yk(e){return function(t,n,r){$k(n,(function(n){if(!r||r.intersects(n.bounds)){Jk(e,t,n,n)}}))}}function Xk(e){return function(t,n,r){if(n.items.length&&(!r||r.intersects(n.bounds))){Jk(e,t,n.items[0],n.items)}}}function Jk(e,t,n,r){var i=n.opacity==null?1:n.opacity;if(i===0)return;if(e(t,r))return;Pk(t,n);if(n.fill&&Uk(t,n,i)){t.fill()}if(n.stroke&&Wk(t,n,i)){t.stroke()}}function Qk(e){e=e||Dr;return function(t,n,r,i,a,o){r*=t.pixelRatio;i*=t.pixelRatio;return Vk(n,(function(n){var u=n.bounds;if(u&&!u.contains(a,o)||!u)return;if(e(t,n,r,i,a,o))return n}))}}function Zk(e,t){return function(n,r,i,a){var o=Array.isArray(r)?r[0]:r,u=t==null?o.fill:t,s=o.stroke&&n.isPointInStroke,l,f;if(s){l=o.strokeWidth;f=o.strokeCap;n.lineWidth=l!=null?l:1;n.lineCap=f!=null?f:"butt"}return e(n,r)?false:u&&n.isPointInPath(i,a)||s&&n.isPointInStroke(i,a)}}function Kk(e){return Qk(Zk(e))}function eA(e,t){return"translate("+e+","+t+")"}function tA(e){return"rotate("+e+")"}function nA(e,t){return"scale("+e+","+t+")"}function rA(e){return eA(e.x||0,e.y||0)}function iA(e){return eA(e.x||0,e.y||0)+(e.angle?" "+tA(e.angle):"")}function aA(e){return eA(e.x||0,e.y||0)+(e.angle?" "+tA(e.angle):"")+(e.scaleX||e.scaleY?" "+nA(e.scaleX||1,e.scaleY||1):"")}function oA(e,t,n){function r(e,n){e("transform",iA(n));e("d",t(null,n))}function i(e,n){t(Ak(e,n.angle),n);return ak(e,n).translate(n.x||0,n.y||0)}function a(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i);if(a)e.rotate(a*=Ix);e.beginPath();t(e,n);if(a)e.rotate(-a);e.translate(-r,-i)}return{type:e,tag:"path",nested:false,attr:r,bound:i,draw:Yk(a),pick:Kk(a),isect:n||Ok(a)}}var uA=oA("arc",Ww);function sA(e,t){var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,a=+Infinity,o,u;while(--i>=0){if(e[i].defined===false)continue;u=Math.abs(e[i][r]-n);if(u<a){a=u;o=e[i]}}return o}function lA(e,t){var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,a,o;while(--r>=0){if(e[r].defined===false)continue;i=e[r].x-t[0];a=e[r].y-t[1];o=i*i+a*a;if(o<n)return e[r]}return null}function fA(e,t){var n=e.length,r,i,a;while(--n>=0){if(e[n].defined===false)continue;r=e[n].x-t[0];i=e[n].y-t[1];a=r*r+i*i;r=e[n].size||1;if(a<r*r)return e[n]}return null}function cA(e,t,n){function r(e,n){var r=n.mark.items;if(r.length)e("d",t(null,r))}function i(e,n){var r=n.items;if(r.length===0){return e}else{t(Ak(e),r);return ak(e,r[0])}}function a(e,n){e.beginPath();t(e,n)}var o=Zk(a);function u(e,t,n,r,i,a){var u=t.items,s=t.bounds;if(!u||!u.length||s&&!s.contains(i,a)){return null}n*=e.pixelRatio;r*=e.pixelRatio;return o(e,u,n,r)?u[0]:null}return{type:e,tag:"path",nested:true,attr:r,bound:i,draw:Xk(a),pick:u,isect:Nk,tip:n}}var dA=cA("area",Hw,sA);function hA(e,t){var n=t.clip;e.save();if(si(n)){e.beginPath();n(e);e.clip()}else{vA(e,t.group)}}function vA(e,t){e.beginPath();qw(t)?$w(e,t,0,0):e.rect(0,0,t.width||0,t.height||0);e.clip()}function pA(e){var t=Lk(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function gA(e,t){e("transform",rA(t))}function mA(e,t){var n=pA(t);e("d",$w(null,t,n,n))}function yA(e,t){e("class","background");e("aria-hidden",true);mA(e,t)}function _A(e,t){e("class","foreground");e("aria-hidden",true);if(t.strokeForeground){mA(e,t)}else{e("d","")}}function bA(e,t,n){var r=t.clip?Zw(n,t,t):null;e("clip-path",r)}function xA(e,t){if(!t.clip&&t.items){var n=t.items,r=n.length;for(var i=0;i<r;++i){e.union(n[i].bounds)}}if((t.clip||t.width||t.height)&&!t.noBound){e.add(0,0).add(t.width||0,t.height||0)}ak(e,t);return e.translate(t.x||0,t.y||0)}function wA(e,t,n,r){var i=pA(t);e.beginPath();$w(e,t,(n||0)+i,(r||0)+i)}var kA=Zk(wA);var AA=Zk(wA,false);var EA=Zk(wA,true);function DA(e,t,n){var r=this;$k(t,(function(t){var i=t.x||0,a=t.y||0,o=t.strokeForeground,u=t.opacity==null?1:t.opacity;if((t.stroke||t.fill)&&u){wA(e,t,i,a);Pk(e,t);if(t.fill&&Uk(e,t,u)){e.fill()}if(t.stroke&&!o&&Wk(e,t,u)){e.stroke()}}e.save();e.translate(i,a);if(t.clip)vA(e,t);if(n)n.translate(-i,-a);$k(t,(function(t){r.draw(e,t,n)}));if(n)n.translate(i,a);e.restore();if(o&&t.stroke&&u){wA(e,t,i,a);Pk(e,t);if(Wk(e,t,u)){e.stroke()}}}))}function SA(e,t,n,r,i,a){var o=this;if(t.bounds&&!t.bounds.contains(i,a)||!t.items){return null}var u=n*e.pixelRatio,s=r*e.pixelRatio;return Vk(t,(function(l){var f,c,d;var h=l.bounds;if(h&&!h.contains(i,a))return;c=l.x||0;d=l.y||0;var v=c+(l.width||0),p=d+(l.height||0),g=l.clip;if(g&&(i<c||i>v||a<d||a>p))return;e.save();e.translate(c,d);c=i-c;d=a-d;if(g&&qw(l)&&!EA(e,l,u,s)){e.restore();return null}var m=l.strokeForeground,y=t.interactive!==false;if(y&&m&&l.stroke&&AA(e,l,u,s)){e.restore();return l}f=Vk(l,(function(e){return CA(e,c,d)?o.pick(e,n,r,c,d):null}));if(!f&&y&&(l.fill||!m&&l.stroke)&&kA(e,l,u,s)){f=l}e.restore();return f||null}))}function CA(e,t,n){return(e.interactive!==false||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var MA={type:"group",tag:"g",nested:false,attr:gA,bound:xA,draw:DA,pick:SA,isect:Tk,content:bA,background:yA,foreground:_A};var FA={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function OA(e,t){var n=e.image;if(!n||e.url&&e.url!==n.url){n={complete:false,width:0,height:0};t.loadImage(e.url).then((function(t){e.image=t;e.image.url=e.url}))}return n}function NA(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==false&&e.height?e.height*t.width/t.height:t.width}function TA(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==false&&e.width?e.width*t.height/t.width:t.height}function zA(e,t){return e==="center"?t/2:e==="right"?t:0}function RA(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function PA(e,t,n){var r=OA(t,n),i=NA(t,r),a=TA(t,r),o=(t.x||0)-zA(t.align,i),u=(t.y||0)-RA(t.baseline,a),s=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",s,FA["xmlns:xlink"],"xlink:href");e("transform",eA(o,u));e("width",i);e("height",a);e("preserveAspectRatio",t.aspect===false?"none":"xMidYMid")}function LA(e,t){var n=t.image,r=NA(t,n),i=TA(t,n),a=(t.x||0)-zA(t.align,r),o=(t.y||0)-RA(t.baseline,i);return e.set(a,o,a+r,o+i)}function jA(e,t,n){var r=this;$k(t,(function(t){if(n&&!n.intersects(t.bounds))return;var i=OA(t,r);var a=NA(t,i);var o=TA(t,i);if(a===0||o===0)return;var u=(t.x||0)-zA(t.align,a),s=(t.y||0)-RA(t.baseline,o),l,f,c,d;if(t.aspect!==false){f=i.width/i.height;c=t.width/t.height;if(f===f&&c===c&&f!==c){if(c<f){d=a/f;s+=(o-d)/2;o=d}else{d=o*f;u+=(a-d)/2;a=d}}}if(i.complete||i.toDataURL){Pk(e,t);e.globalAlpha=(l=t.opacity)!=null?l:1;e.imageSmoothingEnabled=t.smooth!==false;e.drawImage(i,u,s,a,o)}}))}var BA={type:"image",tag:"image",nested:false,attr:PA,bound:LA,draw:jA,pick:Qk(),isect:Dr,get:OA,xOffset:zA,yOffset:RA};var IA=cA("line",Gw,lA);function UA(e,t){var n=t.scaleX||1,r=t.scaleY||1;if(n!==1||r!==1){e("vector-effect","non-scaling-stroke")}e("transform",aA(t));e("d",t.path)}function qA(e,t){var n=t.path;if(n==null)return true;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,u=(t.angle||0)*Ix,s=t.pathCache;if(!s||s.path!==n){(t.pathCache=s=Bx(n)).path=n}if(u&&e.rotate&&e.translate){e.translate(r,i);e.rotate(u);Zx(e,s,0,0,a,o);e.rotate(-u);e.translate(-r,-i)}else{Zx(e,s,r,i,a,o)}}function WA(e,t){return qA(Ak(e,t.angle),t)?e.set(0,0,0,0):ak(e,t,true)}var HA={type:"path",tag:"path",nested:false,attr:UA,bound:WA,draw:Yk(qA),pick:Kk(qA),isect:Ok(qA)};function GA(e,t){e("d",$w(null,t))}function $A(e,t){var n,r;return ak(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function VA(e,t){e.beginPath();$w(e,t)}var YA={type:"rect",tag:"path",nested:false,attr:GA,bound:$A,draw:Yk(VA),pick:Kk(VA),isect:Tk};function XA(e,t){e("transform",rA(t));e("x2",t.x2!=null?t.x2-(t.x||0):0);e("y2",t.y2!=null?t.y2-(t.y||0):0)}function JA(e,t){var n,r;return ak(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function QA(e,t,n){var r,i,a,o;if(t.stroke&&Wk(e,t,n)){r=t.x||0;i=t.y||0;a=t.x2!=null?t.x2:r;o=t.y2!=null?t.y2:i;e.beginPath();e.moveTo(r,i);e.lineTo(a,o);return true}return false}function ZA(e,t,n){$k(t,(function(t){if(n&&!n.intersects(t.bounds))return;var r=t.opacity==null?1:t.opacity;if(r&&QA(e,t,r)){Pk(e,t);e.stroke()}}))}function KA(e,t,n,r){if(!e.isPointInStroke)return false;return QA(e,t,1)&&e.isPointInStroke(n,r)}var eE={type:"rule",tag:"line",nested:false,attr:XA,bound:JA,draw:ZA,pick:Qk(KA),isect:zk};var tE=oA("shape",Vw);var nE=oA("symbol",Yw,Nk);var rE=Pi();var iE={height:fE,measureWidth:sE,estimateWidth:oE,width:oE,canvas:aE};aE(true);function aE(e){iE.width=e&&Mk?sE:oE}function oE(e,t){return uE(pE(e,t),fE(e))}function uE(e,t){return~~(.8*e.length*t)}function sE(e,t){return fE(e)<=0||!(t=pE(e,t))?0:lE(t,_E(e))}function lE(e,t){var n="("+t+") "+e;var r=rE.get(n);if(r===undefined){Mk.font=t;r=Mk.measureText(e).width;rE.set(n,r)}return r}function fE(e){return e.fontSize!=null?+e.fontSize||0:11}function cE(e){return e.lineHeight!=null?e.lineHeight:fE(e)+2}function dE(e){return Rr(e)?e.length>1?e:e[0]:e}function hE(e){return dE(e.lineBreak&&e.text&&!Rr(e.text)?e.text.split(e.lineBreak):e.text)}function vE(e){var t=hE(e);return(Rr(t)?t.length-1:0)*cE(e)}function pE(e,t){var n=t==null?"":(t+"").trim();return e.limit>0&&n.length?mE(e,n):n}function gE(e){if(iE.width===sE){var t=_E(e);return function(e){return lE(e,t)}}else{var n=fE(e);return function(e){return uE(e,n)}}}function mE(e,t){var n=+e.limit,r=gE(e);if(r(t)<n)return t;var i=e.ellipsis||"…",a=e.dir==="rtl",o=0,u=t.length,s;n-=r(i);if(a){while(o<u){s=o+u>>>1;if(r(t.slice(s))>n)o=s+1;else u=s}return i+t.slice(o)}else{while(o<u){s=1+(o+u>>>1);if(r(t.slice(0,s))<n)o=s;else u=s-1}return t.slice(0,o)+i}}function yE(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function _E(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+fE(e)+"px "+yE(e,t)}function bE(e){var t=e.baseline,n=fE(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*cE(e):t==="line-bottom"?.29*n-.5*cE(e):0)}var xE={left:"start",center:"middle",right:"end"};var wE=new Kw;function kE(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;if(r){i=(e.theta||0)-qx;t+=r*Math.cos(i);n+=r*Math.sin(i)}wE.x1=t;wE.y1=n;return wE}function AE(e,t){var n=t.dx||0,r=(t.dy||0)+bE(t),i=kE(t),a=i.x1,o=i.y1,u=t.angle||0,s;e("text-anchor",xE[t.align]||"start");if(u){s=eA(a,o)+" "+tA(u);if(n||r)s+=" "+eA(n,r)}else{s=eA(a+n,o+r)}e("transform",s)}function EE(e,t,n){var r=iE.height(t),i=t.align,a=kE(t),o=a.x1,u=a.y1,s=t.dx||0,l=(t.dy||0)+bE(t)-Math.round(.8*r),f=hE(t),c;if(Rr(f)){r+=cE(t)*(f.length-1);c=f.reduce((function(e,n){return Math.max(e,iE.width(t,n))}),0)}else{c=iE.width(t,f)}if(i==="center"){s-=c/2}else if(i==="right"){s-=c}else;e.set(s+=o,l+=u,s+c,l+r);if(t.angle&&!n){e.rotate(t.angle*Ix,o,u)}else if(n===2){return e.rotatedPoints(t.angle*Ix,o,u)}return e}function DE(e,t,n){$k(t,(function(t){var r=t.opacity==null?1:t.opacity,i,a,o,u,s,l,f;if(n&&!n.intersects(t.bounds)||r===0||t.fontSize<=0||t.text==null||t.text.length===0)return;e.font=_E(t);e.textAlign=t.align||"left";i=kE(t);a=i.x1,o=i.y1;if(t.angle){e.save();e.translate(a,o);e.rotate(t.angle*Ix);a=o=0}a+=t.dx||0;o+=(t.dy||0)+bE(t);l=hE(t);Pk(e,t);if(Rr(l)){s=cE(t);for(u=0;u<l.length;++u){f=pE(t,l[u]);if(t.fill&&Uk(e,t,r)){e.fillText(f,a,o)}if(t.stroke&&Wk(e,t,r)){e.strokeText(f,a,o)}o+=s}}else{f=pE(t,l);if(t.fill&&Uk(e,t,r)){e.fillText(f,a,o)}if(t.stroke&&Wk(e,t,r)){e.strokeText(f,a,o)}}if(t.angle)e.restore()}))}function SE(e,t,n,r,i,a){if(t.fontSize<=0)return false;if(!t.angle)return true;var o=kE(t),u=o.x1,s=o.y1,l=EE(wE,t,1),f=-t.angle*Ix,c=Math.cos(f),d=Math.sin(f),h=c*i-d*a+(u-c*u+d*s),v=d*i+c*a+(s-d*u-c*s);return l.contains(h,v)}function CE(e,t){var n=EE(wE,e,2);return Rk(t,n[0],n[1],n[2],n[3])||Rk(t,n[0],n[1],n[4],n[5])||Rk(t,n[4],n[5],n[6],n[7])||Rk(t,n[2],n[3],n[6],n[7])}var ME={type:"text",tag:"text",nested:false,attr:AE,bound:EE,draw:DE,pick:Qk(SE),isect:CE};var FE=cA("trail",Xw,fA);var OE={arc:uA,area:dA,group:MA,image:BA,line:IA,path:HA,rect:YA,rule:eE,shape:tE,symbol:nE,text:ME,trail:FE};function NE(e,t,n){var r=OE[e.mark.marktype],i=t||r.bound;if(r.nested)e=e.mark;return i(e.bounds||(e.bounds=new Kw),e,n)}var TE={mark:null};function zE(e,t,n){var r=OE[e.marktype],i=r.bound,a=e.items,o=a&&a.length,u,s,l,f;if(r.nested){if(o){l=a[0]}else{TE.mark=e;l=TE}f=NE(l,i,n);t=t&&t.union(f)||f;return t}t=t||e.bounds&&e.bounds.clear()||new Kw;if(o){for(u=0,s=a.length;u<s;++u){t.union(NE(a[u],i,n))}}return e.bounds=t}var RE=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function PE(e,t){return JSON.stringify(e,RE,t)}function LE(e){var t=typeof e==="string"?JSON.parse(e):e;return jE(t)}function jE(e){var t=e.marktype,n=e.items,r,i,a;if(n){for(i=0,a=n.length;i<a;++i){r=t?"mark":"group";n[i][r]=e;if(n[i].zindex)n[i][r].zdirty=true;if("group"===(t||r))jE(n[i])}}if(t)zE(e);return e}function BE(e){if(arguments.length){this.root=LE(e)}else{this.root=IE({marktype:"group",name:"root",role:"frame"});this.root.items=[new tk(this.root)]}}BE.prototype={toJSON:function(e){return PE(this.root,e||0)},mark:function(e,t,n){t=t||this.root.items[0];var r=IE(e,t);t.items[n]=r;if(r.zindex)r.group.zdirty=true;return r}};function IE(e,t){var n={bounds:new Kw,clip:!!e.clip,group:t,interactive:e.interactive===false?false:true,items:[],marktype:e.marktype,name:e.name||undefined,role:e.role||undefined,zindex:e.zindex||0};if(e.aria!=null){n.aria=e.aria}if(e.description){n.description=e.description}return n}function UE(e,t,n){if(!e&&typeof document!=="undefined"&&document.createElement){e=document}return e?n?e.createElementNS(n,t):e.createElement(t):null}function qE(e,t){t=t.toLowerCase();var n=e.childNodes,r=0,i=n.length;for(;r<i;++r)if(n[r].tagName.toLowerCase()===t){return n[r]}}function WE(e,t,n,r){var i=e.childNodes[t],a;if(!i||i.tagName.toLowerCase()!==n.toLowerCase()){a=i||null;i=UE(e.ownerDocument,n,r);e.insertBefore(i,a)}return i}function HE(e,t){var n=e.childNodes,r=n.length;while(r>t)e.removeChild(n[--r]);return e}function GE(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function $E(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function VE(e,t,n,r){var i=e&&e.mark,a,o;if(i&&(a=OE[i.marktype]).tip){o=$E(t,n);o[0]-=r[0];o[1]-=r[1];while(e=e.mark.group){o[0]-=e.x||0;o[1]-=e.y||0}e=a.tip(i.items,o)}return e}function YE(e,t){this._active=null;this._handlers={};this._loader=e||jf();this._tooltip=t||XE}function XE(e,t,n,r){e.element().setAttribute("title",r||"")}YE.prototype={initialize:function(e,t,n){this._el=e;this._obj=n||null;return this.origin(t)},element:function(){return this._el},canvas:function(){return this._el&&this._el.firstChild},origin:function(e){if(arguments.length){this._origin=e||[0,0];return this}else{return this._origin.slice()}},scene:function(e){if(!arguments.length)return this._scene;this._scene=e;return this},on:function(){},off:function(){},_handlerIndex:function(e,t,n){for(var r=e?e.length:0;--r>=0;){if(e[r].type===t&&(!n||e[r].handler===n)){return r}}return-1},handlers:function(e){var t=this._handlers,n=[];if(e){n.push.apply(n,t[this.eventName(e)])}else{for(var r in t){n.push.apply(n,t[r])}}return n},eventName:function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref:function(e,t,n){this._loader.sanitize(n,{context:"href"}).then((function(t){var n=new MouseEvent(e.type,e),r=UE(null,"a");for(var i in t)r.setAttribute(i,t[i]);r.dispatchEvent(n)})).catch((function(){}))},handleTooltip:function(e,t,n){if(t&&t.tooltip!=null){t=VE(t,e,this.canvas(),this._origin);var r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect:function(e){var t=this.canvas();if(!t)return;var n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();var u=i.x1+r[0]+n.left,s=i.y1+r[1]+n.top;while(e.mark&&(e=e.mark.group)){u+=e.x||0;s+=e.y||0}return{x:u,y:s,width:a,height:o,left:u,top:s,right:u+a,bottom:s+o}}};function JE(e){this._el=null;this._bgcolor=null;this._loader=new nk(e)}JE.prototype={initialize:function(e,t,n,r,i){this._el=e;return this.resize(t,n,r,i)},element:function(){return this._el},canvas:function(){return this._el&&this._el.firstChild},background:function(e){if(arguments.length===0)return this._bgcolor;this._bgcolor=e;return this},resize:function(e,t,n,r){this._width=e;this._height=t;this._origin=n||[0,0];this._scale=r||1;return this},dirty:function(){},render:function(e){var t=this;t._call=function(){t._render(e)};t._call();t._call=null;return t},_render:function(){},renderAsync:function(e){var t=this.render(e);return this._ready?this._ready.then((function(){return t})):Promise.resolve(t)},_load:function(e,t){var n=this,r=n._loader[e](t);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then((function(e){if(e)i();n._ready=null}))}return r},sanitizeURL:function(e){return this._load("sanitizeURL",e)},loadImage:function(e){return this._load("loadImage",e)}};var QE="keydown";var ZE="keypress";var KE="keyup";var eD="dragenter";var tD="dragleave";var nD="dragover";var rD="mousedown";var iD="mouseup";var aD="mousemove";var oD="mouseout";var uD="mouseover";var sD="click";var lD="dblclick";var fD="wheel";var cD="mousewheel";var dD="touchstart";var hD="touchmove";var vD="touchend";var pD=[QE,ZE,KE,eD,tD,nD,rD,iD,aD,oD,uD,sD,lD,fD,cD,dD,hD,vD];var gD=aD;var mD=oD;var yD=sD;function _D(e,t){YE.call(this,e,t);this._down=null;this._touch=null;this._first=true;this._events={}}var bD=function(e){return e===dD||e===hD||e===vD?[dD,hD,vD]:[e]};function xD(e,t){bD(t).forEach((function(t){return wD(e,t)}))}function wD(e,t){var n=e.canvas();if(n&&!e._events[t]){e._events[t]=1;n.addEventListener(t,e[t]?function(n){return e[t](n)}:function(n){return e.fire(t,n)})}}function kD(e,t,n){return function(r){var i=this._active,a=this.pickEvent(r);if(a===i){this.fire(e,r)}else{if(!i||!i.exit){this.fire(n,r)}this._active=a;this.fire(t,r);this.fire(e,r)}}}function AD(e){return function(t){this.fire(e,t);this._active=null}}Ei(_D,YE,{initialize:function(e,t,n){var r=this;this._canvas=e&&qE(e,"canvas");[sD,rD,aD,oD,tD].forEach((function(e){return xD(r,e)}));return YE.prototype.initialize.call(this,e,t,n)},canvas:function(){return this._canvas},context:function(){return this._canvas.getContext("2d")},events:pD,DOMMouseScroll:function(e){this.fire(cD,e)},mousemove:kD(aD,uD,oD),dragover:kD(nD,eD,tD),mouseout:AD(oD),dragleave:AD(tD),mousedown:function(e){this._down=this._active;this.fire(rD,e)},click:function(e){if(this._down===this._active){this.fire(sD,e);this._down=null}},touchstart:function(e){this._touch=this.pickEvent(e.changedTouches[0]);if(this._first){this._active=this._touch;this._first=false}this.fire(dD,e,true)},touchmove:function(e){this.fire(hD,e,true)},touchend:function(e){this.fire(vD,e,true);this._touch=null},fire:function(e,t,n){var r=n?this._touch:this._active,i=this._handlers[e];t.vegaType=e;if(e===yD&&r&&r.href){this.handleHref(t,r,r.href)}else if(e===gD||e===mD){this.handleTooltip(t,r,e!==mD)}if(i){for(var a=0,o=i.length;a<o;++a){i[a].handler.call(this._obj,t,r)}}},on:function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){xD(this,e);(r[n]||(r[n]=[])).push({type:e,handler:t})}return this},off:function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){r.splice(i,1)}return this},pickEvent:function(e){var t=$E(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick:function(e,t,n,r,i){var a=this.context(),o=OE[e.marktype];return o.pick.call(this,a,e,t,n,r,i)}});function ED(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var DD=ED();function SD(e,t,n,r,i,a){var o=typeof HTMLElement!=="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,u=e.getContext("2d"),s=o?DD:i;e.width=t*s;e.height=n*s;for(var l in a){u[l]=a[l]}if(o&&s!==1){e.style.width=t+"px";e.style.height=n+"px"}u.pixelRatio=s;u.setTransform(s,0,0,s,s*r[0],s*r[1]);return e}function CD(e){JE.call(this,e);this._options={};this._redraw=false;this._dirty=new Kw;this._tempb=new Kw}var MD=JE.prototype;var FD=function(e,t,n){return(new Kw).set(0,0,t,n).translate(-e[0],-e[1])};function OD(e,t,n){t.expand(1).round();if(e.pixelRatio%1){t.scale(e.pixelRatio).round().scale(1/e.pixelRatio)}t.translate(-(n[0]%1),-(n[1]%1));e.beginPath();e.rect(t.x1,t.y1,t.width(),t.height());e.clip();return t}Ei(CD,JE,{initialize:function(e,t,n,r,i,a){this._options=a||{};this._canvas=this._options.externalContext?null:Fg(1,1);if(e&&this._canvas){HE(e,0).appendChild(this._canvas);this._canvas.setAttribute("class","marks")}return MD.initialize.call(this,e,t,n,r,i)},resize:function(e,t,n,r){MD.resize.call(this,e,t,n,r);if(this._canvas){SD(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context)}else{var i=this._options.externalContext;if(!i)_r("CanvasRenderer is missing a valid canvas or context");i.scale(this._scale,this._scale);i.translate(this._origin[0],this._origin[1])}this._redraw=true;return this},canvas:function(){return this._canvas},context:function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty:function(e){var t=this._tempb.clear().union(e.bounds);var n=e.mark.group;while(n){t.translate(n.x||0,n.y||0);n=n.mark.group}this._dirty.union(t)},_render:function(e){var t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=FD(n,r,i);t.save();var u=this._redraw||a.empty()?(this._redraw=false,o.expand(1)):OD(t,o.intersect(a),n);this.clear(-n[0],-n[1],r,i);this.draw(t,e,u);t.restore();a.clear();return this},draw:function(e,t,n){var r=OE[t.marktype];if(t.clip)hA(e,t);r.draw.call(this,e,t,n);if(t.clip)e.restore()},clear:function(e,t,n,r){var i=this._options,a=this.context();if(i.type!=="pdf"&&!i.externalContext){a.clearRect(e,t,n,r)}if(this._bgcolor!=null){a.fillStyle=this._bgcolor;a.fillRect(e,t,n,r)}}});function ND(e,t){YE.call(this,e,t);var n=this;n._hrefHandler=TD(n,(function(e,t){if(t&&t.href)n.handleHref(e,t,t.href)}));n._tooltipHandler=TD(n,(function(e,t){n.handleTooltip(e,t,e.type!==mD)}))}var TD=function(e,t){return function(n){var r=n.target.__data__;r=Array.isArray(r)?r[0]:r;n.vegaType=n.type;t.call(e._obj,n,r)}};Ei(ND,YE,{initialize:function(e,t,n){var r=this._svg;if(r){r.removeEventListener(yD,this._hrefHandler);r.removeEventListener(gD,this._tooltipHandler);r.removeEventListener(mD,this._tooltipHandler)}this._svg=r=e&&qE(e,"svg");if(r){r.addEventListener(yD,this._hrefHandler);r.addEventListener(gD,this._tooltipHandler);r.addEventListener(mD,this._tooltipHandler)}return YE.prototype.initialize.call(this,e,t,n)},canvas:function(){return this._svg},on:function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){var a={type:e,handler:t,listener:TD(this,t)};(r[n]||(r[n]=[])).push(a);if(this._svg){this._svg.addEventListener(n,a.listener)}}return this},off:function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){if(this._svg){this._svg.removeEventListener(n,r[i].listener)}r.splice(i,1)}return this}});var zD="aria-hidden";var RD="aria-label";var PD="role";var LD="aria-roledescription";var jD="graphics-object";var BD="graphics-symbol";var ID=function(e,t,n){var r;return r={},r[PD]=e,r[LD]=t,r[RD]=n||undefined,r};var UD=$i(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]);var qD={axis:{desc:"axis",caption:XD},legend:{desc:"legend",caption:JD},"title-text":{desc:"title",caption:function(e){return"Title text '"+YD(e)+"'"}},"title-subtitle":{desc:"subtitle",caption:function(e){return"Subtitle text '"+YD(e)+"'"}}};var WD={ariaRole:PD,ariaRoleDescription:LD,description:RD};function HD(e,t){var n=t.aria===false;e(zD,n||undefined);if(n||t.description==null){for(var r in WD){e(WD[r],undefined)}}else{var i=t.mark.marktype;e(RD,t.description);e(PD,t.ariaRole||(i==="group"?jD:BD));e(LD,t.ariaRoleDescription||i+" mark")}}function GD(e){var t;return e.aria===false?(t={},t[zD]=true,t):UD[e.role]?null:qD[e.role]?VD(e,qD[e.role]):$D(e)}function $D(e){var t=e.marktype;var n=t==="group"||t==="text"||e.items.some((function(e){return e.description!=null&&e.aria!==false}));return ID(n?jD:BD,t+" mark container",e.description)}function VD(e,t){try{var n=e.items[0],r=t.caption||function(){return""};return ID(t.role||BD,t.desc,n.description||r(n))}catch(i){return null}}function YD(e){return oi(e.text).join(" ")}function XD(e){var t=e.datum,n=e.orient,r=t.title?QD(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),u=a.type,s=n==="left"||n==="right"?"Y":"X";return s+"-axis"+(r?" titled '"+r+"'":"")+(" for a "+(Pb(u)?"discrete":u)+" scale")+(" with "+Sx(o,a,e))}function JD(e){var t=e.datum,n=t.title?QD(e):null,r=((t.type||"")+" legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,u=o.scales[i[a[0]]].value,s=o.dataflow.locale();return KD(r)+(n?" titled '"+n+"'":"")+(" for "+ZD(a))+(" with "+Sx(s,u,e))}function QD(e){try{return oi(Ur(e.items).items[0].text).join(" ")}catch(t){return null}}function ZD(e){e=e.map((function(e){return e+(e==="fill"||e==="stroke"?" color":"")}));return e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Ur(e)}function KD(e){return e.length?e[0].toUpperCase()+e.slice(1):e}var eS=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};var tS=function(e){return eS(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")};function nS(){var e="",t="",n="";var r=[],i=function(){return t=n=""},a=function(a){if(t){e+=t+">"+n;i()}r.push(a)},o=function(e,n){if(n!=null)t+=" "+e+'="'+tS(n)+'"';return u},u={open:function(e){var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}a(e);t="<"+e;for(var i=0,s=n;i<s.length;i++){var l=s[i];for(var f in l)o(f,l[f])}return u},close:function(){var a=r.pop();if(t){e+=t+(n?">"+n+"</"+a+">":"/>")}else{e+="</"+a+">"}i();return u},attr:o,text:function(e){return n+=eS(e),u},toString:function(){return e}};return u}var rS=function(e){return iS(nS(),e)+""};function iS(e,t){e.open(t.tagName);if(t.hasAttributes()){var n=t.attributes,r=n.length;for(var i=0;i<r;++i){e.attr(n[i].name,n[i].value)}}if(t.hasChildNodes()){var a=t.childNodes,r=a.length;for(var i=0;i<r;i++){var o=a[i];o.nodeType===3?e.text(o.nodeValue):iS(e,o)}}return e.close()}var aS={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"};var oS={fill:"none","stroke-miterlimit":10};var uS=0,sS="http://www.w3.org/2000/xmlns/",lS=FA.xmlns;function fS(e){JE.call(this,e);this._dirtyID=0;this._dirty=[];this._svg=null;this._root=null;this._defs=null}var cS=JE.prototype;Ei(fS,JE,{initialize:function(e,t,n,r,i){this._defs={};this._clearDefs();if(e){this._svg=WE(e,0,"svg",lS);this._svg.setAttributeNS(sS,"xmlns",lS);this._svg.setAttributeNS(sS,"xmlns:xlink",FA["xmlns:xlink"]);this._svg.setAttribute("version",FA["version"]);this._svg.setAttribute("class","marks");HE(e,1);this._root=WE(this._svg,uS,"g",lS);kS(this._root,oS);HE(this._svg,uS+1)}this.background(this._bgcolor);return cS.initialize.call(this,e,t,n,r,i)},background:function(e){if(arguments.length&&this._svg){this._svg.style.setProperty("background-color",e)}return cS.background.apply(this,arguments)},resize:function(e,t,n,r){cS.resize.call(this,e,t,n,r);if(this._svg){kS(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height});this._root.setAttribute("transform","translate("+this._origin+")")}this._dirty=[];return this},canvas:function(){return this._svg},svg:function(){var e=this._svg,t=this._bgcolor;if(!e)return null;var n;if(t){e.removeAttribute("style");n=WE(e,uS,"rect",lS);kS(n,{width:this._width,height:this._height,fill:t})}var r=rS(e);if(t){e.removeChild(n);this._svg.style.setProperty("background-color",t)}return r},_render:function(e){if(this._dirtyCheck()){if(this._dirtyAll)this._clearDefs();this.mark(this._root,e);HE(this._root,1)}this.defs();this._dirty=[];++this._dirtyID;return this},dirty:function(e){if(e.dirty!==this._dirtyID){e.dirty=this._dirtyID;this._dirty.push(e)}},isDirty:function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck:function(){this._dirtyAll=true;var e=this._dirty;if(!e.length||!this._dirtyID)return true;var t=++this._dirtyID;var n,r,i,a,o,u,s;for(o=0,u=e.length;o<u;++o){n=e[o];r=n.mark;if(r.marktype!==i){i=r.marktype;a=OE[i]}if(r.zdirty&&r.dirty!==t){this._dirtyAll=false;dS(n,t);r.items.forEach((function(e){e.dirty=t}))}if(r.zdirty)continue;if(n.exit){if(a.nested&&r.items.length){s=r.items[0];if(s._svg)this._update(a,s._svg,s)}else if(n._svg){s=n._svg.parentNode;if(s)s.removeChild(n._svg)}n._svg=null;continue}n=a.nested?r.items[0]:n;if(n._update===t)continue;if(!n._svg||!n._svg.ownerSVGElement){this._dirtyAll=false;dS(n,t)}else{this._update(a,n._svg,n)}n._update=t}return!this._dirtyAll},mark:function(e,t,n){var r=this;if(!this.isDirty(t))return t._svg;var i=this._svg,a=OE[t.marktype],o=t.interactive===false?"none":null,u=a.tag==="g";var s=null,l=0;var f=gS(t,e,n,"g",i);f.setAttribute("class",GE(t));var c=GD(t);for(var d in c)AS(f,d,c[d]);if(!u){AS(f,"pointer-events",o)}AS(f,"clip-path",t.clip?Zw(this,t,t.group):null);var h=function(e){var t=r.isDirty(e),n=gS(e,f,s,a.tag,i);if(t){r._update(a,n,e);if(u)pS(r,n,e)}s=n;++l};if(a.nested){if(t.items.length)h(t.items[0])}else{$k(t,h)}HE(f,l);return f},_update:function(e,t,n){yS=t;_S=t.__values__;HD(xS,n);e.attr(xS,n,this);var r=bS[e.type];if(r)r.call(this,e,t,n);if(yS)this.style(yS,n)},style:function(e,t){if(t==null)return;for(var n in aS){var r=n==="font"?yE(t):t[n];if(r===_S[n])continue;var i=aS[n];if(r==null){e.removeAttribute(i)}else{if(Ox(r)){r=Nx(r,this._defs.gradient,DS())}e.setAttribute(i,r+"")}_S[n]=r}},defs:function(){var e=this._svg,t=this._defs;var n=t.el,r=0;for(var i in t.gradient){if(!n)t.el=n=WE(e,uS+1,"defs",lS);r=hS(n,t.gradient[i],r)}for(var a in t.clipping){if(!n)t.el=n=WE(e,uS+1,"defs",lS);r=vS(n,t.clipping[a],r)}if(n){r===0?(e.removeChild(n),t.el=null):HE(n,r)}},_clearDefs:function(){var e=this._defs;e.gradient={};e.clipping={}}});function dS(e,t){for(;e&&e.dirty!==t;e=e.mark.group){e.dirty=t;if(e.mark&&e.mark.dirty!==t){e.mark.dirty=t}else return}}function hS(e,t,n){var r,i,a;if(t.gradient==="radial"){var o=WE(e,n++,"pattern",lS);kS(o,{id:Fx+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"});o=WE(o,0,"rect",lS);kS(o,{width:1,height:1,fill:"url("+DS()+"#"+t.id+")"});e=WE(e,n++,"radialGradient",lS);kS(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else{e=WE(e,n++,"linearGradient",lS);kS(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2})}for(r=0,i=t.stops.length;r<i;++r){a=WE(e,r,"stop",lS);a.setAttribute("offset",t.stops[r].offset);a.setAttribute("stop-color",t.stops[r].color)}HE(e,r);return n}function vS(e,t,n){var r;e=WE(e,n,"clipPath",lS);e.setAttribute("id",t.id);if(t.path){r=WE(e,0,"path",lS);r.setAttribute("d",t.path)}else{r=WE(e,0,"rect",lS);kS(r,{x:0,y:0,width:t.width,height:t.height})}HE(e,1);return n+1}function pS(e,t,n){t=t.lastChild.previousSibling;var r,i=0;$k(n,(function(n){r=e.mark(t,n,r);++i}));HE(t,1+i)}function gS(e,t,n,r,i){var a=e._svg,o;if(!a){o=t.ownerDocument;a=UE(o,r,lS);e._svg=a;if(e.mark){a.__data__=e;a.__values__={fill:"default"};if(r==="g"){var u=UE(o,"path",lS);a.appendChild(u);u.__data__=e;var s=UE(o,"g",lS);a.appendChild(s);s.__data__=e;var l=UE(o,"path",lS);a.appendChild(l);l.__data__=e;l.__values__={fill:"default"}}}}if(a.ownerSVGElement!==i||mS(a,n)){t.insertBefore(a,n?n.nextSibling:t.firstChild)}return a}function mS(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}var yS=null,_S=null;var bS={group:function(e,t,n){var r=yS=t.childNodes[2];_S=r.__values__;e.foreground(xS,n,this);_S=t.__values__;yS=t.childNodes[1];e.content(xS,n,this);var i=yS=t.childNodes[0];e.background(xS,n,this);var a=n.mark.interactive===false?"none":null;if(a!==_S.events){AS(r,"pointer-events",a);AS(i,"pointer-events",a);_S.events=a}if(n.strokeForeground&&n.stroke){var o=n.fill;AS(r,"display",null);this.style(i,n);AS(i,"stroke",null);if(o)n.fill=null;_S=r.__values__;this.style(r,n);if(o)n.fill=o;yS=null}else{AS(r,"display","none")}},image:function(e,t,n){if(n.smooth===false){wS(t,"image-rendering","optimizeSpeed");wS(t,"image-rendering","pixelated")}else{wS(t,"image-rendering",null)}},text:function(e,t,n){var r=hE(n);var i,a,o,u;if(Rr(r)){a=r.map((function(e){return pE(n,e)}));i=a.join("\n");if(i!==_S.text){HE(t,0);o=t.ownerDocument;u=cE(n);a.forEach((function(e,r){var i=UE(o,"tspan",lS);i.__data__=n;i.textContent=e;if(r){i.setAttribute("x",0);i.setAttribute("dy",u)}t.appendChild(i)}));_S.text=i}}else{a=pE(n,r);if(a!==_S.text){t.textContent=a;_S.text=a}}AS(t,"font-family",yE(n));AS(t,"font-size",fE(n)+"px");AS(t,"font-style",n.fontStyle);AS(t,"font-variant",n.fontVariant);AS(t,"font-weight",n.fontWeight)}};function xS(e,t,n){if(t===_S[e])return;if(n){ES(yS,e,t,n)}else{AS(yS,e,t)}_S[e]=t}function wS(e,t,n){if(n!==_S[t]){if(n==null){e.style.removeProperty(t)}else{e.style.setProperty(t,n+"")}_S[t]=n}}function kS(e,t){for(var n in t){AS(e,n,t[n])}}function AS(e,t,n){if(n!=null){e.setAttribute(t,n)}else{e.removeAttribute(t)}}function ES(e,t,n,r){if(n!=null){e.setAttributeNS(r,t,n)}else{e.removeAttributeNS(r,t)}}function DS(){var e;return typeof window==="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function SS(e){JE.call(this,e);this._text=null;this._defs={gradient:{},clipping:{}}}Ei(SS,JE,{svg:function(){return this._text},_render:function(e){var t=nS();t.open("svg",mi({},FA,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height}));var n=this._bgcolor;if(n&&n!=="transparent"&&n!=="none"){t.open("rect",{width:this._width,height:this._height,fill:n}).close()}t.open("g",oS,{transform:"translate("+this._origin+")"});this.mark(t,e);t.close();this.defs(t);this._text=t.close()+"";return this},mark:function(e,t){var n=this;var r=OE[t.marktype],i=r.tag,a=[HD,r.attr];e.open("g",{class:GE(t),"clip-path":t.clip?Zw(this,t,t.group):null},GD(t),{"pointer-events":i!=="g"&&t.interactive===false?"none":null});var o=function(o){var u=n.href(o);if(u)e.open("a",u);e.open(i,n.attr(t,o,a,i!=="g"?i:null));if(i==="text"){var s=hE(o);if(Rr(s)){var l={x:0,dy:cE(o)};for(var f=0;f<s.length;++f){e.open("tspan",f?l:null).text(pE(o,s[f])).close()}}else{e.text(pE(o,s))}}else if(i==="g"){var c=o.strokeForeground,d=o.fill,h=o.stroke;if(c&&h){o.stroke=null}e.open("path",n.attr(t,o,r.background,"bgrect")).close();e.open("g",n.attr(t,o,r.content));$k(o,(function(t){return n.mark(e,t)}));e.close();if(c&&h){if(d)o.fill=null;o.stroke=h;e.open("path",n.attr(t,o,r.foreground,"bgrect")).close();if(d)o.fill=d}else{e.open("path",n.attr(t,o,r.foreground,"bgfore")).close()}}e.close();if(u)e.close()};if(r.nested){if(t.items&&t.items.length)o(t.items[0])}else{$k(t,o)}return e.close()},href:function(e){var t=this;var n=e.href;var r;if(n){if(r=this._hrefs&&this._hrefs[n]){return r}else{this.sanitizeURL(n).then((function(e){e["xlink:href"]=e.href;e.href=null;(t._hrefs||(t._hrefs={}))[n]=e}))}}return null},attr:function(e,t,n,r){var i=this;var a={},o=function(e,t,n,r){a[r||e]=t};if(Array.isArray(n)){n.forEach((function(e){return e(o,t,i)}))}else{n(o,t,this)}if(r){CS(a,t,e,r,this._defs)}return a},defs:function(e){var t=this._defs.gradient,n=this._defs.clipping,r=Object.keys(t).length+Object.keys(n).length;if(r===0)return;e.open("defs");for(var i in t){var a=t[i],o=a.stops;if(a.gradient==="radial"){e.open("pattern",{id:Fx+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"});e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close();e.close();e.open("radialGradient",{id:i,fx:a.x1,fy:a.y1,fr:a.r1,cx:a.x2,cy:a.y2,r:a.r2})}else{e.open("linearGradient",{id:i,x1:a.x1,x2:a.x2,y1:a.y1,y2:a.y2})}for(var u=0;u<o.length;++u){e.open("stop",{offset:o[u].offset,"stop-color":o[u].color}).close()}e.close()}for(var s in n){var l=n[s];e.open("clipPath",{id:s});if(l.path){e.open("path",{d:l.path}).close()}else{e.open("rect",{x:0,y:0,width:l.width,height:l.height}).close()}e.close()}e.close()}});function CS(e,t,n,r,i){if(t==null)return e;if(r==="bgrect"&&n.interactive===false){e["pointer-events"]="none"}if(r==="bgfore"){if(n.interactive===false){e["pointer-events"]="none"}e.display="none";if(t.fill!==null)return e}if(r==="image"&&t.smooth===false){e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"}if(r==="text"){e["font-family"]=yE(t);e["font-size"]=fE(t)+"px";e["font-style"]=t.fontStyle;e["font-variant"]=t.fontVariant;e["font-weight"]=t.fontWeight}for(var a in aS){var o=t[a];var u=aS[a];if(o==="transparent"&&(u==="fill"||u==="stroke"));else if(o!=null){if(Ox(o)){o=Nx(o,i.gradient,"")}e[u]=o}}return e}var MS="canvas";var FS="png";var OS="svg";var NS="none";var TS={Canvas:MS,PNG:FS,SVG:OS,None:NS};var zS={};zS[MS]=zS[FS]={renderer:CD,headless:CD,handler:_D};zS[OS]={renderer:fS,headless:SS,handler:ND};zS[NS]={};function RS(e,t){e=String(e||"").toLowerCase();if(arguments.length>1){zS[e]=t;return this}else{return zS[e]}}function PS(e,t,n){var r=[],i=(new Kw).union(t),a=e.marktype;return a?LS(e,i,n,r):a==="group"?BS(e,i,n,r):_r("Intersect scene must be mark node or group item.")}function LS(e,t,n,r){if(jS(e,t,n)){var i=e.items,a=e.marktype,o=i.length;var u=0;if(a==="group"){for(;u<o;++u){BS(i[u],t,n,r)}}else{for(var s=OE[a].isect;u<o;++u){var l=i[u];if(IS(l,t,s))r.push(l)}}}return r}function jS(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==false&&(!n||n(e)))}function BS(e,t,n,r){if(n&&n(e.mark)&&IS(e,t,OE.group.isect)){r.push(e)}var i=e.items,a=i&&i.length;if(a){var o=e.x||0,u=e.y||0;t.translate(-o,-u);for(var s=0;s<a;++s){LS(i[s],t,n,r)}t.translate(o,u)}return r}function IS(e,t,n){var r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}var US=new Kw;function qS(e){var t=e.clip;if(si(t)){t(Ak(US.clear()))}else if(t){US.set(0,0,e.group.width,e.group.height)}else return;e.bounds.intersect(US)}var WS=1e-9;function HS(e,t,n){return e===t?true:n==="path"?GS(e,t):e instanceof Date&&t instanceof Date?+e===+t:Fi(e)&&Fi(t)?Math.abs(e-t)<=WS:!e||!t||!Pr(e)&&!Pr(t)?e==t:$S(e,t)}function GS(e,t){return HS(Bx(e),Bx(t))}function $S(e,t){var n=Object.keys(e),r=Object.keys(t),i,a;if(n.length!==r.length)return false;n.sort();r.sort();for(a=n.length-1;a>=0;a--){if(n[a]!=r[a])return false}for(a=n.length-1;a>=0;a--){i=n[a];if(!HS(e[i],t[i],i))return false}return typeof e===typeof t}function VS(){Qw();Mx()}var YS="top";var XS="left";var JS="right";var QS="bottom";var ZS="top-left";var KS="top-right";var eC="bottom-left";var tC="bottom-right";var nC="start";var rC="middle";var iC="end";var aC="x";var oC="y";var uC="group";var sC="axis";var lC="title";var fC="frame";var cC="scope";var dC="legend";var hC="row-header";var vC="row-footer";var pC="row-title";var gC="column-header";var mC="column-footer";var yC="column-title";var _C="padding";var bC="symbol";var xC="fit";var wC="fit-x";var kC="fit-y";var AC="pad";var EC="none";var DC="all";var SC="each";var CC="flush";var MC="column";var FC="row";function OC(e){ad.call(this,null,e)}Ei(OC,ad,{transform:function(e,t){var n=t.dataflow,r=e.mark,i=r.marktype,a=OE[i],o=a.bound;var u=r.bounds,s;if(a.nested){if(r.items.length)n.dirty(r.items[0]);u=NC(r,o);r.items.forEach((function(e){e.bounds.clear().union(u)}))}else if(i===uC||e.modified()){t.visit(t.MOD,(function(e){return n.dirty(e)}));u.clear();r.items.forEach((function(e){return u.union(NC(e,o))}));switch(r.role){case sC:case dC:case lC:t.reflow()}}else{s=t.changed(t.REM);t.visit(t.ADD,(function(e){u.union(NC(e,o))}));t.visit(t.MOD,(function(e){s=s||u.alignsWith(e.bounds);n.dirty(e);u.union(NC(e,o))}));if(s){u.clear();r.items.forEach((function(e){return u.union(e.bounds)}))}}qS(r);return t.modifies("bounds")}});function NC(e,t,n){return t(e.bounds.clear(),e,n)}var TC=":vega_identifier:";function zC(e){ad.call(this,0,e)}zC.Definition={type:"Identifier",metadata:{modifies:true},params:[{name:"as",type:"string",required:true}]};Ei(zC,ad,{transform:function(e,t){var n=RC(t.dataflow),r=e.as;var i=n.value;t.visit(t.ADD,(function(e){return e[r]=e[r]||++i}));n.set(this.value=i);return t}});function RC(e){return e._signals[TC]||(e._signals[TC]=e.add(0))}function PC(e){ad.call(this,null,e)}Ei(PC,ad,{transform:function(e,t){var n=this.value;if(!n){n=t.dataflow.scenegraph().mark(e.markdef,LC(e),e.index);n.group.context=e.context;if(!e.context.group)e.context.group=n.group;n.source=this.source;n.clip=e.clip;n.interactive=e.interactive;this.value=n}var r=n.marktype===uC?tk:ek;t.visit(t.ADD,(function(e){return r.call(e,n)}));if(e.modified("clip")||e.modified("interactive")){n.clip=e.clip;n.interactive=!!e.interactive;n.zdirty=true;t.reflow()}n.items=t.source;return t}});function LC(e){var t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function jC(e){ad.call(this,null,e)}var BC={parity:function(e){return e.filter((function(e,t){return t%2?e.opacity=0:1}))},greedy:function(e,t){var n;return e.filter((function(e,r){return!r||!IC(n.bounds,e.bounds,t)?(n=e,1):e.opacity=0}))}};var IC=function(e,t,n){return n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2)};var UC=function(e,t){for(var n=1,r=e.length,i=e[0].bounds,a;n<r;i=a,++n){if(IC(i,a=e[n].bounds,t))return true}};var qC=function(e){var t=e.bounds;return t.width()>1&&t.height()>1};var WC=function(e,t,n){var r=e.range(),i=new Kw;if(t===YS||t===QS){i.set(r[0],-Infinity,r[1],+Infinity)}else{i.set(-Infinity,r[0],+Infinity,r[1])}i.expand(n||1);return function(e){return i.encloses(e.bounds)}};var HC=function(e){e.forEach((function(e){return e.opacity=1}));return e};var GC=function(e,t){return e.reflow(t.modified()).modifies("opacity")};Ei(jC,ad,{transform:function(e,t){var n=BC[e.method]||BC.parity,r=e.separation||0;var i=t.materialize(t.SOURCE).source,a,o;if(!i||!i.length)return;if(!e.method){if(e.modified("method")){HC(i);t=GC(t,e)}return t}i=i.filter(qC);if(!i.length)return;if(e.sort){i=i.slice().sort(e.sort)}a=HC(i);t=GC(t,e);if(a.length>=3&&UC(a,r)){do{a=n(a,r)}while(a.length>=3&&UC(a,r));if(a.length<3&&!Ur(i).opacity){if(a.length>1)Ur(a).opacity=0;Ur(i).opacity=1}}if(e.boundScale&&e.boundTolerance>=0){o=WC(e.boundScale,e.boundOrient,+e.boundTolerance);i.forEach((function(e){if(!o(e))e.opacity=0}))}var u=a[0].mark.bounds.clear();i.forEach((function(e){if(e.opacity)u.union(e.bounds)}));return t}});function $C(e){ad.call(this,null,e)}Ei($C,ad,{transform:function(e,t){var n=t.dataflow;t.visit(t.ALL,(function(e){return n.dirty(e)}));if(t.fields&&t.fields["zindex"]){var r=t.source&&t.source[0];if(r)r.mark.zdirty=true}}});var VC=new Kw;function YC(e,t,n){return e[t]===n?0:(e[t]=n,1)}function XC(e){var t=e.items[0].orient;return t===XS||t===JS}function JC(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function QC(e,t,n,r){var i=t.items[0],a=i.datum,o=i.translate!=null?i.translate:.5,u=i.orient,s=JC(a),l=i.range,f=i.offset,c=i.position,d=i.minExtent,h=i.maxExtent,v=a.title&&i.items[s[2]].items[0],p=i.titlePadding,g=i.bounds,m=v&&vE(v),y=0,_=0,b,x;VC.clear().union(g);g.clear();if((b=s[0])>-1)g.union(i.items[b].bounds);if((b=s[1])>-1)g.union(i.items[b].bounds);switch(u){case YS:y=c||0;_=-f;x=Math.max(d,Math.min(h,-g.y1));g.add(0,-x).add(l,0);if(v)ZC(e,v,x,p,m,0,-1,g);break;case XS:y=-f;_=c||0;x=Math.max(d,Math.min(h,-g.x1));g.add(-x,0).add(0,l);if(v)ZC(e,v,x,p,m,1,-1,g);break;case JS:y=n+f;_=c||0;x=Math.max(d,Math.min(h,g.x2));g.add(0,0).add(x,l);if(v)ZC(e,v,x,p,m,1,1,g);break;case QS:y=c||0;_=r+f;x=Math.max(d,Math.min(h,g.y2));g.add(0,0).add(l,x);if(v)ZC(e,v,x,p,0,0,1,g);break;default:y=i.x;_=i.y}ak(g.translate(y,_),i);if(YC(i,"x",y+o)|YC(i,"y",_+o)){i.bounds=VC;e.dirty(i);i.bounds=g;e.dirty(i)}return i.mark.bounds.clear().union(g)}function ZC(e,t,n,r,i,a,o,u){var s=t.bounds;if(t.auto){var l=o*(n+i+r);var f=0,c=0;e.dirty(t);a?f=(t.x||0)-(t.x=l):c=(t.y||0)-(t.y=l);t.mark.bounds.clear().union(s.translate(-f,-c));e.dirty(t)}u.union(s)}var KC=function(e,t){return Math.floor(Math.min(e,t))};var eM=function(e,t){return Math.ceil(Math.max(e,t))};function tM(e){var t,n,r,i,a;var o=e.items,u=o.length,s=0,l,f;var c={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;s<u;++s){l=o[s];f=l.items;if(l.marktype===uC){switch(l.role){case sC:case dC:case lC:break;case hC:(t=c.rowheaders).push.apply(t,f);break;case vC:(n=c.rowfooters).push.apply(n,f);break;case gC:(r=c.colheaders).push.apply(r,f);break;case mC:(i=c.colfooters).push.apply(i,f);break;case pC:c.rowtitle=f[0];break;case yC:c.coltitle=f[0];break;default:(a=c.marks).push.apply(a,f)}}}return c}function nM(e){return(new Kw).set(0,0,e.width||0,e.height||0)}function rM(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function iM(e,t,n){var r=Pr(e)?e[t]:e;return r!=null?r:n!==undefined?n:0}function aM(e){return e<0?Math.ceil(-e):0}function oM(e,t,n){var r=!n.nodirty,i=n.bounds===CC?nM:rM,a=VC.set(0,0,0,0),o=iM(n.align,MC),u=iM(n.align,FC),s=iM(n.padding,MC),l=iM(n.padding,FC),f=n.columns||t.length,c=f<=0?1:Math.ceil(t.length/f),d=t.length,h=Array(d),v=Array(f),p=0,g=Array(d),m=Array(c),y=0,_=Array(d),b=Array(d),x=Array(d),w,k,A,E,D,S,C,M,F,O,N;for(k=0;k<f;++k)v[k]=0;for(k=0;k<c;++k)m[k]=0;for(k=0;k<d;++k){S=t[k];D=x[k]=i(S);S.x=S.x||0;_[k]=0;S.y=S.y||0;b[k]=0;A=k%f;E=~~(k/f);p=Math.max(p,C=Math.ceil(D.x2));y=Math.max(y,M=Math.ceil(D.y2));v[A]=Math.max(v[A],C);m[E]=Math.max(m[E],M);h[k]=s+aM(D.x1);g[k]=l+aM(D.y1);if(r)e.dirty(t[k])}for(k=0;k<d;++k){if(k%f===0)h[k]=0;if(k<f)g[k]=0}if(o===SC){for(A=1;A<f;++A){for(N=0,k=A;k<d;k+=f){if(N<h[k])N=h[k]}for(k=A;k<d;k+=f){h[k]=N+v[A-1]}}}else if(o===DC){for(N=0,k=0;k<d;++k){if(k%f&&N<h[k])N=h[k]}for(k=0;k<d;++k){if(k%f)h[k]=N+p}}else{for(o=false,A=1;A<f;++A){for(k=A;k<d;k+=f){h[k]+=v[A-1]}}}if(u===SC){for(E=1;E<c;++E){for(N=0,k=E*f,w=k+f;k<w;++k){if(N<g[k])N=g[k]}for(k=E*f;k<w;++k){g[k]=N+m[E-1]}}}else if(u===DC){for(N=0,k=f;k<d;++k){if(N<g[k])N=g[k]}for(k=f;k<d;++k){g[k]=N+y}}else{for(u=false,E=1;E<c;++E){for(k=E*f,w=k+f;k<w;++k){g[k]+=m[E-1]}}}for(F=0,k=0;k<d;++k){F=h[k]+(k%f?F:0);_[k]+=F-t[k].x}for(A=0;A<f;++A){for(O=0,k=A;k<d;k+=f){O+=g[k];b[k]+=O-t[k].y}}if(o&&iM(n.center,MC)&&c>1){for(k=0;k<d;++k){D=o===DC?p:v[k%f];F=D-x[k].x2-t[k].x-_[k];if(F>0)_[k]+=F/2}}if(u&&iM(n.center,FC)&&f!==1){for(k=0;k<d;++k){D=u===DC?y:m[~~(k/f)];O=D-x[k].y2-t[k].y-b[k];if(O>0)b[k]+=O/2}}for(k=0;k<d;++k){a.union(x[k].translate(_[k],b[k]))}F=iM(n.anchor,aC);O=iM(n.anchor,oC);switch(iM(n.anchor,MC)){case iC:F-=a.width();break;case rC:F-=a.width()/2}switch(iM(n.anchor,FC)){case iC:O-=a.height();break;case rC:O-=a.height()/2}F=Math.round(F);O=Math.round(O);a.clear();for(k=0;k<d;++k){t[k].mark.bounds.clear()}for(k=0;k<d;++k){S=t[k];S.x+=_[k]+=F;S.y+=b[k]+=O;a.union(S.mark.bounds.union(S.bounds.translate(_[k],b[k])));if(r)e.dirty(S)}return a}function uM(e,t,n){var r=tM(t),i=r.marks,a=n.bounds===CC?sM:lM,o=n.offset,u=n.columns||i.length,s=u<=0?1:Math.ceil(i.length/u),l=s*u,f,c,d,h,v,p,g;var m=oM(e,i,n);if(m.empty())m.set(0,0,0,0);if(r.rowheaders){p=iM(n.headerBand,FC,null);f=fM(e,r.rowheaders,i,u,s,-iM(o,"rowHeader"),KC,0,a,"x1",0,u,1,p)}if(r.colheaders){p=iM(n.headerBand,MC,null);c=fM(e,r.colheaders,i,u,u,-iM(o,"columnHeader"),KC,1,a,"y1",0,1,u,p)}if(r.rowfooters){p=iM(n.footerBand,FC,null);d=fM(e,r.rowfooters,i,u,s,iM(o,"rowFooter"),eM,0,a,"x2",u-1,u,1,p)}if(r.colfooters){p=iM(n.footerBand,MC,null);h=fM(e,r.colfooters,i,u,u,iM(o,"columnFooter"),eM,1,a,"y2",l-u,1,u,p)}if(r.rowtitle){v=iM(n.titleAnchor,FC);g=iM(o,"rowTitle");g=v===iC?d+g:f-g;p=iM(n.titleBand,FC,.5);cM(e,r.rowtitle,g,0,m,p)}if(r.coltitle){v=iM(n.titleAnchor,MC);g=iM(o,"columnTitle");g=v===iC?h+g:c-g;p=iM(n.titleBand,MC,.5);cM(e,r.coltitle,g,1,m,p)}}function sM(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):undefined}function lM(e,t){return e.bounds[t]}function fM(e,t,n,r,i,a,o,u,s,l,f,c,d,h){var v=n.length,p=0,g=0,m,y,_,b,x,w,k,A,E;if(!v)return p;for(m=f;m<v;m+=c){if(n[m])p=o(p,s(n[m],l))}if(!t.length)return p;if(t.length>i){e.warn("Grid headers exceed limit: "+i);t=t.slice(0,i)}p+=a;for(y=0,b=t.length;y<b;++y){e.dirty(t[y]);t[y].mark.bounds.clear()}for(m=f,y=0,b=t.length;y<b;++y,m+=c){w=t[y];x=w.mark.bounds;for(_=m;_>=0&&(k=n[_])==null;_-=d);if(u){A=h==null?k.x:Math.round(k.bounds.x1+h*k.bounds.width());E=p}else{A=p;E=h==null?k.y:Math.round(k.bounds.y1+h*k.bounds.height())}x.union(w.bounds.translate(A-(w.x||0),E-(w.y||0)));w.x=A;w.y=E;e.dirty(w);g=o(g,x[l])}return g}function cM(e,t,n,r,i,a){if(!t)return;e.dirty(t);var o=n,u=n;r?o=Math.round(i.x1+a*i.width()):u=Math.round(i.y1+a*i.height());t.bounds.translate(o-(t.x||0),u-(t.y||0));t.mark.bounds.clear().union(t.bounds);t.x=o;t.y=u;e.dirty(t)}function dM(e,t){var n=e[t]||{};return function(t,r){return n[t]!=null?n[t]:e[t]!=null?e[t]:r}}function hM(e,t){var n=-Infinity;e.forEach((function(e){if(e.offset!=null)n=Math.max(n,e.offset)}));return n>-Infinity?n:t}function vM(e,t,n,r,i,a,o){var u=dM(n,t),s=hM(e,u("offset",0)),l=u("anchor",nC),f=l===iC?1:l===rC?.5:0;var c={align:SC,bounds:u("bounds",CC),columns:u("direction")==="vertical"?1:e.length,padding:u("margin",8),center:u("center"),nodirty:true};switch(t){case XS:c.anchor={x:Math.floor(r.x1)-s,column:iC,y:f*(o||r.height()+2*r.y1),row:l};break;case JS:c.anchor={x:Math.ceil(r.x2)+s,y:f*(o||r.height()+2*r.y1),row:l};break;case YS:c.anchor={y:Math.floor(i.y1)-s,row:iC,x:f*(a||i.width()+2*i.x1),column:l};break;case QS:c.anchor={y:Math.ceil(i.y2)+s,x:f*(a||i.width()+2*i.x1),column:l};break;case ZS:c.anchor={x:s,y:s};break;case KS:c.anchor={x:a-s,y:s,column:iC};break;case eC:c.anchor={x:s,y:o-s,row:iC};break;case tC:c.anchor={x:a-s,y:o-s,column:iC,row:iC};break}return c}function pM(e,t){var n=t.items[0],r=n.datum,i=n.orient,a=n.bounds,o=n.x,u=n.y,s,l;n._bounds?n._bounds.clear().union(a):n._bounds=a.clone();a.clear();mM(e,n,n.items[0].items[0]);a=gM(n,a);s=2*n.padding;l=2*n.padding;if(!a.empty()){s=Math.ceil(a.width()+s);l=Math.ceil(a.height()+l)}if(r.type===bC){bM(n.items[0].items[0].items[0].items)}if(i!==EC){n.x=o=0;n.y=u=0}n.width=s;n.height=l;ak(a.set(o,u,o+s,u+l),n);n.mark.bounds.clear().union(a);return n}function gM(e,t){e.items.forEach((function(e){return t.union(e.bounds)}));t.x1=e.padding;t.y1=e.padding;return t}function mM(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(!t.datum.title){if(i||a)_M(e,n,i,a)}else{var o=t.items[1].items[0],u=o.anchor,s=t.titlePadding||0,l=r-o.x,f=r-o.y;switch(o.orient){case XS:i+=Math.ceil(o.bounds.width())+s;break;case JS:case QS:break;default:a+=o.bounds.height()+s}if(i||a)_M(e,n,i,a);switch(o.orient){case XS:f+=yM(t,n,o,u,1,1);break;case JS:l+=yM(t,n,o,iC,0,0)+s;f+=yM(t,n,o,u,1,1);break;case QS:l+=yM(t,n,o,u,0,0);f+=yM(t,n,o,iC,-1,0,1)+s;break;default:l+=yM(t,n,o,u,0,0)}if(l||f)_M(e,o,l,f);if((l=Math.round(o.bounds.x1-r))<0){_M(e,n,-l,0);_M(e,o,-l,0)}}}function yM(e,t,n,r,i,a,o){var u=e.datum.type!=="symbol",s=n.datum.vgrad,l=u&&(a||!s)&&!o?t.items[0]:t,f=l.bounds[i?"y2":"x2"]-e.padding,c=s&&a?f:0,d=s&&a?0:f,h=i<=0?0:vE(n);return Math.round(r===nC?c:r===iC?d-h:.5*(f-h))}function _M(e,t,n,r){t.x+=n;t.y+=r;t.bounds.translate(n,r);t.mark.bounds.translate(n,r);e.dirty(t)}function bM(e){var t=e.reduce((function(e,t){e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0);return e}),{});e.forEach((function(e){e.width=t[e.column];e.height=e.bounds.y2-e.y}))}function xM(e,t,n,r,i){var a=t.items[0],o=a.frame,u=a.orient,s=a.anchor,l=a.offset,f=a.padding,c=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],h=u===XS||u===JS?r:n,v=0,p=0,g=0,m=0,y=0,_;if(o!==uC){u===XS?(v=i.y2,h=i.y1):u===JS?(v=i.y1,h=i.y2):(v=i.x1,h=i.x2)}else if(u===XS){v=r,h=0}_=s===nC?v:s===iC?h:(v+h)/2;if(d&&d.text){switch(u){case YS:case QS:y=c.bounds.height()+f;break;case XS:m=c.bounds.width()+f;break;case JS:m=-c.bounds.width()-f;break}VC.clear().union(d.bounds);VC.translate(m-(d.x||0),y-(d.y||0));if(YC(d,"x",m)|YC(d,"y",y)){e.dirty(d);d.bounds.clear().union(VC);d.mark.bounds.clear().union(VC);e.dirty(d)}VC.clear().union(d.bounds)}else{VC.clear()}VC.union(c.bounds);switch(u){case YS:p=_;g=i.y1-VC.height()-l;break;case XS:p=i.x1-VC.width()-l;g=_;break;case JS:p=i.x2+VC.width()+l;g=_;break;case QS:p=_;g=i.y2+l;break;default:p=a.x;g=a.y}if(YC(a,"x",p)|YC(a,"y",g)){VC.translate(p,g);e.dirty(a);a.bounds.clear().union(VC);t.bounds.clear().union(VC);e.dirty(a)}return a.bounds}function wM(e){ad.call(this,null,e)}Ei(wM,ad,{transform:function(e,t){var n=t.dataflow;e.mark.items.forEach((function(t){if(e.layout)uM(n,t,e.layout);AM(n,t,e)}));return kM(e.mark.group)?t.reflow():t}});function kM(e){return e&&e.mark.role!=="legend-entry"}function AM(e,t,n){var r=t.items,i=Math.max(0,t.width||0),a=Math.max(0,t.height||0),o=(new Kw).set(0,0,i,a),u=o.clone(),s=o.clone(),l=[],f,c,d,h,v,p;for(v=0,p=r.length;v<p;++v){c=r[v];switch(c.role){case sC:h=XC(c)?u:s;h.union(QC(e,c,i,a));break;case lC:f=c;break;case dC:l.push(pM(e,c));break;case fC:case cC:case hC:case vC:case pC:case gC:case mC:case yC:u.union(c.bounds);s.union(c.bounds);break;default:o.union(c.bounds)}}if(l.length){var g={};l.forEach((function(e){d=e.orient||JS;if(d!==EC)(g[d]||(g[d]=[])).push(e)}));for(var m in g){var y=g[m];oM(e,y,vM(y,m,n.legends,u,s,i,a))}l.forEach((function(t){var r=t.bounds;if(!r.equals(t._bounds)){t.bounds=t._bounds;e.dirty(t);t.bounds=r;e.dirty(t)}if(n.autosize&&n.autosize.type===xC){switch(t.orient){case XS:case JS:o.add(r.x1,0).add(r.x2,0);break;case YS:case QS:o.add(0,r.y1).add(0,r.y2)}}else{o.union(r)}}))}o.union(u).union(s);if(f){o.union(xM(e,f,i,a,o))}if(t.clip){o.set(0,0,t.width||0,t.height||0)}EM(e,t,o,n)}function EM(e,t,n,r){var i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;var o=e._width,u=e._height,s=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),f=Math.max(0,t.height||0),c=Math.max(0,Math.ceil(-n.y1));var d=Math.max(0,Math.ceil(n.x2-s)),h=Math.max(0,Math.ceil(n.y2-f));if(i.contains===_C){var v=e.padding();o-=v.left+v.right;u-=v.top+v.bottom}if(a===EC){l=0;c=0;s=o;f=u}else if(a===xC){s=Math.max(0,o-l-d);f=Math.max(0,u-c-h)}else if(a===wC){s=Math.max(0,o-l-d);u=f+c+h}else if(a===kC){o=s+l+d;f=Math.max(0,u-c-h)}else if(a===AC){o=s+l+d;u=f+c+h}e._resizeView(o,u,s,f,[l,c],i.resize)}var DM=Object.freeze({__proto__:null,bound:OC,identifier:zC,mark:PC,overlap:jC,render:$C,viewlayout:wM});function SM(e){ad.call(this,null,e)}Ei(SM,ad,{transform:function(e,t){if(this.value&&!e.modified()){return t.StopPropagation}var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,u=ux(a,o,e.minstep),s=e.format||fx(n,a,u,e.formatSpecifier,e.formatType,!!e.values),l=e.values?sx(a,e.values,u):lx(a,u);if(i)r.rem=i;i=l.map((function(e,t){return $f({index:t/(l.length-1||1),value:e,label:s(e)})}));if(e.extra&&i.length){i.push($f({index:-1,extra:{value:i[0].value},label:""}))}r.source=i;r.add=i;this.value=i;return r}});function CM(e){ad.call(this,null,e)}function MM(){return $f({})}function FM(e){var t=ki().test((function(e){return e.exit}));t.lookup=function(n){return t.get(e(n))};return t}Ei(CM,ad,{transform:function(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||MM,a=e.key||Hf,o=this.value;if(Rr(r.encode)){r.encode=null}if(o&&(e.modified("key")||t.modified(a))){_r("DataJoin does not support modified key function or fields.")}if(!o){t=t.addAll();this.value=o=FM(a)}t.visit(t.ADD,(function(e){var t=a(e);var n=o.get(t);if(n){if(n.exit){o.empty--;r.add.push(n)}else{r.mod.push(n)}}else{n=i(e);o.set(t,n);r.add.push(n)}n.datum=e;n.exit=false}));t.visit(t.MOD,(function(e){var t=a(e),n=o.get(t);if(n){n.datum=e;r.mod.push(n)}}));t.visit(t.REM,(function(e){var t=a(e),n=o.get(t);if(e===n.datum&&!n.exit){r.rem.push(n);n.exit=true;++o.empty}}));if(t.changed(t.ADD_MOD))r.modifies("datum");if(t.clean()||e.clean&&o.empty>n.cleanThreshold){n.runAfter(o.clean)}return r}});function OM(e){ad.call(this,null,e)}Ei(OM,ad,{transform:function(e,t){var n=t.fork(t.ADD_REM),r=e.mod||false,i=e.encoders,a=t.encode;if(Rr(a)){if(n.changed()||a.every((function(e){return i[e]}))){a=a[0];n.encode=null}else{return t.StopPropagation}}var o=a==="enter",u=i.update||Sr,s=i.enter||Sr,l=i.exit||Sr,f=(a&&!o?i[a]:u)||Sr;if(t.changed(t.ADD)){t.visit(t.ADD,(function(t){s(t,e);u(t,e)}));n.modifies(s.output);n.modifies(u.output);if(f!==Sr&&f!==u){t.visit(t.ADD,(function(t){f(t,e)}));n.modifies(f.output)}}if(t.changed(t.REM)&&l!==Sr){t.visit(t.REM,(function(t){l(t,e)}));n.modifies(l.output)}if(o||f!==Sr){var c=t.MOD|(e.modified()?t.REFLOW:0);if(o){t.visit(c,(function(t){var i=s(t,e)||r;if(f(t,e)||i)n.mod.push(t)}));if(n.mod.length)n.modifies(s.output)}else{t.visit(c,(function(t){if(f(t,e)||r)n.mod.push(t)}))}if(n.mod.length)n.modifies(f.output)}return n.changed()?n:t.StopPropagation}});function NM(e){ad.call(this,[],e)}Ei(NM,ad,{transform:function(e,t){if(this.value!=null&&!e.modified()){return t.StopPropagation}var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.type||tx,o=e.scale,u=+e.limit,s=ux(o,e.count==null?5:e.count,e.minstep),l=!!e.values||a===tx,f=e.format||_x(n,o,s,a,e.formatSpecifier,e.formatType,l),c=e.values||vx(o,s),d,h,v,p,g;if(i)r.rem=i;if(a===tx){if(u&&c.length>u){t.dataflow.warn("Symbol legend count exceeds limit, filtering items.");i=c.slice(0,u-1);g=true}else{i=c}if(si(v=e.size)){if(!e.values&&o(i[0])===0){i=i.slice(1)}p=i.reduce((function(t,n){return Math.max(t,v(n,e))}),0)}else{v=pi(p=v||8)}i=i.map((function(t,n){return $f({index:n,label:f(t,n,i),value:t,offset:p,size:v(t,e)})}));if(g){g=c[i.length];i.push($f({index:i.length,label:"…".concat(c.length-i.length," entries"),value:g,offset:p,size:v(g,e)}))}}else if(a===rx){d=o.domain(),h=$b(o,d[0],Ur(d));if(c.length<3&&!e.values&&d[0]!==Ur(d)){c=[d[0],Ur(d)]}i=c.map((function(e,t){return $f({index:t,label:f(e,t,c),value:e,perc:h(e)})}))}else{v=c.length-1;h=Ex(o);i=c.map((function(e,t){return $f({index:t,label:f(e,t,c),value:e,perc:t?h(e):0,perc2:t===v?1:h(c[t+1])})}))}r.source=i;r.add=i;this.value=i;return r}});var TM=function(e){return e.source.x};var zM=function(e){return e.source.y};var RM=function(e){return e.target.x};var PM=function(e){return e.target.y};function LM(e){ad.call(this,{},e)}LM.Definition={type:"LinkPath",metadata:{modifies:true},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};Ei(LM,ad,{transform:function(e,t){var n=e.sourceX||TM,r=e.sourceY||zM,i=e.targetX||RM,a=e.targetY||PM,o=e.as||"path",u=e.orient||"vertical",s=e.shape||"line",l=JM.get(s+"-"+u)||JM.get(s);if(!l){_r("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:""))}t.visit(t.SOURCE,(function(e){e[o]=l(n(e),r(e),i(e),a(e))}));return t.reflow(e.modified()).modifies(o)}});var jM=function(e,t,n,r){return"M"+e+","+t+"L"+n+","+r};var BM=function(e,t,n,r){return jM(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))};var IM=function(e,t,n,r){var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2,u=180*Math.atan2(a,i)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+u+" 0 1"+" "+n+","+r};var UM=function(e,t,n,r){return IM(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))};var qM=function(e,t,n,r){var i=n-e,a=r-t,o=.2*(i+a),u=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+u)+" "+(n+u)+","+(r-o)+" "+n+","+r};var WM=function(e,t,n,r){return qM(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))};var HM=function(e,t,n,r){return"M"+e+","+t+"V"+r+"H"+n};var GM=function(e,t,n,r){return"M"+e+","+t+"H"+n+"V"+r};var $M=function(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),u=Math.sin(n),s=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+(s?1:0)+" "+t*o+","+t*u+"L"+r*o+","+r*u};var VM=function(e,t,n,r){var i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r};var YM=function(e,t,n,r){var i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r};var XM=function(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),u=Math.sin(n),s=(t+r)/2;return"M"+t*i+","+t*a+"C"+s*i+","+s*a+" "+s*o+","+s*u+" "+r*o+","+r*u};var JM=ki({line:jM,"line-radial":BM,arc:IM,"arc-radial":UM,curve:qM,"curve-radial":WM,"orthogonal-horizontal":HM,"orthogonal-vertical":GM,"orthogonal-radial":$M,"diagonal-horizontal":VM,"diagonal-vertical":YM,"diagonal-radial":XM});function QM(e){ad.call(this,null,e)}QM.Definition={type:"Pie",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:false},{name:"as",type:"string",array:true,length:2,default:["startAngle","endAngle"]}]};Ei(QM,ad,{transform:function(e,t){var n=e.as||["startAngle","endAngle"],r=n[0],i=n[1],a=e.field||Er,o=e.startAngle||0,u=e.endAngle!=null?e.endAngle:2*Math.PI,s=t.source,l=s.map(a),f=l.length,c=o,d=(u-o)/Ao(l),h=ko(f),v,p,g;if(e.sort){h.sort((function(e,t){return l[e]-l[t]}))}for(v=0;v<f;++v){g=l[h[v]];p=s[h[v]];p[r]=c;p[i]=c+=g*d}this.value=l;return t.reflow(e.modified()).modifies(n)}});var ZM=5;function KM(e){var t=e.type;return!e.bins&&(t===eb||t===nb||t===rb)}function eF(e){return Rb(e)&&e!==ub}var tF=$i(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function nF(e){ad.call(this,null,e);this.modified(true)}Ei(nF,ad,{transform:function(e,t){var n=t.dataflow,r=this.value,i=rF(e);if(!r||i!==r.type){this.value=r=Nb(i)()}for(i in e)if(!tF[i]){if(i==="padding"&&eF(r.type))continue;si(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}fF(r,e,lF(r,e,aF(r,e,n)));return t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function rF(e){var t=e.type,n="",r;if(t===ub)return ub+"-"+eb;if(iF(e)){r=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0;n=r===2?ub+"-":r===3?sb+"-":""}return(n+t||eb).toLowerCase()}function iF(e){var t=e.type;return Rb(t)&&t!==ab&&t!==ob&&(e.scheme||e.range&&e.range.length&&e.range.every(Ni))}function aF(e,t,n){var r=oF(e,t.domainRaw,n);if(r>-1)return r;var i=t.domain,a=e.type,o=t.zero||t.zero===undefined&&KM(e),u,s;if(!i)return 0;if(eF(a)&&t.padding&&i[0]!==Ur(i)){i=uF(a,i,t.range,t.padding,t.exponent,t.constant)}if(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null){u=(i=i.slice()).length-1||1;if(o){if(i[0]>0)i[0]=0;if(i[u]<0)i[u]=0}if(t.domainMin!=null)i[0]=t.domainMin;if(t.domainMax!=null)i[u]=t.domainMax;if(t.domainMid!=null){s=t.domainMid;var l=s>i[u]?u+1:s<i[0]?0:u;if(l!==u)n.warn("Scale domainMid exceeds domain min or max.",s);i.splice(l,0,s)}}e.domain(sF(a,i,n));if(a===db){e.unknown(t.domainImplicit?zg:undefined)}if(t.nice&&e.nice){e.nice(t.nice!==true&&ux(e,t.nice)||null)}return i.length}function oF(e,t,n){if(t){e.domain(sF(e.type,t,n));return t.length}else{return-1}}function uF(e,t,n,r,i,a){var o=Math.abs(Ur(n)-n[0]),u=o/(o-2*r),s=e===tb?ti(t,null,u):e===rb?ni(t,null,u,.5):e===nb?ni(t,null,u,i||1):e===ib?ri(t,null,u,a||1):ei(t,null,u);t=t.slice();t[0]=s[0];t[t.length-1]=s[1];return t}function sF(e,t,n){if(jb(e)){var r=Math.abs(t.reduce((function(e,t){return e+(t<0?-1:t>0?1:0)}),0));if(r!==t.length){n.warn("Log scale domain includes zero: "+Ui(t))}}return t}function lF(e,t,n){var r=t.bins;if(r&&!Rr(r)){var i=e.domain(),a=i[0],o=Ur(i),u=r.step;var s=r.start==null?a:r.start,l=r.stop==null?o:r.stop;if(!u)_r("Scale bins parameter missing step property.");if(s<a)s=u*Math.ceil(a/u);if(l>o)l=u*Math.floor(o/u);r=ko(s,l+u/2,u)}if(r){e.bins=r}else if(e.bins){delete e.bins}if(e.type===pb){if(!r){e.bins=e.domain()}else if(!t.domain&&!t.domainRaw){e.domain(r);n=r.length}}return n}function fF(e,t,n){var r=e.type,i=t.round||false,a=t.range;if(t.rangeStep!=null){a=cF(r,t,n)}else if(t.scheme){a=dF(r,t,n);if(si(a)){if(e.interpolator){return e.interpolator(a)}else{_r("Scale type ".concat(r," does not support interpolating color schemes."))}}}if(a&&Ib(r)){return e.interpolator(Hb(vF(a,t.reverse),t.interpolate,t.interpolateGamma))}if(a&&t.interpolate&&e.interpolate){e.interpolate(Vb(t.interpolate,t.interpolateGamma))}else if(si(e.round)){e.round(i)}else if(si(e.rangeRound)){e.interpolate(i?xy:yy)}if(a)e.range(vF(a,t.reverse))}function cF(e,t,n){if(e!==vb&&e!==hb){_r("Only band and point scales support rangeStep.")}var r=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,i=e===hb?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Z_(n,i,r)]}function dF(e,t,n){var r=t.schemeExtent,i,a;if(Rr(t.scheme)){a=Hb(t.scheme,t.interpolate,t.interpolateGamma)}else{i=t.scheme.toLowerCase();a=ex(i);if(!a)_r("Unrecognized scheme name: ".concat(t.scheme))}n=e===cb?n+1:e===pb?n-1:e===lb||e===fb?+t.schemeCount||ZM:n;return Ib(e)?hF(a,r,t.reverse):si(a)?Gb(hF(a,r),n):e===db?a:a.slice(0,n)}function hF(e,t,n){return si(e)&&(t||n)?Wb(e,vF(t||[0,1],n)):e}function vF(e,t){return t?e.slice().reverse():e}function pF(e){ad.call(this,null,e)}Ei(pF,ad,{transform:function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");if(n)t.source.sort(Jf(e.sort));this.modified(n);return t}});var gF="zero",mF="center",yF="normalize",_F=["y0","y1"];function bF(e){ad.call(this,null,e)}bF.Definition={type:"Stack",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:true},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:gF,values:[gF,mF,yF]},{name:"as",type:"string",array:true,length:2,default:_F}]};Ei(bF,ad,{transform:function(e,t){var n=e.as||_F,r=n[0],i=n[1],a=Jf(e.sort),o=e.field||Er,u=e.offset===mF?xF:e.offset===yF?wF:kF,s,l,f,c;s=AF(t.source,e.groupby,a,o);for(l=0,f=s.length,c=s.max;l<f;++l){u(s[l],c,o,r,i)}return t.reflow(e.modified()).modifies(n)}});function xF(e,t,n,r,i){var a=(t-e.sum)/2,o=e.length,u=0,s;for(;u<o;++u){s=e[u];s[r]=a;s[i]=a+=Math.abs(n(s))}}function wF(e,t,n,r,i){var a=1/e.sum,o=0,u=e.length,s=0,l=0,f;for(;s<u;++s){f=e[s];f[r]=o;f[i]=o=a*(l+=Math.abs(n(f)))}}function kF(e,t,n,r,i){var a=0,o=0,u=e.length,s=0,l,f;for(;s<u;++s){f=e[s];l=+n(f);if(l<0){f[r]=o;f[i]=o+=l}else{f[r]=a;f[i]=a+=l}}}function AF(e,t,n,r){var i=[],a=function(e){return e(f)},o,u,s,l,f,c,d,h,v;if(t==null){i.push(e.slice())}else{for(o={},u=0,s=e.length;u<s;++u){f=e[u];c=t.map(a);d=o[c];if(!d){o[c]=d=[];i.push(d)}d.push(f)}}for(c=0,v=0,l=i.length;c<l;++c){d=i[c];for(u=0,h=0,s=d.length;u<s;++u){h+=Math.abs(r(d[u]))}d.sum=h;if(h>v)v=h;if(n)d.sort(n)}i.max=v;return i}var EF=Object.freeze({__proto__:null,axisticks:SM,datajoin:CM,encode:OM,legendentries:NM,linkpath:LM,pie:QM,scale:nF,sortitems:pF,stack:bF});var DF=1e-6;var SF=1e-12;var CF=Math.PI;var MF=CF/2;var FF=CF/4;var OF=CF*2;var NF=180/CF;var TF=CF/180;var zF=Math.abs;var RF=Math.atan;var PF=Math.atan2;var LF=Math.cos;var jF=Math.ceil;var BF=Math.exp;var IF=Math.hypot;var UF=Math.log;var qF=Math.pow;var WF=Math.sin;var HF=Math.sign||function(e){return e>0?1:e<0?-1:0};var GF=Math.sqrt;var $F=Math.tan;function VF(e){return e>1?0:e<-1?CF:Math.acos(e)}function YF(e){return e>1?MF:e<-1?-MF:Math.asin(e)}function XF(){}function JF(e,t){if(e&&ZF.hasOwnProperty(e.type)){ZF[e.type](e,t)}}var QF={Feature:function(e,t){JF(e.geometry,t)},FeatureCollection:function(e,t){var n=e.features,r=-1,i=n.length;while(++r<i)JF(n[r].geometry,t)}};var ZF={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates;t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){KF(e.coordinates,t,0)},MultiLineString:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)KF(n[r],t,0)},Polygon:function(e,t){eO(e.coordinates,t)},MultiPolygon:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)eO(n[r],t)},GeometryCollection:function(e,t){var n=e.geometries,r=-1,i=n.length;while(++r<i)JF(n[r],t)}};function KF(e,t,n){var r=-1,i=e.length-n,a;t.lineStart();while(++r<i)a=e[r],t.point(a[0],a[1],a[2]);t.lineEnd()}function eO(e,t){var n=-1,r=e.length;t.polygonStart();while(++n<r)KF(e[n],t,1);t.polygonEnd()}function tO(e,t){if(e&&QF.hasOwnProperty(e.type)){QF[e.type](e,t)}else{JF(e,t)}}var nO=new io;var rO=new io,iO,aO,oO,uO,sO;var lO={point:XF,lineStart:XF,lineEnd:XF,polygonStart:function(){nO=new io;lO.lineStart=fO;lO.lineEnd=cO},polygonEnd:function(){var e=+nO;rO.add(e<0?OF+e:e);this.lineStart=this.lineEnd=this.point=XF},sphere:function(){rO.add(OF)}};function fO(){lO.point=dO}function cO(){hO(iO,aO)}function dO(e,t){lO.point=hO;iO=e,aO=t;e*=TF,t*=TF;oO=e,uO=LF(t=t/2+FF),sO=WF(t)}function hO(e,t){e*=TF,t*=TF;t=t/2+FF;var n=e-oO,r=n>=0?1:-1,i=r*n,a=LF(t),o=WF(t),u=sO*o,s=uO*a+u*LF(i),l=u*r*WF(i);nO.add(PF(l,s));oO=e,uO=a,sO=o}function vO(e){rO=new io;tO(e,lO);return rO*2}function pO(e){return[PF(e[1],e[0]),YF(e[2])]}function gO(e){var t=e[0],n=e[1],r=LF(n);return[r*LF(t),r*WF(t),WF(n)]}function mO(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function yO(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function _O(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function bO(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function xO(e){var t=GF(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var wO,kO,AO,EO,DO,SO,CO,MO,FO,OO,NO;var TO={point:zO,lineStart:PO,lineEnd:LO,polygonStart:function(){TO.point=jO;TO.lineStart=BO;TO.lineEnd=IO;FO=new io;lO.polygonStart()},polygonEnd:function(){lO.polygonEnd();TO.point=zO;TO.lineStart=PO;TO.lineEnd=LO;if(nO<0)wO=-(AO=180),kO=-(EO=90);else if(FO>DF)EO=90;else if(FO<-DF)kO=-90;NO[0]=wO,NO[1]=AO},sphere:function(){wO=-(AO=180),kO=-(EO=90)}};function zO(e,t){OO.push(NO=[wO=e,AO=e]);if(t<kO)kO=t;if(t>EO)EO=t}function RO(e,t){var n=gO([e*TF,t*TF]);if(MO){var r=yO(MO,n),i=[r[1],-r[0],0],a=yO(i,r);xO(a);a=pO(a);var o=e-DO,u=o>0?1:-1,s=a[0]*NF*u,l,f=zF(o)>180;if(f^(u*DO<s&&s<u*e)){l=a[1]*NF;if(l>EO)EO=l}else if(s=(s+360)%360-180,f^(u*DO<s&&s<u*e)){l=-a[1]*NF;if(l<kO)kO=l}else{if(t<kO)kO=t;if(t>EO)EO=t}if(f){if(e<DO){if(UO(wO,e)>UO(wO,AO))AO=e}else{if(UO(e,AO)>UO(wO,AO))wO=e}}else{if(AO>=wO){if(e<wO)wO=e;if(e>AO)AO=e}else{if(e>DO){if(UO(wO,e)>UO(wO,AO))AO=e}else{if(UO(e,AO)>UO(wO,AO))wO=e}}}}else{OO.push(NO=[wO=e,AO=e])}if(t<kO)kO=t;if(t>EO)EO=t;MO=n,DO=e}function PO(){TO.point=RO}function LO(){NO[0]=wO,NO[1]=AO;TO.point=zO;MO=null}function jO(e,t){if(MO){var n=e-DO;FO.add(zF(n)>180?n+(n>0?360:-360):n)}else{SO=e,CO=t}lO.point(e,t);RO(e,t)}function BO(){lO.lineStart()}function IO(){jO(SO,CO);lO.lineEnd();if(zF(FO)>DF)wO=-(AO=180);NO[0]=wO,NO[1]=AO;MO=null}function UO(e,t){return(t-=e)<0?t+360:t}function qO(e,t){return e[0]-t[0]}function WO(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function HO(e){var t,n,r,i,a,o,u;EO=AO=-(wO=kO=Infinity);OO=[];tO(e,TO);if(n=OO.length){OO.sort(qO);for(t=1,r=OO[0],a=[r];t<n;++t){i=OO[t];if(WO(r,i[0])||WO(r,i[1])){if(UO(r[0],i[1])>UO(r[0],r[1]))r[1]=i[1];if(UO(i[0],r[1])>UO(r[0],r[1]))r[0]=i[0]}else{a.push(r=i)}}for(o=-Infinity,n=a.length-1,t=0,r=a[n];t<=n;r=i,++t){i=a[t];if((u=UO(r[1],i[0]))>o)o=u,wO=i[0],AO=r[1]}}OO=NO=null;return wO===Infinity||kO===Infinity?[[NaN,NaN],[NaN,NaN]]:[[wO,kO],[AO,EO]]}var GO,$O,VO,YO,XO,JO,QO,ZO,KO,eN,tN,nN,rN,iN,aN,oN;var uN={sphere:XF,point:sN,lineStart:fN,lineEnd:hN,polygonStart:function(){uN.lineStart=vN;uN.lineEnd=pN},polygonEnd:function(){uN.lineStart=fN;uN.lineEnd=hN}};function sN(e,t){e*=TF,t*=TF;var n=LF(t);lN(n*LF(e),n*WF(e),WF(t))}function lN(e,t,n){++GO;VO+=(e-VO)/GO;YO+=(t-YO)/GO;XO+=(n-XO)/GO}function fN(){uN.point=cN}function cN(e,t){e*=TF,t*=TF;var n=LF(t);iN=n*LF(e);aN=n*WF(e);oN=WF(t);uN.point=dN;lN(iN,aN,oN)}function dN(e,t){e*=TF,t*=TF;var n=LF(t),r=n*LF(e),i=n*WF(e),a=WF(t),o=PF(GF((o=aN*a-oN*i)*o+(o=oN*r-iN*a)*o+(o=iN*i-aN*r)*o),iN*r+aN*i+oN*a);$O+=o;JO+=o*(iN+(iN=r));QO+=o*(aN+(aN=i));ZO+=o*(oN+(oN=a));lN(iN,aN,oN)}function hN(){uN.point=sN}function vN(){uN.point=gN}function pN(){mN(nN,rN);uN.point=sN}function gN(e,t){nN=e,rN=t;e*=TF,t*=TF;uN.point=mN;var n=LF(t);iN=n*LF(e);aN=n*WF(e);oN=WF(t);lN(iN,aN,oN)}function mN(e,t){e*=TF,t*=TF;var n=LF(t),r=n*LF(e),i=n*WF(e),a=WF(t),o=aN*a-oN*i,u=oN*r-iN*a,s=iN*i-aN*r,l=IF(o,u,s),f=YF(l),c=l&&-f/l;KO.add(c*o);eN.add(c*u);tN.add(c*s);$O+=f;JO+=f*(iN+(iN=r));QO+=f*(aN+(aN=i));ZO+=f*(oN+(oN=a));lN(iN,aN,oN)}function yN(e){GO=$O=VO=YO=XO=JO=QO=ZO=0;KO=new io;eN=new io;tN=new io;tO(e,uN);var t=+KO,n=+eN,r=+tN,i=IF(t,n,r);if(i<SF){t=JO,n=QO,r=ZO;if($O<DF)t=VO,n=YO,r=XO;i=IF(t,n,r);if(i<SF)return[NaN,NaN]}return[PF(n,t)*NF,YF(r/i)*NF]}function _N(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}if(e.invert&&t.invert)n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1])};return n}function bN(e,t){return[zF(e)>CF?e+Math.round(-e/OF)*OF:e,t]}bN.invert=bN;function xN(e,t,n){return(e%=OF)?t||n?_N(kN(e),AN(t,n)):kN(e):t||n?AN(t,n):bN}function wN(e){return function(t,n){return t+=e,[t>CF?t-OF:t<-CF?t+OF:t,n]}}function kN(e){var t=wN(e);t.invert=wN(-e);return t}function AN(e,t){var n=LF(e),r=WF(e),i=LF(t),a=WF(t);function o(e,t){var o=LF(t),u=LF(e)*o,s=WF(e)*o,l=WF(t),f=l*n+u*r;return[PF(s*i-f*a,u*n-l*r),YF(f*i+s*a)]}o.invert=function(e,t){var o=LF(t),u=LF(e)*o,s=WF(e)*o,l=WF(t),f=l*i-s*a;return[PF(s*i+l*a,u*n+f*r),YF(f*n-u*r)]};return o}function EN(e){e=xN(e[0]*TF,e[1]*TF,e.length>2?e[2]*TF:0);function t(t){t=e(t[0]*TF,t[1]*TF);return t[0]*=NF,t[1]*=NF,t}t.invert=function(t){t=e.invert(t[0]*TF,t[1]*TF);return t[0]*=NF,t[1]*=NF,t};return t}function DN(e,t,n,r,i,a){if(!n)return;var o=LF(t),u=WF(t),s=r*n;if(i==null){i=t+r*OF;a=t-s/2}else{i=SN(o,i);a=SN(o,a);if(r>0?i<a:i>a)i+=r*OF}for(var l,f=i;r>0?f>a:f<a;f-=s){l=pO([o,-u*LF(f),-u*WF(f)]);e.point(l[0],l[1])}}function SN(e,t){t=gO(t),t[0]-=e;xO(t);var n=VF(-t[1]);return((-t[2]<0?-n:n)+OF-DF)%OF}function CN(){var e=[],t;return{point:function(e,n,r){t.push([e,n,r])},lineStart:function(){e.push(t=[])},lineEnd:XF,rejoin:function(){if(e.length>1)e.push(e.pop().concat(e.shift()))},result:function(){var n=e;e=[];t=null;return n}}}function MN(e,t){return zF(e[0]-t[0])<DF&&zF(e[1]-t[1])<DF}function FN(e,t,n,r){this.x=e;this.z=t;this.o=n;this.e=r;this.v=false;this.n=this.p=null}function ON(e,t,n,r,i){var a=[],o=[],u,s;e.forEach((function(e){if((t=e.length-1)<=0)return;var t,n=e[0],r=e[t],s;if(MN(n,r)){if(!n[2]&&!r[2]){i.lineStart();for(u=0;u<t;++u)i.point((n=e[u])[0],n[1]);i.lineEnd();return}r[0]+=2*DF}a.push(s=new FN(n,e,null,true));o.push(s.o=new FN(n,null,s,false));a.push(s=new FN(r,e,null,false));o.push(s.o=new FN(r,null,s,true))}));if(!a.length)return;o.sort(t);NN(a);NN(o);for(u=0,s=o.length;u<s;++u){o[u].e=n=!n}var l=a[0],f,c;while(1){var d=l,h=true;while(d.v)if((d=d.n)===l)return;f=d.z;i.lineStart();do{d.v=d.o.v=true;if(d.e){if(h){for(u=0,s=f.length;u<s;++u)i.point((c=f[u])[0],c[1])}else{r(d.x,d.n.x,1,i)}d=d.n}else{if(h){f=d.p.z;for(u=f.length-1;u>=0;--u)i.point((c=f[u])[0],c[1])}else{r(d.x,d.p.x,-1,i)}d=d.p}d=d.o;f=d.z;h=!h}while(!d.v);i.lineEnd()}}function NN(e){if(!(t=e.length))return;var t,n=0,r=e[0],i;while(++n<t){r.n=i=e[n];i.p=r;r=i}r.n=i=e[0];i.p=r}function TN(e){if(zF(e[0])<=CF)return e[0];else return HF(e[0])*((zF(e[0])+CF)%OF-CF)}function zN(e,t){var n=TN(t),r=t[1],i=WF(r),a=[WF(n),-LF(n),0],o=0,u=0;var s=new io;if(i===1)r=MF+DF;else if(i===-1)r=-MF-DF;for(var l=0,f=e.length;l<f;++l){if(!(d=(c=e[l]).length))continue;var c,d,h=c[d-1],v=TN(h),p=h[1]/2+FF,g=WF(p),m=LF(p);for(var y=0;y<d;++y,v=b,g=w,m=k,h=_){var _=c[y],b=TN(_),x=_[1]/2+FF,w=WF(x),k=LF(x),A=b-v,E=A>=0?1:-1,D=E*A,S=D>CF,C=g*w;s.add(PF(C*E*WF(D),m*k+C*LF(D)));o+=S?A+E*OF:A;if(S^v>=n^b>=n){var M=yO(gO(h),gO(_));xO(M);var F=yO(a,M);xO(F);var O=(S^A>=0?-1:1)*YF(F[2]);if(r>O||r===O&&(M[0]||M[1])){u+=S^A>=0?1:-1}}}}return(o<-DF||o<DF&&s<-SF)^u&1}function RN(e,t,n,r){return function(i){var a=t(i),o=CN(),u=t(o),s=false,l,f,c;var d={point:h,lineStart:p,lineEnd:g,polygonStart:function(){d.point=m;d.lineStart=y;d.lineEnd=_;f=[];l=[]},polygonEnd:function(){d.point=h;d.lineStart=p;d.lineEnd=g;f=wo(f);var e=zN(l,r);if(f.length){if(!s)i.polygonStart(),s=true;ON(f,LN,e,n,i)}else if(e){if(!s)i.polygonStart(),s=true;i.lineStart();n(null,null,1,i);i.lineEnd()}if(s)i.polygonEnd(),s=false;f=l=null},sphere:function(){i.polygonStart();i.lineStart();n(null,null,1,i);i.lineEnd();i.polygonEnd()}};function h(t,n){if(e(t,n))i.point(t,n)}function v(e,t){a.point(e,t)}function p(){d.point=v;a.lineStart()}function g(){d.point=h;a.lineEnd()}function m(e,t){c.push([e,t]);u.point(e,t)}function y(){u.lineStart();c=[]}function _(){m(c[0][0],c[0][1]);u.lineEnd();var e=u.clean(),t=o.result(),n,r=t.length,a,d,h;c.pop();l.push(c);c=null;if(!r)return;if(e&1){d=t[0];if((a=d.length-1)>0){if(!s)i.polygonStart(),s=true;i.lineStart();for(n=0;n<a;++n)i.point((h=d[n])[0],h[1]);i.lineEnd()}return}if(r>1&&e&2)t.push(t.pop().concat(t.shift()));f.push(t.filter(PN))}return d}}function PN(e){return e.length>1}function LN(e,t){return((e=e.x)[0]<0?e[1]-MF-DF:MF-e[1])-((t=t.x)[0]<0?t[1]-MF-DF:MF-t[1])}var jN=RN((function(){return true}),BN,UN,[-CF,-MF]);function BN(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart();i=1},point:function(a,o){var u=a>0?CF:-CF,s=zF(a-t);if(zF(s-CF)<DF){e.point(t,n=(n+o)/2>0?MF:-MF);e.point(r,n);e.lineEnd();e.lineStart();e.point(u,n);e.point(a,n);i=0}else if(r!==u&&s>=CF){if(zF(t-r)<DF)t-=r*DF;if(zF(a-u)<DF)a-=u*DF;n=IN(t,n,a,o);e.point(r,n);e.lineEnd();e.lineStart();e.point(u,n);i=0}e.point(t=a,n=o);r=u},lineEnd:function(){e.lineEnd();t=n=NaN},clean:function(){return 2-i}}}function IN(e,t,n,r){var i,a,o=WF(e-n);return zF(o)>DF?RF((WF(t)*(a=LF(r))*WF(n)-WF(r)*(i=LF(t))*WF(e))/(i*a*o)):(t+r)/2}function UN(e,t,n,r){var i;if(e==null){i=n*MF;r.point(-CF,i);r.point(0,i);r.point(CF,i);r.point(CF,0);r.point(CF,-i);r.point(0,-i);r.point(-CF,-i);r.point(-CF,0);r.point(-CF,i)}else if(zF(e[0]-t[0])>DF){var a=e[0]<t[0]?CF:-CF;i=n*a/2;r.point(-a,i);r.point(0,i);r.point(a,i)}else{r.point(t[0],t[1])}}function qN(e){var t=LF(e),n=6*TF,r=t>0,i=zF(t)>DF;function a(t,r,i,a){DN(a,e,n,i,t,r)}function o(e,n){return LF(e)*LF(n)>t}function u(e){var t,n,a,u,f;return{lineStart:function(){u=a=false;f=1},point:function(c,d){var h=[c,d],v,p=o(c,d),g=r?p?0:l(c,d):p?l(c+(c<0?CF:-CF),d):0;if(!t&&(u=a=p))e.lineStart();if(p!==a){v=s(t,h);if(!v||MN(t,v)||MN(h,v))h[2]=1}if(p!==a){f=0;if(p){e.lineStart();v=s(h,t);e.point(v[0],v[1])}else{v=s(t,h);e.point(v[0],v[1],2);e.lineEnd()}t=v}else if(i&&t&&r^p){var m;if(!(g&n)&&(m=s(h,t,true))){f=0;if(r){e.lineStart();e.point(m[0][0],m[0][1]);e.point(m[1][0],m[1][1]);e.lineEnd()}else{e.point(m[1][0],m[1][1]);e.lineEnd();e.lineStart();e.point(m[0][0],m[0][1],3)}}}if(p&&(!t||!MN(t,h))){e.point(h[0],h[1])}t=h,a=p,n=g},lineEnd:function(){if(a)e.lineEnd();t=null},clean:function(){return f|(u&&a)<<1}}}function s(e,n,r){var i=gO(e),a=gO(n);var o=[1,0,0],u=yO(i,a),s=mO(u,u),l=u[0],f=s-l*l;if(!f)return!r&&e;var c=t*s/f,d=-t*l/f,h=yO(o,u),v=bO(o,c),p=bO(u,d);_O(v,p);var g=h,m=mO(v,g),y=mO(g,g),_=m*m-y*(mO(v,v)-1);if(_<0)return;var b=GF(_),x=bO(g,(-m-b)/y);_O(x,v);x=pO(x);if(!r)return x;var w=e[0],k=n[0],A=e[1],E=n[1],D;if(k<w)D=w,w=k,k=D;var S=k-w,C=zF(S-CF)<DF,M=C||S<DF;if(!C&&E<A)D=A,A=E,E=D;if(M?C?A+E>0^x[1]<(zF(x[0]-w)<DF?A:E):A<=x[1]&&x[1]<=E:S>CF^(w<=x[0]&&x[0]<=k)){var F=bO(g,(-m+b)/y);_O(F,v);return[x,pO(F)]}}function l(t,n){var i=r?e:CF-e,a=0;if(t<-i)a|=1;else if(t>i)a|=2;if(n<-i)a|=4;else if(n>i)a|=8;return a}return RN(o,u,a,r?[0,-e]:[-CF,e-CF])}function WN(e,t,n,r,i,a){var o=e[0],u=e[1],s=t[0],l=t[1],f=0,c=1,d=s-o,h=l-u,v;v=n-o;if(!d&&v>0)return;v/=d;if(d<0){if(v<f)return;if(v<c)c=v}else if(d>0){if(v>c)return;if(v>f)f=v}v=i-o;if(!d&&v<0)return;v/=d;if(d<0){if(v>c)return;if(v>f)f=v}else if(d>0){if(v<f)return;if(v<c)c=v}v=r-u;if(!h&&v>0)return;v/=h;if(h<0){if(v<f)return;if(v<c)c=v}else if(h>0){if(v>c)return;if(v>f)f=v}v=a-u;if(!h&&v<0)return;v/=h;if(h<0){if(v>c)return;if(v>f)f=v}else if(h>0){if(v<f)return;if(v<c)c=v}if(f>0)e[0]=o+f*d,e[1]=u+f*h;if(c<1)t[0]=o+c*d,t[1]=u+c*h;return true}var HN=1e9,GN=-HN;function $N(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,u,l){var f=0,c=0;if(i==null||(f=o(i,u))!==(c=o(a,u))||s(i,a)<0^u>0){do{l.point(f===0||f===3?e:n,f>1?r:t)}while((f=(f+u+4)%4)!==c)}else{l.point(a[0],a[1])}}function o(r,i){return zF(r[0]-e)<DF?i>0?0:3:zF(r[0]-n)<DF?i>0?2:1:zF(r[1]-t)<DF?i>0?1:0:i>0?3:2}function u(e,t){return s(e.x,t.x)}function s(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:n===0?t[1]-e[1]:n===1?e[0]-t[0]:n===2?e[1]-t[1]:t[0]-e[0]}return function(o){var s=o,l=CN(),f,c,d,h,v,p,g,m,y,_,b;var x={point:w,lineStart:D,lineEnd:S,polygonStart:A,polygonEnd:E};function w(e,t){if(i(e,t))s.point(e,t)}function k(){var t=0;for(var n=0,i=c.length;n<i;++n){for(var a=c[n],o=1,u=a.length,s=a[0],l,f,d=s[0],h=s[1];o<u;++o){l=d,f=h,s=a[o],d=s[0],h=s[1];if(f<=r){if(h>r&&(d-l)*(r-f)>(h-f)*(e-l))++t}else{if(h<=r&&(d-l)*(r-f)<(h-f)*(e-l))--t}}}return t}function A(){s=l,f=[],c=[],b=true}function E(){var e=k(),t=b&&e,n=(f=wo(f)).length;if(t||n){o.polygonStart();if(t){o.lineStart();a(null,null,1,o);o.lineEnd()}if(n){ON(f,u,e,a,o)}o.polygonEnd()}s=o,f=c=d=null}function D(){x.point=C;if(c)c.push(d=[]);_=true;y=false;g=m=NaN}function S(){if(f){C(h,v);if(p&&y)l.rejoin();f.push(l.result())}x.point=w;if(y)s.lineEnd()}function C(a,o){var u=i(a,o);if(c)d.push([a,o]);if(_){h=a,v=o,p=u;_=false;if(u){s.lineStart();s.point(a,o)}}else{if(u&&y)s.point(a,o);else{var l=[g=Math.max(GN,Math.min(HN,g)),m=Math.max(GN,Math.min(HN,m))],f=[a=Math.max(GN,Math.min(HN,a)),o=Math.max(GN,Math.min(HN,o))];if(WN(l,f,e,t,n,r)){if(!y){s.lineStart();s.point(l[0],l[1])}s.point(f[0],f[1]);if(!u)s.lineEnd();b=false}else if(u){s.lineStart();s.point(a,o);b=false}}}g=a,m=o,y=u}return x}}function VN(e,t,n){var r=ko(e,t-DF,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function YN(e,t,n){var r=ko(e,t-DF,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}function XN(){var e,t,n,r,i,a,o,u,s=10,l=s,f=90,c=360,d,h,v,p,g=2.5;function m(){return{type:"MultiLineString",coordinates:y()}}function y(){return ko(jF(r/f)*f,n,f).map(v).concat(ko(jF(u/c)*c,o,c).map(p)).concat(ko(jF(t/s)*s,e,s).filter((function(e){return zF(e%f)>DF})).map(d)).concat(ko(jF(a/l)*l,i,l).filter((function(e){return zF(e%c)>DF})).map(h))}m.lines=function(){return y().map((function(e){return{type:"LineString",coordinates:e}}))};m.outline=function(){return{type:"Polygon",coordinates:[v(r).concat(p(o).slice(1),v(n).reverse().slice(1),p(u).reverse().slice(1))]}};m.extent=function(e){if(!arguments.length)return m.extentMinor();return m.extentMajor(e).extentMinor(e)};m.extentMajor=function(e){if(!arguments.length)return[[r,u],[n,o]];r=+e[0][0],n=+e[1][0];u=+e[0][1],o=+e[1][1];if(r>n)e=r,r=n,n=e;if(u>o)e=u,u=o,o=e;return m.precision(g)};m.extentMinor=function(n){if(!arguments.length)return[[t,a],[e,i]];t=+n[0][0],e=+n[1][0];a=+n[0][1],i=+n[1][1];if(t>e)n=t,t=e,e=n;if(a>i)n=a,a=i,i=n;return m.precision(g)};m.step=function(e){if(!arguments.length)return m.stepMinor();return m.stepMajor(e).stepMinor(e)};m.stepMajor=function(e){if(!arguments.length)return[f,c];f=+e[0],c=+e[1];return m};m.stepMinor=function(e){if(!arguments.length)return[s,l];s=+e[0],l=+e[1];return m};m.precision=function(s){if(!arguments.length)return g;g=+s;d=VN(a,i,90);h=YN(t,e,g);v=VN(u,o,90);p=YN(r,n,g);return m};return m.extentMajor([[-180,-90+DF],[180,90-DF]]).extentMinor([[-180,-80-DF],[180,80+DF]])}var JN=function(e){return e};var QN=new io,ZN=new io,KN,eT,tT,nT;var rT={point:XF,lineStart:XF,lineEnd:XF,polygonStart:function(){rT.lineStart=iT;rT.lineEnd=uT},polygonEnd:function(){rT.lineStart=rT.lineEnd=rT.point=XF;QN.add(zF(ZN));ZN=new io},result:function(){var e=QN/2;QN=new io;return e}};function iT(){rT.point=aT}function aT(e,t){rT.point=oT;KN=tT=e,eT=nT=t}function oT(e,t){ZN.add(nT*e-tT*t);tT=e,nT=t}function uT(){oT(KN,eT)}var sT=Infinity,lT=sT,fT=-sT,cT=fT;var dT={point:hT,lineStart:XF,lineEnd:XF,polygonStart:XF,polygonEnd:XF,result:function(){var e=[[sT,lT],[fT,cT]];fT=cT=-(lT=sT=Infinity);return e}};function hT(e,t){if(e<sT)sT=e;if(e>fT)fT=e;if(t<lT)lT=t;if(t>cT)cT=t}var vT=0,pT=0,gT=0,mT=0,yT=0,_T=0,bT=0,xT=0,wT=0,kT,AT,ET,DT;var ST={point:CT,lineStart:MT,lineEnd:NT,polygonStart:function(){ST.lineStart=TT;ST.lineEnd=zT},polygonEnd:function(){ST.point=CT;ST.lineStart=MT;ST.lineEnd=NT},result:function(){var e=wT?[bT/wT,xT/wT]:_T?[mT/_T,yT/_T]:gT?[vT/gT,pT/gT]:[NaN,NaN];vT=pT=gT=mT=yT=_T=bT=xT=wT=0;return e}};function CT(e,t){vT+=e;pT+=t;++gT}function MT(){ST.point=FT}function FT(e,t){ST.point=OT;CT(ET=e,DT=t)}function OT(e,t){var n=e-ET,r=t-DT,i=GF(n*n+r*r);mT+=i*(ET+e)/2;yT+=i*(DT+t)/2;_T+=i;CT(ET=e,DT=t)}function NT(){ST.point=CT}function TT(){ST.point=RT}function zT(){PT(kT,AT)}function RT(e,t){ST.point=PT;CT(kT=ET=e,AT=DT=t)}function PT(e,t){var n=e-ET,r=t-DT,i=GF(n*n+r*r);mT+=i*(ET+e)/2;yT+=i*(DT+t)/2;_T+=i;i=DT*e-ET*t;bT+=i*(ET+e);xT+=i*(DT+t);wT+=i*3;CT(ET=e,DT=t)}function LT(e){this._context=e}LT.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._context.closePath();this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t);this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t);this._context.arc(e,t,this._radius,0,OF);break}}},result:XF};var jT=new io,BT,IT,UT,qT,WT;var HT={point:XF,lineStart:function(){HT.point=GT},lineEnd:function(){if(BT)$T(IT,UT);HT.point=XF},polygonStart:function(){BT=true},polygonEnd:function(){BT=null},result:function(){var e=+jT;jT=new io;return e}};function GT(e,t){HT.point=$T;IT=qT=e,UT=WT=t}function $T(e,t){qT-=e,WT-=t;jT.add(GF(qT*qT+WT*WT));qT=e,WT=t}function VT(){this._string=[]}VT.prototype={_radius:4.5,_circle:YT(4.5),pointRadius:function(e){if((e=+e)!==this._radius)this._radius=e,this._circle=null;return this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._string.push("Z");this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t);this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{if(this._circle==null)this._circle=YT(this._radius);this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");this._string=[];return e}else{return null}}};function YT(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function XT(e,t){var n=4.5,r,i;function a(e){if(e){if(typeof n==="function")i.pointRadius(+n.apply(this,arguments));tO(e,r(i))}return i.result()}a.area=function(e){tO(e,r(rT));return rT.result()};a.measure=function(e){tO(e,r(HT));return HT.result()};a.bounds=function(e){tO(e,r(dT));return dT.result()};a.centroid=function(e){tO(e,r(ST));return ST.result()};a.projection=function(t){return arguments.length?(r=t==null?(e=null,JN):(e=t).stream,a):e};a.context=function(e){if(!arguments.length)return t;i=e==null?(t=null,new VT):new LT(t=e);if(typeof n!=="function")i.pointRadius(n);return a};a.pointRadius=function(e){if(!arguments.length)return n;n=typeof e==="function"?e:(i.pointRadius(+e),+e);return a};return a.projection(e).context(t)}function JT(e){return function(t){var n=new QT;for(var r in e)n[r]=e[r];n.stream=t;return n}}function QT(){}QT.prototype={constructor:QT,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function ZT(e,t,n){var r=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]);if(r!=null)e.clipExtent(null);tO(n,e.stream(dT));t(dT.result());if(r!=null)e.clipExtent(r);return e}function KT(e,t,n){return ZT(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,u=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,u])}),n)}function ez(e,t,n){return KT(e,[[0,0],t],n)}function tz(e,t,n){return ZT(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function nz(e,t,n){return ZT(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}var rz=16,iz=LF(30*TF);function az(e,t){return+t?uz(e,t):oz(e)}function oz(e){return JT({point:function(t,n){t=e(t,n);this.stream.point(t[0],t[1])}})}function uz(e,t){function n(r,i,a,o,u,s,l,f,c,d,h,v,p,g){var m=l-r,y=f-i,_=m*m+y*y;if(_>4*t&&p--){var b=o+d,x=u+h,w=s+v,k=GF(b*b+x*x+w*w),A=YF(w/=k),E=zF(zF(w)-1)<DF||zF(a-c)<DF?(a+c)/2:PF(x,b),D=e(E,A),S=D[0],C=D[1],M=S-r,F=C-i,O=y*M-m*F;if(O*O/_>t||zF((m*M+y*F)/_-.5)>.3||o*d+u*h+s*v<iz){n(r,i,a,o,u,s,S,C,E,b/=k,x/=k,w,p,g);g.point(S,C);n(S,C,E,b,x,w,l,f,c,d,h,v,p,g)}}}return function(t){var r,i,a,o,u,s,l,f,c,d,h,v;var p={point:g,lineStart:m,lineEnd:_,polygonStart:function(){t.polygonStart();p.lineStart=b},polygonEnd:function(){t.polygonEnd();p.lineStart=m}};function g(n,r){n=e(n,r);t.point(n[0],n[1])}function m(){f=NaN;p.point=y;t.lineStart()}function y(r,i){var a=gO([r,i]),o=e(r,i);n(f,c,l,d,h,v,f=o[0],c=o[1],l=r,d=a[0],h=a[1],v=a[2],rz,t);t.point(f,c)}function _(){p.point=g;t.lineEnd()}function b(){m();p.point=x;p.lineEnd=w}function x(e,t){y(r=e,t),i=f,a=c,o=d,u=h,s=v;p.point=y}function w(){n(f,c,l,d,h,v,i,a,r,o,u,s,rz,t);p.lineEnd=_;_()}return p}}var sz=JT({point:function(e,t){this.stream.point(e*TF,t*TF)}});function lz(e){return JT({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function fz(e,t,n,r,i){function a(a,o){a*=r;o*=i;return[t+e*a,n-e*o]}a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]};return a}function cz(e,t,n,r,i,a){if(!a)return fz(e,t,n,r,i);var o=LF(a),u=WF(a),s=o*e,l=u*e,f=o/e,c=u/e,d=(u*n-o*t)/e,h=(u*t+o*n)/e;function v(e,a){e*=r;a*=i;return[s*e-l*a+t,n-l*e-s*a]}v.invert=function(e,t){return[r*(f*e-c*t+d),i*(h-c*e-f*t)]};return v}function dz(e){return hz((function(){return e}))()}function hz(e){var t,n=150,r=480,i=250,a=0,o=0,u=0,s=0,l=0,f,c=0,d=1,h=1,v=null,p=jN,g=null,m,y,_,b=JN,x=.5,w,k,A,E,D;function S(e){return A(e[0]*TF,e[1]*TF)}function C(e){e=A.invert(e[0],e[1]);return e&&[e[0]*NF,e[1]*NF]}S.stream=function(e){return E&&D===e?E:E=sz(lz(f)(p(w(b(D=e)))))};S.preclip=function(e){return arguments.length?(p=e,v=undefined,F()):p};S.postclip=function(e){return arguments.length?(b=e,g=m=y=_=null,F()):b};S.clipAngle=function(e){return arguments.length?(p=+e?qN(v=e*TF):(v=null,jN),F()):v*NF};S.clipExtent=function(e){return arguments.length?(b=e==null?(g=m=y=_=null,JN):$N(g=+e[0][0],m=+e[0][1],y=+e[1][0],_=+e[1][1]),F()):g==null?null:[[g,m],[y,_]]};S.scale=function(e){return arguments.length?(n=+e,M()):n};S.translate=function(e){return arguments.length?(r=+e[0],i=+e[1],M()):[r,i]};S.center=function(e){return arguments.length?(a=e[0]%360*TF,o=e[1]%360*TF,M()):[a*NF,o*NF]};S.rotate=function(e){return arguments.length?(u=e[0]%360*TF,s=e[1]%360*TF,l=e.length>2?e[2]%360*TF:0,M()):[u*NF,s*NF,l*NF]};S.angle=function(e){return arguments.length?(c=e%360*TF,M()):c*NF};S.reflectX=function(e){return arguments.length?(d=e?-1:1,M()):d<0};S.reflectY=function(e){return arguments.length?(h=e?-1:1,M()):h<0};S.precision=function(e){return arguments.length?(w=az(k,x=e*e),F()):GF(x)};S.fitExtent=function(e,t){return KT(S,e,t)};S.fitSize=function(e,t){return ez(S,e,t)};S.fitWidth=function(e,t){return tz(S,e,t)};S.fitHeight=function(e,t){return nz(S,e,t)};function M(){var e=cz(n,0,0,d,h,c).apply(null,t(a,o)),v=cz(n,r-e[0],i-e[1],d,h,c);f=xN(u,s,l);k=_N(t,v);A=_N(f,k);w=az(k,x);return F()}function F(){E=D=null;return S}return function(){t=e.apply(this,arguments);S.invert=t.invert&&C;return M()}}function vz(e){var t=0,n=CF/3,r=hz(e),i=r(t,n);i.parallels=function(e){return arguments.length?r(t=e[0]*TF,n=e[1]*TF):[t*NF,n*NF]};return i}function pz(e){var t=LF(e);function n(e,n){return[e*t,WF(n)/t]}n.invert=function(e,n){return[e/t,YF(n*t)]};return n}function gz(e,t){var n=WF(e),r=(n+WF(t))/2;if(zF(r)<DF)return pz(e);var i=1+n*(2*r-n),a=GF(i)/r;function o(e,t){var n=GF(i-2*r*WF(t))/r;return[n*WF(e*=r),a-n*LF(e)]}o.invert=function(e,t){var n=a-t,o=PF(e,zF(n))*HF(n);if(n*r<0)o-=CF*HF(e)*HF(n);return[o/r,YF((i-(e*e+n*n)*r*r)/(2*r))]};return o}function mz(){return vz(gz).scale(155.424).center([0,33.6442])}function yz(){return mz().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function _z(e){var t=e.length;return{point:function(n,r){var i=-1;while(++i<t)e[i].point(n,r)},sphere:function(){var n=-1;while(++n<t)e[n].sphere()},lineStart:function(){var n=-1;while(++n<t)e[n].lineStart()},lineEnd:function(){var n=-1;while(++n<t)e[n].lineEnd()},polygonStart:function(){var n=-1;while(++n<t)e[n].polygonStart()},polygonEnd:function(){var n=-1;while(++n<t)e[n].polygonEnd()}}}function bz(){var e,t,n=yz(),r,i=mz().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a,o=mz().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u,s,l={point:function(e,t){s=[e,t]}};function f(e){var t=e[0],n=e[1];return s=null,(r.point(t,n),s)||(a.point(t,n),s)||(u.point(t,n),s)}f.invert=function(e){var t=n.scale(),r=n.translate(),a=(e[0]-r[0])/t,u=(e[1]-r[1])/t;return(u>=.12&&u<.234&&a>=-.425&&a<-.214?i:u>=.166&&u<.234&&a>=-.214&&a<-.115?o:n).invert(e)};f.stream=function(r){return e&&t===r?e:e=_z([n.stream(t=r),i.stream(r),o.stream(r)])};f.precision=function(e){if(!arguments.length)return n.precision();n.precision(e),i.precision(e),o.precision(e);return c()};f.scale=function(e){if(!arguments.length)return n.scale();n.scale(e),i.scale(e*.35),o.scale(e);return f.translate(n.translate())};f.translate=function(e){if(!arguments.length)return n.translate();var t=n.scale(),s=+e[0],f=+e[1];r=n.translate(e).clipExtent([[s-.455*t,f-.238*t],[s+.455*t,f+.238*t]]).stream(l);a=i.translate([s-.307*t,f+.201*t]).clipExtent([[s-.425*t+DF,f+.12*t+DF],[s-.214*t-DF,f+.234*t-DF]]).stream(l);u=o.translate([s-.205*t,f+.212*t]).clipExtent([[s-.214*t+DF,f+.166*t+DF],[s-.115*t-DF,f+.234*t-DF]]).stream(l);return c()};f.fitExtent=function(e,t){return KT(f,e,t)};f.fitSize=function(e,t){return ez(f,e,t)};f.fitWidth=function(e,t){return tz(f,e,t)};f.fitHeight=function(e,t){return nz(f,e,t)};function c(){e=t=null;return f}return f.scale(1070)}function xz(e){return function(t,n){var r=LF(t),i=LF(n),a=e(r*i);if(a===Infinity)return[2,0];return[a*i*WF(t),a*WF(n)]}}function wz(e){return function(t,n){var r=GF(t*t+n*n),i=e(r),a=WF(i),o=LF(i);return[PF(t*a,r*o),YF(r&&n*a/r)]}}var kz=xz((function(e){return GF(2/(1+e))}));kz.invert=wz((function(e){return 2*YF(e/2)}));function Az(){return dz(kz).scale(124.75).clipAngle(180-.001)}var Ez=xz((function(e){return(e=VF(e))&&e/WF(e)}));Ez.invert=wz((function(e){return e}));function Dz(){return dz(Ez).scale(79.4188).clipAngle(180-.001)}function Sz(e,t){return[e,UF($F((MF+t)/2))]}Sz.invert=function(e,t){return[e,2*RF(BF(t))-MF]};function Cz(){return Mz(Sz).scale(961/OF)}function Mz(e){var t=dz(e),n=t.center,r=t.scale,i=t.translate,a=t.clipExtent,o=null,u,s,l;t.scale=function(e){return arguments.length?(r(e),f()):r()};t.translate=function(e){return arguments.length?(i(e),f()):i()};t.center=function(e){return arguments.length?(n(e),f()):n()};t.clipExtent=function(e){return arguments.length?(e==null?o=u=s=l=null:(o=+e[0][0],u=+e[0][1],s=+e[1][0],l=+e[1][1]),f()):o==null?null:[[o,u],[s,l]]};function f(){var n=CF*r(),i=t(EN(t.rotate()).invert([0,0]));return a(o==null?[[i[0]-n,i[1]-n],[i[0]+n,i[1]+n]]:e===Sz?[[Math.max(i[0]-n,o),u],[Math.min(i[0]+n,s),l]]:[[o,Math.max(i[1]-n,u)],[s,Math.min(i[1]+n,l)]])}return f()}function Fz(e){return $F((MF+e)/2)}function Oz(e,t){var n=LF(e),r=e===t?WF(e):UF(n/LF(t))/UF(Fz(t)/Fz(e)),i=n*qF(Fz(e),r)/r;if(!r)return Sz;function a(e,t){if(i>0){if(t<-MF+DF)t=-MF+DF}else{if(t>MF-DF)t=MF-DF}var n=i/qF(Fz(t),r);return[n*WF(r*e),i-n*LF(r*e)]}a.invert=function(e,t){var n=i-t,a=HF(r)*GF(e*e+n*n),o=PF(e,zF(n))*HF(n);if(n*r<0)o-=CF*HF(e)*HF(n);return[o/r,2*RF(qF(i/a,1/r))-MF]};return a}function Nz(){return vz(Oz).scale(109.5).parallels([30,30])}function Tz(e,t){return[e,t]}Tz.invert=Tz;function zz(){return dz(Tz).scale(152.63)}function Rz(e,t){var n=LF(e),r=e===t?WF(e):(n-LF(t))/(t-e),i=n/r+e;if(zF(r)<DF)return Tz;function a(e,t){var n=i-t,a=r*e;return[n*WF(a),i-n*LF(a)]}a.invert=function(e,t){var n=i-t,a=PF(e,zF(n))*HF(n);if(n*r<0)a-=CF*HF(e)*HF(n);return[a/r,i-HF(r)*GF(e*e+n*n)]};return a}function Pz(){return vz(Rz).scale(131.154).center([0,13.9389])}var Lz=1.340264,jz=-.081106,Bz=893e-6,Iz=.003796,Uz=GF(3)/2,qz=12;function Wz(e,t){var n=YF(Uz*WF(t)),r=n*n,i=r*r*r;return[e*LF(n)/(Uz*(Lz+3*jz*r+i*(7*Bz+9*Iz*r))),n*(Lz+jz*r+i*(Bz+Iz*r))]}Wz.invert=function(e,t){var n=t,r=n*n,i=r*r*r;for(var a=0,o,u,s;a<qz;++a){u=n*(Lz+jz*r+i*(Bz+Iz*r))-t;s=Lz+3*jz*r+i*(7*Bz+9*Iz*r);n-=o=u/s,r=n*n,i=r*r*r;if(zF(o)<SF)break}return[Uz*e*(Lz+3*jz*r+i*(7*Bz+9*Iz*r))/LF(n),YF(WF(n)/Uz)]};function Hz(){return dz(Wz).scale(177.158)}function Gz(e,t){var n=LF(t),r=LF(e)*n;return[n*WF(e)/r,WF(t)/r]}Gz.invert=wz(RF);function $z(){return dz(Gz).scale(144.049).clipAngle(60)}function Vz(){var e=1,t=0,n=0,r=1,i=1,a=0,o,u,s=null,l,f,c,d=1,h=1,v=JT({point:function(e,t){var n=_([e,t]);this.stream.point(n[0],n[1])}}),p=JN,g,m;function y(){d=e*r;h=e*i;g=m=null;return _}function _(e){var r=e[0]*d,i=e[1]*h;if(a){var s=i*o-r*u;r=r*o+i*u;i=s}return[r+t,i+n]}_.invert=function(e){var r=e[0]-t,i=e[1]-n;if(a){var s=i*o+r*u;r=r*o-i*u;i=s}return[r/d,i/h]};_.stream=function(e){return g&&m===e?g:g=v(p(m=e))};_.postclip=function(e){return arguments.length?(p=e,s=l=f=c=null,y()):p};_.clipExtent=function(e){return arguments.length?(p=e==null?(s=l=f=c=null,JN):$N(s=+e[0][0],l=+e[0][1],f=+e[1][0],c=+e[1][1]),y()):s==null?null:[[s,l],[f,c]]};_.scale=function(t){return arguments.length?(e=+t,y()):e};_.translate=function(e){return arguments.length?(t=+e[0],n=+e[1],y()):[t,n]};_.angle=function(e){return arguments.length?(a=e%360*TF,u=WF(a),o=LF(a),y()):a*NF};_.reflectX=function(e){return arguments.length?(r=e?-1:1,y()):r<0};_.reflectY=function(e){return arguments.length?(i=e?-1:1,y()):i<0};_.fitExtent=function(e,t){return KT(_,e,t)};_.fitSize=function(e,t){return ez(_,e,t)};_.fitWidth=function(e,t){return tz(_,e,t)};_.fitHeight=function(e,t){return nz(_,e,t)};return _}function Yz(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(-.013791+r*(.003971*n-.001529*r))),t*(1.007226+n*(.015085+r*(-.044475+.028874*n-.005916*r)))]}Yz.invert=function(e,t){var n=t,r=25,i;do{var a=n*n,o=a*a;n-=i=(n*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-t)/(1.007226+a*(.015085*3+o*(-.044475*7+.028874*9*a-.005916*11*o)))}while(zF(i)>DF&&--r>0);return[e/(.8707+(a=n*n)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),n]};function Xz(){return dz(Yz).scale(175.295)}function Jz(e,t){return[LF(t)*WF(e),WF(t)]}Jz.invert=wz(YF);function Qz(){return dz(Jz).scale(249.5).clipAngle(90+DF)}function Zz(e,t){var n=LF(t),r=1+LF(e)*n;return[n*WF(e)/r,WF(t)/r]}Zz.invert=wz((function(e){return 2*RF(e)}));function Kz(){return dz(Zz).scale(250).clipAngle(142)}function eR(e,t){return[UF($F((MF+t)/2)),-e]}eR.invert=function(e,t){return[-t,2*RF(BF(e))-MF]};function tR(){var e=Mz(eR),t=e.center,n=e.rotate;e.center=function(e){return arguments.length?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]])};e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])};return n([0,0,90]).scale(159.155)}var nR=Math.abs;var rR=Math.cos;var iR=Math.sin;var aR=1e-6;var oR=Math.PI;var uR=oR/2;var sR=fR(2);function lR(e){return e>1?uR:e<-1?-uR:Math.asin(e)}function fR(e){return e>0?Math.sqrt(e):0}function cR(e,t){var n=e*iR(t),r=30,i;do{t-=i=(t+iR(t)-n)/(1+rR(t))}while(nR(i)>aR&&--r>0);return t/2}function dR(e,t,n){function r(r,i){return[e*r*rR(i=cR(n,i)),t*iR(i)]}r.invert=function(r,i){return i=lR(i/t),[r/(e*rR(i)),lR((2*i+iR(2*i))/n)]};return r}var hR=dR(sR/uR,sR,oR);function vR(){return dz(hR).scale(169.529)}var pR=XT();var gR=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function mR(e,t){return function n(){var r=t();r.type=e;r.path=XT().projection(r);r.copy=r.copy||function(){var e=n();gR.forEach((function(t){if(r[t])e[t](r[t]())}));e.path.pointRadius(r.path.pointRadius());return e};return r}}function yR(e,t){if(!e||typeof e!=="string"){throw new Error("Projection type must be a name string.")}e=e.toLowerCase();if(arguments.length>1){bR[e]=mR(e,t);return this}else{return bR[e]||null}}function _R(e){return e&&e.path||pR}var bR={albers:yz,albersusa:bz,azimuthalequalarea:Az,azimuthalequidistant:Dz,conicconformal:Nz,conicequalarea:mz,conicequidistant:Pz,equalEarth:Hz,equirectangular:zz,gnomonic:$z,identity:Vz,mercator:Cz,mollweide:vR,naturalEarth1:Xz,orthographic:Qz,stereographic:Kz,transversemercator:tR};for(var xR in bR){yR(xR,bR[xR])}function wR(){}var kR=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function AR(){var e=1,t=1,n=u;function r(e,t){return t.map((function(t){return i(e,t)}))}function i(e,t){var r=[],i=[];a(e,t,(function(a){n(a,e,t);if(ER(a)>0)r.push([a]);else i.push(a)}));i.forEach((function(e){for(var t=0,n=r.length,i;t<n;++t){if(DR((i=r[t])[0],e)!==-1){i.push(e);return}}}));return{type:"MultiPolygon",value:t,coordinates:r}}function a(n,r,i){var a=new Array,u=new Array,s,l,f,c,d,h;s=l=-1;c=n[0]>=r;kR[c<<1].forEach(v);while(++s<e-1){f=c,c=n[s+1]>=r;kR[f|c<<1].forEach(v)}kR[c<<0].forEach(v);while(++l<t-1){s=-1;c=n[l*e+e]>=r;d=n[l*e]>=r;kR[c<<1|d<<2].forEach(v);while(++s<e-1){f=c,c=n[l*e+e+s+1]>=r;h=d,d=n[l*e+s+1]>=r;kR[f|c<<1|d<<2|h<<3].forEach(v)}kR[c|d<<3].forEach(v)}s=-1;d=n[l*e]>=r;kR[d<<2].forEach(v);while(++s<e-1){h=d,d=n[l*e+s+1]>=r;kR[d<<2|h<<3].forEach(v)}kR[d<<3].forEach(v);function v(e){var t=[e[0][0]+s,e[0][1]+l],n=[e[1][0]+s,e[1][1]+l],r=o(t),f=o(n),c,d;if(c=u[r]){if(d=a[f]){delete u[c.end];delete a[d.start];if(c===d){c.ring.push(n);i(c.ring)}else{a[c.start]=u[d.end]={start:c.start,end:d.end,ring:c.ring.concat(d.ring)}}}else{delete u[c.end];c.ring.push(n);u[c.end=f]=c}}else if(c=a[f]){if(d=u[r]){delete a[c.start];delete u[d.end];if(c===d){c.ring.push(n);i(c.ring)}else{a[d.start]=u[c.end]={start:d.start,end:c.end,ring:d.ring.concat(c.ring)}}}else{delete a[c.start];c.ring.unshift(t);a[c.start=r]=c}}else{a[r]=u[f]={start:r,end:f,ring:[t,n]}}}}function o(t){return t[0]*2+t[1]*(e+1)*4}function u(n,r,i){n.forEach((function(n){var a=n[0],o=n[1],u=a|0,s=o|0,l,f=r[s*e+u];if(a>0&&a<e&&u===a){l=r[s*e+u-1];n[0]=a+(i-l)/(f-l)-.5}if(o>0&&o<t&&s===o){l=r[(s-1)*e+u];n[1]=o+(i-l)/(f-l)-.5}}))}r.contour=i;r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);if(!(i>=0&&a>=0))_r("invalid size");return e=i,t=a,r};r.smooth=function(e){return arguments.length?(n=e?u:wR,r):n===u};return r}function ER(e){var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];while(++t<n)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}function DR(e,t){var n=-1,r=t.length,i;while(++n<r)if(i=SR(e,t[n]))return i;return 0}function SR(e,t){var n=t[0],r=t[1],i=-1;for(var a=0,o=e.length,u=o-1;a<o;u=a++){var s=e[a],l=s[0],f=s[1],c=e[u],d=c[0],h=c[1];if(CR(s,c,t))return 0;if(f>r!==h>r&&n<(d-l)*(r-f)/(h-f)+l)i=-i}return i}function CR(e,t,n){var r;return MR(e,t,n)&&FR(e[r=+(e[0]===t[0])],n[r],t[r])}function MR(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function FR(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function OR(e,t,n){return function(r){var i=yi(r),a=n?Math.min(i[0],0):i[0],o=i[1],u=o-a,s=t?co(a,o,e):u/(e+1);return ko(a+s,o,s)}}function NR(e){ad.call(this,null,e)}NR.Definition={type:"Isocontour",metadata:{generates:true},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:true},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:false},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:true},{name:"smooth",type:"boolean",default:true},{name:"scale",type:"number",expr:true},{name:"translate",type:"number",array:true,expr:true},{name:"as",type:"string",null:true,default:"contour"}]};Ei(NR,ad,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified()){return t.StopPropagation}var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||kr,a=AR().smooth(e.smooth!==false),o=e.thresholds||TR(r,i,e),u=e.as===null?null:e.as||"contour",s=[];r.forEach((function(t){var n=i(t);var r=a.size([n.width,n.height])(n.values,Rr(o)?o:o(n.values));zR(r,n,t,e);r.forEach((function(e){var n;s.push(Yf(t,$f(u!=null?(n={},n[u]=e,n):e)))}))}));if(this.value)n.rem=this.value;this.value=n.source=n.add=s;return n}});function TR(e,t,n){var r=OR(n.levels||10,n.nice,n.zero!==false);return n.resolve!=="shared"?r:r(e.map((function(e){return ho(t(e).values)})))}function zR(e,t,n,r){var i=r.scale||t.scale,a=r.translate||t.translate;if(si(i))i=i(n,r);if(si(a))a=a(n,r);if((i===1||i==null)&&!a)return;var o=(Fi(i)?i:i[0])||1,u=(Fi(i)?i:i[1])||1,s=a&&a[0]||0,l=a&&a[1]||0;e.forEach(RR(t,o,u,s,l))}function RR(e,t,n,r,i){var a=e.x1||0,o=e.y1||0,u=t*n<0;function s(e){e.forEach(l)}function l(e){if(u)e.reverse();e.forEach(f)}function f(e){e[0]=(e[0]-a)*t+r;e[1]=(e[1]-o)*n+i}return function(e){e.coordinates.forEach(s);return e}}function PR(e,t,n){var r=e>=0?e:dd(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function LR(e){return si(e)?e:pi(+e)}function jR(){var e=function(e){return e[0]},t=function(e){return e[1]},n=Er,r=[-1,-1],i=960,a=500,o=2;function u(u,s){var l=PR(r[0],u,e)>>o,f=PR(r[1],u,t)>>o,c=l?l+2:0,d=f?f+2:0,h=2*c+(i>>o),v=2*d+(a>>o),p=new Float32Array(h*v),g=new Float32Array(h*v);var m=p;u.forEach((function(r){var i=c+(+e(r)>>o),a=d+(+t(r)>>o);if(i>=0&&i<h&&a>=0&&a<v){p[i+a*h]+=+n(r)}}));if(l>0&&f>0){BR(h,v,p,g,l);IR(h,v,g,p,f);BR(h,v,p,g,l);IR(h,v,g,p,f);BR(h,v,p,g,l);IR(h,v,g,p,f)}else if(l>0){BR(h,v,p,g,l);BR(h,v,g,p,l);BR(h,v,p,g,l);m=g}else if(f>0){IR(h,v,p,g,f);IR(h,v,g,p,f);IR(h,v,p,g,f);m=g}var y=s?Math.pow(2,-2*o):1/Ao(m);for(var _=0,b=h*v;_<b;++_)m[_]*=y;return{values:m,scale:1<<o,width:h,height:v,x1:c,y1:d,x2:c+(i>>o),y2:d+(a>>o)}}u.x=function(t){return arguments.length?(e=LR(t),u):e};u.y=function(e){return arguments.length?(t=LR(e),u):t};u.weight=function(e){return arguments.length?(n=LR(e),u):n};u.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];if(!(t>=0&&n>=0))_r("invalid size");return i=t,a=n,u};u.cellSize=function(e){if(!arguments.length)return 1<<o;if(!((e=+e)>=1))_r("invalid cell size");o=Math.floor(Math.log(e)/Math.LN2);return u};u.bandwidth=function(e){if(!arguments.length)return r;e=oi(e);if(e.length===1)e=[+e[0],+e[0]];if(e.length!==2)_r("invalid bandwidth");return r=e,u};return u}function BR(e,t,n,r,i){var a=(i<<1)+1;for(var o=0;o<t;++o){for(var u=0,s=0;u<e+i;++u){if(u<e){s+=n[u+o*e]}if(u>=i){if(u>=a){s-=n[u-a+o*e]}r[u-i+o*e]=s/Math.min(u+1,e-1+a-u,a)}}}}function IR(e,t,n,r,i){var a=(i<<1)+1;for(var o=0;o<e;++o){for(var u=0,s=0;u<t+i;++u){if(u<t){s+=n[o+u*e]}if(u>=i){if(u>=a){s-=n[o+(u-a)*e]}r[o+(u-i)*e]=s/Math.min(u+1,t-1+a-u,a)}}}}function UR(e){ad.call(this,null,e)}UR.Definition={type:"KDE2D",metadata:{generates:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"weight",type:"field"},{name:"groupby",type:"field",array:true},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:true,length:2},{name:"counts",type:"boolean",default:false},{name:"as",type:"string",default:"grid"}]};var qR=["x","y","weight","size","cellSize","bandwidth"];function WR(e,t){qR.forEach((function(n){return t[n]!=null?e[n](t[n]):0}));return e}Ei(UR,ad,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=HR(r,e.groupby),a=(e.groupby||[]).map(vr),o=WR(jR(),e),u=e.as||"grid",s=[];function l(e,t){for(var n=0;n<a.length;++n)e[a[n]]=t[n];return e}s=i.map((function(t){var n;return $f(l((n={},n[u]=o(t,e.counts),n),t.dims))}));if(this.value)n.rem=this.value;this.value=n.source=n.add=s;return n}});function HR(e,t){var n=[],r=function(e){return e(u)},i,a,o,u,s,l;if(t==null){n.push(e)}else{for(i={},a=0,o=e.length;a<o;++a){u=e[a];s=t.map(r);l=i[s];if(!l){i[s]=l=[];l.dims=s;n.push(l)}l.push(u)}}return n}function GR(e){ad.call(this,null,e)}GR.Definition={type:"Contour",metadata:{generates:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"values",type:"number",array:true},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:false},{name:"thresholds",type:"number",array:true},{name:"smooth",type:"boolean",default:true}]};Ei(GR,ad,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified()){return t.StopPropagation}var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=AR().smooth(e.smooth!==false),i=e.values,a=e.thresholds||OR(e.count||10,e.nice,!!i),o=e.size,u,s;if(!i){i=t.materialize(t.SOURCE).source;u=WR(jR(),e)(i,true);s=RR(u,u.scale||1,u.scale||1,0,0);o=[u.width,u.height];i=u.values}a=Rr(a)?a:a(i);i=r.size(o)(i,a);if(s)i.forEach(s);if(this.value)n.rem=this.value;this.value=n.source=n.add=(i||[]).map($f);return n}});var $R="Feature";var VR="FeatureCollection";var YR="MultiPoint";function XR(e){ad.call(this,null,e)}XR.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:true,length:2},{name:"geojson",type:"field"}]};Ei(XR,ad,{transform:function(e,t){var n=this._features,r=this._points,i=e.fields,a=i&&i[0],o=i&&i[1],u=e.geojson||!i&&kr,s=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(pr(u))||a&&t.modified(pr(a))||o&&t.modified(pr(o));if(!this.value||l){s=t.SOURCE;this._features=n=[];this._points=r=[]}if(u){t.visit(s,(function(e){return n.push(u(e))}))}if(a&&o){t.visit(s,(function(e){var t=a(e),n=o(e);if(t!=null&&n!=null&&(t=+t)===t&&(n=+n)===n){r.push([t,n])}}));n=n.concat({type:$R,geometry:{type:YR,coordinates:r}})}this.value={type:VR,features:n}}});function JR(e){ad.call(this,null,e)}JR.Definition={type:"GeoPath",metadata:{modifies:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"path"}]};Ei(JR,ad,{transform:function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||kr,a=e.as||"path",o=n.SOURCE;if(!r||e.modified()){this.value=r=_R(e.projection);n.materialize().reflow()}else{o=i===kr||t.modified(i.fields)?n.ADD_MOD:n.ADD}var u=QR(r,e.pointRadius);n.visit(o,(function(e){return e[a]=r(i(e))}));r.pointRadius(u);return n.modifies(a)}});function QR(e,t){var n=e.pointRadius();e.context(null);if(t!=null){e.pointRadius(t)}return n}function ZR(e){ad.call(this,null,e)}ZR.Definition={type:"GeoPoint",metadata:{modifies:true},params:[{name:"projection",type:"projection",required:true},{name:"fields",type:"field",array:true,required:true,length:2},{name:"as",type:"string",array:true,length:2,default:["x","y"]}]};Ei(ZR,ad,{transform:function(e,t){var n=e.projection,r=e.fields[0],i=e.fields[1],a=e.as||["x","y"],o=a[0],u=a[1],s;function l(e){var t=n([r(e),i(e)]);if(t){e[o]=t[0];e[u]=t[1]}else{e[o]=undefined;e[u]=undefined}}if(e.modified()){t=t.materialize().reflow(true).visit(t.SOURCE,l)}else{s=t.modified(r.fields)||t.modified(i.fields);t.visit(s?t.ADD_MOD:t.ADD,l)}return t.modifies(a)}});function KR(e){ad.call(this,null,e)}KR.Definition={type:"GeoShape",metadata:{modifies:true,nomod:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"shape"}]};Ei(KR,ad,{transform:function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;if(!r||e.modified()){this.value=r=eP(_R(e.projection),e.field||xr("datum"),e.pointRadius);n.materialize().reflow();a=n.SOURCE}n.visit(a,(function(e){return e[i]=r}));return n.modifies(i)}});function eP(e,t,n){var r=n==null?function(n){return e(t(n))}:function(r){var i=e.pointRadius(),a=e.pointRadius(n)(t(r));e.pointRadius(i);return a};r.context=function(t){e.context(t);return r};return r}function tP(e){ad.call(this,[],e);this.generator=XN()}tP.Definition={type:"Graticule",metadata:{changes:true,generates:true},params:[{name:"extent",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMajor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMinor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"step",type:"number",array:true,length:2},{name:"stepMajor",type:"number",array:true,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:true,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};Ei(tP,ad,{transform:function(e,t){var n=this.value,r=this.generator,i;if(!n.length||e.modified()){for(var a in e){if(si(r[a])){r[a](e[a])}}}i=r();if(n.length){t.mod.push(Xf(n[0],i))}else{t.add.push($f(i))}n[0]=i;return t}});function nP(e){ad.call(this,null,e)}nP.Definition={type:"heatmap",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:true},{name:"opacity",type:"number",expr:true},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};Ei(nP,ad,{transform:function(e,t){if(!t.changed()&&!e.modified()){return t.StopPropagation}var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||kr,a=iP(e.opacity,e),o=rP(e.color,e),u=e.as||"image",s={$x:0,$y:0,$value:0,$max:r?ho(n.map((function(e){return ho(i(e).values)}))):0};n.forEach((function(e){var t=i(e);var n=mi({},e,s);if(!r)n.$max=ho(t.values||[]);e[u]=oP(t,n,o.dep?o:pi(o(n)),a.dep?a:pi(a(n)))}));return t.reflow(true).modifies(u)}});function rP(e,t){var n;if(si(e)){n=function(n){return am(e(n,t))};n.dep=aP(e)}else{n=pi(am(e||"#888"))}return n}function iP(e,t){var n;if(si(e)){n=function(n){return e(n,t)};n.dep=aP(e)}else if(e){n=pi(e)}else{n=function(e){return e.$value/e.$max||0};n.dep=true}return n}function aP(e){if(!si(e))return false;var t=$i(pr(e));return t.$x||t.$y||t.$value||t.$max}function oP(e,t,n,r){var i=e.width,a=e.height,o=e.x1||0,u=e.y1||0,s=e.x2||i,l=e.y2||a,f=e.values,c=f?function(e){return f[e]}:Ar,d=Fg(s-o,l-u),h=d.getContext("2d"),v=h.getImageData(0,0,s-o,l-u),p=v.data;for(var g=u,m=0;g<l;++g){t.$y=g-u;for(var y=o,_=g*i;y<s;++y,m+=4){t.$x=y-o;t.$value=c(y+_);var b=n(t);p[m+0]=b.r;p[m+1]=b.g;p[m+2]=b.b;p[m+3]=~~(255*r(t))}}h.putImageData(v,0,0);return d}function uP(e){ad.call(this,null,e);this.modified(true)}Ei(uP,ad,{transform:function(e,t){var n=this.value;if(!n||e.modified("type")){this.value=n=lP(e.type);gR.forEach((function(t){if(e[t]!=null)fP(n,t,e[t])}))}else{gR.forEach((function(t){if(e.modified(t))fP(n,t,e[t])}))}if(e.pointRadius!=null)n.path.pointRadius(e.pointRadius);if(e.fit)sP(n,e);return t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function sP(e,t){var n=cP(t.fit);t.extent?e.fitExtent(t.extent,n):t.size?e.fitSize(t.size,n):0}function lP(e){var t=yR((e||"mercator").toLowerCase());if(!t)_r("Unrecognized projection type: "+e);return t()}function fP(e,t,n){if(si(e[t]))e[t](n)}function cP(e){e=oi(e);return e.length===1?e[0]:{type:VR,features:e.reduce((function(e,t){return e.concat(dP(t))}),[])}}function dP(e){return e.type===VR?e.features:oi(e).filter((function(e){return e!=null})).map((function(e){return e.type===$R?e:{type:$R,geometry:e}}))}var hP=Object.freeze({__proto__:null,contour:GR,geojson:XR,geopath:JR,geopoint:ZR,geoshape:KR,graticule:tP,heatmap:nP,isocontour:NR,kde2d:UR,projection:uP});function vP(e,t){var n,r=1;if(e==null)e=0;if(t==null)t=0;function i(){var i,a=n.length,o,u=0,s=0;for(i=0;i<a;++i){o=n[i],u+=o.x,s+=o.y}for(u=(u/a-e)*r,s=(s/a-t)*r,i=0;i<a;++i){o=n[i],o.x-=u,o.y-=s}}i.initialize=function(e){n=e};i.x=function(t){return arguments.length?(e=+t,i):e};i.y=function(e){return arguments.length?(t=+e,i):t};i.strength=function(e){return arguments.length?(r=+e,i):r};return i}function pP(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return gP(this.cover(t,n),t,n,e)}function gP(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a=e._root,o={data:r},u=e._x0,s=e._y0,l=e._x1,f=e._y1,c,d,h,v,p,g,m,y;if(!a)return e._root=o,e;while(a.length){if(p=t>=(c=(u+l)/2))u=c;else l=c;if(g=n>=(d=(s+f)/2))s=d;else f=d;if(i=a,!(a=a[m=g<<1|p]))return i[m]=o,e}h=+e._x.call(null,a.data);v=+e._y.call(null,a.data);if(t===h&&n===v)return o.next=a,i?i[m]=o:e._root=o,e;do{i=i?i[m]=new Array(4):e._root=new Array(4);if(p=t>=(c=(u+l)/2))u=c;else l=c;if(g=n>=(d=(s+f)/2))s=d;else f=d}while((m=g<<1|p)===(y=(v>=d)<<1|h>=c));return i[y]=a,i[m]=o,e}function mP(e){var t,n,r=e.length,i,a,o=new Array(r),u=new Array(r),s=Infinity,l=Infinity,f=-Infinity,c=-Infinity;for(n=0;n<r;++n){if(isNaN(i=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t)))continue;o[n]=i;u[n]=a;if(i<s)s=i;if(i>f)f=i;if(a<l)l=a;if(a>c)c=a}if(s>f||l>c)return this;this.cover(s,l).cover(f,c);for(n=0;n<r;++n){gP(this,o[n],u[n],e[n])}return this}function yP(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n)){i=(n=Math.floor(e))+1;a=(r=Math.floor(t))+1}else{var o=i-n||1,u=this._root,s,l;while(n>e||e>=i||r>t||t>=a){l=(t<r)<<1|e<n;s=new Array(4),s[l]=u,u=s,o*=2;switch(l){case 0:i=n+o,a=r+o;break;case 1:n=i-o,a=r+o;break;case 2:i=n+o,r=a-o;break;case 3:n=i-o,r=a-o;break}}if(this._root&&this._root.length)this._root=u}this._x0=n;this._y0=r;this._x1=i;this._y1=a;return this}function _P(){var e=[];this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}));return e}function bP(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?undefined:[[this._x0,this._y0],[this._x1,this._y1]]}function xP(e,t,n,r,i){this.node=e;this.x0=t;this.y0=n;this.x1=r;this.y1=i}function wP(e,t,n){var r,i=this._x0,a=this._y0,o,u,s,l,f=this._x1,c=this._y1,d=[],h=this._root,v,p;if(h)d.push(new xP(h,i,a,f,c));if(n==null)n=Infinity;else{i=e-n,a=t-n;f=e+n,c=t+n;n*=n}while(v=d.pop()){if(!(h=v.node)||(o=v.x0)>f||(u=v.y0)>c||(s=v.x1)<i||(l=v.y1)<a)continue;if(h.length){var g=(o+s)/2,m=(u+l)/2;d.push(new xP(h[3],g,m,s,l),new xP(h[2],o,m,g,l),new xP(h[1],g,u,s,m),new xP(h[0],o,u,g,m));if(p=(t>=m)<<1|e>=g){v=d[d.length-1];d[d.length-1]=d[d.length-1-p];d[d.length-1-p]=v}}else{var y=e-+this._x.call(null,h.data),_=t-+this._y.call(null,h.data),b=y*y+_*_;if(b<n){var x=Math.sqrt(n=b);i=e-x,a=t-x;f=e+x,c=t+x;r=h.data}}}return r}function kP(e){if(isNaN(f=+this._x.call(null,e))||isNaN(c=+this._y.call(null,e)))return this;var t,n=this._root,r,i,a,o=this._x0,u=this._y0,s=this._x1,l=this._y1,f,c,d,h,v,p,g,m;if(!n)return this;if(n.length)while(true){if(v=f>=(d=(o+s)/2))o=d;else s=d;if(p=c>=(h=(u+l)/2))u=h;else l=h;if(!(t=n,n=n[g=p<<1|v]))return this;if(!n.length)break;if(t[g+1&3]||t[g+2&3]||t[g+3&3])r=t,m=g}while(n.data!==e)if(!(i=n,n=n.next))return this;if(a=n.next)delete n.next;if(i)return a?i.next=a:delete i.next,this;if(!t)return this._root=a,this;a?t[g]=a:delete t[g];if((n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length){if(r)r[m]=n;else this._root=n}return this}function AP(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function EP(){return this._root}function DP(){var e=0;this.visit((function(t){if(!t.length)do{++e}while(t=t.next)}));return e}function SP(e){var t=[],n,r=this._root,i,a,o,u,s;if(r)t.push(new xP(r,this._x0,this._y0,this._x1,this._y1));while(n=t.pop()){if(!e(r=n.node,a=n.x0,o=n.y0,u=n.x1,s=n.y1)&&r.length){var l=(a+u)/2,f=(o+s)/2;if(i=r[3])t.push(new xP(i,l,f,u,s));if(i=r[2])t.push(new xP(i,a,f,l,s));if(i=r[1])t.push(new xP(i,l,o,u,f));if(i=r[0])t.push(new xP(i,a,o,l,f))}}return this}function CP(e){var t=[],n=[],r;if(this._root)t.push(new xP(this._root,this._x0,this._y0,this._x1,this._y1));while(r=t.pop()){var i=r.node;if(i.length){var a,o=r.x0,u=r.y0,s=r.x1,l=r.y1,f=(o+s)/2,c=(u+l)/2;if(a=i[0])t.push(new xP(a,o,u,f,c));if(a=i[1])t.push(new xP(a,f,u,s,c));if(a=i[2])t.push(new xP(a,o,c,f,l));if(a=i[3])t.push(new xP(a,f,c,s,l))}n.push(r)}while(r=n.pop()){e(r.node,r.x0,r.y0,r.x1,r.y1)}return this}function MP(e){return e[0]}function FP(e){return arguments.length?(this._x=e,this):this._x}function OP(e){return e[1]}function NP(e){return arguments.length?(this._y=e,this):this._y}function TP(e,t,n){var r=new zP(t==null?MP:t,n==null?OP:n,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function zP(e,t,n,r,i,a){this._x=e;this._y=t;this._x0=n;this._y0=r;this._x1=i;this._y1=a;this._root=undefined}function RP(e){var t={data:e.data},n=t;while(e=e.next)n=n.next={data:e.data};return t}var PP=TP.prototype=zP.prototype;PP.copy=function(){var e=new zP(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,r;if(!t)return e;if(!t.length)return e._root=RP(t),e;n=[{source:t,target:e._root=new Array(4)}];while(t=n.pop()){for(var i=0;i<4;++i){if(r=t.source[i]){if(r.length)n.push({source:r,target:t.target[i]=new Array(4)});else t.target[i]=RP(r)}}}return e};PP.add=pP;PP.addAll=mP;PP.cover=yP;PP.data=_P;PP.extent=bP;PP.find=wP;PP.remove=kP;PP.removeAll=AP;PP.root=EP;PP.size=DP;PP.visit=SP;PP.visitAfter=CP;PP.x=FP;PP.y=NP;function LP(e){return function(){return e}}function jP(e){return(e()-.5)*1e-6}function BP(e){return e.x+e.vx}function IP(e){return e.y+e.vy}function UP(e){var t,n,r,i=1,a=1;if(typeof e!=="function")e=LP(e==null?1:+e);function o(){var e,o=t.length,s,l,f,c,d,h;for(var v=0;v<a;++v){s=TP(t,BP,IP).visitAfter(u);for(e=0;e<o;++e){l=t[e];d=n[l.index],h=d*d;f=l.x+l.vx;c=l.y+l.vy;s.visit(p)}}function p(e,t,n,a,o){var u=e.data,s=e.r,v=d+s;if(u){if(u.index>l.index){var p=f-u.x-u.vx,g=c-u.y-u.vy,m=p*p+g*g;if(m<v*v){if(p===0)p=jP(r),m+=p*p;if(g===0)g=jP(r),m+=g*g;m=(v-(m=Math.sqrt(m)))/m*i;l.vx+=(p*=m)*(v=(s*=s)/(h+s));l.vy+=(g*=m)*v;u.vx-=p*(v=1-v);u.vy-=g*v}}return}return t>f+v||a<f-v||n>c+v||o<c-v}}function u(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t){if(e[t]&&e[t].r>e.r){e.r=e[t].r}}}function s(){if(!t)return;var r,i=t.length,a;n=new Array(i);for(r=0;r<i;++r)a=t[r],n[a.index]=+e(a,r,t)}o.initialize=function(e,n){t=e;r=n;s()};o.iterations=function(e){return arguments.length?(a=+e,o):a};o.strength=function(e){return arguments.length?(i=+e,o):i};o.radius=function(t){return arguments.length?(e=typeof t==="function"?t:LP(+t),s(),o):e};return o}function qP(e){return e.index}function WP(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function HP(e){var t=qP,n=c,r,i=LP(30),a,o,u,s,l,f=1;if(e==null)e=[];function c(e){return 1/Math.min(u[e.source.index],u[e.target.index])}function d(t){for(var n=0,i=e.length;n<f;++n){for(var o=0,u,c,d,h,v,p,g;o<i;++o){u=e[o],c=u.source,d=u.target;h=d.x+d.vx-c.x-c.vx||jP(l);v=d.y+d.vy-c.y-c.vy||jP(l);p=Math.sqrt(h*h+v*v);p=(p-a[o])/p*t*r[o];h*=p,v*=p;d.vx-=h*(g=s[o]);d.vy-=v*g;c.vx+=h*(g=1-g);c.vy+=v*g}}}function h(){if(!o)return;var n,i=o.length,l=e.length,f=new Map(o.map((function(e,n){return[t(e,n,o),e]}))),c;for(n=0,u=new Array(i);n<l;++n){c=e[n],c.index=n;if(typeof c.source!=="object")c.source=WP(f,c.source);if(typeof c.target!=="object")c.target=WP(f,c.target);u[c.source.index]=(u[c.source.index]||0)+1;u[c.target.index]=(u[c.target.index]||0)+1}for(n=0,s=new Array(l);n<l;++n){c=e[n],s[n]=u[c.source.index]/(u[c.source.index]+u[c.target.index])}r=new Array(l),v();a=new Array(l),p()}function v(){if(!o)return;for(var t=0,i=e.length;t<i;++t){r[t]=+n(e[t],t,e)}}function p(){if(!o)return;for(var t=0,n=e.length;t<n;++t){a[t]=+i(e[t],t,e)}}d.initialize=function(e,t){o=e;l=t;h()};d.links=function(t){return arguments.length?(e=t,h(),d):e};d.id=function(e){return arguments.length?(t=e,d):t};d.iterations=function(e){return arguments.length?(f=+e,d):f};d.strength=function(e){return arguments.length?(n=typeof e==="function"?e:LP(+e),v(),d):n};d.distance=function(e){return arguments.length?(i=typeof e==="function"?e:LP(+e),p(),d):i};return d}var GP={value:function(){}};function $P(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new VP(n)}function VP(e){this._=e}function YP(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0)n=e.slice(r+1),e=e.slice(0,r);if(e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}VP.prototype=$P.prototype={constructor:VP,on:function(e,t){var n=this._,r=YP(e+"",n),i,a=-1,o=r.length;if(arguments.length<2){while(++a<o)if((i=(e=r[a]).type)&&(i=XP(n[i],e.name)))return i;return}if(t!=null&&typeof t!=="function")throw new Error("invalid callback: "+t);while(++a<o){if(i=(e=r[a]).type)n[i]=JP(n[i],e.name,t);else if(t==null)for(i in n)n[i]=JP(n[i],e.name,null)}return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new VP(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],r=0,i=a.length;r<i;++r)a[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};function XP(e,t){for(var n=0,r=e.length,i;n<r;++n){if((i=e[n]).name===t){return i.value}}}function JP(e,t,n){for(var r=0,i=e.length;r<i;++r){if(e[r].name===t){e[r]=GP,e=e.slice(0,r).concat(e.slice(r+1));break}}if(n!=null)e.push({name:t,value:n});return e}var QP=0,ZP=0,KP=0,eL=1e3,tL,nL,rL=0,iL=0,aL=0,oL=typeof performance==="object"&&performance.now?performance:Date,uL=typeof window==="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function sL(){return iL||(uL(lL),iL=oL.now()+aL)}function lL(){iL=0}function fL(){this._call=this._time=this._next=null}fL.prototype=cL.prototype={constructor:fL,restart:function(e,t,n){if(typeof e!=="function")throw new TypeError("callback is not a function");n=(n==null?sL():+n)+(t==null?0:+t);if(!this._next&&nL!==this){if(nL)nL._next=this;else tL=this;nL=this}this._call=e;this._time=n;gL()},stop:function(){if(this._call){this._call=null;this._time=Infinity;gL()}}};function cL(e,t,n){var r=new fL;r.restart(e,t,n);return r}function dL(){sL();++QP;var e=tL,t;while(e){if((t=iL-e._time)>=0)e._call.call(null,t);e=e._next}--QP}function hL(){iL=(rL=oL.now())+aL;QP=ZP=0;try{dL()}finally{QP=0;pL();iL=0}}function vL(){var e=oL.now(),t=e-rL;if(t>eL)aL-=t,rL=e}function pL(){var e,t=tL,n,r=Infinity;while(t){if(t._call){if(r>t._time)r=t._time;e=t,t=t._next}else{n=t._next,t._next=null;t=e?e._next=n:tL=n}}nL=e;gL(r)}function gL(e){if(QP)return;if(ZP)ZP=clearTimeout(ZP);var t=e-iL;if(t>24){if(e<Infinity)ZP=setTimeout(hL,e-oL.now()-aL);if(KP)KP=clearInterval(KP)}else{if(!KP)rL=oL.now(),KP=setInterval(vL,eL);QP=1,uL(hL)}}function mL(e,t,n){var r=new fL,i=t;if(t==null)return r.restart(e,t,n),r;r._restart=r.restart;r.restart=function(e,t,n){t=+t,n=n==null?sL():+n;r._restart((function a(o){o+=i;r._restart(a,i+=t,n);e(o)}),t,n)};r.restart(e,t,n);return r}var yL=1664525;var _L=1013904223;var bL=4294967296;function xL(){var e=1;return function(){return(e=(yL*e+_L)%bL)/bL}}function wL(e){return e.x}function kL(e){return e.y}var AL=10,EL=Math.PI*(3-Math.sqrt(5));function DL(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,u=new Map,s=cL(c),l=$P("tick","end"),f=xL();if(e==null)e=[];function c(){d();l.call("tick",t);if(n<r){s.stop();l.call("end",t)}}function d(r){var s,l=e.length,f;if(r===undefined)r=1;for(var c=0;c<r;++c){n+=(a-n)*i;u.forEach((function(e){e(n)}));for(s=0;s<l;++s){f=e[s];if(f.fx==null)f.x+=f.vx*=o;else f.x=f.fx,f.vx=0;if(f.fy==null)f.y+=f.vy*=o;else f.y=f.fy,f.vy=0}}return t}function h(){for(var t=0,n=e.length,r;t<n;++t){r=e[t],r.index=t;if(r.fx!=null)r.x=r.fx;if(r.fy!=null)r.y=r.fy;if(isNaN(r.x)||isNaN(r.y)){var i=AL*Math.sqrt(.5+t),a=t*EL;r.x=i*Math.cos(a);r.y=i*Math.sin(a)}if(isNaN(r.vx)||isNaN(r.vy)){r.vx=r.vy=0}}}function v(t){if(t.initialize)t.initialize(e,f);return t}h();return t={tick:d,restart:function(){return s.restart(c),t},stop:function(){return s.stop(),t},nodes:function(n){return arguments.length?(e=n,h(),u.forEach(v),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(f=e,u.forEach(v),t):f},force:function(e,n){return arguments.length>1?(n==null?u.delete(e):u.set(e,v(n)),t):u.get(e)},find:function(t,n,r){var i=0,a=e.length,o,u,s,l,f;if(r==null)r=Infinity;else r*=r;for(i=0;i<a;++i){l=e[i];o=t-l.x;u=n-l.y;s=o*o+u*u;if(s<r)f=l,r=s}return f},on:function(e,n){return arguments.length>1?(l.on(e,n),t):l.on(e)}}}function SL(){var e,t,n,r,i=LP(-30),a,o=1,u=Infinity,s=.81;function l(n){var i,a=e.length,o=TP(e,wL,kL).visitAfter(c);for(r=n,i=0;i<a;++i)t=e[i],o.visit(d)}function f(){if(!e)return;var t,n=e.length,r;a=new Array(n);for(t=0;t<n;++t)r=e[t],a[r.index]=+i(r,t,e)}function c(e){var t=0,n,r,i=0,o,u,s;if(e.length){for(o=u=s=0;s<4;++s){if((n=e[s])&&(r=Math.abs(n.value))){t+=n.value,i+=r,o+=r*n.x,u+=r*n.y}}e.x=o/i;e.y=u/i}else{n=e;n.x=n.data.x;n.y=n.data.y;do{t+=a[n.data.index]}while(n=n.next)}e.value=t}function d(e,i,l,f){if(!e.value)return true;var c=e.x-t.x,d=e.y-t.y,h=f-i,v=c*c+d*d;if(h*h/s<v){if(v<u){if(c===0)c=jP(n),v+=c*c;if(d===0)d=jP(n),v+=d*d;if(v<o)v=Math.sqrt(o*v);t.vx+=c*e.value*r/v;t.vy+=d*e.value*r/v}return true}else if(e.length||v>=u)return;if(e.data!==t||e.next){if(c===0)c=jP(n),v+=c*c;if(d===0)d=jP(n),v+=d*d;if(v<o)v=Math.sqrt(o*v)}do{if(e.data!==t){h=a[e.data.index]*r/v;t.vx+=c*h;t.vy+=d*h}}while(e=e.next)}l.initialize=function(t,r){e=t;n=r;f()};l.strength=function(e){return arguments.length?(i=typeof e==="function"?e:LP(+e),f(),l):i};l.distanceMin=function(e){return arguments.length?(o=e*e,l):Math.sqrt(o)};l.distanceMax=function(e){return arguments.length?(u=e*e,l):Math.sqrt(u)};l.theta=function(e){return arguments.length?(s=e*e,l):Math.sqrt(s)};return l}function CL(e){var t=LP(.1),n,r,i;if(typeof e!=="function")e=LP(e==null?0:+e);function a(e){for(var t=0,a=n.length,o;t<a;++t){o=n[t],o.vx+=(i[t]-o.x)*r[t]*e}}function o(){if(!n)return;var a,o=n.length;r=new Array(o);i=new Array(o);for(a=0;a<o;++a){r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}a.initialize=function(e){n=e;o()};a.strength=function(e){return arguments.length?(t=typeof e==="function"?e:LP(+e),o(),a):t};a.x=function(t){return arguments.length?(e=typeof t==="function"?t:LP(+t),o(),a):e};return a}function ML(e){var t=LP(.1),n,r,i;if(typeof e!=="function")e=LP(e==null?0:+e);function a(e){for(var t=0,a=n.length,o;t<a;++t){o=n[t],o.vy+=(i[t]-o.y)*r[t]*e}}function o(){if(!n)return;var a,o=n.length;r=new Array(o);i=new Array(o);for(a=0;a<o;++a){r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}a.initialize=function(e){n=e;o()};a.strength=function(e){return arguments.length?(t=typeof e==="function"?e:LP(+e),o(),a):t};a.y=function(t){return arguments.length?(e=typeof t==="function"?t:LP(+t),o(),a):e};return a}var FL={center:vP,collide:UP,nbody:SL,link:HP,x:CL,y:ML};var OL="forces",NL=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],TL=["static","iterations"],zL=["x","y","vx","vy"];function RL(e){ad.call(this,null,e)}RL.Definition={type:"Force",metadata:{modifies:true},params:[{name:"static",type:"boolean",default:false},{name:"restart",type:"boolean",default:false},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:true,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:true},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:true},{name:"strength",type:"number",expr:true},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:true,modify:false,default:zL}]};Ei(RL,ad,{transform:function(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(NL),a=e.iterations||300;if(!n){this.value=n=LL(t.source,e);n.on("tick",PL(t.dataflow,this));if(!e.static){r=true;n.tick()}t.modifies("index")}else{if(r){t.modifies("index");n.nodes(t.source)}if(i||t.changed(t.MOD)){jL(n,e,0,t)}}if(i||r||e.modified(TL)||t.changed()&&e.restart){n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a));if(e.static){for(n.stop();--a>=0;)n.tick()}else{if(n.stopped())n.restart();if(!r)return t.StopPropagation}}return this.finish(e,t)},finish:function(e,t){var n=t.dataflow;for(var r=this._argops,i=0,a=r.length,o=void 0;i<a;++i){o=r[i];if(o.name!==OL||o.op._argval.force!=="link"){continue}for(var u=o.op._argops,s=0,l=u.length,f;s<l;++s){if(u[s].name==="links"&&(f=u[s].op.source)){n.pulse(f,n.changeset().reflow());break}}}return t.reflow(e.modified()).modifies(zL)}});function PL(e,t){return function(){return e.touch(t).run()}}function LL(e,t){var n=DL(e),r=n.stop,i=n.restart;var a=false;n.stopped=function(){return a};n.restart=function(){return a=false,i()};n.stop=function(){return a=true,r()};return jL(n,t,true).on("end",(function(){return a=true}))}function jL(e,t,n,r){var i=oi(t.forces),a,o,u,s;for(a=0,o=NL.length;a<o;++a){u=NL[a];if(u!==OL&&t.modified(u))e[u](t[u])}for(a=0,o=i.length;a<o;++a){s=OL+a;u=n||t.modified(OL,a)?IL(i[a]):r&&BL(i[a],r)?e.force(s):null;if(u)e.force(s,u)}for(o=e.numForces||0;a<o;++a){e.force(OL+a,null)}e.numForces=i.length;return e}function BL(e,t){var n,r;for(n in e){if(si(r=e[n])&&t.modified(pr(r)))return 1}return 0}function IL(e){var t,n;if(!xi(FL,e.force)){_r("Unrecognized force: "+e.force)}t=FL[e.force]();for(n in e){if(si(t[n]))UL(t[n],e[n],e)}return t}function UL(e,t,n){e(si(t)?function(e){return t(e,n)}:t)}var qL=Object.freeze({__proto__:null,force:RL});function WL(e,t){return e.parent===t.parent?1:2}function HL(e){return e.reduce(GL,0)/e.length}function GL(e,t){return e+t.x}function $L(e){return 1+e.reduce(VL,0)}function VL(e,t){return Math.max(e,t.y)}function YL(e){var t;while(t=e.children)e=t[0];return e}function XL(e){var t;while(t=e.children)e=t[t.length-1];return e}function JL(){var e=WL,t=1,n=1,r=false;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;if(n){t.x=HL(n);t.y=$L(n)}else{t.x=a?o+=e(t,a):0;t.y=0;a=t}}));var u=YL(i),s=XL(i),l=u.x-e(u,s)/2,f=s.x+e(s,u)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t;e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-l)/(f-l)*t;e.y=(1-(i.y?e.y/i.y:1))*n})}i.separation=function(t){return arguments.length?(e=t,i):e};i.size=function(e){return arguments.length?(r=false,t=+e[0],n=+e[1],i):r?null:[t,n]};i.nodeSize=function(e){return arguments.length?(r=true,t=+e[0],n=+e[1],i):r?[t,n]:null};return i}function QL(e){var t=0,n=e.children,r=n&&n.length;if(!r)t=1;else while(--r>=0)t+=n[r].value;e.value=t}function ZL(){return this.eachAfter(QL)}function KL(e,t){var n=-1;for(var r=0,i=this;r<i.length;r++){var a=i[r];e.call(t,a,++n,this)}return this}function ej(e,t){var n=this,r=[n],i,a,o=-1;while(n=r.pop()){e.call(t,n,++o,this);if(i=n.children){for(a=i.length-1;a>=0;--a){r.push(i[a])}}}return this}function tj(e,t){var n=this,r=[n],i=[],a,o,u,s=-1;while(n=r.pop()){i.push(n);if(a=n.children){for(o=0,u=a.length;o<u;++o){r.push(a[o])}}}while(n=i.pop()){e.call(t,n,++s,this)}return this}function nj(e,t){var n=-1;for(var r=0,i=this;r<i.length;r++){var a=i[r];if(e.call(t,a,++n,this)){return a}}}function rj(e){return this.eachAfter((function(t){var n=+e(t.data)||0,r=t.children,i=r&&r.length;while(--i>=0)n+=r[i].value;t.value=n}))}function ij(e){return this.eachBefore((function(t){if(t.children){t.children.sort(e)}}))}function aj(e){var t=this,n=oj(t,e),r=[t];while(t!==n){t=t.parent;r.push(t)}var i=r.length;while(e!==n){r.splice(i,0,e);e=e.parent}return r}function oj(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;e=n.pop();t=r.pop();while(e===t){i=e;e=n.pop();t=r.pop()}return i}function uj(){var e=this,t=[e];while(e=e.parent){t.push(e)}return t}function sj(){return Array.from(this)}function lj(){var e=[];this.eachBefore((function(t){if(!t.children){e.push(t)}}));return e}function fj(){var e=this,t=[];e.each((function(n){if(n!==e){t.push({source:n.parent,target:n})}}));return t}function cj(){var e,t,n,r,i,a;return __generator(this,(function(o){switch(o.label){case 0:e=this,n=[e];o.label=1;case 1:t=n.reverse(),n=[];o.label=2;case 2:if(!(e=t.pop()))return[3,4];return[4,e];case 3:o.sent();if(r=e.children){for(i=0,a=r.length;i<a;++i){n.push(r[i])}}return[3,2];case 4:if(n.length)return[3,1];o.label=5;case 5:return[2]}}))}function dj(e,t){if(e instanceof Map){e=[undefined,e];if(t===undefined)t=pj}else if(t===undefined){t=vj}var n=new yj(e),r,i=[n],a,o,u,s;while(r=i.pop()){if((o=t(r.data))&&(s=(o=Array.from(o)).length)){r.children=o;for(u=s-1;u>=0;--u){i.push(a=o[u]=new yj(o[u]));a.parent=r;a.depth=r.depth+1}}}return n.eachBefore(mj)}function hj(){return dj(this).eachBefore(gj)}function vj(e){return e.children}function pj(e){return Array.isArray(e)?e[1]:null}function gj(e){if(e.data.value!==undefined)e.value=e.data.value;e.data=e.data.data}function mj(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function yj(e){this.data=e;this.depth=this.height=0;this.parent=null}yj.prototype=dj.prototype=(b={constructor:yj,count:ZL,each:KL,eachAfter:tj,eachBefore:ej,find:nj,sum:rj,sort:ij,path:aj,ancestors:uj,descendants:sj,leaves:lj,links:fj,copy:hj},b[Symbol.iterator]=cj,b);function _j(e){return typeof e==="object"&&"length"in e?e:Array.from(e)}function bj(e){var t=e.length,n,r;while(t){r=Math.random()*t--|0;n=e[t];e[t]=e[r];e[r]=n}return e}function xj(e){var t=0,n=(e=bj(Array.from(e))).length,r=[],i,a;while(t<n){i=e[t];if(a&&Aj(a,i))++t;else a=Dj(r=wj(r,i)),t=0}return a}function wj(e,t){var n,r;if(Ej(t,e))return[t];for(n=0;n<e.length;++n){if(kj(t,e[n])&&Ej(Cj(e[n],t),e)){return[e[n],t]}}for(n=0;n<e.length-1;++n){for(r=n+1;r<e.length;++r){if(kj(Cj(e[n],e[r]),t)&&kj(Cj(e[n],t),e[r])&&kj(Cj(e[r],t),e[n])&&Ej(Mj(e[n],e[r],t),e)){return[e[n],e[r],t]}}}throw new Error}function kj(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function Aj(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function Ej(e,t){for(var n=0;n<t.length;++n){if(!Aj(e,t[n])){return false}}return true}function Dj(e){switch(e.length){case 1:return Sj(e[0]);case 2:return Cj(e[0],e[1]);case 3:return Mj(e[0],e[1],e[2])}}function Sj(e){return{x:e.x,y:e.y,r:e.r}}function Cj(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,u=t.r,s=a-n,l=o-r,f=u-i,c=Math.sqrt(s*s+l*l);return{x:(n+a+s/c*f)/2,y:(r+o+l/c*f)/2,r:(c+i+u)/2}}function Mj(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,u=t.y,s=t.r,l=n.x,f=n.y,c=n.r,d=r-o,h=r-l,v=i-u,p=i-f,g=s-a,m=c-a,y=r*r+i*i-a*a,_=y-o*o-u*u+s*s,b=y-l*l-f*f+c*c,x=h*v-d*p,w=(v*b-p*_)/(x*2)-r,k=(p*g-v*m)/x,A=(h*_-d*b)/(x*2)-i,E=(d*m-h*g)/x,D=k*k+E*E-1,S=2*(a+w*k+A*E),C=w*w+A*A-a*a,M=-(D?(S+Math.sqrt(S*S-4*D*C))/(2*D):C/S);return{x:r+w+k*M,y:i+A+E*M,r:M}}function Fj(e,t,n){var r=e.x-t.x,i,a,o=e.y-t.y,u,s,l=r*r+o*o;if(l){a=t.r+n.r,a*=a;s=e.r+n.r,s*=s;if(a>s){i=(l+s-a)/(2*l);u=Math.sqrt(Math.max(0,s/l-i*i));n.x=e.x-i*r-u*o;n.y=e.y-i*o+u*r}else{i=(l+a-s)/(2*l);u=Math.sqrt(Math.max(0,a/l-i*i));n.x=t.x+i*r-u*o;n.y=t.y+i*o+u*r}}else{n.x=t.x+n.r;n.y=t.y}}function Oj(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function Nj(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function Tj(e){this._=e;this.next=null;this.previous=null}function zj(e){if(!(i=(e=_j(e)).length))return 0;var t,n,r,i,a,o,u,s,l,f,c;t=e[0],t.x=0,t.y=0;if(!(i>1))return t.r;n=e[1],t.x=-n.r,n.x=t.r,n.y=0;if(!(i>2))return t.r+n.r;Fj(n,t,r=e[2]);t=new Tj(t),n=new Tj(n),r=new Tj(r);t.next=r.previous=n;n.next=t.previous=r;r.next=n.previous=t;e:for(u=3;u<i;++u){Fj(t._,n._,r=e[u]),r=new Tj(r);s=n.next,l=t.previous,f=n._.r,c=t._.r;do{if(f<=c){if(Oj(s._,r._)){n=s,t.next=n,n.previous=t,--u;continue e}f+=s._.r,s=s.next}else{if(Oj(l._,r._)){t=l,t.next=n,n.previous=t,--u;continue e}c+=l._.r,l=l.previous}}while(s!==l.next);r.previous=t,r.next=n,t.next=n.previous=n=r;a=Nj(t);while((r=r.next)!==n){if((o=Nj(r))<a){t=r,a=o}}n=t.next}t=[n._],r=n;while((r=r.next)!==n)t.push(r._);r=xj(t);for(u=0;u<i;++u)t=e[u],t.x-=r.x,t.y-=r.y;return r.r}function Rj(e){return e==null?null:Pj(e)}function Pj(e){if(typeof e!=="function")throw new Error;return e}function Lj(){return 0}function jj(e){return function(){return e}}function Bj(e){return Math.sqrt(e.value)}function Ij(){var e=null,t=1,n=1,r=Lj;function i(i){i.x=t/2,i.y=n/2;if(e){i.eachBefore(Uj(e)).eachAfter(qj(r,.5)).eachBefore(Wj(1))}else{i.eachBefore(Uj(Bj)).eachAfter(qj(Lj,1)).eachAfter(qj(r,i.r/Math.min(t,n))).eachBefore(Wj(Math.min(t,n)/(2*i.r)))}return i}i.radius=function(t){return arguments.length?(e=Rj(t),i):e};i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]};i.padding=function(e){return arguments.length?(r=typeof e==="function"?e:jj(+e),i):r};return i}function Uj(e){return function(t){if(!t.children){t.r=Math.max(0,+e(t)||0)}}}function qj(e,t){return function(n){if(r=n.children){var r,i,a=r.length,o=e(n)*t||0,u;if(o)for(i=0;i<a;++i)r[i].r+=o;u=zj(r);if(o)for(i=0;i<a;++i)r[i].r-=o;n.r=u+o}}}function Wj(e){return function(t){var n=t.parent;t.r*=e;if(n){t.x=n.x+e*t.x;t.y=n.y+e*t.y}}}function Hj(e){e.x0=Math.round(e.x0);e.y0=Math.round(e.y0);e.x1=Math.round(e.x1);e.y1=Math.round(e.y1)}function Gj(e,t,n,r,i){var a=e.children,o,u=-1,s=a.length,l=e.value&&(r-t)/e.value;while(++u<s){o=a[u],o.y0=n,o.y1=i;o.x0=t,o.x1=t+=o.value*l}}function $j(){var e=1,t=1,n=0,r=false;function i(i){var o=i.height+1;i.x0=i.y0=n;i.x1=e;i.y1=t/o;i.eachBefore(a(t,o));if(r)i.eachBefore(Hj);return i}function a(e,t){return function(r){if(r.children){Gj(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t)}var i=r.x0,a=r.y0,o=r.x1-n,u=r.y1-n;if(o<i)i=o=(i+o)/2;if(u<a)a=u=(a+u)/2;r.x0=i;r.y0=a;r.x1=o;r.y1=u}}i.round=function(e){return arguments.length?(r=!!e,i):r};i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]};i.padding=function(e){return arguments.length?(n=+e,i):n};return i}var Vj={depth:-1},Yj={};function Xj(e){return e.id}function Jj(e){return e.parentId}function Qj(){var e=Xj,t=Jj;function n(n){var r=Array.from(n),i=r.length,a,o,u,s,l,f,c,d=new Map;for(o=0;o<i;++o){a=r[o],l=r[o]=new yj(a);if((f=e(a,o,n))!=null&&(f+="")){c=l.id=f;d.set(c,d.has(c)?Yj:l)}if((f=t(a,o,n))!=null&&(f+="")){l.parent=f}}for(o=0;o<i;++o){l=r[o];if(f=l.parent){s=d.get(f);if(!s)throw new Error("missing: "+f);if(s===Yj)throw new Error("ambiguous: "+f);if(s.children)s.children.push(l);else s.children=[l];l.parent=s}else{if(u)throw new Error("multiple roots");u=l}}if(!u)throw new Error("no root");u.parent=Vj;u.eachBefore((function(e){e.depth=e.parent.depth+1;--i})).eachBefore(mj);u.parent=null;if(i>0)throw new Error("cycle");return u}n.id=function(t){return arguments.length?(e=Pj(t),n):e};n.parentId=function(e){return arguments.length?(t=Pj(e),n):t};return n}function Zj(e,t){return e.parent===t.parent?1:2}function Kj(e){var t=e.children;return t?t[0]:e.t}function eB(e){var t=e.children;return t?t[t.length-1]:e.t}function tB(e,t,n){var r=n/(t.i-e.i);t.c-=r;t.s+=n;e.c+=r;t.z+=n;t.m+=n}function nB(e){var t=0,n=0,r=e.children,i=r.length,a;while(--i>=0){a=r[i];a.z+=t;a.m+=t;t+=a.s+(n+=a.c)}}function rB(e,t,n){return e.a.parent===t.parent?e.a:n}function iB(e,t){this._=e;this.parent=null;this.children=null;this.A=null;this.a=this;this.z=0;this.m=0;this.c=0;this.s=0;this.t=null;this.i=t}iB.prototype=Object.create(yj.prototype);function aB(e){var t=new iB(e,0),n,r=[t],i,a,o,u;while(n=r.pop()){if(a=n._.children){n.children=new Array(u=a.length);for(o=u-1;o>=0;--o){r.push(i=n.children[o]=new iB(a[o],o));i.parent=n}}}(t.parent=new iB(null,0)).children=[t];return t}function oB(){var e=Zj,t=1,n=1,r=null;function i(i){var u=aB(i);u.eachAfter(a),u.parent.m=-u.z;u.eachBefore(o);if(r)i.eachBefore(s);else{var l=i,f=i,c=i;i.eachBefore((function(e){if(e.x<l.x)l=e;if(e.x>f.x)f=e;if(e.depth>c.depth)c=e}));var d=l===f?1:e(l,f)/2,h=d-l.x,v=t/(f.x+d+h),p=n/(c.depth||1);i.eachBefore((function(e){e.x=(e.x+h)*v;e.y=e.depth*p}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){nB(t);var a=(n[0].z+n[n.length-1].z)/2;if(i){t.z=i.z+e(t._,i._);t.m=t.z-a}else{t.z=a}}else if(i){t.z=i.z+e(t._,i._)}t.parent.A=u(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m;e.m+=e.parent.m}function u(t,n,r){if(n){var i=t,a=t,o=n,u=i.parent.children[0],s=i.m,l=a.m,f=o.m,c=u.m,d;while(o=eB(o),i=Kj(i),o&&i){u=Kj(u);a=eB(a);a.a=t;d=o.z+f-i.z-s+e(o._,i._);if(d>0){tB(rB(o,t,r),t,d);s+=d;l+=d}f+=o.m;s+=i.m;c+=u.m;l+=a.m}if(o&&!eB(a)){a.t=o;a.m+=f-l}if(i&&!Kj(u)){u.t=i;u.m+=s-c;r=t}}return r}function s(e){e.x*=t;e.y=e.depth*n}i.separation=function(t){return arguments.length?(e=t,i):e};i.size=function(e){return arguments.length?(r=false,t=+e[0],n=+e[1],i):r?null:[t,n]};i.nodeSize=function(e){return arguments.length?(r=true,t=+e[0],n=+e[1],i):r?[t,n]:null};return i}function uB(e,t,n,r,i){var a=e.children,o,u=-1,s=a.length,l=e.value&&(i-n)/e.value;while(++u<s){o=a[u],o.x0=t,o.x1=r;o.y0=n,o.y1=n+=o.value*l}}var sB=(1+Math.sqrt(5))/2;function lB(e,t,n,r,i,a){var o=[],u=t.children,s,l,f=0,c=0,d=u.length,h,v,p=t.value,g,m,y,_,b,x,w;while(f<d){h=i-n,v=a-r;do{g=u[c++].value}while(!g&&c<d);m=y=g;x=Math.max(v/h,h/v)/(p*e);w=g*g*x;b=Math.max(y/w,w/m);for(;c<d;++c){g+=l=u[c].value;if(l<m)m=l;if(l>y)y=l;w=g*g*x;_=Math.max(y/w,w/m);if(_>b){g-=l;break}b=_}o.push(s={value:g,dice:h<v,children:u.slice(f,c)});if(s.dice)Gj(s,n,r,i,p?r+=v*g/p:a);else uB(s,n,r,p?n+=h*g/p:i,a);p-=g,f=c}return o}var fB=function e(t){function n(e,n,r,i,a){lB(t,e,n,r,i,a)}n.ratio=function(t){return e((t=+t)>1?t:1)};return n}(sB);function cB(){var e=fB,t=false,n=1,r=1,i=[0],a=Lj,o=Lj,u=Lj,s=Lj,l=Lj;function f(e){e.x0=e.y0=0;e.x1=n;e.y1=r;e.eachBefore(c);i=[0];if(t)e.eachBefore(Hj);return e}function c(t){var n=i[t.depth],r=t.x0+n,f=t.y0+n,c=t.x1-n,d=t.y1-n;if(c<r)r=c=(r+c)/2;if(d<f)f=d=(f+d)/2;t.x0=r;t.y0=f;t.x1=c;t.y1=d;if(t.children){n=i[t.depth+1]=a(t)/2;r+=l(t)-n;f+=o(t)-n;c-=u(t)-n;d-=s(t)-n;if(c<r)r=c=(r+c)/2;if(d<f)f=d=(f+d)/2;e(t,r,f,c,d)}}f.round=function(e){return arguments.length?(t=!!e,f):t};f.size=function(e){return arguments.length?(n=+e[0],r=+e[1],f):[n,r]};f.tile=function(t){return arguments.length?(e=Pj(t),f):e};f.padding=function(e){return arguments.length?f.paddingInner(e).paddingOuter(e):f.paddingInner()};f.paddingInner=function(e){return arguments.length?(a=typeof e==="function"?e:jj(+e),f):a};f.paddingOuter=function(e){return arguments.length?f.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):f.paddingTop()};f.paddingTop=function(e){return arguments.length?(o=typeof e==="function"?e:jj(+e),f):o};f.paddingRight=function(e){return arguments.length?(u=typeof e==="function"?e:jj(+e),f):u};f.paddingBottom=function(e){return arguments.length?(s=typeof e==="function"?e:jj(+e),f):s};f.paddingLeft=function(e){return arguments.length?(l=typeof e==="function"?e:jj(+e),f):l};return f}function dB(e,t,n,r,i){var a=e.children,o,u=a.length,s,l=new Array(u+1);for(l[0]=s=o=0;o<u;++o){l[o+1]=s+=a[o].value}f(0,u,e.value,t,n,r,i);function f(e,t,n,r,i,o,u){if(e>=t-1){var s=a[e];s.x0=r,s.y0=i;s.x1=o,s.y1=u;return}var c=l[e],d=n/2+c,h=e+1,v=t-1;while(h<v){var p=h+v>>>1;if(l[p]<d)h=p+1;else v=p}if(d-l[h-1]<l[h]-d&&e+1<h)--h;var g=l[h]-c,m=n-g;if(o-r>u-i){var y=n?(r*m+o*g)/n:o;f(e,h,g,r,i,y,u);f(h,t,m,y,i,o,u)}else{var _=n?(i*m+u*g)/n:u;f(e,h,g,r,i,o,_);f(h,t,m,r,_,o,u)}}}function hB(e,t,n,r,i){(e.depth&1?uB:Gj)(e,t,n,r,i)}var vB=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t){var o,u,s,l,f=-1,c,d=o.length,h=e.value;while(++f<d){u=o[f],s=u.children;for(l=u.value=0,c=s.length;l<c;++l)u.value+=s[l].value;if(u.dice)Gj(u,n,r,i,h?r+=(a-r)*u.value/h:a);else uB(u,n,r,h?n+=(i-n)*u.value/h:i,a);h-=u.value}}else{e._squarify=o=lB(t,e,n,r,i,a);o.ratio=t}}n.ratio=function(t){return e((t=+t)>1?t:1)};return n}(sB);function pB(e,t,n){var r={};e.each((function(e){var i=e.data;if(n(i))r[t(i)]=e}));e.lookup=r;return e}function gB(e){ad.call(this,null,e)}gB.Definition={type:"Nest",metadata:{treesource:true,changes:true},params:[{name:"keys",type:"field",array:true},{name:"generate",type:"boolean"}]};var mB=function(e){return e.values};Ei(gB,ad,{transform:function(e,t){if(!t.source){_r("Nest transform requires an upstream data source.")}var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;if(!a||r||t.changed()){if(a){a.each((function(e){if(e.children&&Wf(e.data)){i.rem.push(e.data)}}))}this.value=a=dj({values:oi(e.keys).reduce((function(e,t){e.key(t);return e}),yB()).entries(i.source)},mB);if(n){a.each((function(e){if(e.children){e=$f(e.data);i.add.push(e);i.source.push(e)}}))}pB(a,Hf,Hf)}i.source.root=a;return i}});function yB(){var e=[],t={entries:function(e){return r(n(e,0),0)},key:function(n){return e.push(n),t}};function n(t,r){if(r>=e.length){return t}var i=t.length,a=e[r++],o={},u={};var s=-1,l,f,c;while(++s<i){l=a(f=t[s])+"";if(c=o[l]){c.push(f)}else{o[l]=[f]}}for(l in o){u[l]=n(o[l],r)}return u}function r(t,n){if(++n>e.length)return t;var i=[];for(var a in t){i.push({key:a,values:r(t[a],n)})}return i}return t}function _B(e){ad.call(this,null,e)}var bB=function(e,t){return e.parent===t.parent?1:2};Ei(_B,ad,{transform:function(e,t){if(!t.source||!t.source.root){_r(this.constructor.name+" transform requires a backing tree data source.")}var n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;if(e.field)i.sum(e.field);else i.count();if(e.sort)i.sort(Jf(e.sort,(function(e){return e.data})));xB(n,this.params,e);if(n.separation){n.separation(e.separation!==false?bB:Er)}try{this.value=n(i)}catch(o){_r(o)}i.each((function(e){return wB(e,r,a)}));return t.reflow(e.modified()).modifies(a).modifies("leaf")}});function xB(e,t,n){for(var r=void 0,i=0,a=t.length;i<a;++i){r=t[i];if(r in n)e[r](n[r])}}function wB(e,t,n){var r=e.data,i=t.length-1;for(var a=0;a<i;++a){r[n[a]]=e[t[a]]}r[n[i]]=e.children?e.children.length:0}var kB=["x","y","r","depth","children"];function AB(e){_B.call(this,e)}AB.Definition={type:"Pack",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:kB.length,default:kB}]};Ei(AB,_B,{layout:Ij,params:["radius","size","padding"],fields:kB});var EB=["x0","y0","x1","y1","depth","children"];function DB(e){_B.call(this,e)}DB.Definition={type:"Partition",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:EB.length,default:EB}]};Ei(DB,_B,{layout:$j,params:["size","round","padding"],fields:EB});function SB(e){ad.call(this,null,e)}SB.Definition={type:"Stratify",metadata:{treesource:true},params:[{name:"key",type:"field",required:true},{name:"parentKey",type:"field",required:true}]};Ei(SB,ad,{transform:function(e,t){if(!t.source){_r("Stratify transform requires an upstream data source.")}var n=this.value;var r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);i.source=i.source.slice();if(a){n=i.source.length?pB(Qj().id(e.key).parentId(e.parentKey)(i.source),e.key,Dr):pB(Qj()([{}]),e.key,e.key)}i.source.root=this.value=n;return i}});var CB={tidy:oB,cluster:JL};var MB=["x","y","depth","children"];function FB(e){_B.call(this,e)}FB.Definition={type:"Tree",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:true,length:2},{name:"nodeSize",type:"number",array:true,length:2},{name:"separation",type:"boolean",default:true},{name:"as",type:"string",array:true,length:MB.length,default:MB}]};Ei(FB,_B,{layout:function(e){var t=e||"tidy";if(xi(CB,t))return CB[t]();else _r("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:MB});function OB(e){ad.call(this,[],e)}OB.Definition={type:"TreeLinks",metadata:{tree:true,generates:true,changes:true},params:[]};Ei(OB,ad,{transform:function(e,t){var n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};if(!r)_r("TreeLinks transform requires a tree data source.");if(t.changed(t.ADD_REM)){i.rem=n;t.visit(t.SOURCE,(function(e){return a[Hf(e)]=1}));r.each((function(e){var t=e.data,n=e.parent&&e.parent.data;if(n&&a[Hf(t)]&&a[Hf(n)]){i.add.push($f({source:n,target:t}))}}));this.value=i.add}else if(t.changed(t.MOD)){t.visit(t.MOD,(function(e){return a[Hf(e)]=1}));n.forEach((function(e){if(a[Hf(e.source)]||a[Hf(e.target)]){i.mod.push(e)}}))}return i}});var NB={binary:dB,dice:Gj,slice:uB,slicedice:hB,squarify:fB,resquarify:vB};var TB=["x0","y0","x1","y1","depth","children"];function zB(e){_B.call(this,e)}zB.Definition={type:"Treemap",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:TB.length,default:TB}]};Ei(zB,_B,{layout:function(){var e=cB();e.ratio=function(t){var n=e.tile();if(n.ratio)e.tile(n.ratio(t))};e.method=function(t){if(xi(NB,t))e.tile(NB[t]);else _r("Unrecognized Treemap layout method: "+t)};return e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:TB});var RB=Object.freeze({__proto__:null,nest:gB,pack:AB,partition:DB,stratify:SB,tree:FB,treelinks:OB,treemap:zB});var PB=4278190080;var LB=268435456;var jB=.0625;function BB(e,t){var n=e.bitmap();(t||[]).forEach((function(t){return n.set(e(t.boundary[0]),e(t.boundary[3]))}));return[n,undefined]}function IB(e,t,n,r){var i=e.width,a=e.height,o=n||r,u=Fg(i,a).getContext("2d");t.forEach((function(e){return UB(u,e,o)}));var s=new Uint32Array(u.getImageData(0,0,i,a).data.buffer),l=e.bitmap(),f=o&&e.bitmap();var c,d,h,v,p;for(d=0;d<a;++d){for(c=0;c<i;++c){p=s[d*i+c]&PB;if(p){h=e(c);v=e(d);if(!r)l.set(h,v);if(o&&p^LB)f.set(h,v)}}}return[l,f]}function UB(e,t,n){if(!t.length)return;var r=t[0].mark.marktype;if(r==="group"){t.forEach((function(t){t.items.forEach((function(t){return UB(e,t.items,n)}))}))}else{OE[r].draw(e,{items:n?t.map(qB):t})}}function qB(e){var t=Yf(e,{});if(t.stroke){t.strokeOpacity=1}if(t.fill){t.fillOpacity=jB;t.stroke="#000";t.strokeOpacity=1;t.strokeWidth=2}return t}var WB=5,HB=31,GB=32,$B=new Uint32Array(GB+1),VB=new Uint32Array(GB+1);VB[0]=0;$B[0]=~VB[0];for(var YB=1;YB<=GB;++YB){VB[YB]=VB[YB-1]<<1|1;$B[YB]=~VB[YB]}function XB(e,t){var n=new Uint32Array(~~((e*t+GB)/GB));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:function(t,r){var i=r*e+t;return n[i>>>WB]&1<<(i&HB)},set:function(t,n){var i=n*e+t;r(i>>>WB,1<<(i&HB))},clear:function(t,n){var r=n*e+t;i(r>>>WB,~(1<<(r&HB)))},getRange:function(t,r,i,a){var o=a,u,s,l,f;for(;o>=r;--o){u=o*e+t;s=o*e+i;l=u>>>WB;f=s>>>WB;if(l===f){if(n[l]&$B[u&HB]&VB[(s&HB)+1]){return true}}else{if(n[l]&$B[u&HB])return true;if(n[f]&VB[(s&HB)+1])return true;for(var c=l+1;c<f;++c){if(n[c])return true}}}return false},setRange:function(t,n,i,a){var o,u,s,l,f;for(;n<=a;++n){o=n*e+t;u=n*e+i;s=o>>>WB;l=u>>>WB;if(s===l){r(s,$B[o&HB]&VB[(u&HB)+1])}else{r(s,$B[o&HB]);r(l,VB[(u&HB)+1]);for(f=s+1;f<l;++f)r(f,4294967295)}}},clearRange:function(t,n,r,a){var o,u,s,l,f;for(;n<=a;++n){o=n*e+t;u=n*e+r;s=o>>>WB;l=u>>>WB;if(s===l){i(s,VB[o&HB]|$B[(u&HB)+1])}else{i(s,VB[o&HB]);i(l,$B[(u&HB)+1]);for(f=s+1;f<l;++f)i(f,0)}}},outOfBounds:function(n,r,i,a){return n<0||r<0||a>=t||i>=e}}}function JB(e,t,n){var r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=function(e){return~~((e+n)/r)};o.invert=function(e){return e*r-n};o.bitmap=function(){return XB(i,a)};o.ratio=r;o.padding=n;o.width=e;o.height=t;return o}function QB(e,t,n,r){var i=e.width,a=e.height;return function(e){var t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,u=iE.width(e.datum,e.datum.text);var s=0,l,f,c,d,h,v,p;for(var g=0;g<n;++g){l=t[g].x;c=t[g].y;f=t[g].x2===undefined?l:t[g].x2;d=t[g].y2===undefined?c:t[g].y2;h=(l+f)/2;v=(c+d)/2;p=Math.abs(f-l+d-c);if(p>=s){s=p;e.x=h;e.y=v}}h=u/2;v=o/2;l=e.x-h;f=e.x+h;c=e.y-v;d=e.y+v;e.align="center";if(l<0&&f<=i){e.align="left"}else if(0<=l&&i<f){e.align="right"}e.baseline="middle";if(c<0&&d<=a){e.baseline="top"}else if(0<=c&&a<d){e.baseline="bottom"}return true}}function ZB(e,t,n,r,i,a){var o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function KB(e,t,n,r,i,a,o,u){var s=i*a/(r*2),l=e(t-s),f=e(t+s),c=e(n-(a=a/2)),d=e(n+a);return o.outOfBounds(l,c,f,d)||o.getRange(l,c,f,d)||u&&u.getRange(l,c,f,d)}function eI(e,t,n,r){var i=e.width,a=e.height,o=t[0],u=t[1];function s(t,n,r,s,l){var f=e.invert(t),c=e.invert(n);var d=r,h=a,v;if(!ZB(f,c,s,l,i,a)&&!KB(e,f,c,l,s,d,o,u)&&!KB(e,f,c,l,s,l,o,null)){while(h-d>=1){v=(d+h)/2;if(KB(e,f,c,l,s,v,o,u)){h=v}else{d=v}}if(d>r){return[f,c,d,true]}}}return function(t){var u=t.datum.datum.items[r].items,l=u.length,f=t.datum.fontSize,c=iE.width(t.datum,t.datum.text);var d=n?f:0,h=false,v=false,p=0,g,m,y,_,b,x,w,k,A,E,D,S,C,M,F,O,N;for(var T=0;T<l;++T){g=u[T].x;y=u[T].y;m=u[T].x2===undefined?g:u[T].x2;_=u[T].y2===undefined?y:u[T].y2;if(g>m){N=g;g=m;m=N}if(y>_){N=y;y=_;_=N}A=e(g);D=e(m);E=~~((A+D)/2);S=e(y);M=e(_);C=~~((S+M)/2);for(w=E;w>=A;--w){for(k=C;k>=S;--k){O=s(w,k,d,c,f);if(O){t.x=O[0],t.y=O[1],d=O[2],h=O[3]}}}for(w=E;w<=D;++w){for(k=C;k<=M;++k){O=s(w,k,d,c,f);if(O){t.x=O[0],t.y=O[1],d=O[2],h=O[3]}}}if(!h&&!n){F=Math.abs(m-g+_-y);b=(g+m)/2;x=(y+_)/2;if(F>=p&&!ZB(b,x,c,f,i,a)&&!KB(e,b,x,f,c,f,o,null)){p=F;t.x=b;t.y=x;v=true}}}if(h||v){b=c/2;x=f/2;o.setRange(e(t.x-b),e(t.y-x),e(t.x+b),e(t.y+x));t.align="center";t.baseline="middle";return true}else{return false}}}var tI=[-1,-1,1,1];var nI=[-1,1,-1,1];function rI(e,t,n,r){var i=e.width,a=e.height,o=t[0],u=t[1],s=e.bitmap();return function(t){var l;var f=t.datum.datum.items[r].items,c=f.length,d=t.datum.fontSize,h=iE.width(t.datum,t.datum.text),v=[];var p=n?d:0,g=false,m=false,y=0,_,b,x,w,k,A,E,D,S,C,M,F;for(var O=0;O<c;++O){_=f[O].x;x=f[O].y;b=f[O].x2===undefined?_:f[O].x2;w=f[O].y2===undefined?x:f[O].y2;v.push([e((_+b)/2),e((x+w)/2)]);while(v.length){l=v.pop(),E=l[0],D=l[1];if(o.get(E,D)||u.get(E,D)||s.get(E,D))continue;s.set(E,D);for(var N=0;N<4;++N){k=E+tI[N];A=D+nI[N];if(!s.outOfBounds(k,A,k,A))v.push([k,A])}k=e.invert(E);A=e.invert(D);S=p;C=a;if(!ZB(k,A,h,d,i,a)&&!KB(e,k,A,d,h,S,o,u)&&!KB(e,k,A,d,h,d,o,null)){while(C-S>=1){M=(S+C)/2;if(KB(e,k,A,d,h,M,o,u)){C=M}else{S=M}}if(S>p){t.x=k;t.y=A;p=S;g=true}}}if(!g&&!n){F=Math.abs(b-_+w-x);k=(_+b)/2;A=(x+w)/2;if(F>=y&&!ZB(k,A,h,d,i,a)&&!KB(e,k,A,d,h,d,o,null)){y=F;t.x=k;t.y=A;m=true}}}if(g||m){k=h/2;A=d/2;o.setRange(e(t.x-k),e(t.y-A),e(t.x+k),e(t.y+A));t.align="center";t.baseline="middle";return true}else{return false}}}var iI=["right","center","left"],aI=["bottom","middle","top"];function oI(e,t,n,r){var i=e.width,a=e.height,o=t[0],u=t[1],s=r.length;return function(t){var l=t.boundary,f=t.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>i||l[3]>a){return false}var c=0,d,h,v,p,g,m,y,_,b,x,w,k,A,E,D;for(var S=0;S<s;++S){d=(n[S]&3)-1;h=(n[S]>>>2&3)-1;v=d===0&&h===0||r[S]<0;p=d&&h?Math.SQRT1_2:1;g=r[S]<0?-1:1;m=l[1+d]+r[S]*d*p;w=l[4+h]+g*f*h/2+r[S]*h*p;_=w-f/2;b=w+f/2;k=e(m);E=e(_);D=e(b);if(!c){if(!uI(k,k,E,D,o,u,m,m,_,b,l,v)){continue}else{c=iE.width(t.datum,t.datum.text)}}x=m+g*c*d/2;m=x-c/2;y=x+c/2;k=e(m);A=e(y);if(uI(k,A,E,D,o,u,m,y,_,b,l,v)){t.x=!d?x:d*g<0?y:m;t.y=!h?w:h*g<0?b:_;t.align=iI[d*g+1];t.baseline=aI[h*g+1];o.setRange(k,E,A,D);return true}}return false}}function uI(e,t,n,r,i,a,o,u,s,l,f,c){return!(i.outOfBounds(e,n,t,r)||(c&&a?a.getRange(e,n,t,r)||!sI(o,s,u,l,f):i.getRange(e,n,t,r)))}function sI(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}var lI=0,fI=4,cI=8,dI=0,hI=1,vI=2;var pI={"top-left":lI+dI,top:lI+hI,"top-right":lI+vI,left:fI+dI,middle:fI+hI,right:fI+vI,"bottom-left":cI+dI,bottom:cI+hI,"bottom-right":cI+vI};var gI={naive:QB,"reduced-search":eI,floodfill:rI};function mI(e,t,n,r,i,a,o,u,s,l,f){if(!e.length)return e;var c=Math.max(r.length,i.length),d=yI(r,c),h=_I(i,c),v=bI(e[0].datum),p=v==="group"&&e[0].datum.items[s].marktype,g=p==="area",m=xI(v,p,u,s),y=JB(t[0],t[1],l),_=g&&f==="naive";var b=e.map((function(e){return{datum:e,opacity:0,x:undefined,y:undefined,align:undefined,baseline:undefined,boundary:m(e)}}));var x;if(!_){if(n){b.sort((function(e,t){return n(e.datum,t.datum)}))}var w=false;for(var k=0;k<h.length&&!w;++k){w=h[k]===5||d[k]<0}if(v&&(o||g)){a=[e.map((function(e){return e.datum}))].concat(a)}x=a.length?IB(y,a,w,g):BB(y,o&&b)}var A=g?gI[f](y,x,o,s):oI(y,x,h,d);b.forEach((function(e){return e.opacity=+A(e)}));return b}function yI(e,t){var n=new Float64Array(t),r=e.length;for(var i=0;i<r;++i)n[i]=e[i]||0;for(var i=r;i<t;++i)n[i]=n[r-1];return n}function _I(e,t){var n=new Int8Array(t),r=e.length;for(var i=0;i<r;++i)n[i]|=pI[e[i]];for(var i=r;i<t;++i)n[i]=n[r-1];return n}function bI(e){return e&&e.mark&&e.mark.marktype}function xI(e,t,n,r){var i=function(e){return[e.x,e.x,e.x,e.y,e.y,e.y]};if(!e){return i}else if(e==="line"||e==="area"){return function(e){return i(e.datum)}}else if(t==="line"){return function(e){var t=e.datum.items[r].items;return i(t.length?t[n==="start"?0:t.length-1]:{x:NaN,y:NaN})}}else{return function(e){var t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}}}var wI=["x","y","opacity","align","baseline"];var kI=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function AI(e){ad.call(this,null,e)}AI.Definition={type:"Label",metadata:{modifies:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:true,default:kI},{name:"offset",type:"number",array:true,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:true},{name:"avoidMarks",type:"data",array:true},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:true,length:wI.length,default:wI}]};Ei(AI,ad,{transform:function(e,t){function n(n){var r=e[n];return si(r)&&t.modified(r.fields)}var r=e.modified();if(!(r||t.changed(t.ADD_REM)||n("sort")))return;if(!e.size||e.size.length!==2){_r("Size parameter should be specified as a [width, height] array.")}var i=e.as||wI;mI(t.materialize(t.SOURCE).source,e.size,e.sort,oi(e.offset||1),oi(e.anchor||kI),e.avoidMarks||[],e.avoidBaseMark===false?false:true,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((function(e){var t=e.datum;t[i[0]]=e.x;t[i[1]]=e.y;t[i[2]]=e.opacity;t[i[3]]=e.align;t[i[4]]=e.baseline}));return t.reflow(r).modifies(i)}});var EI=Object.freeze({__proto__:null,label:AI});function DI(e,t){var n=[],r=function(e){return e(u)},i,a,o,u,s,l;if(t==null){n.push(e)}else{for(i={},a=0,o=e.length;a<o;++a){u=e[a];s=t.map(r);l=i[s];if(!l){i[s]=l=[];l.dims=s;n.push(l)}l.push(u)}}return n}function SI(e){ad.call(this,null,e)}SI.Definition={type:"Loess",metadata:{generates:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:true}]};Ei(SI,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=t.materialize(t.SOURCE).source,i=DI(r,e.groupby),a=(e.groupby||[]).map(vr),o=a.length,u=e.as||[vr(e.x),vr(e.y)],s=[];i.forEach((function(t){nh(t,e.x,e.y,e.bandwidth||.3).forEach((function(e){var n={};for(var r=0;r<o;++r){n[a[r]]=t.dims[r]}n[u[0]]=e[0];n[u[1]]=e[1];s.push($f(n))}))}));if(this.value)n.rem=this.value;this.value=n.add=n.source=s}return n}});var CI={linear:$d,log:Vd,exp:Yd,pow:Xd,quad:Jd,poly:Qd};var MI=function(e,t){return e==="poly"?t:e==="quad"?2:1};function FI(e){ad.call(this,null,e)}FI.Definition={type:"Regression",metadata:{generates:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"method",type:"string",default:"linear",values:Object.keys(CI)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:true,length:2},{name:"params",type:"boolean",default:false},{name:"as",type:"string",array:true}]};Ei(FI,ad,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=t.materialize(t.SOURCE).source,i=DI(r,e.groupby),a=(e.groupby||[]).map(vr),o=e.method||"linear",u=e.order||3,s=MI(o,u),l=e.as||[vr(e.x),vr(e.y)],f=CI[o],c=[];var d=e.extent;if(!xi(CI,o)){_r("Invalid regression method: "+o)}if(d!=null){if(o==="log"&&d[0]<=0){t.dataflow.warn("Ignoring extent with values <= 0 for log regression.");d=null}}i.forEach((function(n){var r=n.length;if(r<=s){t.dataflow.warn("Skipping regression with more parameters than data points.");return}var i=f(n,e.x,e.y,u);if(e.params){c.push($f({keys:n.dims,coef:i.coef,rSquared:i.rSquared}));return}var h=d||yi(n,e.x),v=function(e){var t={};for(var r=0;r<a.length;++r){t[a[r]]=n.dims[r]}t[l[0]]=e[0];t[l[1]]=e[1];c.push($f(t))};if(o==="linear"){h.forEach((function(e){return v([e,i.predict(e)])}))}else{uh(i.predict,h,25,200).forEach(v)}}));if(this.value)n.rem=this.value;this.value=n.add=n.source=c}return n}});var OI=Object.freeze({__proto__:null,loess:SI,regression:FI});var NI=Math.pow(2,-52);var TI=new Uint32Array(512);var zI=function(){function e(e){var t=e.length>>1;if(t>0&&typeof e[0]!=="number")throw new Error("Expected coords to contain numbers.");this.coords=e;var n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3);this._halfedges=new Int32Array(n*3);this._hashSize=Math.ceil(Math.sqrt(t));this._hullPrev=new Uint32Array(t);this._hullNext=new Uint32Array(t);this._hullTri=new Uint32Array(t);this._hullHash=new Int32Array(this._hashSize).fill(-1);this._ids=new Uint32Array(t);this._dists=new Float64Array(t);this.update()}e.from=function(t,n,r){if(n===void 0){n=HI}if(r===void 0){r=GI}var i=t.length;var a=new Float64Array(i*2);for(var o=0;o<i;o++){var u=t[o];a[2*o]=n(u);a[2*o+1]=r(u)}return new e(a)};e.prototype.update=function(){var e=this,t=e.coords,n=e._hullPrev,r=e._hullNext,i=e._hullTri,a=e._hullHash;var o=t.length>>1;var u=Infinity;var s=Infinity;var l=-Infinity;var f=-Infinity;for(var c=0;c<o;c++){var d=t[2*c];var h=t[2*c+1];if(d<u)u=d;if(h<s)s=h;if(d>l)l=d;if(h>f)f=h;this._ids[c]=c}var v=(u+l)/2;var p=(s+f)/2;var g=Infinity;var m,y,_;for(var c=0;c<o;c++){var b=PI(v,p,t[2*c],t[2*c+1]);if(b<g){m=c;g=b}}var x=t[2*m];var w=t[2*m+1];g=Infinity;for(var c=0;c<o;c++){if(c===m)continue;var b=PI(x,w,t[2*c],t[2*c+1]);if(b<g&&b>0){y=c;g=b}}var k=t[2*y];var A=t[2*y+1];var E=Infinity;for(var c=0;c<o;c++){if(c===m||c===y)continue;var D=II(x,w,k,A,t[2*c],t[2*c+1]);if(D<E){_=c;E=D}}var S=t[2*_];var C=t[2*_+1];if(E===Infinity){for(var c=0;c<o;c++){this._dists[c]=t[2*c]-t[0]||t[2*c+1]-t[1]}qI(this._ids,this._dists,0,o-1);var M=new Uint32Array(o);var F=0;for(var c=0,O=-Infinity;c<o;c++){var N=this._ids[c];if(this._dists[N]>O){M[F++]=N;O=this._dists[N]}}this.hull=M.subarray(0,F);this.triangles=new Uint32Array(0);this.halfedges=new Uint32Array(0);return}if(jI(x,w,k,A,S,C)){var c=y;var T=k;var z=A;y=_;k=S;A=C;_=c;S=T;C=z}var R=UI(x,w,k,A,S,C);this._cx=R.x;this._cy=R.y;for(var c=0;c<o;c++){this._dists[c]=PI(t[2*c],t[2*c+1],R.x,R.y)}qI(this._ids,this._dists,0,o-1);this._hullStart=m;var P=3;r[m]=n[_]=y;r[y]=n[m]=_;r[_]=n[y]=m;i[m]=0;i[y]=1;i[_]=2;a.fill(-1);a[this._hashKey(x,w)]=m;a[this._hashKey(k,A)]=y;a[this._hashKey(S,C)]=_;this.trianglesLen=0;this._addTriangle(m,y,_,-1,-1,-1);for(var L=0,j=void 0,B=void 0;L<this._ids.length;L++){var c=this._ids[L];var I=t[2*c];var U=t[2*c+1];if(L>0&&Math.abs(I-j)<=NI&&Math.abs(U-B)<=NI)continue;j=I;B=U;if(c===m||c===y||c===_)continue;var q=0;for(var F=0,W=this._hashKey(I,U);F<this._hashSize;F++){q=a[(W+F)%this._hashSize];if(q!==-1&&q!==r[q])break}q=n[q];var H=q,G=void 0;while(G=r[H],!jI(I,U,t[2*H],t[2*H+1],t[2*G],t[2*G+1])){H=G;if(H===q){H=-1;break}}if(H===-1)continue;var $=this._addTriangle(H,c,r[H],-1,-1,i[H]);i[c]=this._legalize($+2);i[H]=$;P++;var V=r[H];while(G=r[V],jI(I,U,t[2*V],t[2*V+1],t[2*G],t[2*G+1])){$=this._addTriangle(V,c,G,i[c],-1,i[V]);i[c]=this._legalize($+2);r[V]=V;P--;V=G}if(H===q){while(G=n[H],jI(I,U,t[2*G],t[2*G+1],t[2*H],t[2*H+1])){$=this._addTriangle(G,c,H,-1,i[H],i[G]);this._legalize($+2);i[G]=$;r[H]=H;P--;H=G}}this._hullStart=n[c]=H;r[H]=n[V]=c;r[c]=V;a[this._hashKey(I,U)]=c;a[this._hashKey(t[2*H],t[2*H+1])]=H}this.hull=new Uint32Array(P);for(var c=0,Y=this._hullStart;c<P;c++){this.hull[c]=Y;Y=r[Y]}this.triangles=this._triangles.subarray(0,this.trianglesLen);this.halfedges=this._halfedges.subarray(0,this.trianglesLen)};e.prototype._hashKey=function(e,t){return Math.floor(RI(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize};e.prototype._legalize=function(e){var t=this,n=t._triangles,r=t._halfedges,i=t.coords;var a=0;var o=0;while(true){var u=r[e];var s=e-e%3;o=s+(e+2)%3;if(u===-1){if(a===0)break;e=TI[--a];continue}var l=u-u%3;var f=s+(e+1)%3;var c=l+(u+2)%3;var d=n[o];var h=n[e];var v=n[f];var p=n[c];var g=BI(i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*v],i[2*v+1],i[2*p],i[2*p+1]);if(g){n[e]=p;n[u]=d;var m=r[c];if(m===-1){var y=this._hullStart;do{if(this._hullTri[y]===c){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,m);this._link(u,r[o]);this._link(o,c);var _=l+(u+1)%3;if(a<TI.length){TI[a++]=_}}else{if(a===0)break;e=TI[--a]}}return o};e.prototype._link=function(e,t){this._halfedges[e]=t;if(t!==-1)this._halfedges[t]=e};e.prototype._addTriangle=function(e,t,n,r,i,a){var o=this.trianglesLen;this._triangles[o]=e;this._triangles[o+1]=t;this._triangles[o+2]=n;this._link(o,r);this._link(o+1,i);this._link(o+2,a);this.trianglesLen+=3;return o};return e}();function RI(e,t){var n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function PI(e,t,n,r){var i=e-n;var a=t-r;return i*i+a*a}function LI(e,t,n,r,i,a){var o=(r-t)*(i-e);var u=(n-e)*(a-t);return Math.abs(o-u)>=33306690738754716e-32*Math.abs(o+u)?o-u:0}function jI(e,t,n,r,i,a){var o=LI(i,a,e,t,n,r)||LI(e,t,n,r,i,a)||LI(n,r,i,a,e,t);return o<0}function BI(e,t,n,r,i,a,o,u){var s=e-o;var l=t-u;var f=n-o;var c=r-u;var d=i-o;var h=a-u;var v=s*s+l*l;var p=f*f+c*c;var g=d*d+h*h;return s*(c*g-p*h)-l*(f*g-p*d)+v*(f*h-c*d)<0}function II(e,t,n,r,i,a){var o=n-e;var u=r-t;var s=i-e;var l=a-t;var f=o*o+u*u;var c=s*s+l*l;var d=.5/(o*l-u*s);var h=(l*f-u*c)*d;var v=(o*c-s*f)*d;return h*h+v*v}function UI(e,t,n,r,i,a){var o=n-e;var u=r-t;var s=i-e;var l=a-t;var f=o*o+u*u;var c=s*s+l*l;var d=.5/(o*l-u*s);var h=e+(l*f-u*c)*d;var v=t+(o*c-s*f)*d;return{x:h,y:v}}function qI(e,t,n,r){if(r-n<=20){for(var i=n+1;i<=r;i++){var a=e[i];var o=t[a];var u=i-1;while(u>=n&&t[e[u]]>o)e[u+1]=e[u--];e[u+1]=a}}else{var s=n+r>>1;var i=n+1;var u=r;WI(e,s,i);if(t[e[n]]>t[e[r]])WI(e,n,r);if(t[e[i]]>t[e[r]])WI(e,i,r);if(t[e[n]]>t[e[i]])WI(e,n,i);var l=e[i];var o=t[l];while(true){do{i++}while(t[e[i]]<o);do{u--}while(t[e[u]]>o);if(u<i)break;WI(e,i,u)}e[n+1]=e[u];e[u]=l;if(r-i+1>=u-n){qI(e,t,i,r);qI(e,t,n,u-1)}else{qI(e,t,n,u-1);qI(e,t,i,r)}}}function WI(e,t,n){var r=e[t];e[t]=e[n];e[n]=r}function HI(e){return e[0]}function GI(e){return e[1]}var $I=1e-6;var VI=function(){function e(){this._x0=this._y0=this._x1=this._y1=null;this._=""}e.prototype.moveTo=function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)};e.prototype.closePath=function(){if(this._x1!==null){this._x1=this._x0,this._y1=this._y0;this._+="Z"}};e.prototype.lineTo=function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)};e.prototype.arc=function(e,t,n){e=+e,t=+t,n=+n;var r=e+n;var i=t;if(n<0)throw new Error("negative radius");if(this._x1===null)this._+="M"+r+","+i;else if(Math.abs(this._x1-r)>$I||Math.abs(this._y1-i)>$I)this._+="L"+r+","+i;if(!n)return;this._+="A"+n+","+n+",0,1,1,"+(e-n)+","+t+"A"+n+","+n+",0,1,1,"+(this._x1=r)+","+(this._y1=i)};e.prototype.rect=function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"};e.prototype.value=function(){return this._||null};return e}();var YI=function(){function e(){this._=[]}e.prototype.moveTo=function(e,t){this._.push([e,t])};e.prototype.closePath=function(){this._.push(this._[0].slice())};e.prototype.lineTo=function(e,t){this._.push([e,t])};e.prototype.value=function(){return this._.length?this._:null};return e}();var XI=function(){function e(e,t){var n=t===void 0?[0,0,960,500]:t,r=n[0],i=n[1],a=n[2],o=n[3];if(!((a=+a)>=(r=+r))||!((o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e;this._circumcenters=new Float64Array(e.points.length*2);this.vectors=new Float64Array(e.points.length*2);this.xmax=a,this.xmin=r;this.ymax=o,this.ymin=i;this._init()}e.prototype.update=function(){this.delaunay.update();this._init();return this};e.prototype._init=function(){var e=this,t=e.delaunay,n=t.points,r=t.hull,i=t.triangles,a=e.vectors;var o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(var u=0,s=0,l=i.length,f,c;u<l;u+=3,s+=2){var d=i[u]*2;var h=i[u+1]*2;var v=i[u+2]*2;var p=n[d];var g=n[d+1];var m=n[h];var y=n[h+1];var _=n[v];var b=n[v+1];var x=m-p;var w=y-g;var k=_-p;var A=b-g;var E=x*x+w*w;var D=k*k+A*A;var S=(x*A-w*k)*2;if(!S){f=(p+_)/2-1e8*A;c=(g+b)/2+1e8*k}else if(Math.abs(S)<1e-8){f=(p+_)/2;c=(g+b)/2}else{var C=1/S;f=p+(A*E-w*D)*C;c=g+(x*D-k*E)*C}o[s]=f;o[s+1]=c}var M=r[r.length-1];var F,O=M*4;var N,T=n[2*M];var z,R=n[2*M+1];a.fill(0);for(var u=0;u<r.length;++u){M=r[u];F=O,N=T,z=R;O=M*4,T=n[2*M],R=n[2*M+1];a[F+2]=a[O]=z-R;a[F+3]=a[O+1]=T-N}};e.prototype.render=function(e){var t=e==null?e=new VI:undefined;var n=this,r=n.delaunay,i=r.halfedges,a=r.inedges,o=r.hull,u=n.circumcenters,s=n.vectors;if(o.length<=1)return null;for(var l=0,f=i.length;l<f;++l){var c=i[l];if(c<l)continue;var d=Math.floor(l/3)*2;var h=Math.floor(c/3)*2;var v=u[d];var p=u[d+1];var g=u[h];var m=u[h+1];this._renderSegment(v,p,g,m,e)}var y,_=o[o.length-1];for(var l=0;l<o.length;++l){y=_,_=o[l];var b=Math.floor(a[_]/3)*2;var x=u[b];var w=u[b+1];var k=y*4;var A=this._project(x,w,s[k+2],s[k+3]);if(A)this._renderSegment(x,w,A[0],A[1],e)}return t&&t.value()};e.prototype.renderBounds=function(e){var t=e==null?e=new VI:undefined;e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin);return t&&t.value()};e.prototype.renderCell=function(e,t){var n=t==null?t=new VI:undefined;var r=this._clip(e);if(r===null||!r.length)return;t.moveTo(r[0],r[1]);var i=r.length;while(r[0]===r[i-2]&&r[1]===r[i-1]&&i>1)i-=2;for(var a=2;a<i;a+=2){if(r[a]!==r[a-2]||r[a+1]!==r[a-1])t.lineTo(r[a],r[a+1])}t.closePath();return n&&n.value()};e.prototype.cellPolygons=function(){var e,t,n,r;return __generator(this,(function(i){switch(i.label){case 0:e=this.delaunay.points;t=0,n=e.length/2;i.label=1;case 1:if(!(t<n))return[3,4];r=this.cellPolygon(t);if(!r)return[3,3];r.index=t;return[4,r];case 2:i.sent();i.label=3;case 3:++t;return[3,1];case 4:return[2]}}))};e.prototype.cellPolygon=function(e){var t=new YI;this.renderCell(e,t);return t.value()};e.prototype._renderSegment=function(e,t,n,r,i){var a;var o=this._regioncode(e,t);var u=this._regioncode(n,r);if(o===0&&u===0){i.moveTo(e,t);i.lineTo(n,r)}else if(a=this._clipSegment(e,t,n,r,o,u)){i.moveTo(a[0],a[1]);i.lineTo(a[2],a[3])}};e.prototype.contains=function(e,t,n){if((t=+t,t!==t)||(n=+n,n!==n))return false;return this.delaunay._step(e,t,n)===e};e.prototype.neighbors=function(e){var t,n,r,i,a,o,u,s,l;return __generator(this,(function(f){switch(f.label){case 0:t=this._clip(e);if(!t)return[3,8];n=0,r=this.delaunay.neighbors(e);f.label=1;case 1:if(!(n<r.length))return[3,8];i=r[n];a=this._clip(i);if(!a)return[3,7];o=0,u=t.length;f.label=2;case 2:if(!(o<u))return[3,7];s=0,l=a.length;f.label=3;case 3:if(!(s<l))return[3,6];if(!(t[o]==a[s]&&t[o+1]==a[s+1]&&t[(o+2)%u]==a[(s+l-2)%l]&&t[(o+3)%u]==a[(s+l-1)%l]))return[3,5];return[4,i];case 4:f.sent();return[3,7];case 5:s+=2;return[3,3];case 6:o+=2;return[3,2];case 7:n++;return[3,1];case 8:return[2]}}))};e.prototype._cell=function(e){var t=this,n=t.circumcenters,r=t.delaunay,i=r.inedges,a=r.halfedges,o=r.triangles;var u=i[e];if(u===-1)return null;var s=[];var l=u;do{var f=Math.floor(l/3);s.push(n[f*2],n[f*2+1]);l=l%3===2?l-2:l+1;if(o[l]!==e)break;l=a[l]}while(l!==u&&l!==-1);return s};e.prototype._clip=function(e){if(e===0&&this.delaunay.hull.length===1){return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin]}var t=this._cell(e);if(t===null)return null;var n=this.vectors;var r=e*4;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)};e.prototype._clipFinite=function(e,t){var n=t.length;var r=null;var i,a,o=t[n-2],u=t[n-1];var s,l=this._regioncode(o,u);var f,c;for(var d=0;d<n;d+=2){i=o,a=u,o=t[d],u=t[d+1];s=l,l=this._regioncode(o,u);if(s===0&&l===0){f=c,c=0;if(r)r.push(o,u);else r=[o,u]}else{var h=void 0,v=void 0,p=void 0,g=void 0,m=void 0;if(s===0){if((h=this._clipSegment(i,a,o,u,s,l))===null)continue;v=h[0],p=h[1],g=h[2],m=h[3]}else{if((h=this._clipSegment(o,u,i,a,l,s))===null)continue;g=h[0],m=h[1],v=h[2],p=h[3];f=c,c=this._edgecode(v,p);if(f&&c)this._edge(e,f,c,r,r.length);if(r)r.push(v,p);else r=[v,p]}f=c,c=this._edgecode(g,m);if(f&&c)this._edge(e,f,c,r,r.length);if(r)r.push(g,m);else r=[g,m]}}if(r){f=c,c=this._edgecode(r[0],r[1]);if(f&&c)this._edge(e,f,c,r,r.length)}else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)){return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin]}return r};e.prototype._clipSegment=function(e,t,n,r,i,a){while(true){if(i===0&&a===0)return[e,t,n,r];if(i&a)return null;var o=void 0,u=void 0,s=i||a;if(s&8)o=e+(n-e)*(this.ymax-t)/(r-t),u=this.ymax;else if(s&4)o=e+(n-e)*(this.ymin-t)/(r-t),u=this.ymin;else if(s&2)u=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax;else u=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin;if(i)e=o,t=u,i=this._regioncode(e,t);else n=o,r=u,a=this._regioncode(n,r)}};e.prototype._clipInfinite=function(e,t,n,r,i,a){var o=Array.from(t),u;if(u=this._project(o[0],o[1],n,r))o.unshift(u[0],u[1]);if(u=this._project(o[o.length-2],o[o.length-1],i,a))o.push(u[0],u[1]);if(o=this._clipFinite(e,o)){for(var s=0,l=o.length,f=void 0,c=this._edgecode(o[l-2],o[l-1]);s<l;s+=2){f=c,c=this._edgecode(o[s],o[s+1]);if(f&&c)s=this._edge(e,f,c,o,s),l=o.length}}else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)){o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]}return o};e.prototype._edge=function(e,t,n,r,i){while(t!==n){var a=void 0,o=void 0;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin;break}if((r[i]!==a||r[i+1]!==o)&&this.contains(e,a,o)){r.splice(i,0,a,o),i+=2}}if(r.length>4){for(var u=0;u<r.length;u+=2){var s=(u+2)%r.length,l=(u+4)%r.length;if(r[u]===r[s]&&r[s]===r[l]||r[u+1]===r[s+1]&&r[s+1]===r[l+1])r.splice(s,2),u-=2}}return i};e.prototype._project=function(e,t,n,r){var i=Infinity,a,o,u;if(r<0){if(t<=this.ymin)return null;if((a=(this.ymin-t)/r)<i)u=this.ymin,o=e+(i=a)*n}else if(r>0){if(t>=this.ymax)return null;if((a=(this.ymax-t)/r)<i)u=this.ymax,o=e+(i=a)*n}if(n>0){if(e>=this.xmax)return null;if((a=(this.xmax-e)/n)<i)o=this.xmax,u=t+(i=a)*r}else if(n<0){if(e<=this.xmin)return null;if((a=(this.xmin-e)/n)<i)o=this.xmin,u=t+(i=a)*r}return[o,u]};e.prototype._edgecode=function(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)};e.prototype._regioncode=function(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)};return e}();var JI=2*Math.PI,QI=Math.pow;function ZI(e){return e[0]}function KI(e){return e[1]}function eU(e){var t=e.triangles,n=e.coords;for(var r=0;r<t.length;r+=3){var i=2*t[r],a=2*t[r+1],o=2*t[r+2],u=(n[o]-n[i])*(n[a+1]-n[i+1])-(n[a]-n[i])*(n[o+1]-n[i+1]);if(u>1e-10)return false}return true}function tU(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}var nU=function(){function e(e){this._delaunator=new zI(e);this.inedges=new Int32Array(e.length/2);this._hullIndex=new Int32Array(e.length/2);this.points=this._delaunator.coords;this._init()}e.from=function(t,n,r,i){if(n===void 0){n=ZI}if(r===void 0){r=KI}return new e("length"in t?rU(t,n,r,i):Float64Array.from(iU(t,n,r,i)))};e.prototype.update=function(){this._delaunator.update();this._init();return this};e.prototype._init=function(){var e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&eU(e)){this.collinear=Int32Array.from({length:t.length/2},(function(e,t){return t})).sort((function(e,n){return t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]}));var n=this.collinear[0],r=this.collinear[this.collinear.length-1],i=[t[2*n],t[2*n+1],t[2*r],t[2*r+1]],a=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(var o=0,u=t.length/2;o<u;++o){var s=tU(t[2*o],t[2*o+1],a);t[2*o]=s[0];t[2*o+1]=s[1]}this._delaunator=new zI(t)}else{delete this.collinear}var l=this.halfedges=this._delaunator.halfedges;var f=this.hull=this._delaunator.hull;var c=this.triangles=this._delaunator.triangles;var d=this.inedges.fill(-1);var h=this._hullIndex.fill(-1);for(var v=0,u=l.length;v<u;++v){var s=c[v%3===2?v-2:v+1];if(l[v]===-1||d[s]===-1)d[s]=v}for(var o=0,u=f.length;o<u;++o){h[f[o]]=o}if(f.length<=2&&f.length>0){this.triangles=new Int32Array(3).fill(-1);this.halfedges=new Int32Array(3).fill(-1);this.triangles[0]=f[0];this.triangles[1]=f[1];this.triangles[2]=f[1];d[f[0]]=1;if(f.length===2)d[f[1]]=0}};e.prototype.voronoi=function(e){return new XI(this,e)};e.prototype.neighbors=function(e){var t,n,r,i,a,o,u,s,l,f,c,d;return __generator(this,(function(h){switch(h.label){case 0:t=this,n=t.inedges,r=t.hull,i=t._hullIndex,a=t.halfedges,o=t.triangles,u=t.collinear;if(!u)return[3,5];s=u.indexOf(e);if(!(s>0))return[3,2];return[4,u[s-1]];case 1:h.sent();h.label=2;case 2:if(!(s<u.length-1))return[3,4];return[4,u[s+1]];case 3:h.sent();h.label=4;case 4:return[2];case 5:l=n[e];if(l===-1)return[2];f=l,c=-1;h.label=6;case 6:return[4,c=o[f]];case 7:h.sent();f=f%3===2?f-2:f+1;if(o[f]!==e)return[2];f=a[f];if(!(f===-1))return[3,10];d=r[(i[e]+1)%r.length];if(!(d!==c))return[3,9];return[4,d];case 8:h.sent();h.label=9;case 9:return[2];case 10:if(f!==l)return[3,6];h.label=11;case 11:return[2]}}))};e.prototype.find=function(e,t,n){if(n===void 0){n=0}if((e=+e,e!==e)||(t=+t,t!==t))return-1;var r=n;var i;while((i=this._step(n,e,t))>=0&&i!==n&&i!==r)n=i;return i};e.prototype._step=function(e,t,n){var r=this,i=r.inedges,a=r.hull,o=r._hullIndex,u=r.halfedges,s=r.triangles,l=r.points;if(i[e]===-1||!l.length)return(e+1)%(l.length>>1);var f=e;var c=QI(t-l[e*2],2)+QI(n-l[e*2+1],2);var d=i[e];var h=d;do{var v=s[h];var p=QI(t-l[v*2],2)+QI(n-l[v*2+1],2);if(p<c)c=p,f=v;h=h%3===2?h-2:h+1;if(s[h]!==e)break;h=u[h];if(h===-1){h=a[(o[e]+1)%a.length];if(h!==v){if(QI(t-l[h*2],2)+QI(n-l[h*2+1],2)<c)return h}break}}while(h!==d);return f};e.prototype.render=function(e){var t=e==null?e=new VI:undefined;var n=this,r=n.points,i=n.halfedges,a=n.triangles;for(var o=0,u=i.length;o<u;++o){var s=i[o];if(s<o)continue;var l=a[o]*2;var f=a[s]*2;e.moveTo(r[l],r[l+1]);e.lineTo(r[f],r[f+1])}this.renderHull(e);return t&&t.value()};e.prototype.renderPoints=function(e,t){if(t===void 0){t=2}var n=e==null?e=new VI:undefined;var r=this.points;for(var i=0,a=r.length;i<a;i+=2){var o=r[i],u=r[i+1];e.moveTo(o+t,u);e.arc(o,u,t,0,JI)}return n&&n.value()};e.prototype.renderHull=function(e){var t=e==null?e=new VI:undefined;var n=this,r=n.hull,i=n.points;var a=r[0]*2,o=r.length;e.moveTo(i[a],i[a+1]);for(var u=1;u<o;++u){var s=2*r[u];e.lineTo(i[s],i[s+1])}e.closePath();return t&&t.value()};e.prototype.hullPolygon=function(){var e=new YI;this.renderHull(e);return e.value()};e.prototype.renderTriangle=function(e,t){var n=t==null?t=new VI:undefined;var r=this,i=r.points,a=r.triangles;var o=a[e*=3]*2;var u=a[e+1]*2;var s=a[e+2]*2;t.moveTo(i[o],i[o+1]);t.lineTo(i[u],i[u+1]);t.lineTo(i[s],i[s+1]);t.closePath();return n&&n.value()};e.prototype.trianglePolygons=function(){var e,t,n;return __generator(this,(function(r){switch(r.label){case 0:e=this.triangles;t=0,n=e.length/3;r.label=1;case 1:if(!(t<n))return[3,4];return[4,this.trianglePolygon(t)];case 2:r.sent();r.label=3;case 3:++t;return[3,1];case 4:return[2]}}))};e.prototype.trianglePolygon=function(e){var t=new YI;this.renderTriangle(e,t);return t.value()};return e}();function rU(e,t,n,r){var i=e.length;var a=new Float64Array(i*2);for(var o=0;o<i;++o){var u=e[o];a[o*2]=t.call(r,u,o,e);a[o*2+1]=n.call(r,u,o,e)}return a}function iU(e,t,n,r){var i,a,o,u;return __generator(this,(function(s){switch(s.label){case 0:i=0;a=0,o=e;s.label=1;case 1:if(!(a<o.length))return[3,5];u=o[a];return[4,t.call(r,u,i,e)];case 2:s.sent();return[4,n.call(r,u,i,e)];case 3:s.sent();++i;s.label=4;case 4:a++;return[3,1];case 5:return[2]}}))}function aU(e){ad.call(this,null,e)}aU.Definition={type:"Voronoi",metadata:{modifies:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"size",type:"number",array:true,length:2},{name:"extent",type:"array",array:true,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:true,length:2}},{name:"as",type:"string",default:"path"}]};var oU=[-1e5,-1e5,1e5,1e5];Ei(aU,ad,{transform:function(e,t){var n=e.as||"path",r=t.source;if(!r||!r.length)return t;var i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:oU;var a=this.value=nU.from(r,e.x,e.y).voronoi(i);for(var o=0,u=r.length;o<u;++o){var s=a.cellPolygon(o);r[o][n]=s?uU(s):null}return t.reflow(e.modified()).modifies(n)}});function uU(e){var t=e[0][0],n=e[0][1];var r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}var sU=Object.freeze({__proto__:null,voronoi:aU});var lU=Math.PI/180,fU=1<<11>>5,cU=1<<11;function dU(){var e=[256,256],t,n,r,i,a,o,u,s=mU,l=[],f=Math.random,c={};c.layout=function(){var s=d(Fg()),c=_U((e[0]>>5)*e[1]),v=null,p=l.length,g=-1,m=[],y=l.map((function(e){return{text:t(e),font:n(e),style:i(e),weight:a(e),rotate:o(e),size:~~(r(e)+1e-14),padding:u(e),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:false,sprite:null,datum:e}})).sort((function(e,t){return t.size-e.size}));while(++g<p){var _=y[g];_.x=e[0]*(f()+.5)>>1;_.y=e[1]*(f()+.5)>>1;hU(s,_,y,g);if(_.hasText&&h(c,_,v)){m.push(_);if(v)pU(v,_);else v=[{x:_.x+_.x0,y:_.y+_.y0},{x:_.x+_.x1,y:_.y+_.y1}];_.x-=e[0]>>1;_.y-=e[1]>>1}}return m};function d(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=(fU<<5)/t;e.height=cU/t;var n=e.getContext("2d");n.fillStyle=n.strokeStyle="red";n.textAlign="center";return{context:n,ratio:t}}function h(t,n,r){var i=n.x,a=n.y,o=Math.sqrt(e[0]*e[0]+e[1]*e[1]),u=s(e),l=f()<.5?1:-1,c=-l,d,h,v;while(d=u(c+=l)){h=~~d[0];v=~~d[1];if(Math.min(Math.abs(h),Math.abs(v))>=o)break;n.x=i+h;n.y=a+v;if(n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>e[0]||n.y+n.y1>e[1])continue;if(!r||!vU(n,t,e[0])){if(!r||gU(n,r)){var p=n.sprite,g=n.width>>5,m=e[0]>>5,y=n.x-(g<<4),_=y&127,b=32-_,x=n.y1-n.y0,w=(n.y+n.y0)*m+(y>>5),k;for(var A=0;A<x;A++){k=0;for(var E=0;E<=g;E++){t[w+E]|=k<<b|(E<g?(k=p[A*g+E])>>>_:0)}w+=m}n.sprite=null;return true}}}return false}c.words=function(e){if(arguments.length){l=e;return c}else{return l}};c.size=function(t){if(arguments.length){e=[+t[0],+t[1]];return c}else{return e}};c.font=function(e){if(arguments.length){n=bU(e);return c}else{return n}};c.fontStyle=function(e){if(arguments.length){i=bU(e);return c}else{return i}};c.fontWeight=function(e){if(arguments.length){a=bU(e);return c}else{return a}};c.rotate=function(e){if(arguments.length){o=bU(e);return c}else{return o}};c.text=function(e){if(arguments.length){t=bU(e);return c}else{return t}};c.spiral=function(e){if(arguments.length){s=xU[e]||e;return c}else{return s}};c.fontSize=function(e){if(arguments.length){r=bU(e);return c}else{return r}};c.padding=function(e){if(arguments.length){u=bU(e);return c}else{return u}};c.random=function(e){if(arguments.length){f=e;return c}else{return f}};return c}function hU(e,t,n,r){if(t.sprite)return;var i=e.context,a=e.ratio;i.clearRect(0,0,(fU<<5)/a,cU/a);var o=0,u=0,s=0,l=n.length,f,c,d,h,v;--r;while(++r<l){t=n[r];i.save();i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font;f=i.measureText(t.text+"m").width*a;d=t.size<<1;if(t.rotate){var p=Math.sin(t.rotate*lU),g=Math.cos(t.rotate*lU),m=f*g,y=f*p,_=d*g,b=d*p;f=Math.max(Math.abs(m+b),Math.abs(m-b))+31>>5<<5;d=~~Math.max(Math.abs(y+_),Math.abs(y-_))}else{f=f+31>>5<<5}if(d>s)s=d;if(o+f>=fU<<5){o=0;u+=s;s=0}if(u+d>=cU)break;i.translate((o+(f>>1))/a,(u+(d>>1))/a);if(t.rotate)i.rotate(t.rotate*lU);i.fillText(t.text,0,0);if(t.padding){i.lineWidth=2*t.padding;i.strokeText(t.text,0,0)}i.restore();t.width=f;t.height=d;t.xoff=o;t.yoff=u;t.x1=f>>1;t.y1=d>>1;t.x0=-t.x1;t.y0=-t.y1;t.hasText=true;o+=f}var x=i.getImageData(0,0,(fU<<5)/a,cU/a).data,w=[];while(--r>=0){t=n[r];if(!t.hasText)continue;f=t.width;c=f>>5;d=t.y1-t.y0;for(h=0;h<d*c;h++)w[h]=0;o=t.xoff;if(o==null)return;u=t.yoff;var k=0,A=-1;for(v=0;v<d;v++){for(h=0;h<f;h++){var E=c*v+(h>>5),D=x[(u+v)*(fU<<5)+(o+h)<<2]?1<<31-h%32:0;w[E]|=D;k|=D}if(k)A=v;else{t.y0++;d--;v--;u++}}t.y1=t.y0+A;t.sprite=w.slice(0,(t.y1-t.y0)*c)}}function vU(e,t,n){n>>=5;var r=e.sprite,i=e.width>>5,a=e.x-(i<<4),o=a&127,u=32-o,s=e.y1-e.y0,l=(e.y+e.y0)*n+(a>>5),f;for(var c=0;c<s;c++){f=0;for(var d=0;d<=i;d++){if((f<<u|(d<i?(f=r[c*i+d])>>>o:0))&t[l+d])return true}l+=n}return false}function pU(e,t){var n=e[0],r=e[1];if(t.x+t.x0<n.x)n.x=t.x+t.x0;if(t.y+t.y0<n.y)n.y=t.y+t.y0;if(t.x+t.x1>r.x)r.x=t.x+t.x1;if(t.y+t.y1>r.y)r.y=t.y+t.y1}function gU(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function mU(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function yU(e){var t=4,n=t*e[0]/e[1],r=0,i=0;return function(e){var a=e<0?-1:1;switch(Math.sqrt(1+4*a*e)-a&3){case 0:r+=n;break;case 1:i+=t;break;case 2:r-=n;break;default:i-=t;break}return[r,i]}}function _U(e){var t=[],n=-1;while(++n<e)t[n]=0;return t}function bU(e){return typeof e==="function"?e:function(){return e}}var xU={archimedean:mU,rectangular:yU};var wU=["x","y","font","fontSize","fontStyle","fontWeight","angle"];var kU=["text","font","rotate","fontSize","fontStyle","fontWeight"];function AU(e){ad.call(this,dU(),e)}AU.Definition={type:"Wordcloud",metadata:{modifies:true},params:[{name:"size",type:"number",array:true,length:2},{name:"font",type:"string",expr:true,default:"sans-serif"},{name:"fontStyle",type:"string",expr:true,default:"normal"},{name:"fontWeight",type:"string",expr:true,default:"normal"},{name:"fontSize",type:"number",expr:true,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:true,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:true},{name:"as",type:"string",array:true,length:7,default:wU}]};Ei(AU,ad,{transform:function(e,t){if(e.size&&!(e.size[0]&&e.size[1])){_r("Wordcloud size dimensions must be non-zero.")}function n(n){var r=e[n];return si(r)&&t.modified(r.fields)}var r=e.modified();if(!(r||t.changed(t.ADD_REM)||kU.some(n)))return;var i=t.materialize(t.SOURCE).source,a=this.value,o=e.as||wU;var u=e.fontSize||14,s;si(u)?s=e.fontSizeRange:u=pi(u);if(s){var l=u,f=Nb("sqrt")().domain(yi(i,l)).range(s);u=function(e){return f(l(e))}}i.forEach((function(e){e[o[0]]=NaN;e[o[1]]=NaN;e[o[3]]=0}));var c=a.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(u).random(vd).layout();var d=a.size(),h=d[0]>>1,v=d[1]>>1,p=c.length;for(var g=0,m,y;g<p;++g){m=c[g];y=m.datum;y[o[0]]=m.x+h;y[o[1]]=m.y+v;y[o[2]]=m.font;y[o[3]]=m.size;y[o[4]]=m.style;y[o[5]]=m.weight;y[o[6]]=m.rotate}return t.reflow(r).modifies(o)}});var EU=Object.freeze({__proto__:null,wordcloud:AU});var DU=function(e){return new Uint8Array(e)};var SU=function(e){return new Uint16Array(e)};var CU=function(e){return new Uint32Array(e)};function MU(){var e=8,t=[],n=CU(0),r=OU(0,e),i=OU(0,e);return{data:function(){return t},seen:function(){return n=FU(n,t.length)},add:function(e){for(var n=0,r=t.length,i=e.length,a;n<i;++n){a=e[n];a._index=r++;t.push(a)}},remove:function(e,n){var a=t.length,o=Array(a-e),u=t;var s,l,f;for(l=0;!n[l]&&l<a;++l){o[l]=t[l];u[l]=l}for(f=l;l<a;++l){s=t[l];if(!n[l]){u[l]=f;r[f]=r[l];i[f]=i[l];o[f]=s;s._index=f++}else{u[l]=-1}r[l]=0}t=o;return u},size:function(){return t.length},curr:function(){return r},prev:function(){return i},reset:function(e){return i[e]=r[e]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(e,t){r[e]|=t},clear:function(e,t){r[e]&=~t},resize:function(t,n){var a=r.length;if(t>a||n>e){e=Math.max(n,e);r=OU(t,e,r);i=OU(t,e)}}}}function FU(e,t,n){if(e.length>=t)return e;n=n||new e.constructor(t);n.set(e);return n}function OU(e,t,n){var r=(t<257?DU:t<65537?SU:CU)(e);if(n)r.set(n);return r}function NU(e,t,n){var r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(e,t){var n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],u=i[1],s=a.length;var l;for(l=0;l<o;++l)t[a[l]]|=r;for(l=u;l<s;++l)t[a[l]]|=r;return n}}}function TU(){var e=CU(0),t=[],n=0;function r(r,i,a){if(!i.length)return[];var o=n,u=i.length,s=CU(u);var l=Array(u),f,c,d;for(d=0;d<u;++d){l[d]=r(i[d]);s[d]=d}l=zU(l,s);if(o){f=t;c=e;t=Array(o+u);e=CU(o+u);RU(a,f,c,o,l,s,u,t,e)}else{if(a>0)for(d=0;d<u;++d){s[d]+=a}t=l;e=s}n=o+u;return{index:s,value:l}}function i(r,i){var a=n;var o,u,s;for(u=0;!i[e[u]]&&u<a;++u);for(s=u;u<a;++u){if(!i[o=e[u]]){e[s]=o;t[s]=t[u];++s}}n=a-r}function a(t){for(var r=0,i=n;r<i;++r){e[r]=t[e[r]]}}function o(e,r){var i;if(r){i=r.length}else{r=t;i=n}return[to(r,e[0],0,i),eo(r,e[1],0,i)]}return{insert:r,remove:i,bisect:o,reindex:a,index:function(){return e},size:function(){return n}}}function zU(e,t){e.sort.call(t,(function(t,n){var r=e[t],i=e[n];return r<i?-1:r>i?1:0}));return ao(e,t)}function RU(e,t,n,r,i,a,o,u,s){var l=0,f=0,c;for(c=0;l<r&&f<o;++c){if(t[l]<i[f]){u[c]=t[l];s[c]=n[l++]}else{u[c]=i[f];s[c]=a[f++]+e}}for(;l<r;++l,++c){u[c]=t[l];s[c]=n[l]}for(;f<o;++f,++c){u[c]=i[f];s[c]=a[f]+e}}function PU(e){ad.call(this,MU(),e);this._indices=null;this._dims=null}PU.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:true,required:true},{name:"query",type:"array",array:true,required:true,content:{type:"number",array:true,length:2}}]};Ei(PU,ad,{transform:function(e,t){if(!this._dims){return this.init(e,t)}else{var n=e.modified("fields")||e.fields.some((function(e){return t.modified(e.fields)}));return n?this.reinit(e,t):this.eval(e,t)}},init:function(e,t){var n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;var u=0,s,l;for(;u<o;++u){s=n[u].fname;l=i[s]||(i[s]=TU());a.push(NU(l,u,r[u]))}return this.eval(e,t)},reinit:function(e,t){var n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,u=this.value,s=u.curr(),l=u.prev(),f=u.all(),c=n.rem=n.add,d=n.mod,h=i.length,v={};var p,g,m,y,_,b,x,w,k;l.set(s);if(t.rem.length){_=this.remove(e,t,n)}if(t.add.length){u.add(t.add)}if(t.mod.length){b={};for(y=t.mod,x=0,w=y.length;x<w;++x){b[y[x]._index]=1}}for(x=0;x<h;++x){k=r[x];if(!o[x]||e.modified("fields",x)||t.modified(k.fields)){m=k.fname;if(!(p=v[m])){a[m]=g=TU();v[m]=p=g.insert(k,t.source,0)}o[x]=NU(g,x,i[x]).onAdd(p,s)}}for(x=0,w=u.data().length;x<w;++x){if(_[x]){continue}else if(l[x]!==s[x]){c.push(x)}else if(b[x]&&s[x]!==f){d.push(x)}}u.mask=(1<<h)-1;return n},eval:function(e,t){var n=t.materialize().fork(),r=this._dims.length;var i=0;if(t.rem.length){this.remove(e,t,n);i|=(1<<r)-1}if(e.modified("query")&&!e.modified("fields")){i|=this.update(e,t,n)}if(t.add.length){this.insert(e,t,n);i|=(1<<r)-1}if(t.mod.length){this.modify(t,n);i|=(1<<r)-1}this.value.mask=i;return n},insert:function(e,t,n){var r=t.add,i=this.value,a=this._dims,o=this._indices,u=e.fields,s={},l=n.add,f=i.size()+r.length,c=a.length;var d=i.size(),h,v,p;i.resize(f,c);i.add(r);var g=i.curr(),m=i.prev(),y=i.all();for(h=0;h<c;++h){v=u[h].fname;p=s[v]||(s[v]=o[v].insert(u[h],r,d));a[h].onAdd(p,g)}for(;d<f;++d){m[d]=y;if(g[d]!==y)l.push(d)}},modify:function(e,t){var n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;var u,s,l;for(u=0,s=o.length;u<s;++u){l=o[u]._index;if(i[l]!==a)n.push(l)}},remove:function(e,t,n){var r=this._indices,i=this.value,a=i.curr(),o=i.prev(),u=i.all(),s={},l=n.rem,f=t.rem;var c,d,h,v;for(c=0,d=f.length;c<d;++c){h=f[c]._index;s[h]=1;o[h]=v=a[h];a[h]=u;if(v!==u)l.push(h)}for(h in r){r[h].remove(d,s)}this.reindex(t,d,s);return s},reindex:function(e,t,n){var r=this._indices,i=this.value;e.runAfter((function(){var e=i.remove(t,n);for(var a in r)r[a].reindex(e)}))},update:function(e,t,n){var r=this._dims,i=e.query,a=t.stamp,o=r.length;var u=0,s,l;n.filters=0;for(l=0;l<o;++l){if(e.modified("query",l)){s=l;++u}}if(u===1){u=r[s].one;this.incrementOne(r[s],i[s],n.add,n.rem)}else{for(l=0,u=0;l<o;++l){if(!e.modified("query",l))continue;u|=r[l].one;this.incrementAll(r[l],i[l],a,n.add);n.rem=n.add}}return u},incrementAll:function(e,t,n,r){var i=this.value,a=i.seen(),o=i.curr(),u=i.prev(),s=e.index(),l=e.bisect(e.range),f=e.bisect(t),c=f[0],d=f[1],h=l[0],v=l[1],p=e.one;var g,m,y;if(c<h){for(g=c,m=Math.min(h,d);g<m;++g){y=s[g];if(a[y]!==n){u[y]=o[y];a[y]=n;r.push(y)}o[y]^=p}}else if(c>h){for(g=h,m=Math.min(c,v);g<m;++g){y=s[g];if(a[y]!==n){u[y]=o[y];a[y]=n;r.push(y)}o[y]^=p}}if(d>v){for(g=Math.max(c,v),m=d;g<m;++g){y=s[g];if(a[y]!==n){u[y]=o[y];a[y]=n;r.push(y)}o[y]^=p}}else if(d<v){for(g=Math.max(h,d),m=v;g<m;++g){y=s[g];if(a[y]!==n){u[y]=o[y];a[y]=n;r.push(y)}o[y]^=p}}e.range=t.slice()},incrementOne:function(e,t,n,r){var i=this.value,a=i.curr(),o=e.index(),u=e.bisect(e.range),s=e.bisect(t),l=s[0],f=s[1],c=u[0],d=u[1],h=e.one;var v,p,g;if(l<c){for(v=l,p=Math.min(c,f);v<p;++v){g=o[v];a[g]^=h;n.push(g)}}else if(l>c){for(v=c,p=Math.min(l,d);v<p;++v){g=o[v];a[g]^=h;r.push(g)}}if(f>d){for(v=Math.max(l,d),p=f;v<p;++v){g=o[v];a[g]^=h;n.push(g)}}else if(f<d){for(v=Math.max(c,f),p=d;v<p;++v){g=o[v];a[g]^=h;r.push(g)}}e.range=t.slice()}});function LU(e){ad.call(this,null,e)}LU.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:true,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:true,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};Ei(LU,ad,{transform:function(e,t){var n=~(e.ignore||0),r=e.filter,i=r.mask;if((i&n)===0)return t.StopPropagation;var a=t.fork(t.ALL),o=r.data(),u=r.curr(),s=r.prev(),l=function(e){return!(u[e]&n)?o[e]:null};a.filter(a.MOD,l);if(!(i&i-1)){a.filter(a.ADD,l);a.filter(a.REM,(function(e){return(u[e]&n)===i?o[e]:null}))}else{a.filter(a.ADD,(function(e){var t=u[e]&n,r=!t&&t^s[e]&n;return r?o[e]:null}));a.filter(a.REM,(function(e){var t=u[e]&n,r=t&&!(t^(t^s[e]&n));return r?o[e]:null}))}return a.filter(a.SOURCE,(function(e){return l(e._index)}))}});var jU=Object.freeze({__proto__:null,crossfilter:PU,resolvefilter:LU});var BU="RawCode";var IU="Literal";var UU="Property";var qU="Identifier";var WU="ArrayExpression";var HU="BinaryExpression";var GU="CallExpression";var $U="ConditionalExpression";var VU="LogicalExpression";var YU="MemberExpression";var XU="ObjectExpression";var JU="UnaryExpression";function QU(e){this.type=e}QU.prototype.visit=function(e){var t,n,r;if(e(this))return 1;for(t=ZU(this),n=0,r=t.length;n<r;++n){if(t[n].visit(e))return 1}};function ZU(e){switch(e.type){case WU:return e.elements;case HU:case VU:return[e.left,e.right];case GU:return[e.callee].concat(e.arguments);case $U:return[e.test,e.consequent,e.alternate];case YU:return[e.object,e.property];case XU:return e.properties;case UU:return[e.key,e.value];case JU:return[e.argument];case qU:case IU:case BU:default:return[]}}var KU,eq,tq,nq,rq;var iq=1,aq=2,oq=3,uq=4,sq=5,lq=6,fq=7,cq=8,dq=9;KU={};KU[iq]="Boolean";KU[aq]="<end>";KU[oq]="Identifier";KU[uq]="Keyword";KU[sq]="Null";KU[lq]="Numeric";KU[fq]="Punctuator";KU[cq]="String";KU[dq]="RegularExpression";var hq="ArrayExpression",vq="BinaryExpression",pq="CallExpression",gq="ConditionalExpression",mq="Identifier",yq="Literal",_q="LogicalExpression",bq="MemberExpression",xq="ObjectExpression",wq="Property",kq="UnaryExpression";var Aq="Unexpected token %0",Eq="Unexpected number",Dq="Unexpected string",Sq="Unexpected identifier",Cq="Unexpected reserved word",Mq="Unexpected end of input",Fq="Invalid regular expression",Oq="Invalid regular expression: missing /",Nq="Octal literals are not allowed in strict mode.",Tq="Duplicate data property in object literal not allowed in strict mode";var zq="ILLEGAL",Rq="Disabled.";var Pq=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Lq=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function jq(e,t){if(!e){throw new Error("ASSERT: "+t)}}function Bq(e){return e>=48&&e<=57}function Iq(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Uq(e){return"01234567".indexOf(e)>=0}function qq(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Wq(e){return e===10||e===13||e===8232||e===8233}function Hq(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&Pq.test(String.fromCharCode(e))}function Gq(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&Lq.test(String.fromCharCode(e))}var $q={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Vq(){while(tq<nq){var e=eq.charCodeAt(tq);if(qq(e)||Wq(e)){++tq}else{break}}}function Yq(e){var t,n,r,i=0;n=e==="u"?4:2;for(t=0;t<n;++t){if(tq<nq&&Iq(eq[tq])){r=eq[tq++];i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())}else{wW({},Aq,zq)}}return String.fromCharCode(i)}function Xq(){var e,t,n,r;e=eq[tq];t=0;if(e==="}"){wW({},Aq,zq)}while(tq<nq){e=eq[tq++];if(!Iq(e)){break}t=t*16+"0123456789abcdef".indexOf(e.toLowerCase())}if(t>1114111||e!=="}"){wW({},Aq,zq)}if(t<=65535){return String.fromCharCode(t)}n=(t-65536>>10)+55296;r=(t-65536&1023)+56320;return String.fromCharCode(n,r)}function Jq(){var e,t;e=eq.charCodeAt(tq++);t=String.fromCharCode(e);if(e===92){if(eq.charCodeAt(tq)!==117){wW({},Aq,zq)}++tq;e=Yq("u");if(!e||e==="\\"||!Hq(e.charCodeAt(0))){wW({},Aq,zq)}t=e}while(tq<nq){e=eq.charCodeAt(tq);if(!Gq(e)){break}++tq;t+=String.fromCharCode(e);if(e===92){t=t.substr(0,t.length-1);if(eq.charCodeAt(tq)!==117){wW({},Aq,zq)}++tq;e=Yq("u");if(!e||e==="\\"||!Gq(e.charCodeAt(0))){wW({},Aq,zq)}t+=e}}return t}function Qq(){var e,t;e=tq++;while(tq<nq){t=eq.charCodeAt(tq);if(t===92){tq=e;return Jq()}if(Gq(t)){++tq}else{break}}return eq.slice(e,tq)}function Zq(){var e,t,n;e=tq;t=eq.charCodeAt(tq)===92?Jq():Qq();if(t.length===1){n=oq}else if($q.hasOwnProperty(t)){n=uq}else if(t==="null"){n=sq}else if(t==="true"||t==="false"){n=iq}else{n=oq}return{type:n,value:t,start:e,end:tq}}function Kq(){var e=tq,t=eq.charCodeAt(tq),n,r=eq[tq],i,a,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++tq;return{type:fq,value:String.fromCharCode(t),start:e,end:tq};default:n=eq.charCodeAt(tq+1);if(n===61){switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:tq+=2;return{type:fq,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:tq};case 33:case 61:tq+=2;if(eq.charCodeAt(tq)===61){++tq}return{type:fq,value:eq.slice(e,tq),start:e,end:tq}}}}o=eq.substr(tq,4);if(o===">>>="){tq+=4;return{type:fq,value:o,start:e,end:tq}}a=o.substr(0,3);if(a===">>>"||a==="<<="||a===">>="){tq+=3;return{type:fq,value:a,start:e,end:tq}}i=a.substr(0,2);if(r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>"){tq+=2;return{type:fq,value:i,start:e,end:tq}}if(i==="//"){wW({},Aq,zq)}if("<>=!+-*%&|^/".indexOf(r)>=0){++tq;return{type:fq,value:r,start:e,end:tq}}wW({},Aq,zq)}function eW(e){var t="";while(tq<nq){if(!Iq(eq[tq])){break}t+=eq[tq++]}if(t.length===0){wW({},Aq,zq)}if(Hq(eq.charCodeAt(tq))){wW({},Aq,zq)}return{type:lq,value:parseInt("0x"+t,16),start:e,end:tq}}function tW(e){var t="0"+eq[tq++];while(tq<nq){if(!Uq(eq[tq])){break}t+=eq[tq++]}if(Hq(eq.charCodeAt(tq))||Bq(eq.charCodeAt(tq))){wW({},Aq,zq)}return{type:lq,value:parseInt(t,8),octal:true,start:e,end:tq}}function nW(){var e,t,n;n=eq[tq];jq(Bq(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point");t=tq;e="";if(n!=="."){e=eq[tq++];n=eq[tq];if(e==="0"){if(n==="x"||n==="X"){++tq;return eW(t)}if(Uq(n)){return tW(t)}if(n&&Bq(n.charCodeAt(0))){wW({},Aq,zq)}}while(Bq(eq.charCodeAt(tq))){e+=eq[tq++]}n=eq[tq]}if(n==="."){e+=eq[tq++];while(Bq(eq.charCodeAt(tq))){e+=eq[tq++]}n=eq[tq]}if(n==="e"||n==="E"){e+=eq[tq++];n=eq[tq];if(n==="+"||n==="-"){e+=eq[tq++]}if(Bq(eq.charCodeAt(tq))){while(Bq(eq.charCodeAt(tq))){e+=eq[tq++]}}else{wW({},Aq,zq)}}if(Hq(eq.charCodeAt(tq))){wW({},Aq,zq)}return{type:lq,value:parseFloat(e),start:t,end:tq}}function rW(){var e="",t,n,r,i,a=false;t=eq[tq];jq(t==="'"||t==='"',"String literal must starts with a quote");n=tq;++tq;while(tq<nq){r=eq[tq++];if(r===t){t="";break}else if(r==="\\"){r=eq[tq++];if(!r||!Wq(r.charCodeAt(0))){switch(r){case"u":case"x":if(eq[tq]==="{"){++tq;e+=Xq()}else{e+=Yq(r)}break;case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:if(Uq(r)){i="01234567".indexOf(r);if(i!==0){a=true}if(tq<nq&&Uq(eq[tq])){a=true;i=i*8+"01234567".indexOf(eq[tq++]);if("0123".indexOf(r)>=0&&tq<nq&&Uq(eq[tq])){i=i*8+"01234567".indexOf(eq[tq++])}}e+=String.fromCharCode(i)}else{e+=r}break}}else{if(r==="\r"&&eq[tq]==="\n"){++tq}}}else if(Wq(r.charCodeAt(0))){break}else{e+=r}}if(t!==""){wW({},Aq,zq)}return{type:cq,value:e,octal:a,start:n,end:tq}}function iW(e,t){var n=e;if(t.indexOf("u")>=0){n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111){return"x"}wW({},Fq)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x")}try{return new RegExp(e,t)}catch(r){return null}}function aW(){var e,t,n,r,i;e=eq[tq];jq(e==="/","Regular expression literal must start with a slash");t=eq[tq++];n=false;r=false;while(tq<nq){e=eq[tq++];t+=e;if(e==="\\"){e=eq[tq++];if(Wq(e.charCodeAt(0))){wW({},Oq)}t+=e}else if(Wq(e.charCodeAt(0))){wW({},Oq)}else if(n){if(e==="]"){n=false}}else{if(e==="/"){r=true;break}else if(e==="["){n=true}}}if(!r){wW({},Oq)}i=t.substr(1,t.length-2);return{value:i,literal:t}}function oW(){var e,t,n;t="";n="";while(tq<nq){e=eq[tq];if(!Gq(e.charCodeAt(0))){break}++tq;if(e==="\\"&&tq<nq){wW({},Aq,zq)}else{n+=e;t+=e}}if(n.search(/[^gimuy]/g)>=0){wW({},Fq,n)}return{value:n,literal:t}}function uW(){var e,t,n,r;rq=null;Vq();e=tq;t=aW();n=oW();r=iW(t.value,n.value);return{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:tq}}function sW(e){return e.type===oq||e.type===uq||e.type===iq||e.type===sq}function lW(){Vq();if(tq>=nq){return{type:aq,start:tq,end:tq}}var e=eq.charCodeAt(tq);if(Hq(e)){return Zq()}if(e===40||e===41||e===59){return Kq()}if(e===39||e===34){return rW()}if(e===46){if(Bq(eq.charCodeAt(tq+1))){return nW()}return Kq()}if(Bq(e)){return nW()}return Kq()}function fW(){var e=rq;tq=e.end;rq=lW();tq=e.end;return e}function cW(){var e=tq;rq=lW();tq=e}function dW(e){var t=new QU(hq);t.elements=e;return t}function hW(e,t,n){var r=new QU(e==="||"||e==="&&"?_q:vq);r.operator=e;r.left=t;r.right=n;return r}function vW(e,t){var n=new QU(pq);n.callee=e;n.arguments=t;return n}function pW(e,t,n){var r=new QU(gq);r.test=e;r.consequent=t;r.alternate=n;return r}function gW(e){var t=new QU(mq);t.name=e;return t}function mW(e){var t=new QU(yq);t.value=e.value;t.raw=eq.slice(e.start,e.end);if(e.regex){if(t.raw==="//"){t.raw="/(?:)/"}t.regex=e.regex}return t}function yW(e,t,n){var r=new QU(bq);r.computed=e==="[";r.object=t;r.property=n;if(!r.computed)n.member=true;return r}function _W(e){var t=new QU(xq);t.properties=e;return t}function bW(e,t,n){var r=new QU(wq);r.key=t;r.value=n;r.kind=e;return r}function xW(e,t){var n=new QU(kq);n.operator=e;n.argument=t;n.prefix=true;return n}function wW(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){jq(t<r.length,"Message reference must be in range");return r[t]}));n=new Error(i);n.index=tq;n.description=i;throw n}function kW(e){if(e.type===aq){wW(e,Mq)}if(e.type===lq){wW(e,Eq)}if(e.type===cq){wW(e,Dq)}if(e.type===oq){wW(e,Sq)}if(e.type===uq){wW(e,Cq)}wW(e,Aq,e.value)}function AW(e){var t=fW();if(t.type!==fq||t.value!==e){kW(t)}}function EW(e){return rq.type===fq&&rq.value===e}function DW(e){return rq.type===uq&&rq.value===e}function SW(){var e=[];tq=rq.start;AW("[");while(!EW("]")){if(EW(",")){fW();e.push(null)}else{e.push(WW());if(!EW("]")){AW(",")}}}fW();return dW(e)}function CW(){tq=rq.start;var e=fW();if(e.type===cq||e.type===lq){if(e.octal){wW(e,Nq)}return mW(e)}return gW(e.value)}function MW(){var e,t,n,r;tq=rq.start;e=rq;if(e.type===oq){n=CW();AW(":");r=WW();return bW("init",n,r)}if(e.type===aq||e.type===fq){kW(e)}else{t=CW();AW(":");r=WW();return bW("init",t,r)}}function FW(){var e=[],t,n,r,i={},a=String;tq=rq.start;AW("{");while(!EW("}")){t=MW();if(t.key.type===mq){n=t.key.name}else{n=a(t.key.value)}r="$"+n;if(Object.prototype.hasOwnProperty.call(i,r)){wW({},Tq)}else{i[r]=true}e.push(t);if(!EW("}")){AW(",")}}AW("}");return _W(e)}function OW(){AW("(");var e=HW();AW(")");return e}var NW={if:1};function TW(){var e,t,n;if(EW("(")){return OW()}if(EW("[")){return SW()}if(EW("{")){return FW()}e=rq.type;tq=rq.start;if(e===oq||NW[rq.value]){n=gW(fW().value)}else if(e===cq||e===lq){if(rq.octal){wW(rq,Nq)}n=mW(fW())}else if(e===uq){throw new Error(Rq)}else if(e===iq){t=fW();t.value=t.value==="true";n=mW(t)}else if(e===sq){t=fW();t.value=null;n=mW(t)}else if(EW("/")||EW("/=")){n=mW(uW());cW()}else{kW(fW())}return n}function zW(){var e=[];AW("(");if(!EW(")")){while(tq<nq){e.push(WW());if(EW(")")){break}AW(",")}}AW(")");return e}function RW(){tq=rq.start;var e=fW();if(!sW(e)){kW(e)}return gW(e.value)}function PW(){AW(".");return RW()}function LW(){AW("[");var e=HW();AW("]");return e}function jW(){var e,t,n;e=TW();for(;;){if(EW(".")){n=PW();e=yW(".",e,n)}else if(EW("(")){t=zW();e=vW(e,t)}else if(EW("[")){n=LW();e=yW("[",e,n)}else{break}}return e}function BW(){var e=jW();if(rq.type===fq){if(EW("++")||EW("--")){throw new Error(Rq)}}return e}function IW(){var e,t;if(rq.type!==fq&&rq.type!==uq){t=BW()}else if(EW("++")||EW("--")){throw new Error(Rq)}else if(EW("+")||EW("-")||EW("~")||EW("!")){e=fW();t=IW();t=xW(e.value,t)}else if(DW("delete")||DW("void")||DW("typeof")){throw new Error(Rq)}else{t=BW()}return t}function UW(e){var t=0;if(e.type!==fq&&e.type!==uq){return 0}switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function qW(){var e,t,n,r,i,a,o,u,s,l;e=rq;s=IW();r=rq;i=UW(r);if(i===0){return s}r.prec=i;fW();t=[e,rq];o=IW();a=[s,r,o];while((i=UW(rq))>0){while(a.length>2&&i<=a[a.length-2].prec){o=a.pop();u=a.pop().value;s=a.pop();t.pop();n=hW(u,s,o);a.push(n)}r=fW();r.prec=i;a.push(r);t.push(rq);n=IW();a.push(n)}l=a.length-1;n=a[l];t.pop();while(l>1){t.pop();n=hW(a[l-1].value,a[l-2],n);l-=2}return n}function WW(){var e,t,n;e=qW();if(EW("?")){fW();t=WW();AW(":");n=WW();e=pW(e,t,n)}return e}function HW(){var e=WW();if(EW(",")){throw new Error(Rq)}return e}function GW(e){eq=e;tq=0;nq=eq.length;rq=null;cW();var t=HW();if(rq.type!==aq){throw new Error("Unexpect token after expression.")}return t}var $W={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function VW(e){function t(t,n,r,i){var a=e(n[0]);if(r){a=r+"("+a+")";if(r.lastIndexOf("new ",0)===0)a="("+a+")"}return a+"."+t+(i<0?"":i===0?"()":"("+n.slice(1).map(e).join(",")+")")}function n(e,n,r){return function(i){return t(e,i,n,r)}}var r="new Date",i="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){if(t.length<3)_r("Missing arguments to clamp function.");if(t.length>3)_r("Too many arguments to clamp function.");var n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:a,test:n("test",a),if:function(t){if(t.length<3)_r("Missing arguments to if function.");if(t.length>3)_r("Too many arguments to if function.");var n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function YW(e){var t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function XW(e){e=e||{};var t=e.allowed?$i(e.allowed):{},n=e.forbidden?$i(e.forbidden):{},r=e.constants||$W,i=(e.functions||VW)(c),a=e.globalvar,o=e.fieldvar,u=si(a)?a:function(e){return"".concat(a,'["').concat(e,'"]')};var s={},l={},f=0;function c(e){if(Ni(e))return e;var t=d[e.type];if(t==null)_r("Unsupported type: "+e.type);return t(e)}var d={Literal:function(e){return e.raw},Identifier:function(e){var i=e.name;if(f>0){return i}else if(xi(n,i)){return _r("Illegal identifier: "+i)}else if(xi(r,i)){return r[i]}else if(xi(t,i)){return i}else{s[i]=1;return u(i)}},MemberExpression:function(e){var t=!e.computed,n=c(e.object);if(t)f+=1;var r=c(e.property);if(n===o){l[YW(r)]=1}if(t)f-=1;return n+(t?"."+r:"["+r+"]")},CallExpression:function(e){if(e.callee.type!=="Identifier"){_r("Illegal callee type: "+e.callee.type)}var t=e.callee.name,n=e.arguments,r=xi(i,t)&&i[t];if(!r)_r("Unrecognized function: "+t);return si(r)?r(n):r+"("+n.map(c).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(c).join(",")+"]"},BinaryExpression:function(e){return"("+c(e.left)+" "+e.operator+" "+c(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+c(e.argument)+")"},ConditionalExpression:function(e){return"("+c(e.test)+"?"+c(e.consequent)+":"+c(e.alternate)+")"},LogicalExpression:function(e){return"("+c(e.left)+e.operator+c(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(c).join(",")+"}"},Property:function(e){f+=1;var t=c(e.key);f-=1;return t+":"+c(e.value)}};function h(e){var t={code:c(e),globals:Object.keys(s),fields:Object.keys(l)};s={};l={};return t}h.functions=i;h.constants=r;return h}function JW(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function QW(e){var t=e;var n=e;if(e.length===1){t=function(t,n){return e(t)-n};n=ZW(e)}function r(e,t,r,i){if(r==null)r=0;if(i==null)i=e.length;while(r<i){var a=r+i>>>1;if(n(e[a],t)<0)r=a+1;else i=a}return r}function i(e,t,r,i){if(r==null)r=0;if(i==null)i=e.length;while(r<i){var a=r+i>>>1;if(n(e[a],t)>0)i=a;else r=a+1}return r}function a(e,n,i,a){if(i==null)i=0;if(a==null)a=e.length;var o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o}return{left:r,center:a,right:i}}function ZW(e){return function(t,n){return JW(e(t),n)}}var KW="intersect";var eH="union";var tH="vlMulti";var nH="vlPoint";var rH="or";var iH="and";var aH="_vgsid_",oH="E",uH="R",sH="R-E",lH="R-LE",fH="R-RE",cH="index:unit";function dH(e,t){var n=t.fields,r=t.values,i=n.length,a=0,o,u;for(;a<i;++a){u=n[a];u.getter=xr.getter||xr(u.field);o=u.getter(e);if(Ci(o))o=qr(o);if(Ci(r[a]))r[a]=qr(r[a]);if(Ci(r[a][0]))r[a]=r[a].map(qr);if(u.type===oH){if(Rr(r[a])?r[a].indexOf(o)<0:o!==r[a]){return false}}else{if(u.type===uH){if(!Di(o,r[a]))return false}else if(u.type===fH){if(!Di(o,r[a],true,false))return false}else if(u.type===sH){if(!Di(o,r[a],false,false))return false}else if(u.type===lH){if(!Di(o,r[a],false,true))return false}}}return true}function hH(e,t,n){var r=this.context.data[e],i=r?r.values.value:[],a=r?r[cH]&&r[cH].value:undefined,o=n===KW,u=i.length,s=0,l,f,c,d,h;for(;s<u;++s){l=i[s];if(a&&o){f=f||{};c=f[d=l.unit]||0;if(c===-1)continue;h=dH(t,l);f[d]=h?-1:++c;if(h&&a.size===1)return true;if(!h&&c===a.get(d).count)return false}else{h=dH(t,l);if(o^h)return h}}return u&&o}var vH=xr(aH),pH=QW(vH),gH=pH.left,mH=pH.right;function yH(e,t,n){var r=this.context.data[e],i=r?r.values.value:[],a=r?r[cH]&&r[cH].value:undefined,o=n===KW,u=vH(t),s=gH(i,u);if(s===i.length)return false;if(vH(i[s])!==u)return false;if(a&&o){if(a.size===1)return true;if(mH(i,u)-s<a.size)return false}return true}function _H(e,t){return e.map((function(e){return mi({values:t.fields.map((function(t){return(t.getter||(t.getter=xr(t.field)))(e.datum)}))},t)}))}function bH(e,t,n,r){var i,a;var o=this.context.data[e],u=o?o.values.value:[],s={},l={},f={},c,d,h,v,p,g,m,y,_,b=u.length,x=0,w,k;for(;x<b;++x){c=u[x];v=c.unit;d=c.fields;h=c.values;for(w=0,k=d.length;w<k;++w){p=d[w];g=s[p.field]||(s[p.field]={});m=g[v]||(g[v]=[]);f[p.field]=y=p.type.charAt(0);_=xH[y+"_union"];g[v]=_(m,oi(h[w]))}if(n){m=l[v]||(l[v]=[]);m.push(oi(h).reduce((function(e,t,n){return e[d[n].field]=t,e}),{}))}}t=t||eH;Object.keys(s).forEach((function(e){s[e]=Object.keys(s[e]).map((function(t){return s[e][t]})).reduce((function(n,r){return n===undefined?r:xH[f[e]+"_"+t](n,r)}))}));u=Object.keys(l);if(n&&u.length){var A=r?nH:tH;s[A]=t===eH?(i={},i[rH]=u.reduce((function(e,t){return e.push.apply(e,l[t]),e}),[]),i):(a={},a[iH]=u.map((function(e){var t;return t={},t[rH]=l[e],t})),a)}return s}var xH={E_union:function(e,t){if(!e.length)return t;var n=0,r=t.length;for(;n<r;++n)if(e.indexOf(t[n])<0)e.push(t[n]);return e},E_intersect:function(e,t){return!e.length?t:e.filter((function(e){return t.indexOf(e)>=0}))},R_union:function(e,t){var n=qr(t[0]),r=qr(t[1]);if(n>r){n=t[1];r=t[0]}if(!e.length)return[n,r];if(e[0]>n)e[0]=n;if(e[1]<r)e[1]=r;return e},R_intersect:function(e,t){var n=qr(t[0]),r=qr(t[1]);if(n>r){n=t[1];r=t[0]}if(!e.length)return[n,r];if(r<e[0]||e[1]<n){return[]}else{if(e[0]<n)e[0]=n;if(e[1]>r)e[1]=r}return e}};var wH=":",kH="@";function AH(e,t,n,r){if(t[0].type!==IU)_r("First argument to selection functions must be a string literal.");var i=t[0].value,a=t.length>=2&&Ur(t).value,o="unit",u=kH+o,s=wH+i;if(a===KW&&!xi(r,u)){r[u]=n.getData(i).indataRef(n,o)}if(!xi(r,s)){r[s]=n.getData(i).tuplesRef()}}function EH(e){var t=this.context.data[e];return t?t.values.value:[]}function DH(e,t,n){var r=this.context.data[e]["index:"+t],i=r?r.value.get(n):undefined;return i?i.count:i}function SH(e,t){var n=this.context.dataflow,r=this.context.data[e],i=r.input;n.pulse(i,n.changeset().remove(Dr).insert(t));return 1}function CH(e,t,n){if(e){var r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==undefined?n:e}var MH=function(e){return function(t,n){var r=this.context.dataflow.locale();return r[e](n)(t)}};var FH=MH("format");var OH=MH("timeFormat");var NH=MH("utcFormat");var TH=MH("timeParse");var zH=MH("utcParse");var RH=new Date(2e3,0,1);function PH(e,t,n){if(!Number.isInteger(e)||!Number.isInteger(t))return"";RH.setYear(2e3);RH.setMonth(e);RH.setDate(t);return OH.call(this,RH,n)}function LH(e){return PH.call(this,e,1,"%B")}function jH(e){return PH.call(this,e,1,"%b")}function BH(e){return PH.call(this,0,2+e,"%A")}function IH(e){return PH.call(this,0,2+e,"%a")}var UH=":";var qH="@";var WH="%";var HH="$";function GH(e,t,n,r){if(t[0].type!==IU){_r("First argument to data functions must be a string literal.")}var i=t[0].value,a=UH+i;if(!xi(a,r)){try{r[a]=n.getData(i).tuplesRef()}catch(o){}}}function $H(e,t,n,r){if(t[0].type!==IU)_r("First argument to indata must be a string literal.");if(t[1].type!==IU)_r("Second argument to indata must be a string literal.");var i=t[0].value,a=t[1].value,o=qH+a;if(!xi(o,r)){r[o]=n.getData(i).indataRef(n,a)}}function VH(e,t,n,r){if(t[0].type===IU){YH(n,r,t[0].value)}else{for(e in n.scales){YH(n,r,e)}}}function YH(e,t,n){var r=WH+n;if(!xi(t,r)){try{t[r]=e.scaleRef(n)}catch(i){}}}function XH(e,t){var n;return si(e)?e:Ni(e)?(n=t.scales[e])&&n.value:undefined}function JH(e,t,n){t.__bandwidth=function(e){return e&&e.bandwidth?e.bandwidth():0};n._bandwidth=VH;n._range=VH;n._scale=VH;var r=function(t){return"_["+(t.type===IU?Ui(WH+t.value):Ui(WH)+"+"+e(t))+"]"};return{_bandwidth:function(e){return"this.__bandwidth(".concat(r(e[0]),")")},_range:function(e){return"".concat(r(e[0]),".range()")},_scale:function(t){return"".concat(r(t[0]),"(").concat(e(t[1]),")")}}}function QH(e,t){return function(n,r,i){if(n){var a=XH(n,(i||this).context);return a&&a.path[e](r)}else{return t(r)}}}var ZH=QH("area",vO);var KH=QH("bounds",HO);var eG=QH("centroid",yN);function tG(e){var t=this.context.group;var n=false;if(t)while(e){if(e===t){n=true;break}e=e.mark.group}return n}function nG(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function rG(){return nG(this.context.dataflow,"warn",arguments)}function iG(){return nG(this.context.dataflow,"info",arguments)}function aG(){return nG(this.context.dataflow,"debug",arguments)}function oG(e){var t=e/255;if(t<=.03928){return t/12.92}return Math.pow((t+.055)/1.055,2.4)}function uG(e){var t=am(e),n=oG(t.r),r=oG(t.g),i=oG(t.b);return.2126*n+.7152*r+.0722*i}function sG(e,t){var n=uG(e),r=uG(t),i=Math.max(n,r),a=Math.min(n,r);return(i+.05)/(a+.05)}function lG(){var e=[].slice.call(arguments);e.unshift({});return mi.apply(void 0,e)}function fG(e,t){return e===t||e!==e&&t!==t?true:Rr(e)?Rr(t)&&e.length===t.length?cG(e,t):false:Pr(e)&&Pr(t)?dG(e,t):false}function cG(e,t){for(var n=0,r=e.length;n<r;++n){if(!fG(e[n],t[n]))return false}return true}function dG(e,t){for(var n in e){if(!fG(e[n],t[n]))return false}return true}function hG(e){return function(t){return dG(e,t)}}function vG(e,t,n,r,i,a){var o=this.context.dataflow,u=this.context.data[e],s=u.input,l=o.stamp();var f=u.changes,c,d;if(o._trigger===false||!(s.value.length||t||r)){return 0}if(!f||f.stamp<l){u.changes=f=o.changeset();f.stamp=l;o.runAfter((function(){u.modified=true;o.pulse(s,f).run()}),true,1)}if(n){c=n===true?Dr:Rr(n)||Wf(n)?n:hG(n);f.remove(c)}if(t){f.insert(t)}if(r){c=hG(r);if(s.value.some(c)){f.remove(c)}else{f.insert(r)}}if(i){for(d in a){f.modify(i,d,a[d])}}return 1}function pG(e){var t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)}function gG(e){var t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}var mG={};function yG(e,t){var n=mG[t]||(mG[t]=xr(t));return Rr(e)?e.map(n):n(e)}function _G(e){return Rr(e)||ArrayBuffer.isView(e)?e:null}function bG(e){return _G(e)||(Ni(e)?e:null)}function xG(e){var t;var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}return(t=_G(e)).join.apply(t,n)}function wG(e){var t;var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}return(t=bG(e)).indexOf.apply(t,n)}function kG(e){var t;var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}return(t=bG(e)).lastIndexOf.apply(t,n)}function AG(e){var t;var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}return(t=bG(e)).slice.apply(t,n)}function EG(e,t,n){if(si(n))_r("Function argument passed to replace.");return String(e).replace(t,n)}function DG(e){return _G(e).slice().reverse()}function SG(e,t,n){return Z_(e||0,t||0,n||0)}function CG(e,t){var n=XH(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function MG(e,t){var n=XH(e,(t||this).context);return n?n.copy():undefined}function FG(e,t){var n=XH(e,(t||this).context);return n?n.domain():[]}function OG(e,t,n){var r=XH(e,(n||this).context);return!r?undefined:Rr(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t)}function NG(e,t){var n=XH(e,(t||this).context);return n&&n.range?n.range():[]}function TG(e,t,n){var r=XH(e,(n||this).context);return r?r(t):undefined}function zG(e,t,n,r,i){e=XH(e,(i||this).context);var a=zx(t,n);var o=e.domain(),u=o[0],s=Ur(o),l=kr;if(!(s-u)){e=(e.interpolator?Nb("sequential")().interpolator(e.interpolator()):Nb("linear")().interpolate(e.interpolate()).range(e.range())).domain([u=0,s=1])}else{l=$b(e,u,s)}if(e.ticks){o=e.ticks(+r||15);if(u!==o[0])o.unshift(u);if(s!==Ur(o))o.push(s)}o.forEach((function(t){return a.stop(l(t),e(t))}));return a}function RG(e,t,n){var r=XH(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}function PG(e){var t=null;return function(n){return n?Zx(n,t=t||Bx(e)):e}}var LG=function(e){return e.data};function jG(e,t){var n=EH.call(t,e);return n.root&&n.root.lookup||{}}function BG(e,t,n){var r=jG(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(LG):undefined}function IG(e,t){var n=jG(e,this)[t];return n?n.ancestors().map(LG):undefined}var UG=function(){return typeof window!=="undefined"&&window||null};function qG(){var e=UG();return e?e.screen:{}}function WG(){var e=UG();return e?[e.innerWidth,e.innerHeight]:[undefined,undefined]}function HG(){var e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[undefined,undefined]}function GG(e,t,n){if(!e)return[];var r=e[0],i=e[1],a=(new Kw).set(r[0],r[1],i[0],i[1]),o=n||this.context.dataflow.scenegraph().root;return PS(o,a,$G(t))}function $G(e){var t=null;if(e){var n=oi(e.marktype),r=oi(e.markname);t=function(e){return(!n.length||n.some((function(t){return e.marktype===t})))&&(!r.length||r.some((function(t){return e.name===t})))}}return t}var VG={random:function(){return vd()},cumulativeNormal:Dd,cumulativeLogNormal:Td,cumulativeUniform:Bd,densityNormal:Ed,densityLogNormal:Nd,densityUniform:jd,quantileNormal:Sd,quantileLogNormal:zd,quantileUniform:Id,sampleNormal:Ad,sampleLogNormal:Od,sampleUniform:Ld,isArray:Rr,isBoolean:Si,isDate:Ci,isDefined:function(e){return e!==undefined},isNumber:Fi,isObject:Pr,isRegExp:Oi,isString:Ni,isTuple:Wf,isValid:function(e){return e!=null&&e===e},toBoolean:qi,toDate:Hi,toNumber:qr,toString:Gi,indexof:wG,join:xG,lastindexof:kG,replace:EG,reverse:DG,slice:AG,flush:Ai,lerp:zi,merge:lG,pad:Bi,peek:Ur,pluck:yG,span:Ii,inrange:Di,truncate:Vi,rgb:am,lab:Dm,hcl:Tm,hsl:dm,luminance:uG,contrast:sG,sequence:ko,format:FH,utcFormat:NH,utcParse:zH,utcOffset:ks,utcSequence:Ds,timeFormat:OH,timeParse:TH,timeOffset:ws,timeSequence:Es,timeUnitSpecifier:Vu,monthFormat:LH,monthAbbrevFormat:jH,dayFormat:BH,dayAbbrevFormat:IH,quarter:ii,utcquarter:ai,week:Qu,utcweek:rs,dayofyear:Ju,utcdayofyear:ns,warn:rG,info:iG,debug:aG,extent:yi,inScope:tG,intersect:GG,clampRange:ui,pinchDistance:pG,pinchAngle:gG,screen:qG,containerSize:HG,windowSize:WG,bandspace:SG,setdata:SH,pathShape:PG,panLinear:Xr,panLog:Jr,panPow:Qr,panSymlog:Zr,zoomLinear:ei,zoomLog:ti,zoomPow:ni,zoomSymlog:ri,encode:CH,modify:vG};var YG=["view","item","group","xy","x","y"],XG="event.vega.",JG="this.",QG={};var ZG={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_[".concat(Ui(HH+e),"]")},functions:e$,constants:$W,visitors:QG};var KG=XW(ZG);function e$(e){var t=VW(e);YG.forEach((function(e){return t[e]=XG+e}));for(var n in VG){t[n]=JG+n}mi(t,JH(e,VG,QG));return t}function t$(e,t,n){if(arguments.length===1){return VG[e]}VG[e]=t;if(n)QG[e]=n;if(KG)KG.functions[e]=JG+e;return this}t$("bandwidth",CG,VH);t$("copy",MG,VH);t$("domain",FG,VH);t$("range",NG,VH);t$("invert",OG,VH);t$("scale",TG,VH);t$("gradient",zG,VH);t$("geoArea",ZH,VH);t$("geoBounds",KH,VH);t$("geoCentroid",eG,VH);t$("geoShape",RG,VH);t$("indata",DH,$H);t$("data",EH,GH);t$("treePath",BG,GH);t$("treeAncestors",IG,GH);t$("vlSelectionTest",hH,AH);t$("vlSelectionIdTest",yH,AH);t$("vlSelectionResolve",bH,AH);t$("vlSelectionTuples",_H);function n$(e,t){var n={};var r;try{e=Ni(e)?e:Ui(e)+"";r=GW(e)}catch(a){_r("Expression parse error: "+e)}r.visit((function(e){if(e.type!==GU)return;var r=e.callee.name,i=ZG.visitors[r];if(i)i(r,e.arguments,t,n)}));var i=KG(r);i.globals.forEach((function(e){var r=HH+e;if(!xi(n,r)&&t.getSignal(e)){n[r]=t.signalRef(e)}}));return{$expr:mi({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}function r$(e){var t=this,n=e.operators||[];if(e.background){t.background=e.background}if(e.eventConfig){t.eventConfig=e.eventConfig}if(e.locale){t.locale=e.locale}n.forEach((function(e){return t.parseOperator(e)}));n.forEach((function(e){return t.parseOperatorParameters(e)}));(e.streams||[]).forEach((function(e){return t.parseStream(e)}));(e.updates||[]).forEach((function(e){return t.parseUpdate(e)}));return t.resolve()}var i$=$i(["rule"]),a$=$i(["group","image","rect"]);function o$(e,t){var n="";if(i$[t])return n;if(e.x2){if(e.x){if(a$[t]){n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"}n+="o.width=o.x2-o.x;"}else{n+="o.x=o.x2-(o.width||0);"}}if(e.xc){n+="o.x=o.xc-(o.width||0)/2;"}if(e.y2){if(e.y){if(a$[t]){n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"}n+="o.height=o.y2-o.y;"}else{n+="o.y=o.y2-(o.height||0);"}}if(e.yc){n+="o.y=o.yc-(o.height||0)/2;"}return n}function u$(e){return(e+"").toLowerCase()}function s$(e){return u$(e)==="operator"}function l$(e){return u$(e)==="collect"}function f$(e,t,n){if(n[n.length-1]!==";"){n="return("+n+");"}var r=Function.apply(void 0,t.concat(n));return e&&e.functions?r.bind(e.functions):r}function c$(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}var d$={operator:function(e,t){return f$(e,["_"],t.code)},parameter:function(e,t){return f$(e,["datum","_"],t.code)},event:function(e,t){return f$(e,["event"],t.code)},handler:function(e,t){var n="var datum=event.item&&event.item.datum;return ".concat(t.code,";");return f$(e,["_","event"],n)},encode:function(e,t){var n=t.marktype,r=t.channels;var i="var o=item,datum=o.datum,m=0,$;";for(var a in r){var o="o["+Ui(a)+"]";i+="$=".concat(r[a].code,";if(").concat(o,"!==$)").concat(o,"=$,m=1;")}i+=o$(r,n);i+="return m;";return f$(e,["item","_"],i)},codegen:{get:function(e){var t="[".concat(e.map(Ui).join("]["),"]");var n=Function("_","return _".concat(t,";"));n.path=t;return n},comparator:function(e,t){var n;var r=function(e,r){var i=t[r];var a,o;if(e.path){a="a".concat(e.path);o="b".concat(e.path)}else{(n=n||{})["f"+r]=e;a="this.f".concat(r,"(a)");o="this.f".concat(r,"(b)")}return c$(a,o,-i,i)};var i=Function("a","b","var u, v; return "+e.map(r).join("")+"0;");return n?i.bind(n):i}}};function h$(e){var t=this;if(s$(e.type)||!e.type){t.operator(e,e.update?t.operatorExpression(e.update):null)}else{t.transform(e,e.type)}}function v$(e){var t=this;if(e.params){var n=t.get(e.id);if(!n)_r("Invalid operator id: "+e.id);t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function p$(e,t){t=t||{};var n=this;for(var r in e){var i=e[r];t[r]=Rr(i)?i.map((function(e){return g$(e,n,t)})):g$(i,n,t)}return t}function g$(e,t,n){if(!e||!Pr(e))return e;for(var r=0,i=m$.length,a=void 0;r<i;++r){a=m$[r];if(xi(e,a.key)){return a.parse(e,t,n)}}return e}var m$=[{key:"$ref",parse:y$},{key:"$key",parse:b$},{key:"$expr",parse:_$},{key:"$field",parse:x$},{key:"$encode",parse:k$},{key:"$compare",parse:w$},{key:"$context",parse:A$},{key:"$subflow",parse:E$},{key:"$tupleid",parse:D$}];function y$(e,t){return t.get(e.$ref)||_r("Operator not defined: "+e.$ref)}function _$(e,t,n){if(e.$params){t.parseParameters(e.$params,n)}var r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=hr(t.parameterExpression(e.$expr),e.$fields,e.$name))}function b$(e,t){var n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Ti(e.$key,e.$flat,t.expr.codegen))}function x$(e,t){if(!e.$field)return null;var n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=xr(e.$field,e.$name,t.expr.codegen))}function w$(e,t){var n="c:"+e.$compare+"_"+e.$order,r=oi(e.$compare).map((function(e){return e&&e.$tupleid?Hf:e}));return t.fn[n]||(t.fn[n]=fi(r,e.$order,t.expr.codegen))}function k$(e,t){var n=e.$encode,r={};for(var i in n){var a=n[i];r[i]=hr(t.encodeExpression(a.$expr),a.$fields);r[i].output=a.$output}return r}function A$(e,t){return t}function E$(e,t){var n=e.$subflow;return function(e,r,i){var a=t.fork().parse(n),o=a.get(n.operators[0].id),u=a.signals.parent;if(u)u.set(i);o.detachSubflow=function(){return t.detach(a)};return o}}function D$(){return Hf}function S$(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):undefined,r=e.stream!=null?t.get(e.stream):undefined,i;if(e.source){r=t.events(e.source,e.type,n)}else if(e.merge){i=e.merge.map((function(e){return t.get(e)}));r=i[0].merge.apply(i[0],i.slice(1))}if(e.between){i=e.between.map((function(e){return t.get(e)}));r=r.between(i[0],i[1])}if(e.filter){r=r.filter(n)}if(e.throttle!=null){r=r.throttle(+e.throttle)}if(e.debounce!=null){r=r.debounce(+e.debounce)}if(r==null){_r("Invalid stream definition: "+JSON.stringify(e))}if(e.consume)r.consume(true);t.stream(e,r)}function C$(e){var t=this,n=Pr(n=e.source)?n.$ref:n,r=t.get(n),i=null,a=e.update,o=undefined;if(!r)_r("Source not defined: "+e.source);i=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target);if(a&&a.$expr){if(a.$params){o=t.parseParameters(a.$params)}a=t.handlerExpression(a.$expr)}t.update(e,r,i,a,o)}var M$={skip:true};function F$(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((function(n){var i=t.signals[n];if(e.signals(n,i)){r[n]=i.value}}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((function(n){var r=t.data[n];if(e.data(n,r)){i[n]=r.input.value}}))}if(t.subcontext&&e.recurse!==false){n.subcontext=t.subcontext.map((function(t){return t.getState(e)}))}return n}function O$(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((function(e){n.update(t.signals[e],i[e],M$)}));Object.keys(r||{}).forEach((function(e){n.pulse(t.data[e].input,n.changeset().remove(Dr).insert(r[e]))}));(e.subcontext||[]).forEach((function(e,n){var r=t.subcontext[n];if(r)r.setState(e)}))}function N$(e,t,n,r){return new T$(e,t,n,r)}function T$(e,t,n,r){this.dataflow=e;this.transforms=t;this.events=e.events.bind(e);this.expr=r||d$,this.signals={};this.scales={};this.nodes={};this.data={};this.fn={};if(n){this.functions=Object.create(n);this.functions.context=this}}function z$(e){this.dataflow=e.dataflow;this.transforms=e.transforms;this.events=e.events;this.expr=e.expr;this.signals=Object.create(e.signals);this.scales=Object.create(e.scales);this.nodes=Object.create(e.nodes);this.data=Object.create(e.data);this.fn=Object.create(e.fn);if(e.functions){this.functions=Object.create(e.functions);this.functions.context=this}}T$.prototype=z$.prototype={fork:function(){var e=new z$(this);(this.subcontext||(this.subcontext=[])).push(e);return e},detach:function(e){this.subcontext=this.subcontext.filter((function(t){return t!==e}));var t=Object.keys(e.nodes);for(var n=0,r=t;n<r.length;n++){var i=r[n];e.nodes[i]._targets=null}for(var a=0,o=t;a<o.length;a++){var u=o[a];e.nodes[u].detach()}e.nodes=null},get:function(e){return this.nodes[e]},set:function(e,t){return this.nodes[e]=t},add:function(e,t){var n=this,r=n.dataflow,i=e.value;n.set(e.id,t);if(l$(e.type)&&i){if(i.$ingest){r.ingest(t,i.$ingest,i.$format)}else if(i.$request){r.preload(t,i.$request,i.$format)}else{r.pulse(t,r.changeset().insert(i))}}if(e.root){n.root=t}if(e.parent){var a=n.get(e.parent.$ref);if(a){r.connect(a,[t]);t.targets().add(a)}else{(n.unresolved=n.unresolved||[]).push((function(){a=n.get(e.parent.$ref);r.connect(a,[t]);t.targets().add(a)}))}}if(e.signal){n.signals[e.signal]=t}if(e.scale){n.scales[e.scale]=t}if(e.data){var o=function(r){var i=n.data[r]||(n.data[r]={});e.data[r].forEach((function(e){return i[e]=t}))};for(var u in e.data){o(u)}}},resolve:function(){(this.unresolved||[]).forEach((function(e){return e()}));delete this.unresolved;return this},operator:function(e,t){this.add(e,this.dataflow.add(e.value,t))},transform:function(e,t){this.add(e,this.dataflow.add(this.transforms[u$(t)]))},stream:function(e,t){this.set(e.id,t)},update:function(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression:function(e){return this.expr.operator(this,e)},parameterExpression:function(e){return this.expr.parameter(this,e)},eventExpression:function(e){return this.expr.event(this,e)},handlerExpression:function(e){return this.expr.handler(this,e)},encodeExpression:function(e){return this.expr.encode(this,e)},parse:r$,parseOperator:h$,parseOperatorParameters:v$,parseParameters:p$,parseStream:S$,parseUpdate:C$,getState:F$,setState:O$};function R$(e){var t=e.container();if(t){t.setAttribute("role","graphics-document");t.setAttribute("aria-roleDescription","visualization");P$(t,e.description())}}function P$(e,t){if(e)t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t)}function L$(e){e.add(null,(function(t){e._background=t.bg;e._resize=1;return t.bg}),{bg:e._signals.background})}var j$="default";function B$(e){var t=e._signals.cursor||(e._signals.cursor=e.add({user:j$,item:null}));e.on(e.events("view","mousemove"),t,(function(e,n){var r=t.value,i=r?Ni(r)?r:r.user:j$,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}}));e.add(null,(function(t){var n=t.cursor,r=this.value;if(!Ni(n)){r=n.item;n=n.user}I$(e,n&&n!==j$?n:r||n);return r}),{cursor:t})}function I$(e,t){var n=e.globalCursor()?typeof document!=="undefined"&&document.body:e.container();if(n){return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}}function U$(e,t){var n=e._runtime.data;if(!xi(n,t)){_r("Unrecognized data set: "+t)}return n[t]}function q$(e,t){return arguments.length<2?U$(this,e).values.value:W$.call(this,e,Zf().remove(Dr).insert(t))}function W$(e,t){if(!Qf(t)){_r("Second argument to changes must be a changeset.")}var n=U$(this,e);n.modified=true;return this.pulse(n.input,t)}function H$(e,t){return W$.call(this,e,Zf().insert(t))}function G$(e,t){return W$.call(this,e,Zf().remove(t))}function $$(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function V$(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Y$(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function X$(e){var t=Y$(e),n=$$(e),r=V$(e);e._renderer.background(e.background());e._renderer.resize(n,r,t);e._handler.origin(t);e._resizeListeners.forEach((function(t){try{t(n,r)}catch(_r){e.error(_r)}}))}function J$(e,t,n){var r=e._renderer,i=r&&r.canvas(),a,o,u;if(i){u=Y$(e);o=t.changedTouches?t.changedTouches[0]:t;a=$E(o,i);a[0]-=u[0];a[1]-=u[1]}t.dataflow=e;t.item=n;t.vega=Q$(e,n,a);return t}function Q$(e,t,n){var r=t?t.mark.marktype==="group"?t:t.mark.group:null;function i(e){var n=r,i;if(e)for(i=t;i;i=i.mark.group){if(i.mark.name===e){n=i;break}}return n&&n.mark&&n.mark.interactive?n:{}}function a(e){if(!e)return n;if(Ni(e))e=i(e);var t=n.slice();while(e){t[0]-=e.x||0;t[1]-=e.y||0;e=e.mark&&e.mark.group}return t}return{view:pi(e),item:pi(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}var Z$="view",K$="timer",eV="window",tV={trap:false};function nV(e){var t=mi({defaults:{}},e);var n=function(e,t){t.forEach((function(t){if(Rr(e[t]))e[t]=$i(e[t])}))};n(t.defaults,["prevent","allow"]);n(t,["view","window","selector"]);return t}function rV(e,t,n,r){e._eventListeners.push({type:n,sources:oi(t),handler:r})}function iV(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return r===false||i===true?false:r===true||i===false?true:r?r[t]:i?!i[t]:e.preventDefault()}function aV(e,t,n){var r=e._eventConfig&&e._eventConfig[t];if(r===false||Pr(r)&&!r[n]){e.warn("Blocked "+t+" "+n+" event listener.");return false}return true}function oV(e,t,n){var r=this,i=new cc(n),a=function(n,a){r.runAsync(null,(function(){if(e===Z$&&iV(r,t)){n.preventDefault()}i.receive(J$(r,n,a))}))},o;if(e===K$){if(aV(r,"timer",t)){r.timer(a,t)}}else if(e===Z$){if(aV(r,"view",t)){r.addEventListener(t,a,tV)}}else{if(e===eV){if(aV(r,"window",t)&&typeof window!=="undefined"){o=[window]}}else if(typeof document!=="undefined"){if(aV(r,"selector",t)){o=document.querySelectorAll(e)}}if(!o){r.warn("Can not resolve event source: "+e)}else{for(var u=0,s=o.length;u<s;++u){o[u].addEventListener(t,a)}rV(r,o,t,a)}}return i}function uV(e){return e.item}function sV(e){return e.item.mark.source}function lV(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function fV(e,t){e=[e||"hover"];t=[t||"update",e[0]];this.on(this.events("view","mouseover",uV),sV,lV(e));this.on(this.events("view","mouseout",uV),sV,lV(t));return this}function cV(){var e=this._tooltip,t=this._timers,n=this._eventListeners,r,i,a;r=t.length;while(--r>=0){t[r].stop()}r=n.length;while(--r>=0){a=n[r];i=a.sources.length;while(--i>=0){a.sources[i].removeEventListener(a.type,a.handler)}}if(e){e.call(this,this._handler,null,null,null)}return this}function dV(e,t,n){var r=document.createElement(e);for(var i in t)r.setAttribute(i,t[i]);if(n!=null)r.textContent=n;return r}var hV="vega-bind",vV="vega-bind-name",pV="vega-bind-radio";function gV(e,t,n){if(!t)return;var r=n.param;var i=n.state;if(!i){i=n.state={elements:null,active:false,set:null,update:function(t){if(t!=e.signal(r.signal)){e.runAsync(null,(function(){i.source=true;e.signal(r.signal,t)}))}}};if(r.debounce){i.update=gi(r.debounce,i.update)}}var a=r.input==null&&r.element?mV:_V;a(i,t,r,e);if(!i.active){e.on(e._signals[r.signal],null,(function(){i.source?i.source=false:i.set(e.signal(r.signal))}));i.active=true}return i}function mV(e,t,n,r){var i=n.event||"input";var a=function(){return e.update(t.value)};r.signal(n.signal,t.value);t.addEventListener(i,a);rV(r,t,i,a);e.set=function(e){t.value=e;t.dispatchEvent(yV(i))}}function yV(e){return typeof Event!=="undefined"?new Event(e):{type:e}}function _V(e,t,n,r){var i=r.signal(n.signal);var a=dV("div",{class:hV});var o=n.input==="radio"?a:a.appendChild(dV("label"));o.appendChild(dV("span",{class:vV},n.name||n.signal));t.appendChild(a);var u=bV;switch(n.input){case"checkbox":u=xV;break;case"select":u=wV;break;case"radio":u=kV;break;case"range":u=AV;break}u(e,o,n,i)}function bV(e,t,n,r){var i=dV("input");for(var a in n){if(a!=="signal"&&a!=="element"){i.setAttribute(a==="input"?"type":a,n[a])}}i.setAttribute("name",n.signal);i.value=r;t.appendChild(i);i.addEventListener("input",(function(){return e.update(i.value)}));e.elements=[i];e.set=function(e){return i.value=e}}function xV(e,t,n,r){var i={type:"checkbox",name:n.signal};if(r)i.checked=true;var a=dV("input",i);t.appendChild(a);a.addEventListener("change",(function(){return e.update(a.checked)}));e.elements=[a];e.set=function(e){return a.checked=!!e||null}}function wV(e,t,n,r){var i=dV("select",{name:n.signal}),a=n.labels||[];n.options.forEach((function(e,t){var n={value:e};if(EV(e,r))n.selected=true;i.appendChild(dV("option",n,(a[t]||e)+""))}));t.appendChild(i);i.addEventListener("change",(function(){e.update(n.options[i.selectedIndex])}));e.elements=[i];e.set=function(e){for(var t=0,r=n.options.length;t<r;++t){if(EV(n.options[t],e)){i.selectedIndex=t;return}}}}function kV(e,t,n,r){var i=dV("span",{class:pV}),a=n.labels||[];t.appendChild(i);e.elements=n.options.map((function(t,o){var u={type:"radio",name:n.signal,value:t};if(EV(t,r))u.checked=true;var s=dV("input",u);s.addEventListener("change",(function(){return e.update(t)}));var l=dV("label",{},(a[o]||t)+"");l.prepend(s);i.appendChild(l);return s}));e.set=function(t){var n=e.elements,r=n.length;for(var i=0;i<r;++i){if(EV(n[i].value,t))n[i].checked=true}}}function AV(e,t,n,r){r=r!==undefined?r:(+n.max+ +n.min)/2;var i=n.max!=null?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||co(a,i,100);var u=dV("input",{type:"range",name:n.signal,min:a,max:i,step:o});u.value=r;var s=dV("span",{},+r);t.appendChild(u);t.appendChild(s);var l=function(){s.textContent=u.value;e.update(+u.value)};u.addEventListener("input",l);u.addEventListener("change",l);e.elements=[u];e.set=function(e){u.value=e;s.textContent=e}}function EV(e,t){return e===t||e+""===t+""}function DV(e,t,n,r,i,a){t=t||new r(e.loader());return t.initialize(n,$$(e),V$(e),Y$(e),i,a).background(e.background())}function SV(e,t){return!t?null:function(){try{t.apply(this,arguments)}catch(_r){e.error(_r)}}}function CV(e,t,n,r){var i=new r(e.loader(),SV(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Y$(e),e);if(t){t.handlers().forEach((function(e){i.on(e.type,e.handler)}))}return i}function MV(e,t){var n=this,r=n._renderType,i=n._eventConfig.bind,a=RS(r);e=n._el=e?FV(n,e,true):null;R$(n);if(!a)n.error("Unrecognized renderer type: "+r);var o=a.handler||_D,u=e?a.renderer:a.headless;n._renderer=!u?null:DV(n,n._renderer,e,u);n._handler=CV(n,n._handler,e,o);n._redraw=true;if(e&&i!=="none"){t=t?n._elBind=FV(n,t,true):e.appendChild(dV("form",{class:"vega-bindings"}));n._bind.forEach((function(e){if(e.param.element&&i!=="container"){e.element=FV(n,e.param.element,!!e.param.input)}}));n._bind.forEach((function(e){gV(n,e.element||t,e)}))}return n}function FV(e,t,n){if(typeof t==="string"){if(typeof document!=="undefined"){t=document.querySelector(t);if(!t){e.error("Signal bind element not found: "+t);return null}}else{e.error("DOM document instance not found.");return null}}if(t&&n){try{t.innerHTML=""}catch(Afe){t=null;e.error(Afe)}}return t}var OV=function(e){return+e||0};var NV=function(e){return{top:e,bottom:e,left:e,right:e}};function TV(e){return Pr(e)?{top:OV(e.top),bottom:OV(e.bottom),left:OV(e.left),right:OV(e.right)}:NV(OV(e))}function zV(e,t,n,r){return __awaiter(this,void 0,void 0,(function(){var i,a;return __generator(this,(function(o){switch(o.label){case 0:i=RS(t),a=i&&i.headless;if(!a)_r("Unrecognized renderer type: "+t);return[4,e.runAsync()];case 1:o.sent();return[2,DV(e,null,null,a,n,r).renderAsync(e._scenegraph.root)]}}))}))}function RV(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:if(e!==TS.Canvas&&e!==TS.SVG&&e!==TS.PNG){_r("Unrecognized image type: "+e)}return[4,zV(this,e,t)];case 1:n=r.sent();return[2,e===TS.SVG?PV(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")]}}))}))}function PV(e,t){var n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}function LV(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return[4,zV(this,TS.Canvas,e,t)];case 1:n=r.sent();return[2,n.canvas()]}}))}))}function jV(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,zV(this,TS.SVG,e)];case 1:t=n.sent();return[2,t.svg()]}}))}))}function BV(e,t,n){return N$(e,od,VG,n).parse(t)}function IV(e){var t=this._runtime.scales;if(!xi(t,e)){_r("Unrecognized scale or projection: "+e)}return t[e].value}var UV="width",qV="height",WV="padding",HV={skip:true};function GV(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===WV?r.left+r.right:0)}function $V(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===WV?r.top+r.bottom:0)}function VV(e){var t=e._signals,n=t[UV],r=t[qV],i=t[WV];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(function(t){e._width=t.size;e._viewWidth=GV(e,t.size);a()}),{size:n});e._resizeHeight=e.add(null,(function(t){e._height=t.size;e._viewHeight=$V(e,t.size);a()}),{size:r});var o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1;e._resizeHeight.rank=r.rank+1;o.rank=i.rank+1}function YV(e,t,n,r,i,a){this.runAfter((function(o){var u=0;o._autosize=0;if(o.width()!==n){u=1;o.signal(UV,n,HV);o._resizeWidth.skip(true)}if(o.height()!==r){u=1;o.signal(qV,r,HV);o._resizeHeight.skip(true)}if(o._viewWidth!==e){o._resize=1;o._viewWidth=e}if(o._viewHeight!==t){o._resize=1;o._viewHeight=t}if(o._origin[0]!==i[0]||o._origin[1]!==i[1]){o._resize=1;o._origin=i}if(u)o.run("enter");if(a)o.runAfter((function(e){return e.resize()}))}),false,1)}function XV(e){return this._runtime.getState(e||{data:JV,signals:QV,recurse:true})}function JV(e,t){return t.modified&&Rr(t.input.value)&&e.indexOf("_:vega:_")}function QV(e,t){return!(e==="parent"||t instanceof od.proxy)}function ZV(e){this.runAsync(null,(function(t){t._trigger=false;t._runtime.setState(e)}),(function(e){e._trigger=true}));return this}function KV(e,t){function n(t){e({timestamp:Date.now(),elapsed:t})}this._timers.push(mL(n,t))}function eY(e,t,n,r){var i=e.element();if(i)i.setAttribute("title",tY(r))}function tY(e){return e==null?"":Rr(e)?rY(e):Pr(e)&&!Ci(e)?nY(e):e+""}function nY(e){return Object.keys(e).map((function(t){var n=e[t];return t+": "+(Rr(n)?rY(n):iY(n))})).join("\n")}function rY(e){return"["+e.map(iY).join(", ")+"]"}function iY(e){return Rr(e)?"[…]":Pr(e)&&!Ci(e)?"{…}":e}function aY(e,t){var n=this;t=t||{};rd.call(n);if(t.loader)n.loader(t.loader);if(t.logger)n.logger(t.logger);if(t.logLevel!=null)n.logLevel(t.logLevel);if(t.locale||e.locale){var r=mi({},e.locale,t.locale);n.locale(Tf(r.number,r.time))}n._el=null;n._elBind=null;n._renderType=t.renderer||TS.Canvas;n._scenegraph=new BE;var i=n._scenegraph.root;n._renderer=null;n._tooltip=t.tooltip||eY,n._redraw=true;n._handler=(new _D).scene(i);n._globalCursor=false;n._preventDefault=false;n._timers=[];n._eventListeners=[];n._resizeListeners=[];n._eventConfig=nV(e.eventConfig);n.globalCursor(n._eventConfig.globalCursor);var a=BV(n,e,t.expr);n._runtime=a;n._signals=a.signals;n._bind=(e.bindings||[]).map((function(e){return{state:null,param:mi({},e)}}));if(a.root)a.root.set(i);i.source=a.data.root.input;n.pulse(a.data.root.input,n.changeset().insert(i.items));n._width=n.width();n._height=n.height();n._viewWidth=GV(n,n._width);n._viewHeight=$V(n,n._height);n._origin=[0,0];n._resize=0;n._autosize=1;VV(n);L$(n);B$(n);n.description(e.description);if(t.hover)n.hover();if(t.container)n.initialize(t.container,t.bind)}function oY(e,t){return xi(e._signals,t)?e._signals[t]:_r("Unrecognized signal name: "+Ui(t))}function uY(e,t){var n=(e._targets||[]).filter((function(e){return e._update&&e._update.handler===t}));return n.length?n[0]:null}function sY(e,t,n,r){var i=uY(n,r);if(!i){i=SV(e,(function(){return r(t,n.value)}));i.handler=r;e.on(n,null,i)}return e}function lY(e,t,n){var r=uY(t,n);if(r)t._targets.remove(r);return e}Ei(aY,rd,{evaluate:function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(i){switch(i.label){case 0:return[4,rd.prototype.evaluate.call(this,e,t)];case 1:i.sent();if(!(this._redraw||this._resize))return[3,6];i.label=2;case 2:i.trys.push([2,5,,6]);if(!this._renderer)return[3,4];if(this._resize){this._resize=0;X$(this)}return[4,this._renderer.renderAsync(this._scenegraph.root)];case 3:i.sent();i.label=4;case 4:this._redraw=false;return[3,6];case 5:r=i.sent();this.error(r);return[3,6];case 6:if(n)If(this,n);return[2,this]}}))}))},dirty:function(e){this._redraw=true;this._renderer&&this._renderer.dirty(e)},description:function(e){if(arguments.length){var t=e!=null?e+"":null;if(t!==this._desc)P$(this._el,this._desc=t);return this}return this._desc},container:function(){return this._el},scenegraph:function(){return this._scenegraph},origin:function(){return this._origin.slice()},signal:function(e,t,n){var r=oY(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width:function(e){return arguments.length?this.signal("width",e):this.signal("width")},height:function(e){return arguments.length?this.signal("height",e):this.signal("height")},padding:function(e){return arguments.length?this.signal("padding",TV(e)):TV(this.signal("padding"))},autosize:function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background:function(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer:function(e){if(!arguments.length)return this._renderType;if(!RS(e))_r("Unrecognized renderer type: "+e);if(e!==this._renderType){this._renderType=e;this._resetRenderer()}return this},tooltip:function(e){if(!arguments.length)return this._tooltip;if(e!==this._tooltip){this._tooltip=e;this._resetRenderer()}return this},loader:function(e){if(!arguments.length)return this._loader;if(e!==this._loader){rd.prototype.loader.call(this,e);this._resetRenderer()}return this},resize:function(){this._autosize=1;return this.touch(oY(this,"autosize"))},_resetRenderer:function(){if(this._renderer){this._renderer=null;this.initialize(this._el,this._elBind)}},_resizeView:YV,addEventListener:function(e,t,n){var r=t;if(!(n&&n.trap===false)){r=SV(this,t);r.raw=t}this._handler.on(e,r);return this},removeEventListener:function(e,t){var n=this._handler.handlers(e),r=n.length,i,a;while(--r>=0){a=n[r].type;i=n[r].handler;if(e===a&&(t===i||t===i.raw)){this._handler.off(a,i);break}}return this},addResizeListener:function(e){var t=this._resizeListeners;if(t.indexOf(e)<0){t.push(e)}return this},removeResizeListener:function(e){var t=this._resizeListeners,n=t.indexOf(e);if(n>=0){t.splice(n,1)}return this},addSignalListener:function(e,t){return sY(this,e,oY(this,e),t)},removeSignalListener:function(e,t){return lY(this,oY(this,e),t)},addDataListener:function(e,t){return sY(this,e,U$(this,e).values,t)},removeDataListener:function(e,t){return lY(this,U$(this,e).values,t)},globalCursor:function(e){if(arguments.length){if(this._globalCursor!==!!e){var t=I$(this,null);this._globalCursor=!!e;if(t)I$(this,t)}return this}else{return this._globalCursor}},preventDefault:function(e){if(arguments.length){this._preventDefault=e;return this}else{return this._preventDefault}},timer:KV,events:oV,finalize:cV,hover:fV,data:q$,change:W$,insert:H$,remove:G$,scale:IV,initialize:MV,toImageURL:RV,toCanvas:LV,toSVG:jV,getState:XV,setState:ZV});var fY="view",cY="[",dY="]",hY="{",vY="}",pY=":",gY=",",mY="@",yY=">",_Y=/[[\]{}]/,bY={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};var xY,wY;function kY(e,t,n){xY=t||fY;wY=n||bY;return DY(e.trim()).map(SY)}function AY(e){return wY[e]}function EY(e,t,n,r,i){var a=e.length;var o=0,u;for(;t<a;++t){u=e[t];if(!o&&u===n)return t;else if(i&&i.indexOf(u)>=0)--o;else if(r&&r.indexOf(u)>=0)++o}return t}function DY(e){var t=[],n=e.length;var r=0,i=0;while(i<n){i=EY(e,i,gY,cY+hY,dY+vY);t.push(e.substring(r,i).trim());r=++i}if(t.length===0){throw"Empty event selector: "+e}return t}function SY(e){return e[0]==="["?CY(e):MY(e)}function CY(e){var t=e.length;var n=1,r;n=EY(e,n,dY,cY,dY);if(n===t){throw"Empty between selector: "+e}r=DY(e.substring(1,n));if(r.length!==2){throw"Between selector must have two elements: "+e}e=e.slice(n+1).trim();if(e[0]!==yY){throw"Expected '>' after between selector: "+e}r=r.map(SY);var i=SY(e.slice(1).trim());if(i.between){return{between:r,stream:i}}else{i.between=r}return i}function MY(e){var t={source:xY},n=[];var r=[0,0],i=0,a=0,o=e.length,u=0,s,l;if(e[o-1]===vY){u=e.lastIndexOf(hY);if(u>=0){try{r=FY(e.substring(u+1,o-1))}catch(Afe){throw"Invalid throttle specification: "+e}e=e.slice(0,u).trim();o=e.length}else throw"Unmatched right brace: "+e;u=0}if(!o)throw e;if(e[0]===mY)i=++u;s=EY(e,u,pY);if(s<o){n.push(e.substring(a,s).trim());a=u=++s}u=EY(e,u,cY);if(u===o){n.push(e.substring(a,o).trim())}else{n.push(e.substring(a,u).trim());l=[];a=++u;if(a===o)throw"Unmatched left bracket: "+e}while(u<o){u=EY(e,u,dY);if(u===o)throw"Unmatched left bracket: "+e;l.push(e.substring(a,u).trim());if(u<o-1&&e[++u]!==cY)throw"Expected left bracket: "+e;a=++u}if(!(o=n.length)||_Y.test(n[o-1])){throw"Invalid event selector: "+e}if(o>1){t.type=n[1];if(i){t.markname=n[0].slice(1)}else if(AY(n[0])){t.marktype=n[0]}else{t.source=n[0]}}else{t.type=n[0]}if(t.type.slice(-1)==="!"){t.consume=true;t.type=t.type.slice(0,-1)}if(l!=null)t.filter=l;if(r[0])t.throttle=r[0];if(r[1])t.debounce=r[1];return t}function FY(e){var t=e.split(gY);if(!e.length||t.length>2)throw e;return t.map((function(t){var n=+t;if(n!==n)throw e;return n}))}function OY(e){return Pr(e)?e:{type:e||"pad"}}var NY=function(e){return+e||0};var TY=function(e){return{top:e,bottom:e,left:e,right:e}};function zY(e){return!Pr(e)?TY(NY(e)):e.signal?e:{top:NY(e.top),bottom:NY(e.bottom),left:NY(e.left),right:NY(e.right)}}var RY=function(e){return Pr(e)&&!Rr(e)?mi({},e):{value:e}};function PY(e,t,n,r){if(n!=null){var i=Pr(n)&&!Rr(n)||Rr(n)&&n.length&&Pr(n[0]);if(i){e.update[t]=n}else{e[r||"enter"][t]={value:n}}return 1}else{return 0}}function LY(e,t,n){for(var r in t){PY(e,r,t[r])}for(var i in n){PY(e,i,n[i],"update")}}function jY(e,t,n){for(var r in t){if(n&&xi(n,r))continue;e[r]=mi(e[r]||{},t[r])}return e}function BY(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var IY="mark";var UY="frame";var qY="scope";var WY="axis";var HY="axis-domain";var GY="axis-grid";var $Y="axis-label";var VY="axis-tick";var YY="axis-title";var XY="legend";var JY="legend-band";var QY="legend-entry";var ZY="legend-gradient";var KY="legend-label";var eX="legend-symbol";var tX="legend-title";var nX="title";var rX="title-text";var iX="title-subtitle";function aX(e,t,n,r,i){var a={},o={};var u,s,l,f;s="lineBreak";if(t==="text"&&i[s]!=null&&!BY(s,e)){oX(a,s,i[s])}if(n=="legend"||String(n).startsWith("axis")){n=null}f=n===UY?i.group:n===IY?mi({},i.mark,i[t]):null;for(s in f){l=BY(s,e)||(s==="fill"||s==="stroke")&&(BY("fill",e)||BY("stroke",e));if(!l)oX(a,s,f[s])}oi(r).forEach((function(t){var n=i.style&&i.style[t];for(var r in n){if(!BY(r,e)){oX(a,r,n[r])}}}));e=mi({},e);for(s in a){f=a[s];if(f.signal){(u=u||{})[s]=f}else{o[s]=f}}e.enter=mi(o,e.enter);if(u)e.update=mi(u,e.update);return e}function oX(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}var uX=function(e){return Ni(e)?Ui(e):e.signal?"(".concat(e.signal,")"):hX(e)};function sX(e){if(e.gradient!=null){return cX(e)}var t=e.signal?"(".concat(e.signal,")"):e.color?fX(e.color):e.field!=null?hX(e.field):e.value!==undefined?Ui(e.value):undefined;if(e.scale!=null){t=pX(e,t)}if(t===undefined){t=null}if(e.exponent!=null){t="pow(".concat(t,",").concat(dX(e.exponent),")")}if(e.mult!=null){t+="*".concat(dX(e.mult))}if(e.offset!=null){t+="+".concat(dX(e.offset))}if(e.round){t="round(".concat(t,")")}return t}var lX=function(e,t,n,r){return"(".concat(e,"(").concat([t,n,r].map(sX).join(","),")+'')")};function fX(e){return e.c?lX("hcl",e.h,e.c,e.l):e.h||e.s?lX("hsl",e.h,e.s,e.l):e.l||e.a?lX("lab",e.l,e.a,e.b):e.r||e.g||e.b?lX("rgb",e.r,e.g,e.b):null}function cX(e){var t=[e.start,e.stop,e.count].map((function(e){return e==null?null:Ui(e)}));while(t.length&&Ur(t)==null)t.pop();t.unshift(uX(e.gradient));return"gradient(".concat(t.join(","),")")}function dX(e){return Pr(e)?"("+sX(e)+")":e}function hX(e){return vX(Pr(e)?e:{datum:e})}function vX(e){var t,n,r;if(e.signal){t="datum";r=e.signal}else if(e.group||e.parent){n=Math.max(1,e.level||1);t="item";while(n-- >0){t+=".mark.group"}if(e.parent){r=e.parent;t+=".datum"}else{r=e.group}}else if(e.datum){t="datum";r=e.datum}else{_r("Invalid field reference: "+Ui(e))}if(!e.signal){r=Ni(r)?br(r).map(Ui).join("]["):vX(r)}return t+"["+r+"]"}function pX(e,t){var n=uX(e.scale);if(e.range!=null){t="lerp(_range(".concat(n,"), ").concat(+e.range,")")}else{if(t!==undefined)t="_scale(".concat(n,", ").concat(t,")");if(e.band){t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(+e.band===1?"":"*"+dX(e.band));if(e.extra){t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")")}}if(t==null)t="0"}return t}function gX(e){var t="";e.forEach((function(e){var n=sX(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n}));if(Ur(t)===":"){t+="null"}return t}function mX(e,t,n,r,i,a){var o={};a=a||{};a.encoders={$encode:o};e=aX(e,t,n,r,i.config);for(var u in e){o[u]=yX(e[u],t,a,i)}return a}function yX(e,t,n,r){var i={},a={};for(var o in e){if(e[o]!=null){i[o]=bX(_X(e[o]),r,n,a)}}return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function _X(e){return Rr(e)?gX(e):sX(e)}function bX(e,t,n,r){var i=n$(e,t);i.$fields.forEach((function(e){return r[e]=1}));mi(n,i.$params);return i.$expr}var xX="outer",wX=["value","update","init","react","bind"];function kX(e,t){_r(e+' for "outer" push: '+Ui(t))}function AX(e,t){var n=e.name;if(e.push===xX){if(!t.signals[n])kX("No prior signal definition",n);wX.forEach((function(t){if(e[t]!==undefined)kX("Invalid property ",t)}))}else{var r=t.addSignal(n,e.value);if(e.react===false)r.react=false;if(e.bind)t.addBinding(n,e.bind)}}function EX(e,t,n,r){this.id=-1;this.type=e;this.value=t;this.params=n;if(r)this.parent=r}function DX(e,t,n,r){return new EX(e,t,n,r)}function SX(e,t){return DX("operator",e,t)}function CX(e){var t={$ref:e.id};if(e.id<0)(e.refs=e.refs||[]).push(t);return t}function MX(e,t){return t?{$field:e,$name:t}:{$field:e}}var FX=MX("key");function OX(e,t){return{$compare:e,$order:t}}function NX(e,t){var n={$key:e};if(t)n.$flat=true;return n}var TX="ascending";var zX="descending";function RX(e){return!Pr(e)?"":(e.order===zX?"-":"+")+PX(e.op,e.field)}function PX(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var LX="scope";var jX="view";function BX(e){return e&&e.signal}function IX(e){return e&&e.expr}function UX(e){if(BX(e))return true;if(Pr(e))for(var t in e){if(UX(e[t]))return true}return false}function qX(e,t){return e!=null?e:t}function WX(e){return e&&e.signal||e}var HX="timer";function GX(e,t){var n=e.merge?VX:e.stream?YX:e.type?XX:_r("Invalid stream specification: "+Ui(e));return n(e,t)}function $X(e){return e===LX?jX:e||jX}function VX(e,t){var n=e.merge.map((function(e){return GX(e,t)})),r=JX({merge:n},e,t);return t.addStream(r).id}function YX(e,t){var n=GX(e.stream,t),r=JX({stream:n},e,t);return t.addStream(r).id}function XX(e,t){var n;if(e.type===HX){n=t.event(HX,e.throttle);e={between:e.between,filter:e.filter}}else{n=t.event($X(e.source),e.type)}var r=JX({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function JX(e,t,n){var r=t.between;if(r){if(r.length!==2){_r('Stream "between" parameter must have 2 entries: '+Ui(t))}e.between=[GX(r[0],n),GX(r[1],n)]}r=t.filter?[].concat(t.filter):[];if(t.marktype||t.markname||t.markrole){r.push(QX(t.marktype,t.markname,t.markrole))}if(t.source===LX){r.push("inScope(event.item)")}if(r.length){e.filter=n$("("+r.join(")&&(")+")",n).$expr}if((r=t.throttle)!=null){e.throttle=+r}if((r=t.debounce)!=null){e.debounce=+r}if(t.consume){e.consume=true}return e}function QX(e,t,n){var r="event.item";return r+(e&&e!=="*"?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}var ZX={code:"_.$value",ast:{type:"Identifier",value:"value"}};function KX(e,t,n){var r=e.encode,i={target:n};var a=e.events,o=e.update,u=[];if(!a){_r("Signal update missing events specification.")}if(Ni(a)){a=kY(a,t.isSubscope()?LX:jX)}a=oi(a).filter((function(e){return e.signal||e.scale?(u.push(e),0):1}));if(u.length>1){u=[tJ(u)]}if(a.length){u.push(a.length>1?{merge:a}:a[0])}if(r!=null){if(o)_r("Signal encode and update are mutually exclusive.");o="encode(item(),"+Ui(r)+")"}i.update=Ni(o)?n$(o,t):o.expr!=null?n$(o.expr,t):o.value!=null?o.value:o.signal!=null?{$expr:ZX,$params:{$value:t.signalRef(o.signal)}}:_r("Invalid signal update specification.");if(e.force){i.options={force:true}}u.forEach((function(e){return t.addUpdate(mi(eJ(e,t),i))}))}function eJ(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):GX(e,t)}}function tJ(e){return{signal:"["+e.map((function(e){return e.scale?'scale("'+e.scale+'")':e.signal}))+"]"}}function nJ(e,t){var n=t.getSignal(e.name);var r=e.update;if(e.init){if(r){_r("Signals can not include both init and update expressions.")}else{r=e.init;n.initonly=true}}if(r){r=n$(r,t);n.update=r.$expr;n.params=r.$params}if(e.on){e.on.forEach((function(e){return KX(e,t,n.id)}))}}var rJ=function(e){return function(t,n,r){return DX(e,n,t||undefined,r)}};var iJ=rJ("aggregate");var aJ=rJ("axisticks");var oJ=rJ("bound");var uJ=rJ("collect");var sJ=rJ("compare");var lJ=rJ("datajoin");var fJ=rJ("encode");var cJ=rJ("expression");var dJ=rJ("facet");var hJ=rJ("field");var vJ=rJ("key");var pJ=rJ("legendentries");var gJ=rJ("load");var mJ=rJ("mark");var yJ=rJ("multiextent");var _J=rJ("multivalues");var bJ=rJ("overlap");var xJ=rJ("params");var wJ=rJ("prefacet");var kJ=rJ("projection");var AJ=rJ("proxy");var EJ=rJ("relay");var DJ=rJ("render");var SJ=rJ("scale");var CJ=rJ("sieve");var MJ=rJ("sortitems");var FJ=rJ("viewlayout");var OJ=rJ("values");var NJ=0;var TJ={min:"min",max:"max",count:"sum"};function zJ(e,t){var n=e.type||"linear";if(!Tb(n)){_r("Unrecognized scale type: "+Ui(n))}t.addScale(e.name,{type:n,domain:undefined})}function RJ(e,t){var n=t.getScale(e.name).params;var r;n.domain=BJ(e.domain,e,t);if(e.range!=null){n.range=QJ(e,t,n)}if(e.interpolate!=null){JJ(e.interpolate,n)}if(e.nice!=null){n.nice=XJ(e.nice)}if(e.bins!=null){n.bins=YJ(e.bins,t)}for(r in e){if(xi(n,r)||r==="name")continue;n[r]=PJ(e[r],t)}}function PJ(e,t){return!Pr(e)?e:e.signal?t.signalRef(e.signal):_r("Unsupported object: "+Ui(e))}function LJ(e,t){return e.signal?t.signalRef(e.signal):e.map((function(e){return PJ(e,t)}))}function jJ(e){_r("Can not find data set: "+Ui(e))}function BJ(e,t,n){if(!e){if(t.domainMin!=null||t.domainMax!=null){_r("No scale domain defined for domainMin/domainMax to override.")}return}return e.signal?n.signalRef(e.signal):(Rr(e)?IJ:e.fields?qJ:UJ)(e,t,n)}function IJ(e,t,n){return e.map((function(e){return PJ(e,n)}))}function UJ(e,t,n){var r=n.getData(e.data);if(!r)jJ(e.data);return Pb(t.type)?r.valuesRef(n,e.field,GJ(e.sort,false)):Ub(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function qJ(e,t,n){var r=e.data,i=e.fields.reduce((function(e,t){t=Ni(t)?{data:r,field:t}:Rr(t)||t.signal?WJ(t,n):t;e.push(t);return e}),[]);return(Pb(t.type)?HJ:Ub(t.type)?$J:VJ)(e,n,i)}function WJ(e,t){var n="_:vega:_"+NJ++,r=uJ({});if(Rr(e)){r.value={$ingest:e}}else if(e.signal){var i="setdata("+Ui(n)+","+e.signal+")";r.params.input=t.signalRef(i)}t.addDataPipeline(n,[r,CJ({})]);return{data:n,field:"data"}}function HJ(e,t,n){var r=GJ(e.sort,true);var i,a;var o=n.map((function(e){var n=t.getData(e.data);if(!n)jJ(e.data);return n.countsRef(t,e.field,r)}));var u={groupby:FX,pulse:o};if(r){i=r.op||"count";a=r.field?PX(i,r.field):"count";u.ops=[TJ[i]];u.fields=[t.fieldRef(a)];u.as=[a]}i=t.add(iJ(u));var s=t.add(uJ({pulse:CX(i)}));a=t.add(OJ({field:FX,sort:t.sortRef(r),pulse:CX(s)}));return CX(a)}function GJ(e,t){if(e){if(!e.field&&!e.op){if(Pr(e))e.field="key";else e={field:"key"}}else if(!e.field&&e.op!=="count"){_r("No field provided for sort aggregate op: "+e.op)}else if(t&&e.field){if(e.op&&!TJ[e.op]){_r("Multiple domain scales can not be sorted using "+e.op)}}}return e}function $J(e,t,n){var r=n.map((function(e){var n=t.getData(e.data);if(!n)jJ(e.data);return n.domainRef(t,e.field)}));return CX(t.add(_J({values:r})))}function VJ(e,t,n){var r=n.map((function(e){var n=t.getData(e.data);if(!n)jJ(e.data);return n.extentRef(t,e.field)}));return CX(t.add(yJ({extents:r})))}function YJ(e,t){return e.signal||Rr(e)?LJ(e,t):t.objectProperty(e)}function XJ(e){return Pr(e)?{interval:PJ(e.interval),step:PJ(e.step)}:PJ(e)}function JJ(e,t){t.interpolate=PJ(e.type||e);if(e.gamma!=null){t.interpolateGamma=PJ(e.gamma)}}function QJ(e,t,n){var r=t.config.range;var i=e.range;if(i.signal){return t.signalRef(i.signal)}else if(Ni(i)){if(r&&xi(r,i)){e=mi({},e,{range:r[i]});return QJ(e,t,n)}else if(i==="width"){i=[0,{signal:"width"}]}else if(i==="height"){i=Pb(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]}else{_r("Unrecognized scale range value: "+Ui(i))}}else if(i.scheme){n.scheme=Rr(i.scheme)?LJ(i.scheme,t):PJ(i.scheme,t);if(i.extent)n.schemeExtent=LJ(i.extent,t);if(i.count)n.schemeCount=PJ(i.count,t);return}else if(i.step){n.rangeStep=PJ(i.step,t);return}else if(Pb(e.type)&&!Rr(i)){return BJ(i,e,t)}else if(!Rr(i)){_r("Unsupported range type: "+Ui(i))}return i.map((function(e){return(Rr(e)?LJ:PJ)(e,t)}))}function ZJ(e,t){var n=t.config.projection||{},r={};for(var i in e){if(i==="name")continue;r[i]=KJ(e[i],i,t)}for(var a in n){if(r[a]==null){r[a]=KJ(n[a],a,t)}}t.addProjection(e.name,r)}function KJ(e,t,n){return Rr(e)?e.map((function(e){return KJ(e,t,n)})):!Pr(e)?e:e.signal?n.signalRef(e.signal):t==="fit"?e:_r("Unsupported parameter object: "+Ui(e))}var eQ="top";var tQ="left";var nQ="right";var rQ="bottom";var iQ="center";var aQ="vertical";var oQ="start";var uQ="middle";var sQ="end";var lQ="index";var fQ="label";var cQ="offset";var dQ="perc";var hQ="perc2";var vQ="value";var pQ="guide-label";var gQ="guide-title";var mQ="group-title";var yQ="group-subtitle";var _Q="symbol";var bQ="gradient";var xQ="discrete";var wQ="size";var kQ="shape";var AQ="fill";var EQ="stroke";var DQ="strokeWidth";var SQ="strokeDash";var CQ="opacity";var MQ=[wQ,kQ,AQ,EQ,DQ,SQ,CQ];var FQ={name:1,style:1,interactive:1};var OQ={value:0};var NQ={value:1};var TQ="group";var zQ="rect";var RQ="rule";var PQ="symbol";var LQ="text";function jQ(e){e.type=TQ;e.interactive=e.interactive||false;return e}function BQ(e,t){var n=function(n,r){return qX(e[n],qX(t[n],r))};n.isVertical=function(n){return aQ===qX(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection))};n.gradientLength=function(){return qX(e.gradientLength,t.gradientLength||t.gradientWidth)};n.gradientThickness=function(){return qX(e.gradientThickness,t.gradientThickness||t.gradientHeight)};n.entryColumns=function(){return qX(e.columns,qX(t.columns,+n.isVertical(true)))};return n}function IQ(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function UQ(e,t,n){var r=t.config.style[n];return r&&r[e]}function qQ(e,t,n){return"item.anchor === '".concat(oQ,"' ? ").concat(e," : item.anchor === '").concat(sQ,"' ? ").concat(t," : ").concat(n)}var WQ=qQ(Ui(tQ),Ui(nQ),Ui(iQ));function HQ(e){var t=e("tickBand");var n=e("tickOffset"),r,i;if(!t){r=e("bandPosition");i=e("tickExtra")}else if(t.signal){r={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")};i={signal:"(".concat(t.signal,") === 'extent'")};if(!Pr(n)){n={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(n)}}}else if(t==="extent"){r=1;i=true;n=0}else{r=.5;i=false}return{extra:i,band:r,offset:n}}function GQ(e,t){return!t?e:!e?t:!Pr(e)?{value:e,offset:t}:Object.assign({},e,{offset:GQ(e.offset,t)})}function $Q(e,t){if(t){e.name=t.name;e.style=t.style||e.style;e.interactive=!!t.interactive;e.encode=jY(e.encode,t,FQ)}else{e.interactive=false}return e}function VQ(e,t,n,r){var i=BQ(e,n),a=i.isVertical(),o=i.gradientThickness(),u=i.gradientLength();var s,l,f,c,d;if(a){l=[0,1];f=[0,0];c=o;d=u}else{l=[0,0];f=[1,0];c=u;d=o}var h={enter:s={opacity:OQ,x:OQ,y:OQ,width:RY(c),height:RY(d)},update:mi({},s,{opacity:NQ,fill:{gradient:t,start:l,stop:f}}),exit:{opacity:OQ}};LY(h,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")});return $Q({type:zQ,role:ZY,encode:h},r)}function YQ(e,t,n,r,i){var a=BQ(e,n),o=a.isVertical(),u=a.gradientThickness(),s=a.gradientLength();var l,f,c,d,h="";o?(l="y",c="y2",f="x",d="width",h="1-"):(l="x",c="x2",f="y",d="height");var v={opacity:OQ,fill:{scale:t,field:vQ}};v[l]={signal:h+"datum."+dQ,mult:s};v[f]=OQ;v[c]={signal:h+"datum."+hQ,mult:s};v[d]=RY(u);var p={enter:v,update:mi({},v,{opacity:NQ}),exit:{opacity:OQ}};LY(p,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")});return $Q({type:zQ,role:JY,key:vQ,from:i,encode:p},r)}var XQ="datum.".concat(dQ,'<=0?"').concat(tQ,'":datum.').concat(dQ,'>=1?"').concat(nQ,'":"').concat(iQ,'"'),JQ="datum.".concat(dQ,'<=0?"').concat(rQ,'":datum.').concat(dQ,'>=1?"').concat(eQ,'":"').concat(uQ,'"');function QQ(e,t,n,r){var i=BQ(e,t),a=i.isVertical(),o=RY(i.gradientThickness()),u=i.gradientLength();var s=i("labelOverlap"),l,f,c,d,h="";var v={enter:l={opacity:OQ},update:f={opacity:NQ,text:{field:fQ}},exit:{opacity:OQ}};LY(v,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:qX(e.labelLimit,t.gradientLabelLimit)});if(a){l.align={value:"left"};l.baseline=f.baseline={signal:JQ};c="y";d="x";h="1-"}else{l.align=f.align={signal:XQ};l.baseline={value:"top"};c="x";d="y"}l[c]=f[c]={signal:h+"datum."+dQ,mult:u};l[d]=f[d]=o;o.offset=qX(e.labelOffset,t.gradientLabelOffset)||0;s=s?{separation:i("labelSeparation"),method:s,order:"datum."+lQ}:undefined;return $Q({type:LQ,role:KY,style:pQ,key:vQ,from:r,encode:v,overlap:s},n)}function ZQ(e,t,n,r,i){var a=BQ(e,t),o=n.entries,u=!!(o&&o.interactive),s=o?o.name:undefined,l=a("clipHeight"),f=a("symbolOffset"),c={data:"value"},d="(".concat(i,") ? datum.").concat(cQ," : datum.").concat(wQ),h=l?RY(l):{field:wQ},v="datum.".concat(lQ),p="max(1, ".concat(i,")");var g,m,y,_,b;h.mult=.5;g={enter:m={opacity:OQ,x:{signal:d,mult:.5,offset:f},y:h},update:y={opacity:NQ,x:m.x,y:m.y},exit:{opacity:OQ}};var x=null,w=null;if(!e.fill){x=t.symbolBaseFillColor;w=t.symbolBaseStrokeColor}LY(g,{fill:a("symbolFillColor",x),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",w),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")});MQ.forEach((function(t){if(e[t]){y[t]=m[t]={scale:e[t],field:vQ}}}));var k=$Q({type:PQ,role:eX,key:vQ,from:c,clip:l?true:undefined,encode:g},n.symbols);var A=RY(f);A.offset=a("labelOffset");g={enter:m={opacity:OQ,x:{signal:d,offset:A},y:h},update:y={opacity:NQ,text:{field:fQ},x:m.x,y:m.y},exit:{opacity:OQ}};LY(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});var E=$Q({type:LQ,role:KY,style:pQ,key:vQ,from:c,encode:g},n.labels);g={enter:{noBound:{value:!l},width:OQ,height:l?RY(l):OQ,opacity:OQ},exit:{opacity:OQ},update:y={opacity:NQ,row:{signal:null},column:{signal:null}}};if(a.isVertical(true)){_="ceil(item.mark.items.length / ".concat(p,")");y.row.signal="".concat(v,"%").concat(_);y.column.signal="floor(".concat(v," / ").concat(_,")");b={field:["row",v]}}else{y.row.signal="floor(".concat(v," / ").concat(p,")");y.column.signal="".concat(v," % ").concat(p);b={field:v}}y.column.signal="(".concat(i,")?").concat(y.column.signal,":").concat(v);r={facet:{data:r,name:"value",groupby:lQ}};return jQ({role:qY,from:r,encode:jY(g,o,FQ),marks:[k,E],name:s,interactive:u,sort:b})}function KQ(e,t){var n=BQ(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:true,column:false},padding:{row:n("rowPadding"),column:n("columnPadding")}}}var eZ='item.orient === "left"',tZ='item.orient === "right"',nZ="(".concat(eZ," || ").concat(tZ,")"),rZ="datum.vgrad && ".concat(nZ),iZ=qQ('"top"','"bottom"','"middle"'),aZ=qQ('"right"','"left"','"center"'),oZ="datum.vgrad && ".concat(tZ," ? (").concat(aZ,") : (").concat(nZ," && !(datum.vgrad && ").concat(eZ,')) ? "left" : ').concat(WQ),uZ="item._anchor || (".concat(nZ,' ? "middle" : "start")'),sZ="".concat(rZ," ? (").concat(eZ," ? -90 : 90) : 0"),lZ="".concat(nZ," ? (datum.vgrad ? (").concat(tZ,' ? "bottom" : "top") : ').concat(iZ,') : "top"');function fZ(e,t,n,r){var i=BQ(e,t);var a={enter:{opacity:OQ},update:{opacity:NQ,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:OQ}};LY(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:uZ},angle:{signal:sZ},align:{signal:oZ},baseline:{signal:lZ},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")});return $Q({type:LQ,role:tX,style:gQ,from:r,encode:a},n)}function cZ(e,t){var n;if(Pr(e)){if(e.signal){n=e.signal}else if(e.path){n="pathShape("+dZ(e.path)+")"}else if(e.sphere){n="geoShape("+dZ(e.sphere)+', {type: "Sphere"})'}}return n?t.signalRef(n):!!e}function dZ(e){return Pr(e)&&e.signal?e.signal:Ui(e)}function hZ(e){var t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===TQ?qY:t||IY}function vZ(e){return{marktype:e.type,name:e.name||undefined,role:e.role||hZ(e),zindex:+e.zindex||undefined,aria:e.aria,description:e.description}}function pZ(e,t){return e&&e.signal?t.signalRef(e.signal):e===false?false:true}function gZ(e,t){var n=ud(e.type);if(!n)_r("Unrecognized transform type: "+Ui(e.type));var r=DX(n.type.toLowerCase(),null,mZ(n,e,t));if(e.signal)t.addSignal(e.signal,t.proxy(r));r.metadata=n.metadata||{};return r}function mZ(e,t,n){var r={},i=e.params.length;for(var a=0;a<i;++a){var o=e.params[a];r[o.name]=yZ(o,t,n)}return r}function yZ(e,t,n){var r=e.type,i=t[e.name];if(r==="index"){return bZ(e,t,n)}else if(i===undefined){if(e.required){_r("Missing required "+Ui(t.type)+" parameter: "+Ui(e.name))}return}else if(r==="param"){return xZ(e,t,n)}else if(r==="projection"){return n.projectionRef(t[e.name])}return e.array&&!BX(i)?i.map((function(t){return _Z(e,t,n)})):_Z(e,i,n)}function _Z(e,t,n){var r=e.type;if(BX(t)){return DZ(r)?_r("Expression references can not be signals."):SZ(r)?n.fieldRef(t):CZ(r)?n.compareRef(t):n.signalRef(t.signal)}else{var i=e.expr||SZ(r);return i&&kZ(t)?n.exprRef(t.expr,t.as):i&&AZ(t)?MX(t.field,t.as):DZ(r)?n$(t,n):EZ(r)?CX(n.getData(t).values):SZ(r)?MX(t):CZ(r)?n.compareRef(t):t}}function bZ(e,t,n){if(!Ni(t.from)){_r('Lookup "from" parameter must be a string literal.')}return n.getData(t.from).lookupRef(n,t.key)}function xZ(e,t,n){var r=t[e.name];if(e.array){if(!Rr(r)){_r("Expected an array of sub-parameters. Instead: "+Ui(r))}return r.map((function(t){return wZ(e,t,n)}))}else{return wZ(e,r,n)}}function wZ(e,t,n){var r=e.params.length;var i;for(var a=0;a<r;++a){i=e.params[a];for(var o in i.key){if(i.key[o]!==t[o]){i=null;break}}if(i)break}if(!i)_r("Unsupported parameter: "+Ui(t));var u=mi(mZ(i,t,n),i.key);return CX(n.add(xJ(u)))}var kZ=function(e){return e&&e.expr};var AZ=function(e){return e&&e.field};var EZ=function(e){return e==="data"};var DZ=function(e){return e==="expr"};var SZ=function(e){return e==="field"};var CZ=function(e){return e==="compare"};function MZ(e,t,n){var r,i,a,o,u;if(!e){o=CX(n.add(uJ(null,[{}])))}else if(r=e.facet){if(!t)_r("Only group marks can be faceted.");if(r.field!=null){o=u=FZ(r,n)}else{if(!e.data){a=gZ(mi({type:"aggregate",groupby:oi(r.groupby)},r.aggregate),n);a.params.key=n.keyRef(r.groupby);a.params.pulse=FZ(r,n);o=u=CX(n.add(a))}else{u=CX(n.getData(e.data).aggregate)}i=n.keyRef(r.groupby,true)}}if(!o){o=FZ(e,n)}return{key:i,pulse:o,parent:u}}function FZ(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:CX(t.getData(e.data).output)}function OZ(e,t,n,r,i){this.scope=e;this.input=t;this.output=n;this.values=r;this.aggregate=i;this.index={}}OZ.fromEntries=function(e,t){var n=t.length,r=t[n-1],i=t[n-2];var a=t[0],o=null,u=1;if(a&&a.type==="load"){a=t[1]}e.add(t[0]);for(;u<n;++u){t[u].params.pulse=CX(t[u-1]);e.add(t[u]);if(t[u].type==="aggregate")o=t[u]}return new OZ(e,a,i,r,o)};function NZ(e){return Ni(e)?e:null}function TZ(e,t,n){var r=PX(n.op,n.field);var i;if(t.ops){for(var a=0,o=t.as.length;a<o;++a){if(t.as[a]===r)return}}else{t.ops=["count"];t.fields=[null];t.as=["count"]}if(n.op){t.ops.push((i=n.op.signal)?e.signalRef(i):n.op);t.fields.push(e.fieldRef(n.field));t.as.push(r)}}function zZ(e,t,n,r,i,a,o){var u=t[n]||(t[n]={}),s=RX(a);var l=NZ(i),f,c;if(l!=null){e=t.scope;l=l+(s?"|"+s:"");f=u[l]}if(!f){var d=a?{field:FX,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:CX(t.output)};if(s)d.sort=e.sortRef(a);c=e.add(DX(r,undefined,d));if(o)t.index[i]=c;f=CX(c);if(l!=null)u[l]=f}return f}OZ.prototype={countsRef:function(e,t,n){var r=this,i=r.counts||(r.counts={}),a=NZ(t);var o,u,s;if(a!=null){e=r.scope;o=i[a]}if(!o){s={groupby:e.fieldRef(t,"key"),pulse:CX(r.output)};if(n&&n.field)TZ(e,s,n);u=e.add(iJ(s));o=e.add(uJ({pulse:CX(u)}));o={agg:u,ref:CX(o)};if(a!=null)i[a]=o}else if(n&&n.field){TZ(e,o.agg.params,n)}return o.ref},tuplesRef:function(){return CX(this.values)},extentRef:function(e,t){return zZ(e,this,"extent","extent",t,false)},domainRef:function(e,t){return zZ(e,this,"domain","values",t,false)},valuesRef:function(e,t,n){return zZ(e,this,"vals","values",t,n||true)},lookupRef:function(e,t){return zZ(e,this,"lookup","tupleindex",t,false)},indataRef:function(e,t){return zZ(e,this,"indata","tupleindex",t,true,true)}};function RZ(e,t,n){var r=e.from.facet,i=r.name,a=FZ(r,t);var o;if(!r.name){_r("Facet must have a name: "+Ui(r))}if(!r.data){_r("Facet must reference a data set: "+Ui(r))}if(r.field){o=t.add(wJ({field:t.fieldRef(r.field),pulse:a}))}else if(r.groupby){o=t.add(dJ({key:t.keyRef(r.groupby),group:CX(t.proxy(n.parent)),pulse:a}))}else{_r("Facet must specify groupby or field: "+Ui(r))}var u=t.fork(),s=u.add(uJ()),l=u.add(CJ({pulse:CX(s)}));u.addData(i,new OZ(u,s,s,l));u.addSignal("parent",null);o.params.subflow={$subflow:u.parse(e).toRuntime()}}function PZ(e,t,n){var r=t.add(wJ({pulse:n.pulse})),i=t.fork();i.add(CJ());i.addSignal("parent",null);r.params.subflow={$subflow:i.parse(e).toRuntime()}}function LZ(e,t,n){var r=e.remove,i=e.insert,a=e.toggle,o=e.modify,u=e.values,s=t.add(SX());var l="if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,u].map((function(e){return e==null?"null":e})).join(",")+"),0)";var f=n$(l,t);s.update=f.$expr;s.params=f.$params}function jZ(e,t){var n=hZ(e),r=e.type===TQ,i=e.from&&e.from.facet,a=e.overlap;var o=e.layout||n===qY||n===UY,u,s,l,f,c,d,h;var v=n===IY||o||i;var p=MZ(e.from,r,t);s=t.add(lJ({key:p.key||(e.key?MX(e.key):undefined),pulse:p.pulse,clean:!r}));var g=CX(s);s=l=t.add(uJ({pulse:g}));s=t.add(mJ({markdef:vZ(e),interactive:pZ(e.interactive,t),clip:cZ(e.clip,t),context:{$context:true},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:CX(s)}));var m=CX(s);s=f=t.add(fJ(mX(e.encode,e.type,n,e.style,t,{mod:false,pulse:m})));s.params.parent=t.encode();if(e.transform){e.transform.forEach((function(e){var n=gZ(e,t),r=n.metadata;if(r.generates||r.changes){_r("Mark transforms should not generate new data.")}if(!r.nomod)f.params.mod=true;n.params.pulse=CX(s);t.add(s=n)}))}if(e.sort){s=t.add(MJ({sort:t.compareRef(e.sort),pulse:CX(s)}))}var y=CX(s);if(i||o){o=t.add(FJ({layout:t.objectProperty(e.layout),legends:t.legends,mark:m,pulse:y}));d=CX(o)}var _=t.add(oJ({mark:m,pulse:d||y}));h=CX(_);if(r){if(v){u=t.operators;u.pop();if(o)u.pop()}t.pushState(y,d||h,g);i?RZ(e,t,p):v?PZ(e,t,p):t.parse(e);t.popState();if(v){if(o)u.push(o);u.push(_)}}if(a){h=BZ(a,h,t)}var b=t.add(DJ({pulse:h})),x=t.add(CJ({pulse:CX(b)},undefined,t.parent()));if(e.name!=null){c=e.name;t.addData(c,new OZ(t,l,b,x));if(e.on)e.on.forEach((function(e){if(e.insert||e.remove||e.toggle){_r("Marks only support modify triggers.")}LZ(e,t,c)}))}}function BZ(e,t,n){var r=e.method,i=e.bound,a=e.separation;var o={separation:BX(a)?n.signalRef(a.signal):a,method:BX(r)?n.signalRef(r.signal):r,pulse:t};if(e.order){o.sort=n.compareRef({field:e.order})}if(i){var u=i.tolerance;o.boundTolerance=BX(u)?n.signalRef(u.signal):+u;o.boundScale=n.scaleRef(i.scale);o.boundOrient=i.orient}return CX(n.add(bJ(o)))}function IZ(e,t){var n=t.config.legend,r=e.encode||{},i=BQ(e,n),a=r.legend||{},o=a.name||undefined,u=a.interactive,s=a.style,l={};var f=0,c,d,h;MQ.forEach((function(t){return e[t]?(l[t]=e[t],f=f||e[t]):0}));if(!f)_r("Missing valid scale for legend.");var v=UZ(e,t.scaleType(f));var p={title:e.title!=null,scales:l,type:v,vgrad:v!=="symbol"&&i.isVertical()};var g=CX(t.add(uJ(null,[p])));var m={enter:{x:{value:0},y:{value:0}}};var y=CX(t.add(pJ(d={type:v,scale:t.scaleRef(f),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));if(v===bQ){h=[VQ(e,f,n,r.gradient),QQ(e,n,r.labels,y)];d.count=d.count||t.signalRef("max(2,2*floor((".concat(WX(i.gradientLength()),")/100))"))}else if(v===xQ){h=[YQ(e,f,n,r.gradient,y),QQ(e,n,r.labels,y)]}else{c=KQ(e,n);h=[ZQ(e,n,r,y,WX(c.columns))];d.size=HZ(e,t,h[0].marks)}h=[jQ({role:QY,from:g,encode:m,marks:h,layout:c,interactive:u})];if(p.title){h.push(fZ(e,n,r.title,g))}return jZ(jQ({role:XY,from:g,encode:jY(WZ(i,e,n),a,FQ),marks:h,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:u,style:s}),t)}function UZ(e,t){var n=e.type||_Q;if(!e.type&&qZ(e)===1&&(e.fill||e.stroke)){n=Rb(t)?bQ:Lb(t)?xQ:_Q}return n!==bQ?n:Lb(t)?xQ:bQ}function qZ(e){return MQ.reduce((function(t,n){return t+(e[n]?1:0)}),0)}function WZ(e,t,n){var r={enter:{},update:{}};LY(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType});return r}function HZ(e,t,n){var r=WX(GZ("size",e,n)),i=WX(GZ("strokeWidth",e,n)),a=WX($Z(n[1].encode,t,pQ));return n$("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}function GZ(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):IQ(e,n[0].encode)}function $Z(e,t,n){return IQ("fontSize",e)||UQ("fontSize",t,n)}var VZ='item.orient==="'.concat(tQ,'"?-90:item.orient==="').concat(nQ,'"?90:0');function YZ(e,t){e=Ni(e)?{text:e}:e;var n=BQ(e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||undefined,o=i.interactive,u=i.style,s=[];var l={},f=CX(t.add(uJ(null,[l])));s.push(QZ(e,n,XZ(e),f));if(e.subtitle){s.push(ZZ(e,n,r.subtitle,f))}return jZ(jQ({role:nX,from:f,encode:JZ(n,i),marks:s,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:u}),t)}function XZ(e){var t=e.encode;return t&&t.title||mi({name:e.name,interactive:e.interactive,style:e.style},t)}function JZ(e,t){var n={enter:{},update:{}};LY(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:WQ},angle:{signal:VZ},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")});return jY(n,t,FQ)}function QZ(e,t,n,r){var i={value:0},a=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};LY(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")});return $Q({type:LQ,role:rX,style:mQ,from:r,encode:o},n)}function ZZ(e,t,n,r){var i={value:0},a=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};LY(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")});return $Q({type:LQ,role:iX,style:yQ,from:r,encode:o},n)}function KZ(e,t){var n=[];if(e.transform){e.transform.forEach((function(e){n.push(gZ(e,t))}))}if(e.on){e.on.forEach((function(n){LZ(n,t,e.name)}))}t.addDataPipeline(e.name,eK(e,t,n))}function eK(e,t,n){var r=[];var i=null,a=false,o=false,u,s,l,f,c;if(e.values){if(BX(e.values)||UX(e.format)){r.push(nK(t,e));r.push(i=tK())}else{r.push(i=tK({$ingest:e.values,$format:e.format}))}}else if(e.url){if(UX(e.url)||UX(e.format)){r.push(nK(t,e));r.push(i=tK())}else{r.push(i=tK({$request:e.url,$format:e.format}))}}else if(e.source){i=u=oi(e.source).map((function(e){return CX(t.getData(e).output)}));r.push(null)}for(s=0,l=n.length;s<l;++s){f=n[s];c=f.metadata;if(!i&&!c.source){r.push(i=tK())}r.push(f);if(c.generates)o=true;if(c.modifies&&!o)a=true;if(c.source)i=f;else if(c.changes)i=null}if(u){l=u.length-1;r[0]=EJ({derive:a,pulse:l?u:u[0]});if(a||l){r.splice(1,0,tK())}}if(!i)r.push(tK());r.push(CJ({}));return r}function tK(e){var t=uJ({},e);t.metadata={source:true};return t}function nK(e,t){return gJ({url:t.url?e.property(t.url):undefined,async:t.async?e.property(t.async):undefined,values:t.values?e.property(t.values):undefined,format:e.objectProperty(t.format)})}var rK=function(e){return e===rQ||e===eQ};var iK=function(e,t,n){return BX(e)?cK(e.signal,t,n):e===tQ||e===eQ?t:n};var aK=function(e,t,n){return BX(e)?lK(e.signal,t,n):rK(e)?t:n};var oK=function(e,t,n){return BX(e)?fK(e.signal,t,n):rK(e)?n:t};var uK=function(e,t,n){return BX(e)?dK(e.signal,t,n):e===eQ?{value:t}:{value:n}};var sK=function(e,t,n){return BX(e)?hK(e.signal,t,n):e===nQ?{value:t}:{value:n}};var lK=function(e,t,n){return vK("".concat(e," === '").concat(eQ,"' || ").concat(e," === '").concat(rQ,"'"),t,n)};var fK=function(e,t,n){return vK("".concat(e," !== '").concat(eQ,"' && ").concat(e," !== '").concat(rQ,"'"),t,n)};var cK=function(e,t,n){return gK("".concat(e," === '").concat(tQ,"' || ").concat(e," === '").concat(eQ,"'"),t,n)};var dK=function(e,t,n){return gK("".concat(e," === '").concat(eQ,"'"),t,n)};var hK=function(e,t,n){return gK("".concat(e," === '").concat(nQ,"'"),t,n)};var vK=function(e,t,n){t=t!=null?RY(t):t;n=n!=null?RY(n):n;if(pK(t)&&pK(n)){t=t?t.signal||Ui(t.value):null;n=n?n.signal||Ui(n.value):null;return{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}}else{return[mi({test:e},t)].concat(n||[])}};var pK=function(e){return e==null||Object.keys(e).length===1};var gK=function(e,t,n){return{signal:"".concat(e," ? (").concat(yK(t),") : (").concat(yK(n),")")}};var mK=function(e,t,n,r,i){return{signal:(r!=null?"".concat(e," === '").concat(tQ,"' ? (").concat(yK(r),") : "):"")+(n!=null?"".concat(e," === '").concat(rQ,"' ? (").concat(yK(n),") : "):"")+(i!=null?"".concat(e," === '").concat(nQ,"' ? (").concat(yK(i),") : "):"")+(t!=null?"".concat(e," === '").concat(eQ,"' ? (").concat(yK(t),") : "):"")+"(null)"}};var yK=function(e){return BX(e)?e.signal:e==null?null:Ui(e)};var _K=function(e,t){return t===0?0:BX(e)?{signal:"(".concat(e.signal,") * ").concat(t)}:{value:e*t}};var bK=function(e,t){var n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function xK(e,t,n,r){var i;if(t&&xi(t,e)){return t[e]}else if(xi(n,e)){return n[e]}else if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[gQ][i]}else if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[pQ][i]}return null}function wK(e){var t={};for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!i)continue;for(var a in i)t[a]=1}return Object.keys(t)}function kK(e,t){var n=t.config,r=n.style,i=n.axis,a=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,u,s,l;if(BX(o)){var f=wK([n.axisX,n.axisY]),c=wK([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);u={};for(var d=0,h=f;d<h.length;d++){l=h[d];u[l]=aK(o,xK(l,n.axisX,i,r),xK(l,n.axisY,i,r))}s={};for(var v=0,p=c;v<p.length;v++){l=p[v];s[l]=mK(o.signal,xK(l,n.axisTop,i,r),xK(l,n.axisBottom,i,r),xK(l,n.axisLeft,i,r),xK(l,n.axisRight,i,r))}}else{u=o===eQ||o===rQ?n.axisX:n.axisY;s=n["axis"+o[0].toUpperCase()+o.slice(1)]}var g=u||s||a?mi({},i,u,s,a):i;return g}function AK(e,t,n,r){var i=BQ(e,t),a=e.orient;var o,u;var s={enter:o={opacity:OQ},update:u={opacity:NQ},exit:{opacity:OQ}};LY(s,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});var l=EK(e,0);var f=EK(e,1);o.x=u.x=aK(a,l,OQ);o.x2=u.x2=aK(a,f);o.y=u.y=oK(a,l,OQ);o.y2=u.y2=oK(a,f);return $Q({type:RQ,role:HY,from:r,encode:s},n)}function EK(e,t){return{scale:e.scale,range:t}}function DK(e,t,n,r,i){var a=BQ(e,t),o=e.orient,u=e.gridScale,s=iK(o,1,-1),l=SK(e.offset,s);var f,c,d;var h={enter:f={opacity:OQ},update:d={opacity:NQ},exit:c={opacity:OQ}};LY(h,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});var v={scale:e.scale,field:vQ,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")};var p=aK(o,{signal:"height"},{signal:"width"});var g=u?{scale:u,range:0,mult:s,offset:l}:{value:0,offset:l};var m=u?{scale:u,range:1,mult:s,offset:l}:mi(p,{mult:s,offset:l});f.x=d.x=aK(o,v,g);f.y=d.y=oK(o,v,g);f.x2=d.x2=oK(o,m);f.y2=d.y2=aK(o,m);c.x=aK(o,v);c.y=oK(o,v);return $Q({type:RQ,role:GY,key:vQ,from:r,encode:h},n)}function SK(e,t){if(t===1);else if(!Pr(e)){e=BX(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0)}else{var n=e=mi({},e);while(n.mult!=null){if(!Pr(n.mult)){n.mult=BX(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t;return e}else{n=n.mult=mi({},n.mult)}}n.mult=t}return e}function CK(e,t,n,r,i,a){var o=BQ(e,t),u=e.orient,s=iK(u,-1,1);var l,f,c;var d={enter:l={opacity:OQ},update:c={opacity:NQ},exit:f={opacity:OQ}};LY(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});var h=RY(i);h.mult=s;var v={scale:e.scale,field:vQ,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};c.y=l.y=aK(u,OQ,v);c.y2=l.y2=aK(u,h);f.x=aK(u,v);c.x=l.x=oK(u,OQ,v);c.x2=l.x2=oK(u,h);f.y=oK(u,v);return $Q({type:RQ,role:VY,key:vQ,from:r,encode:d},n)}function MK(e,t,n,r,i){return{signal:'flush(range("'+e+'"), '+'scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function FK(e,t,n,r,i,a){var o=BQ(e,t),u=e.orient,s=e.scale,l=iK(u,-1,1),f=WX(o("labelFlush")),c=WX(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");var v=f===0||!!f,p;var g=RY(i);g.mult=l;g.offset=RY(o("labelPadding")||0);g.offset.mult=l;var m={scale:s,field:vQ,band:.5,offset:GQ(a.offset,o("labelOffset"))};var y=aK(u,v?MK(s,f,'"left"','"right"','"center"'):{value:"center"},sK(u,"left","right"));var _=aK(u,uK(u,"bottom","top"),v?MK(s,f,'"top"','"bottom"','"middle"'):{value:"middle"});var b=MK(s,f,"-(".concat(c,")"),c,0);v=v&&c;var x={opacity:OQ,x:aK(u,m,g),y:oK(u,m,g)};var w={enter:x,update:p={opacity:NQ,text:{field:fQ},x:x.x,y:x.y,align:y,baseline:_},exit:{opacity:OQ,x:x.x,y:x.y}};LY(w,{dx:!d&&v?aK(u,b):null,dy:!h&&v?oK(u,b):null});LY(w,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});var k=o("labelBound");var A=o("labelOverlap");A=A||k?{separation:o("labelSeparation"),method:A,order:"datum.index",bound:k?{scale:s,orient:u,tolerance:k}:null}:undefined;if(p.align!==y){p.align=bK(p.align,y)}if(p.baseline!==_){p.baseline=bK(p.baseline,_)}return $Q({type:LQ,role:$Y,style:pQ,key:vQ,from:r,encode:w,overlap:A},n)}function OK(e,t,n,r){var i=BQ(e,t),a=e.orient,o=iK(a,-1,1);var u,s;var l={enter:u={opacity:OQ,anchor:RY(i("titleAnchor",null)),align:{signal:WQ}},update:s=mi({},u,{opacity:NQ,text:RY(e.title)}),exit:{opacity:OQ}};var f={signal:'lerp(range("'.concat(e.scale,'"), ').concat(qQ(0,1,.5),")")};s.x=aK(a,f);s.y=oK(a,f);u.angle=aK(a,OQ,_K(o,90));u.baseline=aK(a,uK(a,rQ,eQ),{value:rQ});s.angle=u.angle;s.baseline=u.baseline;LY(l,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")});NK(i,a,l,n);l.update.align=bK(l.update.align,u.align);l.update.angle=bK(l.update.angle,u.angle);l.update.baseline=bK(l.update.baseline,u.baseline);return $Q({type:LQ,role:YY,style:gQ,from:r,encode:l},n)}function NK(e,t,n,r){var i=function(e,t){return e!=null?(n.update[t]=bK(RY(e),n.update[t]),false):!BY(t,r)?true:false};var a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?RY(o):aK(t,RY(o),RY(a))}function TK(e,t){var n=kK(e,t),r=e.encode||{},i=r.axis||{},a=i.name||undefined,o=i.interactive,u=i.style,s=BQ(e,n),l=HQ(s);var f={scale:e.scale,ticks:!!s("ticks"),labels:!!s("labels"),grid:!!s("grid"),domain:!!s("domain"),title:e.title!=null};var c=CX(t.add(uJ({},[f])));var d=CX(t.add(aJ({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));var h=[];var v;if(f.grid){h.push(DK(e,n,r.grid,d,l))}if(f.ticks){v=s("tickSize");h.push(CK(e,n,r.ticks,d,v,l))}if(f.labels){v=f.ticks?v:0;h.push(FK(e,n,r.labels,d,v,l))}if(f.domain){h.push(AK(e,n,r.domain,c))}if(f.title){h.push(OK(e,n,r.title,c))}return jZ(jQ({role:WY,from:c,encode:jY(zK(s,e),i,FQ),marks:h,aria:s("aria"),description:s("description"),zindex:s("zindex"),name:a,interactive:o,style:u}),t)}function zK(e,t){var n={enter:{},update:{}};LY(n,{orient:e("orient"),offset:e("offset")||0,position:qX(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType});return n}function RK(e,t,n){var r=oi(e.signals),i=oi(e.scales);if(!n)r.forEach((function(e){return AX(e,t)}));oi(e.projections).forEach((function(e){return ZJ(e,t)}));i.forEach((function(e){return zJ(e,t)}));oi(e.data).forEach((function(e){return KZ(e,t)}));i.forEach((function(e){return RJ(e,t)}));(n||r).forEach((function(e){return nJ(e,t)}));oi(e.axes).forEach((function(e){return TK(e,t)}));oi(e.marks).forEach((function(e){return jZ(e,t)}));oi(e.legends).forEach((function(e){return IZ(e,t)}));if(e.title)YZ(e.title,t);t.parseLambdas();return t}var PK=function(e){return jY({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e)};function LK(e,t){var n=t.config;var r=CX(t.root=t.add(SX()));var i=BK(e,n);i.forEach((function(e){return AX(e,t)}));t.description=e.description||n.description;t.eventConfig=n.events;t.legends=t.objectProperty(n.legend&&n.legend.layout);t.locale=n.locale;var a=t.add(uJ());var o=t.add(fJ(mX(PK(e.encode),TQ,UY,e.style,t,{pulse:CX(a)})));var u=t.add(FJ({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:CX(o)}));t.operators.pop();t.pushState(CX(o),CX(u),null);RK(e,t,i);t.operators.push(u);var s=t.add(oJ({mark:r,pulse:CX(u)}));s=t.add(DJ({pulse:CX(s)}));s=t.add(CJ({pulse:CX(s)}));t.addData("root",new OZ(t,a,a,s));return t}function jK(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function BK(e,t){var n=function(n){return qX(e[n],t[n])},r=[jK("background",n("background")),jK("autosize",OY(n("autosize"))),jK("padding",zY(n("padding"))),jK("width",n("width")||0),jK("height",n("height")||0)],i=r.reduce((function(e,t){return e[t.name]=t,e}),{}),a={};oi(e.signals).forEach((function(e){if(xi(i,e.name)){e=mi(i[e.name],e)}else{r.push(e)}a[e.name]=e}));oi(t.signals).forEach((function(e){if(!xi(a,e.name)&&!xi(i,e.name)){r.push(e)}}));return r}function IK(e,t){this.config=e||{};this.options=t||{};this.bindings=[];this.field={};this.signals={};this.lambdas={};this.scales={};this.events={};this.data={};this.streams=[];this.updates=[];this.operators=[];this.eventConfig=null;this.locale=null;this._id=0;this._subid=0;this._nextsub=[0];this._parent=[];this._encode=[];this._lookup=[];this._markpath=[]}function UK(e){this.config=e.config;this.options=e.options;this.legends=e.legends;this.field=Object.create(e.field);this.signals=Object.create(e.signals);this.lambdas=Object.create(e.lambdas);this.scales=Object.create(e.scales);this.events=Object.create(e.events);this.data=Object.create(e.data);this.streams=[];this.updates=[];this.operators=[];this._id=0;this._subid=++e._nextsub[0];this._nextsub=e._nextsub;this._parent=e._parent.slice();this._encode=e._encode.slice();this._lookup=e._lookup.slice();this._markpath=e._markpath}IK.prototype=UK.prototype={parse:function(e){return RK(e,this)},fork:function(){return new UK(this)},isSubscope:function(){return this._subid>0},toRuntime:function(){this.finish();return{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id:function(){return(this._subid?this._subid+":":0)+this._id++},add:function(e){this.operators.push(e);e.id=this.id();if(e.refs){e.refs.forEach((function(t){t.$ref=e.id}));e.refs=null}return e},proxy:function(e){var t=e instanceof EX?CX(e):e;return this.add(AJ({value:t}))},addStream:function(e){this.streams.push(e);e.id=this.id();return e},addUpdate:function(e){this.updates.push(e);return e},finish:function(){var e,t;if(this.root)this.root.root=true;for(e in this.signals){this.signals[e].signal=e}for(e in this.scales){this.scales[e].scale=e}function n(e,t,n){var r,i;if(e){r=e.data||(e.data={});i=r[t]||(r[t]=[]);i.push(n)}}for(e in this.data){t=this.data[e];n(t.input,e,"input");n(t.output,e,"output");n(t.values,e,"values");for(var r in t.index){n(t.index[r],e,"index:"+r)}}return this},pushState:function(e,t,n){this._encode.push(CX(this.add(CJ({pulse:e}))));this._parent.push(t);this._lookup.push(n?CX(this.proxy(n)):null);this._markpath.push(-1)},popState:function(){this._encode.pop();this._parent.pop();this._lookup.pop();this._markpath.pop()},parent:function(){return Ur(this._parent)},encode:function(){return Ur(this._encode)},lookup:function(){return Ur(this._lookup)},markpath:function(){var e=this._markpath;return++e[e.length-1]},fieldRef:function(e,t){if(Ni(e))return MX(e,t);if(!e.signal){_r("Unsupported field reference: "+Ui(e))}var n=e.signal;var r=this.field[n];if(!r){var i={name:this.signalRef(n)};if(t)i.as=t;this.field[n]=r=CX(this.add(hJ(i)))}return r},compareRef:function(e){var t=this;var n=false;var r=function(e){return BX(e)?(n=true,t.signalRef(e.signal)):IX(e)?(n=true,t.exprRef(e.expr)):e};var i=oi(e.field).map(r),a=oi(e.order).map(r);return n?CX(this.add(sJ({fields:i,orders:a}))):OX(i,a)},keyRef:function(e,t){var n=false;var r=function(e){return BX(e)?(n=true,CX(i[e.signal])):e};var i=this.signals;e=oi(e).map(r);return n?CX(this.add(vJ({fields:e,flat:t}))):NX(e,t)},sortRef:function(e){if(!e)return e;var t=PX(e.op,e.field),n=e.order||TX;return n.signal?CX(this.add(sJ({fields:t,orders:this.signalRef(n.signal)}))):OX(t,n)},event:function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t});this.events[n]=r}return this.events[n]},hasOwnSignal:function(e){return xi(this.signals,e)},addSignal:function(e,t){if(this.hasOwnSignal(e)){_r("Duplicate signal name: "+Ui(e))}var n=t instanceof EX?t:this.add(SX(t));return this.signals[e]=n},getSignal:function(e){if(!this.signals[e]){_r("Unrecognized signal name: "+Ui(e))}return this.signals[e]},signalRef:function(e){if(this.signals[e]){return CX(this.signals[e])}else if(!xi(this.lambdas,e)){this.lambdas[e]=this.add(SX(null))}return CX(this.lambdas[e])},parseLambdas:function(){var e=Object.keys(this.lambdas);for(var t=0,n=e.length;t<n;++t){var r=e[t],i=n$(r,this),a=this.lambdas[r];a.params=i.$params;a.update=i.$expr}},property:function(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty:function(e){return!e||!Pr(e)?e:this.signalRef(e.signal||qK(e))},exprRef:function(e,t){var n={expr:n$(e,this)};if(t)n.expr.$name=t;return CX(this.add(cJ(n)))},addBinding:function(e,t){if(!this.bindings){_r("Nested signals do not support binding: "+Ui(e))}this.bindings.push(mi({signal:e},t))},addScaleProj:function(e,t){if(xi(this.scales,e)){_r("Duplicate scale or projection name: "+Ui(e))}this.scales[e]=this.add(t)},addScale:function(e,t){this.addScaleProj(e,SJ(t))},addProjection:function(e,t){this.addScaleProj(e,kJ(t))},getScale:function(e){if(!this.scales[e]){_r("Unrecognized scale name: "+Ui(e))}return this.scales[e]},scaleRef:function(e){return CX(this.getScale(e))},scaleType:function(e){return this.getScale(e).params.type},projectionRef:function(e){return this.scaleRef(e)},projectionType:function(e){return this.scaleType(e)},addData:function(e,t){if(xi(this.data,e)){_r("Duplicate data set name: "+Ui(e))}return this.data[e]=t},getData:function(e){if(!this.data[e]){_r("Undefined data set name: "+Ui(e))}return this.data[e]},addDataPipeline:function(e,t){if(xi(this.data,e)){_r("Duplicate data set name: "+Ui(e))}return this.addData(e,OZ.fromEntries(this,t))}};function qK(e){return(Rr(e)?WK:HK)(e)}function WK(e){var t=e.length;var n="[";for(var r=0;r<t;++r){var i=e[r];n+=(r>0?",":"")+(Pr(i)?i.signal||qK(i):Ui(i))}return n+"]"}function HK(e){var t="{",n=0,r,i;for(r in e){i=e[r];t+=(++n>1?",":"")+Ui(r)+":"+(Pr(i)?i.signal||qK(i):Ui(i))}return t+"}"}function GK(){var e="sans-serif",t=30,n=2,r="#4c78a8",i="#000",a="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:r},area:{fill:r},image:null,line:{stroke:r,strokeWidth:n},path:{stroke:r},rect:{fill:r},rule:{stroke:i},shape:{stroke:r},symbol:{fill:r,size:64},text:{fill:i,font:e,fontSize:11},trail:{fill:r,size:n},style:{"guide-label":{fill:i,font:e,fontSize:10},"guide-title":{fill:i,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:i,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:i,font:e,fontSize:12},point:{size:t,strokeWidth:n,shape:"circle"},circle:{size:t,strokeWidth:n},square:{size:t,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:true,domainWidth:1,domainColor:a,grid:false,gridWidth:1,gridColor:o,labels:true,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:true,tickColor:a,tickOffset:0,tickRound:true,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:true,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:a,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function $K(e,t,n){if(!Pr(e)){_r("Input Vega specification must be an object.")}t=jr(GK(),t,e.config);return LK(e,new IK(t,n)).toRuntime()}var VK="vega";var YK="5.20.2";var XK="The Vega visualization grammar.";var JK=["vega","visualization","interaction","dataflow","library","data","d3"];var QK="BSD-3-Clause";var ZK="UW Interactive Data Lab (http://idl.cs.washington.edu)";var KK="build/vega-node.js";var e0="build/vega.module.js";var t0="build/vega.min.js";var n0="build/vega.min.js";var r0="index.d.ts";var i0="vega/vega";var a0={bundle:"rollup -c --config-bundle",prebuild:"rimraf build && rimraf build-es5",build:"rollup -c --config-core --config-bundle --config-ie",postbuild:"node schema-copy",pretest:"yarn build --config-test",test:"TZ=America/Los_Angeles tape 'test/**/*-test.js'",prepublishOnly:"yarn test && yarn build",postpublish:"./schema-deploy.sh"};var o0={"vega-crossfilter":"~4.0.5","vega-dataflow":"~5.7.4","vega-encode":"~4.8.3","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-force":"~4.0.7","vega-format":"~1.0.4","vega-functions":"~5.12.0","vega-geo":"~4.3.8","vega-hierarchy":"~4.0.9","vega-label":"~1.0.0","vega-loader":"~4.4.0","vega-parser":"~6.1.3","vega-projection":"~1.4.5","vega-regression":"~1.0.9","vega-runtime":"~6.1.3","vega-scale":"~7.1.1","vega-scenegraph":"~4.9.4","vega-statistics":"~1.7.9","vega-time":"~2.0.4","vega-transforms":"~4.9.4","vega-typings":"~0.21.0","vega-util":"~1.16.1","vega-view":"~5.10.1","vega-view-transforms":"~4.5.8","vega-voronoi":"~4.1.5","vega-wordcloud":"~4.1.3"};var u0={"vega-schema":"*"};var s0="e251dbc61ab6645689d9f349e7dd9d15ddb85bce";var l0={name:VK,version:YK,description:XK,keywords:JK,license:QK,author:ZK,main:KK,module:e0,unpkg:t0,jsdelivr:n0,types:r0,repository:i0,scripts:a0,dependencies:o0,devDependencies:u0,gitHead:s0};mi(od,ip,DM,EF,hP,qL,EI,RB,OI,sU,EU,jU);var f0=l0.version;var c0=Object.freeze({__proto__:null,version:f0,Dataflow:rd,EventStream:cc,MultiPulse:Uc,Operator:oc,Parameters:ec,Pulse:Lc,Transform:ad,changeset:Zf,definition:ud,ingest:$f,isTuple:Wf,transform:sd,transforms:od,tupleid:Hf,interpolate:Vb,interpolateColors:Hb,interpolateRange:Wb,quantizeInterpolator:Gb,scale:Nb,scheme:ex,projection:yR,View:aY,defaultLocale:zf,formatLocale:Ef,locale:Tf,resetDefaultLocale:Rf,timeFormatLocale:Of,expressionFunction:t$,parse:$K,runtimeContext:N$,codegenExpression:XW,parseExpression:GW,parseSelector:kY,Debug:Tr,Error:Fr,Info:Nr,None:Mr,Warn:Or,accessor:hr,accessorFields:pr,accessorName:vr,array:oi,ascending:ci,clampRange:ui,compare:fi,constant:pi,debounce:gi,error:_r,extend:mi,extent:yi,extentIndex:_i,falsy:Sr,fastmap:ki,field:xr,flush:Ai,hasOwnProperty:xi,id:wr,identity:kr,inherits:Ei,inrange:Di,isArray:Rr,isBoolean:Si,isDate:Ci,isFunction:si,isIterable:Mi,isNumber:Fi,isObject:Pr,isRegExp:Oi,isString:Ni,key:Ti,lerp:zi,logger:zr,lruCache:Pi,merge:Li,mergeConfig:jr,one:Er,pad:Bi,panLinear:Xr,panLog:Jr,panPow:Qr,panSymlog:Zr,peek:Ur,quarter:ii,repeat:ji,span:Ii,splitAccessPath:br,stringValue:Ui,toBoolean:qi,toDate:Hi,toNumber:qr,toSet:$i,toString:Gi,truncate:Vi,truthy:Dr,utcquarter:ai,visitArray:Yi,writeConfig:Br,zero:Ar,zoomLinear:ei,zoomLog:ti,zoomPow:ni,zoomSymlog:ri,bandwidthNRD:dd,bin:hd,bootstrapCI:gd,cumulativeLogNormal:Td,cumulativeNormal:Dd,cumulativeUniform:Bd,densityLogNormal:Nd,densityNormal:Ed,densityUniform:jd,dotbin:md,quantileLogNormal:zd,quantileNormal:Sd,quantileUniform:Id,quantiles:fd,quartiles:cd,get random(){return vd},randomInteger:bd,randomKDE:Fd,randomLCG:_d,randomLogNormal:Rd,randomMixture:Pd,randomNormal:Md,randomUniform:Ud,regressionExp:Yd,regressionLinear:$d,regressionLoess:nh,regressionLog:Vd,regressionPoly:Qd,regressionPow:Xd,regressionQuad:Jd,sampleCurve:uh,sampleLogNormal:Od,sampleNormal:Ad,sampleUniform:Ld,setRandom:pd,DATE:Pu,DAY:Lu,DAYOFYEAR:ju,HOURS:Bu,MILLISECONDS:qu,MINUTES:Iu,MONTH:zu,QUARTER:Tu,SECONDS:Uu,TIME_UNITS:Wu,WEEK:Ru,YEAR:Nu,dayofyear:Ju,timeBin:Ws,timeFloor:hs,timeInterval:_s,timeOffset:ws,timeSequence:Es,timeUnitSpecifier:Vu,timeUnits:Gu,utcFloor:gs,utcInterval:bs,utcOffset:ks,utcSequence:Ds,utcdayofyear:ns,utcweek:rs,week:Qu,read:Pf,inferType:va,inferTypes:pa,typeParsers:ca,format:Ga,formats:$a,responseType:Va,loader:jf,Bounds:Kw,CanvasHandler:_D,CanvasRenderer:CD,Gradient:zx,GroupItem:tk,Handler:YE,Item:ek,Marks:OE,RenderType:TS,Renderer:JE,ResourceLoader:nk,SVGHandler:ND,SVGRenderer:fS,SVGStringRenderer:SS,Scenegraph:BE,boundClip:qS,boundContext:Ak,boundItem:NE,boundMark:zE,boundStroke:ak,domChild:WE,domClear:HE,domCreate:UE,domFind:qE,font:_E,fontFamily:yE,fontSize:fE,intersect:PS,intersectBoxLine:Rk,intersectPath:Ok,intersectPoint:Nk,intersectRule:zk,lineHeight:cE,markup:nS,multiLineOffset:vE,pathCurves:Px,pathEqual:GS,pathParse:Bx,pathRectangle:dw,pathRender:Zx,pathSymbols:nw,pathTrail:hw,point:$E,renderModule:RS,resetSVGClipId:Qw,resetSVGDefIds:VS,sceneEqual:HS,sceneFromJSON:LE,scenePickVisit:Vk,sceneToJSON:PE,sceneVisit:$k,sceneZOrder:Gk,serializeXML:rS,textMetrics:iE});var d0="vega-lite";var h0='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer';var v0="5.1.0";var p0=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"];var g0="https://vega.github.io/vega-lite/";var m0="Vega-Lite is a concise high-level language for interactive visualization.";var y0="build/vega-lite.js";var _0="build/vega-lite.min.js";var b0="build/vega-lite.min.js";var x0="build/src/index";var w0="build/src/index.d.ts";var k0={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"};var A0={test:"test"};var E0=["bin","build","src","vega-lite*","tsconfig.json"];var D0={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:cover":"jest --collectCoverage test/","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"jest --watch test/"};var S0={type:"git",url:"https://github.com/vega/vega-lite.git"};var C0="BSD-3-Clause";var M0={url:"https://github.com/vega/vega-lite/issues"};var F0={"@babel/core":"^7.13.15","@babel/preset-env":"^7.13.15","@babel/preset-typescript":"^7.13.0","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^18.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.1","@types/chai":"^4.2.16","@types/d3":"^6.3.0","@types/jest":"^26.0.22","@types/mkdirp":"^1.0.1","@types/pako":"^1.0.1","@typescript-eslint/eslint-plugin":"^4.22.0","@typescript-eslint/parser":"^4.22.0",ajv:"^8.1.0","ajv-formats":"^2.0.2",chai:"^4.3.4",cheerio:"^1.0.0-rc.6","conventional-changelog-cli":"^2.1.1",d3:"^6.7.0","del-cli":"^3.0.1",eslint:"^7.24.0","eslint-config-prettier":"^8.2.0","eslint-plugin-jest":"^24.3.5","eslint-plugin-prettier":"^3.4.0","gh-pages":"^3.1.0","highlight.js":"^10.7.2",jest:"^26.6.3","jest-dev-server":"^5.0.0",mkdirp:"^1.0.4",pako:"^2.0.3",prettier:"^2.2.1",puppeteer:"^8.0.0",rollup:"^2.45.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^11.3.2",terser:"^5.6.1","ts-json-schema-generator":"^0.90.0",typescript:"~4.2.4","vega-cli":"^5.20.2","vega-datasets":"~2.2.0","vega-embed":"^6.17.0","vega-tooltip":"^0.25.1","yaml-front-matter":"^4.1.1"};var O0={"@types/clone":"~2.1.0","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.2.0","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-util":"~1.16.1",yargs:"~16.2.0"};var N0={vega:"^5.20.0"};var T0={testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:false,setupFiles:["./test/jest.overrides.ts"]};var z0={name:d0,author:h0,version:v0,collaborators:p0,homepage:g0,description:m0,main:y0,unpkg:_0,jsdelivr:b0,module:x0,types:w0,bin:k0,directories:A0,files:E0,scripts:D0,repository:S0,license:C0,bugs:M0,devDependencies:F0,dependencies:O0,peerDependencies:N0,jest:T0};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var R0=f((function(e){var t=function(){function e(e,t){return t!=null&&e instanceof t}var t;try{t=Map}catch(f){t=function(){}}var n;try{n=Set}catch(f){n=function(){}}var r;try{r=Promise}catch(f){r=function(){}}function i(a,o,u,s,f){if(typeof o==="object"){u=o.depth;s=o.prototype;f=o.includeNonEnumerable;o=o.circular}var c=[];var d=[];var h=typeof Buffer!="undefined";if(typeof o=="undefined")o=true;if(typeof u=="undefined")u=Infinity;function v(a,u){if(a===null)return null;if(u===0)return a;var p;var g;if(typeof a!="object"){return a}if(e(a,t)){p=new t}else if(e(a,n)){p=new n}else if(e(a,r)){p=new r((function(e,t){a.then((function(t){e(v(t,u-1))}),(function(e){t(v(e,u-1))}))}))}else if(i.__isArray(a)){p=[]}else if(i.__isRegExp(a)){p=new RegExp(a.source,l(a));if(a.lastIndex)p.lastIndex=a.lastIndex}else if(i.__isDate(a)){p=new Date(a.getTime())}else if(h&&Buffer.isBuffer(a)){if(Buffer.allocUnsafe){p=Buffer.allocUnsafe(a.length)}else{p=new Buffer(a.length)}a.copy(p);return p}else if(e(a,Error)){p=Object.create(a)}else{if(typeof s=="undefined"){g=Object.getPrototypeOf(a);p=Object.create(g)}else{p=Object.create(s);g=s}}if(o){var m=c.indexOf(a);if(m!=-1){return d[m]}c.push(a);d.push(p)}if(e(a,t)){a.forEach((function(e,t){var n=v(t,u-1);var r=v(e,u-1);p.set(n,r)}))}if(e(a,n)){a.forEach((function(e){var t=v(e,u-1);p.add(t)}))}for(var y in a){var _;if(g){_=Object.getOwnPropertyDescriptor(g,y)}if(_&&_.set==null){continue}p[y]=v(a[y],u-1)}if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(a);for(var y=0;y<b.length;y++){var x=b[y];var w=Object.getOwnPropertyDescriptor(a,x);if(w&&!w.enumerable&&!f){continue}p[x]=v(a[x],u-1);if(!w.enumerable){Object.defineProperty(p,x,{enumerable:false})}}}if(f){var k=Object.getOwnPropertyNames(a);for(var y=0;y<k.length;y++){var A=k[y];var w=Object.getOwnPropertyDescriptor(a,A);if(w&&w.enumerable){continue}p[A]=v(a[A],u-1);Object.defineProperty(p,A,{enumerable:false})}}return p}return v(a,u)}i.clonePrototype=function e(t){if(t===null)return null;var n=function(){};n.prototype=t;return new n};function a(e){return Object.prototype.toString.call(e)}i.__objToStr=a;function o(e){return typeof e==="object"&&a(e)==="[object Date]"}i.__isDate=o;function u(e){return typeof e==="object"&&a(e)==="[object Array]"}i.__isArray=u;function s(e){return typeof e==="object"&&a(e)==="[object RegExp]"}i.__isRegExp=s;function l(e){var t="";if(e.global)t+="g";if(e.ignoreCase)t+="i";if(e.multiline)t+="m";return t}i.__getRegExpFlags=l;return i}();if(e.exports){e.exports=t}}));var P0=function e(t,n){if(t===n)return true;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return false;var r,i,a;if(Array.isArray(t)){r=t.length;if(r!=n.length)return false;for(i=r;i--!==0;)if(!e(t[i],n[i]))return false;return true}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();a=Object.keys(t);r=a.length;if(r!==Object.keys(n).length)return false;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return false;for(i=r;i--!==0;){var o=a[i];if(!e(t[o],n[o]))return false}return true}return t!==t&&n!==n};var L0=function(e,t){if(!t)t={};if(typeof t==="function")t={cmp:t};var n=typeof t.cycles==="boolean"?t.cycles:false;var r=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]};var a={key:r,value:t[r]};return e(i,a)}}}(t.cmp);var i=[];return function e(t){if(t&&t.toJSON&&typeof t.toJSON==="function"){t=t.toJSON()}if(t===undefined)return;if(typeof t=="number")return isFinite(t)?""+t:"null";if(typeof t!=="object")return JSON.stringify(t);var a,o;if(Array.isArray(t)){o="[";for(a=0;a<t.length;a++){if(a)o+=",";o+=e(t[a])||"null"}return o+"]"}if(t===null)return"null";if(i.indexOf(t)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=i.push(t)-1;var s=Object.keys(t).sort(r&&r(t));o="";for(a=0;a<s.length;a++){var l=s[a];var f=e(t[l]);if(!f)continue;if(o)o+=",";o+=JSON.stringify(l)+":"+f}i.splice(u,1);return"{"+o+"}"}(e)};function j0(e){return!!e.or}function B0(e){return!!e.and}function I0(e){return!!e.not}function U0(e,t){if(I0(e)){U0(e.not,t)}else if(B0(e)){for(var n=0,r=e.and;n<r.length;n++){var i=r[n];U0(i,t)}}else if(j0(e)){for(var a=0,o=e.or;a<o.length;a++){var i=o[a];U0(i,t)}}else{t(e)}}function q0(e,t){if(I0(e)){return{not:q0(e.not,t)}}else if(B0(e)){return{and:e.and.map((function(e){return q0(e,t)}))}}else if(j0(e)){return{or:e.or.map((function(e){return q0(e,t)}))}}else{return t(e)}}var W0=P0;var H0=R0;function G0(e,t){var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];if(xi(e,a)){n[a]=e[a]}}return n}function $0(e,t){var n=__assign({},e);for(var r=0,i=t;r<i.length;r++){var a=i[r];delete n[a]}return n}Set.prototype["toJSON"]=function(){return"Set("+__spreadArray([],this).map((function(e){return L0(e)})).join(",")+")"};var V0=L0;function Y0(e){if(Fi(e)){return e}var t=Ni(e)?e:L0(e);if(t.length<250){return t}var n=0;for(var r=0;r<t.length;r++){var i=t.charCodeAt(r);n=(n<<5)-n+i;n=n&n}return n}function X0(e){return e===false||e===null}function J0(e,t){return e.includes(t)}function Q0(e,t){var n=0;for(var r=0,i=e.entries();r<i.length;r++){var a=i[r],o=a[0],u=a[1];if(t(u,o,n++)){return true}}return false}function Z0(e,t){var n=0;for(var r=0,i=e.entries();r<i.length;r++){var a=i[r],o=a[0],u=a[1];if(!t(u,o,n++)){return false}}return true}function K0(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}for(var r=0,i=t;r<i.length;r++){var a=i[r];e1(e,a!==null&&a!==void 0?a:{})}return e}function e1(e,t){for(var n=0,r=s1(t);n<r.length;n++){var i=r[n];Br(e,i,t[i],true)}}function t1(e,t){var n=[];var r={};var i;for(var a=0,o=e;a<o.length;a++){var u=o[a];i=t(u);if(i in r){continue}r[i]=1;n.push(u)}return n}function n1(e,t){var n=s1(e);var r=s1(t);if(n.length!==r.length){return false}for(var i=0,a=n;i<a.length;i++){var o=a[i];if(e[o]!==t[o]){return false}}return true}function r1(e,t){if(e.size!==t.size){return false}for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!t.has(i)){return false}}return true}function i1(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(t.has(i)){return true}}return false}function a1(e){var t=new Set;var n=function(e){var n=br(e);var r=n.map((function(e,t){return t===0?e:"["+e+"]"}));var i=r.map((function(e,t){return r.slice(0,t+1).join("")}));for(var a=0,o=i;a<o.length;a++){var u=o[a];t.add(u)}};for(var r=0,i=e;r<i.length;r++){var a=i[r];n(a)}return t}function o1(e,t){if(e===undefined||t===undefined){return true}return i1(a1(e),a1(t))}function u1(e){return s1(e).length===0}var s1=Object.keys;var l1=Object.values;var f1=Object.entries;function c1(e){return e===true||e===false}function d1(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function h1(e,t){if(I0(e)){return"!("+h1(e.not,t)+")"}else if(B0(e)){return"("+e.and.map((function(e){return h1(e,t)})).join(") && (")+")"}else if(j0(e)){return"("+e.or.map((function(e){return h1(e,t)})).join(") || (")+")"}else{return t(e)}}function v1(e,t){if(t.length===0){return true}var n=t.shift();if(n in e&&v1(e[n],t)){delete e[n]}return u1(e)}function p1(e){return e.charAt(0).toUpperCase()+e.substr(1)}function g1(e,t){if(t===void 0){t="datum"}var n=br(e);var r=[];for(var i=1;i<=n.length;i++){var a="["+n.slice(0,i).map(Ui).join("][")+"]";r.push(""+t+a)}return r.join(" && ")}function m1(e,t){if(t===void 0){t="datum"}return t+"["+Ui(br(e).join("."))+"]"}function y1(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function _1(e){return""+br(e).map(y1).join("\\.")}function b1(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function x1(e){return""+br(e).join(".")}function w1(e){if(!e){return 0}return br(e).length}function k1(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i!==undefined){return i}}return undefined}var A1=42;function E1(e){var t=++A1;return e?String(e)+t:t}function D1(){A1=42}function S1(e){return C1(e)?e:"__"+e}function C1(e){return e.startsWith("__")}function M1(e){if(e===undefined){return undefined}return(e%360+360)%360}function F1(e){if(Fi(e)){return true}return!isNaN(e)&&!isNaN(parseFloat(e))}var O1="row";var N1="column";var T1="facet";var z1="x";var R1="y";var P1="x2";var L1="y2";var j1="radius";var B1="radius2";var I1="theta";var U1="theta2";var q1="latitude";var W1="longitude";var H1="latitude2";var G1="longitude2";var $1="color";var V1="fill";var Y1="stroke";var X1="shape";var J1="size";var Q1="angle";var Z1="opacity";var K1="fillOpacity";var e2="strokeOpacity";var t2="strokeWidth";var n2="strokeDash";var r2="text";var i2="order";var a2="detail";var o2="key";var u2="tooltip";var s2="href";var l2="url";var f2="description";var c2={x:1,y:1,x2:1,y2:1};var d2={theta:1,theta2:1,radius:1,radius2:1};function h2(e){return e in d2}var v2={longitude:1,longitude2:1,latitude:1,latitude2:1};function p2(e){switch(e){case q1:return"y";case H1:return"y2";case W1:return"x";case G1:return"x2"}}function g2(e){return e in v2}var m2=s1(v2);var y2=__assign(__assign(__assign(__assign({},c2),d2),v2),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function _2(e){return e===$1||e===V1||e===Y1}var b2={row:1,column:1,facet:1};var x2=s1(b2);var w2=__assign(__assign({},y2),b2);var k2=s1(w2);var A2=w2.order,E2=w2.detail,D2=w2.tooltip,S2=Ice(w2,["order","detail","tooltip"]);var C2=S2.row,M2=S2.column,F2=S2.facet,O2=Ice(S2,["row","column","facet"]);function N2(e){return!!O2[e]}function T2(e){return!!w2[e]}var z2=[P1,L1,H1,G1,U1,B1];function R2(e){var t=P2(e);return t!==e}function P2(e){switch(e){case P1:return z1;case L1:return R1;case H1:return q1;case G1:return W1;case U1:return I1;case B1:return j1}return e}function L2(e){if(h2(e)){switch(e){case I1:return"startAngle";case U1:return"endAngle";case j1:return"outerRadius";case B1:return"innerRadius"}}return e}function j2(e){switch(e){case z1:return P1;case R1:return L1;case q1:return H1;case W1:return G1;case I1:return U1;case j1:return B1}return undefined}function B2(e){switch(e){case z1:case P1:return"width";case R1:case L1:return"height"}return undefined}function I2(e){switch(e){case z1:return"xOffset";case R1:return"yOffset";case P1:return"x2Offset";case L1:return"y2Offset";case I1:return"thetaOffset";case j1:return"radiusOffset";case U1:return"theta2Offset";case B1:return"radius2Offset"}return undefined}var U2=y2.x,q2=y2.y,W2=y2.x2,H2=y2.y2,G2=y2.latitude,$2=y2.longitude,V2=y2.latitude2,Y2=y2.longitude2,X2=y2.theta,J2=y2.theta2,Q2=y2.radius,Z2=y2.radius2,K2=Ice(y2,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]);var e3=s1(K2);var t3={x:1,y:1};var n3=s1(t3);function r3(e){return e in t3}var i3={theta:1,radius:1};var a3=s1(i3);function o3(e){return e==="width"?z1:R1}var u3=K2.text,s3=K2.tooltip,l3=K2.href,f3=K2.url,c3=K2.description,d3=K2.detail,h3=K2.key,v3=K2.order,p3=Ice(K2,["text","tooltip","href","url","description","detail","key","order"]);var g3=s1(p3);function m3(e){return!!K2[e]}function y3(e){switch(e){case $1:case V1:case Y1:case J1:case X1:case Z1:case t2:case n2:return true;case K1:case e2:case Q1:return false}}var _3=__assign(__assign(__assign({},t3),i3),p3);var b3=s1(_3);function x3(e){return!!_3[e]}function w3(e,t){return D3(e)[t]}var k3={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"};var A3=k3.geoshape,E3=Ice(k3,["geoshape"]);function D3(e){switch(e){case $1:case V1:case Y1:case f2:case a2:case o2:case u2:case s2:case i2:case Z1:case K1:case e2:case t2:case T1:case O1:case N1:return k3;case z1:case R1:case q1:case W1:return E3;case P1:case L1:case H1:case G1:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case J1:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case n2:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case X1:return{point:"always",geoshape:"always"};case r2:return{text:"always"};case Q1:return{point:"always",square:"always",text:"always"};case l2:return{image:"always"};case I1:return{text:"always",arc:"always"};case j1:return{text:"always",arc:"always"};case U1:case B1:return{arc:"always"}}}function S3(e){switch(e){case z1:case R1:case I1:case j1:case J1:case Q1:case t2:case Z1:case K1:case e2:case P1:case L1:case U1:case B1:return undefined;case T1:case O1:case N1:case X1:case n2:case r2:case u2:case s2:case l2:case f2:return"discrete";case $1:case V1:case Y1:return"flexible";case q1:case W1:case H1:case G1:case a2:case o2:case i2:return undefined}}var C3={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};var M3={count:1,min:1,max:1};function F3(e){return!!e&&!!e["argmin"]}function O3(e){return!!e&&!!e["argmax"]}function N3(e){return Ni(e)&&!!C3[e]}var T3=["count","valid","missing","distinct"];function z3(e){return Ni(e)&&J0(T3,e)}function R3(e){return Ni(e)&&J0(["min","max"],e)}var P3=["count","sum","distinct","valid","missing"];var L3=["mean","average","median","q1","q3","min","max"];var j3=$i(L3);function B3(e){if(Si(e)){e=C7(e,undefined)}return"bin"+s1(e).map((function(t){return W3(e[t])?d1("_"+t+"_"+f1(e[t])):d1("_"+t+"_"+e[t])})).join("")}function I3(e){return e===true||q3(e)&&!e.binned}function U3(e){return e==="binned"||q3(e)&&e.binned===true}function q3(e){return Pr(e)}function W3(e){return e===null||e===void 0?void 0:e["param"]}function H3(e){switch(e){case O1:case N1:case J1:case $1:case V1:case Y1:case t2:case Z1:case K1:case e2:case X1:return 6;case n2:return 4;default:return 10}}function G3(e){return e&&!!e["expr"]}function $3(e){var t=s1(e||{});var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];n[a]=a5(e[a])}return n}function V3(e){var t=e.anchor,n=e.frame,r=e.offset,i=e.orient,a=e.color,o=e.subtitleColor,u=e.subtitleFont,s=e.subtitleFontSize,l=e.subtitleFontStyle,f=e.subtitleFontWeight,c=e.subtitleLineHeight,d=e.subtitlePadding,h=Ice(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]);var v=__assign(__assign({},h),a?{fill:a}:{});var p=__assign(__assign(__assign(__assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{});var g=__assign(__assign(__assign(__assign(__assign(__assign(__assign({},o?{subtitleColor:o}:{}),u?{subtitleFont:u}:{}),s?{subtitleFontSize:s}:{}),l?{subtitleFontStyle:l}:{}),f?{subtitleFontWeight:f}:{}),c?{subtitleLineHeight:c}:{}),d?{subtitlePadding:d}:{});var m=G0(v,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:v,subtitleMarkConfig:m,nonMark:p,subtitle:g}}function Y3(e){return Ni(e)||Rr(e)&&Ni(e[0])}function X3(e){return e&&!!e["signal"]}function J3(e){return!!e["step"]}function Q3(e){if(!Rr(e)){return"fields"in e&&!("data"in e)}return false}function Z3(e){if(!Rr(e)){return"fields"in e&&"data"in e}return false}function K3(e){if(!Rr(e)){return"field"in e&&"data"in e}return false}var e5={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1};var t5=s1(e5);var n5={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};var r5=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function i5(e){var t=Rr(e.condition)?e.condition.map(o5):o5(e.condition);return __assign(__assign({},a5(e)),{condition:t})}function a5(e){if(G3(e)){var t=e.expr,n=Ice(e,["expr"]);return __assign({signal:t},n)}return e}function o5(e){if(G3(e)){var t=e.expr,n=Ice(e,["expr"]);return __assign({signal:t},n)}return e}function u5(e){if(G3(e)){var t=e.expr,n=Ice(e,["expr"]);return __assign({signal:t},n)}if(X3(e)){return e}return e!==undefined?{value:e}:undefined}function s5(e){if(X3(e)){return e.signal}return Ui(e.value)}function l5(e){if(X3(e)){return e.signal}return e==null?null:Ui(e)}function f5(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r];var o=h5(a,t.markDef,t.config);if(o!==undefined){e[a]=u5(o)}}return e}function c5(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function d5(e,t,n,r){if(r===void 0){r={}}var i=r.vgChannel,a=r.ignoreVgConfig;if(i&&t[i]!==undefined){return t[i]}else if(t[e]!==undefined){return t[e]}else if(a&&(!i||i===e)){return undefined}return h5(e,t,n,r)}function h5(e,t,n,r){var i=r===void 0?{}:r,a=i.vgChannel;return k1(a?v5(e,t,n.style):undefined,v5(e,t,n.style),a?n[t.type][a]:undefined,n[t.type][e],a?n.mark[a]:n.mark[e])}function v5(e,t,n){return p5(e,c5(t),n)}function p5(e,t,n){t=oi(t);var r;for(var i=0,a=t;i<a.length;i++){var o=a[i];var u=n[o];if(u&&u[e]!==undefined){r=u[e]}}return r}function g5(e,t){return oi(e).reduce((function(e,n){var r;e.field.push(u7(n,t));e.order.push((r=n.sort)!==null&&r!==void 0?r:"ascending");return e}),{field:[],order:[]})}function m5(e,t){var n=__spreadArray([],e);t.forEach((function(e){for(var t=0,r=n;t<r.length;t++){var i=r[t];if(W0(i,e)){return}}n.push(e)}));return n}function y5(e,t){if(W0(e,t)||!t){return e}else if(!e){return t}else{return __spreadArray(__spreadArray([],oi(e)),oi(t)).join(", ")}}function _5(e,t){var n=e.value;var r=t.value;if(n==null||r===null){return{explicit:e.explicit,value:null}}else if((Y3(n)||X3(n))&&(Y3(r)||X3(r))){return{explicit:e.explicit,value:y5(n,r)}}else if(Y3(n)||X3(n)){return{explicit:e.explicit,value:n}}else if(Y3(r)||X3(r)){return{explicit:e.explicit,value:r}}else if(!Y3(n)&&!X3(n)&&!Y3(r)&&!X3(r)){return{explicit:e.explicit,value:m5(n,r)}}throw new Error("It should never reach here")}function b5(e){return"Invalid specification "+V0(e)+'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".'}var x5='Autosize "fit" only works for single views and layered views.';function w5(e){var t=e=="width"?"Width":"Height";return t+' "container" only works for single views and layered views.'}function k5(e){var t=e=="width"?"Width":"Height";var n=e=="width"?"x":"y";return t+' "container" only works well with autosize "fit" or "fit-'+n+'".'}function A5(e){return e?'Dropping "fit-'+e+'" because spec has discrete '+B2(e)+".":'Dropping "fit" because spec has discrete size.'}function E5(e){return"Unknown field for "+e+". Cannot calculate view size."}function D5(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'}function S5(e,t){return'Cannot project a selection on encoding channel "'+e+'" as it uses an aggregate function ("'+t+'").'}function C5(e){return'The "nearest" transform is not supported for '+e+" marks."}function M5(e){return"Selection not supported for "+e+" yet."}function F5(e){return'Cannot find a selection named "'+e+'".'}var O5="Scale bindings are currently only supported for scales with unbinned, continuous domains.";var N5="Legend bindings are only supported for selections over an individual field or encoding channel.";function T5(e){return'Lookups can only be performed on selection parameters. "'+e+'" is a variable parameter.'}function z5(e){return'Cannot define and lookup the "'+e+'" selection in the same view. '+"Try moving the lookup into a second, layered view?"}var R5="The same selection must be used to override scale domains in a layered view.";var P5='Interval selections should be initialized using "x" and/or "y" keys.';function L5(e){return'Unknown repeated value "'+e+'".'}function j5(e){return'The "columns" property cannot be used when "'+e+'" has nested row/column.'}var B5="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function I5(e){return'Unrecognized parse "'+e+'".'}function U5(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."}var q5="Attempt to add the same child twice.";function W5(e){return"Ignoring an invalid transform: "+V0(e)+"."}var H5='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function G5(e){return"Config.customFormatTypes is not true, thus custom format type and format for channel "+e+" are dropped."}function $5(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection "+V0(t)+" is overridden by a child projection "+V0(n)+"."}var V5="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Y5(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+V0(n)+"}."}function X5(e){return'Invalid field type "'+e+'".'}function J5(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'}function Q5(e){return'Invalid aggregation operator "'+e+'".'}function Z5(e,t){var n=t.fill,r=t.stroke;return"Dropping color "+e+" as the plot also has "+(n&&r?"fill and stroke":n?"fill":"stroke")+"."}function K5(e){return"Position range does not support relative band size for "+e+"."}function e6(e,t){return"Dropping "+V0(e)+' from channel "'+t+'" since it does not contain any data field, datum, value, or signal.'}var t6="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function n6(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."}function r6(e){return e+"-encoding is dropped as "+e+" is not a valid encoding channel."}function i6(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function a6(e){return e+" encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold)."}function o6(e){return"Facet encoding dropped as "+e.join(" and ")+" "+(e.length>1?"are":"is")+" also specified."}function u6(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+(t==="ordinal"?"order":"magnitude")+"."}function s6(e){return"The "+e+" for range marks cannot be an expression"}function l6(e,t){var n=e&&t?"x2 and y2":e?"x2":"y2";return"Line mark is for continuous lines and thus cannot be used with "+n+". We will use the rule mark (line segments) instead."}function f6(e,t){return'Specified orient "'+e+'" overridden with "'+t+'".'}function c6(e){return'Cannot use the scale property "'+e+'" with non-color channel.'}function d6(e){return"Cannot use the relative band size with "+e+" scale."}function h6(e){return"Using unaggregated domain with raw field has no effect ("+V0(e)+")."}function v6(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'}function p6(e){return"Unaggregated domain is currently unsupported for log scale ("+V0(e)+")."}function g6(e){return'Cannot apply size to non-oriented mark "'+e+'".'}function m6(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'}function y6(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'}function _6(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function b6(e){return'The step for "'+e+'" is dropped because the '+(e==="width"?"x":"y")+" is continuous."}function x6(e,t,n,r){return"Conflicting "+t.toString()+' property "'+e.toString()+'" ('+V0(n)+" and "+V0(r)+"). Using "+V0(n)+"."}function w6(e,t,n,r){return"Conflicting "+t.toString()+' property "'+e.toString()+'" ('+V0(n)+" and "+V0(r)+"). Using the union of the two domains."}function k6(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'}function A6(e){return"Dropping sort property "+V0(e)+' as unioned domains only support boolean or op "count", "min", and "max".'}var E6="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";var D6="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.";var S6="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.";var C6="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function M6(e){return'Cannot stack "'+e+'" if there is already "'+e+'2".'}function F6(e){return"Cannot stack non-linear scale ("+e+")."}function O6(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'").'}function N6(e,t){return"Invalid "+e+": "+V0(t)+"."}function T6(e){return"Dropping day from datetime "+V0(e)+" as day cannot be combined with other units."}function z6(e,t){return""+(t?"extent ":"")+(t&&e?"and ":"")+(e?"center ":"")+(t&&e?"are ":"is ")+"not needed when data are aggregated."}function R6(e,t,n){return e+" is not usually used with "+t+" for "+n+"."}function P6(e,t){return"Continuous axis should not have customized aggregation function "+e+"; "+t+" already agregates the axis."}function L6(e){return"1D error band does not support "+e+"."}function j6(e){return"Channel "+e+' is required for "binned" bin.'}function B6(e){return"Channel "+e+' should not be used with "binned" bin.'}function I6(e){return"Domain for "+e+" is required for threshold scale."}var U6=zr(Or);var q6=U6;function W6(e){q6=e;return q6}function H6(){q6=U6;return q6}function G6(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}q6.warn.apply(q6,e)}function $6(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}q6.debug.apply(q6,e)}function V6(e){if(e&&Pr(e)){for(var t=0,n=o4;t<n.length;t++){var r=n[t];if(r in e){return true}}}return false}var Y6=["january","february","march","april","may","june","july","august","september","october","november","december"];var X6=Y6.map((function(e){return e.substr(0,3)}));var J6=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];var Q6=J6.map((function(e){return e.substr(0,3)}));function Z6(e){if(F1(e)){e=+e}if(Fi(e)){if(e>4){G6(N6("quarter",e))}return e-1}else{throw new Error(N6("quarter",e))}}function K6(e){if(F1(e)){e=+e}if(Fi(e)){return e-1}else{var t=e.toLowerCase();var n=Y6.indexOf(t);if(n!==-1){return n}var r=t.substr(0,3);var i=X6.indexOf(r);if(i!==-1){return i}throw new Error(N6("month",e))}}function e4(e){if(F1(e)){e=+e}if(Fi(e)){return e%7}else{var t=e.toLowerCase();var n=J6.indexOf(t);if(n!==-1){return n}var r=t.substr(0,3);var i=Q6.indexOf(r);if(i!==-1){return i}throw new Error(N6("day",e))}}function t4(e,t){var n=[];if(t&&e.day!==undefined){if(s1(e).length>1){G6(T6(e));e=H0(e);delete e.day}}if(e.year!==undefined){n.push(e.year)}else{n.push(2012)}if(e.month!==undefined){var r=t?K6(e.month):e.month;n.push(r)}else if(e.quarter!==undefined){var i=t?Z6(e.quarter):e.quarter;n.push(Fi(i)?i*3:i+"*3")}else{n.push(0)}if(e.date!==undefined){n.push(e.date)}else if(e.day!==undefined){var a=t?e4(e.day):e.day;n.push(Fi(a)?a+1:a+"+1")}else{n.push(1)}for(var o=0,u=["hours","minutes","seconds","milliseconds"];o<u.length;o++){var s=u[o];var l=e[s];n.push(typeof l==="undefined"?0:l)}return n}function n4(e){var t=t4(e,true);var n=t.join(", ");if(e.utc){return"utc("+n+")"}else{return"datetime("+n+")"}}function r4(e){var t=t4(e,false);var n=t.join(", ");if(e.utc){return"utc("+n+")"}else{return"datetime("+n+")"}}function i4(e){var t=t4(e,true);if(e.utc){return+new Date(Date.UTC.apply(Date,t))}else{return+new(Date.bind.apply(Date,__spreadArray([void 0],t)))}}var a4={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};var o4=s1(a4);function u4(e){return!!a4[e]}function s4(e){return e.startsWith("utc")}function l4(e){return e.substr(3)}var f4={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function c4(e){return o4.filter((function(t){return d4(e,t)}))}function d4(e,t){var n=e.indexOf(t);if(n<0){return false}if(n>0&&t==="seconds"&&e.charAt(n-1)==="i"){return false}if(e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"){return false}if(n>0&&t==="year"&&e.charAt(n-1)==="f"){return false}return true}function h4(e,t,n){var r=n===void 0?{end:false}:n,i=r.end;var a=g1(t);var o=s4(e)?"utc":"";function u(e){if(e==="quarter"){return"("+o+"quarter("+a+")-1)"}else{return""+o+e+"("+a+")"}}var s;var l={};for(var f=0,c=o4;f<c.length;f++){var d=c[f];if(d4(e,d)){l[d]=u(d);s=d}}if(i){l[s]+="+1"}return r4(l)}function v4(e){if(!e){return undefined}var t=c4(e);return"timeUnitSpecifier("+V0(t)+", "+V0(f4)+")"}function p4(e,t,n){if(!e){return undefined}var r=v4(e);var i=n||s4(e);return(i?"utc":"time")+"Format("+t+", "+r+")"}function g4(e){if(!e){return undefined}var t;if(Ni(e)){t={unit:e}}else if(Pr(e)){t=__assign(__assign({},e),e.unit?{unit:e.unit}:{})}if(s4(t.unit)){t.utc=true;t.unit=l4(t.unit)}return t}function m4(e){var t=g4(e),n=t.utc,r=Ice(t,["utc"]);if(r.unit){return(n?"utc":"")+s1(r).map((function(e){return d1(""+(e==="unit"?"":"_"+e+"_")+r[e])})).join("")}else{return(n?"utc":"")+"timeunit"+s1(r).map((function(e){return d1("_"+e+"_"+r[e])})).join("")}}function y4(e){return e===null||e===void 0?void 0:e["param"]}function _4(e){return e&&!!e.field&&e.equal!==undefined}function b4(e){return e&&!!e.field&&e.lt!==undefined}function x4(e){return e&&!!e.field&&e.lte!==undefined}function w4(e){return e&&!!e.field&&e.gt!==undefined}function k4(e){return e&&!!e.field&&e.gte!==undefined}function A4(e){if(e&&e.field){if(Rr(e.range)&&e.range.length===2){return true}else if(X3(e.range)){return true}}return false}function E4(e){return e&&!!e.field&&(Rr(e.oneOf)||Rr(e.in))}function D4(e){return e&&!!e.field&&e.valid!==undefined}function S4(e){return E4(e)||_4(e)||A4(e)||b4(e)||w4(e)||x4(e)||k4(e)}function C4(e,t){return T7(e,{timeUnit:t,wrapTime:true})}function M4(e,t){return e.map((function(e){return C4(e,t)}))}function F4(e,t){var n;if(t===void 0){t=true}var r=e.field;var i=(n=g4(e.timeUnit))===null||n===void 0?void 0:n.unit;var a=i?"time("+h4(i,r)+")":u7(e,{expr:"datum"});if(_4(e)){return a+"==="+C4(e.equal,i)}else if(b4(e)){var o=e.lt;return a+"<"+C4(o,i)}else if(w4(e)){var u=e.gt;return a+">"+C4(u,i)}else if(x4(e)){var o=e.lte;return a+"<="+C4(o,i)}else if(k4(e)){var u=e.gte;return a+">="+C4(u,i)}else if(E4(e)){return"indexof(["+M4(e.oneOf,i).join(",")+"], "+a+") !== -1"}else if(D4(e)){return O4(a,e.valid)}else if(A4(e)){var s=e.range;var u=X3(s)?{signal:s.signal+"[0]"}:s[0];var o=X3(s)?{signal:s.signal+"[1]"}:s[1];if(u!==null&&o!==null&&t){return"inrange("+a+", ["+C4(u,i)+", "+C4(o,i)+"])"}var l=[];if(u!==null){l.push(a+" >= "+C4(u,i))}if(o!==null){l.push(a+" <= "+C4(o,i))}return l.length>0?l.join(" && "):"true"}throw new Error("Invalid field predicate: "+V0(e))}function O4(e,t){if(t===void 0){t=true}if(t){return"isValid("+e+") && isFinite(+"+e+")"}else{return"!isValid("+e+") || !isFinite(+"+e+")"}}function N4(e){var t;if(S4(e)&&e.timeUnit){return __assign(__assign({},e),{timeUnit:(t=g4(e.timeUnit))===null||t===void 0?void 0:t.unit})}return e}var T4={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};var z4=T4.quantitative;var R4=T4.ordinal;var P4=T4.temporal;var L4=T4.nominal;var j4=T4.geojson;function B4(e){if(e){e=e.toLowerCase();switch(e){case"q":case z4:return"quantitative";case"t":case P4:return"temporal";case"o":case R4:return"ordinal";case"n":case L4:return"nominal";case j4:return"geojson"}}return undefined}var I4={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"};var U4={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function q4(e,t){var n=U4[e];var r=U4[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}var W4={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function H4(e){return W4[e]}var G4=["linear","log","pow","sqrt","symlog","time","utc"];var $4=$i(G4);var V4=["linear","log","pow","sqrt","symlog"];var Y4=$i(V4);function X4(e){return e in Y4}var J4=["quantile","quantize","threshold"];var Q4=$i(J4);var Z4=G4.concat(["quantile","quantize","threshold","sequential","identity"]);var K4=$i(Z4);var e8=["ordinal","bin-ordinal","point","band"];var t8=$i(e8);function n8(e){return e in t8}function r8(e){return e in K4}function i8(e){return e in $4}function a8(e){return e in Q4}var o8={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function u8(e){return!Ni(e)&&!!e["name"]}function s8(e){return e===null||e===void 0?void 0:e["param"]}function l8(e){return e&&e["unionWith"]}var f8={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};var c8=f8.type,d8=f8.domain,h8=f8.range,v8=f8.rangeMax,p8=f8.rangeMin,g8=f8.scheme,m8=Ice(f8,["type","domain","range","rangeMax","rangeMin","scheme"]);var y8=s1(m8);function _8(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return true;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return i8(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return i8(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return i8(e);case"nice":return i8(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return r8(e)&&!J0(["log","time","utc","threshold","quantile"],e)}}function b8(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":if(!_2(e)){return c6(e)}return undefined;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return undefined}}function x8(e,t){if(J0([R4,L4],t)){return e===undefined||n8(e)}else if(t===P4){return J0([I4.TIME,I4.UTC,undefined],e)}else if(t===z4){return J0([I4.LOG,I4.POW,I4.SQRT,I4.SYMLOG,I4.QUANTILE,I4.QUANTIZE,I4.THRESHOLD,I4.LINEAR,undefined],e)}return true}function w8(e,t){if(!x3(e)){return false}switch(e){case z1:case R1:case I1:case j1:return i8(t)||J0(["band","point"],t);case J1:case t2:case Z1:case K1:case e2:case Q1:return i8(t)||a8(t)||J0(["band","point","ordinal"],t);case $1:case V1:case Y1:return t!=="band";case n2:case X1:return t==="ordinal"||a8(t)}}var k8={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"};var A8=k8.arc;var E8=k8.area;var D8=k8.bar;var S8=k8.image;var C8=k8.line;var M8=k8.point;var F8=k8.rect;var O8=k8.rule;var N8=k8.text;var T8=k8.tick;var z8=k8.trail;var R8=k8.circle;var P8=k8.square;var L8=k8.geoshape;function j8(e){return["line","area","trail"].includes(e)}function B8(e){return["rect","bar","image","arc"].includes(e)}var I8=s1(k8);function U8(e){return e["type"]}$i(I8);var q8=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"];var W8=["fill","fillOpacity"];var H8=__spreadArray(__spreadArray([],q8),W8);var G8={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1};var $8=s1(G8);var V8={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]};var Y8={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1};var X8={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1};var J8=s1(X8);function Q8(e){return e&&e["band"]!=undefined}var Z8={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};var K8=5;var e9={binSpacing:1,continuousBandSize:K8,timeUnitBandPosition:.5};var t9={binSpacing:0,continuousBandSize:K8,timeUnitBandPosition:.5};var n9={thickness:1};function r9(e){return U8(e)?e.type:e}function i9(e){var t=e.channel,n=e.channelDef,r=e.markDef,i=e.scale,a=e.config;var o=c9(e);if(V9(n)&&!z3(n.aggregate)&&i&&i8(i.get("type"))&&i.get("zero")===false){return a9({fieldDef:n,channel:t,markDef:r,ref:o,config:a})}return o}function a9(e){var t=e.fieldDef,n=e.channel,r=e.markDef,i=e.ref,a=e.config;if(j8(r.type)){return i}var o=d5("invalid",r,a);if(o===null){return i}return[o9(t,n),i]}function o9(e,t){var n=u9(e,true);var r=P2(t);var i=r==="y"?{field:{group:"height"}}:{value:0};return __assign({test:n},i)}function u9(e,t){if(t===void 0){t=true}return O4(Ni(e)?e:u7(e,{expr:"datum"}),!t)}function s9(e){var t=e.datum;if(V6(t)){return n4(t)}return""+V0(t)}function l9(e,t,n,r){var i={};if(t){i.scale=t}if(X9(e)){var a=e.datum;if(V6(a)){i.signal=n4(a)}else if(X3(a)){i.signal=a.signal}else if(G3(a)){i.signal=a.expr}else{i.value=a}}else{i.field=u7(e,n)}if(r){var o=r.offset,u=r.band;if(o){i.offset=o}if(u){i.band=u}}return i}function f9(e){var t=e.scaleName,n=e.fieldOrDatumDef,r=e.fieldOrDatumDef2,i=e.offset,a=e.startSuffix,o=e.bandPosition,u=o===void 0?.5:o;var s=0<u&&u<1?"datum":undefined;var l=u7(n,{expr:s,suffix:a});var f=r!==undefined?u7(r,{expr:s}):u7(n,{suffix:"end",expr:s});var c={};if(u===0||u===1){c.scale=t;var d=u===0?l:f;c.field=d}else{var h=X3(u)?u.signal+" * "+l+" + (1-"+u.signal+") * "+f:u+" * "+l+" + "+(1-u)+" * "+f;c.signal='scale("'+t+'", '+h+")"}if(i){c.offset=i}return c}function c9(e){var t;var n=e.channel,r=e.channelDef,i=e.channel2Def,a=e.markDef,o=e.config,u=e.scaleName,s=e.scale,l=e.stack,f=e.offset,c=e.defaultRef,d=e.bandPosition;if(r){if(Z9(r)){if(K9(r)){d!==null&&d!==void 0?d:d=I9({fieldDef:r,fieldDef2:i,markDef:a,config:o});var h=r.bin,v=r.timeUnit,p=r.type;if(I3(h)||d&&v&&p===P4){if(l&&l.impute){return l9(r,u,{binSuffix:"mid"},{offset:f})}if(d){return f9({scaleName:u,fieldOrDatumDef:r,bandPosition:d,offset:f})}return l9(r,u,R7(r,n)?{binSuffix:"range"}:{},{offset:f})}else if(U3(h)){if(V9(i)){return f9({scaleName:u,fieldOrDatumDef:r,fieldOrDatumDef2:i,bandPosition:d,offset:f})}else{var g=n===z1?P1:L1;G6(j6(g))}}}var m=s===null||s===void 0?void 0:s.get("type");return l9(r,u,n8(m)?{binSuffix:"range"}:{},{offset:f,band:m==="band"?(t=d!==null&&d!==void 0?d:r.bandPosition)!==null&&t!==void 0?t:.5:undefined})}else if(e7(r)){var y=r.value;var _=f?{offset:f}:{};return __assign(__assign({},d9(n,y)),_)}}if(si(c)){c=c()}if(c){return __assign(__assign({},c),f?{offset:f}:{})}return c}function d9(e,t){if(J0(["x","x2"],e)&&t==="width"){return{field:{group:"width"}}}else if(J0(["y","y2"],e)&&t==="height"){return{field:{group:"height"}}}return u5(t)}function h9(e){return e&&e!=="number"&&e!=="time"}function v9(e,t,n){return e+"("+t+(n?", "+V0(n):"")+")"}var p9=" – ";function g9(e){var t,n;var r=e.fieldOrDatumDef,i=e.format,a=e.formatType,o=e.expr,u=e.normalizeStack,s=e.config;if(h9(a)){return y9({fieldOrDatumDef:r,format:i,formatType:a,expr:o,config:s})}var l=m9(r,o,u);if(O7(r)){var f=D9(l,V9(r)?(t=g4(r.timeUnit))===null||t===void 0?void 0:t.unit:undefined,i,s.timeFormat,t7(r)&&((n=r.scale)===null||n===void 0?void 0:n.type)===I4.UTC);return f?{signal:f}:undefined}i=x9(Y9(r),i,s);if(V9(r)&&I3(r.bin)){var c=u7(r,{expr:o,binSuffix:"end"});return{signal:E9(l,c,i,a,s)}}else if(i||Y9(r)==="quantitative"){return{signal:""+k9(l,i)}}else{return{signal:"isValid("+l+") ? "+l+' : ""+'+l}}}function m9(e,t,n){if(V9(e)){if(n){return u7(e,{expr:t,suffix:"end"})+"-"+u7(e,{expr:t,suffix:"start"})}else{return u7(e,{expr:t})}}else{return s9(e)}}function y9(e){var t=e.fieldOrDatumDef,n=e.format,r=e.formatType,i=e.expr,a=e.normalizeStack,o=e.config,u=e.field;u!==null&&u!==void 0?u:u=m9(t,i,a);if(V9(t)&&I3(t.bin)){var s=u7(t,{expr:i,binSuffix:"end"});return{signal:E9(u,s,n,r,o)}}return{signal:v9(r,u,n)}}function _9(e,t,n,r,i,a){var o;if(h9(r)){return undefined}if(O7(e)){var u=V9(e)?(o=g4(e.timeUnit))===null||o===void 0?void 0:o.unit:undefined;return w9(n,u,i,a)}return x9(t,n,i)}function b9(e,t,n){if(e&&(X3(e)||e==="number"||e==="time")){return e}if(O7(t)&&n!=="time"&&n!=="utc"){return"time"}return undefined}function x9(e,t,n){if(Ni(t)){return t}if(e===z4){return n.numberFormat}return undefined}function w9(e,t,n,r){if(e){return e}if(t){return{signal:v4(t)}}return r?undefined:n.timeFormat}function k9(e,t){return"format("+e+', "'+(t||"")+'")'}function A9(e,t,n,r){var i;if(h9(n)){return v9(n,e,t)}return k9(e,(i=Ni(t)?t:undefined)!==null&&i!==void 0?i:r.numberFormat)}function E9(e,t,n,r,i){var a=A9(e,n,r,i);var o=A9(t,n,r,i);return O4(e,false)+' ? "null" : '+a+' + "'+p9+'" + '+o}function D9(e,t,n,r,i){if(!t||n){n=Ni(n)?n:r;return(i?"utc":"time")+"Format("+e+", '"+n+"')"}else{return p4(t,e,i)}}var S9="min";var C9={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function M9(e){return e in C9}function F9(e){return!!e&&!!e["encoding"]}function O9(e){return!!e&&(e["op"]==="count"||!!e["field"])}function N9(e){return!!e&&Rr(e)}function T9(e){return"row"in e||"column"in e}function z9(e){return!!e&&"header"in e}function R9(e){return"facet"in e}function P9(e){return e["param"]}function L9(e){return e&&!Ni(e)&&"repeat"in e}function j9(e){var t=e.field,n=e.timeUnit,r=e.bin,i=e.aggregate;return __assign(__assign(__assign(__assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function B9(e){return"sort"in e}function I9(e){var t=e.fieldDef,n=e.fieldDef2,r=e.markDef,i=e.config;if(Z9(t)&&t.bandPosition!==undefined){return t.bandPosition}if(V9(t)){var a=t.timeUnit,o=t.bin;if(a&&!n){return B8(r.type)?0:h5("timeUnitBandPosition",r,i)}else if(I3(o)){return.5}}return undefined}function U9(e){var t,n,r;var i=e.channel,a=e.fieldDef,o=e.fieldDef2,u=e.markDef,s=e.config,l=e.scaleType,f=e.useVlSizeChannel;var c=B2(i);var d=d5(f?"size":c,u,s,{vgChannel:c});if(d!==undefined){return d}if(V9(a)){var h=a.timeUnit,v=a.bin;if(h&&!o){return{band:h5("timeUnitBandSize",u,s)}}else if(I3(v)&&!n8(l)){return{band:1}}}if(B8(u.type)){if(l){if(n8(l)){return((t=s[u.type])===null||t===void 0?void 0:t.discreteBandSize)||{band:1}}else{return(n=s[u.type])===null||n===void 0?void 0:n.continuousBandSize}}return(r=s[u.type])===null||r===void 0?void 0:r.discreteBandSize}return undefined}function q9(e,t,n,r){if(I3(e.bin)||e.timeUnit&&K9(e)&&e.type==="temporal"){return I9({fieldDef:e,fieldDef2:t,markDef:n,config:r})!==undefined}return false}function W9(e){return!!e&&"condition"in e}function H9(e){var t=e&&e["condition"];return!!t&&!Rr(t)&&V9(t)}function G9(e){var t=e&&e["condition"];return!!t&&!Rr(t)&&Z9(t)}function $9(e){var t=e&&e["condition"];return!!t&&(Rr(t)||e7(t))}function V9(e){return!!e&&(!!e["field"]||e["aggregate"]==="count")}function Y9(e){return e&&e["type"]}function X9(e){return!!e&&"datum"in e}function J9(e){return K9(e)&&!s7(e)||Q9(e)}function Q9(e){return X9(e)&&Fi(e.datum)}function Z9(e){return V9(e)||X9(e)}function K9(e){return!!e&&("field"in e||e["aggregate"]==="count")&&"type"in e}function e7(e){return e&&"value"in e&&"value"in e}function t7(e){return!!e&&("scale"in e||"sort"in e)}function n7(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function r7(e){return!!e&&"legend"in e}function i7(e){return!!e&&("format"in e||"formatType"in e)}function a7(e){return $0(e,["legend","axis","header","scale"])}function o7(e){return"op"in e}function u7(e,t){var n,r,i;if(t===void 0){t={}}var a=e.field;var o=t.prefix;var u=t.suffix;var s="";if(f7(e)){a=S1("count")}else{var l=void 0;if(!t.nofn){if(o7(e)){l=e.op}else{var f=e.bin,c=e.aggregate,d=e.timeUnit;if(I3(f)){l=B3(f);u=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((r=t.suffix)!==null&&r!==void 0?r:"")}else if(c){if(O3(c)){s='["'+a+'"]';a="argmax_"+c.argmax}else if(F3(c)){s='["'+a+'"]';a="argmin_"+c.argmin}else{l=String(c)}}else if(d){l=m4(d);u=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((i=t.suffix)!==null&&i!==void 0?i:"")}}}if(l){a=a?l+"_"+a:l}}if(u){a=a+"_"+u}if(o){a=o+"_"+a}if(t.forAs){return x1(a)}else if(t.expr){return m1(a,t.expr)+s}else{return _1(a)+s}}function s7(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return true;case"quantitative":return V9(e)&&!!e.bin;case"temporal":return false}throw new Error(X5(e.type))}function l7(e){var t;return t7(e)&&a8((t=e.scale)===null||t===void 0?void 0:t.type)}function f7(e){return e.aggregate==="count"}function c7(e,t){var n;var r=e.field,i=e.bin,a=e.timeUnit,o=e.aggregate;if(o==="count"){return t.countTitle}else if(I3(i)){return r+" (binned)"}else if(a){var u=(n=g4(a))===null||n===void 0?void 0:n.unit;if(u){return r+" ("+c4(u).join("-")+")"}}else if(o){if(O3(o)){return r+" for max "+o.argmax}else if(F3(o)){return r+" for min "+o.argmin}else{return p1(o)+" of "+r}}return r}function d7(e){var t=e.aggregate,n=e.bin,r=e.timeUnit,i=e.field;if(O3(t)){return i+" for argmax("+t.argmax+")"}else if(F3(t)){return i+" for argmin("+t.argmin+")"}var a=g4(r);var o=t||(a===null||a===void 0?void 0:a.unit)||(a===null||a===void 0?void 0:a.maxbins)&&"timeunit"||I3(n)&&"bin";if(o){return o.toUpperCase()+"("+i+")"}else{return i}}var h7=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return d7(e);default:return c7(e,t)}};var v7=h7;function p7(e){v7=e}function g7(){p7(h7)}function m7(e,t,n){var r,i;var a=n.allowDisabling,o=n.includeDefault,u=o===void 0?true:o;var s=(r=y7(e))===null||r===void 0?void 0:r.title;if(!V9(e)){return s}var l=e;var f=u?_7(l,t):undefined;if(a){return k1(s,l.title,f)}else{return(i=s!==null&&s!==void 0?s:l.title)!==null&&i!==void 0?i:f}}function y7(e){if(n7(e)&&e.axis){return e.axis}else if(r7(e)&&e.legend){return e.legend}else if(z9(e)&&e.header){return e.header}return undefined}function _7(e,t){return v7(e,t)}function b7(e){var t;if(i7(e)){var n=e.format,r=e.formatType;return{format:n,formatType:r}}else{var i=(t=y7(e))!==null&&t!==void 0?t:{};var a=i.format,r=i.formatType;return{format:a,formatType:r}}}function x7(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(B9(e)&&Rr(e.sort)){return"ordinal"}var r=e.aggregate,i=e.bin,a=e.timeUnit;if(a){return"temporal"}if(i||r&&!O3(r)&&!F3(r)){return"quantitative"}if(t7(e)&&((n=e.scale)===null||n===void 0?void 0:n.type)){switch(U4[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}}return"nominal"}function w7(e){if(V9(e)){return e}else if(H9(e)){return e.condition}return undefined}function k7(e){if(Z9(e)){return e}else if(G9(e)){return e.condition}return undefined}function A7(e,t,n,r){if(r===void 0){r={}}if(Ni(e)||Fi(e)||Si(e)){var i=Ni(e)?"string":Fi(e)?"number":"boolean";G6(Y5(t,i,e));return{value:e}}if(Z9(e)){return E7(e,t,n,r)}else if(G9(e)){return __assign(__assign({},e),{condition:E7(e.condition,t,n,r)})}return e}function E7(e,t,n,r){var i;if(i7(e)){var a=e.format,o=e.formatType,u=Ice(e,["format","formatType"]);if(h9(o)&&!n.customFormatTypes){G6(G5(t));return E7(u,t,n,r)}}else{var s=n7(e)?"axis":r7(e)?"legend":z9(e)?"header":null;if(s&&e[s]){var l=e[s],f=l.format,o=l.formatType,c=Ice(l,["format","formatType"]);if(h9(o)&&!n.customFormatTypes){G6(G5(t));return E7(__assign(__assign({},e),(i={},i[s]=c,i)),t,n,r)}}}if(V9(e)){return S7(e,t,r)}return D7(e)}function D7(e){var t=e["type"];if(t){return e}var n=e.datum;t=Fi(n)?"quantitative":Ni(n)?"nominal":V6(n)?"temporal":undefined;return __assign(__assign({},e),{type:t})}function S7(e,t,n){var r=n===void 0?{}:n,i=r.compositeMark,a=i===void 0?false:i;var o=e.aggregate,u=e.timeUnit,s=e.bin,l=e.field;var f=__assign({},e);if(!a&&o&&!N3(o)&&!O3(o)&&!F3(o)){G6(Q5(o));delete f.aggregate}if(u){f.timeUnit=g4(u)}if(l){f.field=""+l}if(I3(s)){f.bin=C7(s,t)}if(U3(s)&&!r3(t)){G6(B6(t))}if(K9(f)){var c=f.type;var d=B4(c);if(c!==d){f.type=d}if(c!=="quantitative"){if(z3(o)){G6(J5(c,o));f.type="quantitative"}}}else if(!R2(t)){var h=x7(f,t);f["type"]=h}if(K9(f)){var v=F7(f,t)||{},p=v.compatible,g=v.warning;if(p===false){G6(g)}}if(B9(f)&&Ni(f.sort)){var m=f.sort;if(M9(m)){return __assign(__assign({},f),{sort:{encoding:m}})}var y=m.substr(1);if(m.charAt(0)==="-"&&M9(y)){return __assign(__assign({},f),{sort:{encoding:y,order:"descending"}})}}if(z9(f)){var _=f.header;if(_){var b=_.orient,x=Ice(_,["orient"]);if(b){return __assign(__assign({},f),{header:__assign(__assign({},x),{labelOrient:_.labelOrient||b,titleOrient:_.titleOrient||b})})}}}return f}function C7(e,t){if(Si(e)){return{maxbins:H3(t)}}else if(e==="binned"){return{binned:true}}else if(!e.maxbins&&!e.step){return __assign(__assign({},e),{maxbins:H3(t)})}else{return e}}var M7={compatible:true};function F7(e,t){var n=e.type;if(n==="geojson"&&t!=="shape"){return{compatible:false,warning:"Channel "+t+" should not be used with a geojson data."}}switch(t){case O1:case N1:case T1:if(!s7(e)){return{compatible:false,warning:i6(t)}}return M7;case z1:case R1:case $1:case V1:case Y1:case r2:case a2:case o2:case u2:case s2:case l2:case Q1:case I1:case j1:case f2:return M7;case W1:case G1:case q1:case H1:if(n!==z4){return{compatible:false,warning:"Channel "+t+" should be used with a quantitative field only, not "+e.type+" field."}}return M7;case Z1:case K1:case e2:case t2:case J1:case U1:case B1:case P1:case L1:if(n==="nominal"&&!e["sort"]){return{compatible:false,warning:"Channel "+t+" should not be used with an unsorted discrete field."}}return M7;case X1:case n2:if(!s7(e)&&!l7(e)){return{compatible:false,warning:a6(t)}}return M7;case i2:if(e.type==="nominal"&&!("sort"in e)){return{compatible:false,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}return M7}}function O7(e){var t=b7(e).formatType;return t==="time"||!t&&N7(e)}function N7(e){return e&&(e["type"]==="temporal"||V9(e)&&!!e.timeUnit)}function T7(e,t){var n;var r;var i=t.timeUnit,a=t.type,o=t.wrapTime,u=t.undefinedIfExprNotRequired;var s=i&&((r=g4(i))===null||r===void 0?void 0:r.unit);var l=s||a==="temporal";var f;if(G3(e)){f=e.expr}else if(X3(e)){f=e.signal}else if(V6(e)){l=true;f=n4(e)}else if(Ni(e)||Fi(e)){if(l){f="datetime("+V0(e)+")";if(u4(s)){if(Fi(e)&&e<1e4||Ni(e)&&isNaN(Date.parse(e))){f=n4((n={},n[s]=e,n))}}}}if(f){return o&&l?"time("+f+")":f}return u?undefined:V0(e)}function z7(e,t){var n=e.type;return t.map((function(t){var r=T7(t,{timeUnit:V9(e)?e.timeUnit:undefined,type:n,undefinedIfExprNotRequired:true});if(r!==undefined){return{signal:r}}return t}))}function R7(e,t){if(!I3(e.bin)){console.warn("Only call this method for binned field defs.");return false}return x3(t)&&["ordinal","nominal"].includes(e.type)}var P7={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function L7(e){return e&&e["condition"]}var j7=["domain","grid","labels","ticks","title"];var B7={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"};var I7={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1};var U7=__assign(__assign({},I7),{style:1,labelExpr:1,encoding:1});function q7(e){return!!U7[e]}var W7={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1};var H7=s1(W7);function G7(e){return"mark"in e}var $7=function(){function e(e,t){this.name=e;this.run=t}e.prototype.hasMatchingType=function(e){if(G7(e)){return r9(e.mark)===this.name}return false};return e}();function V7(e,t){var n=e&&e[t];if(n){if(Rr(n)){return Q0(n,(function(e){return!!e.field}))}else{return V9(n)||H9(n)}}return false}function Y7(e){return Q0(k2,(function(t){if(V7(e,t)){var n=e[t];if(Rr(n)){return Q0(n,(function(e){return!!e.aggregate}))}else{var r=w7(n);return r&&!!r.aggregate}}return false}))}function X7(e,t){var n=[];var r=[];var i=[];var a=[];var o={};eee(e,(function(u,s){if(V9(u)){var l=u.field,f=u.aggregate,c=u.bin,d=u.timeUnit,h=Ice(u,["field","aggregate","bin","timeUnit"]);if(f||d||c){var v=y7(u);var p=v&&v.title;var g=u7(u,{forAs:true});var m=__assign(__assign(__assign({},p?[]:{title:m7(u,t,{allowDisabling:true})}),h),{field:g});if(f){var y=void 0;if(O3(f)){y="argmax";g=u7({op:"argmax",field:f.argmax},{forAs:true});m.field=g+"."+l}else if(F3(f)){y="argmin";g=u7({op:"argmin",field:f.argmin},{forAs:true});m.field=g+"."+l}else if(f!=="boxplot"&&f!=="errorbar"&&f!=="errorband"){y=f}if(y){var _={op:y,as:g};if(l){_.field=l}a.push(_)}}else{n.push(g);if(K9(u)&&I3(c)){r.push({bin:c,field:l,as:g});n.push(u7(u,{binSuffix:"end"}));if(R7(u,s)){n.push(u7(u,{binSuffix:"range"}))}if(r3(s)){var b={field:g+"_end"};o[s+"2"]=b}m.bin="binned";if(!R2(s)){m["type"]=z4}}else if(d){i.push({timeUnit:d,field:l,as:g});var x=K9(u)&&u.type!==P4&&"time";if(x){if(s===r2||s===u2){m["formatType"]=x}else if(m3(s)){m["legend"]=__assign({formatType:x},m["legend"])}else if(r3(s)){m["axis"]=__assign({formatType:x},m["axis"])}}}}o[s]=m}else{n.push(l);o[s]=e[s]}}else{o[s]=e[s]}}));return{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function J7(e,t,n){var r=w3(t,n);if(!r){return false}else if(r==="binned"){var i=e[t===P1?z1:R1];if(V9(i)&&V9(e[t])&&U3(i.bin)){return true}else{return false}}return true}function Q7(e,t,n,r){return s1(e).reduce((function(i,a){if(!T2(a)){G6(r6(a));return i}var o=e[a];if(a==="angle"&&t==="arc"&&!e.theta){G6(V5);a=I1}if(!J7(e,a,t)){G6(n6(a,t));return i}if(a===J1&&t==="line"){var u=w7(e[a]);if(u===null||u===void 0?void 0:u.aggregate){G6(t6);return i}}if(a===$1&&(n?"fill"in e:"stroke"in e)){G6(Z5("encoding",{fill:"fill"in e,stroke:"stroke"in e}));return i}if(a===a2||a===i2&&!Rr(o)&&!e7(o)||a===u2&&Rr(o)){if(o){i[a]=oi(o).reduce((function(e,t){if(!V9(t)){G6(e6(t,a))}else{e.push(S7(t,a))}return e}),[])}}else{if(a===u2&&o===null){i[a]=null}else if(!V9(o)&&!X9(o)&&!e7(o)&&!W9(o)&&!X3(o)){G6(e6(o,a));return i}i[a]=A7(o,a,r)}return i}),{})}function Z7(e,t){var n={};for(var r=0,i=s1(e);r<i.length;r++){var a=i[r];var o=A7(e[a],a,t,{compositeMark:true});n[a]=o}return n}function K7(e){var t=[];for(var n=0,r=s1(e);n<r.length;n++){var i=r[n];if(V7(e,i)){var a=e[i];var o=oi(a);for(var u=0,s=o;u<s.length;u++){var l=s[u];if(V9(l)){t.push(l)}else if(H9(l)){t.push(l.condition)}}}}return t}function eee(e,t,n){if(!e){return}for(var r=0,i=s1(e);r<i.length;r++){var a=i[r];var o=e[a];if(Rr(o)){for(var u=0,s=o;u<s.length;u++){var l=s[u];t.call(n,l,a)}}else{t.call(n,o,a)}}}function tee(e,t,n,r){if(!e){return n}return s1(e).reduce((function(n,i){var a=e[i];if(Rr(a)){return a.reduce((function(e,n){return t.call(r,e,n,i)}),n)}else{return t.call(r,n,a,i)}}),n)}function nee(e,t){return s1(t).reduce((function(n,r){switch(r){case z1:case R1:case s2:case f2:case l2:case P1:case L1:case I1:case U1:case j1:case B1:case q1:case W1:case H1:case G1:case r2:case X1:case Q1:case u2:return n;case i2:if(e==="line"||e==="trail"){return n}case a2:case o2:{var i=t[r];if(Rr(i)||V9(i)){for(var a=0,o=oi(i);a<o.length;a++){var u=o[a];if(!u.aggregate){n.push(u7(u,{}))}}}return n}case J1:if(e==="trail"){return n}case $1:case V1:case Y1:case Z1:case K1:case e2:case n2:case t2:{var u=w7(t[r]);if(u&&!u.aggregate){n.push(u7(u,{}))}return n}}}),[])}function ree(e){var t=e.tooltip,n=Ice(e,["tooltip"]);if(!t){return{filteredEncoding:n}}var r;var i;if(Rr(t)){for(var a=0,o=t;a<o.length;a++){var u=o[a];if(u.aggregate){if(!r){r=[]}r.push(u)}else{if(!i){i=[]}i.push(u)}}if(r){n.tooltip=r}}else{if(t["aggregate"]){n.tooltip=t}else{i=t}}if(Rr(i)&&i.length===1){i=i[0]}return{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}function iee(e,t,n,r){if(r===void 0){r=true}if("tooltip"in n){return{tooltip:n.tooltip}}var i=e.map((function(e){var n=e.fieldPrefix,i=e.titlePrefix;var a=r?" of "+aee(t):"";return{field:n+t.field,type:t.type,title:X3(i)?{signal:i+'"'+escape(a)+'"'}:i+a}}));var a=K7(n).map(a7);return{tooltip:__spreadArray(__spreadArray([],i),t1(a,Y0))}}function aee(e){var t=e.title,n=e.field;return k1(t,n)}function oee(e,t,n,r,i){var a=n.scale,o=n.axis;return function(u){var s,l;var f=u.partName,c=u.mark,d=u.positionPrefix,h=u.endPositionPrefix,v=h===void 0?undefined:h,p=u.extraEncoding,g=p===void 0?{}:p;var m=aee(n);return uee(e,f,i,{mark:c,encoding:__assign(__assign(__assign((s={},s[t]=__assign(__assign(__assign({field:d+"_"+n.field,type:n.type},m!==undefined?{title:m}:{}),a!==undefined?{scale:a}:{}),o!==undefined?{axis:o}:{}),s),Ni(v)?(l={},l[t+"2"]={field:v+"_"+n.field},l):{}),r),g)})}}function uee(e,t,n,r){var i=e.clip,a=e.color,o=e.opacity;var u=e.type;if(e[t]||e[t]===undefined&&n[t]){return[__assign(__assign({},r),{mark:__assign(__assign(__assign(__assign(__assign(__assign(__assign({},n[t]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),U8(r.mark)?r.mark:{type:r.mark}),{style:u+"-"+t}),Si(e[t])?{}:e[t])})]}return[]}function see(e,t,n){var r=e.encoding;var i=t==="vertical"?"y":"x";var a=r[i];var o=r[i+"2"];var u=r[i+"Error"];var s=r[i+"Error2"];return{continuousAxisChannelDef:lee(a,n),continuousAxisChannelDef2:lee(o,n),continuousAxisChannelDefError:lee(u,n),continuousAxisChannelDefError2:lee(s,n),continuousAxis:i}}function lee(e,t){if(e&&e.aggregate){var n=e.aggregate,r=Ice(e,["aggregate"]);if(n!==t){G6(P6(n,t))}return r}else{return e}}function fee(e,t){var n=e.mark,r=e.encoding;var i=r.x,a=r.y;if(U8(n)&&n.orient){return n.orient}if(J9(i)){if(J9(a)){var o=V9(i)&&i.aggregate;var u=V9(a)&&a.aggregate;if(!o&&u===t){return"vertical"}else if(!u&&o===t){return"horizontal"}else if(o===t&&u===t){throw new Error("Both x and y cannot have aggregate")}else{if(O7(a)&&!O7(i)){return"horizontal"}return"vertical"}}return"horizontal"}else if(J9(a)){return"vertical"}else{throw new Error("Need a valid continuous axis for "+t+"s")}}var cee="boxplot";var dee=["box","median","outliers","rule","ticks"];var hee=new $7(cee,pee);function vee(e){if(Fi(e)){return"tukey"}return e}function pee(e,t){var n,r;var i,a;var o=t.config;e=__assign(__assign({},e),{encoding:Z7(e.encoding,o)});var u=e.mark,s=e.encoding,l=e.params,f=e.projection,c=Ice(e,["mark","encoding","params","projection"]);var d=U8(u)?u:{type:u};if(l){G6(M5("boxplot"))}var h=(i=d.extent)!==null&&i!==void 0?i:o.boxplot.extent;var v=d5("size",d,o);var p=vee(h);var g=mee(e,h,o),m=g.bins,y=g.timeUnits,_=g.transform,b=g.continuousAxisChannelDef,x=g.continuousAxis,w=g.groupby,k=g.aggregate,A=g.encodingWithoutContinuousAxis,E=g.ticksOrient,D=g.boxOrient,S=g.customTooltipWithoutAggregatedField;var C=A.color,M=A.size,F=Ice(A,["color","size"]);var O=function(e){return oee(d,x,b,e,o.boxplot)};var N=O(F);var T=O(A);var z=O(__assign(__assign({},F),M?{size:M}:{}));var R=iee([{fieldPrefix:p==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:p==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],b,A);var P={type:"tick",color:"black",opacity:1,orient:E,invalid:null,aria:false};var L=p==="min-max"?R:iee([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],b,A);var j=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],N({partName:"rule",mark:{type:"rule",invalid:null,aria:false},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:L})),N({partName:"rule",mark:{type:"rule",invalid:null,aria:false},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:L})),N({partName:"ticks",mark:P,positionPrefix:"lower_whisker",extraEncoding:L})),N({partName:"ticks",mark:P,positionPrefix:"upper_whisker",extraEncoding:L}));var B=__spreadArray(__spreadArray(__spreadArray([],p!=="tukey"?j:[]),T({partName:"box",mark:__assign(__assign({type:"bar"},v?{size:v}:{}),{orient:D,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:R})),z({partName:"median",mark:__assign(__assign(__assign({type:"tick",invalid:null},Pr(o.boxplot.median)&&o.boxplot.median.color?{color:o.boxplot.median.color}:{}),v?{size:v}:{}),{orient:E,aria:false}),positionPrefix:"mid_box",extraEncoding:R}));if(p==="min-max"){return __assign(__assign({},c),{transform:((a=c.transform)!==null&&a!==void 0?a:[]).concat(_),layer:B})}var I='datum["lower_box_'+b.field+'"]';var U='datum["upper_box_'+b.field+'"]';var q="("+U+" - "+I+")";var W=I+" - "+h+" * "+q;var H=U+" + "+h+" * "+q;var G='datum["'+b.field+'"]';var $={joinaggregate:gee(b.field),groupby:w};var V={transform:[{filter:"("+W+" <= "+G+") && ("+G+" <= "+H+")"},{aggregate:__spreadArray([{op:"min",field:b.field,as:"lower_whisker_"+b.field},{op:"max",field:b.field,as:"upper_whisker_"+b.field},{op:"min",field:"lower_box_"+b.field,as:"lower_box_"+b.field},{op:"max",field:"upper_box_"+b.field,as:"upper_box_"+b.field}],k),groupby:w}],layer:j};var Y=F.tooltip,X=Ice(F,["tooltip"]);var J=b.scale,Q=b.axis;var Z=aee(b);var K=$0(Q,["title"]);var ee=uee(d,"outliers",o.boxplot,{transform:[{filter:"("+G+" < "+W+") || ("+G+" > "+H+")"}],mark:"point",encoding:__assign(__assign(__assign((n={},n[x]=__assign(__assign(__assign({field:b.field,type:b.type},Z!==undefined?{title:Z}:{}),J!==undefined?{scale:J}:{}),u1(K)?{}:{axis:K}),n),X),C?{color:C}:{}),S?{tooltip:S}:{})})[0];var te;var ne=__spreadArray(__spreadArray(__spreadArray([],m),y),[$]);if(ee){te={transform:ne,layer:[ee,V]}}else{te=V;(r=te.transform).unshift.apply(r,ne)}return __assign(__assign({},c),{layer:[te,{transform:_,layer:B}]})}function gee(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function mee(e,t,n){var r=fee(e,cee);var i=see(e,r,cee),a=i.continuousAxisChannelDef,o=i.continuousAxis;var u=a.field;var s=vee(t);var l=__spreadArray(__spreadArray([],gee(u)),[{op:"median",field:u,as:"mid_box_"+u},{op:"min",field:u,as:(s==="min-max"?"lower_whisker_":"min_")+u},{op:"max",field:u,as:(s==="min-max"?"upper_whisker_":"max_")+u}]);var f=s==="min-max"||s==="tukey"?[]:[{calculate:'datum["upper_box_'+u+'"] - datum["lower_box_'+u+'"]',as:"iqr_"+u},{calculate:'min(datum["upper_box_'+u+'"] + datum["iqr_'+u+'"] * '+t+', datum["max_'+u+'"])',as:"upper_whisker_"+u},{calculate:'max(datum["lower_box_'+u+'"] - datum["iqr_'+u+'"] * '+t+', datum["min_'+u+'"])',as:"lower_whisker_"+u}];var c=e.encoding,d=o,h=c[d],v=Ice(c,[typeof d==="symbol"?d:d+""]);var p=ree(v),g=p.customTooltipWithoutAggregatedField,m=p.filteredEncoding;var y=X7(m,n),_=y.bins,b=y.timeUnits,x=y.aggregate,w=y.groupby,k=y.encoding;var A=r==="vertical"?"horizontal":"vertical";var E=r;var D=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],_),b),[{aggregate:__spreadArray(__spreadArray([],x),l),groupby:w}]),f);return{bins:_,timeUnits:b,transform:D,groupby:w,aggregate:x,continuousAxisChannelDef:a,continuousAxis:o,encodingWithoutContinuousAxis:k,ticksOrient:A,boxOrient:E,customTooltipWithoutAggregatedField:g}}var yee="errorbar";var _ee=["ticks","rule"];var bee=new $7(yee,xee);function xee(e,t){var n=t.config;e=__assign(__assign({},e),{encoding:Z7(e.encoding,n)});var r=Dee(e,yee,n),i=r.transform,a=r.continuousAxisChannelDef,o=r.continuousAxis,u=r.encodingWithoutContinuousAxis,s=r.ticksOrient,l=r.markDef,f=r.outerSpec,c=r.tooltipEncoding;delete u["size"];var d=oee(l,o,a,u,n.errorbar);var h=l.thickness;var v=l.size;var p=__assign(__assign({type:"tick",orient:s,aria:false},h!==undefined?{thickness:h}:{}),v!==undefined?{size:v}:{});var g=__spreadArray(__spreadArray(__spreadArray([],d({partName:"ticks",mark:p,positionPrefix:"lower",extraEncoding:c})),d({partName:"ticks",mark:p,positionPrefix:"upper",extraEncoding:c})),d({partName:"rule",mark:__assign({type:"rule",ariaRoleDescription:"errorbar"},h!==undefined?{size:h}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}));return __assign(__assign(__assign({},f),{transform:i}),g.length>1?{layer:g}:__assign({},g[0]))}function wee(e,t){var n=e.encoding;if(kee(n)){return{orient:fee(e,t),inputType:"raw"}}var r=Aee(n);var i=Eee(n);var a=n.x;var o=n.y;if(r){if(i){throw new Error(t+" cannot be both type aggregated-upper-lower and aggregated-error")}var u=n.x2;var s=n.y2;if(Z9(u)&&Z9(s)){throw new Error(t+" cannot have both x2 and y2")}else if(Z9(u)){if(J9(a)){return{orient:"horizontal",inputType:"aggregated-upper-lower"}}else{throw new Error("Both x and x2 have to be quantitative in "+t)}}else if(Z9(s)){if(J9(o)){return{orient:"vertical",inputType:"aggregated-upper-lower"}}else{throw new Error("Both y and y2 have to be quantitative in "+t)}}throw new Error("No ranged axis")}else{var l=n.xError;var f=n.xError2;var c=n.yError;var d=n.yError2;if(Z9(f)&&!Z9(l)){throw new Error(t+" cannot have xError2 without xError")}if(Z9(d)&&!Z9(c)){throw new Error(t+" cannot have yError2 without yError")}if(Z9(l)&&Z9(c)){throw new Error(t+" cannot have both xError and yError with both are quantiative")}else if(Z9(l)){if(J9(a)){return{orient:"horizontal",inputType:"aggregated-error"}}else{throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}}else if(Z9(c)){if(J9(o)){return{orient:"vertical",inputType:"aggregated-error"}}else{throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}}throw new Error("No ranged axis")}}function kee(e){return(Z9(e.x)||Z9(e.y))&&!Z9(e.x2)&&!Z9(e.y2)&&!Z9(e.xError)&&!Z9(e.xError2)&&!Z9(e.yError)&&!Z9(e.yError2)}function Aee(e){return Z9(e.x2)||Z9(e.y2)}function Eee(e){return Z9(e.xError)||Z9(e.xError2)||Z9(e.yError)||Z9(e.yError2)}function Dee(e,t,n){var r;var i=e.mark,a=e.encoding,o=e.params,u=e.projection,s=Ice(e,["mark","encoding","params","projection"]);var l=U8(i)?i:{type:i};if(o){G6(M5(t))}var f=wee(e,t),c=f.orient,d=f.inputType;var h=see(e,c,t),v=h.continuousAxisChannelDef,p=h.continuousAxisChannelDef2,g=h.continuousAxisChannelDefError,m=h.continuousAxisChannelDefError2,y=h.continuousAxis;var _=See(l,v,p,g,m,d,t,n),b=_.errorBarSpecificAggregate,x=_.postAggregateCalculates,w=_.tooltipSummary,k=_.tooltipTitleWithFieldName;var A=a,E=y,D=A[E],S=y==="x"?"x2":"y2",C=A[S],M=y==="x"?"xError":"yError",F=A[M],O=y==="x"?"xError2":"yError2",N=A[O],T=Ice(A,[typeof E==="symbol"?E:E+"",typeof S==="symbol"?S:S+"",typeof M==="symbol"?M:M+"",typeof O==="symbol"?O:O+""]);var z=X7(T,n),R=z.bins,P=z.timeUnits,L=z.aggregate,j=z.groupby,B=z.encoding;var I=__spreadArray(__spreadArray([],L),b);var U=d!=="raw"?[]:j;var q=iee(w,v,B,k);return{transform:__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],(r=s.transform)!==null&&r!==void 0?r:[]),R),P),I.length===0?[]:[{aggregate:I,groupby:U}]),x),groupby:U,continuousAxisChannelDef:v,continuousAxis:y,encodingWithoutContinuousAxis:B,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:s,tooltipEncoding:q}}function See(e,t,n,r,i,a,o,u){var s=[];var l=[];var f=t.field;var c;var d=false;if(a==="raw"){var h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":u.errorbar.center;var v=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!==(v==="iqr")){G6(R6(h,v,o))}if(v==="stderr"||v==="stdev"){s=[{op:v,field:f,as:"extent_"+f},{op:h,field:f,as:"center_"+f}];l=[{calculate:'datum["center_'+f+'"] + datum["extent_'+f+'"]',as:"upper_"+f},{calculate:'datum["center_'+f+'"] - datum["extent_'+f+'"]',as:"lower_"+f}];c=[{fieldPrefix:"center_",titlePrefix:p1(h)},{fieldPrefix:"upper_",titlePrefix:Cee(h,v,"+")},{fieldPrefix:"lower_",titlePrefix:Cee(h,v,"-")}];d=true}else{var p=void 0;var g=void 0;var m=void 0;if(v==="ci"){p="mean";g="ci0";m="ci1"}else{p="median";g="q1";m="q3"}s=[{op:g,field:f,as:"lower_"+f},{op:m,field:f,as:"upper_"+f},{op:p,field:f,as:"center_"+f}];c=[{fieldPrefix:"upper_",titlePrefix:m7({field:f,aggregate:m,type:"quantitative"},u,{allowDisabling:false})},{fieldPrefix:"lower_",titlePrefix:m7({field:f,aggregate:g,type:"quantitative"},u,{allowDisabling:false})},{fieldPrefix:"center_",titlePrefix:m7({field:f,aggregate:p,type:"quantitative"},u,{allowDisabling:false})}]}}else{if(e.center||e.extent){G6(z6(e.center,e.extent))}if(a==="aggregated-upper-lower"){c=[];l=[{calculate:'datum["'+n.field+'"]',as:"upper_"+f},{calculate:'datum["'+f+'"]',as:"lower_"+f}]}else if(a==="aggregated-error"){c=[{fieldPrefix:"",titlePrefix:f}];l=[{calculate:'datum["'+f+'"] + datum["'+r.field+'"]',as:"upper_"+f}];if(i){l.push({calculate:'datum["'+f+'"] + datum["'+i.field+'"]',as:"lower_"+f})}else{l.push({calculate:'datum["'+f+'"] - datum["'+r.field+'"]',as:"lower_"+f})}}for(var y=0,_=l;y<_.length;y++){var b=_[y];c.push({fieldPrefix:b.as.substring(0,6),titlePrefix:b1(b1(b.calculate,'datum["',""),'"]',"")})}}return{postAggregateCalculates:l,errorBarSpecificAggregate:s,tooltipSummary:c,tooltipTitleWithFieldName:d}}function Cee(e,t,n){return p1(e)+" "+n+" "+t}var Mee="errorband";var Fee=["band","borders"];var Oee=new $7(Mee,Nee);function Nee(e,t){var n=t.config;e=__assign(__assign({},e),{encoding:Z7(e.encoding,n)});var r=Dee(e,Mee,n),i=r.transform,a=r.continuousAxisChannelDef,o=r.continuousAxis,u=r.encodingWithoutContinuousAxis,s=r.markDef,l=r.outerSpec,f=r.tooltipEncoding;var c=s;var d=oee(c,o,a,u,n.errorband);var h=e.encoding.x!==undefined&&e.encoding.y!==undefined;var v={type:h?"area":"rect"};var p={type:h?"line":"rule"};var g=__assign(__assign({},c.interpolate?{interpolate:c.interpolate}:{}),c.tension&&c.interpolate?{tension:c.tension}:{});if(h){v=__assign(__assign(__assign({},v),g),{ariaRoleDescription:"errorband"});p=__assign(__assign(__assign({},p),g),{aria:false})}else if(c.interpolate){G6(L6("interpolate"))}else if(c.tension){G6(L6("tension"))}return __assign(__assign({},l),{transform:i,layer:__spreadArray(__spreadArray(__spreadArray([],d({partName:"band",mark:v,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:f})),d({partName:"borders",mark:p,positionPrefix:"lower",extraEncoding:f})),d({partName:"borders",mark:p,positionPrefix:"upper",extraEncoding:f}))})}var Tee={};function zee(e,t,n){var r=new $7(e,t);Tee[e]={normalizer:r,parts:n}}function Ree(){return s1(Tee)}zee(cee,pee,dee);zee(yee,xee,_ee);zee(Mee,Nee,Fee);var Pee=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"];var Lee={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"};var jee={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"};var Bee=s1(Lee);var Iee=s1(jee);var Uee={header:1,headerRow:1,headerColumn:1,headerFacet:1};var qee=s1(Uee);var Wee=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"];var Hee={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35};var Gee={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};var $ee="_vgsid_";var Vee={point:{on:"click",fields:[$ee],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Yee(e){return!!e&&(e==="legend"||!!e.legend)}function Xee(e){return Yee(e)&&Pr(e)}function Jee(e){return!!e["select"]}function Qee(e){var t=[];for(var n=0,r=e||[];n<r.length;n++){var i=r[n];if(Jee(i))continue;var a=i.expr,o=i.bind,u=Ice(i,["expr","bind"]);if(o&&a){var s=__assign(__assign({},u),{bind:o,init:a});t.push(s)}else{var s=__assign(__assign(__assign({},u),a?{update:a}:{}),o?{bind:o}:{});t.push(s)}}return t}function Zee(e){return ete(e)||tte(e)||Kee(e)}function Kee(e){return"concat"in e}function ete(e){return"vconcat"in e}function tte(e){return"hconcat"in e}function nte(e){return Pr(e)&&e["step"]!==undefined}function rte(e){return e["view"]||e["width"]||e["height"]}var ite=20;var ate={align:1,bounds:1,center:1,columns:1,spacing:1};var ote=s1(ate);function ute(e,t,n){var r,i;var a=n[t];var o={};var u=a.spacing,s=a.columns;if(u!==undefined){o.spacing=u}if(s!==undefined){if(R9(e)&&!T9(e.facet)||Kee(e)){o.columns=s}}if(ete(e)){o.columns=1}for(var l=0,f=ote;l<f.length;l++){var c=f[l];if(e[c]!==undefined){if(c==="spacing"){var d=e[c];o[c]=Fi(d)?d:{row:(r=d.row)!==null&&r!==void 0?r:u,column:(i=d.column)!==null&&i!==void 0?i:u}}else{o[c]=e[c]}}}return o}function ste(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function lte(e,t){var n=fte(e,t);return nte(n)?n.step:cte}function fte(e,t){var n;var r=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return k1(r,{step:e.step})}var cte=20;var dte={continuousWidth:200,continuousHeight:200,step:cte};var hte={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:dte,mark:Y8,arc:{},area:{},bar:e9,circle:{},geoshape:{},image:{},line:{},point:{},rect:t9,rule:{color:"black"},square:{},text:{color:"black"},tick:n9,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:true,ticks:false},errorband:{band:{opacity:.3},borders:false},scale:o8,projection:{},legend:Hee,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Vee,style:{},title:{},facet:{spacing:ite},concat:{spacing:ite}};var vte=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"];var pte={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12};var gte={blue:vte[0],orange:vte[1],red:vte[2],teal:vte[3],green:vte[4],yellow:vte[5],purple:vte[6],pink:vte[7],brown:vte[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function mte(e){if(e===void 0){e={}}return{signals:[{name:"color",value:Pr(e)?__assign(__assign({},gte),e):gte}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function yte(e){return{signals:[{name:"fontSize",value:Pr(e)?__assign(__assign({},pte),e):pte}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function _te(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function bte(e){var t=s1(e||{});var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];var o=e[a];n[a]=L7(o)?i5(o):a5(o)}return n}function xte(e){var t=s1(e);var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];n[a]=bte(e[a])}return n}var wte=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],J8),H7),qee),["background","padding","legend","lineBreak","scale","style","title","view"]);function kte(e){if(e===void 0){e={}}var t=e.color,n=e.font,r=e.fontSize,i=Ice(e,["color","font","fontSize"]);var a=jr({},hte,n?_te(n):{},t?mte(t):{},r?yte(r):{},i||{});var o=$0(a,wte);for(var u=0,s=["background","lineBreak","padding"];u<s.length;u++){var l=s[u];if(a[l]){o[l]=a5(a[l])}}for(var f=0,c=J8;f<c.length;f++){var d=c[f];if(a[d]){o[d]=$3(a[d])}}for(var h=0,v=H7;h<v.length;h++){var p=v[h];if(a[p]){o[p]=bte(a[p])}}for(var g=0,m=qee;g<m.length;g++){var y=m[g];if(a[y]){o[y]=$3(a[y])}}if(a.legend){o.legend=$3(a.legend)}if(a.scale){o.scale=$3(a.scale)}if(a.style){o.style=xte(a.style)}if(a.title){o.title=$3(a.title)}if(a.view){o.view=$3(a.view)}return o}var Ate=__spreadArray(["view"],I8);var Ete=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"];var Dte=__assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},V8);function Ste(e){e=H0(e);for(var t=0,n=Ete;t<n.length;t++){var r=n[t];delete e[r]}if(e.axis){for(var r in e.axis){if(L7(e.axis[r])){delete e.axis[r]}}}if(e.legend){for(var i=0,a=Pee;i<a.length;i++){var r=a[i];delete e.legend[r]}}if(e.mark){for(var o=0,u=$8;o<u.length;o++){var r=u[o];delete e.mark[r]}if(e.mark.tooltip&&Pr(e.mark.tooltip)){delete e.mark.tooltip}}if(e.params){e.signals=(e.signals||[]).concat(Qee(e.params));delete e.params}for(var s=0,l=Ate;s<l.length;s++){var f=l[s];for(var c=0,d=$8;c<d.length;c++){var r=d[c];delete e[f][r]}var h=Dte[f];if(h){for(var v=0,p=h;v<p.length;v++){var r=p[v];delete e[f][r]}}Mte(e,f)}for(var g=0,m=Ree();g<m.length;g++){var y=m[g];delete e[y]}Cte(e);for(var r in e){if(Pr(e[r])&&u1(e[r])){delete e[r]}}return u1(e)?undefined:e}function Cte(e){var t=V3(e.title),n=t.titleMarkConfig,r=t.subtitleMarkConfig,i=t.subtitle;if(!u1(n)){e.style["group-title"]=__assign(__assign({},e.style["group-title"]),n)}if(!u1(r)){e.style["group-subtitle"]=__assign(__assign({},e.style["group-subtitle"]),r)}if(!u1(i)){e.title=i}else{delete e.title}}function Mte(e,t,n,r){var i=r?e[t][r]:e[t];if(t==="view"){n="cell"}var a=__assign(__assign({},i),e.style[n!==null&&n!==void 0?n:t]);if(!u1(a)){e.style[n!==null&&n!==void 0?n:t]=a}if(!r){delete e[t]}}function Fte(e){return"layer"in e}function Ote(e){return"repeat"in e}function Nte(e){return!Rr(e.repeat)&&e.repeat["layer"]}var Tte=function(){function e(){}e.prototype.map=function(e,t){if(R9(e)){return this.mapFacet(e,t)}else if(Ote(e)){return this.mapRepeat(e,t)}else if(tte(e)){return this.mapHConcat(e,t)}else if(ete(e)){return this.mapVConcat(e,t)}else if(Kee(e)){return this.mapConcat(e,t)}else{return this.mapLayerOrUnit(e,t)}};e.prototype.mapLayerOrUnit=function(e,t){if(Fte(e)){return this.mapLayer(e,t)}else if(G7(e)){return this.mapUnit(e,t)}throw new Error(b5(e))};e.prototype.mapLayer=function(e,t){var n=this;return __assign(__assign({},e),{layer:e.layer.map((function(e){return n.mapLayerOrUnit(e,t)}))})};e.prototype.mapHConcat=function(e,t){var n=this;return __assign(__assign({},e),{hconcat:e.hconcat.map((function(e){return n.map(e,t)}))})};e.prototype.mapVConcat=function(e,t){var n=this;return __assign(__assign({},e),{vconcat:e.vconcat.map((function(e){return n.map(e,t)}))})};e.prototype.mapConcat=function(e,t){var n=this;var r=e.concat,i=Ice(e,["concat"]);return __assign(__assign({},i),{concat:r.map((function(e){return n.map(e,t)}))})};e.prototype.mapFacet=function(e,t){return __assign(__assign({},e),{spec:this.map(e.spec,t)})};e.prototype.mapRepeat=function(e,t){return __assign(__assign({},e),{spec:this.map(e.spec,t)})};return e}();var zte={zero:1,center:1,normalize:1};function Rte(e){return e in zte}var Pte=new Set([A8,D8,E8,O8,M8,R8,P8,C8,N8,T8]);var Lte=new Set([D8,E8,A8]);function jte(e,t){var n,r;var i=t==="x"?"y":"radius";var a=e[t];var o=e[i];if(V9(a)&&V9(o)){if(Y9(a)==="quantitative"&&Y9(o)==="quantitative"){if(a.stack){return t}else if(o.stack){return i}var u=V9(a)&&!!a.aggregate;var s=V9(o)&&!!o.aggregate;if(u!==s){return u?t:i}else{var l=(n=a.scale)===null||n===void 0?void 0:n.type;var f=(r=o.scale)===null||r===void 0?void 0:r.type;if(l&&l!=="linear"){return i}else if(f&&f!=="linear"){return t}}}else if(Y9(a)==="quantitative"){return t}else if(Y9(o)==="quantitative"){return i}}else if(Y9(a)==="quantitative"){return t}else if(Y9(o)==="quantitative"){return i}return undefined}function Bte(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Ite(e,t,n){var r,i;if(n===void 0){n={}}var a=U8(e)?e.type:e;if(!Pte.has(a)){return null}var o=jte(t,"x")||jte(t,"theta");if(!o){return null}var u=t[o];var s=V9(u)?u7(u,{}):undefined;var l=Bte(o);var f=t[l];var c=V9(f)?u7(f,{}):undefined;if(c===s){c=undefined;f=undefined;l=undefined}var d=e3.reduce((function(e,n){if(n!=="tooltip"&&V7(t,n)){var r=t[n];for(var i=0,a=oi(r);i<a.length;i++){var o=a[i];var u=w7(o);if(u.aggregate){continue}var s=u7(u,{});if(!s||s!==c){e.push({channel:n,fieldDef:u})}}}return e}),[]);var h;if(u.stack!==undefined){if(Si(u.stack)){h=u.stack?"zero":null}else{h=u.stack}}else if(Lte.has(a)){h="zero"}if(!h||!Rte(h)){return null}if(Y7(t)&&d.length===0){return null}if(((r=u===null||u===void 0?void 0:u.scale)===null||r===void 0?void 0:r.type)&&((i=u===null||u===void 0?void 0:u.scale)===null||i===void 0?void 0:i.type)!==I4.LINEAR){if(n.disallowNonLinearStack){return null}else{G6(F6(u.scale.type))}}if(Z9(t[j2(o)])){if(u.stack!==undefined){G6(M6(o))}return null}if(V9(u)&&u.aggregate&&!J0(P3,u.aggregate)){G6(O6(u.aggregate))}return{groupbyChannel:f?l:undefined,groupbyField:c,fieldChannel:o,impute:u.impute===null?false:j8(a),stackBy:d,offset:h}}function Ute(e){var t=e.point,n=e.line,r=Ice(e,["point","line"]);return s1(r).length>1?r:r.type}function qte(e){var t;for(var n=0,r=["line","area","rule","trail"];n<r.length;n++){var i=r[n];if(e[i]){e=__assign(__assign({},e),(t={},t[i]=$0(e[i],["point","line"]),t))}}return e}function Wte(e,t,n){if(t===void 0){t={}}if(e.point==="transparent"){return{opacity:0}}else if(e.point){return Pr(e.point)?e.point:{}}else if(e.point!==undefined){return null}else{if(t.point||n.shape){return Pr(t.point)?t.point:{}}return undefined}}function Hte(e,t){if(t===void 0){t={}}if(e.line){return e.line===true?{}:e.line}else if(e.line!==undefined){return null}else{if(t.line){return t.line===true?{}:t.line}return undefined}}var Gte=function(){function e(){this.name="path-overlay"}e.prototype.hasMatchingType=function(e,t){if(G7(e)){var n=e.mark,r=e.encoding;var i=U8(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!Wte(i,t[i.type],r);case"area":return!!Wte(i,t[i.type],r)||!!Hte(i,t[i.type])}}return false};e.prototype.run=function(e,t,n){var r;var i=t.config;var a=e.params,o=e.projection,u=e.mark,s=e.encoding,l=Ice(e,["params","projection","mark","encoding"]);var f=Z7(s,i);var c=U8(u)?u:{type:u};var d=Wte(c,i[c.type],f);var h=c.type==="area"&&Hte(c,i[c.type]);var v=[__assign(__assign({},a?{params:a}:{}),{mark:Ute(__assign(__assign({},c.type==="area"&&c.opacity===undefined&&c.fillOpacity===undefined?{opacity:.7}:{}),c)),encoding:$0(f,["shape"])})];var p=Ite(c,f);var g=f;if(p){var m=p.fieldChannel,y=p.offset;g=__assign(__assign({},f),(r={},r[m]=__assign(__assign({},f[m]),y?{stack:y}:{}),r))}if(h){v.push(__assign(__assign({},o?{projection:o}:{}),{mark:__assign(__assign({type:"line"},G0(c,["clip","interpolate","tension","tooltip"])),h),encoding:g}))}if(d){v.push(__assign(__assign({},o?{projection:o}:{}),{mark:__assign(__assign({type:"point",opacity:1,filled:true},G0(c,["clip","tooltip"])),d),encoding:g}))}return n(__assign(__assign({},l),{layer:v}),__assign(__assign({},t),{config:qte(i)}))};return e}();function $te(e,t){if(!t){return e}if(T9(e)){return Zte(e,t)}return Xte(e,t)}function Vte(e,t){if(!t){return e}return Zte(e,t)}function Yte(e,t,n){var r;var i=t[e];if(L9(i)){if(i.repeat in n){return __assign(__assign({},t),(r={},r[e]=n[i.repeat],r))}else{G6(L5(i.repeat));return undefined}}return t}function Xte(e,t){e=Yte("field",e,t);if(e===undefined){return undefined}else if(e===null){return null}if(B9(e)&&O9(e.sort)){var n=Yte("field",e.sort,t);e=__assign(__assign({},e),n?{sort:n}:{})}return e}function Jte(e,t){if(V9(e)){return Xte(e,t)}else{var n=Yte("datum",e,t);if(n!==e&&!n.type){n.type="nominal"}return n}}function Qte(e,t){if(Z9(e)){var n=Jte(e,t);if(n){return n}else if(W9(e)){return{condition:e.condition}}}else{if(G9(e)){var n=Jte(e.condition,t);if(n){return __assign(__assign({},e),{condition:n})}else{var r=e.condition,i=Ice(e,["condition"]);return i}}return e}return undefined}function Zte(e,t){var n={};for(var r in e){if(xi(e,r)){var i=e[r];if(Rr(i)){n[r]=i.map((function(e){return Qte(e,t)})).filter((function(e){return e}))}else{var a=Qte(i,t);if(a!==undefined){n[r]=a}}}}return n}var Kte=function(){function e(){this.name="RuleForRangedLine"}e.prototype.hasMatchingType=function(e){if(G7(e)){var t=e.encoding,n=e.mark;if(n==="line"||U8(n)&&n.type==="line"){for(var r=0,i=z2;r<i.length;r++){var a=i[r];var o=P2(a);var u=t[o];if(t[a]){if(V9(u)&&!U3(u.bin)||X9(u)){return true}}}}}return false};e.prototype.run=function(e,t,n){var r=e.encoding,i=e.mark;G6(l6(!!r.x2,!!r.y2));console.log(i);return n(__assign(__assign({},e),{mark:Pr(i)?__assign(__assign({},i),{type:"rule"}):"rule"}),t)};return e}();var ene=function(e){R(t,e);function t(){var t=e.apply(this,arguments)||this;t.nonFacetUnitNormalizers=[hee,bee,Oee,new Gte,new Kte];return t}t.prototype.map=function(t,n){if(G7(t)){var r=V7(t.encoding,O1);var i=V7(t.encoding,N1);var a=V7(t.encoding,T1);if(r||i||a){return this.mapFacetedUnit(t,n)}}return e.prototype.map.call(this,t,n)};t.prototype.mapUnit=function(e,t){var n=t.parentEncoding,r=t.parentProjection;var i=Vte(e.encoding,t.repeater);var a=__assign(__assign({},e),i?{encoding:i}:{});if(n||r){return this.mapUnitWithParentEncodingOrProjection(a,t)}var o=this.mapLayerOrUnit.bind(this);for(var u=0,s=this.nonFacetUnitNormalizers;u<s.length;u++){var l=s[u];if(l.hasMatchingType(a,t.config)){return l.run(a,t,o)}}return a};t.prototype.mapRepeat=function(e,t){if(Nte(e)){return this.mapLayerRepeat(e,t)}else{return this.mapNonLayerRepeat(e,t)}};t.prototype.mapLayerRepeat=function(e,t){var n=this;var r=e.repeat,i=e.spec,a=Ice(e,["repeat","spec"]);var o=r.row,u=r.column,s=r.layer;var l=t.repeater,f=l===void 0?{}:l,c=t.repeaterPrefix,d=c===void 0?"":c;if(o||u){return this.mapRepeat(__assign(__assign({},e),{repeat:__assign(__assign({},o?{row:o}:{}),u?{column:u}:{}),spec:{repeat:{layer:s},spec:i}}),t)}else{return __assign(__assign({},a),{layer:s.map((function(e){var r=__assign(__assign({},f),{layer:e});var a=(i.name||"")+d+"child__layer_"+d1(e);var o=n.mapLayerOrUnit(i,__assign(__assign({},t),{repeater:r,repeaterPrefix:a}));o.name=a;return o}))})}};t.prototype.mapNonLayerRepeat=function(e,t){var n;var r=e.repeat,i=e.spec,a=e.data,o=Ice(e,["repeat","spec","data"]);if(!Rr(r)&&e.columns){e=$0(e,["columns"]);G6(j5("repeat"))}var u=[];var s=t.repeater,l=s===void 0?{}:s,f=t.repeaterPrefix,c=f===void 0?"":f;var d=!Rr(r)&&r.row||[l?l.row:null];var h=!Rr(r)&&r.column||[l?l.column:null];var v=Rr(r)&&r||[l?l.repeat:null];for(var p=0,g=v;p<g.length;p++){var m=g[p];for(var y=0,_=d;y<_.length;y++){var b=_[y];for(var x=0,w=h;x<w.length;x++){var k=w[x];var A={repeat:m,row:b,column:k,layer:l.layer};var E=(i.name||"")+c+"child__"+(Rr(r)?""+d1(m):(r.row?"row_"+d1(b):"")+(r.column?"column_"+d1(k):""));var D=this.map(i,__assign(__assign({},t),{repeater:A,repeaterPrefix:E}));D.name=E;u.push($0(D,["data"]))}}}var S=Rr(r)?e.columns:r.column?r.column.length:1;return __assign(__assign({data:(n=i.data)!==null&&n!==void 0?n:a,align:"all"},o),{columns:S,concat:u})};t.prototype.mapFacet=function(t,n){var r=t.facet;if(T9(r)&&t.columns){t=$0(t,["columns"]);G6(j5("facet"))}return e.prototype.mapFacet.call(this,t,n)};t.prototype.mapUnitWithParentEncodingOrProjection=function(e,t){var n=e.encoding,r=e.projection;var i=t.parentEncoding,a=t.parentProjection,o=t.config;var u=nne({parentProjection:a,projection:r});var s=tne({parentEncoding:i,encoding:Vte(n,t.repeater)});return this.mapUnit(__assign(__assign(__assign({},e),u?{projection:u}:{}),s?{encoding:s}:{}),{config:o})};t.prototype.mapFacetedUnit=function(e,t){var n=e.encoding,r=n.row,i=n.column,a=n.facet,o=Ice(n,["row","column","facet"]);var u=e.mark,s=e.width,l=e.projection,f=e.height,c=e.view,d=e.params,h=e.encoding,v=Ice(e,["mark","width","projection","height","view","params","encoding"]);var p=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),g=p.facetMapping,m=p.layout;var y=Vte(o,t.repeater);return this.mapFacet(__assign(__assign(__assign({},v),m),{facet:g,spec:__assign(__assign(__assign(__assign(__assign(__assign({},s?{width:s}:{}),f?{height:f}:{}),c?{view:c}:{}),l?{projection:l}:{}),{mark:u,encoding:y}),d?{params:d}:{})}),t)};t.prototype.getFacetMappingAndLayout=function(e,t){var n;var r=e.row,i=e.column,a=e.facet;if(r||i){if(a){G6(o6(__spreadArray(__spreadArray([],r?[O1]:[]),i?[N1]:[])))}var o={};var u={};for(var s=0,l=[O1,N1];s<l.length;s++){var f=l[s];var c=e[f];if(c){var d=c.align,h=c.center,v=c.spacing,p=c.columns,g=Ice(c,["align","center","spacing","columns"]);o[f]=g;for(var m=0,y=["align","center","spacing"];m<y.length;m++){var _=y[m];if(c[_]!==undefined){(n=u[_])!==null&&n!==void 0?n:u[_]={};u[_][f]=c[_]}}}}return{facetMapping:o,layout:u}}else{var b=a.align,h=a.center,v=a.spacing,p=a.columns,o=Ice(a,["align","center","spacing","columns"]);return{facetMapping:$te(o,t.repeater),layout:__assign(__assign(__assign(__assign({},b?{align:b}:{}),h?{center:h}:{}),v?{spacing:v}:{}),p?{columns:p}:{})}}};t.prototype.mapLayer=function(t,n){var r=n.parentEncoding,i=n.parentProjection,a=Ice(n,["parentEncoding","parentProjection"]);var o=t.encoding,u=t.projection,s=Ice(t,["encoding","projection"]);var l=__assign(__assign({},a),{parentEncoding:tne({parentEncoding:r,encoding:o,layer:true}),parentProjection:nne({parentProjection:i,projection:u})});return e.prototype.mapLayer.call(this,s,l)};return t}(Tte);function tne(e){var t=e.parentEncoding,n=e.encoding,r=n===void 0?{}:n,i=e.layer;var a={};if(t){var o=new Set(__spreadArray(__spreadArray([],s1(t)),s1(r)));for(var u=0,s=o;u<s.length;u++){var l=s[u];var f=r[l];var c=t[l];if(Z9(f)){var d=__assign(__assign({},c),f);a[l]=d}else if(G9(f)){a[l]=__assign(__assign({},f),{condition:__assign(__assign({},c),f.condition)})}else if(f||f===null){a[l]=f}else if(i||e7(c)||X3(c)||Z9(c)||Rr(c)){a[l]=c}}}else{a=r}return!a||u1(a)?undefined:a}function nne(e){var t=e.parentProjection,n=e.projection;if(t&&n){G6($5({parentProjection:t,projection:n}))}return n!==null&&n!==void 0?n:t}function rne(e){return"filter"in e}function ine(e){return(e===null||e===void 0?void 0:e["stop"])!==undefined}function ane(e){return"lookup"in e}function one(e){return"data"in e}function une(e){return"param"in e}function sne(e){return"pivot"in e}function lne(e){return"density"in e}function fne(e){return"quantile"in e}function cne(e){return"regression"in e}function dne(e){return"loess"in e}function hne(e){return"sample"in e}function vne(e){return"window"in e}function pne(e){return"joinaggregate"in e}function gne(e){return"flatten"in e}function mne(e){return"calculate"in e}function yne(e){return"bin"in e}function _ne(e){return"impute"in e}function bne(e){return"timeUnit"in e}function xne(e){return"aggregate"in e}function wne(e){return"stack"in e}function kne(e){return"fold"in e}function Ane(e){return e.map((function(e){if(rne(e)){return{filter:q0(e.filter,N4)}}return e}))}var Ene=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.map=function(t,n){var r,i;(r=n.emptySelections)!==null&&r!==void 0?r:n.emptySelections={};(i=n.selectionPredicates)!==null&&i!==void 0?i:n.selectionPredicates={};t=Dne(t,n);return e.prototype.map.call(this,t,n)};t.prototype.mapLayerOrUnit=function(t,n){t=Dne(t,n);if(t.encoding){var r={};for(var i=0,a=f1(t.encoding);i<a.length;i++){var o=a[i],u=o[0],s=o[1];r[u]=Sne(s,n)}t=__assign(__assign({},t),{encoding:r})}return e.prototype.mapLayerOrUnit.call(this,t,n)};t.prototype.mapUnit=function(e,t){var n=e.selection,r=Ice(e,["selection"]);if(n){return __assign(__assign({},r),{params:f1(n).map((function(e){var n;var r=e[0],i=e[1];var a=i.init,o=i.bind,u=i.empty,s=Ice(i,["init","bind","empty"]);if(s.type==="single"){s.type="point";s.toggle=false}else if(s.type==="multi"){s.type="point"}t.emptySelections[r]=u!=="none";for(var l=0,f=l1((n=t.selectionPredicates[r])!==null&&n!==void 0?n:{});l<f.length;l++){var c=f[l];c.empty=u!=="none"}return{name:r,value:a,select:s,bind:o}}))})}return e};return t}(Tte);function Dne(e,t){var n=e.transform,r=Ice(e,["transform"]);if(n){var i=n.map((function(e){if(rne(e)){return{filter:Mne(e,t)}}else if(yne(e)&&q3(e.bin)){return __assign(__assign({},e),{bin:Cne(e.bin)})}else if(ane(e)){var n=e.from,r=n.selection,i=Ice(n,["selection"]);return r?__assign(__assign({},e),{from:__assign({param:r},i)}):e}return e}));return __assign(__assign({},r),{transform:i})}return e}function Sne(e,t){var n,r;var i=H0(e);if(V9(i)&&q3(i.bin)){i.bin=Cne(i.bin)}if(t7(i)&&((r=(n=i.scale)===null||n===void 0?void 0:n.domain)===null||r===void 0?void 0:r.selection)){var a=i.scale.domain,o=a.selection,u=Ice(a,["selection"]);i.scale.domain=__assign(__assign({},u),o?{param:o}:{})}if(W9(i)){if(Rr(i.condition)){i.condition=i.condition.map((function(e){var n=e.selection,r=e.param,i=e.test,a=Ice(e,["selection","param","test"]);return r?e:__assign(__assign({},a),{test:Mne(e,t)})}))}else{var s=Sne(i.condition,t),l=s.selection,f=s.param,c=s.test,d=Ice(s,["selection","param","test"]);i.condition=f?i.condition:__assign(__assign({},d),{test:Mne(i.condition,t)})}}return i}function Cne(e){var t=e.extent;if(t===null||t===void 0?void 0:t.selection){var n=t.selection,r=Ice(t,["selection"]);return __assign(__assign({},e),{extent:__assign(__assign({},r),{param:n})})}return e}function Mne(e,t){var n=function(e){return q0(e,(function(e){var n,r;var i;var a=(n=t.emptySelections[e])!==null&&n!==void 0?n:true;var o={param:e,empty:a};(r=(i=t.selectionPredicates)[e])!==null&&r!==void 0?r:i[e]=[];t.selectionPredicates[e].push(o);return o}))};return e.selection?n(e.selection):q0(e.test||e.filter,(function(e){return e.selection?n(e.selection):e}))}var Fne=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.map=function(t,n){var r;var i=(r=n.selections)!==null&&r!==void 0?r:[];if(t.params&&!G7(t)){var a=[];for(var o=0,u=t.params;o<u.length;o++){var s=u[o];if(Jee(s)){i.push(s)}else{a.push(s)}}t.params=a}n.selections=i;return e.prototype.map.call(this,t,Rne(t,n))};t.prototype.mapUnit=function(e,t){var n;var r=t.selections;if(!r||!r.length)return e;var i=((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name);var a=[];for(var o=0,u=r;o<u.length;o++){var s=u[o];if(!s.views||!s.views.length){a.push(s)}else{for(var l=0,f=s.views;l<f.length;l++){var c=f[l];if(Ni(c)&&(c===e.name||i.indexOf(c)>=0)||Rr(c)&&c.map((function(e){return i.indexOf(e)})).every((function(e,t,n){return e!==-1&&(t===0||e>n[t-1])}))){a.push(s)}}}}if(a.length)e.params=a;return e};return t}(Tte);var One=function(e){var t=Fne.prototype[e];Fne.prototype[e]=function(e,n){return t.call(this,e,Rne(e,n))}};for(var Nne=0,Tne=["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"];Nne<Tne.length;Nne++){var zne=Tne[Nne];One(zne)}function Rne(e,t){var n;return e.name?__assign(__assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function Pne(e,t){if(t===undefined){t=kte(e.config)}var n=Ine(e,t);var r=e.width,i=e.height;var a=qne(n,{width:r,height:i,autosize:e.autosize},t);return __assign(__assign({},n),a?{autosize:a}:{})}var Lne=new ene;var jne=new Ene;var Bne=new Fne;function Ine(e,t){if(t===void 0){t={}}var n={config:t};return Bne.map(Lne.map(jne.map(e,n),n),n)}function Une(e){return Ni(e)?{type:e}:e!==null&&e!==void 0?e:{}}function qne(e,t,n){var r=t.width,i=t.height;var a=G7(e)||Fte(e);var o={};if(!a){if(r=="container"){G6(w5("width"));r=undefined}if(i=="container"){G6(w5("height"));i=undefined}}else{if(r=="container"&&i=="container"){o.type="fit";o.contains="padding"}else if(r=="container"){o.type="fit-x";o.contains="padding"}else if(i=="container"){o.type="fit-y";o.contains="padding"}}var u=__assign(__assign(__assign({type:"pad"},o),n?Une(n.autosize):{}),Une(e.autosize));if(u.type==="fit"&&!a){G6(x5);u.type="pad"}if(r=="container"&&!(u.type=="fit"||u.type=="fit-x")){G6(k5("width"))}if(i=="container"&&!(u.type=="fit"||u.type=="fit-y")){G6(k5("height"))}if(W0(u,{type:"pad"})){return undefined}return u}function Wne(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Hne(e){return e?"fit-"+o3(e):"fit"}var Gne=["background","padding"];function $ne(e,t){var n={};for(var r=0,i=Gne;r<i.length;r++){var a=i[r];if(e&&e[a]!==undefined){n[a]=a5(e[a])}}if(t){n.params=e.params}return n}var Vne=function(){function e(e,t){if(e===void 0){e={}}if(t===void 0){t={}}this.explicit=e;this.implicit=t}e.prototype.clone=function(){return new e(H0(this.explicit),H0(this.implicit))};e.prototype.combine=function(){return __assign(__assign({},this.explicit),this.implicit)};e.prototype.get=function(e){return k1(this.explicit[e],this.implicit[e])};e.prototype.getWithExplicit=function(e){if(this.explicit[e]!==undefined){return{explicit:true,value:this.explicit[e]}}else if(this.implicit[e]!==undefined){return{explicit:false,value:this.implicit[e]}}return{explicit:false,value:undefined}};e.prototype.setWithExplicit=function(e,t){var n=t.value,r=t.explicit;if(n!==undefined){this.set(e,n,r)}};e.prototype.set=function(e,t,n){delete this[n?"implicit":"explicit"][e];this[n?"explicit":"implicit"][e]=t;return this};e.prototype.copyKeyFromSplit=function(e,t){var n=t.explicit,r=t.implicit;if(n[e]!==undefined){this.set(e,n[e],true)}else if(r[e]!==undefined){this.set(e,r[e],false)}};e.prototype.copyKeyFromObject=function(e,t){if(t[e]!==undefined){this.set(e,t[e],true)}};e.prototype.copyAll=function(e){for(var t=0,n=s1(e.combine());t<n.length;t++){var r=n[t];var i=e.getWithExplicit(r);this.setWithExplicit(r,i)}};return e}();function Yne(e){return{explicit:true,value:e}}function Xne(e){return{explicit:false,value:e}}function Jne(e){return function(t,n,r,i){var a=e(t.value,n.value);if(a>0){return t}else if(a<0){return n}return Qne(t,n,r,i)}}function Qne(e,t,n,r){if(e.explicit&&t.explicit){G6(x6(n,r,e.value,t.value))}return e}function Zne(e,t,n,r,i){if(i===void 0){i=Qne}if(e===undefined||e.value===undefined){return t}if(e.explicit&&!t.explicit){return e}else if(t.explicit&&!e.explicit){return t}else if(W0(e.value,t.value)){return e}else{return i(e,t,n,r)}}var Kne=function(e){R(t,e);function t(t,n,r){if(t===void 0){t={}}if(n===void 0){n={}}if(r===void 0){r=false}var i=e.call(this,t,n)||this;i.explicit=t;i.implicit=n;i.parseNothing=r;return i}t.prototype.clone=function(){var t=e.prototype.clone.call(this);t.parseNothing=this.parseNothing;return t};return t}(Vne);function ere(e){return"url"in e}function tre(e){return"values"in e}function nre(e){return"name"in e&&!ere(e)&&!tre(e)&&!rre(e)}function rre(e){return e&&(ire(e)||are(e)||ore(e))}function ire(e){return"sequence"in e}function are(e){return"sphere"in e}function ore(e){return"graticule"in e}var ure;(function(e){e[e["Raw"]=0]="Raw";e[e["Main"]=1]="Main";e[e["Row"]=2]="Row";e[e["Column"]=3]="Column";e[e["Lookup"]=4]="Lookup"})(ure||(ure={}));function sre(e,t,n){if(t===void 0){t=true}if(n===void 0){n=kr}if(Rr(e)){var r=e.map((function(e){return sre(e,t,n)}));return t?"["+r.join(", ")+"]":r}else if(V6(e)){if(t){return n(n4(e))}else{return n(i4(e))}}return t?n(V0(e)):e}function lre(e,t){var n;for(var r=0,i=l1((n=e.component.selection)!==null&&n!==void 0?n:{});r<i.length;r++){var a=i[r];var o=a.name;var u=""+o+Tie+", "+(a.resolve==="global"?"true":"{unit: "+jie(e)+"}");for(var s=0,l=Pie;s<l.length;s++){var f=l[s];if(!f.defined(a))continue;if(f.signals)t=f.signals(e,a,t);if(f.modifyExpr)u=f.modifyExpr(e,a,u)}t.push({name:o+zie,on:[{events:{signal:a.name+Tie},update:"modify("+Ui(a.name+Nie)+", "+u+")"}]})}return gre(t)}function fre(e,t){if(e.component.selection&&s1(e.component.selection).length){var n=Ui(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:kY("mousemove","scope"),update:"isTuple(facet) ? facet : group("+n+").datum"}]})}return gre(t)}function cre(e,t){var n;var r=false;var i=function(n){var i=n.name;var a=Ui(i+Nie);var o=t.filter((function(e){return e.name===i}));if(o.length===0){var u=n.resolve==="global"?"union":n.resolve;var s=n.type==="point"?", true, true)":")";t.push({name:n.name,update:Rie+"("+a+", "+Ui(u)+s})}r=true;for(var l=0,f=Pie;l<f.length;l++){var c=f[l];if(c.defined(n)&&c.topLevelSignals){t=c.topLevelSignals(e,n,t)}}};for(var a=0,o=l1((n=e.component.selection)!==null&&n!==void 0?n:{});a<o.length;a++){var u=o[a];i(u)}if(r){var s=t.filter((function(e){return e.name==="unit"}));if(s.length===0){t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}}return gre(t)}function dre(e,t){var n;var r=__spreadArray([],t);var i=function(t){var n={name:t.name+Nie};if(t.init){var i=t.project.items.map((function(e){var t=e.signals,n=Ice(e,["signals"]);return n}));n.values=t.init.map((function(t){return{unit:jie(e,{escape:false}),fields:i,values:sre(t,false)}}))}var a=r.filter((function(e){return e.name===t.name+Nie}));if(!a.length){r.push(n)}};for(var a=0,o=l1((n=e.component.selection)!==null&&n!==void 0?n:{});a<o.length;a++){var u=o[a];i(u)}return r}function hre(e,t){var n;for(var r=0,i=l1((n=e.component.selection)!==null&&n!==void 0?n:{});r<i.length;r++){var a=i[r];for(var o=0,u=Pie;o<u.length;o++){var s=u[o];if(s.defined(a)&&s.marks){t=s.marks(e,a,t)}}}return t}function vre(e,t){for(var n=0,r=e.children;n<r.length;n++){var i=r[n];if(zse(i)){t=hre(i,t)}}return t}function pre(e,t,n,r){var i=Vie(e,t.param,t);return{signal:r8(n.get("type"))&&Rr(r)&&r[0]>r[1]?"isValid("+i+") && reverse("+i+")":i}}function gre(e){return e.map((function(e){if(e.on&&!e.on.length)delete e.on;return e}))}var mre=function(){function e(e,t){this.debugName=t;this._children=[];this._parent=null;if(e){this.parent=e}}e.prototype.clone=function(){throw new Error("Cannot clone node")};Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e;if(e){e.addChild(this)}},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:false,configurable:true});e.prototype.numChildren=function(){return this._children.length};e.prototype.addChild=function(e,t){if(this._children.includes(e)){G6(q5);return}if(t!==undefined){this._children.splice(t,0,e)}else{this._children.push(e)}};e.prototype.removeChild=function(e){var t=this._children.indexOf(e);this._children.splice(t,1);return t};e.prototype.remove=function(){var e=this._parent.removeChild(this);for(var t=0,n=this._children;t<n.length;t++){var r=n[t];r._parent=this._parent;this._parent.addChild(r,e++)}};e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this);this.parent=t;e.parent=this};e.prototype.swapWithParent=function(){var e=this._parent;var t=e.parent;for(var n=0,r=this._children;n<r.length;n++){var i=r[n];i.parent=e}this._children=[];e.removeChild(this);e.parent.removeChild(e);this.parent=t;e.parent=this};return e}();var yre=function(e){R(t,e);function t(t,n,r,i){var a=e.call(this,t,n)||this;a.type=r;a.refCounts=i;a._source=a._name=n;if(a.refCounts&&!(a._name in a.refCounts)){a.refCounts[a._name]=0}return a}t.prototype.clone=function(){var e=new this.constructor;e.debugName="clone_"+this.debugName;e._source=this._source;e._name="clone_"+this._name;e.type=this.type;e.refCounts=this.refCounts;e.refCounts[e._name]=0;return e};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return new Set};t.prototype.hash=function(){if(this._hash===undefined){this._hash="Output "+E1()}return this._hash};t.prototype.getSource=function(){this.refCounts[this._name]++;return this._source};t.prototype.isRequired=function(){return!!this.refCounts[this._name]};t.prototype.setSource=function(e){this._source=e};return t}(mre);var _re=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.formula=n;return r}t.prototype.clone=function(){return new t(null,H0(this.formula))};t.makeFromEncoding=function(e,n){var r=n.reduceFieldDef((function(e,t){var n=t.field,r=t.timeUnit;if(r){var i=u7(t,{forAs:true});e[Y0({as:i,field:n,timeUnit:r})]={as:i,field:n,timeUnit:r}}return e}),{});if(u1(r)){return null}return new t(e,r)};t.makeFromTransform=function(e,n){var r;var i=__assign({},n),a=i.timeUnit,o=Ice(i,["timeUnit"]);var u=g4(a);var s=__assign(__assign({},o),{timeUnit:u});return new t(e,(r={},r[Y0(s)]=s,r))};t.prototype.merge=function(e){this.formula=__assign({},this.formula);for(var t in e.formula){if(!this.formula[t]){this.formula[t]=e.formula[t]}}for(var n=0,r=e.children;n<r.length;n++){var i=r[n];e.removeChild(i);i.parent=this}e.remove()};t.prototype.removeFormulas=function(e){var t={};for(var n=0,r=f1(this.formula);n<r.length;n++){var i=r[n],a=i[0],o=i[1];if(!e.has(o.as)){t[a]=o}}this.formula=t};t.prototype.producedFields=function(){return new Set(l1(this.formula).map((function(e){return e.as})))};t.prototype.dependentFields=function(){return new Set(l1(this.formula).map((function(e){return e.field})))};t.prototype.hash=function(){return"TimeUnit "+Y0(this.formula)};t.prototype.assemble=function(){var e=[];for(var t=0,n=l1(this.formula);t<n.length;t++){var r=n[t];var i=r.field,a=r.as,o=r.timeUnit;var u=g4(o),s=u.unit,l=u.utc,f=Ice(u,["unit","utc"]);e.push(__assign(__assign(__assign(__assign({field:_1(i),type:"timeunit"},s?{units:c4(s)}:{}),l?{timezone:"utc"}:{}),f),{as:[a,a+"_end"]}))}return e};return t}(mre);var bre="_tuple_fields";var xre=function(){function e(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this.items=e;this.hasChannel={};this.hasField={}}return e}();var wre={defined:function(){return true},parse:function(e,t,n){var r;var i=t.name;var a=(r=t.project)!==null&&r!==void 0?r:t.project=new xre;var o={};var u={};var s=new Set;var l=function(e,t){var n;var r=t==="visual"?e.channel:e.field;var a=d1(i+"_"+r);for(var o=1;s.has(a);o++){a=d1(i+"_"+r+"_"+o)}s.add(a);return n={},n[t]=a,n};var f=t.type;var c=e.config.selection[f];var d=n.value!==undefined?oi(n.value):null;var h=Pr(n.select)?n.select:{},v=h.fields,p=h.encodings;if(!v&&!p&&d){for(var g=0,m=d;g<m.length;g++){var y=m[g];if(!Pr(y)){continue}for(var _=0,b=s1(y);_<b.length;_++){var x=b[_];if(N2(x)){(p||(p=[])).push(x)}else{if(f==="interval"){G6(P5);p=c.encodings}else{(v||(v=[])).push(x)}}}}}if(!v&&!p){p=c.encodings;v=c.fields}for(var w=0,k=p!==null&&p!==void 0?p:[];w<k.length;w++){var A=k[w];var E=e.fieldDef(A);if(E){var D=E.field;if(E.aggregate){G6(S5(A,E.aggregate));continue}else if(!D){G6(D5(A));continue}if(E.timeUnit){D=e.vgField(A);var S={timeUnit:E.timeUnit,as:D,field:E.field};u[Y0(S)]=S}if(!o[D]){var C="E";if(f==="interval"){var M=e.getScaleComponent(A).get("type");if(r8(M)){C="R"}}else if(E.bin){C="R-RE"}var F={field:D,channel:A,type:C};F.signals=__assign(__assign({},l(F,"data")),l(F,"visual"));a.items.push(o[D]=F);a.hasField[D]=a.hasChannel[A]=o[D]}}else{G6(D5(A))}}for(var O=0,N=v!==null&&v!==void 0?v:[];O<N.length;O++){var T=N[O];if(a.hasField[T])continue;var F={type:"E",field:T};F.signals=__assign({},l(F,"data"));a.items.push(F);a.hasField[T]=F}if(d){t.init=d.map((function(e){return a.items.map((function(t){return Pr(e)?e[t.channel]!==undefined?e[t.channel]:e[t.field]:e}))}))}if(!u1(u)){a.timeUnit=new _re(null,u)}},signals:function(e,t,n){var r=t.name+bre;var i=n.filter((function(e){return e.name===r}));return i.length>0?n:n.concat({name:r,value:t.project.items.map((function(e){var t=e.signals,n=e.hasLegend,r=Ice(e,["signals","hasLegend"]);r.field=_1(r.field);return r}))})}};var kre={defined:function(e){return e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales"},parse:function(e,t){var n=t.scales=[];for(var r=0,i=t.project.items;r<i.length;r++){var a=i[r];var o=a.channel;if(!x3(o)){continue}var u=e.getScaleComponent(o);var s=u?u.get("type"):undefined;if(!u||!r8(s)){G6(O5);continue}u.set("selectionExtent",{param:t.name,field:a.field},true);n.push(a)}},topLevelSignals:function(e,t,n){var r=t.scales.filter((function(e){return n.filter((function(t){return t.name===e.signals.data})).length===0}));if(!e.parent||Ere(e)||r.length===0){return n}var i=n.filter((function(e){return e.name===t.name}))[0];var a=i.update;if(a.indexOf(Rie)>=0){i.update="{"+r.map((function(e){return Ui(_1(e.field))+": "+e.signals.data})).join(", ")+"}"}else{for(var o=0,u=r;o<u.length;o++){var s=u[o];var l=Ui(_1(s.field))+": "+s.signals.data;if(!a.includes(l)){a=a.substring(0,a.length-1)+", "+l+"}"}}i.update=a}return n.concat(r.map((function(e){return{name:e.signals.data}})))},signals:function(e,t,n){if(e.parent&&!Ere(e)){var r=function(e){var t=n.filter((function(t){return t.name===e.signals.data}))[0];t.push="outer";delete t.value;delete t.update};for(var i=0,a=t.scales;i<a.length;i++){var o=a[i];r(o)}}return n}};function Are(e,t){var n=Ui(e.scaleName(t));return"domain("+n+")"}function Ere(e){var t;return e.parent&&Lse(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:Ere(e.parent.parent))}var Dre="_brush";var Sre="_scale_trigger";var Cre={defined:function(e){return e.type==="interval"},signals:function(e,t,n){var r=t.name;var i=r+bre;var a=kre.defined(t);var o=t.init?t.init[0]:null;var u=[];var s=[];if(t.translate&&!a){var l="!event.item || event.item.mark.name !== "+Ui(r+Dre);Fre(t,(function(e,t){var n;var r;var i=oi((n=(r=t.between[0]).filter)!==null&&n!==void 0?n:r.filter=[]);if(!i.includes(l)){i.push(l)}return e}))}t.project.items.forEach((function(r,i){var a=r.channel;if(a!==z1&&a!==R1){G6("Interval selections only support x and y encoding channels.");return}var l=o?o[i]:null;var f=Mre(e,t,r,l);var c=r.signals.data;var d=r.signals.visual;var h=Ui(e.scaleName(a));var v=e.getScaleComponent(a).get("type");var p=r8(v)?"+":"";n.push.apply(n,f);u.push(c);s.push({scaleName:e.scaleName(a),expr:"(!isArray("+c+") || "+("("+p+"invert("+h+", "+d+")[0] === "+p+c+"[0] && ")+(p+"invert("+h+", "+d+")[1] === "+p+c+"[1]))")})}));if(!a){n.push({name:r+Sre,value:{},on:[{events:s.map((function(e){return{scale:e.scaleName}})),update:s.map((function(e){return e.expr})).join(" && ")+" ? "+(r+Sre)+" : {}"}]})}var f="unit: "+jie(e)+", fields: "+i+", values";return n.concat(__assign(__assign({name:r+Tie},o?{init:"{"+f+": "+sre(o)+"}"}:{}),{on:[{events:[{signal:u.join(" || ")}],update:u.join(" && ")+" ? {"+f+": ["+u+"]} : null"}]}))},marks:function(e,t,n){var r=t.name;var i=t.project.hasChannel,a=i.x,o=i.y;var u=a&&a.signals.visual;var s=o&&o.signals.visual;var l="data("+Ui(t.name+Nie)+")";if(kre.defined(t)){return n}var f={x:a!==undefined?{signal:u+"[0]"}:{value:0},y:o!==undefined?{signal:s+"[0]"}:{value:0},x2:a!==undefined?{signal:u+"[1]"}:{field:{group:"width"}},y2:o!==undefined?{signal:s+"[1]"}:{field:{group:"height"}}};if(t.resolve==="global"){for(var c=0,d=s1(f);c<d.length;c++){var h=d[c];f[h]=[__assign({test:l+".length && "+l+"[0].unit === "+jie(e)},f[h]),{value:0}]}}var v=t.mark,p=v.fill,g=v.fillOpacity,m=v.cursor,y=Ice(v,["fill","fillOpacity","cursor"]);var _=s1(y).reduce((function(e,t){e[t]=[{test:[a!==undefined&&u+"[0] !== "+u+"[1]",o!==undefined&&s+"[0] !== "+s+"[1]"].filter((function(e){return e})).join(" && "),value:y[t]},{value:null}];return e}),{});return __spreadArray(__spreadArray([{name:r+Dre+"_bg",type:"rect",clip:true,encode:{enter:{fill:{value:p},fillOpacity:{value:g}},update:f}}],n),[{name:r+Dre,type:"rect",clip:true,encode:{enter:__assign(__assign({},m?{cursor:{value:m}}:{}),{fill:{value:"transparent"}}),update:__assign(__assign({},f),_)}}])}};function Mre(e,t,n,r){var i=n.channel;var a=n.signals.visual;var o=n.signals.data;var u=kre.defined(t);var s=Ui(e.scaleName(i));var l=e.getScaleComponent(i);var f=l?l.get("type"):undefined;var c=function(e){return"scale("+s+", "+e+")"};var d=e.getSizeSignalRef(i===z1?"width":"height").signal;var h=i+"(unit)";var v=Fre(t,(function(e,t){return __spreadArray(__spreadArray([],e),[{events:t.between[0],update:"["+h+", "+h+"]"},{events:t,update:"["+a+"[0], clamp("+h+", 0, "+d+")]"}])}));v.push({events:{signal:t.name+Sre},update:r8(f)?"["+c(o+"[0]")+", "+c(o+"[1]")+"]":"[0, 0]"});return u?[{name:o,on:[]}]:[__assign(__assign({name:a},r?{init:sre(r,true,c)}:{value:[]}),{on:v}),__assign(__assign({name:o},r?{init:sre(r)}:{}),{on:[{events:{signal:a},update:a+"[0] === "+a+"[1] ? null : invert("+s+", "+a+")"}]})]}function Fre(e,t){return e.events.reduce((function(e,n){if(!n.between){G6(n+" is not an ordered event stream for interval selections.");return e}return t(e,n)}),[])}var Ore={defined:function(e){return e.type==="point"},signals:function(e,t,n){var r=t.name;var i=r+bre;var a=t.project;var o="(item().isVoronoi ? datum.datum : datum)";var u=a.items.map((function(t){var n=e.fieldDef(t.channel);return n&&n.bin?"["+o+"["+Ui(e.vgField(t.channel,{}))+"], "+(o+"["+Ui(e.vgField(t.channel,{binSuffix:"end"}))+"]]"):o+"["+Ui(t.field)+"]"})).join(", ");var s="unit: "+jie(e)+", fields: "+i+", values";var l=t.events;return n.concat([{name:r+Tie,on:l?[{events:l,update:"datum && item().mark.marktype !== 'group' ? {"+s+": ["+u+"]} : null",force:true}]:[]}])}};function Nre(e,t,n,r){var i,a;var o=W9(t)&&t.condition;var u=r(t);if(o){var s=oi(o);var l=s.map((function(t){var n=r(t);if(P9(t)){var i=t.param,a=t.empty;var o=$ie(e,{param:i,empty:a});return __assign({test:o},n)}else{var u=Xie(e,t.test);return __assign({test:u},n)}}));return i={},i[n]=__spreadArray(__spreadArray([],l),u!==undefined?[u]:[]),i}else{return u!==undefined?(a={},a[n]=u,a):{}}}function Tre(e,t){if(t===void 0){t="text"}var n=e.encoding[t];return Nre(e,n,t,(function(t){return zre(t,e.config)}))}function zre(e,t,n){if(n===void 0){n="datum"}if(e){if(e7(e)){return u5(e.value)}if(Z9(e)){var r=b7(e),i=r.format,a=r.formatType;return g9({fieldOrDatumDef:e,format:i,formatType:a,expr:n,config:t})}}return undefined}function Rre(e,t){if(t===void 0){t={}}var n=e.encoding,r=e.markDef,i=e.config,a=e.stack;var o=n.tooltip;if(Rr(o)){return{tooltip:Lre({tooltip:o},a,i,t)}}else{var u=t.reactiveGeom?"datum.datum":"datum";return Nre(e,o,"tooltip",(function(e){var o=zre(e,i,u);if(o){return o}if(e===null){return undefined}var s=d5("tooltip",r,i);if(s===true){s={content:"encoding"}}if(Ni(s)){return{value:s}}else if(Pr(s)){if(X3(s)){return s}else if(s.content==="encoding"){return Lre(n,a,i,t)}else{return{signal:u}}}return undefined}))}}function Pre(e,t,n,r){var i=r===void 0?{}:r,a=i.reactiveGeom;var o={};var u=a?"datum.datum":"datum";var s=[];function l(r,i){var a=P2(i);var l=K9(r)?r:__assign(__assign({},r),{type:e[a].type});var f=l.title||_7(l,n);var c=oi(f).join(", ");var d;if(r3(i)){var h=i==="x"?"x2":"y2";var v=w7(e[h]);if(U3(l.bin)&&v){var p=u7(l,{expr:u});var g=u7(v,{expr:u});var m=b7(l),y=m.format,_=m.formatType;d=E9(p,g,y,_,n);o[h]=true}else if(t&&t.fieldChannel===i&&t.offset==="normalize"){var b=b7(l),x=b.format,_=b.formatType;d=g9({fieldOrDatumDef:l,format:x,formatType:_,expr:u,config:n,normalizeStack:true}).signal}}d!==null&&d!==void 0?d:d=zre(l,n,u).signal;s.push({channel:i,key:c,value:d})}eee(e,(function(e,t){if(V9(e)){l(e,t)}else if(H9(e)){l(e.condition,t)}}));var f={};for(var c=0,d=s;c<d.length;c++){var h=d[c],v=h.channel,p=h.key,g=h.value;if(!o[v]&&!f[p]){f[p]=g}}return f}function Lre(e,t,n,r){var i=r===void 0?{}:r,a=i.reactiveGeom;var o=Pre(e,t,n,{reactiveGeom:a});var u=f1(o).map((function(e){var t=e[0],n=e[1];return'"'+t+'": '+n}));return u.length>0?{signal:"{"+u.join(", ")+"}"}:undefined}function jre(e){var t=e.markDef,n=e.config;var r=d5("aria",t,n);if(r===false){return{}}return __assign(__assign(__assign({},r?{aria:r}:{}),Bre(e)),Ire(e))}function Bre(e){var t=e.mark,n=e.markDef,r=e.config;if(r.aria===false){return{}}var i=d5("ariaRoleDescription",n,r);if(i!=null){return{ariaRoleDescription:{value:i}}}return t in n5?{}:{ariaRoleDescription:{value:t}}}function Ire(e){var t=e.encoding,n=e.markDef,r=e.config,i=e.stack;var a=t.description;if(a){return Nre(e,a,"description",(function(t){return zre(t,e.config)}))}var o=d5("description",n,r);if(o!=null){return{description:u5(o)}}if(r.aria===false){return{}}var u=Pre(t,i,r);if(u1(u)){return undefined}return{description:{signal:f1(u).map((function(e,t){var n=e[0],r=e[1];return'"'+(t>0?"; ":"")+n+': " + ('+r+")"})).join(" + ")}}}function Ure(e,t,n){if(n===void 0){n={}}var r=t.markDef,i=t.encoding,a=t.config;var o=n.vgChannel;var u=n.defaultRef,s=n.defaultValue;if(u===undefined){s!==null&&s!==void 0?s:s=d5(e,r,a,{vgChannel:o,ignoreVgConfig:true});if(s!==undefined){u=u5(s)}}var l=i[e];return Nre(t,l,o!==null&&o!==void 0?o:e,(function(n){return c9({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:u})}))}function qre(e,t){var n,r,i,a;if(t===void 0){t={filled:undefined}}var o=e.markDef,u=e.encoding,s=e.config;var l=o.type;var f=(n=t.filled)!==null&&n!==void 0?n:d5("filled",o,s);var c=J0(["bar","point","circle","square","geoshape"],l)?"transparent":undefined;var d=(i=(r=d5(f===true?"color":undefined,o,s,{vgChannel:"fill"}))!==null&&r!==void 0?r:s.mark[f===true&&"color"])!==null&&i!==void 0?i:c;var h=(a=d5(f===false?"color":undefined,o,s,{vgChannel:"stroke"}))!==null&&a!==void 0?a:s.mark[f===false&&"color"];var v=f?"fill":"stroke";var p=__assign(__assign({},d?{fill:u5(d)}:{}),h?{stroke:u5(h)}:{});if(o.color&&(f?o.fill:o.stroke)){G6(Z5("property",{fill:"fill"in o,stroke:"stroke"in o}))}return __assign(__assign(__assign(__assign({},p),Ure("color",e,{vgChannel:v,defaultValue:f?d:h})),Ure("fill",e,{defaultValue:u.fill?d:undefined})),Ure("stroke",e,{defaultValue:u.stroke?h:undefined}))}function Wre(e){var t=e.encoding,n=e.mark;var r=t.order;if(!j8(n)&&e7(r)){return Nre(e,r,"zindex",(function(e){return u5(e.value)}))}return{}}function Hre(e,t){var n=I2(e);var r=t[n];if(r){return r}return undefined}function Gre(e,t,n){var r;var i=n.defaultPos,a=n.vgChannel;var o=t.encoding,u=t.markDef,s=t.config,l=t.stack;var f=o[e];var c=o[j2(e)];var d=t.scaleName(e);var h=t.getScaleComponent(e);var v=Hre(e,u);var p=Vre({model:t,defaultPos:i,channel:e,scaleName:d,scale:h});var g=!f&&r3(e)&&(o.latitude||o.longitude)?{field:t.getName(e)}:$re({channel:e,channelDef:f,channel2Def:c,markDef:u,config:s,scaleName:d,scale:h,stack:l,offset:v,defaultRef:p});return g?(r={},r[a||e]=g,r):undefined}function $re(e){var t=e.channel,n=e.channelDef,r=e.scaleName,i=e.stack,a=e.offset,o=e.markDef;if(Z9(n)&&i&&t===i.fieldChannel){if(V9(n)){var u=n.bandPosition;if(u===undefined&&o.type==="text"&&(t==="radius"||t==="theta")){u=.5}if(u!==undefined){return f9({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",bandPosition:u,offset:a})}}return l9(n,r,{suffix:"end"},{offset:a})}return i9(e)}function Vre(e){var t=e.model,n=e.defaultPos,r=e.channel,i=e.scaleName,a=e.scale;var o=t.markDef,u=t.config;return function(){var e=P2(r);var s=L2(r);var l=d5(r,o,u,{vgChannel:s});if(l!==undefined){return d9(r,l)}switch(n){case"zeroOrMin":case"zeroOrMax":if(i){var f=a.get("type");if(J0([I4.LOG,I4.TIME,I4.UTC],f));else{if(a.domainDefinitelyIncludesZero()){return{scale:i,value:0}}}}if(n==="zeroOrMin"){return e==="y"?{field:{group:"height"}}:{value:0}}else{switch(e){case"radius":return{signal:"min("+t.width.signal+","+t.height.signal+")/2"};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}}break;case"mid":{var c=t[B2(r)];return __assign(__assign({},c),{mult:.5})}}return undefined}}var Yre={left:"x",center:"xc",right:"x2"};var Xre={top:"y",middle:"yc",bottom:"y2"};function Jre(e,t,n,r){if(r===void 0){r="middle"}if(e==="radius"||e==="theta"){return L2(e)}var i=e==="x"?"align":"baseline";var a=d5(i,t,n);var o;if(X3(a)){G6(s6(i));o=undefined}else{o=a}if(e==="x"){return Yre[o||(r==="top"?"left":"center")]}else{return Xre[o||r]}}function Qre(e,t,n){var r=n.defaultPos,i=n.defaultPos2,a=n.range;if(a){return Zre(e,t,{defaultPos:r,defaultPos2:i})}return Gre(e,t,{defaultPos:r})}function Zre(e,t,n){var r=n.defaultPos,i=n.defaultPos2;var a=t.markDef,o=t.config;var u=j2(e);var s=B2(e);var l=Kre(t,i,u);var f=l[s]?Jre(e,a,o):L2(e);return __assign(__assign({},Gre(e,t,{defaultPos:r,vgChannel:f})),l)}function Kre(e,t,n){var r,i,a,o,u;var s=e.encoding,l=e.mark,f=e.markDef,c=e.stack,d=e.config;var h=P2(n);var v=B2(n);var p=L2(n);var g=s[h];var m=e.scaleName(h);var y=e.getScaleComponent(h);var _=n in s||n in f?Hre(n,e.markDef):Hre(h,e.markDef);if(!g&&(n==="x2"||n==="y2")&&(s.latitude||s.longitude)){var b=B2(n);var x=e.markDef[b];if(x!=null){return r={},r[b]={value:x},r}else{return i={},i[p]={field:e.getName(n)},i}}var w=eie({channel:n,channelDef:g,channel2Def:s[n],markDef:f,config:d,scaleName:m,scale:y,stack:c,offset:_,defaultRef:undefined});if(w!==undefined){return a={},a[p]=w,a}return tie(n,f)||tie(n,(o={},o[n]=v5(n,f,d.style),o[v]=v5(v,f,d.style),o))||tie(n,d[l])||tie(n,d.mark)||(u={},u[p]=Vre({model:e,defaultPos:t,channel:n,scaleName:m,scale:y})(),u)}function eie(e){var t=e.channel,n=e.channelDef,r=e.channel2Def,i=e.markDef,a=e.config,o=e.scaleName,u=e.scale,s=e.stack,l=e.offset,f=e.defaultRef;if(Z9(n)&&s&&t.charAt(0)===s.fieldChannel.charAt(0)){return l9(n,o,{suffix:"start"},{offset:l})}return i9({channel:t,channelDef:r,scaleName:o,scale:u,stack:s,markDef:i,config:a,offset:l,defaultRef:f})}function tie(e,t){var n,r,i;var a=B2(e);var o=L2(e);if(t[o]!==undefined){return n={},n[o]=d9(e,t[o]),n}else if(t[e]!==undefined){return r={},r[o]=d9(e,t[e]),r}else if(t[a]){var u=t[a];if(Q8(u)){G6(K5(a))}else{return i={},i[a]=d9(e,u),i}}return undefined}function nie(e,t,n){var r,i,a,o;var u=e.config,s=e.encoding,l=e.markDef;var f=j2(t);var c=B2(t);var d=s[t];var h=s[f];var v=e.getScaleComponent(t);var p=v?v.get("type"):undefined;var g=e.scaleName(t);var m=l.orient;var y=(i=(r=s[c])!==null&&r!==void 0?r:s.size)!==null&&i!==void 0?i:d5("size",l,u,{vgChannel:c});var _=n==="bar"&&(t==="x"?m==="vertical":m==="horizontal");if(V9(d)&&(I3(d.bin)||U3(d.bin)||d.timeUnit&&!h)&&!(y&&!Q8(y))&&!n8(p)){var b=U9({channel:t,fieldDef:d,markDef:l,config:u,scaleType:p});var x=(a=e.component.axes[t])===null||a===void 0?void 0:a[0];var w=(o=x===null||x===void 0?void 0:x.get("translate"))!==null&&o!==void 0?o:.5;return oie({fieldDef:d,fieldDef2:h,channel:t,markDef:l,scaleName:g,bandSize:b,axisTranslate:w,spacing:r3(t)?d5("binSpacing",l,u):undefined,reverse:v.get("reverse"),config:u})}else if((Z9(d)&&n8(p)||_)&&!h){return iie(d,t,e)}else{return Zre(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}}function rie(e,t,n,r,i){if(Q8(i)){if(n){var a=n.get("type");if(a==="band"){return{scale:t,band:i.band}}else if(i.band!==1){G6(d6(a));i=undefined}}else{return{mult:i.band,field:{group:e}}}}else if(X3(i)){return i}else if(i){return{value:i}}if(n){var o=n.get("range");if(J3(o)&&Fi(o.step)){return{value:o.step-2}}}var u=lte(r.view,e);return{value:u-2}}function iie(e,t,n){var r,i,a;var o=n.markDef,u=n.encoding,s=n.config,l=n.stack;var f=o.orient;var c=n.scaleName(t);var d=n.getScaleComponent(t);var h=B2(t);var v=j2(t);var p=f==="horizontal"&&t==="y"||f==="vertical"&&t==="x";var g;if(u.size||o.size){if(p){g=Ure("size",n,{vgChannel:h,defaultRef:u5(o.size)})}else{G6(g6(o.type))}}var m=U9({channel:t,fieldDef:e,markDef:o,config:s,scaleType:d===null||d===void 0?void 0:d.get("type"),useVlSizeChannel:p});g=g||(r={},r[h]=rie(h,c,d,s,m),r);var y=(d===null||d===void 0?void 0:d.get("type"))!=="band"||!("band"in g[h])?"middle":"top";var _=Jre(t,o,s,y);var b=_==="xc"||_==="yc";var x=Hre(t,o);var w=i9({channel:t,channelDef:e,markDef:o,config:s,scaleName:c,scale:d,stack:l,offset:x,defaultRef:Vre({model:n,defaultPos:"mid",channel:t,scaleName:c,scale:d}),bandPosition:b?.5:X3(m)?{signal:"(1-"+m+")/2"}:Q8(m)?(1-m.band)/2:0});if(h){return __assign((i={},i[_]=w,i),g)}else{var k=L2(v);var A=g[h];var E=x?__assign(__assign({},A),{offset:x}):A;return a={},a[_]=w,a[k]=Rr(w)?[w[0],__assign(__assign({},w[1]),{offset:E})]:__assign(__assign({},w),{offset:E}),a}}function aie(e,t,n,r,i){if(h2(e)){return 0}var a=e==="x"||e==="y2"?-t/2:t/2;if(X3(n)||X3(i)||X3(r)){var o=l5(n);var u=l5(i);var s=l5(r);var l=s?s+" + ":"";var f=o?"("+o+" ? -1 : 1) * ":"";var c=u?"("+u+" + "+a+")":a;return{signal:l+f+c}}else{i=i||0;return r+(n?-i-a:+i+a)}}function oie(e){var t,n,r;var i=e.fieldDef,a=e.fieldDef2,o=e.channel,u=e.bandSize,s=e.scaleName,l=e.markDef,f=e.spacing,c=f===void 0?0:f,d=e.axisTranslate,h=e.reverse,v=e.config;var p=j2(o);var g=L2(o);var m=L2(p);var y=Hre(o,l);var _=X3(u)?{signal:"(1-"+u.signal+")/2"}:Q8(u)?(1-u.band)/2:.5;if(I3(i.bin)||i.timeUnit){return t={},t[m]=uie({channel:o,fieldDef:i,scaleName:s,markDef:l,bandPosition:_,offset:aie(p,c,h,d,y),config:v}),t[g]=uie({channel:o,fieldDef:i,scaleName:s,markDef:l,bandPosition:X3(_)?{signal:"1-"+_.signal}:1-_,offset:aie(o,c,h,d,y),config:v}),t}else if(U3(i.bin)){var b=l9(i,s,{},{offset:aie(p,c,h,d,y)});if(V9(a)){return n={},n[m]=b,n[g]=l9(a,s,{},{offset:aie(o,c,h,d,y)}),n}else if(q3(i.bin)&&i.bin.step){return r={},r[m]=b,r[g]={signal:'scale("'+s+'", '+u7(i,{expr:"datum"})+" + "+i.bin.step+")",offset:aie(o,c,h,d,y)},r}}G6(j6(p));return undefined}function uie(e){var t=e.channel,n=e.fieldDef,r=e.scaleName,i=e.markDef,a=e.bandPosition,o=e.offset,u=e.config;var s=f9({scaleName:r,fieldOrDatumDef:n,bandPosition:a,offset:o});return a9({fieldDef:n,channel:t,markDef:i,ref:s,config:u})}var sie=new Set(["aria","width","height"]);function lie(e,t){var n=t.color==="include"?qre(e):{},r=n.fill,i=r===void 0?undefined:r,a=n.stroke,o=a===void 0?undefined:a;return __assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign({},cie(e.markDef,t)),fie(e,"fill",i)),fie(e,"stroke",o)),Ure("opacity",e)),Ure("fillOpacity",e)),Ure("strokeOpacity",e)),Ure("strokeWidth",e)),Ure("strokeDash",e)),Wre(e)),Rre(e)),Tre(e,"href")),jre(e))}function fie(e,t,n){var r,i;var a=e.config,o=e.mark,u=e.markDef;var s=d5("invalid",u,a);if(s==="hide"&&n&&!j8(o)){var l=die(e,{invalid:true,channels:b3});if(l){return r={},r[t]=__spreadArray([{test:l,value:null}],oi(n)),r}}return n?(i={},i[t]=n,i):{}}function cie(e,t){return t5.reduce((function(n,r){if(!sie.has(r)&&e[r]!==undefined&&t[r]!=="ignore"){n[r]=u5(e[r])}return n}),{})}function die(e,t){var n=t.invalid,r=n===void 0?false:n,i=t.channels;var a=i.reduce((function(t,n){var r=e.getScaleComponent(n);if(r){var i=r.get("type");var a=e.vgField(n,{expr:"datum"});if(a&&r8(i)){t[a]=true}}return t}),{});var o=s1(a);if(o.length>0){var u=r?"||":"&&";return o.map((function(e){return u9(e,r)})).join(" "+u+" ")}return undefined}function hie(e){var t=e.config,n=e.markDef;var r=d5("invalid",n,t);if(r){var i=vie(e,{channels:n3});if(i){return{defined:{signal:i}}}}return{}}function vie(e,t){var n=t.invalid,r=n===void 0?false:n,i=t.channels;var a=i.reduce((function(t,n){var r=e.getScaleComponent(n);if(r){var i=r.get("type");var a=e.vgField(n,{expr:"datum"});if(a&&r8(i)){t[a]=true}}return t}),{});var o=s1(a);if(o.length>0){var u=r?"||":"&&";return o.map((function(e){return u9(e,r)})).join(" "+u+" ")}return undefined}function pie(e,t){var n;if(t!==undefined){return n={},n[e]=u5(t),n}return undefined}var gie="voronoi";var mie={defined:function(e){return e.type==="point"&&e.nearest},parse:function(e,t){if(t.events){for(var n=0,r=t.events;n<r.length;n++){var i=r[n];i.markname=e.getName(gie)}}},marks:function(e,t,n){var r=t.project.hasChannel,i=r.x,a=r.y;var o=e.mark;if(j8(o)){G6(C5(o));return n}var u={name:e.getName(gie),type:"path",interactive:true,from:{data:e.getName("marks")},encode:{update:__assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:true}},Rre(e,{reactiveGeom:true}))},transform:[{type:"voronoi",x:{expr:i||!a?"datum.datum.x || 0":"0"},y:{expr:a||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};var s=0;var l=false;n.forEach((function(t,n){var r;var i=(r=t.name)!==null&&r!==void 0?r:"";if(i===e.component.mark[0].name){s=n}else if(i.indexOf(gie)>=0){l=true}}));if(!l){n.splice(s+1,0,u)}return n}};var yie={defined:function(e){return e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Yee(e.bind)},parse:function(e,t,n){return Iie(t,n)},topLevelSignals:function(e,t,n){var r=t.name;var i=t.project;var a=t.bind;var o=t.init&&t.init[0];var u=mie.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";i.items.forEach((function(e,i){var s,l;var f=d1(r+"_"+e.field);var c=n.filter((function(e){return e.name===f}));if(!c.length){n.unshift(__assign(__assign({name:f},o?{init:sre(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? "+u+"["+Ui(e.field)+"] : null"}]:[],bind:(l=(s=a[e.field])!==null&&s!==void 0?s:a[e.channel])!==null&&l!==void 0?l:a}))}}));return n},signals:function(e,t,n){var r=t.name;var i=t.project;var a=n.filter((function(e){return e.name===r+Tie}))[0];var o=r+bre;var u=i.items.map((function(e){return d1(r+"_"+e.field)}));var s=u.map((function(e){return e+" !== null"})).join(" && ");if(u.length){a.update=s+" ? {fields: "+o+", values: ["+u.join(", ")+"]} : null"}delete a.value;delete a.on;return n}};var _ie="_toggle";var bie={defined:function(e){return e.type==="point"&&!!e.toggle},signals:function(e,t,n){return n.concat({name:t.name+_ie,value:false,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t){var n=t.name+Tie;var r=t.name+_ie;return r+" ? null : "+n+", "+(t.resolve==="global"?r+" ? null : true, ":r+" ? null : {unit: "+jie(e)+"}, ")+(r+" ? "+n+" : null")}};var xie={defined:function(e){return e.clear!==undefined&&e.clear!==false},parse:function(e,t){if(t.clear){t.clear=Ni(t.clear)?kY(t.clear,"view"):t.clear}},topLevelSignals:function(e,t,n){if(yie.defined(t)){var r=function(e){var r=n.findIndex((function(n){return n.name===d1(t.name+"_"+e.field)}));if(r!==-1){n[r].on.push({events:t.clear,update:"null"})}};for(var i=0,a=t.project.items;i<a.length;i++){var o=a[i];r(o)}}return n},signals:function(e,t,n){function r(e,r){if(e!==-1&&n[e].on){n[e].on.push({events:t.clear,update:r})}}if(t.type==="interval"){var i=function(e){var t=n.findIndex((function(t){return t.name===e.signals.visual}));r(t,"[0, 0]");if(t===-1){var i=n.findIndex((function(t){return t.name===e.signals.data}));r(i,"null")}};for(var a=0,o=t.project.items;a<o.length;a++){var u=o[a];i(u)}}else{var s=n.findIndex((function(e){return e.name===t.name+Tie}));r(s,"null");if(bie.defined(t)){s=n.findIndex((function(e){return e.name===t.name+_ie}));r(s,"false")}}return n}};var wie={defined:function(e){var t=e.resolve==="global"&&e.bind&&Yee(e.bind);var n=e.project.items.length===1&&e.project.items[0].field!==$ee;if(t&&!n){G6(N5)}return t&&n},parse:function(e,t,n){var r;var i=H0(n);i.select=Ni(i.select)?{type:i.select,toggle:t.toggle}:__assign(__assign({},i.select),{toggle:t.toggle});Iie(t,i);if(Pr(n.select)&&(n.select.on||n.select.clear)){var a='event.item && indexof(event.item.mark.role, "legend") < 0';for(var o=0,u=t.events;o<u.length;o++){var s=u[o];s.filter=oi((r=s.filter)!==null&&r!==void 0?r:[]);if(!s.filter.includes(a)){s.filter.push(a)}}}var l=Xee(t.bind)?t.bind.legend:"click";var f=Ni(l)?kY(l,"view"):oi(l);t.bind={legend:{merge:f}}},topLevelSignals:function(e,t,n){var r=t.name;var i=Xee(t.bind)&&t.bind.legend;var a=function(e){return function(t){var n=H0(t);n.markname=e;return n}};var o=function(e){if(!e.hasLegend)return"continue";var o=d1(e.field)+"_legend";var u=r+"_"+o;var s=n.filter((function(e){return e.name===u}));if(s.length===0){var l=i.merge.map(a(o+"_symbols")).concat(i.merge.map(a(o+"_labels"))).concat(i.merge.map(a(o+"_entries")));n.unshift(__assign(__assign({name:u},!t.init?{value:null}:{}),{on:[{events:l,update:"datum.value || item().items[0].items[0].datum.value",force:true},{events:i.merge,update:"!event.item || !datum ? null : "+u,force:true}]}))}};for(var u=0,s=t.project.items;u<s.length;u++){var l=s[u];o(l)}return n},signals:function(e,t,n){var r=t.name;var i=t.project;var a=n.find((function(e){return e.name===r+Tie}));var o=r+bre;var u=i.items.filter((function(e){return e.hasLegend})).map((function(e){return d1(r+"_"+d1(e.field)+"_legend")}));var s=u.map((function(e){return e+" !== null"})).join(" && ");var l=s+" ? {fields: "+o+", values: ["+u.join(", ")+"]} : null";if(t.events&&u.length>0){a.on.push({events:u.map((function(e){return{signal:e}})),update:l})}else if(u.length>0){a.update=l;delete a.value;delete a.on}var f=n.find((function(e){return e.name===r+_ie}));var c=Xee(t.bind)&&t.bind.legend;if(f){if(!t.events)f.on[0].events=c;else f.on.push(__assign(__assign({},f.on[0]),{events:c}))}return n}};function kie(e,t,n){var r,i,a,o;var u=(r=e.fieldDef(t))===null||r===void 0?void 0:r.field;for(var s=0,l=l1((i=e.component.selection)!==null&&i!==void 0?i:{});s<l.length;s++){var f=l[s];var c=(a=f.project.hasField[u])!==null&&a!==void 0?a:f.project.hasChannel[t];if(c&&wie.defined(f)){var d=(o=n.get("selections"))!==null&&o!==void 0?o:[];d.push(f.name);n.set("selections",d,false);c.hasLegend=true}}}var Aie="_translate_anchor";var Eie="_translate_delta";var Die={defined:function(e){return e.type==="interval"&&e.translate},signals:function(e,t,n){var r=t.name;var i=kre.defined(t);var a=r+Aie;var o=t.project.hasChannel,u=o.x,s=o.y;var l=kY(t.translate,"scope");if(!i){l=l.map((function(e){return e.between[0].markname=r+Dre,e}))}n.push({name:a,value:{},on:[{events:l.map((function(e){return e.between[0]})),update:"{x: x(unit), y: y(unit)"+(u!==undefined?", extent_x: "+(i?Are(e,z1):"slice("+u.signals.visual+")"):"")+(s!==undefined?", extent_y: "+(i?Are(e,R1):"slice("+s.signals.visual+")"):"")+"}"}]},{name:r+Eie,value:{},on:[{events:l,update:"{x: "+a+".x - x(unit), y: "+a+".y - y(unit)}"}]});if(u!==undefined){Sie(e,t,u,"width",n)}if(s!==undefined){Sie(e,t,s,"height",n)}return n}};function Sie(e,t,n,r,i){var a,o;var u=t.name;var s=u+Aie;var l=u+Eie;var f=n.channel;var c=kre.defined(t);var d=i.filter((function(e){return e.name===n.signals[c?"data":"visual"]}))[0];var h=e.getSizeSignalRef(r).signal;var v=e.getScaleComponent(f);var p=v.get("type");var g=v.get("reverse");var m=!c?"":f===z1?g?"":"-":g?"-":"";var y=s+".extent_"+f;var _=""+m+l+"."+f+" / "+(c?""+h:"span("+y+")");var b=!c?"panLinear":p==="log"?"panLog":p==="symlog"?"panSymlog":p==="pow"?"panPow":"panLinear";var x=!c?"":p==="pow"?", "+((a=v.get("exponent"))!==null&&a!==void 0?a:1):p==="symlog"?", "+((o=v.get("constant"))!==null&&o!==void 0?o:1):"";var w=b+"("+y+", "+_+x+")";d.on.push({events:{signal:l},update:c?w:"clampRange("+w+", 0, "+h+")"})}var Cie="_zoom_anchor";var Mie="_zoom_delta";var Fie={defined:function(e){return e.type==="interval"&&e.zoom},signals:function(e,t,n){var r=t.name;var i=kre.defined(t);var a=r+Mie;var o=t.project.hasChannel,u=o.x,s=o.y;var l=Ui(e.scaleName(z1));var f=Ui(e.scaleName(R1));var c=kY(t.zoom,"scope");if(!i){c=c.map((function(e){return e.markname=r+Dre,e}))}n.push({name:r+Cie,on:[{events:c,update:!i?"{x: x(unit), y: y(unit)}":"{"+[l?"x: invert("+l+", x(unit))":"",f?"y: invert("+f+", y(unit))":""].filter((function(e){return!!e})).join(", ")+"}"}]},{name:a,on:[{events:c,force:true,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]});if(u!==undefined){Oie(e,t,u,"width",n)}if(s!==undefined){Oie(e,t,s,"height",n)}return n}};function Oie(e,t,n,r,i){var a,o;var u=t.name;var s=n.channel;var l=kre.defined(t);var f=i.filter((function(e){return e.name===n.signals[l?"data":"visual"]}))[0];var c=e.getSizeSignalRef(r).signal;var d=e.getScaleComponent(s);var h=d.get("type");var v=l?Are(e,s):f.name;var p=u+Mie;var g=""+u+Cie+"."+s;var m=!l?"zoomLinear":h==="log"?"zoomLog":h==="symlog"?"zoomSymlog":h==="pow"?"zoomPow":"zoomLinear";var y=!l?"":h==="pow"?", "+((a=d.get("exponent"))!==null&&a!==void 0?a:1):h==="symlog"?", "+((o=d.get("constant"))!==null&&o!==void 0?o:1):"";var _=m+"("+v+", "+g+", "+p+y+")";f.on.push({events:{signal:p},update:l?_:"clampRange("+_+", 0, "+c+")"})}var Nie="_store";var Tie="_tuple";var zie="_modify";var Rie="vlSelectionResolve";var Pie=[Ore,Cre,wre,bie,yie,kre,wie,xie,Die,Fie,mie];function Lie(e){var t=e.parent;while(t){if(Rse(t))break;t=t.parent}return t}function jie(e,t){var n=t===void 0?{escape:true}:t,r=n.escape;var i=r?Ui(e.name):e.name;var a=Lie(e);if(a){var o=a.facet;for(var u=0,s=x2;u<s.length;u++){var l=s[u];if(o[l]){i+=" + '__facet_"+l+"_' + (facet["+Ui(a.vgField(l))+"])"}}}return i}function Bie(e){var t;return l1((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((function(e,t){return e||t.project.items.some((function(e){return e.field===$ee}))}),false)}function Iie(e,t){if(Ni(t.select)||!t.select.on)delete e.events;if(Ni(t.select)||!t.select.clear)delete e.clear;if(Ni(t.select)||!t.select.toggle)delete e.toggle}function Uie(e){var t=[];if(e.type==="Identifier"){return[e.name]}if(e.type==="Literal"){return[e.value]}if(e.type==="MemberExpression"){t.push.apply(t,Uie(e.object));t.push.apply(t,Uie(e.property))}return t}function qie(e){if(e.object.type==="MemberExpression"){return qie(e.object)}return e.object.name==="datum"}function Wie(e){var t=GW(e);var n=new Set;t.visit((function(e){if(e.type==="MemberExpression"&&qie(e)){n.add(Uie(e).slice(1).join("."))}}));return n}var Hie=function(e){R(t,e);function t(t,n,r){var i=e.call(this,t)||this;i.model=n;i.filter=r;i.expr=Xie(i.model,i.filter,i);i._dependentFields=Wie(i.expr);return i}t.prototype.clone=function(){return new t(null,this.model,H0(this.filter))};t.prototype.dependentFields=function(){return this._dependentFields};t.prototype.producedFields=function(){return new Set};t.prototype.assemble=function(){return{type:"filter",expr:this.expr}};t.prototype.hash=function(){return"Filter "+this.expr};return t}(mre);function Gie(e,t){var n;var r={};var i=e.config.selection;if(!t||!t.length)return r;for(var a=0,o=t;a<o.length;a++){var u=o[a];var s=d1(u.name);var l=u.select;var f=Ni(l)?l:l.type;var c=Pr(l)?H0(l):{type:f};var d=i[f],h=d.fields,v=d.encodings,p=Ice(d,["fields","encodings"]);for(var g in p){if(g==="mark"){c[g]=__assign(__assign({},p[g]),c[g])}if(c[g]===undefined||c[g]===true){c[g]=(n=p[g])!==null&&n!==void 0?n:c[g]}}var m=r[s]=__assign(__assign({},c),{name:s,type:f,init:u.value,bind:u.bind,events:Ni(c.on)?kY(c.on,"scope"):oi(H0(c.on))});for(var y=0,_=Pie;y<_.length;y++){var b=_[y];if(b.defined(m)&&b.parse){b.parse(e,m,u)}}}return r}function $ie(e,t,n,r){if(r===void 0){r="datum"}var i=Ni(t)?t:t.param;var a=d1(i);var o=Ui(a+Nie);var u;try{u=e.getSelectionComponent(a,i)}catch(Afe){return"!!"+a}if(u.project.timeUnit){var s=n!==null&&n!==void 0?n:e.component.data.raw;var l=u.project.timeUnit.clone();if(s.parent){l.insertAsParentOf(s)}else{s.parent=l}}var f="vlSelectionTest("+o+", "+r+(u.resolve==="global"?")":", "+Ui(u.resolve)+")");var c="length(data("+o+"))";return t.empty===false?c+" && "+f:"!"+c+" || "+f}function Vie(e,t,n){var r=d1(t);var i=n["encoding"];var a=n["field"];var o;try{o=e.getSelectionComponent(r,t)}catch(Afe){return r}if(!i&&!a){a=o.project.items[0].field;if(o.project.items.length>1){G6('A "field" or "encoding" must be specified when using a selection as a scale domain. '+('Using "field": '+Ui(a)+"."))}}else if(i&&!a){var u=o.project.items.filter((function(e){return e.channel===i}));if(!u.length||u.length>1){a=o.project.items[0].field;G6((!u.length?"No ":"Multiple ")+("matching "+Ui(i)+" encoding found for selection "+Ui(n.param)+". ")+('Using "field": '+Ui(a)+"."))}else{a=u[0].field}}return o.name+"["+Ui(_1(a))+"]"}function Yie(e,t){var n;for(var r=0,i=f1((n=e.component.selection)!==null&&n!==void 0?n:{});r<i.length;r++){var a=i[r],o=a[0],u=a[1];var s=e.getName("lookup_"+o);e.component.data.outputNodes[s]=u.materialized=new yre(new Hie(t,e,{param:o}),s,ure.Lookup,e.component.data.outputNodeRefCounts)}}function Xie(e,t,n){return h1(t,(function(t){if(Ni(t)){return t}else if(y4(t)){return $ie(e,t,n)}else{return F4(t)}}))}function Jie(e,t){if(!e){return undefined}if(Rr(e)&&!Y3(e)){return e.map((function(e){return _7(e,t)})).join(", ")}return e}function Qie(e,t,n,r){var i,a,o;var u,s;(i=e.encode)!==null&&i!==void 0?i:e.encode={};(a=(u=e.encode)[t])!==null&&a!==void 0?a:u[t]={};(o=(s=e.encode[t]).update)!==null&&o!==void 0?o:s.update={};e.encode[t].update[n]=r}function Zie(e,t,n,r){var i,a;if(r===void 0){r={header:false}}var o=e.combine(),u=o.disable,s=o.orient,l=o.scale,f=o.labelExpr,c=o.title,d=o.zindex,h=Ice(o,["disable","orient","scale","labelExpr","title","zindex"]);if(u){return undefined}for(var v in h){var p=B7[v];var g=h[v];if(p&&p!==t&&p!=="both"){delete h[v]}else if(L7(g)){var m=g.condition,y=Ice(g,["condition"]);var _=oi(m);var b=P7[v];if(b){var x=b.vgProp,w=b.part;var k=__spreadArray(__spreadArray([],_.map((function(e){var t=e.test,n=Ice(e,["test"]);return __assign({test:Xie(null,t)},n)}))),[y]);Qie(h,w,x,k);delete h[v]}else if(b===null){var A={signal:_.map((function(e){var t=e.test,n=Ice(e,["test"]);return Xie(null,t)+" ? "+s5(n)+" : "})).join("")+s5(y)};h[v]=A}}else if(X3(g)){var b=P7[v];if(b){var x=b.vgProp,w=b.part;Qie(h,w,x,g);delete h[v]}}if(J0(["labelAlign","labelBaseline"],v)&&h[v]===null){delete h[v]}}if(t==="grid"){if(!h.grid){return undefined}if(h.encode){var E=h.encode.grid;h.encode=__assign({},E?{grid:E}:{});if(u1(h.encode)){delete h.encode}}return __assign(__assign({scale:l,orient:s},h),{domain:false,labels:false,aria:false,maxExtent:0,minExtent:0,ticks:false,zindex:k1(d,0)})}else{if(!r.header&&e.mainExtracted){return undefined}if(f!==undefined){var D=f;if(((a=(i=h.encode)===null||i===void 0?void 0:i.labels)===null||a===void 0?void 0:a.update)&&X3(h.encode.labels.update.text)){D=b1(f,"datum.label",h.encode.labels.update.text.signal)}Qie(h,"labels","text",{signal:D})}if(h.labelAlign===null){delete h.labelAlign}if(h.encode){for(var S=0,C=j7;S<C.length;S++){var w=C[S];if(!e.hasAxisPart(w)){delete h.encode[w]}}if(u1(h.encode)){delete h.encode}}var M=Jie(c,n);return __assign(__assign(__assign(__assign({scale:l,orient:s,grid:false},M?{title:M}:{}),h),n.aria===false?{aria:false}:{}),{zindex:k1(d,0)})}}function Kie(e){var t=e.component.axes;var n=[];for(var r=0,i=n3;r<i.length;r++){var a=i[r];if(t[a]){for(var o=0,u=t[a];o<u.length;o++){var s=u[o];if(!s.get("disable")&&!s.get("gridScale")){var l=a==="x"?"height":"width";var f=e.getSizeSignalRef(l).signal;if(l!==f){n.push({name:l,update:f})}}}}}return n}function eae(e,t){var n=e.x,r=n===void 0?[]:n,i=e.y,a=i===void 0?[]:i;return __spreadArray(__spreadArray(__spreadArray(__spreadArray([],r.map((function(e){return Zie(e,"grid",t)}))),a.map((function(e){return Zie(e,"grid",t)}))),r.map((function(e){return Zie(e,"main",t)}))),a.map((function(e){return Zie(e,"main",t)}))).filter((function(e){return e}))}function tae(e,t,n,r){return Object.assign.apply(null,__spreadArray([{}],e.map((function(e){if(e==="axisOrient"){var i=n==="x"?"bottom":"left";var a=t[n==="x"?"axisBottom":"axisLeft"]||{};var o=t[n==="x"?"axisTop":"axisRight"]||{};var u=new Set(__spreadArray(__spreadArray([],s1(a)),s1(o)));var s={};for(var l=0,f=u.values();l<f.length;l++){var c=f[l];s[c]={signal:r["signal"]+' === "'+i+'" ? '+l5(a[c])+" : "+l5(o[c])}}return s}return t[e]}))))}function nae(e,t,n,r){var i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:X4(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[];var a=e==="x"?"axisX":"axisY";var o=X3(n)?"axisOrient":"axis"+p1(n);var u=__spreadArray(__spreadArray([],i),i.map((function(e){return a+e.substr(4)})));var s=["axis",o,a];return{vlOnlyAxisConfig:tae(u,r,e,n),vgAxisConfig:tae(s,r,e,n),axisConfigStyle:rae(__spreadArray(__spreadArray([],s),u),r)}}function rae(e,t){var n;var r=[{}];for(var i=0,a=e;i<a.length;i++){var o=a[i];var u=(n=t[o])===null||n===void 0?void 0:n.style;if(u){u=oi(u);for(var s=0,l=u;s<l.length;s++){var f=l[s];r.push(t.style[f])}}}return Object.assign.apply(null,r)}function iae(e,t,n,r){var i;if(r===void 0){r={}}var a=p5(e,n,t);if(a!==undefined){return{configFrom:"style",configValue:a}}for(var o=0,u=["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"];o<u.length;o++){var s=u[o];if(((i=r[s])===null||i===void 0?void 0:i[e])!==undefined){return{configFrom:s,configValue:r[s][e]}}}return{}}var aae={scale:function(e){var t=e.model,n=e.channel;return t.scaleName(n)},format:function(e){var t=e.fieldOrDatumDef,n=e.config,r=e.axis;var i=r.format,a=r.formatType;return _9(t,t.type,i,a,n,true)},formatType:function(e){var t=e.axis,n=e.fieldOrDatumDef,r=e.scaleType;var i=t.formatType;return b9(i,n,r)},grid:function(e){var t;var n=e.fieldOrDatumDef,r=e.axis,i=e.scaleType;return(t=r.grid)!==null&&t!==void 0?t:oae(i,n)},gridScale:function(e){var t=e.model,n=e.channel;return uae(t,n)},labelAlign:function(e){var t=e.axis,n=e.labelAngle,r=e.orient,i=e.channel;return t.labelAlign||cae(n,r,i)},labelAngle:function(e){var t=e.labelAngle;return t},labelBaseline:function(e){var t=e.axis,n=e.labelAngle,r=e.orient,i=e.channel;return t.labelBaseline||fae(n,r,i)},labelFlush:function(e){var t;var n=e.axis,r=e.fieldOrDatumDef,i=e.channel;return(t=n.labelFlush)!==null&&t!==void 0?t:dae(r.type,i)},labelOverlap:function(e){var t;var n=e.axis,r=e.fieldOrDatumDef,i=e.scaleType;return(t=n.labelOverlap)!==null&&t!==void 0?t:hae(r.type,i,V9(r)&&!!r.timeUnit,V9(r)?r.sort:undefined)},orient:function(e){var t=e.orient;return t},tickCount:function(e){var t;var n=e.channel,r=e.model,i=e.axis,a=e.fieldOrDatumDef,o=e.scaleType;var u=n==="x"?"width":n==="y"?"height":undefined;var s=u?r.getSizeSignalRef(u):undefined;return(t=i.tickCount)!==null&&t!==void 0?t:pae({fieldOrDatumDef:a,scaleType:o,size:s,values:i.values})},title:function(e){var t=e.axis,n=e.model,r=e.channel;if(t.title!==undefined){return t.title}var i=gae(n,r);if(i!==undefined){return i}var a=n.typedFieldDef(r);var o=r==="x"?"x2":"y2";var u=n.fieldDef(o);return m5(a?[j9(a)]:[],V9(u)?[j9(u)]:[])},values:function(e){var t=e.axis,n=e.fieldOrDatumDef;return mae(t,n)},zindex:function(e){var t;var n=e.axis,r=e.fieldOrDatumDef,i=e.mark;return(t=n.zindex)!==null&&t!==void 0?t:yae(i,r)}};function oae(e,t){return!n8(e)&&V9(t)&&!I3(t===null||t===void 0?void 0:t.bin)&&!U3(t===null||t===void 0?void 0:t.bin)}function uae(e,t){var n=t==="x"?"y":"x";if(e.getScaleComponent(n)){return e.scaleName(n)}return undefined}function sae(e,t,n,r,i){var a=t===null||t===void 0?void 0:t.labelAngle;if(a!==undefined){return X3(a)?a:M1(a)}else{var o=iae("labelAngle",r,t===null||t===void 0?void 0:t.style,i).configValue;if(o!==undefined){return M1(o)}else{if(n===z1&&J0([L4,R4],e.type)&&!(V9(e)&&e.timeUnit)){return 270}return undefined}}}function lae(e){return"((("+e.signal+" % 360) + 360) % 360)"}function fae(e,t,n,r){if(e!==undefined){if(n==="x"){if(X3(e)){var i=lae(e);var a=X3(t)?"("+t.signal+' === "top")':t==="top";return{signal:"(45 < "+i+" && "+i+" < 135) || (225 < "+i+" && "+i+' < 315) ? "middle" :'+("("+i+" <= 45 || 315 <= "+i+") === "+a+' ? "bottom" : "top"')}}if(45<e&&e<135||225<e&&e<315){return"middle"}if(X3(t)){var o=e<=45||315<=e?"===":"!==";return{signal:t.signal+" "+o+' "top" ? "bottom" : "top"'}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(X3(e)){var u=lae(e);var s=X3(t)?"("+t.signal+' === "left")':t==="left";var l=r?'"middle"':"null";return{signal:u+" <= 45 || 315 <= "+u+" || (135 <= "+u+" && "+u+" <= 225) ? "+l+" : (45 <= "+u+" && "+u+" <= 135) === "+s+' ? "top" : "bottom"'}}if(e<=45||315<=e||135<=e&&e<=225){return r?"middle":null}if(X3(t)){var o=45<=e&&e<=135?"===":"!==";return{signal:t.signal+" "+o+' "left" ? "top" : "bottom"'}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}}return undefined}function cae(e,t,n){if(e===undefined){return undefined}var r=n==="x";var i=r?0:90;var a=r?"bottom":"left";if(X3(e)){var o=lae(e);var u=X3(t)?"("+t.signal+' === "'+a+'")':t===a;return{signal:"("+(i?"("+o+" + 90)":o)+" % 180 === 0) ? "+(r?null:'"center"')+" :"+("("+i+" < "+o+" && "+o+" < "+(180+i)+") === "+u+' ? "left" : "right"')}}if((e+i)%180===0){return r?null:"center"}if(X3(t)){var s=i<e&&e<180+i?"===":"!==";var u=t.signal+" "+s+' "'+a+'"';return{signal:u+' ? "left" : "right"'}}if((i<e&&e<180+i)===(t===a)){return"left"}return"right"}function dae(e,t){if(t==="x"&&J0(["quantitative","temporal"],e)){return true}return undefined}function hae(e,t,n,r){if(n&&!Pr(r)||e!=="nominal"&&e!=="ordinal"){if(t==="log"||t==="symlog"){return"greedy"}return true}return undefined}function vae(e){return e==="x"?"bottom":"left"}function pae(e){var t;var n=e.fieldOrDatumDef,r=e.scaleType,i=e.size,a=e.values;if(!a&&!n8(r)&&r!=="log"){if(V9(n)){if(I3(n.bin)){return{signal:"ceil("+i.signal+"/10)"}}if(n.timeUnit&&J0(["month","hours","day","quarter"],(t=g4(n.timeUnit))===null||t===void 0?void 0:t.unit)){return undefined}}return{signal:"ceil("+i.signal+"/40)"}}return undefined}function gae(e,t){var n=t==="x"?"x2":"y2";var r=e.fieldDef(t);var i=e.fieldDef(n);var a=r?r.title:undefined;var o=i?i.title:undefined;if(a&&o){return y5(a,o)}else if(a){return a}else if(o){return o}else if(a!==undefined){return a}else if(o!==undefined){return o}return undefined}function mae(e,t){var n=e.values;if(Rr(n)){return z7(t,n)}else if(X3(n)){return n}return undefined}function yae(e,t){if(e==="rect"&&s7(t)){return 1}return 0}var _ae=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;r._dependentFields=Wie(r.transform.calculate);return r}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.parseAllForSortIndex=function(e,n){n.forEachFieldDef((function(n,r){if(!t7(n)){return}if(N9(n.sort)){var i=n.field,a=n.timeUnit;var o=n.sort;var u=o.map((function(e,t){return F4({field:i,timeUnit:a,equal:e})+" ? "+t+" : "})).join("")+o.length;e=new t(e,{calculate:u,as:bae(n,r,{forAs:true})})}}));return e};t.prototype.producedFields=function(){return new Set([this.transform.as])};t.prototype.dependentFields=function(){return this._dependentFields};t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}};t.prototype.hash=function(){return"Calculate "+Y0(this.transform)};return t}(mre);function bae(e,t,n){return u7(e,__assign({prefix:t,suffix:"sort_index"},n!==null&&n!==void 0?n:{}))}function xae(e,t){if(J0(["top","bottom"],t)){return"column"}else if(J0(["left","right"],t)){return"row"}return e==="row"?"row":"column"}function wae(e,t,n,r){var i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return k1((t||{})[e],i[e],n.header[e])}function kae(e,t,n,r){var i={};for(var a=0,o=e;a<o.length;a++){var u=o[a];var s=wae(u,t||{},n,r);if(s!==undefined){i[u]=s}}return i}var Aae=["row","column"];var Eae=["header","footer"];function Dae(e,t){var n=e.component.layoutHeaders[t].title;var r=e.config?e.config:undefined;var i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:undefined;var a=kae(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),o=a.titleAnchor,u=a.titleAngle,s=a.titleOrient;var l=xae(t,s);var f=M1(u);return{name:t+"-title",type:"group",role:l+"-title",title:__assign(__assign(__assign(__assign(__assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),Cae(f,l)),Sae(l,f,o)),Pae(r,i,t,Bee,Lee))}}function Sae(e,t,n){if(n===void 0){n="middle"}switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}var r=cae(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function Cae(e,t){var n=fae(e,t==="row"?"left":"top",t==="row"?"y":"x",true);return n?{baseline:n}:{}}function Mae(e,t){var n=e.component.layoutHeaders[t];var r=[];for(var i=0,a=Eae;i<a.length;i++){var o=a[i];if(n[o]){for(var u=0,s=n[o];u<s.length;u++){var l=s[u];var f=Nae(e,t,o,n,l);if(f!=null){r.push(f)}}}}return r}function Fae(e,t){var n;var r=e.sort;if(O9(r)){return{field:u7(r,{expr:"datum"}),order:(n=r.order)!==null&&n!==void 0?n:"ascending"}}else if(Rr(r)){return{field:bae(e,t,{expr:"datum"}),order:"ascending"}}else{return{field:u7(e,{expr:"datum"}),order:r!==null&&r!==void 0?r:"ascending"}}}function Oae(e,t,n){var r=kae(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),i=r.format,a=r.formatType,o=r.labelAngle,u=r.labelAnchor,s=r.labelOrient,l=r.labelExpr;var f=g9({fieldOrDatumDef:e,format:i,formatType:a,expr:"parent",config:n}).signal;var c=xae(t,s);return __assign(__assign(__assign(__assign(__assign({text:{signal:l?b1(b1(l,"datum.label",f),"datum.value",u7(e,{expr:"parent"})):f}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Cae(o,c)),Sae(c,o,u)),Pae(n,e,t,Iee,jee))}function Nae(e,t,n,r,i){var a;if(i){var o=null;var u=r.facetFieldDef;var s=e.config?e.config:undefined;if(u&&i.labels){var l=kae(["labelOrient"],u.header,s,t).labelOrient;if(t==="row"&&!J0(["top","bottom"],l)||t==="column"&&!J0(["left","right"],l)){o=Oae(u,t,s)}}var f=Rse(e)&&!T9(e.facet);var c=i.axes;var d=(c===null||c===void 0?void 0:c.length)>0;if(o||d){var h=t==="row"?"height":"width";return __assign(__assign(__assign(__assign(__assign({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:Fae(u,t)}:{}),d&&f?{from:{data:e.getName("facet_domain_"+t)}}:{}),o?{title:o}:{}),i.sizeSignal?{encode:{update:(a={},a[h]=i.sizeSignal,a)}}:{}),d?{axes:c}:{})}}return null}var Tae={column:{start:0,end:1},row:{start:1,end:0}};function zae(e,t){return Tae[t][e]}function Rae(e,t){var n={};for(var r=0,i=x2;r<i.length;r++){var a=i[r];var o=e[a];if(o===null||o===void 0?void 0:o.facetFieldDef){var u=kae(["titleAnchor","titleOrient"],o.facetFieldDef.header,t,a),s=u.titleAnchor,l=u.titleOrient;var f=xae(a,l);var c=zae(s,f);if(c!==undefined){n[f]=c}}}return u1(n)?undefined:n}function Pae(e,t,n,r,i){var a={};for(var o=0,u=r;o<u.length;o++){var s=u[o];if(!i[s]){continue}var l=wae(s,t===null||t===void 0?void 0:t.header,e,n);if(l!==undefined){a[i[s]]=l}}return a}function Lae(e){return __spreadArray(__spreadArray(__spreadArray(__spreadArray([],jae(e,"width")),jae(e,"height")),jae(e,"childWidth")),jae(e,"childHeight"))}function jae(e,t){var n=t==="width"?"x":"y";var r=e.component.layoutSize.get(t);if(!r||r==="merged"){return[]}var i=e.getSizeSignalRef(t).signal;if(r==="step"){var a=e.getScaleComponent(n);if(a){var o=a.get("type");var u=a.get("range");if(n8(o)&&J3(u)){var s=e.scaleName(n);if(Rse(e.parent)){var l=e.parent.component.resolve;if(l.scale[n]==="independent"){return[Bae(s,u)]}}return[Bae(s,u),{name:i,update:Iae(s,a,"domain('"+s+"').length")}]}}throw new Error("layout size is step although width/height is not step.")}else if(r=="container"){var f=i.endsWith("width");var c=f?"containerSize()[0]":"containerSize()[1]";var d=ste(e.config.view,f?"width":"height");var h="isFinite("+c+") ? "+c+" : "+d;return[{name:i,init:h,on:[{update:h,events:"window:resize"}]}]}else{return[{name:i,value:r}]}}function Bae(e,t){return{name:e+"_step",value:t.step}}function Iae(e,t,n){var r=t.get("type");var i=t.get("padding");var a=k1(t.get("paddingOuter"),i);var o=t.get("paddingInner");o=r==="band"?o!==undefined?o:i:1;return"bandspace("+n+", "+l5(o)+", "+l5(a)+") * "+e+"_step"}function Uae(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function qae(e,t){return s1(e).reduce((function(n,r){var i=e[r];return __assign(__assign({},n),Nre(t,i,r,(function(e){return u5(e.value)})))}),{})}function Wae(e,t){if(Lse(t)||Rse(t)){return"shared"}else if(Pse(t)){return r3(e)?"independent":"shared"}throw new Error("invalid model type for resolve")}function Hae(e,t){var n=e.scale[t];var r=r3(t)?"axis":"legend";if(n==="independent"){if(e[r][t]==="shared"){G6(k6(t))}return"independent"}return e[r][t]||"shared"}var Gae=__assign(__assign({},Gee),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1});var $ae=s1(Gae);var Vae=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Vne);var Yae={symbols:Xae,gradient:Jae,labels:Qae,entries:Zae};function Xae(e,t){var n,r,i,a,o,u,s,l;var f=t.fieldOrDatumDef,c=t.model,d=t.channel,h=t.legendCmpt,v=t.legendType;if(v!=="symbol"){return undefined}var p=c.markDef,g=c.encoding,m=c.config,y=c.mark;var _=p.filled&&y!=="trail";var b=__assign(__assign({},f5({},c,H8)),qre(c,{filled:_}));var x=(n=h.get("symbolOpacity"))!==null&&n!==void 0?n:m.legend.symbolOpacity;var w=(r=h.get("symbolFillColor"))!==null&&r!==void 0?r:m.legend.symbolFillColor;var k=(i=h.get("symbolStrokeColor"))!==null&&i!==void 0?i:m.legend.symbolStrokeColor;var A=x===undefined?(a=Kae(g.opacity))!==null&&a!==void 0?a:p.opacity:undefined;if(b.fill){if(d==="fill"||_&&d===$1){delete b.fill}else{if(b.fill["field"]){if(w){delete b.fill}else{b.fill=u5((o=m.legend.symbolBaseFillColor)!==null&&o!==void 0?o:"black");b.fillOpacity=u5(A!==null&&A!==void 0?A:1)}}else if(Rr(b.fill)){var E=(l=(s=eoe((u=g.fill)!==null&&u!==void 0?u:g.color))!==null&&s!==void 0?s:p.fill)!==null&&l!==void 0?l:_&&p.color;if(E){b.fill=u5(E)}}}}if(b.stroke){if(d==="stroke"||!_&&d===$1){delete b.stroke}else{if(b.stroke["field"]||k){delete b.stroke}else if(Rr(b.stroke)){var D=k1(eoe(g.stroke||g.color),p.stroke,_?p.color:undefined);if(D){b.stroke={value:D}}}}}if(d!==Z1){var S=V9(f)&&noe(c,h,f);if(S){b.opacity=[__assign({test:S},u5(A!==null&&A!==void 0?A:1)),u5(m.legend.unselectedOpacity)]}else if(A){b.opacity=u5(A)}}b=__assign(__assign({},b),e);return u1(b)?undefined:b}function Jae(e,t){var n;var r=t.model,i=t.legendType,a=t.legendCmpt;if(i!=="gradient"){return undefined}var o=r.config,u=r.markDef,s=r.encoding;var l={};var f=(n=a.get("gradientOpacity"))!==null&&n!==void 0?n:o.legend.gradientOpacity;var c=f===undefined?Kae(s.opacity)||u.opacity:undefined;if(c){l.opacity=u5(c)}l=__assign(__assign({},l),e);return u1(l)?undefined:l}function Qae(e,t){var n=t.fieldOrDatumDef,r=t.model,i=t.channel,a=t.legendCmpt;var o=r.legend(i)||{};var u=r.config;var s=V9(n)?noe(r,a,n):undefined;var l=s?[{test:s,value:1},{value:u.legend.unselectedOpacity}]:undefined;var f=o.format,c=o.formatType;var d=h9(c)?y9({fieldOrDatumDef:n,field:"datum.value",format:f,formatType:c,config:u}):undefined;var h=__assign(__assign(__assign({},l?{opacity:l}:{}),d?{text:d}:{}),e);return u1(h)?undefined:h}function Zae(e,t){var n=t.legendCmpt;var r=n.get("selections");return(r===null||r===void 0?void 0:r.length)?__assign(__assign({},e),{fill:{value:"transparent"}}):e}function Kae(e){return toe(e,(function(e,t){return Math.max(e,t.value)}))}function eoe(e){return toe(e,(function(e,t){return k1(e,t.value)}))}function toe(e,t){if($9(e)){return oi(e.condition).reduce(t,e.value)}else if(e7(e)){return e.value}return undefined}function noe(e,t,n){var r=t.get("selections");if(!(r===null||r===void 0?void 0:r.length))return undefined;var i=Ui(n.field);return r.map((function(e){var t=Ui(d1(e)+Nie);return"(!length(data("+t+")) || ("+e+"["+i+"] && indexof("+e+"["+i+"], datum.value) >= 0))"})).join(" || ")}var roe={direction:function(e){var t=e.direction;return t},format:function(e){var t=e.fieldOrDatumDef,n=e.legend,r=e.config;var i=n.format,a=n.formatType;return _9(t,t.type,i,a,r,false)},formatType:function(e){var t=e.legend,n=e.fieldOrDatumDef,r=e.scaleType;var i=t.formatType;return b9(i,n,r)},gradientLength:function(e){var t,n;var r=e.legend,i=e.legendConfig;return(n=(t=r.gradientLength)!==null&&t!==void 0?t:i.gradientLength)!==null&&n!==void 0?n:foe(e)},labelOverlap:function(e){var t,n;var r=e.legend,i=e.legendConfig,a=e.scaleType;return(n=(t=r.labelOverlap)!==null&&t!==void 0?t:i.labelOverlap)!==null&&n!==void 0?n:doe(a)},symbolType:function(e){var t;var n=e.legend,r=e.markDef,i=e.channel,a=e.encoding;return(t=n.symbolType)!==null&&t!==void 0?t:aoe(r.type,i,a.shape,r.shape)},title:function(e){var t=e.fieldOrDatumDef,n=e.config;return m7(t,n,{allowDisabling:true})},type:function(e){var t=e.legendType,n=e.scaleType,r=e.channel;if(_2(r)&&i8(n)){if(t==="gradient"){return undefined}}else if(t==="symbol"){return undefined}return t},values:function(e){var t=e.fieldOrDatumDef,n=e.legend;return ioe(n,t)}};function ioe(e,t){var n=e.values;if(Rr(n)){return z7(t,n)}else if(X3(n)){return n}return undefined}function aoe(e,t,n,r){var i;if(t!=="shape"){var a=(i=eoe(n))!==null&&i!==void 0?i:r;if(a){return a}}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function ooe(e){var t=e.legend;return k1(t.type,uoe(e))}function uoe(e){var t=e.channel,n=e.timeUnit,r=e.scaleType;if(_2(t)){if(J0(["quarter","month","day"],n)){return"symbol"}if(i8(r)){return"gradient"}}return"symbol"}function soe(e){var t,n;var r=e.legendConfig,i=e.legendType,a=e.orient,o=e.legend;return(n=(t=o.direction)!==null&&t!==void 0?t:r[i?"gradientDirection":"symbolDirection"])!==null&&n!==void 0?n:loe(a,i)}function loe(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case undefined:return undefined;default:return t==="gradient"?"horizontal":undefined}}function foe(e){var t=e.legendConfig,n=e.model,r=e.direction,i=e.orient,a=e.scaleType;var o=t.gradientHorizontalMaxLength,u=t.gradientHorizontalMinLength,s=t.gradientVerticalMaxLength,l=t.gradientVerticalMinLength;if(i8(a)){if(r==="horizontal"){if(i==="top"||i==="bottom"){return coe(n,"width",u,o)}else{return u}}else{return coe(n,"height",l,s)}}return undefined}function coe(e,t,n,r){var i=e.getSizeSignalRef(t).signal;return{signal:"clamp("+i+", "+n+", "+r+")"}}function doe(e){if(J0(["quantile","threshold","log","symlog"],e)){return"greedy"}return undefined}function hoe(e){var t=zse(e)?voe(e):yoe(e);e.component.legends=t;return t}function voe(e){var t=e.encoding;var n={};for(var r=0,i=__spreadArray([$1],Wee);r<i.length;r++){var a=i[r];var o=k7(t[a]);if(!o||!e.getScaleComponent(a)){continue}if(a===X1&&V9(o)&&o.type===j4){continue}n[a]=moe(e,a)}return n}function poe(e,t){var n;var r=e.scaleName(t);if(e.mark==="trail"){if(t==="color"){return{stroke:r}}else if(t==="size"){return{strokeWidth:r}}}if(t==="color"){return e.markDef.filled?{fill:r}:{stroke:r}}return n={},n[t]=r,n}function goe(e,t,n,r){switch(t){case"disable":return n!==undefined;case"values":return!!(n===null||n===void 0?void 0:n.values);case"title":if(t==="title"&&e===(r===null||r===void 0?void 0:r.title)){return true}}return e===(n||{})[t]}function moe(e,t){var n,r,i;var a=e.legend(t);var o=e.markDef,u=e.encoding,s=e.config;var l=s.legend;var f=new Vae({},poe(e,t));kie(e,t,f);var c=a!==undefined?!a:l.disable;f.set("disable",c,a!==undefined);if(c){return f}a=a||{};var d=e.getScaleComponent(t).get("type");var h=k7(u[t]);var v=V9(h)?(n=g4(h.timeUnit))===null||n===void 0?void 0:n.unit:undefined;var p=a.orient||s.legend.orient||"right";var g=ooe({legend:a,channel:t,timeUnit:v,scaleType:d});var m=soe({legend:a,legendType:g,orient:p,legendConfig:l});var y={legend:a,channel:t,model:e,markDef:o,encoding:u,fieldOrDatumDef:h,legendConfig:l,config:s,scaleType:d,orient:p,legendType:g,direction:m};for(var _=0,b=$ae;_<b.length;_++){var x=b[_];if(g==="gradient"&&x.startsWith("symbol")||g==="symbol"&&x.startsWith("gradient")){continue}var w=x in roe?roe[x](y):a[x];if(w!==undefined){var k=goe(w,x,a,e.fieldDef(t));if(k||s.legend[x]===undefined){f.set(x,w,k)}}}var A=(r=a===null||a===void 0?void 0:a.encoding)!==null&&r!==void 0?r:{};var E=f.get("selections");var D={};var S={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:f,legendType:g};for(var C=0,M=["labels","legend","title","symbols","gradient","entries"];C<M.length;C++){var F=M[C];var O=qae((i=A[F])!==null&&i!==void 0?i:{},e);var N=F in Yae?Yae[F](O,S):O;if(N!==undefined&&!u1(N)){D[F]=__assign(__assign(__assign({},(E===null||E===void 0?void 0:E.length)&&V9(h)?{name:d1(h.field)+"_legend_"+F}:{}),(E===null||E===void 0?void 0:E.length)?{interactive:!!E}:{}),{update:N})}}if(!u1(D)){f.set("encode",D,!!(a===null||a===void 0?void 0:a.encoding))}return f}function yoe(e){var t=e.component,n=t.legends,r=t.resolve;for(var i=0,a=e.children;i<a.length;i++){var o=a[i];hoe(o);for(var u=0,s=s1(o.component.legends);u<s.length;u++){var l=s[u];r.legend[l]=Hae(e.component.resolve,l);if(r.legend[l]==="shared"){n[l]=_oe(n[l],o.component.legends[l]);if(!n[l]){r.legend[l]="independent";delete n[l]}}}}for(var f=0,c=s1(n);f<c.length;f++){var l=c[f];for(var d=0,h=e.children;d<h.length;d++){var o=h[d];if(!o.component.legends[l]){continue}if(r.legend[l]==="shared"){delete o.component.legends[l]}}}return n}function _oe(e,t){var n,r,i,a;if(!e){return t.clone()}var o=e.getWithExplicit("orient");var u=t.getWithExplicit("orient");if(o.explicit&&u.explicit&&o.value!==u.value){return undefined}var s=false;var l=function(n){var r=Zne(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",(function(e,t){switch(n){case"symbolType":return boe(e,t);case"title":return _5(e,t);case"type":s=true;return Xne("symbol")}return Qne(e,t,n,"legend")}));e.setWithExplicit(n,r)};for(var f=0,c=$ae;f<c.length;f++){var d=c[f];l(d)}if(s){if((r=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||r===void 0?void 0:r.gradient){v1(e.implicit,["encode","gradient"])}if((a=(i=e.explicit)===null||i===void 0?void 0:i.encode)===null||a===void 0?void 0:a.gradient){v1(e.explicit,["encode","gradient"])}}return e}function boe(e,t){if(t.value==="circle"){return t}return e}function xoe(e,t,n,r){var i,a,o;var u,s;(i=e.encode)!==null&&i!==void 0?i:e.encode={};(a=(u=e.encode)[t])!==null&&a!==void 0?a:u[t]={};(o=(s=e.encode[t]).update)!==null&&o!==void 0?o:s.update={};e.encode[t].update[n]=r}function woe(e){var t=e.component.legends;var n={};for(var r=0,i=s1(t);r<i.length;r++){var a=i[r];var o=e.getScaleComponent(a);var u=V0(o.get("domains"));if(n[u]){for(var s=0,l=n[u];s<l.length;s++){var f=l[s];var c=_oe(f,t[a]);if(!c){n[u].push(t[a])}}}else{n[u]=[t[a].clone()]}}var d=l1(n).flat().map((function(t){return koe(t,e.config)})).filter((function(e){return e!==undefined}));return d}function koe(e,t){var n,r,i;var a=e.combine(),o=a.disable,u=a.labelExpr,s=a.selections,l=Ice(a,["disable","labelExpr","selections"]);if(o){return undefined}if(t.aria===false&&l.aria==undefined){l.aria=false}if((n=l.encode)===null||n===void 0?void 0:n.symbols){var f=l.encode.symbols.update;if(f.fill&&f.fill["value"]!=="transparent"&&!f.stroke&&!l.stroke){f.stroke={value:"transparent"}}for(var c=0,d=Wee;c<d.length;c++){var h=d[c];if(l[h]){delete f[h]}}}if(!l.title){delete l.title}if(u!==undefined){var v=u;if(((i=(r=l.encode)===null||r===void 0?void 0:r.labels)===null||i===void 0?void 0:i.update)&&X3(l.encode.labels.update.text)){v=b1(u,"datum.label",l.encode.labels.update.text.signal)}xoe(l,"labels","text",{signal:v})}return l}function Aoe(e){if(Lse(e)||Pse(e)){return Eoe(e)}else{return Doe(e)}}function Eoe(e){return e.children.reduce((function(e,t){return e.concat(t.assembleProjections())}),Doe(e))}function Doe(e){var t=e.component.projection;if(!t||t.merged){return[]}var n=t.combine();var r=n.name;if(!t.data){return[__assign(__assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}else{var i={signal:"["+t.size.map((function(e){return e.signal})).join(", ")+"]"};var a=t.data.reduce((function(t,n){var r=X3(n)?n.signal:"data('"+e.lookupDataSource(n)+"')";if(!J0(t,r)){t.push(r)}return t}),[]);if(a.length<=0){throw new Error("Projection's fit didn't find any data sources")}return[__assign({name:r,size:i,fit:{signal:a.length>1?"["+a.join(", ")+"]":a[0]}},n)]}}var Soe=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];var Coe=function(e){R(t,e);function t(t,n,r,i){var a=e.call(this,__assign({},n),{name:t})||this;a.specifiedProjection=n;a.size=r;a.data=i;a.merged=false;return a}Object.defineProperty(t.prototype,"isFit",{get:function(){return!!this.data},enumerable:false,configurable:true});return t}(Vne);function Moe(e){e.component.projection=zse(e)?Foe(e):Toe(e)}function Foe(e){var t;if(e.hasProjection){var n=$3(e.specifiedProjection);var r=!(n&&(n.scale!=null||n.translate!=null));var i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:undefined;var a=r?Ooe(e):undefined;var o=new Coe(e.projectionName(true),__assign(__assign({},(t=$3(e.config.projection))!==null&&t!==void 0?t:{}),n!==null&&n!==void 0?n:{}),i,a);if(!o.get("type")){o.set("type","equalEarth",false)}return o}return undefined}function Ooe(e){var t=[];var n=e.encoding;for(var r=0,i=[[W1,q1],[G1,H1]];r<i.length;r++){var a=i[r];if(k7(n[a[0]])||k7(n[a[1]])){t.push({signal:e.getName("geojson_"+t.length)})}}if(e.channelHasField(X1)&&e.typedFieldDef(X1).type===j4){t.push({signal:e.getName("geojson_"+t.length)})}if(t.length===0){t.push(e.requestDataName(ure.Main))}return t}function Noe(e,t){var n=Z0(Soe,(function(n){if(!xi(e.explicit,n)&&!xi(t.explicit,n)){return true}if(xi(e.explicit,n)&&xi(t.explicit,n)&&W0(e.get(n),t.get(n))){return true}return false}));var r=W0(e.size,t.size);if(r){if(n){return e}else if(W0(e.explicit,{})){return t}else if(W0(t.explicit,{})){return e}}return null}function Toe(e){var t;if(e.children.length===0){return undefined}var n;for(var r=0,i=e.children;r<i.length;r++){var a=i[r];Moe(a)}var o=Z0(e.children,(function(e){var t=e.component.projection;if(!t){return true}else if(!n){n=t;return true}else{var r=Noe(n,t);if(r){n=r}return!!r}}));if(n&&o){var u=e.projectionName(true);var s=new Coe(u,n.specifiedProjection,n.size,H0(n.data));for(var l=0,f=e.children;l<f.length;l++){var a=f[l];var c=a.component.projection;if(c){if(c.isFit){(t=s.data).push.apply(t,a.component.projection.data)}a.renameProjection(c.get("name"),u);c.merged=true}}return s}return undefined}function zoe(e,t,n,r){var i,a;if(R7(t,n)){var o=zse(e)?(a=(i=e.axis(n))!==null&&i!==void 0?i:e.legend(n))!==null&&a!==void 0?a:{}:{};var u=u7(t,{expr:"datum"});var s=u7(t,{expr:"datum",binSuffix:"end"});return{formulaAs:u7(t,{binSuffix:"range",forAs:true}),formula:E9(u,s,o.format,o.formatType,r)}}return{}}function Roe(e,t){return B3(e)+"_"+t}function Poe(e,t){return{signal:e.getName(t+"_bins"),extentSignal:e.getName(t+"_extent")}}function Loe(e,t,n){var r;var i=(r=C7(n,undefined))!==null&&r!==void 0?r:{};var a=Roe(i,t);return e.getName(a+"_bins")}function joe(e){return"as"in e}function Boe(e,t,n){var r;var i;if(joe(e)){r=Ni(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]}else{r=[u7(e,{forAs:true}),u7(e,{binSuffix:"end",forAs:true})]}var a=__assign({},C7(t,undefined));var o=Roe(a,e.field);var u=Poe(n,o),s=u.signal,l=u.extentSignal;if(W3(a.extent)){var f=a.extent;i=Vie(n,f.param,f);delete a.extent}var c=__assign(__assign(__assign({bin:a,field:e.field,as:[r]},s?{signal:s}:{}),l?{extentSignal:l}:{}),i?{span:i}:{});return{key:o,binComponent:c}}var Ioe=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.bins=n;return r}t.prototype.clone=function(){return new t(null,H0(this.bins))};t.makeFromEncoding=function(e,n){var r=n.reduceFieldDef((function(e,t,r){if(K9(t)&&I3(t.bin)){var i=Boe(t,t.bin,n),a=i.key,o=i.binComponent;e[a]=__assign(__assign(__assign({},o),e[a]),zoe(n,t,r,n.config))}return e}),{});if(u1(r)){return null}return new t(e,r)};t.makeFromTransform=function(e,n,r){var i;var a=Boe(n,n.bin,r),o=a.key,u=a.binComponent;return new t(e,(i={},i[o]=u,i))};t.prototype.merge=function(e,t){for(var n=0,r=s1(e.bins);n<r.length;n++){var i=r[n];if(i in this.bins){t(e.bins[i].signal,this.bins[i].signal);this.bins[i].as=t1(__spreadArray(__spreadArray([],this.bins[i].as),e.bins[i].as),Y0)}else{this.bins[i]=e.bins[i]}}for(var a=0,o=e.children;a<o.length;a++){var u=o[a];e.removeChild(u);u.parent=this}e.remove()};t.prototype.producedFields=function(){return new Set(l1(this.bins).map((function(e){return e.as})).flat(2))};t.prototype.dependentFields=function(){return new Set(l1(this.bins).map((function(e){return e.field})))};t.prototype.hash=function(){return"Bin "+Y0(this.bins)};t.prototype.assemble=function(){return l1(this.bins).flatMap((function(e){var t=[];var n=e.as,r=n[0],i=n.slice(1);var a=e.bin,o=a.extent,u=Ice(a,["extent"]);var s=__assign(__assign(__assign({type:"bin",field:_1(e.field),as:r,signal:e.signal},!W3(o)?{extent:o}:{extent:null}),e.span?{span:{signal:"span("+e.span+")"}}:{}),u);if(!o&&e.extentSignal){t.push({type:"extent",field:_1(e.field),signal:e.extentSignal});s.extent={signal:e.extentSignal}}t.push(s);for(var l=0,f=i;l<f.length;l++){var c=f[l];for(var d=0;d<2;d++){t.push({type:"formula",expr:u7({field:r[d]},{expr:"datum"}),as:c[d]})}}if(e.formula){t.push({type:"formula",expr:e.formula,as:e.formulaAs})}return t}))};return t}(mre);function Uoe(e,t,n,r){var i=zse(r)?r.encoding[j2(t)]:undefined;if(K9(n)&&zse(r)&&q9(n,i,r.markDef,r.config)){e.add(u7(n,{}));e.add(u7(n,{suffix:"end"}));if(n.bin&&R7(n,t)){e.add(u7(n,{binSuffix:"range"}))}}else if(g2(t)){var a=p2(t);e.add(r.getName(a))}else{e.add(u7(n))}return e}function qoe(e,t){var n;var r;for(var i=0,a=s1(t);i<a.length;i++){var o=a[i];var u=t[o];for(var s=0,l=s1(u);s<l.length;s++){var f=l[s];if(o in e){e[o][f]=new Set(__spreadArray(__spreadArray([],(r=e[o][f])!==null&&r!==void 0?r:[]),u[f]))}else{e[o]=(n={},n[f]=u[f],n)}}}}var Woe=function(e){R(t,e);function t(t,n,r){var i=e.call(this,t)||this;i.dimensions=n;i.measures=r;return i}t.prototype.clone=function(){return new t(null,new Set(this.dimensions),H0(this.measures))};Object.defineProperty(t.prototype,"groupBy",{get:function(){return this.dimensions},enumerable:false,configurable:true});t.makeFromEncoding=function(e,n){var r=false;n.forEachFieldDef((function(e){if(e.aggregate){r=true}}));var i={};var a=new Set;if(!r){return null}n.forEachFieldDef((function(e,t){var r,o,u,s;var l=e.aggregate,f=e.field;if(l){if(l==="count"){(r=i["*"])!==null&&r!==void 0?r:i["*"]={};i["*"]["count"]=new Set([u7(e,{forAs:true})])}else{if(F3(l)||O3(l)){var c=F3(l)?"argmin":"argmax";var d=l[c];(o=i[d])!==null&&o!==void 0?o:i[d]={};i[d][c]=new Set([u7({op:c,field:d},{forAs:true})])}else{(u=i[f])!==null&&u!==void 0?u:i[f]={};i[f][l]=new Set([u7(e,{forAs:true})])}if(x3(t)&&n.scaleDomain(t)==="unaggregated"){(s=i[f])!==null&&s!==void 0?s:i[f]={};i[f]["min"]=new Set([u7({field:f,aggregate:"min"},{forAs:true})]);i[f]["max"]=new Set([u7({field:f,aggregate:"max"},{forAs:true})])}}}else{Uoe(a,t,e,n)}}));if(a.size+s1(i).length===0){return null}return new t(e,a,i)};t.makeFromTransform=function(e,n){var r,i,a;var o=new Set;var u={};for(var s=0,l=n.aggregate;s<l.length;s++){var f=l[s];var c=f.op,d=f.field,h=f.as;if(c){if(c==="count"){(r=u["*"])!==null&&r!==void 0?r:u["*"]={};u["*"]["count"]=new Set([h?h:u7(f,{forAs:true})])}else{(i=u[d])!==null&&i!==void 0?i:u[d]={};u[d][c]=new Set([h?h:u7(f,{forAs:true})])}}}for(var v=0,p=(a=n.groupby)!==null&&a!==void 0?a:[];v<p.length;v++){var f=p[v];o.add(f)}if(o.size+s1(u).length===0){return null}return new t(e,o,u)};t.prototype.merge=function(e){if(r1(this.dimensions,e.dimensions)){qoe(this.measures,e.measures);return true}else{$6("different dimensions, cannot merge");return false}};t.prototype.addDimensions=function(e){e.forEach(this.dimensions.add,this.dimensions)};t.prototype.dependentFields=function(){return new Set(__spreadArray(__spreadArray([],this.dimensions),s1(this.measures)))};t.prototype.producedFields=function(){var e=new Set;for(var t=0,n=s1(this.measures);t<n.length;t++){var r=n[t];for(var i=0,a=s1(this.measures[r]);i<a.length;i++){var o=a[i];var u=this.measures[r][o];if(u.size===0){e.add(o+"_"+r)}else{u.forEach(e.add,e)}}}return e};t.prototype.hash=function(){return"Aggregate "+Y0({dimensions:this.dimensions,measures:this.measures})};t.prototype.assemble=function(){var e=[];var t=[];var n=[];for(var r=0,i=s1(this.measures);r<i.length;r++){var a=i[r];for(var o=0,u=s1(this.measures[a]);o<u.length;o++){var s=u[o];for(var l=0,f=this.measures[a][s];l<f.length;l++){var c=f[l];n.push(c);e.push(s);t.push(a==="*"?null:_1(a))}}}var d={type:"aggregate",groupby:__spreadArray([],this.dimensions).map(_1),ops:e,fields:t,as:n};return d};return t}(mre);var Hoe=function(e){R(t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.model=n;a.name=r;a.data=i;for(var o=0,u=x2;o<u.length;o++){var s=u[o];var l=n.facet[s];if(l){var f=l.bin,c=l.sort;a[s]=__assign({name:n.getName(s+"_domain"),fields:__spreadArray([u7(l)],I3(f)?[u7(l,{binSuffix:"end"})]:[])},O9(c)?{sortField:c}:Rr(c)?{sortIndexField:bae(l,s)}:{})}}a.childModel=n.child;return a}t.prototype.hash=function(){var e="Facet";for(var t=0,n=x2;t<n.length;t++){var r=n[t];if(this[r]){e+=" "+r.charAt(0)+":"+Y0(this[r])}}return e};Object.defineProperty(t.prototype,"fields",{get:function(){var e;var t=[];for(var n=0,r=x2;n<r.length;n++){var i=r[n];if((e=this[i])===null||e===void 0?void 0:e.fields){t.push.apply(t,this[i].fields)}}return t},enumerable:false,configurable:true});t.prototype.dependentFields=function(){var e=new Set(this.fields);for(var t=0,n=x2;t<n.length;t++){var r=n[t];if(this[r]){if(this[r].sortField){e.add(this[r].sortField.field)}if(this[r].sortIndexField){e.add(this[r].sortIndexField)}}}return e};t.prototype.producedFields=function(){return new Set};t.prototype.getSource=function(){return this.name};t.prototype.getChildIndependentFieldsWithStep=function(){var e={};for(var t=0,n=n3;t<n.length;t++){var r=n[t];var i=this.childModel.component.scales[r];if(i&&!i.merged){var a=i.get("type");var o=i.get("range");if(n8(a)&&J3(o)){var u=Xue(this.childModel,r);var s=Yue(u);if(s){e[r]=s}else{G6(E5(r))}}}}return e};t.prototype.assembleRowColumnHeaderData=function(e,t,n){var r={row:"y",column:"x",facet:undefined}[e];var i=[];var a=[];var o=[];if(r&&n&&n[r]){if(t){i.push("distinct_"+n[r]);a.push("max")}else{i.push(n[r]);a.push("distinct")}o.push("distinct_"+n[r])}var u=this[e],s=u.sortField,l=u.sortIndexField;if(s){var f=s.op,c=f===void 0?S9:f,d=s.field;i.push(d);a.push(c);o.push(u7(s,{forAs:true}))}else if(l){i.push(l);a.push("max");o.push(l)}return{name:this[e].name,source:t!==null&&t!==void 0?t:this.data,transform:[__assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}};t.prototype.assembleFacetHeaderData=function(e){var t,n;var r=this.model.layout.columns;var i=this.model.component.layoutHeaders;var a=[];var o={};for(var u=0,s=Aae;u<s.length;u++){var l=s[u];for(var f=0,c=Eae;f<c.length;f++){var d=c[f];var h=(t=i[l]&&i[l][d])!==null&&t!==void 0?t:[];for(var v=0,p=h;v<p.length;v++){var g=p[v];if(((n=g.axes)===null||n===void 0?void 0:n.length)>0){o[l]=true;break}}}if(o[l]){var m='length(data("'+this.facet.name+'"))';var y=l==="row"?r?{signal:"ceil("+m+" / "+r+")"}:1:r?{signal:"min("+m+", "+r+")"}:{signal:m};a.push({name:this.facet.name+"_"+l,transform:[{type:"sequence",start:0,stop:y}]})}}var _=o.row,b=o.column;if(_||b){a.unshift(this.assembleRowColumnHeaderData("facet",null,e))}return a};t.prototype.assemble=function(){var e,t;var n=[];var r=null;var i=this.getChildIndependentFieldsWithStep();var a=this,o=a.column,u=a.row,s=a.facet;if(o&&u&&(i.x||i.y)){r="cross_"+this.column.name+"_"+this.row.name;var l=[].concat((e=i.x)!==null&&e!==void 0?e:[],(t=i.y)!==null&&t!==void 0?t:[]);var f=l.map((function(){return"distinct"}));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:f}]})}for(var c=0,d=[N1,O1];c<d.length;c++){var h=d[c];if(this[h]){n.push(this.assembleRowColumnHeaderData(h,r,i))}}if(s){var v=this.assembleFacetHeaderData(i);if(v){n.push.apply(n,v)}}return n};return t}(mre);function Goe(e){if(e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'){return e.slice(1,-1)}return e}function $oe(e,t){var n=g1(e);if(t==="number"){return"toNumber("+n+")"}else if(t==="boolean"){return"toBoolean("+n+")"}else if(t==="string"){return"toString("+n+")"}else if(t==="date"){return"toDate("+n+")"}else if(t==="flatten"){return n}else if(t.startsWith("date:")){var r=Goe(t.slice(5,t.length));return"timeParse("+n+",'"+r+"')"}else if(t.startsWith("utc:")){var r=Goe(t.slice(4,t.length));return"utcParse("+n+",'"+r+"')"}else{G6(I5(t));return null}}function Voe(e){var t={};U0(e.filter,(function(e){var n;if(S4(e)){var r=null;if(_4(e)){r=a5(e.equal)}else if(x4(e)){r=a5(e.lte)}else if(b4(e)){r=a5(e.lt)}else if(w4(e)){r=a5(e.gt)}else if(k4(e)){r=a5(e.gte)}else if(A4(e)){r=e.range[0]}else if(E4(e)){r=((n=e.oneOf)!==null&&n!==void 0?n:e["in"])[0]}if(r){if(V6(r)){t[e.field]="date"}else if(Fi(r)){t[e.field]="number"}else if(Ni(r)){t[e.field]="string"}}if(e.timeUnit){t[e.field]="date"}}}));return t}function Yoe(e){var t={};function n(e){if(O7(e)){t[e.field]="date"}else if(e.type==="quantitative"&&R3(e.aggregate)){t[e.field]="number"}else if(w1(e.field)>1){if(!(e.field in t)){t[e.field]="flatten"}}else if(t7(e)&&O9(e.sort)&&w1(e.sort.field)>1){if(!(e.sort.field in t)){t[e.sort.field]="flatten"}}}if(zse(e)||Rse(e)){e.forEachFieldDef((function(t,r){if(K9(t)){n(t)}else{var i=P2(r);var a=e.fieldDef(i);n(__assign(__assign({},t),{type:a.type}))}}))}if(zse(e)){var r=e.mark,i=e.markDef,a=e.encoding;if(j8(r)&&!e.encoding.order){var o=i.orient==="horizontal"?"y":"x";var u=a[o];if(V9(u)&&u.type==="quantitative"&&!(u.field in t)){t[u.field]="number"}}}return t}function Xoe(e){var t={};if(zse(e)&&e.component.selection){for(var n=0,r=s1(e.component.selection);n<r.length;n++){var i=r[n];var a=e.component.selection[i];for(var o=0,u=a.project.items;o<u.length;o++){var s=u[o];if(!s.channel&&w1(s.field)>1){t[s.field]="flatten"}}}}return t}var Joe=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r._parse=n;return r}t.prototype.clone=function(){return new t(null,H0(this._parse))};t.prototype.hash=function(){return"Parse "+Y0(this._parse)};t.makeExplicit=function(e,t,n){var r={};var i=t.data;if(!rre(i)&&i&&i.format&&i.format.parse){r=i.format.parse}return this.makeWithAncestors(e,r,{},n)};t.makeWithAncestors=function(e,n,r,i){for(var a=0,o=s1(r);a<o.length;a++){var u=o[a];var s=i.getWithExplicit(u);if(s.value!==undefined){if(s.explicit||s.value===r[u]||s.value==="derived"||r[u]==="flatten"){delete r[u]}else{G6(U5(u,r[u],s.value))}}}for(var l=0,f=s1(n);l<f.length;l++){var c=f[l];var s=i.get(c);if(s!==undefined){if(s===n[c]){delete n[c]}else{G6(U5(c,n[c],s))}}}var d=new Vne(n,r);i.copyAll(d);var h={};for(var v=0,p=s1(d.combine());v<p.length;v++){var g=p[v];var m=d.get(g);if(m!==null){h[g]=m}}if(s1(h).length===0||i.parseNothing){return null}return new t(e,h)};Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:false,configurable:true});t.prototype.merge=function(e){this._parse=__assign(__assign({},this._parse),e.parse);e.remove()};t.prototype.assembleFormatParse=function(){var e={};for(var t=0,n=s1(this._parse);t<n.length;t++){var r=n[t];var i=this._parse[r];if(w1(r)===1){e[r]=i}}return e};t.prototype.producedFields=function(){return new Set(s1(this._parse))};t.prototype.dependentFields=function(){return new Set(s1(this._parse))};t.prototype.assembleTransforms=function(e){var t=this;if(e===void 0){e=false}return s1(this._parse).filter((function(t){return e?w1(t)>1:true})).map((function(e){var n=$oe(e,t._parse[e]);if(!n){return null}var r={type:"formula",expr:n,as:x1(e)};return r})).filter((function(e){return e!==null}))};return t}(mre);var Qoe=function(e){R(t,e);function t(t){return e.call(this,t)||this}t.prototype.clone=function(){return new t(null)};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return new Set([$ee])};t.prototype.hash=function(){return"Identifier"};t.prototype.assemble=function(){return{type:"identifier",as:$ee}};return t}(mre);var Zoe=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.params=n;return r}t.prototype.clone=function(){return new t(null,this.params)};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return undefined};t.prototype.hash=function(){return"Graticule "+Y0(this.params)};t.prototype.assemble=function(){return __assign({type:"graticule"},this.params===true?{}:this.params)};return t}(mre);var Koe=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.params=n;return r}t.prototype.clone=function(){return new t(null,this.params)};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){var e;return new Set([(e=this.params.as)!==null&&e!==void 0?e:"data"])};t.prototype.hash=function(){return"Hash "+Y0(this.params)};t.prototype.assemble=function(){return __assign({type:"sequence"},this.params)};return t}(mre);var eue=function(e){R(t,e);function t(t){var n=e.call(this,null)||this;t!==null&&t!==void 0?t:t={name:"source"};var r;if(!rre(t)){r=t.format?__assign({},$0(t.format,["parse"])):{}}if(tre(t)){n._data={values:t.values}}else if(ere(t)){n._data={url:t.url};if(!r.type){var i=/(?:\.([^.]+))?$/.exec(t.url)[1];if(!J0(["json","csv","tsv","dsv","topojson"],i)){i="json"}r.type=i}}else if(are(t)){n._data={values:[{type:"Sphere"}]}}else if(nre(t)||rre(t)){n._data={}}n._generator=rre(t);if(t.name){n._name=t.name}if(r&&!u1(r)){n._data.format=r}return n}t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return undefined};Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:false,configurable:true});t.prototype.hasName=function(){return!!this._name};Object.defineProperty(t.prototype,"isGenerator",{get:function(){return this._generator},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:false,configurable:true});t.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")};t.prototype.hash=function(){throw new Error("Cannot hash sources")};t.prototype.assemble=function(){return __assign(__assign({name:this._name},this._data),{transform:[]})};return t}(mre);var tue=undefined&&undefined.__classPrivateFieldSet||function(e,t,n){if(!t.has(e)){throw new TypeError("attempted to set private field on non-instance")}t.set(e,n);return n};var nue=undefined&&undefined.__classPrivateFieldGet||function(e,t){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return t.get(e)};var rue;function iue(e){return e instanceof eue||e instanceof Zoe||e instanceof Koe}var aue=function(){function e(){rue.set(this,void 0);tue(this,rue,false)}e.prototype.setModified=function(){tue(this,rue,true)};Object.defineProperty(e.prototype,"modifiedFlag",{get:function(){return nue(this,rue)},enumerable:false,configurable:true});return e}();rue=new WeakMap;var oue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getNodeDepths=function(e,t,n){n.set(e,t);for(var r=0,i=e.children;r<i.length;r++){var a=i[r];this.getNodeDepths(a,t+1,n)}return n};t.prototype.optimize=function(e){var t=this.getNodeDepths(e,0,new Map);var n=__spreadArray([],t.entries()).sort((function(e,t){return t[1]-e[1]}));for(var r=0,i=n;r<i.length;r++){var a=i[r];this.run(a[0])}return this.modifiedFlag};return t}(aue);var uue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.optimize=function(e){this.run(e);for(var t=0,n=e.children;t<n.length;t++){var r=n[t];this.optimize(r)}return this.modifiedFlag};return t}(aue);var sue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.mergeNodes=function(e,t){var n=t.shift();for(var r=0,i=t;r<i.length;r++){var a=i[r];e.removeChild(a);a.parent=n;a.remove()}};t.prototype.run=function(e){var t=e.children.map((function(e){return e.hash()}));var n={};for(var r=0;r<t.length;r++){if(n[t[r]]===undefined){n[t[r]]=[e.children[r]]}else{n[t[r]].push(e.children[r])}}for(var i=0,a=s1(n);i<a.length;i++){var o=a[i];if(n[o].length>1){this.setModified();this.mergeNodes(e,n[o])}}};return t}(uue);var lue=function(e){R(t,e);function t(t){var n=e.call(this)||this;n.requiresSelectionId=t&&Bie(t);return n}t.prototype.run=function(e){if(e instanceof Qoe){if(!(this.requiresSelectionId&&(iue(e.parent)||e.parent instanceof Woe||e.parent instanceof Joe))){this.setModified();e.remove()}}};return t}(uue);var fue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.optimize=function(e){this.run(e,new Set);return this.modifiedFlag};t.prototype.run=function(e,t){var n=new Set;if(e instanceof _re){n=e.producedFields();if(i1(n,t)){this.setModified();e.removeFormulas(t);if(e.producedFields.length===0){e.remove()}}}for(var r=0,i=e.children;r<i.length;r++){var a=i[r];this.run(a,new Set(__spreadArray(__spreadArray([],t),n)))}};return t}(aue);var cue=function(e){R(t,e);function t(){return e.call(this)||this}t.prototype.run=function(e){if(e instanceof yre&&!e.isRequired()){this.setModified();e.remove()}};return t}(uue);var due=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){if(iue(e)){return}if(e.numChildren()>1){return}for(var t=0,n=e.children;t<n.length;t++){var r=n[t];if(r instanceof Joe){if(e instanceof Joe){this.setModified();e.merge(r)}else{if(o1(e.producedFields(),r.dependentFields())){continue}this.setModified();r.swapWithParent()}}}return};return t}(oue);var hue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){var t=__spreadArray([],e.children);var n=e.children.filter((function(e){return e instanceof Joe}));if(e.numChildren()>1&&n.length>=1){var r={};var i=new Set;for(var a=0,o=n;a<o.length;a++){var u=o[a];var s=u.parse;for(var l=0,f=s1(s);l<f.length;l++){var c=f[l];if(!(c in r)){r[c]=s[c]}else if(r[c]!==s[c]){i.add(c)}}}for(var d=0,h=i;d<h.length;d++){var v=h[d];delete r[v]}if(!u1(r)){this.setModified();var p=new Joe(e,r);for(var g=0,m=t;g<m.length;g++){var y=m[g];if(y instanceof Joe){for(var _=0,b=s1(r);_<b.length;_++){var x=b[_];delete y.parse[x]}}e.removeChild(y);y.parent=p;if(y instanceof Joe&&s1(y.parse).length===0){y.remove()}}}}};return t}(oue);var vue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){if(e instanceof yre||e.numChildren()>0||e instanceof Hoe);else if(e instanceof eue);else{this.setModified();e.remove()}};return t}(oue);var pue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){var t=e.children.filter((function(e){return e instanceof _re}));var n=t.pop();for(var r=0,i=t;r<i.length;r++){var a=i[r];this.setModified();n.merge(a)}};return t}(oue);var gue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){var t=e.children.filter((function(e){return e instanceof Woe}));var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];var o=Y0(a.groupBy);if(!(o in n)){n[o]=[]}n[o].push(a)}for(var u=0,s=s1(n);u<s.length;u++){var l=s[u];var f=n[l];if(f.length>1){var c=f.pop();for(var d=0,h=f;d<h.length;d++){var a=h[d];if(c.merge(a)){e.removeChild(a);a.parent=c;a.remove();this.setModified()}}}}};return t}(oue);var mue=function(e){R(t,e);function t(t){var n=e.call(this)||this;n.model=t;return n}t.prototype.run=function(e){var t=!(iue(e)||e instanceof Hie||e instanceof Joe||e instanceof Qoe);var n=[];var r=[];for(var i=0,a=e.children;i<a.length;i++){var o=a[i];if(o instanceof Ioe){if(t&&!o1(e.producedFields(),o.dependentFields())){n.push(o)}else{r.push(o)}}}if(n.length>0){var u=n.pop();for(var s=0,l=n;s<l.length;s++){var f=l[s];u.merge(f,this.model.renameSignal.bind(this.model))}this.setModified();if(e instanceof Ioe){e.merge(u,this.model.renameSignal.bind(this.model))}else{u.swapWithParent()}}if(r.length>1){var c=r.pop();for(var d=0,h=r;d<h.length;d++){var v=h[d];c.merge(v,this.model.renameSignal.bind(this.model))}this.setModified()}};return t}(oue);var yue=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){var t=__spreadArray([],e.children);var n=Q0(t,(function(e){return e instanceof yre}));if(!n||e.numChildren()<=1){return}var r=[];var i;for(var a=0,o=t;a<o.length;a++){var u=o[a];if(u instanceof yre){var s=u;while(s.numChildren()===1){var l=s.children[0];if(l instanceof yre){s=l}else{break}}r.push.apply(r,s.children);if(i){e.removeChild(u);u.parent=i.parent;i.parent.removeChild(i);i.parent=s;this.setModified()}else{i=s}}else{r.push(u)}}if(r.length){this.setModified();for(var f=0,c=r;f<c.length;f++){var u=c[f];u.parent.removeChild(u);u.parent=i}}};return t}(oue);var _ue=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.addDimensions=function(e){this.transform.groupby=t1(this.transform.groupby.concat(e),(function(e){return e}))};t.prototype.dependentFields=function(){var e=new Set;if(this.transform.groupby){this.transform.groupby.forEach(e.add,e)}this.transform.joinaggregate.map((function(e){return e.field})).filter((function(e){return e!==undefined})).forEach(e.add,e);return e};t.prototype.producedFields=function(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))};t.prototype.getDefaultName=function(e){var t;return(t=e.as)!==null&&t!==void 0?t:u7(e)};t.prototype.hash=function(){return"JoinAggregateTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e=[];var t=[];var n=[];for(var r=0,i=this.transform.joinaggregate;r<i.length;r++){var a=i[r];t.push(a.op);n.push(this.getDefaultName(a));e.push(a.field===undefined?null:a.field)}var o=this.transform.groupby;return __assign({type:"joinaggregate",as:n,ops:t,fields:e},o!==undefined?{groupby:o}:{})};return t}(mre);function bue(e){return e.stack.stackBy.reduce((function(e,t){var n=t.fieldDef;var r=u7(n);if(r){e.push(r)}return e}),[])}function xue(e){return Rr(e)&&e.every((function(e){return Ni(e)}))&&e.length>1}var wue=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r._stack=n;return r}t.prototype.clone=function(){return new t(null,H0(this._stack))};t.makeFromTransform=function(e,n){var r=n.stack,i=n.groupby,a=n.as,o=n.offset,u=o===void 0?"zero":o;var s=[];var l=[];if(n.sort!==undefined){for(var f=0,c=n.sort;f<c.length;f++){var d=c[f];s.push(d.field);l.push(k1(d.order,"ascending"))}}var h={field:s,order:l};var v;if(xue(a)){v=a}else if(Ni(a)){v=[a,a+"_end"]}else{v=[n.stack+"_start",n.stack+"_end"]}return new t(e,{stackField:r,groupby:i,offset:u,sort:h,facetby:[],as:v})};t.makeFromEncoding=function(e,n){var r=n.stack;var i=n.encoding;if(!r){return null}var a=r.groupbyChannel,o=r.fieldChannel,u=r.offset,s=r.impute;var l;if(a){var f=i[a];l=w7(f)}var c=bue(n);var d=n.encoding.order;var h;if(Rr(d)||V9(d)){h=g5(d)}else{h=c.reduce((function(e,t){e.field.push(t);e.order.push(o==="y"?"descending":"ascending");return e}),{field:[],order:[]})}return new t(e,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:c,sort:h,offset:u,impute:s,as:[n.vgField(o,{suffix:"start",forAs:true}),n.vgField(o,{suffix:"end",forAs:true})]})};Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:false,configurable:true});t.prototype.addDimensions=function(e){var t;(t=this._stack.facetby).push.apply(t,e)};t.prototype.dependentFields=function(){var e=new Set;e.add(this._stack.stackField);this.getGroupbyFields().forEach(e.add,e);this._stack.facetby.forEach(e.add,e);this._stack.sort.field.forEach(e.add,e);return e};t.prototype.producedFields=function(){return new Set(this._stack.as)};t.prototype.hash=function(){return"Stack "+Y0(this._stack)};t.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute,r=e.groupby;if(t){if(t.bin){if(n){return[u7(t,{binSuffix:"mid"})]}return[u7(t,{}),u7(t,{binSuffix:"end"})]}return[u7(t)]}return r!==null&&r!==void 0?r:[]};t.prototype.assemble=function(){var e=[];var t=this._stack,n=t.facetby,r=t.dimensionFieldDef,i=t.stackField,a=t.stackby,o=t.sort,u=t.offset,s=t.impute,l=t.as;if(s&&r){var f=r.bandPosition,c=f===void 0?.5:f,d=r.bin;if(d){e.push({type:"formula",expr:c+"*"+u7(r,{expr:"datum"})+("+"+(1-c)+"*")+u7(r,{expr:"datum",binSuffix:"end"}),as:u7(r,{binSuffix:"mid",forAs:true})})}e.push({type:"impute",field:i,groupby:__spreadArray(__spreadArray([],a),n),key:u7(r,{binSuffix:"mid"}),method:"value",value:0})}e.push({type:"stack",groupby:__spreadArray(__spreadArray([],this.getGroupbyFields()),n),field:i,sort:o,as:l,offset:u});return e};return t}(mre);var kue=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.addDimensions=function(e){this.transform.groupby=t1(this.transform.groupby.concat(e),(function(e){return e}))};t.prototype.dependentFields=function(){var e,t;var n=new Set;((e=this.transform.groupby)!==null&&e!==void 0?e:[]).forEach(n.add,n);((t=this.transform.sort)!==null&&t!==void 0?t:[]).forEach((function(e){return n.add(e.field)}));this.transform.window.map((function(e){return e.field})).filter((function(e){return e!==undefined})).forEach(n.add,n);return n};t.prototype.producedFields=function(){return new Set(this.transform.window.map(this.getDefaultName))};t.prototype.getDefaultName=function(e){var t;return(t=e.as)!==null&&t!==void 0?t:u7(e)};t.prototype.hash=function(){return"WindowTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e;var t=[];var n=[];var r=[];var i=[];for(var a=0,o=this.transform.window;a<o.length;a++){var u=o[a];n.push(u.op);r.push(this.getDefaultName(u));i.push(u.param===undefined?null:u.param);t.push(u.field===undefined?null:u.field)}var s=this.transform.frame;var l=this.transform.groupby;if(s&&s[0]===null&&s[1]===null&&n.every((function(e){return N3(e)}))){return __assign({type:"joinaggregate",as:r,ops:n,fields:t},l!==undefined?{groupby:l}:{})}var f=[];var c=[];if(this.transform.sort!==undefined){for(var d=0,h=this.transform.sort;d<h.length;d++){var v=h[d];f.push(v.field);c.push((e=v.order)!==null&&e!==void 0?e:"ascending")}}var p={field:f,order:c};var g=this.transform.ignorePeers;return __assign(__assign(__assign({type:"window",params:i,as:r,ops:n,fields:t,sort:p},g!==undefined?{ignorePeers:g}:{}),l!==undefined?{groupby:l}:{}),s!==undefined?{frame:s}:{})};return t}(mre);function Aue(e){function t(n){if(!(n instanceof Hoe)){var r=n.clone();if(r instanceof yre){var i=Sue+r.getSource();r.setSource(i);e.model.component.data.outputNodes[i]=r}else if(r instanceof Woe||r instanceof wue||r instanceof kue||r instanceof _ue){r.addDimensions(e.fields)}for(var a=0,o=n.children.flatMap(t);a<o.length;a++){var u=o[a];u.parent=r}return[r]}return n.children.flatMap(t)}return t}function Eue(e){if(e instanceof Hoe){if(e.numChildren()===1&&!(e.children[0]instanceof yre)){var t=e.children[0];if(t instanceof Woe||t instanceof wue||t instanceof kue||t instanceof _ue){t.addDimensions(e.fields)}t.swapWithParent();Eue(e)}else{var n=e.model.component.data.main;Due(n);var r=Aue(e);var i=e.children.map(r).flat();for(var a=0,o=i;a<o.length;a++){var u=o[a];u.parent=n}}}else{e.children.map(Eue)}}function Due(e){if(e instanceof yre&&e.type===ure.Main){if(e.numChildren()===1){var t=e.children[0];if(!(t instanceof Hoe)){t.swapWithParent();Due(e)}}}}var Sue="scale_";var Cue=5;function Mue(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];for(var i=0,a=r.children;i<a.length;i++){var o=a[i];if(o.parent!==r){return false}}if(!Mue(r.children)){return false}}return true}function Fue(e,t){var n=false;for(var r=0,i=t;r<i.length;r++){var a=i[r];n=e.optimize(a)||n}return n}function Oue(e,t,n){var r=e.sources;var i=false;i=Fue(new cue,r)||i;i=Fue(new lue(t),r)||i;r=r.filter((function(e){return e.numChildren()>0}));i=Fue(new vue,r)||i;r=r.filter((function(e){return e.numChildren()>0}));if(!n){i=Fue(new due,r)||i;i=Fue(new mue(t),r)||i;i=Fue(new fue,r)||i;i=Fue(new hue,r)||i;i=Fue(new gue,r)||i;i=Fue(new pue,r)||i;i=Fue(new sue,r)||i;i=Fue(new yue,r)||i}e.sources=r;return i}function Nue(e,t){Mue(e.sources);var n=0;var r=0;for(var i=0;i<Cue;i++){if(!Oue(e,t,true)){break}n++}e.sources.map(Eue);for(var i=0;i<Cue;i++){if(!Oue(e,t,false)){break}r++}Mue(e.sources);if(Math.max(n,r)===Cue){G6("Maximum optimization runs("+Cue+") reached.")}}var Tue=function(){function e(e){Object.defineProperty(this,"signal",{enumerable:true,get:e})}e.fromName=function(t,n){return new e((function(){return t(n)}))};return e}();function zue(e){if(zse(e)){Rue(e)}else{Pue(e)}}function Rue(e){var t=e.component.scales;for(var n=0,r=s1(t);n<r.length;n++){var i=r[n];var a=jue(e,i);var o=t[i];o.setWithExplicit("domains",a);Wue(e,i);if(e.component.data.isFaceted){var u=e;while(!Rse(u)&&u.parent){u=u.parent}var s=u.component.resolve.scale[i];if(s==="shared"){for(var l=0,f=a.value;l<f.length;l++){var c=f[l];if(K3(c)){c.data=Sue+c.data.replace(Sue,"")}}}}}}function Pue(e){for(var t=0,n=e.children;t<n.length;t++){var r=n[t];zue(r)}var i=e.component.scales;for(var a=0,o=s1(i);a<o.length;a++){var u=o[a];var s=void 0;var l=null;for(var f=0,c=e.children;f<c.length;f++){var r=c[f];var d=r.component.scales[u];if(d){if(s===undefined){s=d.getWithExplicit("domains")}else{s=Zne(s,d.getWithExplicit("domains"),"domains","scale",$ue)}var h=d.get("selectionExtent");if(l&&h&&l.param!==h.param){G6(R5)}l=h}}i[u].setWithExplicit("domains",s);if(l){i[u].set("selectionExtent",l,true)}}}function Lue(e,t,n,r){if(e==="unaggregated"){var i=Gue(t,n),a=i.valid,o=i.reason;if(!a){G6(o);return undefined}}else if(e===undefined&&r.useUnaggregatedDomain){var u=Gue(t,n).valid;if(u){return"unaggregated"}}return e}function jue(e,t){var n=e.getScaleComponent(t).get("type");var r=e.encoding;var i=Lue(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);if(i!==e.scaleDomain(t)){e.specifiedScales[t]=__assign(__assign({},e.specifiedScales[t]),{domain:i})}if(t==="x"&&k7(r.x2)){if(k7(r.x)){return Zne(Uue(n,i,e,"x"),Uue(n,i,e,"x2"),"domain","scale",$ue)}else{return Uue(n,i,e,"x2")}}else if(t==="y"&&k7(r.y2)){if(k7(r.y)){return Zne(Uue(n,i,e,"y"),Uue(n,i,e,"y2"),"domain","scale",$ue)}else{return Uue(n,i,e,"y2")}}return Uue(n,i,e,t)}function Bue(e,t,n){return e.map((function(e){var r=T7(e,{timeUnit:n,type:t});return{signal:"{data: "+r+"}"}}))}function Iue(e,t,n){var r;var i=(r=g4(n))===null||r===void 0?void 0:r.unit;if(t==="temporal"||i){return Bue(e,t,i)}return[e]}function Uue(e,t,n,r){var i=n.encoding;var a=k7(i[r]);var o=a.type;var u=a["timeUnit"];if(l8(t)){var s=Uue(e,undefined,n,r);var l=Iue(t.unionWith,o,u);return Yne(__spreadArray(__spreadArray([],s.value),l))}else if(X3(t)){return Yne([t])}else if(t&&t!=="unaggregated"&&!s8(t)){return Yne(Iue(t,o,u))}var f=n.stack;if(f&&r===f.fieldChannel){if(f.offset==="normalize"){return Xne([[0,1]])}var c=n.requestDataName(ure.Main);return Xne([{data:c,field:n.vgField(r,{suffix:"start"})},{data:c,field:n.vgField(r,{suffix:"end"})}])}var d=x3(r)&&V9(a)?Hue(n,r,e):undefined;if(X9(a)){var h=Iue([a.datum],o,u);return Xne(h)}var v=a;if(t==="unaggregated"){var p=n.requestDataName(ure.Main);var g=a.field;return Xne([{data:p,field:u7({field:g,aggregate:"min"})},{data:p,field:u7({field:g,aggregate:"max"})}])}else if(I3(v.bin)){if(n8(e)){if(e==="bin-ordinal"){return Xne([])}return Xne([{data:c1(d)?n.requestDataName(ure.Main):n.requestDataName(ure.Raw),field:n.vgField(r,R7(v,r)?{binSuffix:"range"}:{}),sort:d===true||!Pr(d)?{field:n.vgField(r,{}),op:"min"}:d}])}else{var m=v.bin;if(I3(m)){var y=Loe(n,v.field,m);return Xne([new Tue((function(){var e=n.getSignalName(y);return"["+e+".start, "+e+".stop]"}))])}else{return Xne([{data:n.requestDataName(ure.Main),field:n.vgField(r,{})}])}}}else if(v.timeUnit&&J0(["time","utc"],e)&&q9(v,zse(n)?n.encoding[j2(r)]:undefined,n.markDef,n.config)){var _=n.requestDataName(ure.Main);return Xne([{data:_,field:n.vgField(r)},{data:_,field:n.vgField(r,{suffix:"end"})}])}else if(d){return Xne([{data:c1(d)?n.requestDataName(ure.Main):n.requestDataName(ure.Raw),field:n.vgField(r),sort:d}])}else{return Xne([{data:n.requestDataName(ure.Main),field:n.vgField(r)}])}}function que(e,t){var n=e.op,r=e.field,i=e.order;return __assign(__assign({op:n!==null&&n!==void 0?n:t?"sum":S9},r?{field:_1(r)}:{}),i?{order:i}:{})}function Wue(e,t){var n;var r=e.component.scales[t];var i=e.specifiedScales[t].domain;var a=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin;var o=s8(i)&&i;var u=q3(a)&&W3(a.extent)&&a.extent;if(o||u){r.set("selectionExtent",o!==null&&o!==void 0?o:u,true)}}function Hue(e,t,n){if(!n8(n)){return undefined}var r=e.fieldDef(t);var i=r.sort;if(N9(i)){return{op:"min",field:bae(r,t),order:"ascending"}}var a=e.stack;var o=a?__spreadArray(__spreadArray([],a.groupbyField?[a.groupbyField]:[]),a.stackBy.map((function(e){return e.fieldDef.field}))):undefined;if(O9(i)){var u=a&&!J0(o,i.field);return que(i,u)}else if(F9(i)){var s=i.encoding,l=i.order;var f=e.fieldDef(s);var c=f.aggregate,d=f.field;var u=a&&!J0(o,d);if(F3(c)||O3(c)){return que({field:u7(f),order:l},u)}else if(N3(c)||!c){return que({op:c,field:d,order:l},u)}}else if(i==="descending"){return{op:"min",field:e.vgField(t),order:"descending"}}else if(J0(["ascending",undefined],i)){return true}return undefined}function Gue(e,t){var n=e.aggregate,r=e.type;if(!n){return{valid:false,reason:h6(e)}}if(Ni(n)&&!j3[n]){return{valid:false,reason:v6(n)}}if(r==="quantitative"){if(t==="log"){return{valid:false,reason:p6(e)}}}return{valid:true}}function $ue(e,t,n,r){if(e.explicit&&t.explicit){G6(w6(n,r,e.value,t.value))}return{explicit:e.explicit,value:__spreadArray(__spreadArray([],e.value),t.value)}}function Vue(e){var t=t1(e.map((function(e){if(K3(e)){var t=e.sort,n=Ice(e,["sort"]);return n}return e})),Y0);var n=t1(e.map((function(e){if(K3(e)){var t=e.sort;if(t!==undefined&&!c1(t)){if("op"in t&&t.op==="count"){delete t.field}if(t.order==="ascending"){delete t.order}}return t}return undefined})).filter((function(e){return e!==undefined})),Y0);if(t.length===0){return undefined}else if(t.length===1){var r=e[0];if(K3(r)&&n.length>0){var i=n[0];if(n.length>1){G6(E6);i=true}else{if(Pr(i)&&"field"in i){var a=i.field;if(r.field===a){i=i.order?{order:i.order}:true}}}return __assign(__assign({},r),{sort:i})}return r}var o=t1(n.map((function(e){if(c1(e)||!("op"in e)||Ni(e.op)&&e.op in M3){return e}G6(A6(e));return true})),Y0);var u;if(o.length===1){u=o[0]}else if(o.length>1){G6(E6);u=true}var s=t1(e.map((function(e){if(K3(e)){return e.data}return null})),(function(e){return e}));if(s.length===1&&s[0]!==null){var l=__assign({data:s[0],fields:t.map((function(e){return e.field}))},u?{sort:u}:{});return l}return __assign({fields:t},u?{sort:u}:{})}function Yue(e){if(K3(e)&&Ni(e.field)){return e.field}else if(Q3(e)){var t;for(var n=0,r=e.fields;n<r.length;n++){var i=r[n];if(K3(i)&&Ni(i.field)){if(!t){t=i.field}else if(t!==i.field){G6(D6);return t}}}G6(S6);return t}else if(Z3(e)){G6(C6);var a=e.fields[0];return Ni(a)?a:undefined}return undefined}function Xue(e,t){var n=e.component.scales[t];var r=n.get("domains").map((function(t){if(K3(t)){t.data=e.lookupDataSource(t.data)}return t}));return Vue(r)}function Jue(e){if(Lse(e)||Pse(e)){return e.children.reduce((function(e,t){return e.concat(Jue(t))}),Que(e))}else{return Que(e)}}function Que(e){return s1(e.component.scales).reduce((function(t,n){var r=e.component.scales[n];if(r.merged){return t}var i=r.combine();var a=i.name,o=i.type,u=i.selectionExtent,s=i.domains,l=i.range,f=i.reverse,c=Ice(i,["name","type","selectionExtent","domains","range","reverse"]);var d=Zue(i.range,a,n,e);var h=Xue(e,n);var v=u?pre(e,u,r,h):null;t.push(__assign(__assign(__assign(__assign(__assign({name:a,type:o},h?{domain:h}:{}),v?{domainRaw:v}:{}),{range:d}),f!==undefined?{reverse:f}:{}),c));return t}),[])}function Zue(e,t,n,r){if(r3(n)){if(J3(e)){return{step:{signal:t+"_step"}}}}else if(Pr(e)&&K3(e)){return __assign(__assign({},e),{data:r.lookupDataSource(e.data)})}return e}var Kue=function(e){R(t,e);function t(t,n){var r=e.call(this,{},{name:t})||this;r.merged=false;r.setWithExplicit("type",n);return r}t.prototype.domainDefinitelyIncludesZero=function(){if(this.get("zero")!==false){return true}return Q0(this.get("domains"),(function(e){return Rr(e)&&e.length===2&&e[0]<=0&&e[1]>=0}))};return t}(Vne);var ese=["range","scheme"];function tse(e){return e==="x"?"width":e==="y"?"height":undefined}function nse(e){var t=e.component.scales;for(var n=0,r=b3;n<r.length;n++){var i=r[n];var a=t[i];if(!a){continue}var o=ise(i,e);a.setWithExplicit("range",o)}}function rse(e,t){var n=e.fieldDef(t);if(n===null||n===void 0?void 0:n.bin){var r=n.bin,i=n.field;var a=tse(t);var o=e.getName(a);if(Pr(r)&&r.binned&&r.step!==undefined){return new Tue((function(){var n=e.scaleName(t);var i='(domain("'+n+'")[1] - domain("'+n+'")[0]) / '+r.step;return e.getSignalName(o)+" / ("+i+")"}))}else if(I3(r)){var u=Loe(e,i,r);return new Tue((function(){var t=e.getSignalName(u);var n="("+t+".stop - "+t+".start) / "+t+".step";return e.getSignalName(o)+" / ("+n+")"}))}}return undefined}function ise(e,t){var n=t.specifiedScales[e];var r=t.size;var i=t.getScaleComponent(e);var a=i.get("type");for(var o=0,u=ese;o<u.length;o++){var s=u[o];if(n[s]!==undefined){var l=_8(a,s);var f=b8(e,s);if(!l){G6(_6(a,s,e))}else if(f){G6(f)}else{switch(s){case"range":{var c=n.range;if(Rr(c)){if(r3(e)){return Yne(c.map((function(e){if(e==="width"||e==="height"){var n=t.getName(e);var r=t.getSignalName.bind(t);return Tue.fromName(r,n)}return e})))}}else if(Pr(c)){return Yne({data:t.requestDataName(ure.Main),field:c.field,sort:{op:"min",field:t.vgField(e)}})}return Yne(c)}case"scheme":return Yne(ase(n[s]))}}}}if(e===z1||e===R1){var d=e===z1?"width":"height";var h=r[d];if(nte(h)){if(n8(a)){return Yne({step:h.step})}else{G6(b6(d))}}}var v=n.rangeMin,p=n.rangeMax;var g=ose(e,t);if((v!==undefined||p!==undefined)&&_8(a,"rangeMin")&&Rr(g)&&g.length===2){return Yne([v!==null&&v!==void 0?v:g[0],p!==null&&p!==void 0?p:g[1]])}return Xne(g)}function ase(e){if(u8(e)){return __assign({scheme:e.name},$0(e,["name"]))}return{scheme:e}}function ose(e,t){var n=t.size,r=t.config,i=t.mark,a=t.encoding;var o=t.getSignalName.bind(t);var u=k7(a[e]).type;var s=t.getScaleComponent(e);var l=s.get("type");var f=t.specifiedScales[e],c=f.domain,d=f.domainMid;switch(e){case z1:case R1:{if(J0(["point","band"],l)){if(e===z1&&!n.width){var h=fte(r.view,"width");if(nte(h)){return h}}else if(e===R1&&!n.height){var v=fte(r.view,"height");if(nte(v)){return v}}}var p=tse(e);var g=t.getName(p);if(e===R1&&r8(l)){return[Tue.fromName(o,g),0]}else{return[0,Tue.fromName(o,g)]}}case J1:{var m=t.component.scales[e].get("zero");var y=lse(i,m,r);var _=cse(i,n,t,r);if(a8(l)){return sse(y,_,use(l,r,c,e))}else{return[y,_]}}case I1:return[0,Math.PI*2];case Q1:return[0,360];case j1:{return[0,new Tue((function(){var e=t.getSignalName("width");var n=t.getSignalName("height");return"min("+e+","+n+")/2"}))]}case t2:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case n2:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case X1:return"symbol";case $1:case V1:case Y1:if(l==="ordinal"){return u==="nominal"?"category":"ordinal"}else{if(d!==undefined){return"diverging"}else{return i==="rect"||i==="geoshape"?"heatmap":"ramp"}}case Z1:case K1:case e2:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}function use(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":if(n!==undefined&&Rr(n)){return n.length+1}else{G6(I6(r));return 3}}}function sse(e,t,n){var r=function(){var r=l5(t);var i=l5(e);var a="("+r+" - "+i+") / ("+n+" - 1)";return"sequence("+i+", "+r+" + "+a+", "+a+")"};if(X3(t)){return new Tue(r)}else{return{signal:r()}}}function lse(e,t,n){if(t){if(X3(t)){return{signal:t.signal+" ? 0 : "+lse(e,false,n)}}else{return 0}}switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(n6("size",e))}var fse=.95;function cse(e,t,n,r){var i={x:rse(n,"x"),y:rse(n,"y")};switch(e){case"bar":case"tick":{if(r.scale.maxBandSize!==undefined){return r.scale.maxBandSize}var a=dse(t,i,r.view);if(Fi(a)){return a-1}else{return new Tue((function(){return a.signal+" - 1"}))}}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize){return r.scale.maxSize}var o=dse(t,i,r.view);if(Fi(o)){return Math.pow(fse*o,2)}else{return new Tue((function(){return"pow("+fse+" * "+o.signal+", 2)"}))}}}throw new Error(n6("size",e))}function dse(e,t,n){var r=nte(e.width)?e.width.step:lte(n,"width");var i=nte(e.height)?e.height.step:lte(n,"height");if(t.x||t.y){return new Tue((function(){var e=[t.x?t.x.signal:r,t.y?t.y.signal:i];return"min("+e.join(", ")+")"}))}return Math.min(r,i)}function hse(e,t){if(zse(e)){vse(e,t)}else{mse(e,t)}}function vse(e,t){var n=e.component.scales;var r=e.config,i=e.encoding,a=e.markDef,o=e.specifiedScales;for(var u=0,s=s1(n);u<s.length;u++){var l=s[u];var f=o[l];var c=n[l];var d=e.getScaleComponent(l);var h=k7(i[l]);var v=f[t];var p=d.get("type");var g=d.get("padding");var m=d.get("paddingInner");var y=_8(p,t);var _=b8(l,t);if(v!==undefined){if(!y){G6(_6(p,t,l))}else if(_){G6(_)}}if(y&&_===undefined){if(v!==undefined){var b=h["timeUnit"];var x=h.type;switch(t){case"domainMax":case"domainMin":if(V6(f[t])||x==="temporal"||b){c.set(t,{signal:T7(f[t],{type:x,timeUnit:b})},true)}else{c.set(t,f[t],true)}break;default:c.copyKeyFromObject(t,f)}}else{var w=t in pse?pse[t]({model:e,channel:l,fieldOrDatumDef:h,scaleType:p,scalePadding:g,scalePaddingInner:m,domain:f.domain,markDef:a,config:r}):r.scale[t];if(w!==undefined){c.set(t,w,false)}}}}}var pse={bins:function(e){var t=e.model,n=e.fieldOrDatumDef;return V9(n)?yse(t,n):undefined},interpolate:function(e){var t=e.channel,n=e.fieldOrDatumDef;return _se(t,n.type)},nice:function(e){var t=e.scaleType,n=e.channel,r=e.domain,i=e.fieldOrDatumDef;return bse(t,n,r,i)},padding:function(e){var t=e.channel,n=e.scaleType,r=e.fieldOrDatumDef,i=e.markDef,a=e.config;return xse(t,n,a.scale,r,i,a.bar)},paddingInner:function(e){var t=e.scalePadding,n=e.channel,r=e.markDef,i=e.config;return wse(t,n,r.type,i.scale)},paddingOuter:function(e){var t=e.scalePadding,n=e.channel,r=e.scaleType,i=e.markDef,a=e.scalePaddingInner,o=e.config;return kse(t,n,r,i.type,a,o.scale)},reverse:function(e){var t=e.fieldOrDatumDef,n=e.scaleType,r=e.channel,i=e.config;var a=V9(t)?t.sort:undefined;return Ase(n,a,r,i.scale)},zero:function(e){var t=e.channel,n=e.fieldOrDatumDef,r=e.domain,i=e.markDef,a=e.scaleType;return Ese(t,n,r,i,a)}};function gse(e){if(zse(e)){nse(e)}else{mse(e,"range")}}function mse(e,t){var n=e.component.scales;for(var r=0,i=e.children;r<i.length;r++){var a=i[r];if(t==="range"){gse(a)}else{hse(a,t)}}for(var o=0,u=s1(n);o<u.length;o++){var s=u[o];var l=void 0;for(var f=0,c=e.children;f<c.length;f++){var a=c[f];var d=a.component.scales[s];if(d){var h=d.getWithExplicit(t);l=Zne(l,h,t,"scale",Jne((function(e,n){switch(t){case"range":if(e.step&&n.step){return e.step-n.step}return 0}return 0})))}}n[s].setWithExplicit(t,l)}}function yse(e,t){var n=t.bin;if(I3(n)){var r=Loe(e,t.field,n);return new Tue((function(){return e.getSignalName(r)}))}else if(U3(n)&&q3(n)&&n.step!==undefined){return{step:n.step}}return undefined}function _se(e,t){if(J0([$1,V1,Y1],e)&&t!=="nominal"){return"hcl"}return undefined}function bse(e,t,n,r){var i;if(((i=w7(r))===null||i===void 0?void 0:i.bin)||Rr(n)||J0([I4.TIME,I4.UTC],e)){return undefined}return t in t3?true:undefined}function xse(e,t,n,r,i,a){if(e in t3){if(i8(t)){if(n.continuousPadding!==undefined){return n.continuousPadding}var o=i.type,u=i.orient;if(o==="bar"&&!(V9(r)&&(r.bin||r.timeUnit))){if(u==="vertical"&&e==="x"||u==="horizontal"&&e==="y"){return a.continuousBandSize}}}if(t===I4.POINT){return n.pointPadding}}return undefined}function wse(e,t,n,r){if(e!==undefined){return undefined}if(t in t3){var i=r.bandPaddingInner,a=r.barBandPaddingInner,o=r.rectBandPaddingInner;return k1(i,n==="bar"?a:o)}return undefined}function kse(e,t,n,r,i,a){if(e!==undefined){return undefined}if(t in t3){if(n===I4.BAND){var o=a.bandPaddingOuter;return k1(o,X3(i)?{signal:i.signal+"/2"}:i/2)}}return undefined}function Ase(e,t,n,r){if(n==="x"&&r.xReverse!==undefined){if(r8(e)&&t==="descending"){if(X3(r.xReverse)){return{signal:"!"+r.xReverse.signal}}else{return!r.xReverse}}return r.xReverse}if(r8(e)&&t==="descending"){return true}return undefined}function Ese(e,t,n,r,i){var a=!!n&&n!=="unaggregated";if(a){if(r8(i)){if(Rr(n)){var o=n[0];var u=n[n.length-1];if(o<=0&&u>=0){return true}}return false}}if(e==="size"&&t.type==="quantitative"&&!a8(i)){return true}if(!(V9(t)&&t.bin)&&J0(__spreadArray(__spreadArray([],n3),a3),e)){var s=r.orient,l=r.type;if(J0(["bar","area","line","trail"],l)){if(s==="horizontal"&&e==="y"||s==="vertical"&&e==="x"){return false}}return true}return false}function Dse(e,t,n,r){var i=Sse(t,n,r);var a=e.type;if(!x3(t)){return null}if(a!==undefined){if(!w8(t,a)){G6(m6(t,a,i));return i}if(V9(n)&&!x8(a,n.type)){G6(y6(a,i));return i}return a}return i}function Sse(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":{if(_2(e)||S3(e)==="discrete"){if(e==="shape"&&t.type==="ordinal"){G6(u6(e,"ordinal"))}return"ordinal"}if(e in t3){if(J0(["rect","bar","image","rule"],n.type)){return"band"}}else if(n.type==="arc"&&e in i3){return"band"}var i=n[B2(e)];if(Q8(i)){return"band"}if(n7(t)&&((r=t.axis)===null||r===void 0?void 0:r.tickBand)){return"band"}return"point"}case"temporal":if(_2(e)){return"time"}else if(S3(e)==="discrete"){G6(u6(e,"temporal"));return"ordinal"}else if(V9(t)&&t.timeUnit&&g4(t.timeUnit).utc){return"utc"}return"time";case"quantitative":if(_2(e)){if(V9(t)&&I3(t.bin)){return"bin-ordinal"}return"linear"}else if(S3(e)==="discrete"){G6(u6(e,"quantitative"));return"ordinal"}return"linear";case"geojson":return undefined}throw new Error(X5(t.type))}function Cse(e,t){var n=t===void 0?{}:t,r=n.ignoreRange;Mse(e);zue(e);for(var i=0,a=y8;i<a.length;i++){var o=a[i];hse(e,o)}if(!r){gse(e)}}function Mse(e){if(zse(e)){e.component.scales=Fse(e)}else{e.component.scales=Nse(e)}}function Fse(e){var t=e.encoding,n=e.mark,r=e.markDef;return b3.reduce((function(i,a){var o=k7(t[a]);if(o&&n===L8&&a===X1&&o.type===j4){return i}var u=o&&o["scale"];if(o&&u!==null&&u!==false){u!==null&&u!==void 0?u:u={};var s=Dse(u,a,o,r);i[a]=new Kue(e.scaleName(""+a,true),{value:s,explicit:u.type===s})}return i}),{})}var Ose=Jne((function(e,t){return H4(e)-H4(t)}));function Nse(e){var t;var n;var r=e.component.scales={};var i={};var a=e.component.resolve;for(var o=0,u=e.children;o<u.length;o++){var s=u[o];Mse(s);for(var l=0,f=s1(s.component.scales);l<f.length;l++){var c=f[l];(t=(n=a.scale)[c])!==null&&t!==void 0?t:n[c]=Wae(c,e);if(a.scale[c]==="shared"){var d=i[c];var h=s.component.scales[c].getWithExplicit("type");if(d){if(q4(d.value,h.value)){i[c]=Zne(d,h,"type","scale",Ose)}else{a.scale[c]="independent";delete i[c]}}else{i[c]=h}}}}for(var v=0,p=s1(i);v<p.length;v++){var c=p[v];var g=e.scaleName(c,true);var m=i[c];r[c]=new Kue(g,m);for(var y=0,_=e.children;y<_.length;y++){var s=_[y];var b=s.component.scales[c];if(b){s.renameScale(b.get("name"),g);b.merged=true}}}return r}var Tse=function(){function e(){this.nameMap={}}e.prototype.rename=function(e,t){this.nameMap[e]=t};e.prototype.has=function(e){return this.nameMap[e]!==undefined};e.prototype.get=function(e){while(this.nameMap[e]&&e!==this.nameMap[e]){e=this.nameMap[e]}return e};return e}();function zse(e){return(e===null||e===void 0?void 0:e.type)==="unit"}function Rse(e){return(e===null||e===void 0?void 0:e.type)==="facet"}function Pse(e){return(e===null||e===void 0?void 0:e.type)==="concat"}function Lse(e){return(e===null||e===void 0?void 0:e.type)==="layer"}var jse=function(){function e(e,t,n,r,i,a,o){var u=this;var s,l;this.type=t;this.parent=n;this.config=i;this.correctDataNames=function(e){if(e.from&&e.from.data){e.from.data=u.lookupDataSource(e.from.data)}if(e.from&&e.from.facet&&e.from.facet.data){e.from.facet.data=u.lookupDataSource(e.from.facet.data)}return e};this.parent=n;this.config=i;this.view=$3(o);this.name=(s=e.name)!==null&&s!==void 0?s:r;this.title=Y3(e.title)?{text:e.title}:e.title?$3(e.title):undefined;this.scaleNameMap=n?n.scaleNameMap:new Tse;this.projectionNameMap=n?n.projectionNameMap:new Tse;this.signalNameMap=n?n.signalNameMap:new Tse;this.data=e.data;this.description=e.description;this.transforms=Ane((l=e.transform)!==null&&l!==void 0?l:[]);this.layout=t==="layer"||t==="unit"?{}:ute(e,t,i);this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:R9(e)||n&&n.component.data.isFaceted&&e.data===undefined},layoutSize:new Vne,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:__assign({scale:{},axis:{},legend:{}},a?H0(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:false,configurable:true});e.prototype.parse=function(){this.parseScale();this.parseLayoutSize();this.renameTopLevelLayoutSizeSignal();this.parseSelections();this.parseProjection();this.parseData();this.parseAxesAndHeaders();this.parseLegends();this.parseMarkGroup()};e.prototype.parseScale=function(){Cse(this)};e.prototype.parseProjection=function(){Moe(this)};e.prototype.renameTopLevelLayoutSizeSignal=function(){if(this.getName("width")!=="width"){this.renameSignal(this.getName("width"),"width")}if(this.getName("height")!=="height"){this.renameSignal(this.getName("height"),"height")}};e.prototype.parseLegends=function(){hoe(this)};e.prototype.assembleGroupStyle=function(){var e,t;if(this.type==="unit"||this.type==="layer"){return(t=(e=this.view)===null||e===void 0?void 0:e.style)!==null&&t!==void 0?t:"cell"}return undefined};e.prototype.assembleEncodeFromView=function(e){var t=e.style,n=Ice(e,["style"]);var r={};for(var i=0,a=s1(n);i<a.length;i++){var o=a[i];var u=n[o];if(u!==undefined){r[o]=u5(u)}}return r};e.prototype.assembleGroupEncodeEntry=function(e){var t={};if(this.view){t=this.assembleEncodeFromView(this.view)}if(!e){if(this.description){t["description"]=u5(this.description)}if(this.type==="unit"||this.type==="layer"){return __assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},t!==null&&t!==void 0?t:{})}}return u1(t)?undefined:t};e.prototype.assembleLayout=function(){if(!this.layout){return undefined}var e=this.layout,t=e.spacing,n=Ice(e,["spacing"]);var r=this,i=r.component,a=r.config;var o=Rae(i.layoutHeaders,a);return __assign(__assign(__assign({padding:t},this.assembleDefaultLayout()),n),o?{titleBand:o}:{})};e.prototype.assembleDefaultLayout=function(){return{}};e.prototype.assembleHeaderMarks=function(){var e=this.component.layoutHeaders;var t=[];for(var n=0,r=x2;n<r.length;n++){var i=r[n];if(e[i].title){t.push(Dae(this,i))}}for(var a=0,o=Aae;a<o.length;a++){var i=o[a];t=t.concat(Mae(this,i))}return t};e.prototype.assembleAxes=function(){return eae(this.component.axes,this.config)};e.prototype.assembleLegends=function(){return woe(this)};e.prototype.assembleProjections=function(){return Aoe(this)};e.prototype.assembleTitle=function(){var e,t,n;var r=(e=this.title)!==null&&e!==void 0?e:{},i=r.encoding,a=Ice(r,["encoding"]);var o=__assign(__assign(__assign({},V3(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text){if(J0(["unit","layer"],this.type)){if(J0(["middle",undefined],o.anchor)){(t=o.frame)!==null&&t!==void 0?t:o.frame="group"}}else{(n=o.anchor)!==null&&n!==void 0?n:o.anchor="start"}return u1(o)?undefined:o}return undefined};e.prototype.assembleGroup=function(e){if(e===void 0){e=[]}var t={};e=e.concat(this.assembleSignals());if(e.length>0){t.signals=e}var n=this.assembleLayout();if(n){t.layout=n}t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||Rse(this.parent)?Jue(this):[];if(r.length>0){t.scales=r}var i=this.assembleAxes();if(i.length>0){t.axes=i}var a=this.assembleLegends();if(a.length>0){t.legends=a}return t};e.prototype.getName=function(e){return d1((this.name?this.name+"_":"")+e)};e.prototype.getDataName=function(e){return this.getName(ure[e].toLowerCase())};e.prototype.requestDataName=function(e){var t=this.getDataName(e);var n=this.component.data.outputNodeRefCounts;n[t]=(n[t]||0)+1;return t};e.prototype.getSizeSignalRef=function(e){if(Rse(this.parent)){var t=Uae(e);var n=o3(t);var r=this.component.scales[n];if(r&&!r.merged){var i=r.get("type");var a=r.get("range");if(n8(i)&&J3(a)){var o=r.get("name");var u=Xue(this,n);var s=Yue(u);if(s){var l=u7({aggregate:"distinct",field:s},{expr:"datum"});return{signal:Iae(o,r,l)}}else{G6(E5(n));return null}}}}return{signal:this.signalNameMap.get(this.getName(e))}};e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];if(!t){return e}return t.getSource()};e.prototype.getSignalName=function(e){return this.signalNameMap.get(e)};e.prototype.renameSignal=function(e,t){this.signalNameMap.rename(e,t)};e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)};e.prototype.renameProjection=function(e,t){this.projectionNameMap.rename(e,t)};e.prototype.scaleName=function(e,t){if(t){return this.getName(e)}if(T2(e)&&x3(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))){return this.scaleNameMap.get(this.getName(e))}return undefined};e.prototype.projectionName=function(e){if(e){return this.getName("projection")}if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))){return this.projectionNameMap.get(this.getName("projection"))}return undefined};e.prototype.getScaleComponent=function(e){if(!this.component.scales){throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().")}var t=this.component.scales[e];if(t&&!t.merged){return t}return this.parent?this.parent.getScaleComponent(e):undefined};e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent){n=this.parent.getSelectionComponent(e,t)}if(!n){throw new Error(F5(t))}return n};e.prototype.hasAxisOrientSignalRef=function(){var e,t;return((e=this.component.axes.x)===null||e===void 0?void 0:e.some((function(e){return e.hasOrientSignalRef()})))||((t=this.component.axes.y)===null||t===void 0?void 0:t.some((function(e){return e.hasOrientSignalRef()})))};return e}();var Bse=function(e){R(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.vgField=function(e,t){if(t===void 0){t={}}var n=this.fieldDef(e);if(!n){return undefined}return u7(n,t)};t.prototype.reduceFieldDef=function(e,t){return tee(this.getMapping(),(function(t,n,r){var i=w7(n);if(i){return e(t,i,r)}return t}),t)};t.prototype.forEachFieldDef=function(e,t){eee(this.getMapping(),(function(t,n){var r=w7(t);if(r){e(r,n)}}),t)};return t}(jse);var Ise=function(e){R(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=H0(n);var u=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=u[0])!==null&&i!==void 0?i:"value",(a=u[1])!==null&&a!==void 0?a:"density"];return o}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.density],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"DensityTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.density,n=Ice(e,["density"]);var r=__assign({type:"kde",field:t},n);return r};return t}(mre);var Use=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.filter=n;return r}t.prototype.clone=function(){return new t(null,__assign({},this.filter))};t.make=function(e,n){var r=n.config,i=n.mark,a=n.markDef;var o=d5("invalid",a,r);if(o!=="filter"){return null}var u=n.reduceFieldDef((function(e,t,r){var a=x3(r)&&n.getScaleComponent(r);if(a){var o=a.get("type");if(r8(o)&&t.aggregate!=="count"&&!j8(i)){e[t.field]=t}}return e}),{});if(!s1(u).length){return null}return new t(e,u)};t.prototype.dependentFields=function(){return new Set(s1(this.filter))};t.prototype.producedFields=function(){return new Set};t.prototype.hash=function(){return"FilterInvalid "+Y0(this.filter)};t.prototype.assemble=function(){var e=this;var t=s1(this.filter).reduce((function(t,n){var r=e.filter[n];var i=u7(r,{expr:"datum"});if(r!==null){if(r.type==="temporal"){t.push("(isDate("+i+") || (isValid("+i+") && isFinite(+"+i+")))")}else if(r.type==="quantitative"){t.push("isValid("+i+")");t.push("isFinite(+"+i+")")}else;}return t}),[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null};return t}(mre);var qse=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;r.transform=H0(n);var i=r.transform,a=i.flatten,o=i.as,u=o===void 0?[]:o;r.transform.as=a.map((function(e,t){var n;return(n=u[t])!==null&&n!==void 0?n:e}));return r}t.prototype.clone=function(){return new t(this.parent,H0(this.transform))};t.prototype.dependentFields=function(){return new Set(this.transform.flatten)};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"FlattenTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.flatten,n=e.as;var r={type:"flatten",fields:t,as:n};return r};return t}(mre);var Wse=function(e){R(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=H0(n);var u=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=u[0])!==null&&i!==void 0?i:"key",(a=u[1])!==null&&a!==void 0?a:"value"];return o}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.dependentFields=function(){return new Set(this.transform.fold)};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"FoldTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.fold,n=e.as;var r={type:"fold",fields:t,as:n};return r};return t}(mre);var Hse=function(e){R(t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.fields=n;a.geojson=r;a.signal=i;return a}t.prototype.clone=function(){return new t(null,H0(this.fields),this.geojson,this.signal)};t.parseAll=function(e,n){if(n.component.projection&&!n.component.projection.isFit){return e}var r=0;for(var i=0,a=[[W1,q1],[G1,H1]];i<a.length;i++){var o=a[i];var u=o.map((function(e){var t=k7(n.encoding[e]);return V9(t)?t.field:X9(t)?{expr:""+t.datum}:e7(t)?{expr:""+t["value"]}:undefined}));if(u[0]||u[1]){e=new t(e,u,null,n.getName("geojson_"+r++))}}if(n.channelHasField(X1)){var s=n.typedFieldDef(X1);if(s.type===j4){e=new t(e,null,s.field,n.getName("geojson_"+r++))}}return e};t.prototype.dependentFields=function(){var e;var t=((e=this.fields)!==null&&e!==void 0?e:[]).filter(Ni);return new Set(__spreadArray(__spreadArray([],this.geojson?[this.geojson]:[]),t))};t.prototype.producedFields=function(){return new Set};t.prototype.hash=function(){return"GeoJSON "+this.geojson+" "+this.signal+" "+Y0(this.fields)};t.prototype.assemble=function(){return __spreadArray(__spreadArray([],this.geojson?[{type:"filter",expr:'isValid(datum["'+this.geojson+'"])'}]:[]),[__assign(__assign(__assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})])};return t}(mre);var Gse=function(e){R(t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.projection=n;a.fields=r;a.as=i;return a}t.prototype.clone=function(){return new t(null,this.projection,H0(this.fields),H0(this.as))};t.parseAll=function(e,n){if(!n.projectionName()){return e}for(var r=0,i=[[W1,q1],[G1,H1]];r<i.length;r++){var a=i[r];var o=a.map((function(e){var t=k7(n.encoding[e]);return V9(t)?t.field:X9(t)?{expr:""+t.datum}:e7(t)?{expr:""+t["value"]}:undefined}));var u=a[0]===G1?"2":"";if(o[0]||o[1]){e=new t(e,n.projectionName(),o,[n.getName("x"+u),n.getName("y"+u)])}}return e};t.prototype.dependentFields=function(){return new Set(this.fields.filter(Ni))};t.prototype.producedFields=function(){return new Set(this.as)};t.prototype.hash=function(){return"Geopoint "+this.projection+" "+Y0(this.fields)+" "+Y0(this.as)};t.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}};return t}(mre);var $se=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.impute,this.transform.key],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set([this.transform.impute])};t.prototype.processSequence=function(e){var t=e.start,n=t===void 0?0:t,r=e.stop,i=e.step;var a=__spreadArray([n,r],i?[i]:[]).join(",");return{signal:"sequence("+a+")"}};t.makeFromTransform=function(e,n){return new t(e,n)};t.makeFromEncoding=function(e,n){var r=n.encoding;var i=r.x;var a=r.y;if(V9(i)&&V9(a)){var o=i.impute?i:a.impute?a:undefined;if(o===undefined){return undefined}var u=i.impute?a:a.impute?i:undefined;var s=o.impute,l=s.method,f=s.value,c=s.frame,d=s.keyvals;var h=nee(n.mark,r);return new t(e,__assign(__assign(__assign(__assign(__assign({impute:o.field,key:u.field},l?{method:l}:{}),f!==undefined?{value:f}:{}),c?{frame:c}:{}),d!==undefined?{keyvals:d}:{}),h.length?{groupby:h}:{}))}return null};t.prototype.hash=function(){return"Impute "+Y0(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.impute,n=e.key,r=e.keyvals,i=e.method,a=e.groupby,o=e.value,u=e.frame,s=u===void 0?[null,null]:u;var l=__assign(__assign(__assign(__assign({type:"impute",field:t,key:n},r?{keyvals:ine(r)?this.processSequence(r):r}:{}),{method:"value"}),a?{groupby:a}:{}),{value:!i||i==="value"?o:null});if(i&&i!=="value"){var f=__assign({type:"window",as:["imputed_"+t+"_value"],ops:[i],fields:[t],frame:s,ignorePeers:false},a?{groupby:a}:{});var c={type:"formula",expr:"datum."+t+" === null ? datum.imputed_"+t+"_value : datum."+t,as:t};return[l,f,c]}else{return[l]}};return t}(mre);var Vse=function(e){R(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=H0(n);var u=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=u[0])!==null&&i!==void 0?i:n.on,(a=u[1])!==null&&a!==void 0?a:n.loess];return o}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.loess,this.transform.on],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"LoessTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.loess,n=e.on,r=Ice(e,["loess","on"]);var i=__assign({type:"loess",x:n,y:t},r);return i};return t}(mre);var Yse=function(e){R(t,e);function t(t,n,r){var i=e.call(this,t)||this;i.transform=n;i.secondary=r;return i}t.prototype.clone=function(){return new t(null,H0(this.transform),this.secondary)};t.make=function(e,n,r,i){var a=n.component.data.sources;var o=r.from;var u=null;if(one(o)){var s=gle(o.data,a);if(!s){s=new eue(o.data);a.push(s)}var l=n.getName("lookup_"+i);u=new yre(s,l,ure.Lookup,n.component.data.outputNodeRefCounts);n.component.data.outputNodes[l]=u}else if(une(o)){var f=o.param;r=__assign({as:f},r);var c=void 0;try{c=n.getSelectionComponent(d1(f),f)}catch(Afe){throw new Error(T5(f))}u=c.materialized;if(!u){throw new Error(z5(f))}}return new t(e,r,u.getSource())};t.prototype.dependentFields=function(){return new Set([this.transform.lookup])};t.prototype.producedFields=function(){return new Set(this.transform.as?oi(this.transform.as):this.transform.from.fields)};t.prototype.hash=function(){return"Lookup "+Y0({transform:this.transform,secondary:this.secondary})};t.prototype.assemble=function(){var e;if(this.transform.from.fields){e=__assign({values:this.transform.from.fields},this.transform.as?{as:oi(this.transform.as)}:{})}else{var t=this.transform.as;if(!Ni(t)){G6(H5);t="_lookup"}e={as:[t]}}return __assign(__assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})};return t}(mre);var Xse=function(e){R(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=H0(n);var u=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=u[0])!==null&&i!==void 0?i:"prob",(a=u[1])!==null&&a!==void 0?a:"value"];return o}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.quantile],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"QuantileTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.quantile,n=Ice(e,["quantile"]);var r=__assign({type:"quantile",field:t},n);return r};return t}(mre);var Jse=function(e){R(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=H0(n);var u=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=u[0])!==null&&i!==void 0?i:n.on,(a=u[1])!==null&&a!==void 0?a:n.regression];return o}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.regression,this.transform.on],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"RegressionTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.regression,n=e.on,r=Ice(e,["regression","on"]);var i=__assign({type:"regression",x:n,y:t},r);return i};return t}(mre);var Qse=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.addDimensions=function(e){var t;this.transform.groupby=t1(((t=this.transform.groupby)!==null&&t!==void 0?t:[]).concat(e),(function(e){return e}))};t.prototype.producedFields=function(){return undefined};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.pivot,this.transform.value],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.hash=function(){return"PivotTransform "+Y0(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.pivot,n=e.value,r=e.groupby,i=e.limit,a=e.op;return __assign(__assign(__assign({type:"pivot",field:t,value:n},i!==undefined?{limit:i}:{}),a!==undefined?{op:a}:{}),r!==undefined?{groupby:r}:{})};return t}(mre);var Zse=function(e){R(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,H0(this.transform))};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return new Set};t.prototype.hash=function(){return"SampleTransform "+Y0(this.transform)};t.prototype.assemble=function(){return{type:"sample",size:this.transform.sample}};return t}(mre);function Kse(e){var t=0;function n(r,i){var a,o,u;var s;if(r instanceof eue){if(!r.isGenerator&&!ere(r.data)){e.push(i);var l={name:null,source:i.name,transform:[]};i=l}}if(r instanceof Joe){if(r.parent instanceof eue&&!i.source){i.format=__assign(__assign({},(s=i.format)!==null&&s!==void 0?s:{}),{parse:r.assembleFormatParse()});(a=i.transform).push.apply(a,r.assembleTransforms(true))}else{(o=i.transform).push.apply(o,r.assembleTransforms())}}if(r instanceof Hoe){if(!i.name){i.name="data_"+t++}if(!i.source||i.transform.length>0){e.push(i);r.data=i.name}else{r.data=i.source}e.push.apply(e,r.assemble());return}if(r instanceof Zoe||r instanceof Koe||r instanceof Use||r instanceof Hie||r instanceof _ae||r instanceof Gse||r instanceof Woe||r instanceof Yse||r instanceof kue||r instanceof _ue||r instanceof Wse||r instanceof qse||r instanceof Ise||r instanceof Vse||r instanceof Xse||r instanceof Jse||r instanceof Qoe||r instanceof Zse||r instanceof Qse){i.transform.push(r.assemble())}if(r instanceof Ioe||r instanceof _re||r instanceof $se||r instanceof wue||r instanceof Hse){(u=i.transform).push.apply(u,r.assemble())}if(r instanceof yre){if(i.source&&i.transform.length===0){r.setSource(i.source)}else if(r.parent instanceof yre){r.setSource(i.name)}else{if(!i.name){i.name="data_"+t++}r.setSource(i.name);if(r.numChildren()===1){e.push(i);var l={name:null,source:i.name,transform:[]};i=l}}}switch(r.numChildren()){case 0:if(r instanceof yre&&(!i.source||i.transform.length>0)){e.push(i)}break;case 1:n(r.children[0],i);break;default:{if(!i.name){i.name="data_"+t++}var f=i.name;if(!i.source||i.transform.length>0){e.push(i)}else{f=i.source}for(var c=0,d=r.children;c<d.length;c++){var h=d[c];var l={name:null,source:f,transform:[]};n(h,l)}break}}}return n}function ele(e){var t=[];var n=Kse(t);for(var r=0,i=e.children;r<i.length;r++){var a=i[r];n(a,{source:e.name,name:null,transform:[]})}return t}function tle(e,t){var n,r;var i=[];var a=Kse(i);var o=0;for(var u=0,s=e.sources;u<s.length;u++){var l=s[u];if(!l.hasName()){l.dataName="source_"+o++}var f=l.assemble();a(l,f)}for(var c=0,d=i;c<d.length;c++){var h=d[c];if(h.transform.length===0){delete h.transform}}var v=0;for(var p=0,g=i.entries();p<g.length;p++){var m=g[p],y=m[0],h=m[1];if(((n=h.transform)!==null&&n!==void 0?n:[]).length===0&&!h.source){i.splice(v++,0,i.splice(y,1)[0])}}for(var _=0,b=i;_<b.length;_++){var h=b[_];for(var x=0,w=(r=h.transform)!==null&&r!==void 0?r:[];x<w.length;x++){var k=w[x];if(k.type==="lookup"){k.from=e.outputNodes[k.from].getSource()}}}for(var A=0,E=i;A<E.length;A++){var h=E[A];if(h.name in t){h.values=t[h.name]}}return i}function nle(e){if(e==="top"||e==="left"||X3(e)){return"header"}return"footer"}function rle(e){for(var t=0,n=x2;t<n.length;t++){var r=n[t];ile(e,r)}ole(e,"x");ole(e,"y")}function ile(e,t){var n;var r;var i=e.facet,a=e.config,o=e.child,u=e.component;if(e.channelHasField(t)){var s=i[t];var l=wae("title",null,a,t);var f=m7(s,a,{allowDisabling:true,includeDefault:l===undefined||!!l});if(o.component.layoutHeaders[t].title){f=Rr(f)?f.join(", "):f;f+=" / "+o.component.layoutHeaders[t].title;o.component.layoutHeaders[t].title=null}var c=wae("labelOrient",s.header,a,t);var d=s.header!==null?k1((r=s.header)===null||r===void 0?void 0:r.labels,a.header.labels,true):false;var h=J0(["bottom","right"],c)?"footer":"header";u.layoutHeaders[t]=(n={title:s.header!==null?f:null,facetFieldDef:s},n[h]=t==="facet"?[]:[ale(e,t,d)],n)}}function ale(e,t,n){var r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):undefined,axes:[]}}function ole(e,t){var n;var r=e.child;if(r.component.axes[t]){var i=e.component,a=i.layoutHeaders,o=i.resolve;o.axis[t]=Hae(o,t);if(o.axis[t]==="shared"){var u=t==="x"?"column":"row";var s=a[u];for(var l=0,f=r.component.axes[t];l<f.length;l++){var c=f[l];var d=nle(c.get("orient"));(n=s[d])!==null&&n!==void 0?n:s[d]=[ale(e,u,false)];var h=Zie(c,"main",e.config,{header:true});if(h){s[d][0].axes.push(h)}c.mainExtracted=true}}}}function ule(e){lle(e);fle(e,"width");fle(e,"height")}function sle(e){lle(e);var t=e.layout.columns===1?"width":"childWidth";var n=e.layout.columns===undefined?"height":"childHeight";fle(e,t);fle(e,n)}function lle(e){for(var t=0,n=e.children;t<n.length;t++){var r=n[t];r.parseLayoutSize()}}function fle(e,t){var n;var r=Uae(t);var i=o3(r);var a=e.component.resolve;var o=e.component.layoutSize;var u;for(var s=0,l=e.children;s<l.length;s++){var f=l[s];var c=f.component.layoutSize.getWithExplicit(r);var d=(n=a.scale[i])!==null&&n!==void 0?n:Wae(i,e);if(d==="independent"&&c.value==="step"){u=undefined;break}if(u){if(d==="independent"&&u.value!==c.value){u=undefined;break}u=Zne(u,c,r,"")}else{u=c}}if(u){for(var h=0,v=e.children;h<v.length;h++){var f=v[h];e.renameSignal(f.getName(r),e.getName(t));f.component.layoutSize.set(r,"merged",false)}o.setWithExplicit(t,u)}else{o.setWithExplicit(t,{explicit:false,value:undefined})}}function cle(e){var t=e.size,n=e.component;for(var r=0,i=n3;r<i.length;r++){var a=i[r];var o=B2(a);if(t[o]){var u=t[o];n.layoutSize.set(o,nte(u)?"step":u,true)}else{var s=dle(e,o);n.layoutSize.set(o,s,false)}}}function dle(e,t){var n=t==="width"?"x":"y";var r=e.config;var i=e.getScaleComponent(n);if(i){var a=i.get("type");var o=i.get("range");if(n8(a)){var u=fte(r.view,t);if(J3(o)||nte(u)){return"step"}else{return u}}else{return ste(r.view,t)}}else if(e.hasProjection||e.mark==="arc"){return ste(r.view,t)}else{var u=fte(r.view,t);return nte(u)?u.step:u}}function hle(e,t,n){return u7(t,__assign({suffix:"by_"+u7(e)},n!==null&&n!==void 0?n:{}))}var vle=function(e){R(t,e);function t(t,n,r,i){var a=e.call(this,t,"facet",n,r,i,t.resolve)||this;a.child=yfe(t.spec,a,a.getName("child"),undefined,i);a.children=[a.child];a.facet=a.initFacet(t.facet);return a}t.prototype.initFacet=function(e){if(!T9(e)){return{facet:this.initFacetFieldDef(e,"facet")}}var t=s1(e);var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];if(![O1,N1].includes(a)){G6(n6(a,"facet"));break}var o=e[a];if(o.field===undefined){G6(e6(o,a));break}n[a]=this.initFacetFieldDef(o,a)}return n};t.prototype.initFacetFieldDef=function(e,t){var n=S7(e,t);if(n.header){n.header=$3(n.header)}else if(n.header===null){n.header=null}return n};t.prototype.channelHasField=function(e){return!!this.facet[e]};t.prototype.fieldDef=function(e){return this.facet[e]};t.prototype.parseData=function(){this.component.data=_le(this);this.child.parseData()};t.prototype.parseLayoutSize=function(){lle(this)};t.prototype.parseSelections=function(){this.child.parseSelections();this.component.selection=this.child.component.selection};t.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()};t.prototype.parseAxesAndHeaders=function(){this.child.parseAxesAndHeaders();rle(this)};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)};t.prototype.assembleSignals=function(){this.child.assembleSignals();return[]};t.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)};t.prototype.getHeaderLayoutMixins=function(){var e,t,n;var r={};for(var i=0,a=x2;i<a.length;i++){var o=a[i];for(var u=0,s=Eae;u<s.length;u++){var l=s[u];var f=this.component.layoutHeaders[o];var c=f[l];var d=f.facetFieldDef;if(d){var h=wae("titleOrient",d.header,this.config,o);if(["right","bottom"].includes(h)){var v=xae(o,h);(e=r.titleAnchor)!==null&&e!==void 0?e:r.titleAnchor={};r.titleAnchor[v]="end"}}if(c===null||c===void 0?void 0:c[0]){var p=o==="row"?"height":"width";var g=l==="header"?"headerBand":"footerBand";if(o!=="facet"&&!this.child.component.layoutSize.get(p)){(t=r[g])!==null&&t!==void 0?t:r[g]={};r[g][o]=.5}if(f.title){(n=r.offset)!==null&&n!==void 0?n:r.offset={};r.offset[o==="row"?"rowTitle":"columnTitle"]=10}}}}return r};t.prototype.assembleDefaultLayout=function(){var e=this.facet,t=e.column,n=e.row;var r=t?this.columnDistinctSignal():n?1:undefined;var i="all";if(!n&&this.component.resolve.scale.x==="independent"){i="none"}else if(!t&&this.component.resolve.scale.y==="independent"){i="none"}return __assign(__assign(__assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})};t.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()};t.prototype.columnDistinctSignal=function(){if(this.parent&&this.parent instanceof t){return undefined}else{var e=this.getName("column_domain");return{signal:"length(data('"+e+"'))"}}};t.prototype.assembleGroup=function(n){if(this.parent&&this.parent instanceof t){return __assign(__assign({},this.channelHasField("column")?{encode:{update:{columns:{field:u7(this.facet.column,{prefix:"distinct"})}}}}:{}),e.prototype.assembleGroup.call(this,n))}return e.prototype.assembleGroup.call(this,n)};t.prototype.getCardinalityAggregateForChild=function(){var e=[];var n=[];var r=[];if(this.child instanceof t){if(this.child.channelHasField("column")){var i=u7(this.child.facet.column);e.push(i);n.push("distinct");r.push("distinct_"+i)}}else{for(var a=0,o=n3;a<o.length;a++){var u=o[a];var s=this.child.component.scales[u];if(s&&!s.merged){var l=s.get("type");var f=s.get("range");if(n8(l)&&J3(f)){var c=Xue(this.child,u);var d=Yue(c);if(d){e.push(d);n.push("distinct");r.push("distinct_"+d)}else{G6(E5(u))}}}}}return{fields:e,ops:n,as:r}};t.prototype.assembleFacet=function(){var e=this.component.data.facetRoot,t=e.name,n=e.data;var r=this.facet,i=r.row,a=r.column;var o=this.getCardinalityAggregateForChild(),u=o.fields,s=o.ops,l=o.as;var f=[];for(var c=0,d=x2;c<d.length;c++){var h=d[c];var v=this.facet[h];if(v){f.push(u7(v));var p=v.bin,g=v.sort;if(I3(p)){f.push(u7(v,{binSuffix:"end"}))}if(O9(g)){var m=g.field,y=g.op,_=y===void 0?S9:y;var b=hle(v,g);if(i&&a){u.push(b);s.push("max");l.push(b)}else{u.push(m);s.push(_);l.push(b)}}else if(Rr(g)){var b=bae(v,h);u.push(b);s.push("max");l.push(b)}}}var x=!!i&&!!a;return __assign({name:t,data:n,groupby:f},x||u.length>0?{aggregate:__assign(__assign({},x?{cross:x}:{}),u.length?{fields:u,ops:s,as:l}:{})}:{})};t.prototype.facetSortFields=function(e){var t=this.facet;var n=t[e];if(n){if(O9(n.sort)){return[hle(n,n.sort,{expr:"datum"})]}else if(Rr(n.sort)){return[bae(n,e,{expr:"datum"})]}return[u7(n,{expr:"datum"})]}return[]};t.prototype.facetSortOrder=function(e){var t=this.facet;var n=t[e];if(n){var r=n.sort;var i=(O9(r)?r.order:!Rr(r)&&r)||"ascending";return[i]}return[]};t.prototype.assembleLabelTitle=function(){var e;var t=this,n=t.facet,r=t.config;if(n.facet){return Oae(n.facet,"facet",r)}var i={row:["top","bottom"],column:["left","right"]};for(var a=0,o=Aae;a<o.length;a++){var u=o[a];if(n[u]){var s=wae("labelOrient",(e=n[u])===null||e===void 0?void 0:e.header,r,u);if(i[u].includes(s)){return Oae(n[u],u,r)}}}return undefined};t.prototype.assembleMarks=function(){var e=this;var t=this.child;var n=this.component.data.facetRoot;var r=ele(n);var i=t.assembleGroupEncodeEntry(false);var a=this.assembleLabelTitle()||t.assembleTitle();var o=t.assembleGroupStyle();var u=__assign(__assign(__assign(__assign(__assign(__assign({name:this.getName("cell"),type:"group"},a?{title:a}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:x2.map((function(t){return e.facetSortFields(t)})).flat(),order:x2.map((function(t){return e.facetSortOrder(t)})).flat()}}),r.length>0?{data:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup(fre(this,[])));return[u]};t.prototype.getMapping=function(){return this.facet};return t}(Bse);function ple(e,t){var n=t.row,r=t.column;if(n&&r){var i=null;for(var a=0,o=[n,r];a<o.length;a++){var u=o[a];if(O9(u.sort)){var s=u.sort,l=s.field,f=s.op,c=f===void 0?S9:f;e=i=new _ue(e,{joinaggregate:[{op:c,field:l,as:hle(u,u.sort,{forAs:true})}],groupby:[u7(u)]})}}return i}return null}function gle(e,t){var n,r,i,a;for(var o=0,u=t;o<u.length;o++){var s=u[o];var l=s.data;if(e.name&&s.hasName()&&e.name!==s.dataName){continue}var f=(n=e["format"])===null||n===void 0?void 0:n.mesh;var c=(r=l.format)===null||r===void 0?void 0:r.feature;if(f&&c){continue}var d=(i=e["format"])===null||i===void 0?void 0:i.feature;if((d||c)&&d!==c){continue}var h=(a=l.format)===null||a===void 0?void 0:a.mesh;if((f||h)&&f!==h){continue}if(tre(e)&&tre(l)){if(W0(e.values,l.values)){return s}}else if(ere(e)&&ere(l)){if(e.url===l.url){return s}}else if(nre(e)){if(e.name===s.dataName){return s}}}return null}function mle(e,t){if(e.data||!e.parent){if(e.data===null){var n=new eue({values:[]});t.push(n);return n}var r=gle(e.data,t);if(r){if(!rre(e.data)){r.data.format=K0({},e.data.format,r.data.format)}if(!r.hasName()&&e.data.name){r.dataName=e.data.name}return r}else{var i=new eue(e.data);t.push(i);return i}}else{return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}}function yle(e,t,n){var r;var i,a;var o=0;for(var u=0,s=t.transforms;u<s.length;u++){var l=s[u];var f=undefined;var c=void 0;if(mne(l)){c=e=new _ae(e,l);f="derived"}else if(rne(l)){var d=Voe(l);c=e=(i=Joe.makeWithAncestors(e,{},d,n))!==null&&i!==void 0?i:e;e=new Hie(e,t,l.filter)}else if(yne(l)){c=e=Ioe.makeFromTransform(e,l,t);f="number"}else if(bne(l)){f="date";var h=n.getWithExplicit(l.field);if(h.value===undefined){e=new Joe(e,(r={},r[l.field]=f,r));n.set(l.field,f,false)}c=e=_re.makeFromTransform(e,l)}else if(xne(l)){c=e=Woe.makeFromTransform(e,l);f="number";if(Bie(t)){e=new Qoe(e)}}else if(ane(l)){c=e=Yse.make(e,t,l,o++);f="derived"}else if(vne(l)){c=e=new kue(e,l);f="number"}else if(pne(l)){c=e=new _ue(e,l);f="number"}else if(wne(l)){c=e=wue.makeFromTransform(e,l);f="derived"}else if(kne(l)){c=e=new Wse(e,l);f="derived"}else if(gne(l)){c=e=new qse(e,l);f="derived"}else if(sne(l)){c=e=new Qse(e,l);f="derived"}else if(hne(l)){e=new Zse(e,l)}else if(_ne(l)){c=e=$se.makeFromTransform(e,l);f="derived"}else if(lne(l)){c=e=new Ise(e,l);f="derived"}else if(fne(l)){c=e=new Xse(e,l);f="derived"}else if(cne(l)){c=e=new Jse(e,l);f="derived"}else if(dne(l)){c=e=new Vse(e,l);f="derived"}else{G6(W5(l));continue}if(c&&f!==undefined){for(var v=0,p=(a=c.producedFields())!==null&&a!==void 0?a:[];v<p.length;v++){var g=p[v];n.set(g,f,false)}}}return e}function _le(e){var t,n,r,i,a,o,u,s,l,f;var c=mle(e,e.component.data.sources);var d=e.component.data,h=d.outputNodes,v=d.outputNodeRefCounts;var p=e.parent?e.parent.component.data.ancestorParse.clone():new Kne;var g=e.data;if(rre(g)){if(ire(g)){c=new Koe(c,g.sequence)}else if(ore(g)){c=new Zoe(c,g.graticule)}p.parseNothing=true}else if(((t=g===null||g===void 0?void 0:g.format)===null||t===void 0?void 0:t.parse)===null){p.parseNothing=true}c=(n=Joe.makeExplicit(c,e,p))!==null&&n!==void 0?n:c;c=new Qoe(c);var m=e.parent&&Lse(e.parent);if(zse(e)||Rse(e)){if(m){c=(r=Ioe.makeFromEncoding(c,e))!==null&&r!==void 0?r:c}}if(e.transforms.length>0){c=yle(c,e,p)}var y=Xoe(e);var _=Yoe(e);c=(i=Joe.makeWithAncestors(c,{},__assign(__assign({},y),_),p))!==null&&i!==void 0?i:c;if(zse(e)){c=Hse.parseAll(c,e);c=Gse.parseAll(c,e)}if(zse(e)||Rse(e)){if(!m){c=(a=Ioe.makeFromEncoding(c,e))!==null&&a!==void 0?a:c}c=(o=_re.makeFromEncoding(c,e))!==null&&o!==void 0?o:c;c=_ae.parseAllForSortIndex(c,e)}var b=e.getDataName(ure.Raw);var x=new yre(c,b,ure.Raw,v);h[b]=x;c=x;if(zse(e)){var w=Woe.makeFromEncoding(c,e);if(w){c=w;if(Bie(e)){c=new Qoe(c)}}c=(u=$se.makeFromEncoding(c,e))!==null&&u!==void 0?u:c;c=(s=wue.makeFromEncoding(c,e))!==null&&s!==void 0?s:c}if(zse(e)){c=(l=Use.make(c,e))!==null&&l!==void 0?l:c}var k=e.getDataName(ure.Main);var A=new yre(c,k,ure.Main,v);h[k]=A;c=A;if(zse(e)){Yie(e,A)}var E=null;if(Rse(e)){var D=e.getName("facet");c=(f=ple(c,e.facet))!==null&&f!==void 0?f:c;E=new Hoe(c,e,D,A.getSource());h[D]=E}return __assign(__assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:v,raw:x,main:A,facetRoot:E,ancestorParse:p})}var ble=function(e){R(t,e);function t(t,n,r,i){var a,o,u,s;var l=e.call(this,t,"concat",n,r,i,t.resolve)||this;if(((o=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||o===void 0?void 0:o.x)==="shared"||((s=(u=t.resolve)===null||u===void 0?void 0:u.axis)===null||s===void 0?void 0:s.y)==="shared"){G6(B5)}l.children=l.getChildren(t).map((function(e,t){return yfe(e,l,l.getName("concat_"+t),undefined,i)}));return l}t.prototype.parseData=function(){this.component.data=_le(this);for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseData()}};t.prototype.parseSelections=function(){this.component.selection={};for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseSelections();for(var r=0,i=s1(n.component.selection);r<i.length;r++){var a=i[r];this.component.selection[a]=n.component.selection[a]}}};t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseMarkGroup()}};t.prototype.parseAxesAndHeaders=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseAxesAndHeaders()}};t.prototype.getChildren=function(e){if(ete(e)){return e.vconcat}else if(tte(e)){return e.hconcat}return e.concat};t.prototype.parseLayoutSize=function(){sle(this)};t.prototype.parseAxisGroup=function(){return null};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce((function(e,t){return t.assembleSelectionTopLevelSignals(e)}),e)};t.prototype.assembleSignals=function(){this.children.forEach((function(e){return e.assembleSignals()}));return[]};t.prototype.assembleLayoutSignals=function(){var e=Lae(this);for(var t=0,n=this.children;t<n.length;t++){var r=n[t];e.push.apply(e,r.assembleLayoutSignals())}return e};t.prototype.assembleSelectionData=function(e){return this.children.reduce((function(e,t){return t.assembleSelectionData(e)}),e)};t.prototype.assembleMarks=function(){return this.children.map((function(e){var t=e.assembleTitle();var n=e.assembleGroupStyle();var r=e.assembleGroupEncodeEntry(false);return __assign(__assign(__assign(__assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))};t.prototype.assembleDefaultLayout=function(){var e=this.layout.columns;return __assign(__assign({},e!=null?{columns:e}:{}),{bounds:"full",align:"each"})};return t}(jse);function xle(e){return e===false||e===null}var wle=__assign(__assign({disable:1,gridScale:1,scale:1},I7),{labelExpr:1,encode:1});var kle=s1(wle);var Ale=function(e){R(t,e);function t(t,n,r){if(t===void 0){t={}}if(n===void 0){n={}}if(r===void 0){r=false}var i=e.call(this)||this;i.explicit=t;i.implicit=n;i.mainExtracted=r;return i}t.prototype.clone=function(){return new t(H0(this.explicit),H0(this.implicit),this.mainExtracted)};t.prototype.hasAxisPart=function(e){if(e==="axis"){return true}if(e==="grid"||e==="title"){return!!this.get(e)}return!xle(this.get(e))};t.prototype.hasOrientSignalRef=function(){return X3(this.explicit.orient)};return t}(Vne);function Ele(e,t,n){var r;var i=e.encoding,a=e.config;var o=(r=k7(i[t]))!==null&&r!==void 0?r:k7(i[j2(t)]);var u=e.axis(t)||{};var s=u.format,l=u.formatType;if(h9(l)){return __assign({text:y9({fieldOrDatumDef:o,field:"datum.value",format:s,formatType:l,config:a})},n)}return n}function Dle(e){return n3.reduce((function(t,n){if(e.component.scales[n]){t[n]=[Tle(n,e)]}return t}),{})}var Sle={bottom:"top",top:"bottom",left:"right",right:"left"};function Cle(e){var t;var n=e.component,r=n.axes,i=n.resolve;var a={top:0,bottom:0,right:0,left:0};for(var o=0,u=e.children;o<u.length;o++){var s=u[o];s.parseAxesAndHeaders();for(var l=0,f=s1(s.component.axes);l<f.length;l++){var c=f[l];i.axis[c]=Hae(e.component.resolve,c);if(i.axis[c]==="shared"){r[c]=Mle(r[c],s.component.axes[c]);if(!r[c]){i.axis[c]="independent";delete r[c]}}}}for(var d=0,h=n3;d<h.length;d++){var c=h[d];for(var v=0,p=e.children;v<p.length;v++){var s=p[v];if(!s.component.axes[c]){continue}if(i.axis[c]==="independent"){r[c]=((t=r[c])!==null&&t!==void 0?t:[]).concat(s.component.axes[c]);for(var g=0,m=s.component.axes[c];g<m.length;g++){var y=m[g];var _=y.getWithExplicit("orient"),b=_.value,x=_.explicit;if(X3(b)){continue}if(a[b]>0&&!x){var w=Sle[b];if(a[b]>a[w]){y.set("orient",w,false)}}a[b]++}}delete s.component.axes[c]}if(i.axis[c]==="independent"&&r[c]&&r[c].length>1){for(var k=0,A=r[c];k<A.length;k++){var E=A[k];if(!!E.get("grid")&&!E.explicit.grid){E.implicit.grid=false}}}}}function Mle(e,t){if(e){if(e.length!==t.length){return undefined}var n=e.length;for(var r=0;r<n;r++){var i=e[r];var a=t[r];if(!!i!==!!a){return undefined}else if(i&&a){var o=i.getWithExplicit("orient");var u=a.getWithExplicit("orient");if(o.explicit&&u.explicit&&o.value!==u.value){return undefined}else{e[r]=Fle(i,a)}}}}else{return t.map((function(e){return e.clone()}))}return e}function Fle(e,t){var n=function(n){var r=Zne(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(function(e,t){switch(n){case"title":return _5(e,t);case"gridScale":return{explicit:e.explicit,value:k1(e.value,t.value)}}return Qne(e,t,n,"axis")}));e.setWithExplicit(n,r)};for(var r=0,i=kle;r<i.length;r++){var a=i[r];n(a)}return e}function Ole(e,t,n,r,i){if(t==="disable"){return n!==undefined}n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(X3(n.labelAngle)?n.labelAngle:M1(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===gae(r,i)){return true}}return e===n[t]}var Nle=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Tle(e,t){var n,r,i;var a=t.axis(e);var o=new Ale;var u=k7(t.encoding[e]);var s=t.mark,l=t.config;var f=(a===null||a===void 0?void 0:a.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((r=l.axis)===null||r===void 0?void 0:r.orient)||vae(e);var c=t.getScaleComponent(e).get("type");var d=nae(e,c,f,t.config);var h=a!==undefined?!a:iae("disable",l.style,a===null||a===void 0?void 0:a.style,d).configValue;o.set("disable",h,a!==undefined);if(h){return o}a=a||{};var v=sae(u,a,e,l.style,d);var p={fieldOrDatumDef:u,axis:a,channel:e,model:t,scaleType:c,orient:f,labelAngle:v,mark:s,config:l};for(var g=0,m=kle;g<m.length;g++){var y=m[g];var _=y in aae?aae[y](p):q7(y)?a[y]:undefined;var b=_!==undefined;var x=Ole(_,y,a,t,e);if(b&&x){o.set(y,_,x)}else{var w=q7(y)&&y!=="values"?iae(y,l.style,a.style,d):{},k=w.configValue,A=k===void 0?undefined:k,E=w.configFrom,D=E===void 0?undefined:E;var S=A!==undefined;if(b&&!S){o.set(y,_,x)}else if(!(D==="vgAxisConfig")||Nle.has(y)&&S||L7(A)||X3(A)){o.set(y,A,false)}}}var C=(i=a.encoding)!==null&&i!==void 0?i:{};var M=j7.reduce((function(n,r){var i;if(!o.hasAxisPart(r)){return n}var a=qae((i=C[r])!==null&&i!==void 0?i:{},t);var u=r==="labels"?Ele(t,e,a):a;if(u!==undefined&&!u1(u)){n[r]={update:u}}return n}),{});if(!u1(M)){o.set("encode",M,!!a.encoding||a.labelAngle!==undefined)}return o}function zle(e){var t=e.encoding,n=e.size;for(var r=0,i=n3;r<i.length;r++){var a=i[r];var o=B2(a);if(nte(n[o])){if(J9(t[a])){delete n[o];G6(b6(o))}}}return n}function Rle(e,t,n){var r=$3(e);var i=d5("orient",r,n);r.orient=Ble(r.type,t,i);if(i!==undefined&&i!==r.orient){G6(f6(r.orient,i))}if(r.type==="bar"&&r.orient){var a=d5("cornerRadiusEnd",r,n);if(a!==undefined){var o=r.orient==="horizontal"&&t.x2||r.orient==="vertical"&&t.y2?["cornerRadius"]:Z8[r.orient];for(var u=0,s=o;u<s.length;u++){var l=s[u];r[l]=a}if(r.cornerRadiusEnd!==undefined){delete r.cornerRadiusEnd}}}var f=d5("opacity",r,n);if(f===undefined){r.opacity=Lle(r.type,t)}var c=d5("cursor",r,n);if(c===undefined){r.cursor=Ple(r,t,n)}return r}function Ple(e,t,n){if(t.href||e.href||d5("href",e,n)){return"pointer"}return e.cursor}function Lle(e,t){if(J0([M8,T8,R8,P8],e)){if(!Y7(t)){return.7}}return undefined}function jle(e,t,n){var r=n.graticule;if(r){return false}var i=h5("filled",e,t);var a=e.type;return k1(i,a!==M8&&a!==C8&&a!==O8)}function Ble(e,t,n){switch(e){case M8:case R8:case P8:case N8:case F8:case S8:return undefined}var r=t.x,i=t.y,a=t.x2,o=t.y2;switch(e){case D8:if(V9(r)&&(U3(r.bin)||V9(i)&&i.aggregate&&!r.aggregate)){return"vertical"}if(V9(i)&&(U3(i.bin)||V9(r)&&r.aggregate&&!i.aggregate)){return"horizontal"}if(o||a){if(n){return n}if(!a){if(V9(r)&&r.type===z4&&!I3(r.bin)||Q9(r)){return"horizontal"}}if(!o){if(V9(i)&&i.type===z4&&!I3(i.bin)||Q9(i)){return"vertical"}}}case O8:if(a&&!(V9(r)&&U3(r.bin))&&o&&!(V9(i)&&U3(i.bin))){return undefined}case E8:if(o){if(V9(i)&&U3(i.bin)){return"horizontal"}else{return"vertical"}}else if(a){if(V9(r)&&U3(r.bin)){return"vertical"}else{return"horizontal"}}else if(e===O8){if(r&&!i){return"vertical"}else if(i&&!r){return"horizontal"}}case C8:case T8:{var u=J9(r);var s=J9(i);if(n){return n}else if(u&&!s){return e!=="tick"?"horizontal":"vertical"}else if(!u&&s){return e!=="tick"?"vertical":"horizontal"}else if(u&&s){var l=r;var f=i;var c=l.type===P4;var d=f.type===P4;if(c&&!d){return e!=="tick"?"vertical":"horizontal"}else if(!c&&d){return e!=="tick"?"horizontal":"vertical"}if(!l.aggregate&&f.aggregate){return e!=="tick"?"vertical":"horizontal"}else if(l.aggregate&&!f.aggregate){return e!=="tick"?"horizontal":"vertical"}return"vertical"}else{return undefined}}}return"vertical"}var Ile={vgMark:"arc",encodeEntry:function(e){return __assign(__assign(__assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Gre("x",e,{defaultPos:"mid"})),Gre("y",e,{defaultPos:"mid"})),nie(e,"radius","arc")),nie(e,"theta","arc"))}};var Ule={vgMark:"area",encodeEntry:function(e){return __assign(__assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),Qre("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),Qre("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),hie(e))}};var qle={vgMark:"rect",encodeEntry:function(e){return __assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),nie(e,"x","bar")),nie(e,"y","bar"))}};var Wle={vgMark:"shape",encodeEntry:function(e){return __assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}))},postEncodingTransform:function(e){var t=e.encoding;var n=t.shape;var r=__assign({type:"geoshape",projection:e.projectionName()},n&&V9(n)&&n.type===j4?{field:u7(n,{expr:"datum"})}:{});return[r]}};var Hle={vgMark:"image",encodeEntry:function(e){return __assign(__assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),nie(e,"x","image")),nie(e,"y","image")),Tre(e,"url"))}};var Gle={vgMark:"line",encodeEntry:function(e){return __assign(__assign(__assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Gre("x",e,{defaultPos:"mid"})),Gre("y",e,{defaultPos:"mid"})),Ure("size",e,{vgChannel:"strokeWidth"})),hie(e))}};var $le={vgMark:"trail",encodeEntry:function(e){return __assign(__assign(__assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Gre("x",e,{defaultPos:"mid"})),Gre("y",e,{defaultPos:"mid"})),Ure("size",e)),hie(e))}};function Vle(e,t){var n=e.config;return __assign(__assign(__assign(__assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Gre("x",e,{defaultPos:"mid"})),Gre("y",e,{defaultPos:"mid"})),Ure("size",e)),Ure("angle",e)),Yle(e,n,t))}function Yle(e,t,n){if(n){return{shape:{value:n}}}return Ure("shape",e)}var Xle={vgMark:"symbol",encodeEntry:function(e){return Vle(e)}};var Jle={vgMark:"symbol",encodeEntry:function(e){return Vle(e,"circle")}};var Qle={vgMark:"symbol",encodeEntry:function(e){return Vle(e,"square")}};var Zle={vgMark:"rect",encodeEntry:function(e){return __assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),nie(e,"x","rect")),nie(e,"y","rect"))}};var Kle={vgMark:"rule",encodeEntry:function(e){var t=e.markDef;var n=t.orient;if(!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude){return{}}return __assign(__assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Qre("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),Qre("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),Ure("size",e,{vgChannel:"strokeWidth"}))}};var efe={vgMark:"text",encodeEntry:function(e){var t=e.config,n=e.encoding;return __assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign({},lie(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Gre("x",e,{defaultPos:"mid"})),Gre("y",e,{defaultPos:"mid"})),Tre(e)),Ure("size",e,{vgChannel:"fontSize"})),Ure("angle",e)),pie("align",tfe(e.markDef,n,t))),pie("baseline",nfe(e.markDef,n,t))),Gre("radius",e,{defaultPos:null})),Gre("theta",e,{defaultPos:null}))}};function tfe(e,t,n){var r=d5("align",e,n);if(r===undefined){return"center"}return undefined}function nfe(e,t,n){var r=d5("baseline",e,n);if(r===undefined){return"middle"}return undefined}var rfe={vgMark:"rect",encodeEntry:function(e){var t;var n=e.config,r=e.markDef;var i=r.orient;var a=i==="horizontal"?"width":"height";var o=i==="horizontal"?"height":"width";return __assign(__assign(__assign(__assign(__assign({},lie(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Gre("x",e,{defaultPos:"mid",vgChannel:"xc"})),Gre("y",e,{defaultPos:"mid",vgChannel:"yc"})),Ure("size",e,{defaultValue:ife(e),vgChannel:a})),(t={},t[o]=u5(d5("thickness",r,n)),t))}};function ife(e){var t;var n=e.config,r=e.markDef;var i=r.orient;var a=i==="horizontal"?"width":"height";var o=e.getScaleComponent(i==="horizontal"?"x":"y");var u=(t=d5("size",r,n,{vgChannel:a}))!==null&&t!==void 0?t:n.tick.bandSize;if(u!==undefined){return u}else{var s=o?o.get("range"):undefined;if(s&&J3(s)&&Fi(s.step)){return s.step*3/4}var l=lte(n.view,a);return l*3/4}}var afe={arc:Ile,area:Ule,bar:qle,circle:Jle,geoshape:Wle,image:Hle,line:Gle,point:Xle,rect:Zle,rule:Kle,square:Qle,text:efe,tick:rfe,trail:$le};function ofe(e){if(J0([C8,E8,z8],e.mark)){var t=nee(e.mark,e.encoding);if(t.length>0){return sfe(e,t)}}else if(e.mark===D8){var n=r5.some((function(t){return d5(t,e.markDef,e.config)}));if(e.stack&&!e.fieldDef("size")&&n){return ffe(e)}}return dfe(e)}var ufe="faceted_path_";function sfe(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:ufe+e.requestDataName(ure.Main),data:e.requestDataName(ure.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:dfe(e,{fromPrefix:ufe})}]}var lfe="stack_group_";function ffe(e){var t=dfe(e,{fromPrefix:lfe})[0];var n=e.scaleName(e.stack.fieldChannel);var r=function(t){if(t===void 0){t={}}return e.vgField(e.stack.fieldChannel,t)};var i=function(e,t){var i=[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})];return e+"("+i.map((function(e){return"scale('"+n+"',"+e+")"})).join(",")+")"};var a;var o;if(e.stack.fieldChannel==="x"){a=__assign(__assign({},G0(t.encode.update,__spreadArray(["y","yc","y2","height"],r5))),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:true}});o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}};t.encode.update=__assign(__assign({},$0(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})}else{a=__assign(__assign({},G0(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:true}});o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}};t.encode.update=__assign(__assign({},$0(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}})}for(var u=0,s=r5;u<s.length;u++){var l=s[u];var f=h5(l,e.markDef,e.config);if(t.encode.update[l]){a[l]=t.encode.update[l];delete t.encode.update[l]}else if(f){a[l]=u5(f)}if(f){t.encode.update[l]={value:0}}}var c=[];if(e.stack.groupbyChannel){var d=e.fieldDef(e.stack.groupbyChannel);var h=u7(d);if(h){c.push(h)}if((d===null||d===void 0?void 0:d.bin)||(d===null||d===void 0?void 0:d.timeUnit)){c.push(u7(d,{binSuffix:"end"}))}}var v=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];a=v.reduce((function(n,r){var i,a;if(t.encode.update[r]){return __assign(__assign({},n),(i={},i[r]=t.encode.update[r],i))}else{var o=h5(r,e.markDef,e.config);if(o!==undefined){return __assign(__assign({},n),(a={},a[r]=u5(o),a))}else{return n}}}),a);if(a.stroke){a.strokeForeground={value:true};a.strokeOffset={value:0}}return[{type:"group",from:{facet:{data:e.requestDataName(ure.Main),name:lfe+e.requestDataName(ure.Main),groupby:c,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function cfe(e){var t=e.encoding,n=e.stack,r=e.mark,i=e.markDef,a=e.config;var o=t.order;if(!Rr(o)&&e7(o)&&X0(o.value)||!o&&X0(d5("order",i,a))){return undefined}else if((Rr(o)||V9(o))&&!n){return g5(o,{expr:"datum"})}else if(j8(r)){var u=i.orient==="horizontal"?"y":"x";var s=t[u];if(V9(s)){var l=s.sort;if(Rr(l)){return{field:u7(s,{prefix:u,suffix:"sort_index",expr:"datum"})}}else if(O9(l)){return{field:u7({aggregate:Y7(e.encoding)?l.op:undefined,field:l.field},{expr:"datum"})}}else if(F9(l)){var f=e.fieldDef(l.encoding);return{field:u7(f,{expr:"datum"}),order:l.order}}else if(l===null){return undefined}else{return{field:u7(s,{binSuffix:e.stack&&e.stack.impute?"mid":undefined,expr:"datum"})}}}return undefined}return undefined}function dfe(e,t){if(t===void 0){t={fromPrefix:""}}var n=e.mark,r=e.markDef,i=e.encoding,a=e.config;var o=k1(r.clip,hfe(e),vfe(e));var u=c5(r);var s=i.key;var l=cfe(e);var f=pfe(e);var c=d5("aria",r,a);var d=afe[n].postEncodingTransform?afe[n].postEncodingTransform(e):null;return[__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign({name:e.getName("marks"),type:afe[n].vgMark},o?{clip:true}:{}),u?{style:u}:{}),s?{key:s.field}:{}),l?{sort:l}:{}),f?f:{}),c===false?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(ure.Main)},encode:{update:afe[n].encodeEntry(e)}}),d?{transform:d}:{})]}function hfe(e){var t=e.getScaleComponent("x");var n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?true:undefined}function vfe(e){var t=e.component.projection;return t&&!t.isFit?true:undefined}function pfe(e){if(!e.component.selection)return null;var t=s1(e.component.selection).length;var n=t;var r=e.parent;while(r&&n===0){n=s1(r.component.selection).length;r=r.parent}return n?{interactive:t>0||!!e.encoding.tooltip}:null}var gfe=function(e){R(t,e);function t(t,n,r,i,a){if(i===void 0){i={}}var o;var u=e.call(this,t,"unit",n,r,a,undefined,rte(t)?t.view:undefined)||this;u.specifiedScales={};u.specifiedAxes={};u.specifiedLegends={};u.specifiedProjection={};u.selection=[];u.children=[];var s=U8(t.mark)?__assign({},t.mark):{type:t.mark};var l=s.type;if(s.filled===undefined){s.filled=jle(s,a,{graticule:t.data&&ore(t.data)})}var f=u.encoding=Q7(t.encoding||{},l,s.filled,a);u.markDef=Rle(s,f,a);u.size=zle({encoding:f,size:rte(t)?__assign(__assign(__assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i});u.stack=Ite(l,f);u.specifiedScales=u.initScales(l,f);u.specifiedAxes=u.initAxes(f);u.specifiedLegends=u.initLegends(f);u.specifiedProjection=t.projection;u.selection=((o=t.params)!==null&&o!==void 0?o:[]).filter((function(e){return Jee(e)}));return u}Object.defineProperty(t.prototype,"hasProjection",{get:function(){var e=this.encoding;var t=this.mark===L8;var n=e&&m2.some((function(t){return Z9(e[t])}));return t||n},enumerable:false,configurable:true});t.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:undefined};t.prototype.axis=function(e){return this.specifiedAxes[e]};t.prototype.legend=function(e){return this.specifiedLegends[e]};t.prototype.initScales=function(e,t){var n=this;return b3.reduce((function(e,r){var i;var a=k7(t[r]);if(a){e[r]=n.initScale((i=a.scale)!==null&&i!==void 0?i:{})}return e}),{})};t.prototype.initScale=function(e){var t=e.domain,n=e.range;var r=$3(e);if(Rr(t)){r.domain=t.map(a5)}if(Rr(n)){r.range=n.map(a5)}return r};t.prototype.initAxes=function(e){var t=this;return n3.reduce((function(n,r){var i=e[r];if(Z9(i)||r===z1&&Z9(e.x2)||r===R1&&Z9(e.y2)){var a=Z9(i)?i.axis:undefined;n[r]=a?t.initAxis(__assign({},a)):a}return n}),{})};t.prototype.initAxis=function(e){var t=s1(e);var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];var o=e[a];n[a]=L7(o)?i5(o):a5(o)}return n};t.prototype.initLegends=function(e){return g3.reduce((function(t,n){var r=k7(e[n]);if(r&&y3(n)){var i=r.legend;t[n]=i?$3(i):i}return t}),{})};t.prototype.parseData=function(){this.component.data=_le(this)};t.prototype.parseLayoutSize=function(){cle(this)};t.prototype.parseSelections=function(){this.component.selection=Gie(this,this.selection)};t.prototype.parseMarkGroup=function(){this.component.mark=ofe(this)};t.prototype.parseAxesAndHeaders=function(){this.component.axes=Dle(this)};t.prototype.assembleSelectionTopLevelSignals=function(e){return cre(this,e)};t.prototype.assembleSignals=function(){return __spreadArray(__spreadArray([],Kie(this)),lre(this,[]))};t.prototype.assembleSelectionData=function(e){return dre(this,e)};t.prototype.assembleLayout=function(){return null};t.prototype.assembleLayoutSignals=function(){return Lae(this)};t.prototype.assembleMarks=function(){var e;var t=(e=this.component.mark)!==null&&e!==void 0?e:[];if(!this.parent||!Lse(this.parent)){t=hre(this,t)}return t.map(this.correctDataNames)};t.prototype.getMapping=function(){return this.encoding};Object.defineProperty(t.prototype,"mark",{get:function(){return this.markDef.type},enumerable:false,configurable:true});t.prototype.channelHasField=function(e){return V7(this.encoding,e)};t.prototype.fieldDef=function(e){var t=this.encoding[e];return w7(t)};t.prototype.typedFieldDef=function(e){var t=this.fieldDef(e);if(K9(t)){return t}return null};return t}(Bse);var mfe=function(e){R(t,e);function t(n,r,i,a,o){var u=e.call(this,n,"layer",r,i,o,n.resolve,n.view)||this;var s=__assign(__assign(__assign({},a),n.width?{width:n.width}:{}),n.height?{height:n.height}:{});u.children=n.layer.map((function(e,n){if(Fte(e)){return new t(e,u,u.getName("layer_"+n),s,o)}else if(G7(e)){return new gfe(e,u,u.getName("layer_"+n),s,o)}throw new Error(b5(e))}));return u}t.prototype.parseData=function(){this.component.data=_le(this);for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseData()}};t.prototype.parseLayoutSize=function(){ule(this)};t.prototype.parseSelections=function(){this.component.selection={};for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseSelections();for(var r=0,i=s1(n.component.selection);r<i.length;r++){var a=i[r];this.component.selection[a]=n.component.selection[a]}}};t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseMarkGroup()}};t.prototype.parseAxesAndHeaders=function(){Cle(this)};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce((function(e,t){return t.assembleSelectionTopLevelSignals(e)}),e)};t.prototype.assembleSignals=function(){return this.children.reduce((function(e,t){return e.concat(t.assembleSignals())}),Kie(this))};t.prototype.assembleLayoutSignals=function(){return this.children.reduce((function(e,t){return e.concat(t.assembleLayoutSignals())}),Lae(this))};t.prototype.assembleSelectionData=function(e){return this.children.reduce((function(e,t){return t.assembleSelectionData(e)}),e)};t.prototype.assembleTitle=function(){var t=e.prototype.assembleTitle.call(this);if(t){return t}for(var n=0,r=this.children;n<r.length;n++){var i=r[n];t=i.assembleTitle();if(t){return t}}return undefined};t.prototype.assembleLayout=function(){return null};t.prototype.assembleMarks=function(){return vre(this,this.children.flatMap((function(e){return e.assembleMarks()})))};t.prototype.assembleLegends=function(){return this.children.reduce((function(e,t){return e.concat(t.assembleLegends())}),woe(this))};return t}(jse);function yfe(e,t,n,r,i){if(R9(e)){return new vle(e,t,n,i)}else if(Fte(e)){return new mfe(e,t,n,r,i)}else if(G7(e)){return new gfe(e,t,n,r,i)}else if(Zee(e)){return new ble(e,t,n,i)}throw new Error(b5(e))}function _fe(e,t){if(t===void 0){t={}}if(t.logger){W6(t.logger)}if(t.fieldTitle){p7(t.fieldTitle)}try{var n=kte(jr(t.config,e.config));var r=Pne(e,n);var i=yfe(r,null,"",undefined,n);i.parse();Nue(i.component.data,i);var a=xfe(i,bfe(e,r.autosize,n,i),e.datasets,e.usermeta);return{spec:a,normalized:r}}finally{if(t.logger){H6()}if(t.fieldTitle){g7()}}}function bfe(e,t,n,r){var i=r.component.layoutSize.get("width");var a=r.component.layoutSize.get("height");if(t===undefined){t={type:"pad"};if(r.hasAxisOrientSignalRef()){t.resize=true}}else if(Ni(t)){t={type:t}}if(i&&a&&Wne(t.type)){if(i==="step"&&a==="step"){G6(A5());t.type="pad"}else if(i==="step"||a==="step"){var o=i==="step"?"width":"height";G6(A5(o3(o)));var u=o==="width"?"height":"width";t.type=Hne(u)}}return __assign(__assign(__assign({},s1(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),$ne(n,false)),$ne(e,true))}function xfe(e,t,n,r){if(n===void 0){n={}}var i=e.config?Ste(e.config):undefined;var a=[].concat(e.assembleSelectionData([]),tle(e.component.data,n));var o=e.assembleProjections();var u=e.assembleTitle();var s=e.assembleGroupStyle();var l=e.assembleGroupEncodeEntry(true);var f=e.assembleLayoutSignals();f=f.filter((function(e){if((e.name==="width"||e.name==="height")&&e.value!==undefined){t[e.name]=+e.value;return false}return true}));var c=t.params,d=Ice(t,["params"]);return __assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),u?{title:u}:{}),s?{style:s}:{}),l?{encode:{update:l}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup(__spreadArray(__spreadArray(__spreadArray([],f),e.assembleSelectionTopLevelSignals([])),Qee(c)))),i?{config:i}:{}),r?{usermeta:r}:{})}var wfe=z0.version;var kfe=Object.freeze({__proto__:null,version:wfe,compile:_fe,normalize:Pne,deepEqual:W0,duplicate:H0,pick:G0,omit:$0,stringify:V0,hash:Y0,isNullOrFalse:X0,contains:J0,some:Q0,every:Z0,mergeDeep:K0,unique:t1,isEqual:n1,setEqual:r1,hasIntersection:i1,prefixGenerator:a1,fieldIntersection:o1,isEmpty:u1,keys:s1,vals:l1,entries:f1,isBoolean:c1,varName:d1,logicalExpr:h1,deleteNestedProperty:v1,titleCase:p1,accessPathWithDatum:g1,flatAccessWithDatum:m1,replacePathInField:_1,replaceAll:b1,removePathFromField:x1,accessPathDepth:w1,getFirstDefined:k1,uniqueId:E1,resetIdCounter:D1,internalField:S1,isInternalField:C1,normalizeAngle:M1,isNumeric:F1});function Afe(e){var t=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3),n=t[0],r=t[1];return{library:n,version:r}}var Efe="vega-themes";var Dfe="2.10.0";var Sfe="Themes for stylized Vega and Vega-Lite visualizations.";var Cfe=["vega","vega-lite","themes","style"];var Mfe="BSD-3-Clause";var Ffe={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"};var Ofe=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}];var Nfe="build/vega-themes.js";var Tfe="build/vega-themes.module.js";var zfe="build/vega-themes.min.js";var Rfe="build/vega-themes.min.js";var Pfe="build/vega-themes.module.d.ts";var Lfe={type:"git",url:"https://github.com/vega/vega-themes.git"};var jfe=["src","build"];var Bfe={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",prepare:"beemo create-config",eslintbase:"beemo eslint .",format:"yarn eslintbase --fix",lint:"yarn eslintbase"};var Ife={"@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0","@wessberg/rollup-plugin-ts":"^1.3.8","browser-sync":"^2.26.14",concurrently:"^6.0.0","gh-pages":"^3.1.0",rollup:"^2.39.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-terser":"^7.0.2",typescript:"^4.2.2",vega:"^5.19.1","vega-lite":"^5.0.0","vega-lite-dev-config":"^0.16.1"};var Ufe={vega:"*","vega-lite":"*"};var qfe={name:Efe,version:Dfe,description:Sfe,keywords:Cfe,license:Mfe,author:Ffe,contributors:Ofe,main:Nfe,module:Tfe,unpkg:zfe,jsdelivr:Rfe,types:Pfe,repository:Lfe,files:jfe,scripts:Bfe,devDependencies:Ife,peerDependencies:Ufe};var Wfe="#fff";var Hfe="#888";var Gfe={background:"#333",title:{color:Wfe,subtitleColor:Wfe},style:{"guide-label":{fill:Wfe},"guide-title":{fill:Wfe}},axis:{domainColor:Wfe,gridColor:Hfe,tickColor:Wfe}};var $fe="#4572a7";var Vfe={background:"#fff",arc:{fill:$fe},area:{fill:$fe},line:{stroke:$fe,strokeWidth:2},path:{stroke:$fe},rect:{fill:$fe},shape:{stroke:$fe},symbol:{fill:$fe,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:true,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:false,tickExtra:true},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}};var Yfe="#30a2da";var Xfe="#cbcbcb";var Jfe="#999";var Qfe="#333";var Zfe="#f0f0f0";var Kfe="#333";var ece={arc:{fill:Yfe},area:{fill:Yfe},axis:{domainColor:Xfe,grid:true,gridColor:Xfe,gridWidth:1,labelColor:Jfe,labelFontSize:10,titleColor:Qfe,tickColor:Xfe,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:false},background:Zfe,group:{fill:Zfe},legend:{labelColor:Kfe,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:Kfe,titleFontSize:14,titlePadding:10},line:{stroke:Yfe,strokeWidth:2},path:{stroke:Yfe,strokeWidth:.5},rect:{fill:Yfe},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:true,shape:"circle"},shape:{stroke:Yfe},bar:{binSpacing:2,fill:Yfe,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}};var tce="#000";var nce={group:{fill:"#e5e5e5"},arc:{fill:tce},area:{fill:tce},line:{stroke:tce},path:{stroke:tce},rect:{fill:tce},shape:{stroke:tce},symbol:{fill:tce,size:40},axis:{domain:false,grid:true,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}};var rce=22;var ice="normal";var ace="Benton Gothic, sans-serif";var oce=11.5;var uce="normal";var sce="#82c6df";var lce="Benton Gothic Bold, sans-serif";var fce="normal";var cce=13;var dce={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]};var hce={background:"#ffffff",title:{anchor:"start",color:"#000000",font:lce,fontSize:rce,fontWeight:ice},arc:{fill:sce},area:{fill:sce},line:{stroke:sce,strokeWidth:2},path:{stroke:sce},rect:{fill:sce},shape:{stroke:sce},symbol:{fill:sce,size:30},axis:{labelFont:ace,labelFontSize:oce,labelFontWeight:uce,titleFont:lce,titleFontSize:cce,titleFontWeight:fce},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:ace,labelFontSize:oce,symbolType:"square",titleFont:lce,titleFontSize:cce,titleFontWeight:fce},range:{category:dce["category-6"],diverging:dce["fireandice-6"],heatmap:dce["fire-7"],ordinal:dce["fire-7"],ramp:dce["fire-7"]}};var vce="#ab5787";var pce="#979797";var gce={background:"#f9f9f9",arc:{fill:vce},area:{fill:vce},line:{stroke:vce},path:{stroke:vce},rect:{fill:vce},shape:{stroke:vce},symbol:{fill:vce,size:30},axis:{domainColor:pce,domainWidth:.5,gridWidth:.2,labelColor:pce,tickColor:pce,tickWidth:.2,titleColor:pce},axisBand:{grid:false},axisX:{grid:true,tickSize:10},axisY:{domain:false,grid:true,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}};var mce="#3e5c69";var yce={background:"#fff",arc:{fill:mce},area:{fill:mce},line:{stroke:mce},path:{stroke:mce},rect:{fill:mce},shape:{stroke:mce},symbol:{fill:mce},axis:{domainWidth:.5,grid:true,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:false},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}};var _ce="#1696d2";var bce="#000000";var xce="#FFFFFF";var wce="Lato";var kce="Lato";var Ace="Lato";var Ece="#DEDDDD";var Dce=18;var Sce={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]};var Cce={background:xce,title:{anchor:"start",fontSize:Dce,font:wce},axisX:{domain:true,domainColor:bce,domainWidth:1,grid:false,labelFontSize:12,labelFont:kce,labelAngle:0,tickColor:bce,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:wce},axisY:{domain:false,domainWidth:1,grid:true,gridColor:Ece,gridWidth:1,labelFontSize:12,labelFont:kce,labelPadding:8,ticks:false,titleFontSize:12,titlePadding:10,titleFont:wce,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:kce,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:wce,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Sce["six-groups-cat-1"],diverging:Sce["diverging-colors"],heatmap:Sce["diverging-colors"],ordinal:Sce["six-groups-seq"],ramp:Sce["shades-blue"]},area:{fill:_ce},rect:{fill:_ce},line:{color:_ce,stroke:_ce,strokeWidth:5},trail:{color:_ce,stroke:_ce,strokeWidth:0,size:1},path:{stroke:_ce,strokeWidth:.5},point:{filled:true},text:{font:Ace,color:_ce,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:_ce,stroke:null}},arc:{fill:_ce},shape:{stroke:_ce},symbol:{fill:_ce,size:30}};var Mce="#3366CC";var Fce="#ccc";var Oce="Arial, sans-serif";var Nce={arc:{fill:Mce},area:{fill:Mce},path:{stroke:Mce},rect:{fill:Mce},shape:{stroke:Mce},symbol:{stroke:Mce},circle:{fill:Mce},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:Oce,fontSize:12},"guide-title":{font:Oce,fontSize:12},"group-title":{font:Oce,fontSize:12}},title:{font:Oce,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:Fce,tickColor:Fce,domain:false,grid:true},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}};var Tce=qfe.version;var zce=Object.freeze({__proto__:null,dark:Gfe,excel:Vfe,fivethirtyeight:ece,ggplot2:nce,googlecharts:Nce,latimes:hce,quartz:gce,urbaninstitute:Cce,version:Tce,vox:yce});var Rce="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n";var Pce="vg-tooltip-element";var Lce={offsetX:10,offsetY:10,id:Pce,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:false,sanitize:jce,maxDepth:2};function jce(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function Bce(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e)){throw new Error("Invalid HTML ID")}return Rce.toString().replace(Pce,e)}
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */function Ice(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n}function Uce(e,t,n){if(Rr(e)){return"["+e.map((function(e){return t(Ni(e)?e:Wce(e,n))})).join(", ")+"]"}if(Pr(e)){var r="";var i=e,a=i.title,o=i.image,u=Ice(i,["title","image"]);if(a){r+="<h2>"+t(a)+"</h2>"}if(o){r+='<img src="'+t(o)+'">'}var s=Object.keys(u);if(s.length>0){r+="<table>";for(var l=0,f=s;l<f.length;l++){var c=f[l];var d=u[c];if(d===undefined){continue}if(Pr(d)){d=Wce(d,n)}r+='<tr><td class="key">'+t(c)+':</td><td class="value">'+t(d)+"</td></tr>"}r+="</table>"}return r||"{}"}return t(e)}function qce(e){var t=[];return function(n,r){if(typeof r!=="object"||r===null){return r}var i=t.indexOf(this)+1;t.length=i;if(t.length>e){return"[Object]"}if(t.indexOf(r)>=0){return"[Circular]"}t.push(r);return r}}function Wce(e,t){return JSON.stringify(e,qce(t))}function Hce(e,t,n,r){var i=e.clientX+n;if(i+t.width>window.innerWidth){i=+e.clientX-n-t.width}var a=e.clientY+r;if(a+t.height>window.innerHeight){a=+e.clientY-r-t.height}return{x:i,y:a}}var Gce=function(){function e(e){this.options=Object.assign(Object.assign({},Lce),e);var t=this.options.id;this.el=null;this.call=this.tooltipHandler.bind(this);if(!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){var n=document.createElement("style");n.setAttribute("id",this.options.styleId);n.innerHTML=Bce(t);var r=document.head;if(r.childNodes.length>0){r.insertBefore(n,r.childNodes[0])}else{r.appendChild(n)}}}e.prototype.tooltipHandler=function(e,t,n,r){this.el=document.getElementById(this.options.id);if(!this.el){this.el=document.createElement("div");this.el.setAttribute("id",this.options.id);this.el.classList.add("vg-tooltip");document.body.appendChild(this.el)}var i=document.fullscreenElement!=null?document.fullscreenElement:document.body;i.appendChild(this.el);if(r==null||r===""){this.el.classList.remove("visible",this.options.theme+"-theme");return}this.el.innerHTML=Uce(r,this.options.sanitize,this.options.maxDepth);this.el.classList.add("visible",this.options.theme+"-theme");var a=Hce(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY),o=a.x,u=a.y;this.el.setAttribute("style","top: "+u+"px; left: "+o+"px")};return e}();function $ce(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function Vce(e,t,n,r,i,a,o){try{var u=e[a](o);var s=u.value}catch(_r){n(_r);return}if(u.done){t(s)}else{Promise.resolve(s).then(r,i)}}function Yce(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Vce(a,r,i,o,u,"next",e)}function u(e){Vce(a,r,i,o,u,"throw",e)}o(undefined)}))}}var Xce=Object.prototype;var Jce=Xce.hasOwnProperty;var Qce;var Zce=typeof Symbol==="function"?Symbol:{};var Kce=Zce.iterator||"@@iterator";var ede=Zce.asyncIterator||"@@asyncIterator";var tde=Zce.toStringTag||"@@toStringTag";function nde(e,t,n,r){var i=t&&t.prototype instanceof lde?t:lde;var a=Object.create(i.prototype);var o=new Dde(r||[]);a._invoke=wde(e,n,o);return a}function rde(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}var ide="suspendedStart";var ade="suspendedYield";var ode="executing";var ude="completed";var sde={};function lde(){}function fde(){}function cde(){}var dde={};dde[Kce]=function(){return this};var hde=Object.getPrototypeOf;var vde=hde&&hde(hde(Cde([])));if(vde&&vde!==Xce&&Jce.call(vde,Kce)){dde=vde}var pde=cde.prototype=lde.prototype=Object.create(dde);fde.prototype=pde.constructor=cde;cde.constructor=fde;cde[tde]=fde.displayName="GeneratorFunction";function gde(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function mde(e){var t=typeof e==="function"&&e.constructor;return t?t===fde||(t.displayName||t.name)==="GeneratorFunction":false}function yde(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,cde)}else{e.__proto__=cde;if(!(tde in e)){e[tde]="GeneratorFunction"}}e.prototype=Object.create(pde);return e}function _de(e){return{__await:e}}function bde(e,t){function n(r,i,a,o){var u=rde(e[r],e,i);if(u.type==="throw"){o(u.arg)}else{var s=u.arg;var l=s.value;if(l&&typeof l==="object"&&Jce.call(l,"__await")){return t.resolve(l.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)}))}return t.resolve(l).then((function(e){s.value=e;a(s)}),(function(e){return n("throw",e,a,o)}))}}var r;function i(e,i){function a(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(a,a):a()}this._invoke=i}gde(bde.prototype);bde.prototype[ede]=function(){return this};function xde(e,t,n,r,i){if(i===void 0)i=Promise;var a=new bde(nde(e,t,n,r),i);return mde(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))}function wde(e,t,n){var r=ide;return function i(a,o){if(r===ode){throw new Error("Generator is already running")}if(r===ude){if(a==="throw"){throw o}return Mde()}n.method=a;n.arg=o;while(true){var u=n.delegate;if(u){var s=kde(u,n);if(s){if(s===sde)continue;return s}}if(n.method==="next"){n.sent=n._sent=n.arg}else if(n.method==="throw"){if(r===ide){r=ude;throw n.arg}n.dispatchException(n.arg)}else if(n.method==="return"){n.abrupt("return",n.arg)}r=ode;var l=rde(e,t,n);if(l.type==="normal"){r=n.done?ude:ade;if(l.arg===sde){continue}return{value:l.arg,done:n.done}}else if(l.type==="throw"){r=ude;n.method="throw";n.arg=l.arg}}}}function kde(e,t){var n=e.iterator[t.method];if(n===Qce){t.delegate=null;if(t.method==="throw"){if(e.iterator["return"]){t.method="return";t.arg=Qce;kde(e,t);if(t.method==="throw"){return sde}}t.method="throw";t.arg=new TypeError("The iterator does not provide a 'throw' method")}return sde}var r=rde(n,e.iterator,t.arg);if(r.type==="throw"){t.method="throw";t.arg=r.arg;t.delegate=null;return sde}var i=r.arg;if(!i){t.method="throw";t.arg=new TypeError("iterator result is not an object");t.delegate=null;return sde}if(i.done){t[e.resultName]=i.value;t.next=e.nextLoc;if(t.method!=="return"){t.method="next";t.arg=Qce}}else{return i}t.delegate=null;return sde}gde(pde);pde[tde]="Generator";pde[Kce]=function(){return this};pde.toString=function(){return"[object Generator]"};function Ade(e){var t={tryLoc:e[0]};if(1 in e){t.catchLoc=e[1]}if(2 in e){t.finallyLoc=e[2];t.afterLoc=e[3]}this.tryEntries.push(t)}function Ede(e){var t=e.completion||{};t.type="normal";delete t.arg;e.completion=t}function Dde(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(Ade,this);this.reset(true)}function Sde(e){var t=[];for(var n in e){t.push(n)}t.reverse();return function n(){while(t.length){var r=t.pop();if(r in e){n.value=r;n.done=false;return n}}n.done=true;return n}}function Cde(e){if(e){var t=e[Kce];if(t){return t.call(e)}if(typeof e.next==="function"){return e}if(!isNaN(e.length)){var n=-1,r=function t(){while(++n<e.length){if(Jce.call(e,n)){t.value=e[n];t.done=false;return t}}t.value=Qce;t.done=true;return t};return r.next=r}}return{next:Mde}}function Mde(){return{value:Qce,done:true}}Dde.prototype={constructor:Dde,reset:function e(t){this.prev=0;this.next=0;this.sent=this._sent=Qce;this.done=false;this.delegate=null;this.method="next";this.arg=Qce;this.tryEntries.forEach(Ede);if(!t){for(var n in this){if(n.charAt(0)==="t"&&Jce.call(this,n)&&!isNaN(+n.slice(1))){this[n]=Qce}}}},stop:function e(){this.done=true;var t=this.tryEntries[0];var n=t.completion;if(n.type==="throw"){throw n.arg}return this.rval},dispatchException:function e(t){if(this.done){throw t}var n=this;function r(e,r){o.type="throw";o.arg=t;n.next=e;if(r){n.method="next";n.arg=Qce}return!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];var o=a.completion;if(a.tryLoc==="root"){return r("end")}if(a.tryLoc<=this.prev){var u=Jce.call(a,"catchLoc");var s=Jce.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc){return r(a.catchLoc,true)}else if(this.prev<a.finallyLoc){return r(a.finallyLoc)}}else if(u){if(this.prev<a.catchLoc){return r(a.catchLoc,true)}}else if(s){if(this.prev<a.finallyLoc){return r(a.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function e(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&Jce.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}if(a&&(t==="break"||t==="continue")&&a.tryLoc<=n&&n<=a.finallyLoc){a=null}var o=a?a.completion:{};o.type=t;o.arg=n;if(a){this.method="next";this.next=a.finallyLoc;return sde}return this.complete(o)},complete:function e(t,n){if(t.type==="throw"){throw t.arg}if(t.type==="break"||t.type==="continue"){this.next=t.arg}else if(t.type==="return"){this.rval=this.arg=t.arg;this.method="return";this.next="end"}else if(t.type==="normal"&&n){this.next=n}return sde},finish:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t){this.complete(r.completion,r.afterLoc);Ede(r);return sde}}},catch:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var i=r.completion;if(i.type==="throw"){var a=i.arg;Ede(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function e(t,n,r){this.delegate={iterator:Cde(t),resultName:n,nextLoc:r};if(this.method==="next"){this.arg=Qce}return sde}};var Fde={wrap:nde,isGeneratorFunction:mde,AsyncIterator:bde,mark:yde,awrap:_de,async:xde,keys:Sde,values:Cde};function Ode(e,t,n){var r=e.open(t);var i=1e4;var a=250;var o=new URL(t),u=o.origin;var s=~~(i/a);function l(t){if(t.source===r){s=0;e.removeEventListener("message",l,false)}}e.addEventListener("message",l,false);function f(){if(s<=0){return}r.postMessage(n,u);setTimeout(f,a);s-=1}setTimeout(f,a)}var Nde='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper.fit-x {\n    width: 100%; }\n  .vega-embed .chart-wrapper.fit-y {\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}}function Tde(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}for(var i=0,a=n;i<a.length;i++){var o=a[i];zde(e,o)}return e}function zde(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];Br(e,i,t[i],true)}}var Rde;function Pde(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);if(t){r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))}n.push.apply(n,r)}return n}function Lde(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};if(t%2){Pde(Object(n),true).forEach((function(t){$ce(e,t,n[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(n))}else{Pde(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}}return e}var jde=c0;var Bde=kfe;var Ide=typeof window!=="undefined"?window:undefined;if(Bde===undefined&&Ide!==null&&Ide!==void 0&&(Rde=Ide["vl"])!==null&&Rde!==void 0&&Rde.compile){Bde=Ide["vl"]}var Ude={export:{svg:true,png:true},source:true,compiled:true,editor:true};var qde={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"};var Wde={vega:"Vega","vega-lite":"Vega-Lite"};var Hde={vega:jde.version,"vega-lite":Bde?Bde.version:"not available"};var Gde={vega:function(e){return e},"vega-lite":function(e,t){return Bde.compile(e,{config:t}).spec}};var $de='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>';var Vde="chart-wrapper";function Yde(e){return typeof e==="function"}function Xde(e,t,n,r){var i="<html><head>".concat(t,'</head><body><pre><code class="json">');var a="</code></pre>".concat(n,"</body></html>");var o=window.open("");o.document.write(i+e+a);o.document.title="".concat(Wde[r]," JSON Source")}function Jde(e,t){if(e.$schema){var n=Afe(e.$schema);if(t&&t!==n.library){var r;console.warn("The given visualization spec is written in ".concat(Wde[n.library],", but mode argument sets ").concat((r=Wde[t])!==null&&r!==void 0?r:t,"."))}var i=n.library;if(!dr.satisfies(Hde[i],"^".concat(n.version.slice(1)))){console.warn("The input spec uses ".concat(Wde[i]," ").concat(n.version,", but the current version of ").concat(Wde[i]," is v").concat(Hde[i],"."))}return i}if("mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e){return"vega-lite"}if("marks"in e||"signals"in e||"scales"in e||"axes"in e){return"vega"}return t!==null&&t!==void 0?t:"vega"}function Qde(e){return!!(e&&"load"in e)}function Zde(e){return Qde(e)?e:jde.loader(e)}function Kde(e){var t;return(t=e.usermeta&&e.usermeta["embedOptions"])!==null&&t!==void 0?t:{}}function ehe(e,t){return the.apply(this,arguments)}function the(){the=Yce(Fde.mark((function e(t,n){var r,i;var a,o,u,s,l,f,c,d,h=arguments;return Fde.wrap((function e(v){while(1){switch(v.prev=v.next){case 0:a=h.length>2&&h[2]!==undefined?h[2]:{};if(!Ni(n)){v.next=10;break}u=Zde(a.loader);v.t0=JSON;v.next=6;return u.load(n);case 6:v.t1=v.sent;o=v.t0.parse.call(v.t0,v.t1);v.next=11;break;case 10:o=n;case 11:s=Kde(o).loader;if(!u||s){u=Zde((l=a.loader)!==null&&l!==void 0?l:s)}v.next=15;return nhe(Kde(o),u);case 15:f=v.sent;v.next=18;return nhe(a,u);case 18:c=v.sent;d=Lde(Lde({},Tde(c,f)),{},{config:jr((r=c.config)!==null&&r!==void 0?r:{},(i=f.config)!==null&&i!==void 0?i:{})});v.next=22;return ahe(t,o,d,u);case 22:return v.abrupt("return",v.sent);case 23:case"end":return v.stop()}}}),e)})));return the.apply(this,arguments)}function nhe(e,t){return rhe.apply(this,arguments)}function rhe(){rhe=Yce(Fde.mark((function e(t,n){var r;var i,a;return Fde.wrap((function e(o){while(1){switch(o.prev=o.next){case 0:if(!Ni(t.config)){o.next=8;break}o.t1=JSON;o.next=4;return n.load(t.config);case 4:o.t2=o.sent;o.t0=o.t1.parse.call(o.t1,o.t2);o.next=9;break;case 8:o.t0=(r=t.config)!==null&&r!==void 0?r:{};case 9:i=o.t0;if(!Ni(t.patch)){o.next=18;break}o.t4=JSON;o.next=14;return n.load(t.patch);case 14:o.t5=o.sent;o.t3=o.t4.parse.call(o.t4,o.t5);o.next=19;break;case 18:o.t3=t.patch;case 19:a=o.t3;return o.abrupt("return",Lde(Lde(Lde({},t),a?{patch:a}:{}),i?{config:i}:{}));case 21:case"end":return o.stop()}}}),e)})));return rhe.apply(this,arguments)}function ihe(e){var t=e.getRootNode?e.getRootNode():document;if(t instanceof ShadowRoot){return{root:t,rootContainer:t}}else{var n;return{root:document,rootContainer:(n=document.head)!==null&&n!==void 0?n:document.body}}}function ahe(e,t){return ohe.apply(this,arguments)}function ohe(){ohe=Yce(Fde.mark((function e(t,n){var r,i,a,o,u;var s,l,f,c,d,h,v,p,g,m,y,_,b,x,w,k,A,E,D,S,C,M,F,O,N,T,z,R,P,L,j,B,I,U,q,W,H,G,$,V,Y,X,J=arguments;return Fde.wrap((function e(Q){while(1){switch(Q.prev=Q.next){case 0:X=function e(){if(P){document.removeEventListener("click",P)}F.finalize()};s=J.length>2&&J[2]!==undefined?J[2]:{};l=J.length>3?J[3]:undefined;f=s.theme?jr(zce[s.theme],(r=s.config)!==null&&r!==void 0?r:{}):s.config;c=Si(s.actions)?s.actions:Tde({},Ude,(i=s.actions)!==null&&i!==void 0?i:{});d=Lde(Lde({},qde),s.i18n);h=(a=s.renderer)!==null&&a!==void 0?a:"canvas";v=(o=s.logLevel)!==null&&o!==void 0?o:jde.Warn;p=(u=s.downloadFileName)!==null&&u!==void 0?u:"visualization";g=typeof t==="string"?document.querySelector(t):t;if(g){Q.next=12;break}throw new Error("".concat(t," does not exist"));case 12:if(s.defaultStyle!==false){m="vega-embed-style";y=ihe(g),_=y.root,b=y.rootContainer;if(!_.getElementById(m)){x=document.createElement("style");x.id=m;x.innerText=s.defaultStyle===undefined||s.defaultStyle===true?Nde.toString():s.defaultStyle;b.appendChild(x)}}w=Jde(n,s.mode);k=Gde[w](n,f);if(w==="vega-lite"){if(k.$schema){A=Afe(k.$schema);if(!dr.satisfies(Hde.vega,"^".concat(A.version.slice(1)))){console.warn("The compiled spec uses Vega ".concat(A.version,", but current version is v").concat(Hde.vega,"."))}}}g.classList.add("vega-embed");if(c){g.classList.add("has-actions")}g.innerHTML="";E=g;if(c){D=document.createElement("div");D.classList.add(Vde);g.appendChild(D);E=D}S=s.patch;if(S){if(S instanceof Function){k=S(k)}else{k=Z(k,S,true,false).newDocument}}if(s.formatLocale){jde.formatLocale(s.formatLocale)}if(s.timeFormatLocale){jde.timeFormatLocale(s.timeFormatLocale)}C=s.ast;M=jde.parse(k,w==="vega-lite"?{}:f,{ast:C});F=new(s.viewClass||jde.View)(M,Lde({loader:l,logLevel:v,renderer:h},C?{expr:jde.expressionInterpreter}:{}));F.addSignalListener("autosize",(function(e,t){var n=t.type;if(n=="fit-x"){E.classList.add("fit-x");E.classList.remove("fit-y")}else if(n=="fit-y"){E.classList.remove("fit-x");E.classList.add("fit-y")}else if(n=="fit"){E.classList.add("fit-x","fit-y")}else{E.classList.remove("fit-x","fit-y")}}));if(s.tooltip!==false){if(Yde(s.tooltip)){O=s.tooltip}else{O=new Gce(s.tooltip===true?{}:s.tooltip).call}F.tooltip(O)}N=s.hover;if(N===undefined){N=w==="vega"}if(N){T=typeof N==="boolean"?{}:N,z=T.hoverSet,R=T.updateSet;F.hover(z,R)}if(s){if(s.width!=null){F.width(s.width)}if(s.height!=null){F.height(s.height)}if(s.padding!=null){F.padding(s.padding)}}Q.next=36;return F.initialize(E,s.bind).runAsync();case 36:if(c!==false){L=g;if(s.defaultStyle!==false){j=document.createElement("details");j.title=d.CLICK_TO_VIEW_ACTIONS;g.append(j);L=j;B=document.createElement("summary");B.innerHTML=$de;j.append(B);P=function(e){if(!j.contains(e.target)){j.removeAttribute("open")}};document.addEventListener("click",P)}I=document.createElement("div");L.append(I);I.classList.add("vega-actions");if(c===true||c.export!==false){U=function e(){var t=W[q];if(c===true||c.export===true||c.export[t]){var n=d["".concat(t.toUpperCase(),"_ACTION")];var r=document.createElement("a");r.text=n;r.href="#";r.target="_blank";r.download="".concat(p,".").concat(t);r.addEventListener("mousedown",function(){var e=Yce(Fde.mark((function e(n){var r;return Fde.wrap((function e(i){while(1){switch(i.prev=i.next){case 0:n.preventDefault();i.next=3;return F.toImageURL(t,s.scaleFactor);case 3:r=i.sent;this.href=r;case 5:case"end":return i.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}());I.append(r)}};for(q=0,W=["svg","png"];q<W.length;q++){U()}}if(c===true||c.source!==false){H=document.createElement("a");H.text=d.SOURCE_ACTION;H.href="#";H.addEventListener("click",(function(e){var t,r;Xde(me(n),(t=s.sourceHeader)!==null&&t!==void 0?t:"",(r=s.sourceFooter)!==null&&r!==void 0?r:"",w);e.preventDefault()}));I.append(H)}if(w==="vega-lite"&&(c===true||c.compiled!==false)){G=document.createElement("a");G.text=d.COMPILED_ACTION;G.href="#";G.addEventListener("click",(function(e){var t,n;Xde(me(k),(t=s.sourceHeader)!==null&&t!==void 0?t:"",(n=s.sourceFooter)!==null&&n!==void 0?n:"","vega");e.preventDefault()}));I.append(G)}if(c===true||c.editor!==false){V=($=s.editorUrl)!==null&&$!==void 0?$:"https://vega.github.io/editor/";Y=document.createElement("a");Y.text=d.EDITOR_ACTION;Y.href="#";Y.addEventListener("click",(function(e){Ode(window,V,{config:f,mode:w,renderer:h,spec:me(n)});e.preventDefault()}));I.append(Y)}}return Q.abrupt("return",{view:F,spec:n,vgSpec:k,finalize:X});case 38:case"end":return Q.stop()}}}),e)})));return ohe.apply(this,arguments)}var uhe=".sc-stencila-image-vega-default-h{display:block}.sc-stencila-image-vega-default-h.imgHidden.sc-stencila-image-vega-default-s>picture>:not(.vega-embed){display:none}";var she=".sc-stencila-image-vega-material-h{display:block}.sc-stencila-image-vega-material-h.imgHidden.sc-stencila-image-vega-material-s>picture>:not(.vega-embed){display:none}";var lhe={vega:undefined,"vega-lite":undefined};var fhe=e("stencila_image_vega",function(){function e(e){var n=this;t(this,e);this.vegaLoaded=r(this,"vegaLoaded",7);this.detectVegaDependency=function(e){var t=u(typeof e==="object"?e.$schema:e);n.vegaDependency=t;return t};this.options={};this.plotIsRendered=false;this.getPlotContent=function(){if(n.spec!==undefined&&n.spec!==""){return n.spec}var e=n.el.querySelector('[type^="'+s+'"]');if(e){try{var t=e.textContent;var r=JSON.parse(t!==null&&t!==void 0?t:"");return r}catch(i){console.error("Could not parse plot data")}}return undefined};this.renderPlot=function(){var e;var t=n.getPlotContent();n.plotContainer=(e=n.plotContainer)!==null&&e!==void 0?e:M(n.el);if(t!==undefined){return ehe(n.plotContainer,t,Object.assign({actions:{compiled:false,editor:false}},n.options)).then((function(e){n.plotIsRendered=true;return e}))}return Promise.resolve()}}e.prototype.onVegaLoaded=function(e){if(!this.plotIsRendered&&e.detail.library===this.vegaDependency.library){this.renderPlot().catch((function(e){console.log(e)}))}};e.prototype.componentWillLoad=function(){var e=this;this.detectVegaDependency(this.getPlotContent());if(!this.plotIsRendered&&lhe[this.vegaDependency.library]){return this.renderPlot()}else{C({src:l(this.vegaDependency),onLoad:function(){lhe[e.vegaDependency.library]=true;e.vegaLoaded.emit({library:e.vegaDependency.library})}})}};e.prototype.componentShouldUpdate=function(e,t,n){if(n==="plotIsRendered"&&t===e){return false}return true};e.prototype.componentWillUpdate=function(){this.renderPlot().catch((function(e){console.log(e)}))};e.prototype.render=function(){return n(a,{class:{imgHidden:this.plotIsRendered}})};Object.defineProperty(e.prototype,"el",{get:function(){return i(this)},enumerable:false,configurable:true});return e}());fhe.style={default:uhe,material:she}}}}));