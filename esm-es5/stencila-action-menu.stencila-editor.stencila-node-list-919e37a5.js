var __extends=this&&this.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]};return e(t,n)};return function(t,n){if(typeof n!=="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();var __awaiter=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return c([e,t])}}function c(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(s){a=[6,s];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};import{r as registerInstance,h,a as getElement,c as createEvent,H as Host}from"./index-e3052a43.js";import{g as getSlotByName}from"./slotSelectors-8761b1b3.js";import{H as He,X as Xe,J as Je}from"./schema-d66ff4ac.js";import{c as createCommonjsModule,a as commonjsGlobal}from"./_commonjsHelpers-8a9f3b18.js";import{_ as _function}from"./function-df6e836e.js";import{i as isPlotlyObject,a as isVegaObject}from"./imagePlotlyUtils-86d8b4db.js";var Apply=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.sequenceS=t.sequenceT=t.getApplySemigroup=t.apS=t.apSecond=t.apFirst=t.ap=void 0;function n(e,t){return function(n){return function(r){return e.ap(e.map(r,(function(e){return function(n){return t.ap(e,n)}})),n)}}}t.ap=n;function r(e){return function(t){return function(n){return e.ap(e.map(n,(function(e){return function(){return e}})),t)}}}t.apFirst=r;function i(e){return function(t){return function(n){return e.ap(e.map(n,(function(){return function(e){return e}})),t)}}}t.apSecond=i;function o(e){return function(t,n){return function(r){return e.ap(e.map(r,(function(e){return function(n){var r;return Object.assign({},e,(r={},r[t]=n,r))}})),n)}}}t.apS=o;function a(e){return function(t){return{concat:function(n,r){return e.ap(e.map(n,(function(e){return function(n){return t.concat(e,n)}})),r)}}}}t.getApplySemigroup=a;function s(e,t,n){return function(r){var i=Array(n.length+1);for(var o=0;o<n.length;o++){i[o]=n[o]}i[n.length]=r;return t===0?e.apply(null,i):s(e,t-1,i)}}var c={1:function(e){return[e]},2:function(e){return function(t){return[e,t]}},3:function(e){return function(t){return function(n){return[e,t,n]}}},4:function(e){return function(t){return function(n){return function(r){return[e,t,n,r]}}}},5:function(e){return function(t){return function(n){return function(r){return function(i){return[e,t,n,r,i]}}}}}};function u(e){if(!c.hasOwnProperty(e)){c[e]=s(_function.tuple,e-1,[])}return c[e]}function l(e){return function(){var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}var r=t.length;var i=u(r);var o=e.map(t[0],i);for(var a=1;a<r;a++){o=e.ap(o,t[a])}return o}}t.sequenceT=l;function f(e){var t=e.length;switch(t){case 1:return function(t){var n;return n={},n[e[0]]=t,n};case 2:return function(t){return function(n){var r;return r={},r[e[0]]=t,r[e[1]]=n,r}};case 3:return function(t){return function(n){return function(r){var i;return i={},i[e[0]]=t,i[e[1]]=n,i[e[2]]=r,i}}};case 4:return function(t){return function(n){return function(r){return function(i){var o;return o={},o[e[0]]=t,o[e[1]]=n,o[e[2]]=r,o[e[3]]=i,o}}}};case 5:return function(t){return function(n){return function(r){return function(i){return function(o){var a;return a={},a[e[0]]=t,a[e[1]]=n,a[e[2]]=r,a[e[3]]=i,a[e[4]]=o,a}}}}};default:return s((function(){var n=[];for(var r=0;r<arguments.length;r++){n[r]=arguments[r]}var i={};for(var o=0;o<t;o++){i[e[o]]=n[o]}return i}),t-1,[])}}function h(e){return function(t){var n=Object.keys(t);var r=n.length;var i=f(n);var o=e.map(t[n[0]],i);for(var a=1;a<r;a++){o=e.ap(o,t[n[a]])}return o}}t.sequenceS=h}));var Functor=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.getFunctorComposition=t.bindTo=t.flap=t.map=void 0;function n(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.map(e,n)}))}}}t.map=n;function r(e){return function(t){return function(n){return e.map(n,(function(e){return e(t)}))}}}t.flap=r;function i(e){return function(t){return function(n){return e.map(n,(function(e){var n;return n={},n[t]=e,n}))}}}t.bindTo=i;function o(e,t){var r=n(e,t);return{map:function(e,t){return _function.pipe(e,r(t))}}}t.getFunctorComposition=o}));var Eq=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.eqDate=t.eqNumber=t.eqString=t.eqBoolean=t.eq=t.strictEqual=t.getStructEq=t.getTupleEq=t.Contravariant=t.getMonoid=t.getSemigroup=t.eqStrict=t.URI=t.contramap=t.tuple=t.struct=t.fromEquals=void 0;function n(e){return{equals:function(t,n){return t===n||e(t,n)}}}t.fromEquals=n;var r=function(e){return n((function(t,n){for(var r in e){if(!e[r].equals(t[r],n[r])){return false}}return true}))};t.struct=r;var i=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return n((function(t,n){return e.every((function(e,r){return e.equals(t[r],n[r])}))}))};t.tuple=i;var o=function(e,n){return _function.pipe(e,t.contramap(n))};var a=function(e){return function(t){return n((function(n,r){return t.equals(e(n),e(r))}))}};t.contramap=a;t.URI="Eq";t.eqStrict={equals:function(e,t){return e===t}};var s={equals:function(){return true}};var c=function(){return{concat:function(e,t){return n((function(n,r){return e.equals(n,r)&&t.equals(n,r)}))}}};t.getSemigroup=c;var u=function(){return{concat:t.getSemigroup().concat,empty:s}};t.getMonoid=u;t.Contravariant={URI:t.URI,contramap:o};t.getTupleEq=t.tuple;t.getStructEq=t.struct;t.strictEqual=t.eqStrict.equals;t.eq=t.Contravariant;t.eqBoolean=t.eqStrict;t.eqString=t.eqStrict;t.eqNumber=t.eqStrict;t.eqDate={equals:function(e,t){return e.valueOf()===t.valueOf()}}}));var Applicative=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.getApplicativeComposition=t.getApplicativeMonoid=void 0;function n(e){var t=Apply.getApplySemigroup(e);return function(n){return{concat:t(n).concat,empty:e.of(n.empty)}}}t.getApplicativeMonoid=n;function r(e,t){var n=Functor.getFunctorComposition(e,t).map;var r=Apply.ap(e,t);return{map:n,of:function(n){return e.of(t.of(n))},ap:function(e,t){return _function.pipe(e,r(t))}}}t.getApplicativeComposition=r}));var Chain=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.bind=t.chainFirst=void 0;function n(e){return function(t){return function(n){return e.chain(n,(function(n){return e.map(t(n),(function(){return n}))}))}}}t.chainFirst=n;function r(e){return function(t,n){return function(r){return e.chain(r,(function(r){return e.map(n(r),(function(e){var n;return Object.assign({},r,(n={},n[t]=e,n))}))}))}}}t.bind=r}));var internal=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:true});t.fromReadonlyNonEmptyArray=t.has=t.isLeft=t.isSome=void 0;var r=function(e){return e._tag==="Some"};t.isSome=r;var i=function(e){return e._tag==="Left"};t.isLeft=i;t.has=Object.prototype.hasOwnProperty;var o=function(e){return n([e[0]],e.slice(1))};t.fromReadonlyNonEmptyArray=o}));var Separated=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.right=t.left=t.flap=t.Functor=t.Bifunctor=t.URI=t.bimap=t.mapLeft=t.map=t.separated=void 0;var n=function(e,t){return{left:e,right:t}};t.separated=n;var r=function(e,n){return _function.pipe(e,t.map(n))};var i=function(e,n){return _function.pipe(e,t.mapLeft(n))};var o=function(e,n,r){return _function.pipe(e,t.bimap(n,r))};var a=function(e){return function(n){return t.separated(t.left(n),e(t.right(n)))}};t.map=a;var s=function(e){return function(n){return t.separated(e(t.left(n)),t.right(n))}};t.mapLeft=s;var c=function(e,n){return function(r){return t.separated(e(t.left(r)),n(t.right(r)))}};t.bimap=c;t.URI="Separated";t.Bifunctor={URI:t.URI,mapLeft:i,bimap:o};t.Functor={URI:t.URI,map:r};t.flap=Functor.flap(t.Functor);var u=function(e){return e.left};t.left=u;var l=function(e){return e.right};t.right=l}));var Option$1=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.getFirstMonoid=t.getOrd=t.getEq=t.getShow=t.URI=t.wilt=t.wither=t.sequence=t.traverse=t.partitionMap=t.partition=t.filterMap=t.filter=t.separate=t.compact=t.reduceRight=t.foldMap=t.reduce=t.duplicate=t.extend=t.throwError=t.zero=t.alt=t.altW=t.flatten=t.chain=t.of=t.ap=t.map=t.toUndefined=t.toNullable=t.chainNullableK=t.fromNullableK=t.tryCatchK=t.tryCatch=t.fromNullable=t.getOrElse=t.getOrElseW=t.fold=t.match=t.foldW=t.matchW=t.fromEither=t.getRight=t.getLeft=t.fromPredicate=t.some=t.none=t.isNone=t.isSome=void 0;t.getApplyMonoid=t.getApplySemigroup=t.option=t.mapNullable=t.sequenceArray=t.traverseArray=t.traverseArrayWithIndex=t.apS=t.bind=t.bindTo=t.Do=t.getRefinement=t.exists=t.elem=t.MonadThrow=t.Witherable=t.Traversable=t.Filterable=t.Compactable=t.Extend=t.Alternative=t.Alt=t.Foldable=t.chainFirst=t.Monad=t.Chain=t.Applicative=t.apSecond=t.apFirst=t.Apply=t.Pointed=t.flap=t.Functor=t.getMonoid=t.getLastMonoid=void 0;var o=i(internal);t.isSome=o.isSome;var a=function(e){return e._tag==="None"};t.isNone=a;t.none={_tag:"None"};var s=function(e){return{_tag:"Some",value:e}};t.some=s;function c(e){return function(n){return e(n)?t.some(n):t.none}}t.fromPredicate=c;function u(e){return e._tag==="Right"?t.none:t.some(e.left)}t.getLeft=u;function l(e){return e._tag==="Left"?t.none:t.some(e.right)}t.getRight=l;t.fromEither=l;var f=function(e,n){return function(r){return t.isNone(r)?e():n(r.value)}};t.matchW=f;t.foldW=t.matchW;t.match=t.matchW;t.fold=t.match;var h=function(e){return function(n){return t.isNone(n)?e():n.value}};t.getOrElseW=h;t.getOrElse=t.getOrElseW;var d=function(e){return e==null?t.none:t.some(e)};t.fromNullable=d;var p=function(e){try{return t.some(e())}catch(n){return t.none}};t.tryCatch=p;var v=function(e){return function(){var n=[];for(var r=0;r<arguments.length;r++){n[r]=arguments[r]}return t.tryCatch((function(){return e.apply(void 0,n)}))}};t.tryCatchK=v;var m=function(e){return _function.flow(e,t.fromNullable)};t.fromNullableK=m;var g=function(e){return function(n){return t.isNone(n)?t.none:t.fromNullable(e(n.value))}};t.chainNullableK=g;t.toNullable=t.match(_function.constNull,_function.identity);t.toUndefined=t.match(_function.constUndefined,_function.identity);var y=function(e,n){return _function.pipe(e,t.map(n))};var b=function(e,n){return _function.pipe(e,t.ap(n))};var w=function(e,n){return _function.pipe(e,t.chain(n))};var x=function(e,n,r){return _function.pipe(e,t.reduce(n,r))};var S=function(e){var n=t.foldMap(e);return function(e,t){return _function.pipe(e,n(t))}};var k=function(e,n,r){return _function.pipe(e,t.reduceRight(n,r))};var C=function(e){var n=t.traverse(e);return function(e,t){return _function.pipe(e,n(t))}};var A=function(e,n){return _function.pipe(e,t.alt(n))};var M=function(e,n){return _function.pipe(e,t.filter(n))};var I=function(e,n){return _function.pipe(e,t.filterMap(n))};var E=function(e,n){return _function.pipe(e,t.extend(n))};var R=function(e,n){return _function.pipe(e,t.partition(n))};var T=function(e,n){return _function.pipe(e,t.partitionMap(n))};var P=function(e){var n=t.wither(e);return function(e,t){return _function.pipe(e,n(t))}};var O=function(e){var n=t.wilt(e);return function(e,t){return _function.pipe(e,n(t))}};var D=function(e){return function(n){return t.isNone(n)?t.none:t.some(e(n.value))}};t.map=D;var B=function(e){return function(n){return t.isNone(n)?t.none:t.isNone(e)?t.none:t.some(n.value(e.value))}};t.ap=B;t.of=t.some;var L=function(e){return function(n){return t.isNone(n)?t.none:e(n.value)}};t.chain=L;t.flatten=t.chain(_function.identity);var _=function(e){return function(n){return t.isNone(n)?e():n}};t.altW=_;t.alt=t.altW;var N=function(){return t.none};t.zero=N;var W=function(){return t.none};t.throwError=W;var F=function(e){return function(n){return t.isNone(n)?t.none:t.some(e(n))}};t.extend=F;t.duplicate=t.extend(_function.identity);var j=function(e,n){return function(r){return t.isNone(r)?e:n(e,r.value)}};t.reduce=j;var V=function(e){return function(n){return function(r){return t.isNone(r)?e.empty:n(r.value)}}};t.foldMap=V;var U=function(e,n){return function(r){return t.isNone(r)?e:n(r.value,e)}};t.reduceRight=U;t.compact=t.flatten;var q=Separated.separated(t.none,t.none);var H=function(e){return t.isNone(e)?q:Separated.separated(u(e.value),l(e.value))};t.separate=H;var z=function(e){return function(n){return t.isNone(n)?t.none:e(n.value)?n:t.none}};t.filter=z;var G=function(e){return function(n){return t.isNone(n)?t.none:e(n.value)}};t.filterMap=G;var $=function(e){return function(t){return Separated.separated(M(t,(function(t){return!e(t)})),M(t,e))}};t.partition=$;var K=function(e){return _function.flow(t.map(e),t.separate)};t.partitionMap=K;var J=function(e){return function(n){return function(r){return t.isNone(r)?e.of(t.none):e.map(n(r.value),t.some)}}};t.traverse=J;var Q=function(e){return function(n){return t.isNone(n)?e.of(t.none):e.map(n.value,t.some)}};t.sequence=Q;var X=function(e){return function(n){return function(r){return t.isNone(r)?e.of(t.none):n(r.value)}}};t.wither=X;var Y=function(e){return function(n){return function(r){return t.isNone(r)?e.of(q):e.map(n(r.value),(function(e){return Separated.separated(u(e),l(e))}))}}};t.wilt=Y;t.URI="Option";function Z(e){return{show:function(n){return t.isNone(n)?"none":"some("+e.show(n.value)+")"}}}t.getShow=Z;function ee(e){return{equals:function(n,r){return n===r||(t.isNone(n)?t.isNone(r):t.isNone(r)?false:e.equals(n.value,r.value))}}}t.getEq=ee;function te(e){return{equals:ee(e).equals,compare:function(n,r){return n===r?0:t.isSome(n)?t.isSome(r)?e.compare(n.value,r.value):1:-1}}}t.getOrd=te;function ne(){return{concat:function(e,n){return t.isNone(e)?n:e},empty:t.none}}t.getFirstMonoid=ne;function re(){return{concat:function(e,n){return t.isNone(n)?e:n},empty:t.none}}t.getLastMonoid=re;function ie(e){return{concat:function(n,r){return t.isNone(n)?r:t.isNone(r)?n:t.some(e.concat(n.value,r.value))},empty:t.none}}t.getMonoid=ie;t.Functor={URI:t.URI,map:y};t.flap=Functor.flap(t.Functor);t.Pointed={URI:t.URI,of:t.of};t.Apply={URI:t.URI,map:y,ap:b};t.apFirst=Apply.apFirst(t.Apply);t.apSecond=Apply.apSecond(t.Apply);t.Applicative={URI:t.URI,map:y,ap:b,of:t.of};t.Chain={URI:t.URI,map:y,ap:b,chain:w};t.Monad={URI:t.URI,map:y,ap:b,of:t.of,chain:w};t.chainFirst=Chain.chainFirst(t.Chain);t.Foldable={URI:t.URI,reduce:x,foldMap:S,reduceRight:k};t.Alt={URI:t.URI,map:y,alt:A};t.Alternative={URI:t.URI,map:y,ap:b,of:t.of,alt:A,zero:t.zero};t.Extend={URI:t.URI,map:y,extend:E};t.Compactable={URI:t.URI,compact:t.compact,separate:t.separate};t.Filterable={URI:t.URI,map:y,compact:t.compact,separate:t.separate,filter:M,filterMap:I,partition:R,partitionMap:T};t.Traversable={URI:t.URI,map:y,reduce:x,foldMap:S,reduceRight:k,traverse:C,sequence:t.sequence};t.Witherable={URI:t.URI,map:y,reduce:x,foldMap:S,reduceRight:k,traverse:C,sequence:t.sequence,compact:t.compact,separate:t.separate,filter:M,filterMap:I,partition:R,partitionMap:T,wither:P,wilt:O};t.MonadThrow={URI:t.URI,map:y,ap:b,of:t.of,chain:w,throwError:t.throwError};function oe(e){return function(n,r){return t.isNone(r)?false:e.equals(n,r.value)}}t.elem=oe;function ae(e){return function(n){return t.isNone(n)?false:e(n.value)}}t.exists=ae;function se(e){return function(n){return t.isSome(e(n))}}t.getRefinement=se;t.Do=t.of({});t.bindTo=Functor.bindTo(t.Functor);t.bind=Chain.bind(t.Chain);t.apS=Apply.apS(t.Apply);var ce=function(e){return function(n){var r=[];for(var i=0;i<n.length;i++){var o=e(i,n[i]);if(t.isNone(o)){return t.none}r.push(o.value)}return t.some(r)}};t.traverseArrayWithIndex=ce;var ue=function(e){return t.traverseArrayWithIndex((function(t,n){return e(n)}))};t.traverseArray=ue;t.sequenceArray=t.traverseArray(_function.identity);t.mapNullable=t.chainNullableK;t.option={URI:t.URI,map:y,of:t.of,ap:b,chain:w,reduce:x,foldMap:S,reduceRight:k,traverse:C,sequence:t.sequence,zero:t.zero,alt:A,extend:E,compact:t.compact,separate:t.separate,filter:M,filterMap:I,partition:R,partitionMap:T,wither:P,wilt:O,throwError:t.throwError};t.getApplySemigroup=Apply.getApplySemigroup(t.Apply);t.getApplyMonoid=Applicative.getApplicativeMonoid(t.Applicative)}));var defaultActionMenuCss=".sc-stencila-action-menu-default-h{--background:var(--color-neutral-50,#edf2f7);--border:var(--color-neutral-100,#e2e8f0);background-color:var(--background);border-bottom-left-radius:.25rem;border-color:var(--border);border-style:solid;border-width:0 0 1px 1px;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.75rem;line-height:1rem;line-height:1;padding:1px .25rem;position:absolute;right:0;top:0;z-index:1}.sc-stencila-action-menu-default-h .hidden.sc-stencila-action-menu-default{display:none}.sc-stencila-action-menu-default-h nav.sc-stencila-action-menu-default>*.sc-stencila-action-menu-default{vertical-align:middle}.sc-stencila-action-menu-default-h ul.sc-stencila-action-menu-default{list-style-type:none;margin:0;padding:0}.sc-stencila-action-menu-default-h li.sc-stencila-action-menu-default{display:inline;padding-right:.25rem}.sc-stencila-action-menu-default-h li.sc-stencila-action-menu-default:last-child{padding-right:0}.sc-stencila-action-menu-default-h .sc-stencila-action-menu-default-s>stencila-button,.sc-stencila-action-menu-default-h stencila-button.sc-stencila-action-menu-default{display:inline-block}.sc-stencila-action-menu-default-h .actionContainer.sc-stencila-action-menu-default{display:inline-block;overflow:hidden;-webkit-transition:width .12s ease-in-out;transition:width .12s ease-in-out;vertical-align:middle;white-space:nowrap;width:var(--max-width)}.sc-stencila-action-menu-default-h .actionContainer.sc-stencila-action-menu-default:not(.isAnimating):not(.isCollapsed){width:auto}.sc-stencila-action-menu-default-h .secondaryActions.sc-stencila-action-menu-default:not(:hover):not(:focus) .actionContainer.isCollapsed.sc-stencila-action-menu-default{width:0}";var materialActionMenuCss=".sc-stencila-action-menu-material-h{--background:var(--color-neutral-50,#edf2f7);--border:var(--color-neutral-100,#e2e8f0);background-color:var(--background);border-bottom-left-radius:.25rem;border-color:var(--border);border-style:solid;border-width:0 0 1px 1px;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.75rem;line-height:1rem;line-height:1;padding:1px .25rem;position:absolute;right:0;top:0;z-index:1}.sc-stencila-action-menu-material-h .hidden.sc-stencila-action-menu-material{display:none}.sc-stencila-action-menu-material-h nav.sc-stencila-action-menu-material>*.sc-stencila-action-menu-material{vertical-align:middle}.sc-stencila-action-menu-material-h ul.sc-stencila-action-menu-material{list-style-type:none;margin:0;padding:0}.sc-stencila-action-menu-material-h li.sc-stencila-action-menu-material{display:inline;padding-right:.25rem}.sc-stencila-action-menu-material-h li.sc-stencila-action-menu-material:last-child{padding-right:0}.sc-stencila-action-menu-material-h .sc-stencila-action-menu-material-s>stencila-button,.sc-stencila-action-menu-material-h stencila-button.sc-stencila-action-menu-material{display:inline-block}.sc-stencila-action-menu-material-h .actionContainer.sc-stencila-action-menu-material{display:inline-block;overflow:hidden;-webkit-transition:width .12s ease-in-out;transition:width .12s ease-in-out;vertical-align:middle;white-space:nowrap;width:var(--max-width)}.sc-stencila-action-menu-material-h .actionContainer.sc-stencila-action-menu-material:not(.isAnimating):not(.isCollapsed){width:auto}.sc-stencila-action-menu-material-h .secondaryActions.sc-stencila-action-menu-material:not(:hover):not(:focus) .actionContainer.isCollapsed.sc-stencila-action-menu-material{width:0}";var slots$2={default:"",persistentActions:"persistentActions"};var ActionMenu=function(){function e(e){var t=this;registerInstance(this,e);this.isCollapsed=false;this.toggleActionMenu=function(){return t.isCollapsed=!t.isCollapsed};this.width="auto";this.isAnimating=false;this.isTransitioning=false;this.calculateWidth=function(){if(t.actionContainerRef&&t.isTransitioning===false){t.width="auto";var e=t.actionContainerRef.getBoundingClientRect().width;t.width=e+"px"}};this.observer=new window.MutationObserver(this.calculateWidth);this.checkForSecondaryActions=function(){t.hasSecondaryActions=Array.from(t.el.children).some((function(e){return e.slot===""}));return t.hasSecondaryActions}}e.prototype.componentWillLoad=function(){this.checkForSecondaryActions()};e.prototype.componentDidLoad=function(){var e=this;if(this.actionContainerRef){window.requestAnimationFrame((function(){if(e.actionContainerRef&&e.hasSecondaryActions){e.actionContainerRef.addEventListener("transitionstart",(function(){return e.isTransitioning=true}));e.actionContainerRef.addEventListener("transitionend",(function(){return e.isTransitioning=false}));e.observer.observe(e.el,{characterData:true,subtree:true});e.calculateWidth();e.isCollapsed=true}}))}};e.prototype.disconnectedCallback=function(){this.observer.disconnect()};e.prototype.render=function(){var e=this;if(this.el.children.length<=0)return null;return h("nav",null,h("span",{class:"persistentActions"},h("slot",{name:slots$2.persistentActions})),h("span",{class:{secondaryActions:true,hidden:!this.hasSecondaryActions}},h("stencila-button",{onClick:this.toggleActionMenu,icon:"more",color:"key",minimal:true,size:"xsmall",iconOnly:true,ariaLabel:"Toggle Action Menu"}),h("span",{class:{actionContainer:true,isAnimating:this.isAnimating,isCollapsed:this.isCollapsed},ref:function(t){return e.actionContainerRef=t},style:{"--max-width":this.width}},h("slot",null))))};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return e}();ActionMenu.style={default:defaultActionMenuCss,material:materialActionMenuCss};var extend="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((function(e){return e?parseInt(e,36):1}));for(var i_1=1;i_1<extend.length;i_1++)extend[i_1]+=extend[i_1-1];function isExtendingChar(e){for(var t=1;t<extend.length;t+=2)if(extend[t]>e)return extend[t-1]<=e;return false}function isRegionalIndicator(e){return e>=127462&&e<=127487}var ZWJ=8205;function findClusterBreak(e,t,n){if(n===void 0){n=true}return(n?nextClusterBreak:prevClusterBreak)(e,t)}function nextClusterBreak(e,t){if(t==e.length)return t;if(t&&surrogateLow(e.charCodeAt(t))&&surrogateHigh(e.charCodeAt(t-1)))t--;var n=codePointAt(e,t);t+=codePointSize(n);while(t<e.length){var r=codePointAt(e,t);if(n==ZWJ||r==ZWJ||isExtendingChar(r)){t+=codePointSize(r);n=r}else if(isRegionalIndicator(r)){var i=0,o=t-2;while(o>=0&&isRegionalIndicator(codePointAt(e,o))){i++;o-=2}if(i%2==0)break;else t+=2}else{break}}return t}function prevClusterBreak(e,t){while(t>0){var n=nextClusterBreak(e,t-2);if(n<t)return n;t--}return 0}function surrogateLow(e){return e>=56320&&e<57344}function surrogateHigh(e){return e>=55296&&e<56320}function codePointAt(e,t){var n=e.charCodeAt(t);if(!surrogateHigh(n)||t+1==e.length)return n;var r=e.charCodeAt(t+1);if(!surrogateLow(r))return n;return(n-55296<<10)+(r-56320)+65536}function fromCodePoint(e){if(e<=65535)return String.fromCharCode(e);e-=65536;return String.fromCharCode((e>>10)+55296,(e&1023)+56320)}function codePointSize(e){return e<65536?1:2}function countColumn(e,t,n){for(var r=0;r<e.length;){if(e.charCodeAt(r)==9){t+=n-t%n;r++}else{t++;r=findClusterBreak(e,r)}}return t}function findColumn(e,t,n,r){for(var i=0;i<e.length;){if(t>=n)return{offset:i,leftOver:0};t+=e.charCodeAt(i)==9?r-t%r:1;i=findClusterBreak(e,i)}return{offset:e.length,leftOver:n-t}}var Text=function(){function e(){}e.prototype.lineAt=function(e){if(e<0||e>this.length)throw new RangeError("Invalid position "+e+" in document of length "+this.length);return this.lineInner(e,false,1,0)};e.prototype.line=function(e){if(e<1||e>this.lines)throw new RangeError("Invalid line number "+e+" in "+this.lines+"-line document");return this.lineInner(e,true,1,0)};e.prototype.replace=function(e,t,n){var r=[];this.decompose(0,e,r,2);if(n.length)n.decompose(0,n.length,r,1|2);this.decompose(t,this.length,r,1);return TextNode.from(r,this.length-(t-e)+n.length)};e.prototype.append=function(e){return this.replace(this.length,this.length,e)};e.prototype.slice=function(e,t){if(t===void 0){t=this.length}var n=[];this.decompose(e,t,n,0);return TextNode.from(n,t-e)};e.prototype.eq=function(e){if(e==this)return true;if(e.length!=this.length||e.lines!=this.lines)return false;var t=new RawTextCursor(this),n=new RawTextCursor(e);for(;;){t.next();n.next();if(t.lineBreak!=n.lineBreak||t.done!=n.done||t.value!=n.value)return false;if(t.done)return true}};e.prototype.iter=function(e){if(e===void 0){e=1}return new RawTextCursor(this,e)};e.prototype.iterRange=function(e,t){if(t===void 0){t=this.length}return new PartialTextCursor(this,e,t)};e.prototype.toString=function(){return this.sliceString(0)};e.prototype.toJSON=function(){var e=[];this.flatten(e);return e};e.of=function(t){if(t.length==0)throw new RangeError("A document must have at least one line");if(t.length==1&&!t[0])return e.empty;return t.length<=32?new TextLeaf(t):TextNode.from(TextLeaf.split(t,[]))};return e}();if(typeof Symbol!="undefined")Text.prototype[Symbol.iterator]=function(){return this.iter()};var TextLeaf=function(e){__extends(t,e);function t(t,n){if(n===void 0){n=textLength(t)}var r=e.call(this)||this;r.text=t;r.length=n;return r}Object.defineProperty(t.prototype,"lines",{get:function(){return this.text.length},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"children",{get:function(){return null},enumerable:false,configurable:true});t.prototype.lineInner=function(e,t,n,r){for(var i=0;;i++){var o=this.text[i],a=r+o.length;if((t?n:a)>=e)return new Line(r,a,n,o);r=a+1;n++}};t.prototype.decompose=function(e,n,r,i){var o=e<=0&&n>=this.length?this:new t(sliceText(this.text,e,n),Math.min(n,this.length)-Math.max(0,e));if(i&1){var a=r.pop();var s=appendText(o.text,a.text.slice(),0,o.length);if(s.length<=32){r.push(new t(s,a.length+o.length))}else{var c=s.length>>1;r.push(new t(s.slice(0,c)),new t(s.slice(c)))}}else{r.push(o)}};t.prototype.replace=function(n,r,i){if(!(i instanceof t))return e.prototype.replace.call(this,n,r,i);var o=appendText(this.text,appendText(i.text,sliceText(this.text,0,n)),r);var a=this.length+i.length-(r-n);if(o.length<=32)return new t(o,a);return TextNode.from(t.split(o,[]),a)};t.prototype.sliceString=function(e,t,n){if(t===void 0){t=this.length}if(n===void 0){n="\n"}var r="";for(var i=0,o=0;i<=t&&o<this.text.length;o++){var a=this.text[o],s=i+a.length;if(i>e&&o)r+=n;if(e<s&&t>i)r+=a.slice(Math.max(0,e-i),t-i);i=s+1}return r};t.prototype.flatten=function(e){for(var t=0,n=this.text;t<n.length;t++){var r=n[t];e.push(r)}};t.split=function(e,n){var r=[],i=-1;for(var o=0,a=e;o<a.length;o++){var s=a[o];r.push(s);i+=s.length+1;if(r.length==32){n.push(new t(r,i));r=[];i=-1}}if(i>-1)n.push(new t(r,i));return n};return t}(Text);var TextNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this)||this;r.children=t;r.length=n;r.lines=0;for(var i=0,o=t;i<o.length;i++){var a=o[i];r.lines+=a.lines}return r}t.prototype.lineInner=function(e,t,n,r){for(var i=0;;i++){var o=this.children[i],a=r+o.length,s=n+o.lines-1;if((t?s:a)>=e)return o.lineInner(e,t,n,r);r=a+1;n=s+1}};t.prototype.decompose=function(e,t,n,r){for(var i=0,o=0;o<=t&&i<this.children.length;i++){var a=this.children[i],s=o+a.length;if(e<=s&&t>=o){var c=r&((o<=e?1:0)|(s>=t?2:0));if(o>=e&&s<=t&&!c)n.push(a);else a.decompose(e-o,t-o,n,c)}o=s+1}};t.prototype.replace=function(n,r,i){if(i.lines<this.lines)for(var o=0,a=0;o<this.children.length;o++){var s=this.children[o],c=a+s.length;if(n>=a&&r<=c){var u=s.replace(n-a,r-a,i);var l=this.lines-s.lines+u.lines;if(u.lines<l>>5-1&&u.lines>l>>5+1){var f=this.children.slice();f[o]=u;return new t(f,this.length-(r-n)+i.length)}return e.prototype.replace.call(this,a,c,u)}a=c+1}return e.prototype.replace.call(this,n,r,i)};t.prototype.sliceString=function(e,t,n){if(t===void 0){t=this.length}if(n===void 0){n="\n"}var r="";for(var i=0,o=0;i<this.children.length&&o<=t;i++){var a=this.children[i],s=o+a.length;if(o>e&&i)r+=n;if(e<s&&t>o)r+=a.sliceString(e-o,t-o,n);o=s+1}return r};t.prototype.flatten=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];r.flatten(e)}};t.from=function(e,n){if(n===void 0){n=e.reduce((function(e,t){return e+t.length+1}),-1)}var r=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];r+=a.lines}if(r<32){var s=[];for(var c=0,u=e;c<u.length;c++){var a=u[c];a.flatten(s)}return new TextLeaf(s,n)}var l=Math.max(32,r>>5),f=l<<1,h=l>>1;var d=[],p=0,v=-1,m=[];function g(e){var n;if(e.lines>f&&e instanceof t){for(var r=0,i=e.children;r<i.length;r++){var o=i[r];g(o)}}else if(e.lines>h&&(p>h||!p)){y();d.push(e)}else if(e instanceof TextLeaf&&p&&(n=m[m.length-1])instanceof TextLeaf&&e.lines+n.lines<=32){p+=e.lines;v+=e.length+1;m[m.length-1]=new TextLeaf(n.text.concat(e.text),n.length+1+e.length)}else{if(p+e.lines>l)y();p+=e.lines;v+=e.length+1;m.push(e)}}function y(){if(p==0)return;d.push(m.length==1?m[0]:t.from(m,v));v=-1;p=m.length=0}for(var b=0,w=e;b<w.length;b++){var x=w[b];g(x)}y();return d.length==1?d[0]:new t(d,n)};return t}(Text);Text.empty=new TextLeaf([""],0);function textLength(e){var t=-1;for(var n=0,r=e;n<r.length;n++){var i=r[n];t+=i.length+1}return t}function appendText(e,t,n,r){if(n===void 0){n=0}if(r===void 0){r=1e9}for(var i=0,o=0,a=true;o<e.length&&i<=r;o++){var s=e[o],c=i+s.length;if(c>=n){if(c>r)s=s.slice(0,r-i);if(i<n)s=s.slice(n-i);if(a){t[t.length-1]+=s;a=false}else t.push(s)}i=c+1}return t}function sliceText(e,t,n){return appendText(e,[""],t,n)}var RawTextCursor=function(){function e(e,t){if(t===void 0){t=1}this.dir=t;this.done=false;this.lineBreak=false;this.value="";this.nodes=[e];this.offsets=[t>0?0:e instanceof TextLeaf?e.text.length:e.children.length]}e.prototype.next=function(e){if(e===void 0){e=0}for(;;){var t=this.nodes.length-1;if(t<0){this.done=true;this.value="";this.lineBreak=false;return this}var n=this.nodes[t],r=this.offsets[t];var i=n instanceof TextLeaf?n.text.length:n.children.length;if(r==(this.dir>0?i:0)){this.nodes.pop();this.offsets.pop()}else if(!this.lineBreak&&r!=(this.dir>0?0:i)){this.lineBreak=true;if(e==0){this.value="\n";return this}e--}else if(n instanceof TextLeaf){var o=n.text[r-(this.dir<0?1:0)];this.offsets[t]=r+=this.dir;this.lineBreak=false;if(o.length>Math.max(0,e)){this.value=e==0?o:this.dir>0?o.slice(e):o.slice(0,o.length-e);return this}e-=o.length}else{var o=n.children[this.dir>0?r:r-1];this.offsets[t]=r+this.dir;this.lineBreak=false;if(e>o.length){e-=o.length}else{this.nodes.push(o);this.offsets.push(this.dir>0?0:o instanceof TextLeaf?o.text.length:o.children.length)}}}};return e}();var PartialTextCursor=function(){function e(e,t,n){this.value="";this.cursor=new RawTextCursor(e,t>n?-1:1);if(t>n){this.skip=e.length-t;this.limit=t-n}else{this.skip=t;this.limit=n-t}}e.prototype.next=function(e){if(e===void 0){e=0}if(this.limit<=0){this.limit=-1}else{var t=this.cursor.next(this.skip+e),n=t.value,r=t.lineBreak,i=t.done;this.skip=0;this.value=n;var o=r?1:n.length;if(o>this.limit)this.value=this.cursor.dir>0?n.slice(0,this.limit):n.slice(o-this.limit);if(i||this.value.length==0)this.limit=-1;else this.limit-=this.value.length}return this};Object.defineProperty(e.prototype,"lineBreak",{get:function(){return this.cursor.lineBreak},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"done",{get:function(){return this.limit<0},enumerable:false,configurable:true});return e}();var Line=function(){function e(e,t,n,r){this.from=e;this.to=t;this.number=n;this.text=r}Object.defineProperty(e.prototype,"length",{get:function(){return this.to-this.from},enumerable:false,configurable:true});return e}();var DefaultSplit=/\r\n?|\n/;var MapMode=function(e){e[e["Simple"]=0]="Simple";e[e["TrackDel"]=1]="TrackDel";e[e["TrackBefore"]=2]="TrackBefore";e[e["TrackAfter"]=3]="TrackAfter";return e}(MapMode||(MapMode={}));var ChangeDesc=function(){function e(e){this.sections=e}Object.defineProperty(e.prototype,"length",{get:function(){var e=0;for(var t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"newLength",{get:function(){var e=0;for(var t=0;t<this.sections.length;t+=2){var n=this.sections[t+1];e+=n<0?this.sections[t]:n}return e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"empty",{get:function(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0},enumerable:false,configurable:true});e.prototype.iterGaps=function(e){for(var t=0,n=0,r=0;t<this.sections.length;){var i=this.sections[t++],o=this.sections[t++];if(o<0){e(n,r,i);r+=i}else{r+=o}n+=i}};e.prototype.iterChangedRanges=function(e,t){if(t===void 0){t=false}iterChanges(this,e,t)};Object.defineProperty(e.prototype,"invertedDesc",{get:function(){var t=[];for(var n=0;n<this.sections.length;){var r=this.sections[n++],i=this.sections[n++];if(i<0)t.push(r,i);else t.push(i,r)}return new e(t)},enumerable:false,configurable:true});e.prototype.composeDesc=function(e){return this.empty?e:e.empty?this:composeSets(this,e)};e.prototype.mapDesc=function(e,t){if(t===void 0){t=false}return e.empty?this:mapSet(this,e,t)};e.prototype.mapPos=function(e,t,n){if(t===void 0){t=-1}if(n===void 0){n=MapMode.Simple}var r=0,i=0;for(var o=0;o<this.sections.length;){var a=this.sections[o++],s=this.sections[o++],c=r+a;if(s<0){if(c>e)return i+(e-r);i+=a}else{if(n!=MapMode.Simple&&c>=e&&(n==MapMode.TrackDel&&r<e&&c>e||n==MapMode.TrackBefore&&r<e||n==MapMode.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!a)return e==r||t<0?i:i+s;i+=s}r=c}if(e>r)throw new RangeError("Position "+e+" is out of range for changeset of length "+r);return i};e.prototype.touchesRange=function(e,t){if(t===void 0){t=e}for(var n=0,r=0;n<this.sections.length&&r<=t;){var i=this.sections[n++],o=this.sections[n++],a=r+i;if(o>=0&&r<=t&&a>=e)return r<e&&a>t?"cover":true;r=a}return false};e.prototype.toString=function(){var e="";for(var t=0;t<this.sections.length;){var n=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+n+(r>=0?":"+r:"")}return e};e.prototype.toJSON=function(){return this.sections};e.fromJSON=function(t){if(!Array.isArray(t)||t.length%2||t.some((function(e){return typeof e!="number"})))throw new RangeError("Invalid JSON representation of ChangeDesc");return new e(t)};return e}();var ChangeSet=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.inserted=n;return r}t.prototype.apply=function(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");iterChanges(this,(function(t,n,r,i,o){return e=e.replace(r,r+(n-t),o)}),false);return e};t.prototype.mapDesc=function(e,t){if(t===void 0){t=false}return mapSet(this,e,t,true)};t.prototype.invert=function(e){var n=this.sections.slice(),r=[];for(var i=0,o=0;i<n.length;i+=2){var a=n[i],s=n[i+1];if(s>=0){n[i]=s;n[i+1]=a;var c=i>>1;while(r.length<c)r.push(Text.empty);r.push(a?e.slice(o,o+a):Text.empty)}o+=a}return new t(n,r)};t.prototype.compose=function(e){return this.empty?e:e.empty?this:composeSets(this,e,true)};t.prototype.map=function(e,t){if(t===void 0){t=false}return e.empty?this:mapSet(this,e,t,true)};t.prototype.iterChanges=function(e,t){if(t===void 0){t=false}iterChanges(this,e,t)};Object.defineProperty(t.prototype,"desc",{get:function(){return new ChangeDesc(this.sections)},enumerable:false,configurable:true});t.prototype.filter=function(e){var n=[],r=[],i=[];var o=new SectionIter(this);e:for(var a=0,s=0;;){var c=a==e.length?1e9:e[a++];while(s<c||s==c&&o.len==0){if(o.done)break e;var u=Math.min(o.len,c-s);addSection(i,u,-1);var l=o.ins==-1?-1:o.off==0?o.ins:0;addSection(n,u,l);if(l>0)addInsert(r,n,o.text);o.forward(u);s+=u}var f=e[a++];while(s<f){if(o.done)break e;var u=Math.min(o.len,f-s);addSection(n,u,-1);addSection(i,u,o.ins==-1?-1:o.off==0?o.ins:0);o.forward(u);s+=u}}return{changes:new t(n,r),filtered:new ChangeDesc(i)}};t.prototype.toJSON=function(){var e=[];for(var t=0;t<this.sections.length;t+=2){var n=this.sections[t],r=this.sections[t+1];if(r<0)e.push(n);else if(r==0)e.push([n]);else e.push([n].concat(this.inserted[t>>1].toJSON()))}return e};t.of=function(e,n,r){var i=[],o=[],a=0;var s=null;function c(e){if(e===void 0){e=false}if(!e&&!i.length)return;if(a<n)addSection(i,n-a,-1);var r=new t(i,o);s=s?s.compose(r.map(s)):r;i=[];o=[];a=0}function u(e){if(Array.isArray(e)){for(var l=0,f=e;l<f.length;l++){var h=f[l];u(h)}}else if(e instanceof t){if(e.length!=n)throw new RangeError("Mismatched change set length (got "+e.length+", expected "+n+")");c();s=s?s.compose(e.map(s)):e}else{var d=e.from,p=e.to,v=p===void 0?d:p,m=e.insert;if(d>v||d<0||v>n)throw new RangeError("Invalid change range "+d+" to "+v+" (in doc of length "+n+")");var g=!m?Text.empty:typeof m=="string"?Text.of(m.split(r||DefaultSplit)):m;var y=g.length;if(d==v&&y==0)return;if(d<a)c();if(d>a)addSection(i,d-a,-1);addSection(i,v-d,y);addInsert(o,i,g);a=v}}u(e);c(!s);return s};t.empty=function(e){return new t(e?[e,-1]:[],[])};t.fromJSON=function(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");var n=[],r=[];for(var i=0;i<e.length;i++){var o=e[i];if(typeof o=="number"){n.push(o,-1)}else if(!Array.isArray(o)||typeof o[0]!="number"||o.some((function(e,t){return t&&typeof e!="string"}))){throw new RangeError("Invalid JSON representation of ChangeSet")}else if(o.length==1){n.push(o[0],0)}else{while(r.length<i)r.push(Text.empty);r[i]=Text.of(o.slice(1));n.push(o[0],r[i].length)}}return new t(n,r)};return t}(ChangeDesc);function addSection(e,t,n,r){if(r===void 0){r=false}if(t==0&&n<=0)return;var i=e.length-2;if(i>=0&&n<=0&&n==e[i+1])e[i]+=t;else if(t==0&&e[i]==0)e[i+1]+=n;else if(r){e[i]+=t;e[i+1]+=n}else e.push(t,n)}function addInsert(e,t,n){if(n.length==0)return;var r=t.length-2>>1;if(r<e.length){e[e.length-1]=e[e.length-1].append(n)}else{while(e.length<r)e.push(Text.empty);e.push(n)}}function iterChanges(e,t,n){var r=e.inserted;for(var i=0,o=0,a=0;a<e.sections.length;){var s=e.sections[a++],c=e.sections[a++];if(c<0){i+=s;o+=s}else{var u=i,l=o,f=Text.empty;for(;;){u+=s;l+=c;if(c&&r)f=f.append(r[a-2>>1]);if(n||a==e.sections.length||e.sections[a+1]<0)break;s=e.sections[a++];c=e.sections[a++]}t(i,u,o,l,f);i=u;o=l}}}function mapSet(e,t,n,r){if(r===void 0){r=false}var i=[],o=r?[]:null;var a=new SectionIter(e),s=new SectionIter(t);for(var c=0,u=0;;){if(a.ins==-1){c+=a.len;a.next()}else if(s.ins==-1&&u<c){var l=Math.min(s.len,c-u);s.forward(l);addSection(i,l,-1);u+=l}else if(s.ins>=0&&(a.done||u<c||u==c&&(s.len<a.len||s.len==a.len&&!n))){addSection(i,s.ins,-1);while(c>u&&!a.done&&c+a.len<u+s.len){c+=a.len;a.next()}u+=s.len;s.next()}else if(a.ins>=0){var f=0,h=c+a.len;for(;;){if(s.ins>=0&&u>c&&u+s.len<h){f+=s.ins;u+=s.len;s.next()}else if(s.ins==-1&&u<h){var l=Math.min(s.len,h-u);f+=l;s.forward(l);u+=l}else{break}}addSection(i,f,a.ins);if(o)addInsert(o,i,a.text);c=h;a.next()}else if(a.done&&s.done){return o?new ChangeSet(i,o):new ChangeDesc(i)}else{throw new Error("Mismatched change set lengths")}}}function composeSets(e,t,n){if(n===void 0){n=false}var r=[];var i=n?[]:null;var o=new SectionIter(e),a=new SectionIter(t);for(var s=false;;){if(o.done&&a.done){return i?new ChangeSet(r,i):new ChangeDesc(r)}else if(o.ins==0){addSection(r,o.len,0,s);o.next()}else if(a.len==0&&!a.done){addSection(r,0,a.ins,s);if(i)addInsert(i,r,a.text);a.next()}else if(o.done||a.done){throw new Error("Mismatched change set lengths")}else{var c=Math.min(o.len2,a.len),u=r.length;if(o.ins==-1){var l=a.ins==-1?-1:a.off?0:a.ins;addSection(r,c,l,s);if(i&&l)addInsert(i,r,a.text)}else if(a.ins==-1){addSection(r,o.off?0:o.len,c,s);if(i)addInsert(i,r,o.textBit(c))}else{addSection(r,o.off?0:o.len,a.off?0:a.ins,s);if(i&&!a.off)addInsert(i,r,a.text)}s=(o.ins>c||a.ins>=0&&a.len>c)&&(s||r.length>u);o.forward2(c);a.forward(c)}}}var SectionIter=function(){function e(e){this.set=e;this.i=0;this.next()}e.prototype.next=function(){var e=this.set.sections;if(this.i<e.length){this.len=e[this.i++];this.ins=e[this.i++]}else{this.len=0;this.ins=-2}this.off=0};Object.defineProperty(e.prototype,"done",{get:function(){return this.ins==-2},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"len2",{get:function(){return this.ins<0?this.len:this.ins},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"text",{get:function(){var e=this.set.inserted,t=this.i-2>>1;return t>=e.length?Text.empty:e[t]},enumerable:false,configurable:true});e.prototype.textBit=function(e){var t=this.set.inserted,n=this.i-2>>1;return n>=t.length&&!e?Text.empty:t[n].slice(this.off,e==null?undefined:this.off+e)};e.prototype.forward=function(e){if(e==this.len)this.next();else{this.len-=e;this.off+=e}};e.prototype.forward2=function(e){if(this.ins==-1)this.forward(e);else if(e==this.ins)this.next();else{this.ins-=e;this.off+=e}};return e}();var SelectionRange=function(){function e(e,t,n){this.from=e;this.to=t;this.flags=n}Object.defineProperty(e.prototype,"anchor",{get:function(){return this.flags&16?this.to:this.from},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"head",{get:function(){return this.flags&16?this.from:this.to},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"empty",{get:function(){return this.from==this.to},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"assoc",{get:function(){return this.flags&4?-1:this.flags&8?1:0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"bidiLevel",{get:function(){var e=this.flags&3;return e==3?null:e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"goalColumn",{get:function(){var e=this.flags>>5;return e==33554431?undefined:e},enumerable:false,configurable:true});e.prototype.map=function(t,n){if(n===void 0){n=-1}var r=t.mapPos(this.from,n),i=t.mapPos(this.to,n);return r==this.from&&i==this.to?this:new e(r,i,this.flags)};e.prototype.extend=function(e,t){if(t===void 0){t=e}if(e<=this.anchor&&t>=this.anchor)return EditorSelection.range(e,t);var n=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return EditorSelection.range(this.anchor,n)};e.prototype.eq=function(e){return this.anchor==e.anchor&&this.head==e.head};e.prototype.toJSON=function(){return{anchor:this.anchor,head:this.head}};e.fromJSON=function(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)};return e}();var EditorSelection=function(){function e(e,t){if(t===void 0){t=0}this.ranges=e;this.mainIndex=t}e.prototype.map=function(t,n){if(n===void 0){n=-1}if(t.empty)return this;return e.create(this.ranges.map((function(e){return e.map(t,n)})),this.mainIndex)};e.prototype.eq=function(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return false;for(var t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return false;return true};Object.defineProperty(e.prototype,"main",{get:function(){return this.ranges[this.mainIndex]},enumerable:false,configurable:true});e.prototype.asSingle=function(){return this.ranges.length==1?this:new e([this.main])};e.prototype.addRange=function(t,n){if(n===void 0){n=true}return e.create([t].concat(this.ranges),n?0:this.mainIndex+1)};e.prototype.replaceRange=function(t,n){if(n===void 0){n=this.mainIndex}var r=this.ranges.slice();r[n]=t;return e.create(r,this.mainIndex)};e.prototype.toJSON=function(){return{ranges:this.ranges.map((function(e){return e.toJSON()})),main:this.mainIndex}};e.fromJSON=function(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new e(t.ranges.map((function(e){return SelectionRange.fromJSON(e)})),t.main)};e.single=function(t,n){if(n===void 0){n=t}return new e([e.range(t,n)],0)};e.create=function(t,n){if(n===void 0){n=0}if(t.length==0)throw new RangeError("A selection needs at least one range");for(var r=0,i=0;i<t.length;i++){var o=t[i];if(o.empty?o.from<=r:o.from<r)return normalized(t.slice(),n);r=o.to}return new e(t,n)};e.cursor=function(e,t,n,r){if(t===void 0){t=0}return new SelectionRange(e,e,(t==0?0:t<0?4:8)|(n==null?3:Math.min(2,n))|(r!==null&&r!==void 0?r:33554431)<<5)};e.range=function(e,t,n){var r=(n!==null&&n!==void 0?n:33554431)<<5;return t<e?new SelectionRange(t,e,16|r):new SelectionRange(e,t,r)};return e}();function normalized(e,t){if(t===void 0){t=0}var n=e[t];e.sort((function(e,t){return e.from-t.from}));t=e.indexOf(n);for(var r=1;r<e.length;r++){var i=e[r],o=e[r-1];if(i.empty?i.from<=o.to:i.from<o.to){var a=o.from,s=Math.max(i.to,o.to);if(r<=t)t--;e.splice(--r,2,i.anchor>i.head?EditorSelection.range(s,a):EditorSelection.range(a,s))}}return new EditorSelection(e,t)}function checkSelection(e,t){for(var n=0,r=e.ranges;n<r.length;n++){var i=r[n];if(i.to>t)throw new RangeError("Selection points outside of document")}}var nextID=0;var Facet=function(){function e(e,t,n,r,i){this.combine=e;this.compareInput=t;this.compare=n;this.isStatic=r;this.extensions=i;this.id=nextID++;this.default=e([])}e.define=function(t){if(t===void 0){t={}}return new e(t.combine||function(e){return e},t.compareInput||function(e,t){return e===t},t.compare||(!t.combine?sameArray$1:function(e,t){return e===t}),!!t.static,t.enables)};e.prototype.of=function(e){return new FacetProvider([],this,0,e)};e.prototype.compute=function(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,t)};e.prototype.computeN=function(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,t)};e.prototype.from=function(e,t){if(!t)t=function(e){return e};return this.compute([e],(function(n){return t(n.field(e))}))};return e}();function sameArray$1(e,t){return e==t||e.length==t.length&&e.every((function(e,n){return e===t[n]}))}var FacetProvider=function(){function e(e,t,n,r){this.dependencies=e;this.facet=t;this.type=n;this.value=r;this.id=nextID++}e.prototype.dynamicSlot=function(e){var t;var n=this.value;var r=this.facet.compareInput;var i=e[this.id]>>1,o=this.type==2;var a=false,s=false,c=[];for(var u=0,l=this.dependencies;u<l.length;u++){var f=l[u];if(f=="doc")a=true;else if(f=="selection")s=true;else if((((t=e[f.id])!==null&&t!==void 0?t:1)&1)==0)c.push(e[f.id])}return function(e,t){if(!t||t.reconfigured){e.values[i]=n(e);return 1}else{var u=a&&t.docChanged||s&&(t.docChanged||t.selection)||c.some((function(t){return(ensureAddr(e,t)&1)>0}));if(!u)return 0;var l=n(e),f=t.startState.values[i];if(o?compareArray(l,f,r):r(l,f))return 0;e.values[i]=l;return 1}}};return e}();function compareArray(e,t,n){if(e.length!=t.length)return false;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return false;return true}function dynamicFacetSlot(e,t,n){var r=n.map((function(t){return e[t.id]}));var i=n.map((function(e){return e.type}));var o=r.filter((function(e){return!(e&1)}));var a=e[t.id]>>1;return function(e,n){var s=!n?null:n.reconfigured?n.startState.config.address[t.id]:a<<1;var c=s==null;for(var u=0,l=o;u<l.length;u++){var f=l[u];if(ensureAddr(e,f)&1)c=true}if(!c)return 0;var h=[];for(var d=0;d<r.length;d++){var p=getAddr(e,r[d]);if(i[d]==2)for(var v=0,m=p;v<m.length;v++){var g=m[v];h.push(g)}else h.push(p)}var y=t.combine(h);if(s!=null&&t.compare(y,getAddr(n.startState,s)))return 0;e.values[a]=y;return 1}}function maybeIndex(e,t){var n=e.config.address[t];return n==null?null:n>>1}var initField=Facet.define({static:true});var StateField=function(){function e(e,t,n,r,i){this.id=e;this.createF=t;this.updateF=n;this.compareF=r;this.spec=i;this.provides=undefined}e.define=function(t){var n=new e(nextID++,t.create,t.update,t.compare||function(e,t){return e===t},t);if(t.provide)n.provides=t.provide(n);return n};e.prototype.create=function(e){var t=this;var n=e.facet(initField).find((function(e){return e.field==t}));return((n===null||n===void 0?void 0:n.create)||this.createF)(e)};e.prototype.slot=function(e){var t=this;var n=e[this.id]>>1;return function(e,r){if(!r||r.reconfigured&&maybeIndex(r.startState,t.id)==null){e.values[n]=t.create(e);return 1}var i,o=0;if(r.reconfigured){i=r.startState.values[maybeIndex(r.startState,t.id)];o=1}else{i=r.startState.values[n]}var a=t.updateF(i,r);if(!o&&!t.compareF(i,a))o=1;if(o)e.values[n]=a;return o}};e.prototype.init=function(e){return[this,initField.of({field:this,create:e})]};Object.defineProperty(e.prototype,"extension",{get:function(){return this},enumerable:false,configurable:true});return e}();var Prec_={fallback:3,default:2,extend:1,override:0};function prec(e){return function(t){return new PrecExtension(t,e)}}var Prec={fallback:prec(Prec_.fallback),default:prec(Prec_.default),extend:prec(Prec_.extend),override:prec(Prec_.override)};var PrecExtension=function(){function e(e,t){this.inner=e;this.prec=t}return e}();var Compartment=function(){function e(){}e.prototype.of=function(e){return new CompartmentInstance(this,e)};e.prototype.reconfigure=function(t){return e.reconfigure.of({compartment:this,extension:t})};e.prototype.get=function(e){return e.config.compartments.get(this)};return e}();var CompartmentInstance=function(){function e(e,t){this.compartment=e;this.inner=t}return e}();var Configuration=function(){function e(e,t,n,r,i){this.base=e;this.compartments=t;this.dynamicSlots=n;this.address=r;this.staticValues=i;this.statusTemplate=[];while(this.statusTemplate.length<n.length)this.statusTemplate.push(0)}e.prototype.staticFacet=function(e){var t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]};e.resolve=function(t,n,r){var i=[];var o=Object.create(null);var a=new Map;for(var s=0,c=flatten(t,n,a);s<c.length;s++){var u=c[s];if(u instanceof StateField)i.push(u);else(o[u.facet.id]||(o[u.facet.id]=[])).push(u)}var l=Object.create(null);var f=[];var h=[];var d=function(e){l[e.id]=h.length<<1;h.push((function(t){return e.slot(t)}))};for(var p=0,v=i;p<v.length;p++){var m=v[p];d(m)}var g=function(e){var t=o[e],n=t[0].facet;if(t.every((function(e){return e.type==0}))){l[n.id]=f.length<<1|1;var i=n.combine(t.map((function(e){return e.value})));var a=r?r.config.address[n.id]:null;if(a!=null){var s=getAddr(r,a);if(n.compare(i,s))i=s}f.push(i)}else{var c=function(e){if(e.type==0){l[e.id]=f.length<<1|1;f.push(e.value)}else{l[e.id]=h.length<<1;h.push((function(t){return e.dynamicSlot(t)}))}};for(var u=0,d=t;u<d.length;u++){var p=d[u];c(p)}l[n.id]=h.length<<1;h.push((function(e){return dynamicFacetSlot(e,n,t)}))}};for(var y in o){g(y)}return new e(t,a,h.map((function(e){return e(l)})),l,f)};return e}();function flatten(e,t,n){var r=[[],[],[],[]];var i=new Map;function o(e,a){var s=i.get(e);if(s!=null){if(s>=a)return;var c=r[s].indexOf(e);if(c>-1)r[s].splice(c,1);if(e instanceof CompartmentInstance)n.delete(e.compartment)}i.set(e,a);if(Array.isArray(e)){for(var u=0,l=e;u<l.length;u++){var f=l[u];o(f,a)}}else if(e instanceof CompartmentInstance){if(n.has(e.compartment))throw new RangeError("Duplicate use of compartment in extensions");var h=t.get(e.compartment)||e.inner;n.set(e.compartment,h);o(h,a)}else if(e instanceof PrecExtension){o(e.inner,e.prec)}else if(e instanceof StateField){r[a].push(e);if(e.provides)o(e.provides,a)}else if(e instanceof FacetProvider){r[a].push(e);if(e.facet.extensions)o(e.facet.extensions,a)}else{var d=e.extension;if(!d)throw new Error("Unrecognized extension value in extension set ("+e+"). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.");o(d,a)}}o(e,Prec_.default);return r.reduce((function(e,t){return e.concat(t)}))}function ensureAddr(e,t){if(t&1)return 2;var n=t>>1;var r=e.status[n];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;e.status[n]=4;var i=e.config.dynamicSlots[n](e,e.applying);return e.status[n]=2|i}function getAddr(e,t){return t&1?e.config.staticValues[t>>1]:e.values[t>>1]}var languageData=Facet.define();var allowMultipleSelections=Facet.define({combine:function(e){return e.some((function(e){return e}))},static:true});var lineSeparator=Facet.define({combine:function(e){return e.length?e[0]:undefined},static:true});var changeFilter=Facet.define();var transactionFilter=Facet.define();var transactionExtender=Facet.define();var Annotation=function(){function e(e,t){this.type=e;this.value=t}e.define=function(){return new AnnotationType};return e}();var AnnotationType=function(){function e(){}e.prototype.of=function(e){return new Annotation(this,e)};return e}();var StateEffectType=function(){function e(e){this.map=e}e.prototype.of=function(e){return new StateEffect(this,e)};return e}();var StateEffect=function(){function e(e,t){this.type=e;this.value=t}e.prototype.map=function(t){var n=this.type.map(this.value,t);return n===undefined?undefined:n==this.value?this:new e(this.type,n)};e.prototype.is=function(e){return this.type==e};e.define=function(e){if(e===void 0){e={}}return new StateEffectType(e.map||function(e){return e})};e.mapEffects=function(e,t){if(!e.length)return e;var n=[];for(var r=0,i=e;r<i.length;r++){var o=i[r];var a=o.map(t);if(a)n.push(a)}return n};return e}();StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();var Transaction=function(){function e(t,n,r,i,o,a){this.startState=t;this.changes=n;this.selection=r;this.effects=i;this.annotations=o;this.scrollIntoView=a;this._doc=null;this._state=null;if(r)checkSelection(r,n.newLength);if(!o.some((function(t){return t.type==e.time})))this.annotations=o.concat(e.time.of(Date.now()))}Object.defineProperty(e.prototype,"newDoc",{get:function(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"newSelection",{get:function(){return this.selection||this.startState.selection.map(this.changes)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"state",{get:function(){if(!this._state)this.startState.applyTransaction(this);return this._state},enumerable:false,configurable:true});e.prototype.annotation=function(e){for(var t=0,n=this.annotations;t<n.length;t++){var r=n[t];if(r.type==e)return r.value}return undefined};Object.defineProperty(e.prototype,"docChanged",{get:function(){return!this.changes.empty},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"reconfigured",{get:function(){return this.startState.config!=this.state.config},enumerable:false,configurable:true});return e}();Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(e,t){var n=[];for(var r=0,i=0;;){var o=void 0,a=void 0;if(r<e.length&&(i==t.length||t[i]>=e[r])){o=e[r++];a=e[r++]}else if(i<t.length){o=t[i++];a=t[i++]}else return n;if(!n.length||n[n.length-1]<o)n.push(o,a);else if(n[n.length-1]<a)n[n.length-1]=a}}function mergeTransaction(e,t,n){var r;var i,o,a;if(n){i=t.changes;o=ChangeSet.empty(t.changes.length);a=e.changes.compose(t.changes)}else{i=t.changes.map(e.changes);o=e.changes.mapDesc(t.changes,true);a=e.changes.compose(i)}return{changes:a,selection:t.selection?t.selection.map(o):(r=e.selection)===null||r===void 0?void 0:r.map(i),effects:StateEffect.mapEffects(e.effects,i).concat(StateEffect.mapEffects(t.effects,o)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function resolveTransactionInner(e,t,n){var r=t.selection;return{changes:t.changes instanceof ChangeSet?t.changes:ChangeSet.of(t.changes||[],n,e.facet(lineSeparator)),selection:r&&(r instanceof EditorSelection?r:EditorSelection.single(r.anchor,r.head)),effects:asArray$1(t.effects),annotations:asArray$1(t.annotations),scrollIntoView:!!t.scrollIntoView}}function resolveTransaction(e,t,n){var r=resolveTransactionInner(e,t.length?t[0]:{},e.doc.length);if(t.length&&t[0].filter===false)n=false;for(var i=1;i<t.length;i++){if(t[i].filter===false)n=false;var o=!!t[i].sequential;r=mergeTransaction(r,resolveTransactionInner(e,t[i],o?r.changes.newLength:e.doc.length),o)}var a=new Transaction(e,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return extendTransaction(n?filterTransaction(a):a)}function filterTransaction(e){var t=e.startState;var n=true;for(var r=0,i=t.facet(changeFilter);r<i.length;r++){var o=i[r];var a=o(e);if(a===false){n=false;break}if(Array.isArray(a))n=n===true?a:joinRanges(n,a)}if(n!==true){var s=void 0,c=void 0;if(n===false){c=e.changes.invertedDesc;s=ChangeSet.empty(t.doc.length)}else{var u=e.changes.filter(n);s=u.changes;c=u.filtered.invertedDesc}e=new Transaction(t,s,e.selection&&e.selection.map(c),StateEffect.mapEffects(e.effects,c),e.annotations,e.scrollIntoView)}var l=t.facet(transactionFilter);for(var f=l.length-1;f>=0;f--){var u=l[f](e);if(u instanceof Transaction)e=u;else if(Array.isArray(u)&&u.length==1&&u[0]instanceof Transaction)e=u[0];else e=resolveTransaction(t,asArray$1(u),false)}return e}function extendTransaction(e){var t=e.startState,n=t.facet(transactionExtender),r=e;for(var i=n.length-1;i>=0;i--){var o=n[i](e);if(o&&Object.keys(o).length)r=mergeTransaction(e,resolveTransactionInner(t,o,e.changes.newLength),true)}return r==e?e:new Transaction(t,e.changes,e.selection,r.effects,r.annotations,r.scrollIntoView)}var none$5=[];function asArray$1(e){return e==null?none$5:Array.isArray(e)?e:[e]}var CharCategory=function(e){e[e["Word"]=0]="Word";e[e["Space"]=1]="Space";e[e["Other"]=2]="Other";return e}(CharCategory||(CharCategory={}));var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;var wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(_){}function hasWordChar(e){if(wordChar)return wordChar.test(e);for(var t=0;t<e.length;t++){var n=e[t];if(/\w/.test(n)||n>""&&(n.toUpperCase()!=n.toLowerCase()||nonASCIISingleCaseWordChar.test(n)))return true}return false}function makeCategorizer(e){return function(t){if(!/\S/.test(t))return CharCategory.Space;if(hasWordChar(t))return CharCategory.Word;for(var n=0;n<e.length;n++)if(t.indexOf(e[n])>-1)return CharCategory.Word;return CharCategory.Other}}var EditorState=function(){function e(e,t,n,r){if(r===void 0){r=null}this.config=e;this.doc=t;this.selection=n;this.applying=null;this.status=e.statusTemplate.slice();if(r&&r.startState.config==e){this.values=r.startState.values.slice()}else{this.values=e.dynamicSlots.map((function(e){return null}));if(r)for(var i in e.address){var o=e.address[i],a=r.startState.config.address[i];if(a!=null&&(o&1)==0)this.values[o>>1]=getAddr(r.startState,a)}}this.applying=r;if(r)r._state=this;for(var s=0;s<this.config.dynamicSlots.length;s++)ensureAddr(this,s<<1);this.applying=null}e.prototype.field=function(e,t){if(t===void 0){t=true}var n=this.config.address[e.id];if(n==null){if(t)throw new RangeError("Field is not present in this state");return undefined}ensureAddr(this,n);return getAddr(this,n)};e.prototype.update=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return resolveTransaction(this,e,true)};e.prototype.applyTransaction=function(t){var n=this.config,r=n.base,i=n.compartments;for(var o=0,a=t.effects;o<a.length;o++){var s=a[o];if(s.is(Compartment.reconfigure)){if(n){i=new Map;n.compartments.forEach((function(e,t){return i.set(t,e)}));n=null}i.set(s.value.compartment,s.value.extension)}else if(s.is(StateEffect.reconfigure)){n=null;r=s.value}else if(s.is(StateEffect.appendConfig)){n=null;r=asArray$1(r).concat(s.value)}}new e(n||Configuration.resolve(r,i,this),t.newDoc,t.newSelection,t)};e.prototype.replaceSelection=function(e){if(typeof e=="string")e=this.toText(e);return this.changeByRange((function(t){return{changes:{from:t.from,to:t.to,insert:e},range:EditorSelection.cursor(t.from+e.length)}}))};e.prototype.changeByRange=function(e){var t=this.selection;var n=e(t.ranges[0]);var r=this.changes(n.changes),i=[n.range];var o=asArray$1(n.effects);for(var a=1;a<t.ranges.length;a++){var s=e(t.ranges[a]);var c=this.changes(s.changes),u=c.map(r);for(var l=0;l<a;l++)i[l]=i[l].map(u);var f=r.mapDesc(c,true);i.push(s.range.map(f));r=r.compose(u);o=StateEffect.mapEffects(o,u).concat(StateEffect.mapEffects(asArray$1(s.effects),f))}return{changes:r,selection:EditorSelection.create(i,t.mainIndex),effects:o}};e.prototype.changes=function(t){if(t===void 0){t=[]}if(t instanceof ChangeSet)return t;return ChangeSet.of(t,this.doc.length,this.facet(e.lineSeparator))};e.prototype.toText=function(t){return Text.of(t.split(this.facet(e.lineSeparator)||DefaultSplit))};e.prototype.sliceDoc=function(e,t){if(e===void 0){e=0}if(t===void 0){t=this.doc.length}return this.doc.sliceString(e,t,this.lineBreak)};e.prototype.facet=function(e){var t=this.config.address[e.id];if(t==null)return e.default;ensureAddr(this,t);return getAddr(this,t)};e.prototype.toJSON=function(e){var t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(var n in e){var r=e[n];if(r instanceof StateField)t[n]=r.spec.toJSON(this.field(e[n]),this)}return t};e.fromJSON=function(t,n,r){if(n===void 0){n={}}if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");var i=[];if(r){var o=function(e){var n=r[e],o=t[e];i.push(n.init((function(e){return n.spec.fromJSON(o,e)})))};for(var a in r){o(a)}}return e.create({doc:t.doc,selection:EditorSelection.fromJSON(t.selection),extensions:n.extensions?i.concat([n.extensions]):i})};e.create=function(t){if(t===void 0){t={}}var n=Configuration.resolve(t.extensions||[],new Map);var r=t.doc instanceof Text?t.doc:Text.of((t.doc||"").split(n.staticFacet(e.lineSeparator)||DefaultSplit));var i=!t.selection?EditorSelection.single(0):t.selection instanceof EditorSelection?t.selection:EditorSelection.single(t.selection.anchor,t.selection.head);checkSelection(i,r.length);if(!n.staticFacet(allowMultipleSelections))i=i.asSingle();return new e(n,r,i)};Object.defineProperty(e.prototype,"tabSize",{get:function(){return this.facet(e.tabSize)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lineBreak",{get:function(){return this.facet(e.lineSeparator)||"\n"},enumerable:false,configurable:true});e.prototype.phrase=function(t){for(var n=0,r=this.facet(e.phrases);n<r.length;n++){var i=r[n];if(Object.prototype.hasOwnProperty.call(i,t))return i[t]}return t};e.prototype.languageDataAt=function(e,t){var n=[];for(var r=0,i=this.facet(languageData);r<i.length;r++){var o=i[r];for(var a=0,s=o(this,t);a<s.length;a++){var c=s[a];if(Object.prototype.hasOwnProperty.call(c,e))n.push(c[e])}}return n};e.prototype.charCategorizer=function(e){return makeCategorizer(this.languageDataAt("wordChars",e).join(""))};e.prototype.wordAt=function(e){var t=this.doc.lineAt(e),n=t.text,r=t.from,i=t.length;var o=this.charCategorizer(e);var a=e-r,s=e-r;while(a>0){var c=findClusterBreak(n,a,false);if(o(n.slice(c,a))!=CharCategory.Word)break;a=c}while(s<i){var u=findClusterBreak(n,s);if(o(n.slice(s,u))!=CharCategory.Word)break;s=u}return a==s?EditorSelection.range(a+r,s+r):null};return e}();EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:function(e){return e.length?e[0]:4}});EditorState.lineSeparator=lineSeparator;EditorState.phrases=Facet.define();EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(e,t,n){if(n===void 0){n={}}var r={};for(var i=0,o=e;i<o.length;i++){var a=o[i];for(var s=0,c=Object.keys(a);s<c.length;s++){var u=c[s];var l=a[u],f=r[u];if(f===undefined)r[u]=l;else if(f===l||l===undefined);else if(Object.hasOwnProperty.call(n,u))r[u]=n[u](f,l);else throw new Error("Config merge conflict for field "+u)}}for(var u in t)if(r[u]===undefined)r[u]=t[u];return r}var C="ͼ";var COUNT=typeof Symbol=="undefined"?"__"+C:Symbol.for(C);var SET=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet");var top=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};var StyleModule=function(){function e(e,t){this.rules=[];var n=(t||{}).finish;function r(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function i(e,t,o,a){var s=[],c=/^@(\w+)\b/.exec(e[0]),u=c&&c[1]=="keyframes";if(c&&t==null)return o.push(e[0]+";");for(var l in t){var f=t[l];if(/&/.test(l)){i(l.split(/,\s*/).map((function(t){return e.map((function(e){return t.replace(/&/,e)}))})).reduce((function(e,t){return e.concat(t)})),f,o)}else if(f&&typeof f=="object"){if(!c)throw new RangeError("The value of a property ("+l+") should be a primitive value.");i(r(l),f,s,u)}else if(f!=null){s.push(l.replace(/_.*/,"").replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()}))+": "+f+";")}}if(s.length||u){o.push((n&&!c&&!a?e.map(n):e).join(", ")+" {"+s.join(" ")+"}")}}for(var o in e)i(r(o),e[o],this.rules)}e.prototype.getRules=function(){return this.rules.join("\n")};e.newName=function(){var e=top[COUNT]||1;top[COUNT]=e+1;return C+e.toString(36)};e.mount=function(e,t){(e[SET]||new StyleSet(e)).mount(Array.isArray(t)?t:[t])};return e}();var adoptedSet=null;var StyleSet=function(){function e(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(adoptedSet){e.adoptedStyleSheets=[adoptedSet.sheet].concat(e.adoptedStyleSheets);return e[SET]=adoptedSet}this.sheet=new CSSStyleSheet;e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets);adoptedSet=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");var t=e.head||e;t.insertBefore(this.styleTag,t.firstChild)}this.modules=[];e[SET]=this}e.prototype.mount=function(e){var t=this.sheet;var n=0,r=0;for(var i=0;i<e.length;i++){var o=e[i],a=this.modules.indexOf(o);if(a<r&&a>-1){this.modules.splice(a,1);r--;a=-1}if(a==-1){this.modules.splice(r++,0,o);if(t)for(var s=0;s<o.rules.length;s++)t.insertRule(o.rules[s],n++)}else{while(r<a)n+=this.modules[r++].rules.length;n+=o.rules.length;r++}}if(!t){var c="";for(var u=0;u<this.modules.length;u++)c+=this.modules[u].getRules()+"\n";this.styleTag.textContent=c}};return e}();var RangeValue=function(){function e(){}e.prototype.eq=function(e){return this==e};e.prototype.range=function(e,t){if(t===void 0){t=e}return new Range(e,t,this)};return e}();RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=false;RangeValue.prototype.mapMode=MapMode.TrackDel;var Range=function(){function e(e,t,n){this.from=e;this.to=t;this.value=n}return e}();function cmpRange(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}var Chunk=function(){function e(e,t,n,r){this.from=e;this.to=t;this.value=n;this.maxPoint=r}Object.defineProperty(e.prototype,"length",{get:function(){return this.to[this.to.length-1]},enumerable:false,configurable:true});e.prototype.findIndex=function(e,t,n,r){if(n===void 0){n=t*1e9}if(r===void 0){r=0}if(e<=0)return r;var i=t<0?this.to:this.from;for(var o=r,a=i.length;;){if(o==a)return o;var s=o+a>>1;var c=i[s]-e||(t<0?this.value[s].startSide:this.value[s].endSide)-n;if(s==o)return c>=0?o:a;if(c>=0)a=s;else o=s+1}};e.prototype.between=function(e,t,n,r){for(var i=this.findIndex(t,-1),o=this.findIndex(n,1,undefined,i);i<o;i++)if(r(this.from[i]+e,this.to[i]+e,this.value[i])===false)return false};e.prototype.map=function(t,n){var r=[],i=[],o=[],a=-1,s=-1;for(var c=0;c<this.value.length;c++){var u=this.value[c],l=this.from[c]+t,f=this.to[c]+t,h=void 0,d=void 0;if(l==f){var p=n.mapPos(l,u.startSide,u.mapMode);if(p==null)continue;h=d=p}else{h=n.mapPos(l,u.startSide);d=n.mapPos(f,u.endSide);if(h>d||h==d&&u.startSide>0&&u.endSide<=0)continue}if((d-h||u.endSide-u.startSide)<0)continue;if(a<0)a=h;if(u.point)s=Math.max(s,d-h);r.push(u);i.push(h-a);o.push(d-a)}return{mapped:r.length?new e(i,o,r,s):null,pos:a}};return e}();var RangeSet=function(){function e(t,n,r,i){if(r===void 0){r=e.empty}this.chunkPos=t;this.chunk=n;this.nextLayer=r;this.maxPoint=i}Object.defineProperty(e.prototype,"length",{get:function(){var e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"size",{get:function(){if(this.isEmpty)return 0;var e=this.nextLayer.size;for(var t=0,n=this.chunk;t<n.length;t++){var r=n[t];e+=r.value.length}return e},enumerable:false,configurable:true});e.prototype.chunkEnd=function(e){return this.chunkPos[e]+this.chunk[e].length};e.prototype.update=function(t){var n=t.add,r=n===void 0?[]:n,i=t.sort,o=i===void 0?false:i,a=t.filterFrom,s=a===void 0?0:a,c=t.filterTo,u=c===void 0?this.length:c;var l=t.filter;if(r.length==0&&!l)return this;if(o)r.slice().sort(cmpRange);if(this.isEmpty)return r.length?e.of(r):this;var f=new LayerCursor(this,null,-1).goto(0),h=0,d=[];var p=new RangeSetBuilder;while(f.value||h<r.length){if(h<r.length&&(f.from-r[h].from||f.startSide-r[h].value.startSide)>=0){var v=r[h++];if(!p.addInner(v.from,v.to,v.value))d.push(v)}else if(f.rangeIndex==1&&f.chunkIndex<this.chunk.length&&(h==r.length||this.chunkEnd(f.chunkIndex)<r[h].from)&&(!l||s>this.chunkEnd(f.chunkIndex)||u<this.chunkPos[f.chunkIndex])&&p.addChunk(this.chunkPos[f.chunkIndex],this.chunk[f.chunkIndex])){f.nextChunk()}else{if(!l||s>f.to||u<f.from||l(f.from,f.to,f.value)){if(!p.addInner(f.from,f.to,f.value))d.push(new Range(f.from,f.to,f.value))}f.next()}}return p.finishInner(this.nextLayer.isEmpty&&!d.length?e.empty:this.nextLayer.update({add:d,filter:l,filterFrom:s,filterTo:u}))};e.prototype.map=function(t){if(t.length==0||this.isEmpty)return this;var n=[],r=[],i=-1;for(var o=0;o<this.chunk.length;o++){var a=this.chunkPos[o],s=this.chunk[o];var c=t.touchesRange(a,a+s.length);if(c===false){i=Math.max(i,s.maxPoint);n.push(s);r.push(t.mapPos(a))}else if(c===true){var u=s.map(a,t),l=u.mapped,f=u.pos;if(l){i=Math.max(i,l.maxPoint);n.push(l);r.push(f)}}}var h=this.nextLayer.map(t);return n.length==0?h:new e(r,n,h,i)};e.prototype.between=function(e,t,n){if(this.isEmpty)return;for(var r=0;r<this.chunk.length;r++){var i=this.chunkPos[r],o=this.chunk[r];if(t>=i&&e<=i+o.length&&o.between(i,e-i,t-i,n)===false)return}this.nextLayer.between(e,t,n)};e.prototype.iter=function(e){if(e===void 0){e=0}return HeapCursor.from([this]).goto(e)};Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.nextLayer==this},enumerable:false,configurable:true});e.iter=function(e,t){if(t===void 0){t=0}return HeapCursor.from(e).goto(t)};e.compare=function(e,t,n,r,i){if(i===void 0){i=-1}var o=e.filter((function(e){return e.maxPoint>=500||!e.isEmpty&&t.indexOf(e)<0&&e.maxPoint>=i}));var a=t.filter((function(t){return t.maxPoint>=500||!t.isEmpty&&e.indexOf(t)<0&&t.maxPoint>=i}));var s=findSharedChunks(o,a);var c=new SpanCursor(o,s,i);var u=new SpanCursor(a,s,i);n.iterGaps((function(e,t,n){return compare(c,e,u,t,n,r)}));if(n.empty&&n.length==0)compare(c,0,u,0,0,r)};e.eq=function(e,t,n,r){if(n===void 0){n=0}if(r==null)r=1e9;var i=e.filter((function(e){return!e.isEmpty&&t.indexOf(e)<0}));var o=t.filter((function(t){return!t.isEmpty&&e.indexOf(t)<0}));if(i.length!=o.length)return false;if(!i.length)return true;var a=findSharedChunks(i,o);var s=new SpanCursor(i,a,0).goto(n),c=new SpanCursor(o,a,0).goto(n);for(;;){if(s.to!=c.to||!sameValues(s.active,c.active)||s.point&&(!c.point||!s.point.eq(c.point)))return false;if(s.to>=r)return true;s.next();c.next()}};e.spans=function(e,t,n,r,i){if(i===void 0){i=-1}var o=new SpanCursor(e,null,i).goto(t),a=t;var s=o.openStart;for(;;){var c=Math.min(o.to,n);if(o.point){r.point(a,c,o.point,o.activeForPoint(o.to),s);s=o.openEnd(c)+(o.to>c?1:0)}else if(c>a){r.span(a,c,o.active,s);s=o.openEnd(c)}if(o.to>n)break;a=o.to;o.next()}return s};e.of=function(e,t){if(t===void 0){t=false}var n=new RangeSetBuilder;for(var r=0,i=e instanceof Range?[e]:t?e.slice().sort(cmpRange):e;r<i.length;r++){var o=i[r];n.add(o.from,o.to,o.value)}return n.finish()};return e}();RangeSet.empty=new RangeSet([],[],null,-1);RangeSet.empty.nextLayer=RangeSet.empty;var RangeSetBuilder=function(){function e(){this.chunks=[];this.chunkPos=[];this.chunkStart=-1;this.last=null;this.lastFrom=-1e9;this.lastTo=-1e9;this.from=[];this.to=[];this.value=[];this.maxPoint=-1;this.setMaxPoint=-1;this.nextLayer=null}e.prototype.finishChunk=function(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint));this.chunkPos.push(this.chunkStart);this.chunkStart=-1;this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint);this.maxPoint=-1;if(e){this.from=[];this.to=[];this.value=[]}};e.prototype.add=function(t,n,r){if(!this.addInner(t,n,r))(this.nextLayer||(this.nextLayer=new e)).add(t,n,r)};e.prototype.addInner=function(e,t,n){var r=e-this.lastTo||n.startSide-this.last.endSide;if(r<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");if(r<0)return false;if(this.from.length==250)this.finishChunk(true);if(this.chunkStart<0)this.chunkStart=e;this.from.push(e-this.chunkStart);this.to.push(t-this.chunkStart);this.last=n;this.lastFrom=e;this.lastTo=t;this.value.push(n);if(n.point)this.maxPoint=Math.max(this.maxPoint,t-e);return true};e.prototype.addChunk=function(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return false;if(this.from.length)this.finishChunk(true);this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint);this.chunks.push(t);this.chunkPos.push(e);var n=t.value.length-1;this.last=t.value[n];this.lastFrom=t.from[n]+e;this.lastTo=t.to[n]+e;return true};e.prototype.finish=function(){return this.finishInner(RangeSet.empty)};e.prototype.finishInner=function(e){if(this.from.length)this.finishChunk(false);if(this.chunks.length==0)return e;var t=new RangeSet(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);this.from=null;return t};return e}();function findSharedChunks(e,t){var n=new Map;for(var r=0,i=e;r<i.length;r++){var o=i[r];for(var a=0;a<o.chunk.length;a++)if(o.chunk[a].maxPoint<500)n.set(o.chunk[a],o.chunkPos[a])}var s=new Set;for(var c=0,u=t;c<u.length;c++){var o=u[c];for(var l=0;l<o.chunk.length;l++)if(n.get(o.chunk[l])==o.chunkPos[l])s.add(o.chunk[l])}return s}var LayerCursor=function(){function e(e,t,n,r){if(r===void 0){r=0}this.layer=e;this.skip=t;this.minPoint=n;this.rank=r}Object.defineProperty(e.prototype,"startSide",{get:function(){return this.value?this.value.startSide:0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"endSide",{get:function(){return this.value?this.value.endSide:0},enumerable:false,configurable:true});e.prototype.goto=function(e,t){if(t===void 0){t=-1e9}this.chunkIndex=this.rangeIndex=0;this.gotoInner(e,t,false);return this};e.prototype.gotoInner=function(e,t,n){while(this.chunkIndex<this.layer.chunk.length){var r=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(r)||this.layer.chunkEnd(this.chunkIndex)<e||r.maxPoint<this.minPoint))break;this.chunkIndex++;n=false}var i=this.chunkIndex==this.layer.chunk.length?0:this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],-1,t);if(!n||this.rangeIndex<i)this.rangeIndex=i;this.next()};e.prototype.forward=function(e,t){if((this.to-e||this.endSide-t)<0)this.gotoInner(e,t,true)};e.prototype.next=function(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9;this.value=null;break}else{var e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex];var n=e+t.from[this.rangeIndex];this.from=n;this.to=e+t.to[this.rangeIndex];this.value=t.value[this.rangeIndex];if(++this.rangeIndex==t.value.length){this.chunkIndex++;if(this.skip){while(this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]))this.chunkIndex++}this.rangeIndex=0}if(this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}};e.prototype.nextChunk=function(){this.chunkIndex++;this.rangeIndex=0;this.next()};e.prototype.compare=function(e){return this.from-e.from||this.startSide-e.startSide||this.to-e.to||this.endSide-e.endSide};return e}();var HeapCursor=function(){function e(e){this.heap=e}e.from=function(t,n,r){if(n===void 0){n=null}if(r===void 0){r=-1}var i=[];for(var o=0;o<t.length;o++){for(var a=t[o];!a.isEmpty;a=a.nextLayer){if(a.maxPoint>=r)i.push(new LayerCursor(a,n,r,o))}}return i.length==1?i[0]:new e(i)};Object.defineProperty(e.prototype,"startSide",{get:function(){return this.value?this.value.startSide:0},enumerable:false,configurable:true});e.prototype.goto=function(e,t){if(t===void 0){t=-1e9}for(var n=0,r=this.heap;n<r.length;n++){var i=r[n];i.goto(e,t)}for(var o=this.heap.length>>1;o>=0;o--)heapBubble(this.heap,o);this.next();return this};e.prototype.forward=function(e,t){for(var n=0,r=this.heap;n<r.length;n++){var i=r[n];i.forward(e,t)}for(var o=this.heap.length>>1;o>=0;o--)heapBubble(this.heap,o);if((this.to-e||this.value.endSide-t)<0)this.next()};e.prototype.next=function(){if(this.heap.length==0){this.from=this.to=1e9;this.value=null;this.rank=-1}else{var e=this.heap[0];this.from=e.from;this.to=e.to;this.value=e.value;this.rank=e.rank;if(e.value)e.next();heapBubble(this.heap,0)}};return e}();function heapBubble(e,t){for(var n=e[t];;){var r=(t<<1)+1;if(r>=e.length)break;var i=e[r];if(r+1<e.length&&i.compare(e[r+1])>=0){i=e[r+1];r++}if(n.compare(i)<0)break;e[r]=n;e[t]=i;t=r}}var SpanCursor=function(){function e(e,t,n){this.minPoint=n;this.active=[];this.activeTo=[];this.activeRank=[];this.minActive=-1;this.point=null;this.pointFrom=0;this.pointRank=0;this.to=-1e9;this.endSide=0;this.openStart=-1;this.cursor=HeapCursor.from(e,t,n)}e.prototype.goto=function(e,t){if(t===void 0){t=-1e9}this.cursor.goto(e,t);this.active.length=this.activeTo.length=this.activeRank.length=0;this.minActive=-1;this.to=e;this.endSide=t;this.openStart=-1;this.next();return this};e.prototype.forward=function(e,t){while(this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0)this.removeActive(this.minActive);this.cursor.forward(e,t)};e.prototype.removeActive=function(e){remove(this.active,e);remove(this.activeTo,e);remove(this.activeRank,e);this.minActive=findMinIndex(this.active,this.activeTo)};e.prototype.addActive=function(e){var t=0,n=this.cursor,r=n.value,i=n.to,o=n.rank;while(t<this.activeRank.length&&this.activeRank[t]<=o)t++;insert(this.active,t,r);insert(this.activeTo,t,i);insert(this.activeRank,t,o);if(e)insert(e,t,this.cursor.from);this.minActive=findMinIndex(this.active,this.activeTo)};e.prototype.next=function(){var e=this.to,t=this.point;this.point=null;var n=this.openStart<0?[]:null,r=0;for(;;){var i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>e){this.to=this.activeTo[i];this.endSide=this.active[i].endSide;break}this.removeActive(i);if(n)remove(n,i)}else if(!this.cursor.value){this.to=this.endSide=1e9;break}else if(this.cursor.from>e){this.to=this.cursor.from;this.endSide=this.cursor.startSide;break}else{var o=this.cursor.value;if(!o.point){this.addActive(n);this.cursor.next()}else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to&&o.endSide==this.endSide){this.cursor.next()}else{this.point=o;this.pointFrom=this.cursor.from;this.pointRank=this.cursor.rank;this.to=this.cursor.to;this.endSide=o.endSide;if(this.cursor.from<e)r=1;this.cursor.next();if(this.to>e)this.forward(this.to,this.endSide);break}}}if(n){var a=0;while(a<n.length&&n[a]<e)a++;this.openStart=a+r}};e.prototype.activeForPoint=function(e){if(!this.active.length)return this.active;var t=[];for(var n=this.active.length-1;n>=0;n--){if(this.activeRank[n]<this.pointRank)break;if(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>this.point.endSide)t.push(this.active[n])}return t.reverse()};e.prototype.openEnd=function(e){var t=0;for(var n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)t++;return t};return e}();function compare(e,t,n,r,i,o){e.goto(t);n.goto(r);var a=r+i;var s=r,c=r-t;for(;;){var u=e.to+c-n.to||e.endSide-n.endSide;var l=u<0?e.to+c:n.to,f=Math.min(l,a);if(e.point||n.point){if(!(e.point&&n.point&&(e.point==n.point||e.point.eq(n.point))))o.comparePoint(s,f,e.point,n.point)}else{if(f>s&&!sameValues(e.active,n.active))o.compareRange(s,f,e.active,n.active)}if(l>a)break;s=l;if(u<=0)e.next();if(u>=0)n.next()}}function sameValues(e,t){if(e.length!=t.length)return false;for(var n=0;n<e.length;n++)if(e[n]!=t[n]&&!e[n].eq(t[n]))return false;return true}function remove(e,t){for(var n=t,r=e.length-1;n<r;n++)e[n]=e[n+1];e.pop()}function insert(e,t,n){for(var r=e.length-1;r>=t;r--)e[r+1]=e[r];e[t]=n}function findMinIndex(e,t){var n=-1,r=1e9;for(var i=0;i<t.length;i++)if((t[i]-r||e[i].endSide-e[n].endSide)<0){n=i;r=t[i]}return n}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"};var shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"};var chrome$1=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent);var safari$1=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor);var gecko$1=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent);var mac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);var ie$1=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);var brokenModifierNames=chrome$1&&(mac||+chrome$1[1]<57)||gecko$1&&mac;for(var i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++){base[i]=String.fromCharCode(i+32);shift[i]=String.fromCharCode(i)}for(var code in base)if(!shift.hasOwnProperty(code))shift[code]=base[code];function keyName(e){var t=brokenModifierNames&&(e.ctrlKey||e.altKey||e.metaKey)||(safari$1||ie$1)&&e.shiftKey&&e.key&&e.key.length==1;var n=!t&&e.key||(e.shiftKey?shift:base)[e.keyCode]||e.key||"Unidentified";if(n=="Esc")n="Escape";if(n=="Del")n="Delete";if(n=="Left")n="ArrowLeft";if(n=="Up")n="ArrowUp";if(n=="Right")n="ArrowRight";if(n=="Down")n="ArrowDown";return n}function getSelection(e){return e.getSelection?e.getSelection():document.getSelection()}function contains(e,t){return t?e.contains(t.nodeType!=1?t.parentNode:t):false}function deepActiveElement(){var e=document.activeElement;while(e&&e.shadowRoot)e=e.shadowRoot.activeElement;return e}function hasSelection(e,t){if(!t.anchorNode)return false;try{return contains(e,t.anchorNode)}catch(_){return false}}function clientRectsFor(e){if(e.nodeType==3)return textRange(e,0,e.nodeValue.length).getClientRects();else if(e.nodeType==1)return e.getClientRects();else return[]}function isEquivalentPosition(e,t,n,r){return n?scanFor(e,t,n,r,-1)||scanFor(e,t,n,r,1):false}function domIndex(e){for(var t=0;;t++){e=e.previousSibling;if(!e)return t}}function scanFor(e,t,n,r,i){for(;;){if(e==n&&t==r)return true;if(t==(i<0?0:maxOffset(e))){if(e.nodeName=="DIV")return false;var o=e.parentNode;if(!o||o.nodeType!=1)return false;t=domIndex(e)+(i<0?0:1);e=o}else if(e.nodeType==1){e=e.childNodes[t+(i<0?-1:0)];if(e.nodeType==1&&e.contentEditable=="false")return false;t=i<0?maxOffset(e):0}else{return false}}}function maxOffset(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}var Rect0={left:0,right:0,top:0,bottom:0};function flattenRect(e,t){var n=t?e.left:e.right;return{left:n,right:n,top:e.top,bottom:e.bottom}}function windowRect(e){return{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}var ScrollSpace=5;function scrollRectIntoView(e,t){var n=e.ownerDocument,r=n.defaultView;for(var i=e.parentNode;i;){if(i.nodeType==1){var o=void 0,a=i==document.body;if(a){o=windowRect(r)}else{if(i.scrollHeight<=i.clientHeight&&i.scrollWidth<=i.clientWidth){i=i.parentNode;continue}var s=i.getBoundingClientRect();o={left:s.left,right:s.left+i.clientWidth,top:s.top,bottom:s.top+i.clientHeight}}var c=0,u=0;if(t.top<o.top)u=-(o.top-t.top+ScrollSpace);else if(t.bottom>o.bottom)u=t.bottom-o.bottom+ScrollSpace;if(t.left<o.left)c=-(o.left-t.left+ScrollSpace);else if(t.right>o.right)c=t.right-o.right+ScrollSpace;if(c||u){if(a){r.scrollBy(c,u)}else{if(u){var l=i.scrollTop;i.scrollTop+=u;u=i.scrollTop-l}if(c){var l=i.scrollLeft;i.scrollLeft+=c;c=i.scrollLeft-l}t={left:t.left-c,top:t.top-u,right:t.right-c,bottom:t.bottom-u}}}if(a)break;i=i.assignedSlot||i.parentNode}else if(i.nodeType==11){i=i.host}else{break}}}var DOMSelection=function(){function e(){this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0}e.prototype.eq=function(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset};e.prototype.set=function(e){this.anchorNode=e.anchorNode;this.anchorOffset=e.anchorOffset;this.focusNode=e.focusNode;this.focusOffset=e.focusOffset};return e}();var preventScrollSupported=null;function focusPreventScroll(e){if(e.setActive)return e.setActive();if(preventScrollSupported)return e.focus(preventScrollSupported);var t=[];for(var n=e;n;n=n.parentNode){t.push(n,n.scrollTop,n.scrollLeft);if(n==n.ownerDocument)break}e.focus(preventScrollSupported==null?{get preventScroll(){preventScrollSupported={preventScroll:true};return true}}:undefined);if(!preventScrollSupported){preventScrollSupported=false;for(var r=0;r<t.length;){var i=t[r++],o=t[r++],a=t[r++];if(i.scrollTop!=o)i.scrollTop=o;if(i.scrollLeft!=a)i.scrollLeft=a}}}var scratchRange;function textRange(e,t,n){if(n===void 0){n=t}var r=scratchRange||(scratchRange=document.createRange());r.setEnd(e,n);r.setStart(e,t);return r}function dispatchKey(e,t,n){var r={key:t,code:t,keyCode:n,which:n,cancelable:true};var i=new KeyboardEvent("keydown",r);i.synthetic=true;e.dispatchEvent(i);var o=new KeyboardEvent("keyup",r);o.synthetic=true;e.dispatchEvent(o);return i.defaultPrevented||o.defaultPrevented}var DOMPos=function(){function e(e,t,n){if(n===void 0){n=true}this.node=e;this.offset=t;this.precise=n}e.before=function(t,n){return new e(t.parentNode,domIndex(t),n)};e.after=function(t,n){return new e(t.parentNode,domIndex(t)+1,n)};return e}();var none$3=[];var ContentView=function(){function e(){this.parent=null;this.dom=null;this.dirty=2}Object.defineProperty(e.prototype,"editorView",{get:function(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"overrideDOMText",{get:function(){return null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"posAtStart",{get:function(){return this.parent?this.parent.posBefore(this):0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"posAtEnd",{get:function(){return this.posAtStart+this.length},enumerable:false,configurable:true});e.prototype.posBefore=function(e){var t=this.posAtStart;for(var n=0,r=this.children;n<r.length;n++){var i=r[n];if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")};e.prototype.posAfter=function(e){return this.posBefore(e)+e.length};e.prototype.coordsAt=function(e,t){return null};e.prototype.sync=function(t){var n;if(this.dirty&2){var r=this.dom,i=null;for(var o=0,a=this.children;o<a.length;o++){var s=a[o];if(s.dirty){var c=i?i.nextSibling:r.firstChild;if(!s.dom&&c&&!((n=e.get(c))===null||n===void 0?void 0:n.parent))s.reuseDOM(c);s.sync(t);s.dirty=0}if(t&&t.node==r&&i!=s.dom)t.written=true;syncNodeInto(r,i,s.dom);i=s.dom}var u=i?i.nextSibling:r.firstChild;if(u&&t&&t.node==r)t.written=true;while(u)u=rm$1(u)}else if(this.dirty&1){for(var l=0,f=this.children;l<f.length;l++){var s=f[l];if(s.dirty){s.sync(t);s.dirty=0}}}};e.prototype.reuseDOM=function(e){return false};e.prototype.localPosFromDOM=function(t,n){var r;if(t==this.dom){r=this.dom.childNodes[n]}else{var i=maxOffset(t)==0?0:n==0?-1:1;for(;;){var o=t.parentNode;if(o==this.dom)break;if(i==0&&o.firstChild!=o.lastChild){if(t==o.firstChild)i=-1;else i=1}t=o}if(i<0)r=t;else r=t.nextSibling}if(r==this.dom.firstChild)return 0;while(r&&!e.get(r))r=r.nextSibling;if(!r)return this.length;for(var a=0,s=0;;a++){var c=this.children[a];if(c.dom==r)return s;s+=c.length+c.breakAfter}};e.prototype.domBoundsAround=function(e,t,n){if(n===void 0){n=0}var r=-1,i=-1,o=-1,a=-1;for(var s=0,c=n,u=n;s<this.children.length;s++){var l=this.children[s],f=c+l.length;if(c<e&&f>t)return l.domBoundsAround(e,t,c);if(f>=e&&r==-1){r=s;i=c}if(c>t&&l.dom.parentNode==this.dom){o=s;a=u;break}u=f;c=f+l.breakAfter}return{from:i,to:a<0?n+this.length:a,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}};e.prototype.markDirty=function(e){if(e===void 0){e=false}if(this.dirty&2)return;this.dirty|=2;this.markParentsDirty(e)};e.prototype.markParentsDirty=function(e){for(var t=this.parent;t;t=t.parent){if(e)t.dirty|=2;if(t.dirty&1)return;t.dirty|=1;e=false}};e.prototype.setParent=function(e){if(this.parent!=e){this.parent=e;if(this.dirty)this.markParentsDirty(true)}};e.prototype.setDOM=function(e){this.dom=e;e.cmView=this};Object.defineProperty(e.prototype,"rootView",{get:function(){for(var e=this;;){var t=e.parent;if(!t)return e;e=t}},enumerable:false,configurable:true});e.prototype.replaceChildren=function(e,t,n){var r;if(n===void 0){n=none$3}this.markDirty();for(var i=e;i<t;i++){var o=this.children[i];if(o.parent==this)o.parent=null}(r=this.children).splice.apply(r,__spreadArray([e,t-e],n));for(var a=0;a<n.length;a++)n[a].setParent(this)};e.prototype.ignoreMutation=function(e){return false};e.prototype.ignoreEvent=function(e){return false};e.prototype.childCursor=function(e){if(e===void 0){e=this.length}return new ChildCursor(this.children,e,this.children.length)};e.prototype.childPos=function(e,t){if(t===void 0){t=1}return this.childCursor().findPos(e,t)};e.prototype.toString=function(){var e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")};e.get=function(e){return e.cmView};return e}();ContentView.prototype.breakAfter=0;function rm$1(e){var t=e.nextSibling;e.parentNode.removeChild(e);return t}function syncNodeInto(e,t,n){var r=t?t.nextSibling:e.firstChild;if(n.parentNode==e)while(r!=n)r=rm$1(r);else e.insertBefore(n,r)}var ChildCursor=function(){function e(e,t,n){this.children=e;this.pos=t;this.i=n;this.off=0}e.prototype.findPos=function(e,t){if(t===void 0){t=1}for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=e-this.pos;return this}var n=this.children[--this.i];this.pos-=n.length+n.breakAfter}};return e}();var _d=typeof navigator!="undefined"?[navigator,document]:[{userAgent:"",vendor:"",platform:""},{documentElement:{style:{}}}],nav=_d[0],doc=_d[1];var ie_edge=/Edge\/(\d+)/.exec(nav.userAgent);var ie_upto10=/MSIE \d/.test(nav.userAgent);var ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent);var ie=!!(ie_upto10||ie_11up||ie_edge);var gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent);var chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent);var webkit="webkitFontSmoothing"in doc.documentElement.style;var safari=!ie&&/Apple Computer/.test(nav.vendor);var browser={mac:/Mac/.test(nav.platform),ie:ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko:gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios:safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2),android:/Android\b/.test(nav.userAgent),webkit:webkit,safari:safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var none$2=[];var InlineView=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.become=function(e){return false};t.prototype.getSide=function(){return 0};return t}(ContentView);InlineView.prototype.children=none$2;var MaxJoinLen=256;var TextView=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.text=t;return n}Object.defineProperty(t.prototype,"length",{get:function(){return this.text.length},enumerable:false,configurable:true});t.prototype.createDOM=function(e){this.setDOM(e||document.createTextNode(this.text))};t.prototype.sync=function(e){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(e&&e.node==this.dom)e.written=true;this.dom.nodeValue=this.text}};t.prototype.reuseDOM=function(e){if(e.nodeType!=3)return false;this.createDOM(e);return true};t.prototype.merge=function(e,n,r){if(r&&(!(r instanceof t)||this.length-(n-e)+r.length>MaxJoinLen))return false;this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(n);this.markDirty();return true};t.prototype.slice=function(e){return new t(this.text.slice(e))};t.prototype.localPosFromDOM=function(e,t){return e==this.dom?t:t?this.text.length:0};t.prototype.domAtPos=function(e){return new DOMPos(this.dom,e)};t.prototype.domBoundsAround=function(e,t,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}};t.prototype.coordsAt=function(e,t){return textCoords(this.dom,e,t)};return t}(InlineView);var MarkView=function(e){__extends(t,e);function t(t,n,r){if(n===void 0){n=[]}if(r===void 0){r=0}var i=e.call(this)||this;i.mark=t;i.children=n;i.length=r;for(var o=0,a=n;o<a.length;o++){var s=a[o];s.setParent(i)}return i}t.prototype.createDOM=function(){var e=document.createElement(this.mark.tagName);if(this.mark.class)e.className=this.mark.class;if(this.mark.attrs)for(var t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);this.setDOM(e)};t.prototype.sync=function(t){if(!this.dom)this.createDOM();e.prototype.sync.call(this,t)};t.prototype.merge=function(e,n,r,i,o){if(r&&(!(r instanceof t&&r.mark.eq(this.mark))||e&&i<=0||n<this.length&&o<=0))return false;mergeInlineChildren(this,e,n,r?r.children:none$2,i-1,o-1);this.markDirty();return true};t.prototype.slice=function(e){return new t(this.mark,sliceInlineChildren(this.children,e),this.length-e)};t.prototype.domAtPos=function(e){return inlineDOMAtPos(this.dom,this.children,e)};t.prototype.coordsAt=function(e,t){return coordsInChildren(this,e,t)};return t}(InlineView);function textCoords(e,t,n){var r=e.nodeValue.length;if(t>r)t=r;var i=t,o=t,a=0;if(t==0&&n<0||t==r&&n>=0){if(!(browser.chrome||browser.gecko)){if(t){i--;a=1}else{o++;a=-1}}}else{if(n<0)i--;else o++}var s=textRange(e,i,o).getClientRects();if(!s.length)return Rect0;var c=s[(a?a<0:n>=0)?0:s.length-1];if(browser.safari&&!a&&c.width==0)c=Array.prototype.find.call(s,(function(e){return e.width}))||c;return a?flattenRect(c,a<0):c}var WidgetView=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this)||this;i.widget=t;i.length=n;i.side=r;return i}t.create=function(e,n,r){return new(e.customView||t)(e,n,r)};t.prototype.slice=function(e){return t.create(this.widget,this.length-e,this.side)};t.prototype.sync=function(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false"}};t.prototype.getSide=function(){return this.side};t.prototype.merge=function(e,n,r,i,o){if(r&&(!(r instanceof t)||!this.widget.compare(r.widget)||e>0&&i<=0||n<this.length&&o<=0))return false;this.length=e+(r?r.length:0)+(this.length-n);return true};t.prototype.become=function(e){if(e.length==this.length&&e instanceof t&&e.side==this.side){if(this.widget.constructor==e.widget.constructor){if(!this.widget.eq(e.widget))this.markDirty(true);this.widget=e.widget;return true}}return false};t.prototype.ignoreMutation=function(){return true};t.prototype.ignoreEvent=function(e){return this.widget.ignoreEvent(e)};Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){if(this.length==0)return Text.empty;var e=this;while(e.parent)e=e.parent;var t=e.editorView,n=t&&t.state.doc,r=this.posAtStart;return n?n.slice(r,r+this.length):Text.empty},enumerable:false,configurable:true});t.prototype.domAtPos=function(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)};t.prototype.domBoundsAround=function(){return null};t.prototype.coordsAt=function(e,t){var n=this.dom.getClientRects(),r=null;if(!n.length)return Rect0;for(var i=e>0?n.length-1:0;;i+=e>0?-1:1){r=n[i];if(e>0?i==0:i==n.length-1||r.top<r.bottom)break}return e==0&&t>0||e==this.length&&t<=0?r:flattenRect(r,e==0)};return t}(InlineView);var CompositionView=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.domAtPos=function(e){return new DOMPos(this.widget.text,e)};t.prototype.sync=function(){if(!this.dom)this.setDOM(this.widget.toDOM())};t.prototype.localPosFromDOM=function(e,t){return!t?0:e.nodeType==3?Math.min(t,this.length):this.length};t.prototype.ignoreMutation=function(){return false};Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){return null},enumerable:false,configurable:true});t.prototype.coordsAt=function(e,t){return textCoords(this.widget.text,e,t)};return t}(WidgetView);function mergeInlineChildren(e,t,n,r,i,o){var a=e.childCursor();var s=a.findPos(n,1),c=s.i,u=s.off;var l=a.findPos(t,-1),f=l.i,h=l.off;var d=t-n;for(var p=0,v=r;p<v.length;p++){var m=v[p];d+=m.length}e.length+=d;var g=e.children;if(f==c&&h){var y=g[f];if(r.length==1&&y.merge(h,u,r[0],i,o))return;if(r.length==0){y.merge(h,u,null,i,o);return}var b=y.slice(u);if(b.merge(0,0,r[r.length-1],0,o))r[r.length-1]=b;else r.push(b);c++;o=u=0}if(u){var w=g[c];if(r.length&&w.merge(0,u,r[r.length-1],0,o)){r.pop();o=r.length?0:i}else{w.merge(0,u,null,0,0)}}else if(c<g.length&&r.length&&g[c].merge(0,0,r[r.length-1],0,o)){r.pop();o=r.length?0:i}if(h){var y=g[f];if(r.length&&y.merge(h,y.length,r[0],i,0)){r.shift();i=r.length?0:o}else{y.merge(h,y.length,null,0,0)}f++}else if(f&&r.length){var w=g[f-1];if(w.merge(w.length,w.length,r[0],i,0)){r.shift();i=r.length?0:o}}while(f<c&&r.length&&g[c-1].become(r[r.length-1])){r.pop();c--;o=r.length?0:i}while(f<c&&r.length&&g[f].become(r[0])){r.shift();f++;i=r.length?0:o}if(!r.length&&f&&c<g.length&&i&&o&&g[c].merge(0,0,g[f-1],i,o))f--;if(r.length||f!=c)e.replaceChildren(f,c,r)}function sliceInlineChildren(e,t){var n=[],r=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];var s=r+a.length;if(s>t)n.push(r<t?a.slice(t-r):a);r=s}return n}function inlineDOMAtPos(e,t,n){var r=0;for(var i=0;r<t.length;r++){var o=t[r],a=i+o.length;if(a==i&&o.getSide()<=0)continue;if(n>i&&n<a&&o.dom.parentNode==e)return o.domAtPos(n-i);if(n<=i)break;i=a}for(;r>0;r--){var s=t[r-1].dom;if(s.parentNode==e)return DOMPos.after(s)}return new DOMPos(e,0)}function joinInlineInto(e,t,n){var r,i=e.children;if(n>0&&t instanceof MarkView&&i.length&&(r=i[i.length-1])instanceof MarkView&&r.mark.eq(t.mark)){joinInlineInto(r,t.children[0],n-1)}else{i.push(t);t.setParent(e)}e.length+=t.length}function coordsInChildren(e,t,n){for(var r=0,i=0;i<e.children.length;i++){var o=e.children[i],a=r+o.length;if(a==r&&o.getSide()<=0)continue;if(n<=0||a==e.length?a>=t:a>t)return o.coordsAt(t-r,n);r=a}var s=e.dom.lastChild;if(!s)return e.dom.getBoundingClientRect();var c=clientRectsFor(s);return c[c.length-1]}function combineAttrs(e,t){for(var n in e){if(n=="class"&&t.class)t.class+=" "+e.class;else if(n=="style"&&t.style)t.style+=";"+e.style;else t[n]=e[n]}return t}function attrsEq(e,t){if(e==t)return true;if(!e||!t)return false;var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return false;for(var i=0,o=n;i<o.length;i++){var a=o[i];if(r.indexOf(a)==-1||e[a]!==t[a])return false}return true}function updateAttrs(e,t,n){if(t)for(var r in t)if(!(n&&r in n))e.removeAttribute(r);if(n)for(var i in n)if(!(t&&t[i]==n[i]))e.setAttribute(i,n[i])}var WidgetType=function(){function e(){}e.prototype.eq=function(e){return false};e.prototype.updateDOM=function(e){return false};e.prototype.compare=function(e){return this==e||this.constructor==e.constructor&&this.eq(e)};Object.defineProperty(e.prototype,"estimatedHeight",{get:function(){return-1},enumerable:false,configurable:true});e.prototype.ignoreEvent=function(e){return true};Object.defineProperty(e.prototype,"customView",{get:function(){return null},enumerable:false,configurable:true});return e}();var BlockType=function(e){e[e["Text"]=0]="Text";e[e["WidgetBefore"]=1]="WidgetBefore";e[e["WidgetAfter"]=2]="WidgetAfter";e[e["WidgetRange"]=3]="WidgetRange";return e}(BlockType||(BlockType={}));var Decoration=function(e){__extends(t,e);function t(t,n,r,i){var o=e.call(this)||this;o.startSide=t;o.endSide=n;o.widget=r;o.spec=i;return o}Object.defineProperty(t.prototype,"heightRelevant",{get:function(){return false},enumerable:false,configurable:true});t.mark=function(e){return new MarkDecoration(e)};t.widget=function(e){var t=e.side||0;if(e.block)t+=(2e8+1)*(t>0?1:-1);return new PointDecoration(e,t,t,!!e.block,e.widget||null,false)};t.replace=function(e){var t=!!e.block;var n=getInclusive(e),r=n.start,i=n.end;var o=t?-2e8*(r?2:1):1e8*(r?-1:1);var a=t?2e8*(i?2:1):1e8*(i?1:-1);return new PointDecoration(e,o,a,t,e.widget||null,true)};t.line=function(e){return new LineDecoration(e)};t.set=function(e,t){if(t===void 0){t=false}return RangeSet.of(e,t)};t.prototype.hasHeight=function(){return this.widget?this.widget.estimatedHeight>-1:false};return t}(RangeValue);Decoration.none=RangeSet.empty;var MarkDecoration=function(e){__extends(t,e);function t(t){var n=this;var r=getInclusive(t),i=r.start,o=r.end;n=e.call(this,1e8*(i?-1:1),1e8*(o?1:-1),null,t)||this;n.tagName=t.tagName||"span";n.class=t.class||"";n.attrs=t.attributes||null;return n}t.prototype.eq=function(e){return this==e||e instanceof t&&this.tagName==e.tagName&&this.class==e.class&&attrsEq(this.attrs,e.attrs)};t.prototype.range=function(t,n){if(n===void 0){n=t}if(t>=n)throw new RangeError("Mark decorations may not be empty");return e.prototype.range.call(this,t,n)};return t}(Decoration);MarkDecoration.prototype.point=false;var LineDecoration=function(e){__extends(t,e);function t(t){return e.call(this,-1e8,-1e8,null,t)||this}t.prototype.eq=function(e){return e instanceof t&&attrsEq(this.spec.attributes,e.spec.attributes)};t.prototype.range=function(t,n){if(n===void 0){n=t}if(n!=t)throw new RangeError("Line decoration ranges must be zero-length");return e.prototype.range.call(this,t,n)};return t}(Decoration);LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=true;var PointDecoration=function(e){__extends(t,e);function t(t,n,r,i,o,a){var s=e.call(this,n,r,o,t)||this;s.block=i;s.isReplace=a;s.mapMode=!i?MapMode.TrackDel:n<0?MapMode.TrackBefore:MapMode.TrackAfter;return s}Object.defineProperty(t.prototype,"type",{get:function(){return this.startSide<this.endSide?BlockType.WidgetRange:this.startSide<0?BlockType.WidgetBefore:BlockType.WidgetAfter},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"heightRelevant",{get:function(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5},enumerable:false,configurable:true});t.prototype.eq=function(e){return e instanceof t&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide};t.prototype.range=function(t,n){if(n===void 0){n=t}if(this.isReplace&&(t>n||t==n&&this.startSide>0&&this.endSide<0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&n!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return e.prototype.range.call(this,t,n)};return t}(Decoration);PointDecoration.prototype.point=true;function getInclusive(e){var t=e.inclusiveStart,n=e.inclusiveEnd;if(t==null)t=e.inclusive;if(n==null)n=e.inclusive;return{start:t||false,end:n||false}}function widgetsEq(e,t){return e==t||!!(e&&t&&e.compare(t))}function addRange(e,t,n,r){if(r===void 0){r=0}var i=n.length-1;if(i>=0&&n[i]+r>e)n[i]=Math.max(n[i],t);else n.push(e,t)}var LineView=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.children=[];t.length=0;t.prevAttrs=undefined;t.attrs=null;t.breakAfter=0;return t}t.prototype.merge=function(e,n,r,i,o,a){if(r){if(!(r instanceof t))return false;if(!this.dom)r.transferDOM(this)}if(i)this.setDeco(r?r.attrs:null);mergeInlineChildren(this,e,n,r?r.children:none$1$1,o,a);return true};t.prototype.split=function(e){var n=new t;n.breakAfter=this.breakAfter;if(this.length==0)return n;var r=this.childPos(e),i=r.i,o=r.off;if(o){n.append(this.children[i].slice(o),0);this.children[i].merge(o,this.children[i].length,null,0,0);i++}for(var a=i;a<this.children.length;a++)n.append(this.children[a],0);while(i>0&&this.children[i-1].length==0){this.children[i-1].parent=null;i--}this.children.length=i;this.markDirty();this.length=e;return n};t.prototype.transferDOM=function(e){if(!this.dom)return;e.setDOM(this.dom);e.prevAttrs=this.prevAttrs===undefined?this.attrs:this.prevAttrs;this.prevAttrs=undefined;this.dom=null};t.prototype.setDeco=function(e){if(!attrsEq(this.attrs,e)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty()}this.attrs=e}};t.prototype.append=function(e,t){joinInlineInto(this,e,t)};t.prototype.addLineDeco=function(e){var t=e.spec.attributes;if(t)this.attrs=combineAttrs(t,this.attrs||{})};t.prototype.domAtPos=function(e){return inlineDOMAtPos(this.dom,this.children,e)};t.prototype.sync=function(t){if(!this.dom){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:undefined}if(this.prevAttrs!==undefined){updateAttrs(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=undefined}e.prototype.sync.call(this,t);var n=this.dom.lastChild;if(!n||n.nodeName!="BR"&&ContentView.get(n)instanceof WidgetView&&(!browser.ios||!this.children.some((function(e){return e instanceof TextView})))){var r=document.createElement("BR");r.cmIgnore=true;this.dom.appendChild(r)}};t.prototype.measureTextSize=function(){if(this.children.length==0||this.length>20)return null;var e=0;for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(!(r instanceof TextView))return null;var i=clientRectsFor(r.dom);if(i.length!=1)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}};t.prototype.coordsAt=function(e,t){return coordsInChildren(this,e,t)};t.prototype.match=function(e){return false};Object.defineProperty(t.prototype,"type",{get:function(){return BlockType.Text},enumerable:false,configurable:true});t.find=function(e,n){for(var r=0,i=0;;r++){var o=e.children[r],a=i+o.length;if(a>=n){if(o instanceof t)return o;if(o.length)return null}i=a+o.breakAfter}};return t}(ContentView);var none$1$1=[];var BlockWidgetView=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this)||this;i.widget=t;i.length=n;i.type=r;i.breakAfter=0;return i}t.prototype.merge=function(e,n,r,i,o,a){if(r&&(!(r instanceof t)||!this.widget.compare(r.widget)||e>0&&o<=0||n<this.length&&a<=0))return false;this.length=e+(r?r.length:0)+(this.length-n);return true};t.prototype.domAtPos=function(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)};t.prototype.split=function(e){var n=this.length-e;this.length=e;return new t(this.widget,n,this.type)};Object.defineProperty(t.prototype,"children",{get:function(){return none$1$1},enumerable:false,configurable:true});t.prototype.sync=function(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false"}};Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty},enumerable:false,configurable:true});t.prototype.domBoundsAround=function(){return null};t.prototype.match=function(e){if(e instanceof t&&e.type==this.type&&e.widget.constructor==this.widget.constructor){if(!e.widget.eq(this.widget))this.markDirty(true);this.widget=e.widget;this.length=e.length;this.breakAfter=e.breakAfter;return true}return false};t.prototype.ignoreMutation=function(){return true};t.prototype.ignoreEvent=function(e){return this.widget.ignoreEvent(e)};return t}(ContentView);var ContentBuilder=function(){function e(e,t,n){this.doc=e;this.pos=t;this.end=n;this.content=[];this.curLine=null;this.breakAtStart=0;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=e.iter();this.skip=t}e.prototype.posCovered=function(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof BlockWidgetView&&e.type==BlockType.WidgetBefore)};e.prototype.getLine=function(){if(!this.curLine)this.content.push(this.curLine=new LineView);return this.curLine};e.prototype.addWidget=function(e){this.curLine=null;this.content.push(e)};e.prototype.finish=function(){if(!this.posCovered())this.getLine()};e.prototype.wrapMarks=function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n];e=new MarkView(i,[e],e.length)}return e};e.prototype.buildText=function(e,t,n){while(e>0){if(this.textOff==this.text.length){var r=this.cursor.next(this.skip),i=r.value,o=r.lineBreak,a=r.done;this.skip=0;if(a)throw new Error("Ran out of text content when drawing inline views");if(o){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.curLine=null;e--;continue}else{this.text=i;this.textOff=0}}var s=Math.min(this.text.length-this.textOff,e,512);this.getLine().append(this.wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+s)),t),n);this.textOff+=s;e-=s;n=0}};e.prototype.span=function(e,t,n,r){this.buildText(t-e,n,r);this.pos=t;if(this.openStart<0)this.openStart=r};e.prototype.point=function(e,t,n,r,i){var o=t-e;if(n instanceof PointDecoration){if(n.block){var a=n.type;if(a==BlockType.WidgetAfter&&!this.posCovered())this.getLine();this.addWidget(new BlockWidgetView(n.widget||new NullWidget("div"),o,a))}else{var s=this.wrapMarks(WidgetView.create(n.widget||new NullWidget("span"),o,n.startSide),r);this.getLine().append(s,i)}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(n)}if(o){if(this.textOff+o<=this.text.length){this.textOff+=o}else{this.skip+=o-(this.text.length-this.textOff);this.text="";this.textOff=0}this.pos=t}if(this.openStart<0)this.openStart=i};e.build=function(t,n,r,i){var o=new e(t,n,r);o.openEnd=RangeSet.spans(i,n,r,o);if(o.openStart<0)o.openStart=o.openEnd;o.finish();return o};return e}();var NullWidget=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.tag=t;return n}t.prototype.eq=function(e){return e.tag==this.tag};t.prototype.toDOM=function(){return document.createElement(this.tag)};t.prototype.updateDOM=function(e){return e.nodeName.toLowerCase()==this.tag};return t}(WidgetType);var none$4=[];var clickAddsSelectionRange=Facet.define();var dragMovesSelection$1=Facet.define();var mouseSelectionStyle=Facet.define();var exceptionSink=Facet.define();var updateListener=Facet.define();var inputHandler=Facet.define();function logException(e,t,n){var r=e.facet(exceptionSink);if(r.length)r[0](t);else if(window.onerror)window.onerror(String(t),n,undefined,undefined,t);else if(n)console.error(n+":",t);else console.error(t)}var editable=Facet.define({combine:function(e){return e.length?e[0]:true}});var PluginFieldProvider=function(){function e(e,t){this.field=e;this.get=t}return e}();var PluginField=function(){function e(){}e.prototype.from=function(e){return new PluginFieldProvider(this,e)};e.define=function(){return new e};return e}();PluginField.decorations=PluginField.define();PluginField.atomicRanges=PluginField.define();PluginField.scrollMargins=PluginField.define();var nextPluginID=0;var viewPlugin=Facet.define();var ViewPlugin=function(){function e(e,t,n){this.id=e;this.create=t;this.fields=n;this.extension=viewPlugin.of(this)}e.define=function(t,n){var r=n||{},i=r.eventHandlers,o=r.provide,a=r.decorations;var s=[];if(o)for(var c=0,u=Array.isArray(o)?o:[o];c<u.length;c++){var l=u[c];s.push(l)}if(i)s.push(domEventHandlers.from((function(e){return{plugin:e,handlers:i}})));if(a)s.push(PluginField.decorations.from(a));return new e(nextPluginID++,t,s)};e.fromClass=function(t,n){return e.define((function(e){return new t(e)}),n)};return e}();var domEventHandlers=PluginField.define();var PluginInstance=function(){function e(e){this.spec=e;this.mustUpdate=null;this.value=null}e.prototype.takeField=function(e,t){for(var n=0,r=this.spec.fields;n<r.length;n++){var i=r[n],o=i.field,a=i.get;if(o==e)t.push(a(this.value))}};e.prototype.update=function(t){if(!this.value){try{this.value=this.spec.create(t)}catch(r){logException(t.state,r,"CodeMirror plugin crashed");return e.dummy}}else if(this.mustUpdate){var n=this.mustUpdate;this.mustUpdate=null;if(!this.value.update)return this;try{this.value.update(n)}catch(r){logException(n.state,r,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy()}catch(_){}return e.dummy}}return this};e.prototype.destroy=function(e){var t;if((t=this.value)===null||t===void 0?void 0:t.destroy){try{this.value.destroy()}catch(n){logException(e.state,n,"CodeMirror plugin crashed")}}};return e}();PluginInstance.dummy=new PluginInstance(ViewPlugin.define((function(){return{}})));var editorAttributes=Facet.define({combine:function(e){return e.reduce((function(e,t){return combineAttrs(t,e)}),{})}});var contentAttributes=Facet.define({combine:function(e){return e.reduce((function(e,t){return combineAttrs(t,e)}),{})}});var decorations=Facet.define();var styleModule=Facet.define();var ChangedRange=function(){function e(e,t,n,r){this.fromA=e;this.toA=t;this.fromB=n;this.toB=r}e.prototype.join=function(t){return new e(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))};e.prototype.addToSet=function(e){var t=e.length,n=this;for(;t>0;t--){var r=e[t-1];if(r.fromA>n.toA)continue;if(r.toA<n.fromA)break;n=n.join(r);e.splice(t-1,1)}e.splice(t,0,n);return e};e.extendWithRanges=function(t,n){if(n.length==0)return t;var r=[];for(var i=0,o=0,a=0,s=0;;i++){var c=i==t.length?null:t[i],u=a-s;var l=c?c.fromB:1e9;while(o<n.length&&n[o]<l){var f=n[o],h=n[o+1];var d=Math.max(s,f),p=Math.min(l,h);if(d<=p)new e(d+u,p+u,d,p).addToSet(r);if(h>l)break;else o+=2}if(!c)return r;new e(c.fromA,c.toA,c.fromB,c.toB).addToSet(r);a=c.toA;s=c.toB}};return e}();var ViewUpdate=function(){function e(e,t,n){if(n===void 0){n=none$4}this.view=e;this.state=t;this.transactions=n;this.flags=0;this.startState=e.state;this.changes=ChangeSet.empty(this.startState.doc.length);for(var r=0,i=n;r<i.length;r++){var o=i[r];this.changes=this.changes.compose(o.changes)}var a=[];this.changes.iterChangedRanges((function(e,t,n,r){return a.push(new ChangedRange(e,t,n,r))}));this.changedRanges=a;var s=e.hasFocus;if(s!=e.inputState.notifiedFocused){e.inputState.notifiedFocused=s;this.flags|=1}if(this.docChanged)this.flags|=2}Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return(this.flags&4)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"heightChanged",{get:function(){return(this.flags&2)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"geometryChanged",{get:function(){return this.docChanged||(this.flags&(16|2))>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"focusChanged",{get:function(){return(this.flags&1)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"docChanged",{get:function(){return this.transactions.some((function(e){return e.docChanged}))},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"selectionSet",{get:function(){return this.transactions.some((function(e){return e.selection}))},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"empty",{get:function(){return this.flags==0&&this.transactions.length==0},enumerable:false,configurable:true});return e}();var DocView=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.view=t;n.compositionDeco=Decoration.none;n.decorations=[];n.minWidth=0;n.minWidthFrom=0;n.minWidthTo=0;n.impreciseAnchor=null;n.impreciseHead=null;n.setDOM(t.contentDOM);n.children=[new LineView];n.children[0].setParent(n);n.updateInner([new ChangedRange(0,0,0,t.state.doc.length)],n.updateDeco(),0);return n}Object.defineProperty(t.prototype,"root",{get:function(){return this.view.root},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"editorView",{get:function(){return this.view},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"length",{get:function(){return this.view.state.doc.length},enumerable:false,configurable:true});t.prototype.update=function(e){var t=this;var n=e.changedRanges;if(this.minWidth>0&&n.length){if(!n.every((function(e){var n=e.fromA,r=e.toA;return r<t.minWidthFrom||n>t.minWidthTo}))){this.minWidth=0}else{this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)}}if(this.view.inputState.composing<0)this.compositionDeco=Decoration.none;else if(e.transactions.length)this.compositionDeco=computeCompositionDeco(this.view,e.changes);var r=(browser.ie||browser.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines;var i=this.decorations,o=this.updateDeco();var a=findChangedDeco(i,o,e.changes);n=ChangedRange.extendWithRanges(n,a);var s=e.transactions.some((function(e){return e.annotation(Transaction.userEvent)=="pointerselection"}));if(this.dirty==0&&n.length==0&&!(e.flags&(4|8))&&e.state.selection.main.from>=this.view.viewport.from&&e.state.selection.main.to<=this.view.viewport.to){this.updateSelection(r,s);return false}else{this.updateInner(n,o,e.startState.doc.length,r,s);return true}};t.prototype.updateInner=function(e,t,n,r,i){var o=this;if(r===void 0){r=false}if(i===void 0){i=false}this.updateChildren(e,t,n);var a=this.view.observer;a.ignore((function(){o.dom.style.height=o.view.viewState.domHeight+"px";o.dom.style.minWidth=o.minWidth?o.minWidth+"px":"";var e=browser.chrome||browser.ios?{node:a.selectionRange.focusNode,written:false}:undefined;o.sync(e);o.dirty=0;if(e&&(e.written||a.selectionRange.focusNode!=e.node))r=true;o.updateSelection(r,i);o.dom.style.height=""}))};t.prototype.updateChildren=function(e,t,n){var r=this.childCursor(n);for(var i=e.length-1;;i--){var o=i>=0?e[i]:null;if(!o)break;var a=o.fromA,s=o.toA,c=o.fromB,u=o.toB;var l=ContentBuilder.build(this.view.state.doc,c,u,t),f=l.content,h=l.breakAtStart,d=l.openStart,p=l.openEnd;var v=r.findPos(s,1),m=v.i,g=v.off;var y=r.findPos(a,-1),b=y.i,w=y.off;this.replaceRange(b,w,m,g,f,h,d,p)}};t.prototype.replaceRange=function(e,t,n,r,i,o,a,s){var c=this.children[e],u=i.length?i[i.length-1]:null;var l=u?u.breakAfter:o;if(e==n&&!o&&!l&&i.length<2&&c.merge(t,r,i.length?u:null,t==0,a,s))return;var f=this.children[n];if(r<f.length||f.children.length&&f.children[f.children.length-1].length==0){if(e==n){f=f.split(r);r=0}if(!l&&u&&f.merge(0,r,u,true,0,s)){i[i.length-1]=f}else{if(r||f.children.length&&f.children[0].length==0)f.merge(0,r,null,false,0,s);i.push(f)}}else if(f.breakAfter){if(u)u.breakAfter=1;else o=1}n++;c.breakAfter=o;if(t>0){if(!o&&i.length&&c.merge(t,c.length,i[0],false,a,0)){c.breakAfter=i.shift().breakAfter}else if(t<c.length||c.children.length&&c.children[c.children.length-1].length==0){c.merge(t,c.length,null,false,a,0)}e++}while(e<n&&i.length){if(this.children[n-1].match(i[i.length-1]))n--,i.pop();else if(this.children[e].match(i[0]))e++,i.shift();else break}if(e<n||i.length)this.replaceChildren(e,n,i)};t.prototype.updateSelection=function(e,t){var n=this;if(e===void 0){e=false}if(t===void 0){t=false}if(!(t||this.mayControlSelection())||browser.ios&&this.view.inputState.rapidCompositionStart)return;var r=this.view.state.selection.main;var i=this.domAtPos(r.anchor);var o=r.empty?i:this.domAtPos(r.head);if(browser.gecko&&r.empty&&betweenUneditable(i)){var a=document.createTextNode("");this.view.observer.ignore((function(){return i.node.insertBefore(a,i.node.childNodes[i.offset]||null)}));i=o=new DOMPos(a,0);e=true}var s=this.view.observer.selectionRange;if(e||!s.focusNode||!isEquivalentPosition(i.node,i.offset,s.anchorNode,s.anchorOffset)||!isEquivalentPosition(o.node,o.offset,s.focusNode,s.focusOffset)){this.view.observer.ignore((function(){var e;var t=getSelection(n.root);if(r.empty){if(browser.gecko){var a=nextToUneditable(i.node,i.offset);if(a&&a!=(1|2)){var c=nearbyTextNode(i.node,i.offset,a==1?1:-1);if(c)i=new DOMPos(c,a==1?0:c.nodeValue.length)}}t.collapse(i.node,i.offset);if(r.bidiLevel!=null&&s.cursorBidiLevel!=null)s.cursorBidiLevel=r.bidiLevel}else if(t.extend){t.collapse(i.node,i.offset);t.extend(o.node,o.offset)}else{var u=document.createRange();if(r.anchor>r.head)e=[o,i],i=e[0],o=e[1];u.setEnd(o.node,o.offset);u.setStart(i.node,i.offset);t.removeAllRanges();t.addRange(u)}}));this.view.observer.setSelectionRange(i,o)}this.impreciseAnchor=i.precise?null:new DOMPos(s.anchorNode,s.anchorOffset);this.impreciseHead=o.precise?null:new DOMPos(s.focusNode,s.focusOffset)};t.prototype.enforceCursorAssoc=function(){if(this.view.composing)return;var e=this.view.state.selection.main;var t=getSelection(this.root);if(!e.empty||!e.assoc||!t.modify)return;var n=LineView.find(this,e.head);if(!n)return;var r=n.posAtStart;if(e.head==r||e.head==r+n.length)return;var i=this.coordsAt(e.head,-1),o=this.coordsAt(e.head,1);if(!i||!o||i.bottom>o.top)return;var a=this.domAtPos(e.head+e.assoc);t.collapse(a.node,a.offset);t.modify("move",e.assoc<0?"forward":"backward","lineboundary")};t.prototype.mayControlSelection=function(){return this.view.state.facet(editable)?this.root.activeElement==this.dom:hasSelection(this.dom,this.view.observer.selectionRange)};t.prototype.nearest=function(e){for(var t=e;t;){var n=ContentView.get(t);if(n&&n.rootView==this)return n;t=t.parentNode}return null};t.prototype.posFromDOM=function(e,t){var n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,t)+n.posAtStart};t.prototype.domAtPos=function(e){var t=this.childCursor().findPos(e,-1),n=t.i,r=t.off;for(;n<this.children.length-1;){var i=this.children[n];if(r<i.length||i instanceof LineView)break;n++;r=0}return this.children[n].domAtPos(r)};t.prototype.coordsAt=function(e,t){for(var n=this.length,r=this.children.length-1;;r--){var i=this.children[r],o=n-i.breakAfter-i.length;if(e>o||e==o&&i.type!=BlockType.WidgetBefore&&i.type!=BlockType.WidgetAfter&&(!r||t==2||this.children[r-1].breakAfter||this.children[r-1].type==BlockType.WidgetBefore&&t>-2))return i.coordsAt(e-o,t);n=o}};t.prototype.measureVisibleLineHeights=function(){var e=[],t=this.view.viewState.viewport,n=t.from,r=t.to;var i=Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;for(var o=0,a=0;a<this.children.length;a++){var s=this.children[a],c=o+s.length;if(c>r)break;if(o>=n){e.push(s.dom.getBoundingClientRect().height);var u=s.dom.scrollWidth;if(u>i){this.minWidth=i=u;this.minWidthFrom=o;this.minWidthTo=c}}o=c+s.breakAfter}return e};t.prototype.measureTextSize=function(){var e=this;for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(r instanceof LineView){var i=r.measureTextSize();if(i)return i}}var o=document.createElement("div"),a,s;o.className="cm-line";o.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore((function(){e.dom.appendChild(o);var t=clientRectsFor(o.firstChild)[0];a=o.getBoundingClientRect().height;s=t?t.width/27:7;o.remove()}));return{lineHeight:a,charWidth:s}};t.prototype.childCursor=function(e){if(e===void 0){e=this.length}var t=this.children.length;if(t)e-=this.children[--t].length;return new ChildCursor(this.children,e,t)};t.prototype.computeBlockGapDeco=function(){var e=[],t=this.view.viewState;for(var n=0,r=0;;r++){var i=r==t.viewports.length?null:t.viewports[r];var o=i?i.from-1:this.length;if(o>n){var a=t.lineAt(o,0).bottom-t.lineAt(n,0).top;e.push(Decoration.replace({widget:new BlockGapWidget(a),block:true,inclusive:true}).range(n,o))}if(!i)break;n=i.to+1}return Decoration.set(e)};t.prototype.updateDeco=function(){return this.decorations=__spreadArray(__spreadArray(__spreadArray([],this.view.pluginField(PluginField.decorations)),this.view.state.facet(decorations)),[this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco])};t.prototype.scrollPosIntoView=function(e,t){var n=this.coordsAt(e,t);if(!n)return;var r=0,i=0,o=0,a=0;for(var s=0,c=this.view.pluginField(PluginField.scrollMargins);s<c.length;s++){var u=c[s];if(u){var l=u.left,f=u.right,h=u.top,d=u.bottom;if(l!=null)r=Math.max(r,l);if(f!=null)i=Math.max(i,f);if(h!=null)o=Math.max(o,h);if(d!=null)a=Math.max(a,d)}}scrollRectIntoView(this.dom,{left:n.left-r,top:n.top-o,right:n.right+i,bottom:n.bottom+a})};return t}(ContentView);function betweenUneditable(e){return e.node.nodeType==1&&e.node.firstChild&&(e.offset==0||e.node.childNodes[e.offset-1].contentEditable=="false")&&(e.offset==e.node.childNodes.length||e.node.childNodes[e.offset].contentEditable=="false")}var BlockGapWidget=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.height=t;return n}t.prototype.toDOM=function(){var e=document.createElement("div");this.updateDOM(e);return e};t.prototype.eq=function(e){return e.height==this.height};t.prototype.updateDOM=function(e){e.style.height=this.height+"px";return true};Object.defineProperty(t.prototype,"estimatedHeight",{get:function(){return this.height},enumerable:false,configurable:true});return t}(WidgetType);function computeCompositionDeco(e,t){var n=e.observer.selectionRange;var r=n.focusNode&&nearbyTextNode(n.focusNode,n.focusOffset,0);if(!r)return Decoration.none;var i=e.docView.nearest(r);var o,a,s=r;if(i instanceof InlineView){while(i.parent instanceof InlineView)i=i.parent;o=i.posAtStart;a=o+i.length;s=i.dom}else if(i instanceof LineView){while(s.parentNode!=i.dom)s=s.parentNode;var c=s.previousSibling;while(c&&!ContentView.get(c))c=c.previousSibling;o=a=c?ContentView.get(c).posAtEnd:i.posAtStart}else{return Decoration.none}var u=t.mapPos(o,1),l=Math.max(u,t.mapPos(a,-1));var f=r.nodeValue,h=e.state;if(l-u<f.length){if(h.sliceDoc(u,Math.min(h.doc.length,u+f.length))==f)l=u+f.length;else if(h.sliceDoc(Math.max(0,l-f.length),l)==f)u=l-f.length;else return Decoration.none}else if(h.sliceDoc(u,l)!=f){return Decoration.none}return Decoration.set(Decoration.replace({widget:new CompositionWidget(s,r)}).range(u,l))}var CompositionWidget=function(e){__extends(t,e);function t(t,n){var r=e.call(this)||this;r.top=t;r.text=n;return r}t.prototype.eq=function(e){return this.top==e.top&&this.text==e.text};t.prototype.toDOM=function(){return this.top};t.prototype.ignoreEvent=function(){return false};Object.defineProperty(t.prototype,"customView",{get:function(){return CompositionView},enumerable:false,configurable:true});return t}(WidgetType);function nearbyTextNode(e,t,n){for(;;){if(e.nodeType==3)return e;if(e.nodeType==1&&t>0&&n<=0){e=e.childNodes[t-1];t=maxOffset(e)}else if(e.nodeType==1&&t<e.childNodes.length&&n>=0){e=e.childNodes[t];t=0}else{return null}}}function nextToUneditable(e,t){if(e.nodeType!=1)return 0;return(t&&e.childNodes[t-1].contentEditable=="false"?1:0)|(t<e.childNodes.length&&e.childNodes[t].contentEditable=="false"?2:0)}var DecorationComparator$1=function(){function e(){this.changes=[]}e.prototype.compareRange=function(e,t){addRange(e,t,this.changes)};e.prototype.comparePoint=function(e,t){addRange(e,t,this.changes)};return e}();function findChangedDeco(e,t,n){var r=new DecorationComparator$1;RangeSet.compare(e,t,n,r);return r.changes}var Direction=function(e){e[e["LTR"]=0]="LTR";e[e["RTL"]=1]="RTL";return e}(Direction||(Direction={}));var LTR=Direction.LTR,RTL=Direction.RTL;function dec(e){var t=[];for(var n=0;n<e.length;n++)t.push(1<<+e[n]);return t}var LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var Brackets=Object.create(null),BracketStack=[];for(var _e=0,_g=["()","[]","{}"];_e<_g.length;_e++){var p=_g[_e];var l=p.charCodeAt(0),r=p.charCodeAt(1);Brackets[l]=r;Brackets[r]=-l}function charType(e){return e<=247?LowTypes[e]:1424<=e&&e<=1524?2:1536<=e&&e<=1785?ArabicTypes[e-1536]:1774<=e&&e<=2220?4:8192<=e&&e<=8203?256:e==8204?256:1}var BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var BidiSpan=function(){function e(e,t,n){this.from=e;this.to=t;this.level=n}Object.defineProperty(e.prototype,"dir",{get:function(){return this.level%2?RTL:LTR},enumerable:false,configurable:true});e.prototype.side=function(e,t){return this.dir==t==e?this.to:this.from};e.find=function(e,t,n,r){var i=-1;for(var o=0;o<e.length;o++){var a=e[o];if(a.from<=t&&a.to>=t){if(a.level==n)return o;if(i<0||(r!=0?r<0?a.from<t:a.to>t:e[i].level>a.level))i=o}}if(i<0)throw new RangeError("Index out of range");return i};return e}();var types=[];function computeOrder(e,t){var n=e.length,r=t==LTR?1:2,i=t==LTR?2:1;if(!e||r==1&&!BidiRE.test(e))return trivialOrder(n);for(var o=0,a=r,s=r;o<n;o++){var c=charType(e.charCodeAt(o));if(c==512)c=a;else if(c==8&&s==4)c=16;types[o]=c==4?2:c;if(c&7)s=c;a=c}for(var u=0,a=r,s=r;u<n;u++){var c=types[u];if(c==128){if(u<n-1&&a==types[u+1]&&a&24)c=types[u]=a;else types[u]=256}else if(c==64){var l=u+1;while(l<n&&types[l]==64)l++;var f=u&&a==8||l<n&&types[l]==8?s==1?1:8:256;for(var h=u;h<l;h++)types[h]=f;u=l-1}else if(c==8&&s==1){types[u]=1}a=c;if(c&7)s=c}for(var d=0,p=0,v=0,m=void 0,g=void 0,c=void 0;d<n;d++){if(g=Brackets[m=e.charCodeAt(d)]){if(g<0){for(var y=p-3;y>=0;y-=3){if(BracketStack[y+1]==-g){var b=BracketStack[y+2];var w=b&2?r:!(b&4)?0:b&1?i:r;if(w)types[d]=types[BracketStack[y]]=w;p=y;break}}}else if(BracketStack.length==189){break}else{BracketStack[p++]=d;BracketStack[p++]=m;BracketStack[p++]=v}}else if((c=types[d])==2||c==1){var x=c==r;v=x?0:1;for(var y=p-3;y>=0;y-=3){var S=BracketStack[y+2];if(S&2)break;if(x){BracketStack[y+2]|=2}else{if(S&4)break;BracketStack[y+2]|=4}}}}for(var k=0;k<n;k++){if(types[k]==256){var l=k+1;while(l<n&&types[l]==256)l++;var C=(k?types[k-1]:r)==1;var A=(l<n?types[l]:r)==1;var f=C==A?C?1:2:r;for(var h=k;h<l;h++)types[h]=f;k=l-1}}var M=[];if(r==1){for(var I=0;I<n;){var E=I,R=types[I++]!=1;while(I<n&&R==(types[I]!=1))I++;if(R){for(var h=I;h>E;){var l=h,T=types[--h]!=2;while(h>E&&T==(types[h-1]!=2))h--;M.push(new BidiSpan(h,l,T?2:1))}}else{M.push(new BidiSpan(E,I,0))}}}else{for(var P=0;P<n;){var E=P,R=types[P++]==2;while(P<n&&R==(types[P]==2))P++;M.push(new BidiSpan(E,P,R?1:2))}}return M}function trivialOrder(e){return[new BidiSpan(0,e,0)]}var movedOver="";function moveVisually(e,t,n,r,i){var o;var a=r.head-e.from,s=-1;if(a==0){if(!i||!e.length)return null;if(t[0].level!=n){a=t[0].side(false,n);s=0}}else if(a==e.length){if(i)return null;var c=t[t.length-1];if(c.level!=n){a=c.side(true,n);s=t.length-1}}if(s<0)s=BidiSpan.find(t,a,(o=r.bidiLevel)!==null&&o!==void 0?o:-1,r.assoc);var u=t[s];if(a==u.side(i,n)){u=t[s+=i?1:-1];a=u.side(!i,n)}var l=i==(u.dir==n);var f=findClusterBreak(e.text,a,l);movedOver=e.text.slice(Math.min(a,f),Math.max(a,f));if(f!=u.side(i,n))return EditorSelection.cursor(f+e.from,l?-1:1,u.level);var h=s==(i?t.length-1:0)?null:t[s+(i?1:-1)];if(!h&&u.level!=n)return EditorSelection.cursor(i?e.to:e.from,i?-1:1,n);if(h&&h.level<u.level)return EditorSelection.cursor(h.side(!i,n)+e.from,i?1:-1,h.level);return EditorSelection.cursor(f+e.from,i?-1:1,u.level)}function groupAt(e,t,n){if(n===void 0){n=1}var r=e.charCategorizer(t);var i=e.doc.lineAt(t),o=t-i.from;if(i.length==0)return EditorSelection.cursor(t);if(o==0)n=1;else if(o==i.length)n=-1;var a=o,s=o;if(n<0)a=findClusterBreak(i.text,o,false);else s=findClusterBreak(i.text,o);var c=r(i.text.slice(a,s));while(a>0){var u=findClusterBreak(i.text,a,false);if(r(i.text.slice(u,a))!=c)break;a=u}while(s<i.length){var l=findClusterBreak(i.text,s);if(r(i.text.slice(s,l))!=c)break;s=l}return EditorSelection.range(a+i.from,s+i.from)}function getdx(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function getdy(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function yOverlap(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function upTop(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function upBot(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function domPosAtCoords(e,t,n){var r,i,o,a;var s,c,u,l;for(var f=e.firstChild;f;f=f.nextSibling){var h=clientRectsFor(f);for(var d=0;d<h.length;d++){var p=h[d];if(i&&yOverlap(i,p))p=upTop(upBot(p,i.bottom),i.top);var v=getdx(t,p),m=getdy(n,p);if(v==0&&m==0)return f.nodeType==3?domPosInText(f,t,n):domPosAtCoords(f,t,n);if(!r||a>m||a==m&&o>v){r=f;i=p;o=v;a=m}if(v==0){if(n>p.bottom&&(!u||u.bottom<p.bottom)){s=f;u=p}else if(n<p.top&&(!l||l.top>p.top)){c=f;l=p}}else if(u&&yOverlap(u,p)){u=upBot(u,p.bottom)}else if(l&&yOverlap(l,p)){l=upTop(l,p.top)}}}if(u&&u.bottom>=n){r=s;i=u}else if(l&&l.top<=n){r=c;i=l}if(!r)return{node:e,offset:0};var g=Math.max(i.left,Math.min(i.right,t));if(r.nodeType==3)return domPosInText(r,g,n);if(!o&&r.contentEditable=="true")return domPosAtCoords(r,g,n);var y=Array.prototype.indexOf.call(e.childNodes,r)+(t>=(i.left+i.right)/2?1:0);return{node:e,offset:y}}function domPosInText(e,t,n){var r=e.nodeValue.length;var i=-1,o=1e9,a=0;for(var s=0;s<r;s++){var c=textRange(e,s,s+1).getClientRects();for(var u=0;u<c.length;u++){var l=c[u];if(l.top==l.bottom)continue;if(!a)a=t-l.left;var f=(l.top>n?l.top-n:n-l.bottom)-1;if(l.left-1<=t&&l.right+1>=t&&f<o){var h=t>=(l.left+l.right)/2,d=h;if(browser.chrome||browser.gecko){var p=textRange(e,s).getBoundingClientRect();if(p.left==l.right)d=!h}if(f<=0)return{node:e,offset:s+(d?1:0)};i=s+(d?1:0);o=f}}}return{node:e,offset:i>-1?i:a>0?e.nodeValue.length:0}}function posAtCoords(e,t,n){var r;var i=t.x,o=t.y;if(n===void 0){n=-1}var a=e.contentDOM.getBoundingClientRect(),s;var c=e.defaultLineHeight/2;for(var u=false;;){s=e.blockAtHeight(o,a.top);if(s.top>o||s.bottom<o){n=s.top>o?-1:1;o=Math.min(s.bottom-c,Math.max(s.top+c,o));if(u)return null;else u=true}if(s.type==BlockType.Text)break;o=n>0?s.bottom+c:s.top-c}var l=s.from;if(l<e.viewport.from)return e.viewport.from==0?0:null;if(l>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:null;i=Math.max(a.left+1,Math.min(a.right-1,i));var f=e.root,h=f.elementFromPoint(i,o);var d,p=-1;if(h&&e.contentDOM.contains(h)&&!(e.docView.nearest(h)instanceof WidgetView)){if(f.caretPositionFromPoint){var v=f.caretPositionFromPoint(i,o);if(v)d=v.offsetNode,p=v.offset}else if(f.caretRangeFromPoint){var m=f.caretRangeFromPoint(i,o);if(m){d=m.startContainer,p=m.startOffset;if(browser.safari&&isSuspiciousCaretResult(d,p,i))d=undefined}}}if(!d||!e.docView.dom.contains(d)){var g=LineView.find(e.docView,l);r=domPosAtCoords(g.dom,i,o),d=r.node,p=r.offset}return e.docView.posFromDOM(d,p)}function isSuspiciousCaretResult(e,t,n){var r;if(e.nodeType!=3||t!=(r=e.nodeValue.length))return false;for(var i=e.nextSibling;i;i=i.nextSibling)if(i.nodeType!=1||i.nodeName!="BR")return false;return textRange(e,r-1,r).getBoundingClientRect().left>n}function moveToLineBoundary(e,t,n,r){var i=e.state.doc.lineAt(t.head);var o=!r||!e.lineWrapping?null:e.coordsAtPos(t.assoc<0&&t.head>i.from?t.head-1:t.head);if(o){var a=e.dom.getBoundingClientRect();var s=e.posAtCoords({x:n==(e.textDirection==Direction.LTR)?a.right-1:a.left+1,y:(o.top+o.bottom)/2});if(s!=null)return EditorSelection.cursor(s,n?-1:1)}var c=LineView.find(e.docView,t.head);var u=c?n?c.posAtEnd:c.posAtStart:n?i.to:i.from;return EditorSelection.cursor(u,n?-1:1)}function moveByChar(e,t,n,r){var i=e.state.doc.lineAt(t.head),o=e.bidiSpans(i);for(var a=t,s=null;;){var c=moveVisually(i,o,e.textDirection,a,n),u=movedOver;if(!c){if(i.number==(n?e.state.doc.lines:1))return a;u="\n";i=e.state.doc.line(i.number+(n?1:-1));o=e.bidiSpans(i);c=EditorSelection.cursor(n?i.from:i.to)}if(!s){if(!r)return c;s=r(u)}else if(!s(u)){return a}a=c}}function byGroup(e,t,n){var r=e.state.charCategorizer(t);var i=r(n);return function(e){var t=r(e);if(i==CharCategory.Space)i=t;return i==t}}function moveVertically(e,t,n,r){var i;var o=t.head,a=n?1:-1;if(o==(n?e.state.doc.length:0))return EditorSelection.cursor(o);var s=e.coordsAtPos(o);if(s){var c=e.dom.getBoundingClientRect();var u=(i=t.goalColumn)!==null&&i!==void 0?i:s.left-c.left;var l=c.left+u;var f=r!==null&&r!==void 0?r:e.defaultLineHeight>>1;for(var h=a<0?s.top:s.bottom,d=0;d<50;d+=10){var p=posAtCoords(e,{x:l,y:h+(f+d)*a},a);if(p==null)break;if(p!=o)return EditorSelection.cursor(p,undefined,undefined,u)}}var v=e.state.doc,m=v.lineAt(o),g=e.state.tabSize;var y=t.goalColumn,b=0;if(y==null){for(var w=v.iterRange(m.from,o);!w.next().done;)b=countColumn(w.value,b,g);y=b*e.defaultCharacterWidth}else{b=Math.round(y/e.defaultCharacterWidth)}if(a<0&&m.from==0)return EditorSelection.cursor(0);else if(a>0&&m.to==v.length)return EditorSelection.cursor(m.to);var x=v.line(m.number+a);var S=x.from;var k=0;for(var w=v.iterRange(x.from,x.to);k>=b&&!w.next().done;){var C=findColumn(w.value,k,b,g),A=C.offset,M=C.leftOver;k=b-M;S+=A}return EditorSelection.cursor(S,undefined,undefined,y)}function skipAtoms(e,t,n){var r=e.pluginField(PluginField.atomicRanges);var i=function(){var e=false;for(var i=0,o=r;i<o.length;i++){var a=o[i];a.between(n.from-1,n.from+1,(function(r,i,o){if(n.from>r&&n.from<i){n=t.from>n.from?EditorSelection.cursor(r,1):EditorSelection.cursor(i,-1);e=true}}))}if(!e)return{value:n}};for(;;){var o=i();if(typeof o==="object")return o.value}}var InputState=function(){function e(e){var t=this;this.lastKeyCode=0;this.lastKeyTime=0;this.pendingIOSKey=null;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionEndedAt=0;this.rapidCompositionStart=false;this.mouseSelection=null;var n=function(n){var i=handlers[n];e.contentDOM.addEventListener(n,(function(r){if(n=="keydown"&&t.keydown(e,r))return;if(!eventBelongsToEditor(e,r)||t.ignoreDuringComposition(r))return;if(t.mustFlushObserver(r))e.observer.forceFlush();if(t.runCustomHandlers(n,e,r))r.preventDefault();else i(e,r)}));r.registeredEvents.push(n)};var r=this;for(var i in handlers){n(i)}this.notifiedFocused=e.hasFocus;this.ensureHandlers(e);if(browser.safari)e.contentDOM.addEventListener("input",(function(){return null}))}e.prototype.setSelectionOrigin=function(e){this.lastSelectionOrigin=e;this.lastSelectionTime=Date.now()};e.prototype.ensureHandlers=function(e){var t=this;var n=this.customHandlers=e.pluginField(domEventHandlers);for(var r=0,i=n;r<i.length;r++){var o=i[r];var a=function(n){if(s.registeredEvents.indexOf(n)<0&&n!="scroll"){s.registeredEvents.push(n);e.contentDOM.addEventListener(n,(function(r){if(!eventBelongsToEditor(e,r))return;if(t.runCustomHandlers(n,e,r))r.preventDefault()}))}};var s=this;for(var c in o.handlers){a(c)}}};e.prototype.runCustomHandlers=function(e,t,n){for(var r=0,i=this.customHandlers;r<i.length;r++){var o=i[r];var a=o.handlers[e],s=false;if(a){try{s=a.call(o.plugin,n,t)}catch(c){logException(t.state,c)}if(s||n.defaultPrevented){if(browser.android&&e=="keydown"&&n.keyCode==13)t.observer.flushSoon();return true}}}return false};e.prototype.runScrollHandlers=function(e,t){for(var n=0,r=this.customHandlers;n<r.length;n++){var i=r[n];var o=i.handlers.scroll;if(o){try{o.call(i.plugin,t,e)}catch(a){logException(e.state,a)}}}};e.prototype.keydown=function(e,t){var n=this;this.lastKeyCode=t.keyCode;this.lastKeyTime=Date.now();if(this.screenKeyEvent(e,t))return true;if(browser.ios&&(t.keyCode==13||t.keyCode==8)&&!(t.ctrlKey||t.altKey||t.metaKey)&&!t.synthetic){this.pendingIOSKey=t.keyCode==13?"enter":"backspace";setTimeout((function(){return n.flushIOSKey(e)}),250);return true}return false};e.prototype.flushIOSKey=function(e){if(!this.pendingIOSKey)return false;var t=e.contentDOM,n=this.pendingIOSKey;this.pendingIOSKey=null;return n=="enter"?dispatchKey(t,"Enter",13):dispatchKey(t,"Backspace",8)};e.prototype.ignoreDuringComposition=function(e){if(!/^key/.test(e.type))return false;if(this.composing>0)return true;if(browser.safari&&Date.now()-this.compositionEndedAt<500){this.compositionEndedAt=0;return true}return false};e.prototype.screenKeyEvent=function(e,t){var n=t.keyCode==9&&Date.now()<this.lastEscPress+2e3;if(t.keyCode==27)this.lastEscPress=Date.now();else if(modifierCodes.indexOf(t.keyCode)<0)this.lastEscPress=0;return n};e.prototype.mustFlushObserver=function(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!browser.ios};e.prototype.startMouseSelection=function(e,t,n){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=new MouseSelection(this,e,t,n)};e.prototype.update=function(e){if(this.mouseSelection)this.mouseSelection.update(e);if(e.transactions.length)this.lastKeyCode=this.lastSelectionTime=0};e.prototype.destroy=function(){if(this.mouseSelection)this.mouseSelection.destroy()};return e}();var modifierCodes=[16,17,18,20,91,92,224,225];var MouseSelection=function(){function e(e,t,n,r){this.inputState=e;this.view=t;this.style=r;this.lastEvent=n;var i=t.contentDOM.ownerDocument;i.addEventListener("mousemove",this.move=this.move.bind(this));i.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=n.shiftKey;this.multiple=t.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(t,n);this.dragMove=dragMovesSelection(t,n);this.dragging=isInPrimarySelection(t,n)?null:false;if(this.dragging===false){n.preventDefault();this.select(n)}}e.prototype.move=function(e){if(e.buttons==0)return this.destroy();if(this.dragging!==false)return;this.select(this.lastEvent=e)};e.prototype.up=function(e){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)e.preventDefault();this.destroy()};e.prototype.destroy=function(){var e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move);e.removeEventListener("mouseup",this.up);this.inputState.mouseSelection=null};e.prototype.select=function(e){var t=this.style.get(e,this.extend,this.multiple);if(!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)this.view.dispatch({selection:t,annotations:Transaction.userEvent.of("pointerselection"),scrollIntoView:true})};e.prototype.update=function(e){var t=this;if(e.docChanged&&this.dragging)this.dragging=this.dragging.map(e.changes);if(this.style.update(e))setTimeout((function(){return t.select(t.lastEvent)}),20)};return e}();function addsSelectionRange(e,t){var n=e.state.facet(clickAddsSelectionRange);return n.length?n[0](t):browser.mac?t.metaKey:t.ctrlKey}function dragMovesSelection(e,t){var n=e.state.facet(dragMovesSelection$1);return n.length?n[0](t):browser.mac?!t.altKey:!t.ctrlKey}function isInPrimarySelection(e,t){var n=e.state.selection.main;if(n.empty)return false;var r=getSelection(e.root);if(r.rangeCount==0)return true;var i=r.getRangeAt(0).getClientRects();for(var o=0;o<i.length;o++){var a=i[o];if(a.left<=t.clientX&&a.right>=t.clientX&&a.top<=t.clientY&&a.bottom>=t.clientY)return true}return false}function eventBelongsToEditor(e,t){if(!t.bubbles)return true;if(t.defaultPrevented)return false;for(var n=t.target,r=void 0;n!=e.contentDOM;n=n.parentNode)if(!n||n.nodeType==11||(r=ContentView.get(n))&&r.ignoreEvent(t))return false;return true}var handlers=Object.create(null);var brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(e){var t=e.dom.parentNode;if(!t)return;var n=t.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px";n.focus();setTimeout((function(){e.focus();n.remove();doPaste(e,n.value)}),50)}function doPaste(e,t){var n=e.state,r,i=1,o=n.toText(t);var a=o.lines==n.selection.ranges.length;var s=lastLinewiseCopy&&n.selection.ranges.every((function(e){return e.empty}))&&lastLinewiseCopy==o.toString();if(s){var c=-1;r=n.changeByRange((function(e){var r=n.doc.lineAt(e.from);if(r.from==c)return{range:e};c=r.from;var s=n.toText((a?o.line(i++).text:t)+n.lineBreak);return{changes:{from:r.from,insert:s},range:EditorSelection.cursor(e.from+s.length)}}))}else if(a){r=n.changeByRange((function(e){var t=o.line(i++);return{changes:{from:e.from,to:e.to,insert:t.text},range:EditorSelection.cursor(e.from+t.length)}}))}else{r=n.replaceSelection(o)}e.dispatch(r,{annotations:Transaction.userEvent.of("paste"),scrollIntoView:true})}handlers.keydown=function(e,t){e.inputState.setSelectionOrigin("keyboardselection")};var lastTouch=0;handlers.touchstart=function(e,t){lastTouch=Date.now();e.inputState.setSelectionOrigin("pointerselection")};handlers.touchmove=function(e){e.inputState.setSelectionOrigin("pointerselection")};handlers.mousedown=function(e,t){e.observer.flush();if(lastTouch>Date.now()-2e3)return;var n=null;for(var r=0,i=e.state.facet(mouseSelectionStyle);r<i.length;r++){var o=i[r];n=o(e,t);if(n)break}if(!n&&t.button==0)n=basicMouseSelection(e,t);if(n){if(e.root.activeElement!=e.contentDOM)e.observer.ignore((function(){return focusPreventScroll(e.contentDOM)}));e.inputState.startMouseSelection(e,t,n)}};function rangeForClick(e,t,n,r){if(r==1){return EditorSelection.cursor(t,n)}else if(r==2){return groupAt(e.state,t,n)}else{var i=LineView.find(e.docView,t),o=e.state.doc.lineAt(i?i.posAtEnd:t);var a=i?i.posAtStart:o.from,s=i?i.posAtEnd:o.to;if(s<e.state.doc.length&&s==o.to)s++;return EditorSelection.range(a,s)}}var insideY=function(e,t){return e>=t.top&&e<=t.bottom};var inside=function(e,t,n){return insideY(t,n)&&e>=n.left&&e<=n.right};function findPositionSide(e,t,n,r){var i=LineView.find(e.docView,t);if(!i)return 1;var o=t-i.posAtStart;if(o==0)return 1;if(o==i.length)return-1;var a=i.coordsAt(o,-1);if(a&&inside(n,r,a))return-1;var s=i.coordsAt(o,1);if(s&&inside(n,r,s))return 1;return a&&insideY(r,a)?-1:1}function queryPos(e,t){var n=e.posAtCoords({x:t.clientX,y:t.clientY});if(n==null)return null;return{pos:n,bias:findPositionSide(e,n,t.clientX,t.clientY)}}var BadMouseDetail=browser.ie&&browser.ie_version<=11;var lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(e){if(!BadMouseDetail)return e.detail;var t=lastMouseDown,n=lastMouseDownTime;lastMouseDown=e;lastMouseDownTime=Date.now();return lastMouseDownCount=!t||n>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(e,t){var n=queryPos(e,t),r=getClickType(t);var i=e.state.selection;var o=n,a=t;return{update:function(e){if(e.changes){if(n)n.pos=e.changes.mapPos(n.pos);i=i.map(e.changes);a=null}},get:function(t,s,c){var u;if(a&&t.clientX==a.clientX&&t.clientY==a.clientY)u=o;else{u=o=queryPos(e,t);a=t}if(!u||!n)return i;var l=rangeForClick(e,u.pos,u.bias,r);if(n.pos!=u.pos&&!s){var f=rangeForClick(e,n.pos,n.bias,r);var h=Math.min(f.from,l.from),d=Math.max(f.to,l.to);l=h<l.from?EditorSelection.range(h,d):EditorSelection.range(d,h)}if(s)return i.replaceRange(i.main.extend(l.from,l.to));else if(c)return i.addRange(l);else return EditorSelection.create([l])}}}handlers.dragstart=function(e,t){var n=e.state.selection.main;var r=e.inputState.mouseSelection;if(r)r.dragging=n;if(t.dataTransfer){t.dataTransfer.setData("Text",e.state.sliceDoc(n.from,n.to));t.dataTransfer.effectAllowed="copyMove"}};function dropText(e,t,n,r){var i=e.posAtCoords({x:t.clientX,y:t.clientY});if(i==null||!n)return;t.preventDefault();var o=e.inputState.mouseSelection;var a=r&&o&&o.dragging&&o.dragMove?{from:o.dragging.from,to:o.dragging.to}:null;var s={from:i,insert:n};var c=e.state.changes(a?[a,s]:s);e.focus();e.dispatch({changes:c,selection:{anchor:c.mapPos(i,-1),head:c.mapPos(i,1)},annotations:Transaction.userEvent.of("drop")})}handlers.drop=function(e,t){if(!t.dataTransfer||!e.state.facet(editable))return;var n=t.dataTransfer.files;if(n&&n.length){t.preventDefault();var r=Array(n.length),i=0;var o=function(){if(++i==n.length)dropText(e,t,r.filter((function(e){return e!=null})).join(e.state.lineBreak),false)};var a=function(e){var t=new FileReader;t.onerror=o;t.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(t.result))r[e]=t.result;o()};t.readAsText(n[e])};for(var s=0;s<n.length;s++){a(s)}}else{dropText(e,t,t.dataTransfer.getData("Text"),true)}};handlers.paste=function(e,t){if(!e.state.facet(editable))return;e.observer.flush();var n=brokenClipboardAPI?null:t.clipboardData;var r=n&&n.getData("text/plain");if(r){doPaste(e,r);t.preventDefault()}else{capturePaste(e)}};function captureCopy(e,t){var n=e.dom.parentNode;if(!n)return;var r=n.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px";r.value=t;r.focus();r.selectionEnd=t.length;r.selectionStart=0;setTimeout((function(){r.remove();e.focus()}),50)}function copiedRange(e){var t=[],n=[],r=false;for(var i=0,o=e.selection.ranges;i<o.length;i++){var a=o[i];if(!a.empty){t.push(e.sliceDoc(a.from,a.to));n.push(a)}}if(!t.length){var s=-1;for(var c=0,u=e.selection.ranges;c<u.length;c++){var l=u[c].from;var f=e.doc.lineAt(l);if(f.number>s){t.push(f.text);n.push({from:f.from,to:Math.min(e.doc.length,f.to+1)})}s=f.number}r=true}return{text:t.join(e.lineBreak),ranges:n,linewise:r}}var lastLinewiseCopy=null;handlers.copy=handlers.cut=function(e,t){var n=copiedRange(e.state),r=n.text,i=n.ranges,o=n.linewise;if(!r)return;lastLinewiseCopy=o?r:null;var a=brokenClipboardAPI?null:t.clipboardData;if(a){t.preventDefault();a.clearData();a.setData("text/plain",r)}else{captureCopy(e,r)}if(t.type=="cut"&&e.state.facet(editable))e.dispatch({changes:i,scrollIntoView:true,annotations:Transaction.userEvent.of("cut")})};handlers.focus=handlers.blur=function(e){setTimeout((function(){if(e.hasFocus!=e.inputState.notifiedFocused)e.update([])}),10)};handlers.beforeprint=function(e){e.viewState.printing=true;e.requestMeasure();setTimeout((function(){e.viewState.printing=false;e.requestMeasure()}),2e3)};function forceClearComposition(e,t){if(e.docView.compositionDeco.size){e.inputState.rapidCompositionStart=t;try{e.update([])}finally{e.inputState.rapidCompositionStart=false}}}handlers.compositionstart=handlers.compositionupdate=function(e){if(e.inputState.composing<0){if(e.docView.compositionDeco.size){e.observer.flush();forceClearComposition(e,true)}e.inputState.composing=0}};handlers.compositionend=function(e){e.inputState.composing=-1;e.inputState.compositionEndedAt=Date.now();setTimeout((function(){if(e.inputState.composing<0)forceClearComposition(e,false)}),50)};handlers.contextmenu=function(e){e.inputState.lastContextMenu=Date.now()};var wrappingWhiteSpace=["pre-wrap","normal","pre-line"];var HeightOracle=function(){function e(){this.doc=Text.empty;this.lineWrapping=false;this.direction=Direction.LTR;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=false}e.prototype.heightForGap=function(e,t){var n=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;if(this.lineWrapping)n+=Math.ceil((t-e-n*this.lineLength*.5)/this.lineLength);return this.lineHeight*n};e.prototype.heightForLine=function(e){if(!this.lineWrapping)return this.lineHeight;var t=1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5)));return t*this.lineHeight};e.prototype.setDoc=function(e){this.doc=e;return this};e.prototype.mustRefresh=function(e,t,n){var r=false;for(var i=0;i<e.length;i++){var o=e[i];if(o<0){i++}else if(!this.heightSamples[Math.floor(o*10)]){r=true;this.heightSamples[Math.floor(o*10)]=true}}return r||wrappingWhiteSpace.indexOf(t)>-1!=this.lineWrapping||this.direction!=n};e.prototype.refresh=function(e,t,n,r,i,o){var a=wrappingWhiteSpace.indexOf(e)>-1;var s=Math.round(n)!=Math.round(this.lineHeight)||this.lineWrapping!=a||this.direction!=t;this.lineWrapping=a;this.direction=t;this.lineHeight=n;this.charWidth=r;this.lineLength=i;if(s){this.heightSamples={};for(var c=0;c<o.length;c++){var u=o[c];if(u<0)c++;else this.heightSamples[Math.floor(u*10)]=true}}return s};return e}();var MeasuredHeights=function(){function e(e,t){this.from=e;this.heights=t;this.index=0}Object.defineProperty(e.prototype,"more",{get:function(){return this.index<this.heights.length},enumerable:false,configurable:true});return e}();var BlockInfo=function(){function e(e,t,n,r,i){this.from=e;this.length=t;this.top=n;this.height=r;this.type=i}Object.defineProperty(e.prototype,"to",{get:function(){return this.from+this.length},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"bottom",{get:function(){return this.top+this.height},enumerable:false,configurable:true});e.prototype.join=function(t){var n=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new e(this.from,this.length+t.length,this.top,this.height+t.height,n)};return e}();var QueryType=function(e){e[e["ByPos"]=0]="ByPos";e[e["ByHeight"]=1]="ByHeight";e[e["ByPosNoHeight"]=2]="ByPosNoHeight";return e}(QueryType||(QueryType={}));var Epsilon=1e-4;var HeightMap=function(){function e(e,t,n){if(n===void 0){n=2}this.length=e;this.height=t;this.flags=n}Object.defineProperty(e.prototype,"outdated",{get:function(){return(this.flags&2)>0},set:function(e){this.flags=(e?2:0)|this.flags&~2},enumerable:false,configurable:true});e.prototype.setHeight=function(e,t){if(this.height!=t){if(Math.abs(this.height-t)>Epsilon)e.heightChanged=true;this.height=t}};e.prototype.replace=function(t,n,r){return e.of(r)};e.prototype.decomposeLeft=function(e,t){t.push(this)};e.prototype.decomposeRight=function(e,t){t.push(this)};e.prototype.applyChanges=function(e,t,n,r){var i=this;for(var o=r.length-1;o>=0;o--){var a=r[o],s=a.fromA,c=a.toA,u=a.fromB,l=a.toB;var f=i.lineAt(s,QueryType.ByPosNoHeight,t,0,0);var h=f.to>=c?f:i.lineAt(c,QueryType.ByPosNoHeight,t,0,0);l+=h.to-c;c=h.to;while(o>0&&f.from<=r[o-1].toA){s=r[o-1].fromA;u=r[o-1].fromB;o--;if(s<f.from)f=i.lineAt(s,QueryType.ByPosNoHeight,t,0,0)}u+=f.from-s;s=f.from;var d=NodeBuilder.build(n,e,u,l);i=i.replace(s,c,d)}return i.updateHeight(n,0)};e.empty=function(){return new HeightMapText(0,0)};e.of=function(t){if(t.length==1)return t[0];var n=0,r=t.length,i=0,o=0;for(;;){if(n==r){if(i>o*2){var a=t[n-1];if(a.break)t.splice(--n,1,a.left,null,a.right);else t.splice(--n,1,a.left,a.right);r+=1+a.break;i-=a.size}else if(o>i*2){var a=t[r];if(a.break)t.splice(r,1,a.left,null,a.right);else t.splice(r,1,a.left,a.right);r+=2+a.break;o-=a.size}else{break}}else if(i<o){var s=t[n++];if(s)i+=s.size}else{var s=t[--r];if(s)o+=s.size}}var c=0;if(t[n-1]==null){c=1;n--}else if(t[n]==null){c=1;r++}return new HeightMapBranch(e.of(t.slice(0,n)),c,e.of(t.slice(r)))};return e}();HeightMap.prototype.size=1;var HeightMapBlock=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this,t,n)||this;i.type=r;return i}t.prototype.blockAt=function(e,t,n,r){return new BlockInfo(r,this.length,n,this.height,this.type)};t.prototype.lineAt=function(e,t,n,r,i){return this.blockAt(0,n,r,i)};t.prototype.forEachLine=function(e,t,n,r,i,o){o(this.blockAt(0,n,r,i))};t.prototype.updateHeight=function(e,t,n,r){if(t===void 0){t=0}if(n===void 0){n=false}if(r&&r.from<=t&&r.more)this.setHeight(e,r.heights[r.index++]);this.outdated=false;return this};t.prototype.toString=function(){return"block("+this.length+")"};return t}(HeightMap);var HeightMapText=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t,n,BlockType.Text)||this;r.collapsed=0;r.widgetHeight=0;return r}t.prototype.replace=function(e,n,r){var i=r[0];if(r.length==1&&(i instanceof t||i instanceof HeightMapGap&&i.flags&4)&&Math.abs(this.length-i.length)<10){if(i instanceof HeightMapGap)i=new t(i.length,this.height);else i.height=this.height;if(!this.outdated)i.outdated=false;return i}else{return HeightMap.of(r)}};t.prototype.updateHeight=function(e,t,n,r){if(t===void 0){t=0}if(n===void 0){n=false}if(r&&r.from<=t&&r.more)this.setHeight(e,r.heights[r.index++]);else if(n||this.outdated)this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed)));this.outdated=false;return this};t.prototype.toString=function(){return"line("+this.length+(this.collapsed?-this.collapsed:"")+(this.widgetHeight?":"+this.widgetHeight:"")+")"};return t}(HeightMapBlock);var HeightMapGap=function(e){__extends(t,e);function t(t){return e.call(this,t,0)||this}t.prototype.lines=function(e,t){var n=e.lineAt(t).number,r=e.lineAt(t+this.length).number;return{firstLine:n,lastLine:r,lineHeight:this.height/(r-n+1)}};t.prototype.blockAt=function(e,t,n,r){var i=this.lines(t,r),o=i.firstLine,a=i.lastLine,s=i.lineHeight;var c=Math.max(0,Math.min(a-o,Math.floor((e-n)/s)));var u=t.line(o+c),l=u.from,f=u.length;return new BlockInfo(l,f,n+s*c,s,BlockType.Text)};t.prototype.lineAt=function(e,t,n,r,i){if(t==QueryType.ByHeight)return this.blockAt(e,n,r,i);if(t==QueryType.ByPosNoHeight){var o=n.lineAt(e),a=o.from,s=o.to;return new BlockInfo(a,s-a,0,0,BlockType.Text)}var c=this.lines(n,i),u=c.firstLine,l=c.lineHeight;var f=n.lineAt(e),h=f.from,d=f.length,p=f.number;return new BlockInfo(h,d,r+l*(p-u),l,BlockType.Text)};t.prototype.forEachLine=function(e,t,n,r,i,o){var a=this.lines(n,i),s=a.firstLine,c=a.lineHeight;for(var u=Math.max(e,i),l=Math.min(i+this.length,t);u<=l;){var f=n.lineAt(u);if(u==e)r+=c*(f.number-s);o(new BlockInfo(f.from,f.length,r,c,BlockType.Text));r+=c;u=f.to+1}};t.prototype.replace=function(e,n,r){var i=this.length-n;if(i>0){var o=r[r.length-1];if(o instanceof t)r[r.length-1]=new t(o.length+i);else r.push(null,new t(i-1))}if(e>0){var a=r[0];if(a instanceof t)r[0]=new t(e+a.length);else r.unshift(new t(e-1),null)}return HeightMap.of(r)};t.prototype.decomposeLeft=function(e,n){n.push(new t(e-1),null)};t.prototype.decomposeRight=function(e,n){n.push(null,new t(this.length-e-1))};t.prototype.updateHeight=function(e,n,r,i){if(n===void 0){n=0}if(r===void 0){r=false}var o=n+this.length;if(i&&i.from<=n+this.length&&i.more){var a=[],s=Math.max(n,i.from);if(i.from>n)a.push(new t(i.from-n-1).updateHeight(e,n));while(s<=o&&i.more){var c=e.doc.lineAt(s).length;if(a.length)a.push(null);var u=new HeightMapText(c,i.heights[i.index++]);u.outdated=false;a.push(u);s+=c+1}if(s<=o)a.push(null,new t(o-s).updateHeight(e,s));e.heightChanged=true;return HeightMap.of(a)}else if(r||this.outdated){this.setHeight(e,e.heightForGap(n,n+this.length));this.outdated=false}return this};t.prototype.toString=function(){return"gap("+this.length+")"};return t}(HeightMap);var HeightMapBranch=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this,t.length+n+r.length,t.height+r.height,n|(t.outdated||r.outdated?2:0))||this;i.left=t;i.right=r;i.size=t.size+r.size;return i}Object.defineProperty(t.prototype,"break",{get:function(){return this.flags&1},enumerable:false,configurable:true});t.prototype.blockAt=function(e,t,n,r){var i=n+this.left.height;return e<i||this.right.height==0?this.left.blockAt(e,t,n,r):this.right.blockAt(e,t,i,r+this.left.length+this.break)};t.prototype.lineAt=function(e,t,n,r,i){var o=r+this.left.height,a=i+this.left.length+this.break;var s=t==QueryType.ByHeight?e<o||this.right.height==0:e<a;var c=s?this.left.lineAt(e,t,n,r,i):this.right.lineAt(e,t,n,o,a);if(this.break||(s?c.to<a:c.from>a))return c;var u=t==QueryType.ByPosNoHeight?QueryType.ByPosNoHeight:QueryType.ByPos;if(s)return c.join(this.right.lineAt(a,u,n,o,a));else return this.left.lineAt(a,u,n,r,i).join(c)};t.prototype.forEachLine=function(e,t,n,r,i,o){var a=r+this.left.height,s=i+this.left.length+this.break;if(this.break){if(e<s)this.left.forEachLine(e,t,n,r,i,o);if(t>=s)this.right.forEachLine(e,t,n,a,s,o)}else{var c=this.lineAt(s,QueryType.ByPos,n,r,i);if(e<c.from)this.left.forEachLine(e,c.from-1,n,r,i,o);if(c.to>=e&&c.from<=t)o(c);if(t>c.to)this.right.forEachLine(c.to+1,t,n,a,s,o)}};t.prototype.replace=function(e,t,n){var r=this.left.length+this.break;if(t<r)return this.balanced(this.left.replace(e,t,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,t-r,n));var i=[];if(e>0)this.decomposeLeft(e,i);var o=i.length;for(var a=0,s=n;a<s.length;a++){var c=s[a];i.push(c)}if(e>0)mergeGaps(i,o-1);if(t<this.length){var u=i.length;this.decomposeRight(t,i);mergeGaps(i,u)}return HeightMap.of(i)};t.prototype.decomposeLeft=function(e,t){var n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,t);t.push(this.left);if(this.break){n++;if(e>=n)t.push(null)}if(e>n)this.right.decomposeLeft(e-n,t)};t.prototype.decomposeRight=function(e,t){var n=this.left.length,r=n+this.break;if(e>=r)return this.right.decomposeRight(e-r,t);if(e<n)this.left.decomposeRight(e,t);if(this.break&&e<r)t.push(null);t.push(this.right)};t.prototype.balanced=function(e,t){if(e.size>2*t.size||t.size>2*e.size)return HeightMap.of(this.break?[e,null,t]:[e,t]);this.left=e;this.right=t;this.height=e.height+t.height;this.outdated=e.outdated||t.outdated;this.size=e.size+t.size;this.length=e.length+this.break+t.length;return this};t.prototype.updateHeight=function(e,t,n,r){if(t===void 0){t=0}if(n===void 0){n=false}var i=this,o=i.left,a=i.right,s=t+o.length+this.break,c=null;if(r&&r.from<=t+o.length&&r.more)c=o=o.updateHeight(e,t,n,r);else o.updateHeight(e,t,n);if(r&&r.from<=s+a.length&&r.more)c=a=a.updateHeight(e,s,n,r);else a.updateHeight(e,s,n);if(c)return this.balanced(o,a);this.height=this.left.height+this.right.height;this.outdated=false;return this};t.prototype.toString=function(){return this.left+(this.break?" ":"-")+this.right};return t}(HeightMap);function mergeGaps(e,t){var n,r;if(e[t]==null&&(n=e[t-1])instanceof HeightMapGap&&(r=e[t+1])instanceof HeightMapGap)e.splice(t-1,3,new HeightMapGap(n.length+1+r.length))}var relevantWidgetHeight=5;var NodeBuilder=function(){function e(e,t){this.pos=e;this.oracle=t;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=e}Object.defineProperty(e.prototype,"isCovered",{get:function(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering},enumerable:false,configurable:true});e.prototype.span=function(e,t){if(this.lineStart>-1){var n=Math.min(t,this.lineEnd),r=this.nodes[this.nodes.length-1];if(r instanceof HeightMapText)r.length+=n-this.pos;else if(n>this.pos||!this.isCovered)this.nodes.push(new HeightMapText(n-this.pos,-1));this.writtenTo=n;if(t>n){this.nodes.push(null);this.writtenTo++;this.lineStart=-1}}this.pos=t};e.prototype.point=function(e,t,n){if(e<t||n.heightRelevant){var r=n.widget?Math.max(0,n.widget.estimatedHeight):0;var i=t-e;if(n.block){this.addBlock(new HeightMapBlock(i,r,n.type))}else if(i||r>=relevantWidgetHeight){this.addLineDeco(r,i)}}else if(t>e){this.span(e,t)}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to};e.prototype.enterLine=function(){if(this.lineStart>-1)return;var e=this.oracle.doc.lineAt(this.pos),t=e.from,n=e.to;this.lineStart=t;this.lineEnd=n;if(this.writtenTo<t){if(this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,t-1));this.nodes.push(null)}if(this.pos>t)this.nodes.push(new HeightMapText(this.pos-t,-1));this.writtenTo=this.pos};e.prototype.blankContent=function(e,t){var n=new HeightMapGap(t-e);if(this.oracle.doc.lineAt(e).to==t)n.flags|=4;return n};e.prototype.ensureLine=function(){this.enterLine();var e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;var t=new HeightMapText(0,-1);this.nodes.push(t);return t};e.prototype.addBlock=function(e){this.enterLine();if(e.type==BlockType.WidgetAfter&&!this.isCovered)this.ensureLine();this.nodes.push(e);this.writtenTo=this.pos=this.pos+e.length;if(e.type!=BlockType.WidgetBefore)this.covering=e};e.prototype.addLineDeco=function(e,t){var n=this.ensureLine();n.length+=t;n.collapsed+=t;n.widgetHeight=Math.max(n.widgetHeight,e);this.writtenTo=this.pos=this.pos+t};e.prototype.finish=function(e){var t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(t instanceof HeightMapText)&&!this.isCovered)this.nodes.push(new HeightMapText(0,-1));else if(this.writtenTo<this.pos||t==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var n=e;for(var r=0,i=this.nodes;r<i.length;r++){var o=i[r];if(o instanceof HeightMapText)o.updateHeight(this.oracle,n);n+=o?o.length:1}return this.nodes};e.build=function(t,n,r,i){var o=new e(r,t);RangeSet.spans(n,r,i,o,0);return o.finish(r)};return e}();function heightRelevantDecoChanges(e,t,n){var r=new DecorationComparator;RangeSet.compare(e,t,n,r,0);return r.changes}var DecorationComparator=function(){function e(){this.changes=[]}e.prototype.compareRange=function(){};e.prototype.comparePoint=function(e,t,n,r){if(e<t||n&&n.heightRelevant||r&&r.heightRelevant)addRange(e,t,this.changes,5)};return e}();function visiblePixelRange(e,t){var n=e.getBoundingClientRect();var r=Math.max(0,n.left),i=Math.min(innerWidth,n.right);var o=Math.max(0,n.top),a=Math.min(innerHeight,n.bottom);for(var s=e.parentNode;s;){if(s.nodeType==1){var c=window.getComputedStyle(s);if((s.scrollHeight>s.clientHeight||s.scrollWidth>s.clientWidth)&&c.overflow!="visible"){var u=s.getBoundingClientRect();r=Math.max(r,u.left);i=Math.min(i,u.right);o=Math.max(o,u.top);a=Math.min(a,u.bottom)}s=c.position=="absolute"||c.position=="fixed"?s.offsetParent:s.parentNode}else if(s.nodeType==11){s=s.host}else{break}}return{left:r-n.left,right:i-n.left,top:o-(n.top+t),bottom:a-(n.top+t)}}var LineGap=function(){function e(e,t,n){this.from=e;this.to=t;this.size=n}e.same=function(e,t){if(e.length!=t.length)return false;for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(r.from!=i.from||r.to!=i.to||r.size!=i.size)return false}return true};e.prototype.draw=function(e){return Decoration.replace({widget:new LineGapWidget(this.size,e)}).range(this.from,this.to)};return e}();var LineGapWidget=function(e){__extends(t,e);function t(t,n){var r=e.call(this)||this;r.size=t;r.vertical=n;return r}t.prototype.eq=function(e){return e.size==this.size&&e.vertical==this.vertical};t.prototype.toDOM=function(){var e=document.createElement("div");if(this.vertical){e.style.height=this.size+"px"}else{e.style.width=this.size+"px";e.style.height="2px";e.style.display="inline-block"}return e};Object.defineProperty(t.prototype,"estimatedHeight",{get:function(){return this.vertical?this.size:-1},enumerable:false,configurable:true});return t}(WidgetType);var ViewState=function(){function e(e){this.state=e;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentWidth=0;this.heightOracle=new HeightOracle;this.scaler=IdScaler;this.scrollTo=null;this.printing=false;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;this.heightMap=HeightMap.empty().applyChanges(e.facet(decorations),Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]);this.viewport=this.getViewport(0,null);this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration.set(this.lineGaps.map((function(e){return e.draw(false)})));this.computeVisibleRanges()}e.prototype.updateForViewport=function(){var e=[this.viewport],t=this.state.selection.main;var n=function(n){var i=n?t.head:t.anchor;if(!e.some((function(e){var t=e.from,n=e.to;return i>=t&&i<=n}))){var o=r.lineAt(i,0),a=o.from,s=o.to;e.push(new Viewport(a,s))}};var r=this;for(var i=0;i<=1;i++){n(i)}this.viewports=e.sort((function(e,t){return e.from-t.from}));this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle.doc,this.heightMap,this.viewports)};e.prototype.update=function(e,t){if(t===void 0){t=null}var n=this.state;this.state=e.state;var r=this.state.facet(decorations);var i=e.changedRanges;var o=ChangedRange.extendWithRanges(i,heightRelevantDecoChanges(e.startState.facet(decorations),r,e?e.changes:ChangeSet.empty(this.state.doc.length)));var a=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(r,n.doc,this.heightOracle.setDoc(this.state.doc),o);if(this.heightMap.height!=a)e.flags|=2;var s=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;if(t&&(t.head<s.from||t.head>s.to)||!this.viewportIsAppropriate(s))s=this.getViewport(0,t);if(!s.eq(this.viewport)){this.viewport=s;e.flags|=4}this.updateForViewport();if(this.lineGaps.length||this.viewport.to-this.viewport.from>15e3)e.flags|=this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes)));this.computeVisibleRanges();if(t)this.scrollTo=t;if(!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc)this.mustEnforceCursorAssoc=true};e.prototype.measure=function(e,t){var n=e.dom,r="",i=Direction.LTR;if(!t){var o=window.getComputedStyle(n);r=o.whiteSpace,i=o.direction=="rtl"?Direction.RTL:Direction.LTR;this.paddingTop=parseInt(o.paddingTop)||0;this.paddingBottom=parseInt(o.paddingBottom)||0}var a=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:visiblePixelRange(n,this.paddingTop);var s=a.top-this.pixelViewport.top,c=a.bottom-this.pixelViewport.bottom;this.pixelViewport=a;this.inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(!this.inView)return 0;var u=e.measureVisibleLineHeights();var l=false,f=0,h=0,d=this.heightOracle;if(!t){var p=e.dom.clientWidth;if(d.mustRefresh(u,r,i)||d.lineWrapping&&Math.abs(p-this.contentWidth)>d.charWidth){var v=e.measureTextSize(),m=v.lineHeight,g=v.charWidth;l=d.refresh(r,i,m,g,p/g,u);if(l){e.minWidth=0;h|=16}}if(this.contentWidth!=p){this.contentWidth=p;h|=16}if(s>0&&c>0)f=Math.max(s,c);else if(s<0&&c<0)f=Math.min(s,c)}d.heightChanged=false;this.heightMap=this.heightMap.updateHeight(d,0,l,new MeasuredHeights(this.viewport.from,u));if(d.heightChanged)h|=2;if(!this.viewportIsAppropriate(this.viewport,f)||this.scrollTo&&(this.scrollTo.head<this.viewport.from||this.scrollTo.head>this.viewport.to)){var y=this.getViewport(f,this.scrollTo);if(y.from!=this.viewport.from||y.to!=this.viewport.to){this.viewport=y;h|=4}}this.updateForViewport();if(this.lineGaps.length||this.viewport.to-this.viewport.from>15e3)h|=this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps));this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;e.enforceCursorAssoc()}return h};Object.defineProperty(e.prototype,"visibleTop",{get:function(){return this.scaler.fromDOM(this.pixelViewport.top,0)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"visibleBottom",{get:function(){return this.scaler.fromDOM(this.pixelViewport.bottom,0)},enumerable:false,configurable:true});e.prototype.getViewport=function(e,t){var n=.5-Math.max(-.5,Math.min(.5,e/1e3/2));var r=this.heightMap,i=this.state.doc,o=this,a=o.visibleTop,s=o.visibleBottom;var c=new Viewport(r.lineAt(a-n*1e3,QueryType.ByHeight,i,0,0).from,r.lineAt(s+(1-n)*1e3,QueryType.ByHeight,i,0,0).to);if(t){if(t.head<c.from){var u=r.lineAt(t.head,QueryType.ByPos,i,0,0).top;c=new Viewport(r.lineAt(u-1e3/2,QueryType.ByHeight,i,0,0).from,r.lineAt(u+(s-a)+1e3/2,QueryType.ByHeight,i,0,0).to)}else if(t.head>c.to){var l=r.lineAt(t.head,QueryType.ByPos,i,0,0).bottom;c=new Viewport(r.lineAt(l-(s-a)-1e3/2,QueryType.ByHeight,i,0,0).from,r.lineAt(l+1e3/2,QueryType.ByHeight,i,0,0).to)}}return c};e.prototype.mapViewport=function(e,t){var n=t.mapPos(e.from,-1),r=t.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(n,QueryType.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(r,QueryType.ByPos,this.state.doc,0,0).to)};e.prototype.viewportIsAppropriate=function(e,t){var n=e.from,r=e.to;if(t===void 0){t=0}var i=this.heightMap.lineAt(n,QueryType.ByPos,this.state.doc,0,0).top;var o=this.heightMap.lineAt(r,QueryType.ByPos,this.state.doc,0,0).bottom;var a=this,s=a.visibleTop,c=a.visibleBottom;return(n==0||i<=s-Math.max(10,Math.min(-t,250)))&&(r==this.state.doc.length||o>=c+Math.max(10,Math.min(t,250)))&&(i>s-2*1e3&&o<c+2*1e3)};e.prototype.mapLineGaps=function(e,t){if(!e.length||t.empty)return e;var n=[];for(var r=0,i=e;r<i.length;r++){var o=i[r];if(!t.touchesRange(o.from,o.to))n.push(new LineGap(t.mapPos(o.from),t.mapPos(o.to),o.size))}return n};e.prototype.ensureLineGaps=function(e){var t=this;var n=[];if(this.heightOracle.direction!=Direction.LTR)return n;this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(function(r){if(r.length<1e4)return;var i=lineStructure(r.from,r.to,t.state);if(i.total<1e4)return;var o,a;if(t.heightOracle.lineWrapping){if(r.from!=t.viewport.from)o=r.from;else o=findPosition(i,(t.visibleTop-r.top)/r.height);if(r.to!=t.viewport.to)a=r.to;else a=findPosition(i,(t.visibleBottom-r.top)/r.height)}else{var s=i.total*t.heightOracle.charWidth;o=findPosition(i,t.pixelViewport.left/s);a=findPosition(i,t.pixelViewport.right/s)}var c=t.state.selection.main;if(c.from<=o&&c.to>=r.from)o=c.from;if(c.from<=r.to&&c.to>=a)a=c.to;var u=o-1e4,l=a+1e4;if(u>r.from+5e3)n.push(find(e,(function(e){return e.from==r.from&&e.to>u-5e3&&e.to<u+5e3}))||new LineGap(r.from,u,t.gapSize(r,u,true,i)));if(l<r.to-5e3)n.push(find(e,(function(e){return e.to==r.to&&e.from>l-5e3&&e.from<l+5e3}))||new LineGap(l,r.to,t.gapSize(r,l,false,i)))}));return n};e.prototype.gapSize=function(e,t,n,r){if(this.heightOracle.lineWrapping){var i=e.height*findFraction(r,t);return n?i:e.height-i}else{var o=findFraction(r,t);return r.total*this.heightOracle.charWidth*(n?o:1-o)}};e.prototype.updateLineGaps=function(e){var t=this;if(!LineGap.same(e,this.lineGaps)){this.lineGaps=e;this.lineGapDeco=Decoration.set(e.map((function(e){return e.draw(t.heightOracle.lineWrapping)})));return 8}return 0};e.prototype.computeVisibleRanges=function(){var e=this.state.facet(decorations);if(this.lineGaps.length)e=e.concat(this.lineGapDeco);var t=[];RangeSet.spans(e,this.viewport.from,this.viewport.to,{span:function(e,n){t.push({from:e,to:n})},point:function(){}},20);this.visibleRanges=t};e.prototype.lineAt=function(e,t){t+=this.paddingTop;return scaleBlock(this.heightMap.lineAt(e,QueryType.ByPos,this.state.doc,t,0),this.scaler,t)};e.prototype.lineAtHeight=function(e,t){t+=this.paddingTop;return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e,t),QueryType.ByHeight,this.state.doc,t,0),this.scaler,t)};e.prototype.blockAtHeight=function(e,t){t+=this.paddingTop;return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e,t),this.state.doc,t,0),this.scaler,t)};e.prototype.forEachLine=function(e,t,n,r){var i=this;r+=this.paddingTop;return this.heightMap.forEachLine(e,t,this.state.doc,r,0,this.scaler.scale==1?n:function(e){return n(scaleBlock(e,i.scaler,r))})};Object.defineProperty(e.prototype,"contentHeight",{get:function(){return this.domHeight+this.paddingTop+this.paddingBottom},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"domHeight",{get:function(){return this.scaler.toDOM(this.heightMap.height,this.paddingTop)},enumerable:false,configurable:true});return e}();var Viewport=function(){function e(e,t){this.from=e;this.to=t}e.prototype.eq=function(e){return this.from==e.from&&this.to==e.to};return e}();function lineStructure(e,t,n){var r=[],i=e,o=0;RangeSet.spans(n.facet(decorations),e,t,{span:function(){},point:function(e,t){if(e>i){r.push({from:i,to:e});o+=e-i}i=t}},20);if(i<t){r.push({from:i,to:t});o+=t-i}return{total:o,ranges:r}}function findPosition(e,t){var n=e.total,r=e.ranges;if(t<=0)return r[0].from;if(t>=1)return r[r.length-1].to;var i=Math.floor(n*t);for(var o=0;;o++){var a=r[o],s=a.from,c=a.to,u=c-s;if(i<=u)return s+i;i-=u}}function findFraction(e,t){var n=0;for(var r=0,i=e.ranges;r<i.length;r++){var o=i[r],a=o.from,s=o.to;if(t<=s){n+=t-a;break}n+=s-a}return n/e.total}function find(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(t(i))return i}return undefined}var IdScaler={toDOM:function(e){return e},fromDOM:function(e){return e},scale:1};var BigScaler=function(){function e(e,t,n){var r=0,i=0,o=0;this.viewports=n.map((function(n){var i=n.from,o=n.to;var a=t.lineAt(i,QueryType.ByPos,e,0,0).top;var s=t.lineAt(o,QueryType.ByPos,e,0,0).bottom;r+=s-a;return{from:i,to:o,top:a,bottom:s,domTop:0,domBottom:0}}));this.scale=(7e6-r)/(t.height-r);for(var a=0,s=this.viewports;a<s.length;a++){var c=s[a];c.domTop=o+(c.top-i)*this.scale;o=c.domBottom=c.domTop+(c.bottom-c.top);i=c.bottom}}e.prototype.toDOM=function(e,t){e-=t;for(var n=0,r=0,i=0;;n++){var o=n<this.viewports.length?this.viewports[n]:null;if(!o||e<o.top)return i+(e-r)*this.scale+t;if(e<=o.bottom)return o.domTop+(e-o.top)+t;r=o.bottom;i=o.domBottom}};e.prototype.fromDOM=function(e,t){e-=t;for(var n=0,r=0,i=0;;n++){var o=n<this.viewports.length?this.viewports[n]:null;if(!o||e<o.domTop)return r+(e-i)/this.scale+t;if(e<=o.domBottom)return o.top+(e-o.domTop)+t;r=o.bottom;i=o.domBottom}};return e}();function scaleBlock(e,t,n){if(t.scale==1)return e;var r=t.toDOM(e.top,n),i=t.toDOM(e.bottom,n);return new BlockInfo(e.from,e.length,r,i-r,Array.isArray(e.type)?e.type.map((function(e){return scaleBlock(e,t,n)})):e.type)}var theme=Facet.define({combine:function(e){return e.join(" ")}});var darkTheme=Facet.define({combine:function(e){return e.indexOf(true)>-1}});var baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName();var lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(e,t,n){return new StyleModule(t,{finish:function(t){return/&/.test(t)?t.replace(/&\w*/,(function(t){if(t=="&")return e;if(!n||!n[t])throw new RangeError("Unsupported selector: "+t);return n[t]})):e+" "+t}})}var baseTheme$8=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none"},".cm-lineWrapping":{whiteSpace:"pre-wrap",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none",display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-placeholder":{color:"#888",display:"inline-block"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"3px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs);var observeOptions={childList:true,characterData:true,subtree:true,characterDataOldValue:true};var useCharData=browser.ie&&browser.ie_version<=11;var DOMObserver=function(){function e(e,t,n){var r=this;this.view=e;this.onChange=t;this.onScrollChanged=n;this.active=false;this.ignoreSelection=new DOMSelection;this.delayedFlush=-1;this.queue=[];this.lastFlush=0;this.scrollTargets=[];this.intersection=null;this.intersecting=false;this._selectionRange=null;this.parentCheck=-1;this.dom=e.contentDOM;this.observer=new MutationObserver((function(t){for(var n=0,i=t;n<i.length;n++){var o=i[n];r.queue.push(o)}r._selectionRange=null;if((browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&t.some((function(e){return e.type=="childList"&&e.removedNodes.length||e.type=="characterData"&&e.oldValue.length>e.target.nodeValue.length})))r.flushSoon();else r.flush()}));if(useCharData)this.onCharData=function(e){r.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue});r.flushSoon()};this.onSelectionChange=this.onSelectionChange.bind(this);this.start();this.onScroll=this.onScroll.bind(this);window.addEventListener("scroll",this.onScroll);if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver((function(e){if(r.parentCheck<0)r.parentCheck=setTimeout(r.listenForScroll.bind(r),1e3);if(e[e.length-1].intersectionRatio>0!=r.intersecting){r.intersecting=!r.intersecting;if(r.intersecting!=r.view.inView)r.onScrollChanged(document.createEvent("Event"))}}),{});this.intersection.observe(this.dom)}this.listenForScroll()}e.prototype.onScroll=function(e){if(this.intersecting)this.flush();this.onScrollChanged(e)};e.prototype.onSelectionChange=function(e){if(this.lastFlush<Date.now()-50)this._selectionRange=null;var t=this.view,n=this.selectionRange;if(t.state.facet(editable)?t.root.activeElement!=this.dom:!hasSelection(t.dom,n))return;var r=n.anchorNode&&t.docView.nearest(n.anchorNode);if(r&&r.ignoreEvent(e))return;if(browser.ie&&browser.ie_version<=11&&!t.state.selection.main.empty&&n.focusNode&&isEquivalentPosition(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset))this.flushSoon();else this.flush()};Object.defineProperty(e.prototype,"selectionRange",{get:function(){if(!this._selectionRange){var e=this.view.root,t=getSelection(e);if(browser.safari&&e.nodeType==11&&deepActiveElement()==this.view.contentDOM)t=safariSelectionRangeHack(this.view)||t;this._selectionRange=t}return this._selectionRange},enumerable:false,configurable:true});e.prototype.setSelectionRange=function(e,t){var n;if(!((n=this._selectionRange)===null||n===void 0?void 0:n.type))this._selectionRange={anchorNode:e.node,anchorOffset:e.offset,focusNode:t.node,focusOffset:t.offset}};e.prototype.listenForScroll=function(){this.parentCheck=-1;var e=0,t=null;for(var n=this.dom;n;){if(n.nodeType==1){if(!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==n)e++;else if(!t)t=this.scrollTargets.slice(0,e);if(t)t.push(n);n=n.assignedSlot||n.parentNode}else if(n.nodeType==11){n=n.host}else{break}}if(e<this.scrollTargets.length&&!t)t=this.scrollTargets.slice(0,e);if(t){for(var r=0,i=this.scrollTargets;r<i.length;r++){var n=i[r];n.removeEventListener("scroll",this.onScroll)}for(var o=0,a=this.scrollTargets=t;o<a.length;o++){var n=a[o];n.addEventListener("scroll",this.onScroll)}}};e.prototype.ignore=function(e){if(!this.active)return e();try{this.stop();return e()}finally{this.start();this.clear()}};e.prototype.start=function(){if(this.active)return;this.observer.observe(this.dom,observeOptions);this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange);if(useCharData)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true};e.prototype.stop=function(){if(!this.active)return;this.active=false;this.observer.disconnect();this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange);if(useCharData)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData)};e.prototype.clearSelection=function(){this.ignoreSelection.set(this.selectionRange)};e.prototype.clear=function(){this.observer.takeRecords();this.queue.length=0;this.clearSelection()};e.prototype.flushSoon=function(){var e=this;if(this.delayedFlush<0)this.delayedFlush=window.setTimeout((function(){e.delayedFlush=-1;e.flush()}),20)};e.prototype.forceFlush=function(){if(this.delayedFlush>=0){window.clearTimeout(this.delayedFlush);this.delayedFlush=-1;this.flush()}};e.prototype.flush=function(){var e=this;if(this.delayedFlush>=0)return;this.lastFlush=Date.now();var t=this.queue;for(var n=0,r=this.observer.takeRecords();n<r.length;n++){var i=r[n];t.push(i)}if(t.length)this.queue=[];var o=this.selectionRange;var a=!this.ignoreSelection.eq(o)&&hasSelection(this.dom,o);if(t.length==0&&!a)return;var s=-1,c=-1,u=false;for(var l=0,f=t;l<f.length;l++){var h=f[l];var d=this.readMutation(h);if(!d)continue;if(d.typeOver)u=true;if(s==-1){s=d.from,c=d.to}else{s=Math.min(d.from,s);c=Math.max(d.to,c)}}var p=this.view.state;if(s>-1||a)this.onChange(s,c,u);if(this.view.state==p){if(this.view.docView.dirty){this.ignore((function(){return e.view.docView.sync()}));this.view.docView.dirty=0}this.view.docView.updateSelection()}this.clearSelection()};e.prototype.readMutation=function(e){var t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;t.markDirty();if(e.type=="childList"){var n=findChild(t,e.previousSibling||e.target.previousSibling,-1);var r=findChild(t,e.nextSibling||e.target.nextSibling,1);return{from:n?t.posAfter(n):t.posAtStart,to:r?t.posBefore(r):t.posAtEnd,typeOver:false}}else{return{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}};e.prototype.destroy=function(){this.stop();if(this.intersection)this.intersection.disconnect();for(var e=0,t=this.scrollTargets;e<t.length;e++){var n=t[e];n.removeEventListener("scroll",this.onScroll)}window.removeEventListener("scroll",this.onScroll);clearTimeout(this.parentCheck)};return e}();function findChild(e,t,n){while(t){var r=ContentView.get(t);if(r&&r.parent==e)return r;var i=t.parentNode;t=i!=e.dom?i:n>0?t.nextSibling:t.previousSibling}return null}function safariSelectionRangeHack(e){var t;var n=null;function r(e){e.preventDefault();e.stopImmediatePropagation();n=e.getTargetRanges()[0]}e.contentDOM.addEventListener("beforeinput",r,true);document.execCommand("indent");e.contentDOM.removeEventListener("beforeinput",r,true);if(!n)return null;var i=n.startContainer,o=n.startOffset;var a=n.endContainer,s=n.endOffset;var c=e.docView.domAtPos(e.state.selection.main.anchor);if(isEquivalentPosition(c.node,c.offset,a,s))t=[a,s,i,o],i=t[0],o=t[1],a=t[2],s=t[3];return{anchorNode:i,anchorOffset:o,focusNode:a,focusOffset:s}}function applyDOMChange(e,t,n,r){var i,o;var a=e.state.selection.main,s;if(t>-1&&(s=e.docView.domBoundsAround(t,n,0))){var c=s.from,u=s.to;var l=e.docView.impreciseHead||e.docView.impreciseAnchor?[]:selectionPoints(e);var f=new DOMReader(l,e);f.readRange(s.startDOM,s.endDOM);o=selectionFromPoints(l,c);var h=a.from,d=null;if(e.inputState.lastKeyCode===8&&e.inputState.lastKeyTime>Date.now()-100||browser.android&&f.text.length<u-c){h=a.to;d="end"}var p=findDiff(e.state.sliceDoc(c,u),f.text,h-c,d);if(p)i={from:c+p.from,to:c+p.toA,insert:e.state.toText(f.text.slice(p.from,p.toB))}}else if(e.hasFocus||!e.state.facet(editable)){var v=e.observer.selectionRange;var m=e.docView,g=m.impreciseHead,y=m.impreciseAnchor;var b=g&&g.node==v.focusNode&&g.offset==v.focusOffset||!contains(e.contentDOM,v.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(v.focusNode,v.focusOffset);var w=y&&y.node==v.anchorNode&&y.offset==v.anchorOffset||!contains(e.contentDOM,v.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(v.anchorNode,v.anchorOffset);if(b!=a.head||w!=a.anchor)o=EditorSelection.single(w,b)}if(!i&&!o)return;if(!i&&r&&!a.empty&&o&&o.main.empty)i={from:a.from,to:a.to,insert:e.state.doc.slice(a.from,a.to)};else if(i&&i.from>=a.from&&i.to<=a.to&&(i.from!=a.from||i.to!=a.to)&&a.to-a.from-(i.to-i.from)<=4)i={from:a.from,to:a.to,insert:e.state.doc.slice(a.from,i.from).append(i.insert).append(e.state.doc.slice(i.to,a.to))};if(i){var x=e.state;if(browser.android&&(i.from==a.from&&i.to==a.to&&i.insert.length==1&&i.insert.lines==2&&dispatchKey(e.contentDOM,"Enter",13)||i.from==a.from-1&&i.to==a.to&&i.insert.length==0&&dispatchKey(e.contentDOM,"Backspace",8)||i.from==a.from&&i.to==a.to+1&&i.insert.length==0&&dispatchKey(e.contentDOM,"Delete",46))||browser.ios&&e.inputState.flushIOSKey(e))return;var S=i.insert.toString();if(e.state.facet(inputHandler).some((function(t){return t(e,i.from,i.to,S)})))return;if(e.inputState.composing>=0)e.inputState.composing++;var k=void 0;if(i.from>=a.from&&i.to<=a.to&&i.to-i.from>=(a.to-a.from)/3&&(!o||o.main.empty&&o.main.from==i.from+i.insert.length)){var C=a.from<i.from?x.sliceDoc(a.from,i.from):"";var A=a.to>i.to?x.sliceDoc(i.to,a.to):"";k=x.replaceSelection(e.state.toText(C+i.insert.sliceString(0,undefined,e.state.lineBreak)+A))}else{var M=x.changes(i);k={changes:M,selection:o&&!x.selection.main.eq(o.main)&&o.main.to<=M.newLength?x.selection.replaceRange(o.main):undefined}}e.dispatch(k,{scrollIntoView:true,annotations:Transaction.userEvent.of("input")})}else if(o&&!o.main.eq(a)){var I=false,E=void 0;if(e.inputState.lastSelectionTime>Date.now()-50){if(e.inputState.lastSelectionOrigin=="keyboardselection")I=true;else E=Transaction.userEvent.of(e.inputState.lastSelectionOrigin)}e.dispatch({selection:o,scrollIntoView:I,annotations:E})}}function findDiff(e,t,n,r){var i=Math.min(e.length,t.length);var o=0;while(o<i&&e.charCodeAt(o)==t.charCodeAt(o))o++;if(o==i&&e.length==t.length)return null;var a=e.length,s=t.length;while(a>0&&s>0&&e.charCodeAt(a-1)==t.charCodeAt(s-1)){a--;s--}if(r=="end"){var c=Math.max(0,o-Math.min(a,s));n-=a+c-o}if(a<o&&e.length<t.length){var u=n<=o&&n>=a?o-n:0;o-=u;s=o+(s-a);a=o}else if(s<o){var u=n<=o&&n>=s?o-n:0;o-=u;a=o+(a-s);s=o}return{from:o,toA:a,toB:s}}var DOMReader=function(){function e(e,t){this.points=e;this.view=t;this.text="";this.lineBreak=t.state.lineBreak}e.prototype.readRange=function(e,t){if(!e)return;var n=e.parentNode;for(var r=e;;){this.findPointBefore(n,r);this.readNode(r);var i=r.nextSibling;if(i==t)break;var o=ContentView.get(r),a=ContentView.get(i);if((o?o.breakAfter:isBlockElement(r))||(a?a.breakAfter:isBlockElement(i))&&!(r.nodeName=="BR"&&!r.cmIgnore))this.text+=this.lineBreak;r=i}this.findPointBefore(n,t)};e.prototype.readNode=function(e){if(e.cmIgnore)return;var t=ContentView.get(e);var n=t&&t.overrideDOMText;var r;if(n!=null)r=n.sliceString(0,undefined,this.lineBreak);else if(e.nodeType==3)r=e.nodeValue;else if(e.nodeName=="BR")r=e.nextSibling?this.lineBreak:"";else if(e.nodeType==1)this.readRange(e.firstChild,null);if(r!=null){this.findPointIn(e,r.length);this.text+=r;if(browser.chrome&&this.view.inputState.lastKeyCode==13&&!e.nextSibling&&/\n\n$/.test(this.text))this.text=this.text.slice(0,-1)}};e.prototype.findPointBefore=function(e,t){for(var n=0,r=this.points;n<r.length;n++){var i=r[n];if(i.node==e&&e.childNodes[i.offset]==t)i.pos=this.text.length}};e.prototype.findPointIn=function(e,t){for(var n=0,r=this.points;n<r.length;n++){var i=r[n];if(i.node==e)i.pos=this.text.length+Math.min(i.offset,t)}};return e}();function isBlockElement(e){return e.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}var DOMPoint=function(){function e(e,t){this.node=e;this.offset=t;this.pos=-1}return e}();function selectionPoints(e){var t=[];if(e.root.activeElement!=e.contentDOM)return t;var n=e.observer.selectionRange,r=n.anchorNode,i=n.anchorOffset,o=n.focusNode,a=n.focusOffset;if(r){t.push(new DOMPoint(r,i));if(o!=r||a!=i)t.push(new DOMPoint(o,a))}return t}function selectionFromPoints(e,t){if(e.length==0)return null;var n=e[0].pos,r=e.length==2?e[1].pos:n;return n>-1&&r>-1?EditorSelection.single(n+t,r+t):null}var EditorView=function(){function e(e){var t=this;if(e===void 0){e={}}this.plugins=[];this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=e.dispatch||function(e){return t.update([e])};this.dispatch=this.dispatch.bind(this);this.root=e.root||document;this.viewState=new ViewState(e.state||EditorState.create());this.plugins=this.state.facet(viewPlugin).map((function(e){return new PluginInstance(e).update(t)}));this.observer=new DOMObserver(this,(function(e,n,r){applyDOMChange(t,e,n,r)}),(function(e){t.inputState.runScrollHandlers(t,e);if(t.observer.intersecting)t.measure()}));this.inputState=new InputState(this);this.docView=new DocView(this);this.mountStyles();this.updateAttrs();this.updateState=0;ensureGlobalHandler();this.requestMeasure();if(e.parent)e.parent.appendChild(this.dom)}Object.defineProperty(e.prototype,"state",{get:function(){return this.viewState.state},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewState.viewport},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"visibleRanges",{get:function(){return this.viewState.visibleRanges},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"inView",{get:function(){return this.viewState.inView},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"composing",{get:function(){return this.inputState.composing>0},enumerable:false,configurable:true});e.prototype.dispatch=function(){var e;var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}this._dispatch(t.length==1&&t[0]instanceof Transaction?t[0]:(e=this.state).update.apply(e,t))};e.prototype.update=function(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var t=false,n;var r=this.state;for(var i=0,o=e;i<o.length;i++){var a=o[i];if(a.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=a.state}if(r.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(r);n=new ViewUpdate(this,r,e);var s;try{this.updateState=2;s=e.some((function(e){return e.scrollIntoView}))?r.selection.main:null;this.viewState.update(n,s);this.bidiCache=CachedOrder.update(this.bidiCache,n.changes);if(!n.empty){this.updatePlugins(n);this.inputState.update(n)}t=this.docView.update(n);if(this.state.facet(styleModule)!=this.styleModules)this.mountStyles();this.updateAttrs();this.showAnnouncements(e)}finally{this.updateState=0}if(t||s||this.viewState.mustEnforceCursorAssoc)this.requestMeasure();if(!n.empty)for(var c=0,u=this.state.facet(updateListener);c<u.length;c++){var l=u[c];l(n)}};e.prototype.setState=function(e){var t=this;if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");this.updateState=2;try{for(var n=0,r=this.plugins;n<r.length;n++){var i=r[n];i.destroy(this)}this.viewState=new ViewState(e);this.plugins=e.facet(viewPlugin).map((function(e){return new PluginInstance(e).update(t)}));this.docView=new DocView(this);this.inputState.ensureHandlers(this);this.mountStyles();this.updateAttrs();this.bidiCache=[]}finally{this.updateState=0}this.requestMeasure()};e.prototype.updatePlugins=function(e){var t=e.startState.facet(viewPlugin),n=e.state.facet(viewPlugin);if(t!=n){var r=[];for(var i=0,o=n;i<o.length;i++){var a=o[i];var s=t.indexOf(a);if(s<0){r.push(new PluginInstance(a))}else{var c=this.plugins[s];c.mustUpdate=e;r.push(c)}}for(var u=0,l=this.plugins;u<l.length;u++){var c=l[u];if(c.mustUpdate!=e)c.destroy(this)}this.plugins=r;this.inputState.ensureHandlers(this)}else{for(var f=0,h=this.plugins;f<h.length;f++){var d=h[f];d.mustUpdate=e}}for(var p=0;p<this.plugins.length;p++)this.plugins[p]=this.plugins[p].update(this)};e.prototype.measure=function(){var e=this;if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.measureScheduled=-1;var t=null;try{for(var n=0;;n++){this.updateState=1;var r=this.viewState.measure(this.docView,n>0);var i=this.measureRequests;if(!r&&!i.length&&this.viewState.scrollTo==null)break;this.measureRequests=[];if(n>5){console.warn("Viewport failed to stabilize");break}var o=i.map((function(t){try{return t.read(e)}catch(n){logException(e.state,n);return BadMeasure}}));var a=new ViewUpdate(this,this.state);a.flags|=r;if(!t)t=a;else t.flags|=r;this.updateState=2;if(!a.empty){this.updatePlugins(a);this.inputState.update(a)}this.updateAttrs();if(r)this.docView.update(a);for(var s=0;s<i.length;s++)if(o[s]!=BadMeasure){try{i[s].write(o[s],this)}catch(f){logException(this.state,f)}}if(this.viewState.scrollTo){this.docView.scrollPosIntoView(this.viewState.scrollTo.head,this.viewState.scrollTo.assoc);this.viewState.scrollTo=null}if(!(r&4)&&this.measureRequests.length==0)break}}finally{this.updateState=0}this.measureScheduled=-1;if(t&&!t.empty)for(var c=0,u=this.state.facet(updateListener);c<u.length;c++){var l=u[c];l(t)}};Object.defineProperty(e.prototype,"themeClasses",{get:function(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)},enumerable:false,configurable:true});e.prototype.updateAttrs=function(){var e=combineAttrs(this.state.facet(editorAttributes),{class:"cm-editor cm-wrap"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});updateAttrs(this.dom,this.editorAttrs,e);this.editorAttrs=e;var t=combineAttrs(this.state.facet(contentAttributes),{spellcheck:"false",autocorrect:"off",autocapitalize:"off",contenteditable:String(this.state.facet(editable)),class:"cm-content",style:browser.tabSize+": "+this.state.tabSize,role:"textbox","aria-multiline":"true"});updateAttrs(this.contentDOM,this.contentAttrs,t);this.contentAttrs=t};e.prototype.showAnnouncements=function(t){var n=true;for(var r=0,i=t;r<i.length;r++){var o=i[r];for(var a=0,s=o.effects;a<s.length;a++){var c=s[a];if(c.is(e.announce)){if(n)this.announceDOM.textContent="";n=false;var u=this.announceDOM.appendChild(document.createElement("div"));u.textContent=c.value}}}};e.prototype.mountStyles=function(){this.styleModules=this.state.facet(styleModule);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$8).reverse())};e.prototype.readMeasured=function(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure()};e.prototype.requestMeasure=function(e){var t=this;if(this.measureScheduled<0)this.measureScheduled=requestAnimationFrame((function(){return t.measure()}));if(e){if(e.key!=null)for(var n=0;n<this.measureRequests.length;n++){if(this.measureRequests[n].key===e.key){this.measureRequests[n]=e;return}}this.measureRequests.push(e)}};e.prototype.pluginField=function(e){var t=[];for(var n=0,r=this.plugins;n<r.length;n++){var i=r[n];i.update(this).takeField(e,t)}return t};e.prototype.plugin=function(e){for(var t=0,n=this.plugins;t<n.length;t++){var r=n[t];if(r.spec==e)return r.update(this).value}return null};e.prototype.blockAtHeight=function(e,t){this.readMeasured();return this.viewState.blockAtHeight(e,ensureTop(t,this.contentDOM))};e.prototype.visualLineAtHeight=function(e,t){this.readMeasured();return this.viewState.lineAtHeight(e,ensureTop(t,this.contentDOM))};e.prototype.viewportLines=function(e,t){var n=this.viewport,r=n.from,i=n.to;this.viewState.forEachLine(r,i,e,ensureTop(t,this.contentDOM))};e.prototype.visualLineAt=function(e,t){if(t===void 0){t=0}return this.viewState.lineAt(e,t)};Object.defineProperty(e.prototype,"contentHeight",{get:function(){return this.viewState.contentHeight},enumerable:false,configurable:true});e.prototype.moveByChar=function(e,t,n){return skipAtoms(this,e,moveByChar(this,e,t,n))};e.prototype.moveByGroup=function(e,t){var n=this;return skipAtoms(this,e,moveByChar(this,e,t,(function(t){return byGroup(n,e.head,t)})))};e.prototype.moveToLineBoundary=function(e,t,n){if(n===void 0){n=true}return moveToLineBoundary(this,e,t,n)};e.prototype.moveVertically=function(e,t,n){return skipAtoms(this,e,moveVertically(this,e,t,n))};e.prototype.scrollPosIntoView=function(e){this.viewState.scrollTo=EditorSelection.cursor(e);this.requestMeasure()};e.prototype.domAtPos=function(e){return this.docView.domAtPos(e)};e.prototype.posAtDOM=function(e,t){if(t===void 0){t=0}return this.docView.posFromDOM(e,t)};e.prototype.posAtCoords=function(e){this.readMeasured();return posAtCoords(this,e)};e.prototype.coordsAtPos=function(e,t){if(t===void 0){t=1}this.readMeasured();var n=this.docView.coordsAt(e,t);if(!n||n.left==n.right)return n;var r=this.state.doc.lineAt(e),i=this.bidiSpans(r);var o=i[BidiSpan.find(i,e-r.from,-1,t)];return flattenRect(n,o.dir==Direction.LTR==t>0)};Object.defineProperty(e.prototype,"defaultCharacterWidth",{get:function(){return this.viewState.heightOracle.charWidth},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"defaultLineHeight",{get:function(){return this.viewState.heightOracle.lineHeight},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"textDirection",{get:function(){return this.viewState.heightOracle.direction},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lineWrapping",{get:function(){return this.viewState.heightOracle.lineWrapping},enumerable:false,configurable:true});e.prototype.bidiSpans=function(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);var t=this.textDirection;for(var n=0,r=this.bidiCache;n<r.length;n++){var i=r[n];if(i.from==e.from&&i.dir==t)return i.order}var o=computeOrder(e.text,this.textDirection);this.bidiCache.push(new CachedOrder(e.from,e.to,t,o));return o};Object.defineProperty(e.prototype,"hasFocus",{get:function(){var e;return(document.hasFocus()||browser.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM},enumerable:false,configurable:true});e.prototype.focus=function(){var e=this;this.observer.ignore((function(){focusPreventScroll(e.contentDOM);e.docView.updateSelection()}))};e.prototype.destroy=function(){for(var e=0,t=this.plugins;e<t.length;e++){var n=t[e];n.destroy(this)}this.inputState.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled)};e.domEventHandlers=function(e){return ViewPlugin.define((function(){return{}}),{eventHandlers:e})};e.theme=function(e,t){var n=StyleModule.newName();var r=[theme.of(n),styleModule.of(buildTheme("."+n,e))];if(t&&t.dark)r.push(darkTheme.of(true));return r};e.baseTheme=function(e){return Prec.fallback(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))};return e}();EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"});EditorView.announce=StateEffect.define();var MaxBidiLine=4096;function ensureTop(e,t){return e==null?t.getBoundingClientRect().top:e}var resizeDebounce=-1;function ensureGlobalHandler(){window.addEventListener("resize",(function(){if(resizeDebounce==-1)resizeDebounce=setTimeout(handleResize,50)}))}function handleResize(){resizeDebounce=-1;var e=document.querySelectorAll(".cm-content");for(var t=0;t<e.length;t++){var n=ContentView.get(e[t]);if(n)n.editorView.requestMeasure()}}var BadMeasure={};var CachedOrder=function(){function e(e,t,n,r){this.from=e;this.to=t;this.dir=n;this.order=r}e.update=function(t,n){if(n.empty)return t;var r=[],i=t.length?t[t.length-1].dir:Direction.LTR;for(var o=Math.max(0,t.length-10);o<t.length;o++){var a=t[o];if(a.dir==i&&!n.touchesRange(a.from,a.to))r.push(new e(n.mapPos(a.from,1),n.mapPos(a.to,-1),a.dir,a.order))}return r};return e}();var currentPlatform=typeof navigator=="undefined"?"key":/Mac/.test(navigator.platform)?"mac":/Win/.test(navigator.platform)?"win":/Linux|X11/.test(navigator.platform)?"linux":"key";function normalizeKeyName(e,t){var n=e.split(/-(?!$)/);var r=n[n.length-1];if(r=="Space")r=" ";var i,o,a,s;for(var c=0;c<n.length-1;++c){var u=n[c];if(/^(cmd|meta|m)$/i.test(u))s=true;else if(/^a(lt)?$/i.test(u))i=true;else if(/^(c|ctrl|control)$/i.test(u))o=true;else if(/^s(hift)?$/i.test(u))a=true;else if(/^mod$/i.test(u)){if(t=="mac")s=true;else o=true}else throw new Error("Unrecognized modifier name: "+u)}if(i)r="Alt-"+r;if(o)r="Ctrl-"+r;if(s)r="Meta-"+r;if(a)r="Shift-"+r;return r}function modifiers(e,t,n){if(t.altKey)e="Alt-"+e;if(t.ctrlKey)e="Ctrl-"+e;if(t.metaKey)e="Meta-"+e;if(n!==false&&t.shiftKey)e="Shift-"+e;return e}var handleKeyEvents=EditorView.domEventHandlers({keydown:function(e,t){return runHandlers(getKeymap(t.state),e,t,"editor")}});var keymap=Facet.define({enables:handleKeyEvents});var Keymaps=new WeakMap;function getKeymap(e){var t=e.facet(keymap);var n=Keymaps.get(t);if(!n)Keymaps.set(t,n=buildKeymap(t.reduce((function(e,t){return e.concat(t)}),[])));return n}function runScopeHandlers(e,t,n){return runHandlers(getKeymap(e.state),t,e,n)}var storedPrefix=null;var PrefixTimeout=4e3;function buildKeymap(e,t){if(t===void 0){t=currentPlatform}var n=Object.create(null);var r=Object.create(null);var i=function(e,t){var n=r[e];if(n==null)r[e]=t;else if(n!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")};var o=function(e,r,o,a){var s=n[e]||(n[e]=Object.create(null));var c=r.split(/ (?!$)/).map((function(e){return normalizeKeyName(e,t)}));var u=function(t){var n=c.slice(0,t).join(" ");i(n,true);if(!s[n])s[n]={preventDefault:true,commands:[function(t){var r=storedPrefix={view:t,prefix:n,scope:e};setTimeout((function(){if(storedPrefix==r)storedPrefix=null}),PrefixTimeout);return true}]}};for(var l=1;l<c.length;l++){u(l)}var f=c.join(" ");i(f,false);var h=s[f]||(s[f]={preventDefault:false,commands:[]});h.commands.push(o);if(a)h.preventDefault=true};for(var a=0,s=e;a<s.length;a++){var c=s[a];var u=c[t]||c.key;if(!u)continue;for(var l=0,f=c.scope?c.scope.split(" "):["editor"];l<f.length;l++){var h=f[l];o(h,u,c.run,c.preventDefault);if(c.shift)o(h,"Shift-"+u,c.shift,c.preventDefault)}}return n}function runHandlers(e,t,n,r){var i=keyName(t),o=i.length==1&&i!=" ";var a="",s=false;if(storedPrefix&&storedPrefix.view==n&&storedPrefix.scope==r){a=storedPrefix.prefix+" ";if(s=modifierCodes.indexOf(t.keyCode)<0)storedPrefix=null}var c=function(e){if(e){for(var t=0,r=e.commands;t<r.length;t++){var i=r[t];if(i(n))return true}if(e.preventDefault)s=true}return false};var u=e[r],l;if(u){if(c(u[a+modifiers(i,t,!o)]))return true;if(o&&(t.shiftKey||t.altKey||t.metaKey)&&(l=base[t.keyCode])&&l!=i){if(c(u[a+modifiers(l,t,true)]))return true}else if(o&&t.shiftKey){if(c(u[a+modifiers(i,t,true)]))return true}}return s}var CanHidePrimary=!browser.ios;var selectionConfig=Facet.define({combine:function(e){return combineConfig(e,{cursorBlinkRate:1200,drawRangeCursor:true},{cursorBlinkRate:function(e,t){return Math.min(e,t)},drawRangeCursor:function(e,t){return e||t}})}});function drawSelection(e){if(e===void 0){e={}}return[selectionConfig.of(e),drawSelectionPlugin,hideNativeSelection]}var Piece=function(){function e(e,t,n,r,i){this.left=e;this.top=t;this.width=n;this.height=r;this.className=i}e.prototype.draw=function(){var e=document.createElement("div");e.className=this.className;this.adjust(e);return e};e.prototype.adjust=function(e){e.style.left=this.left+"px";e.style.top=this.top+"px";if(this.width>=0)e.style.width=this.width+"px";e.style.height=this.height+"px"};e.prototype.eq=function(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className};return e}();var drawSelectionPlugin=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.rangePieces=[];this.cursors=[];this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)};this.selectionLayer=e.scrollDOM.appendChild(document.createElement("div"));this.selectionLayer.className="cm-selectionLayer";this.selectionLayer.setAttribute("aria-hidden","true");this.cursorLayer=e.scrollDOM.appendChild(document.createElement("div"));this.cursorLayer.className="cm-cursorLayer";this.cursorLayer.setAttribute("aria-hidden","true");e.requestMeasure(this.measureReq);this.setBlinkRate()}e.prototype.setBlinkRate=function(){this.cursorLayer.style.animationDuration=this.view.state.facet(selectionConfig).cursorBlinkRate+"ms"};e.prototype.update=function(e){var t=e.startState.facet(selectionConfig)!=e.state.facet(selectionConfig);if(t||e.selectionSet||e.geometryChanged||e.viewportChanged)this.view.requestMeasure(this.measureReq);if(e.transactions.some((function(e){return e.scrollIntoView})))this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink";if(t)this.setBlinkRate()};e.prototype.readPos=function(){var e=this;var t=this.view.state,n=t.facet(selectionConfig);var r=t.selection.ranges.map((function(t){return t.empty?[]:measureRange(e.view,t)})).reduce((function(e,t){return e.concat(t)}));var i=[];for(var o=0,a=t.selection.ranges;o<a.length;o++){var s=a[o];var c=s==t.selection.main;if(s.empty?!c||CanHidePrimary:n.drawRangeCursor){var u=measureCursor(this.view,s,c);if(u)i.push(u)}}return{rangePieces:r,cursors:i}};e.prototype.drawSel=function(e){var t=this;var n=e.rangePieces,r=e.cursors;if(n.length!=this.rangePieces.length||n.some((function(e,n){return!e.eq(t.rangePieces[n])}))){this.selectionLayer.textContent="";for(var i=0,o=n;i<o.length;i++){var a=o[i];this.selectionLayer.appendChild(a.draw())}this.rangePieces=n}if(r.length!=this.cursors.length||r.some((function(e,n){return!e.eq(t.cursors[n])}))){var s=this.cursorLayer.children;if(s.length!==r.length){this.cursorLayer.textContent="";for(var c=0,u=r;c<u.length;c++){var l=u[c];this.cursorLayer.appendChild(l.draw())}}else{r.forEach((function(e,t){return e.adjust(s[t])}))}this.cursors=r}};e.prototype.destroy=function(){this.selectionLayer.remove();this.cursorLayer.remove()};return e}());var themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if(CanHidePrimary)themeSpec[".cm-line"].caretColor="transparent !important";var hideNativeSelection=Prec.override(EditorView.theme(themeSpec));function getBase(e){var t=e.scrollDOM.getBoundingClientRect();var n=e.textDirection==Direction.LTR?t.left:t.right-e.scrollDOM.clientWidth;return{left:n-e.scrollDOM.scrollLeft,top:t.top-e.scrollDOM.scrollTop}}function wrappedLine(e,t,n){var r=EditorSelection.cursor(t);return{from:Math.max(n.from,e.moveToLineBoundary(r,false,true).from),to:Math.min(n.to,e.moveToLineBoundary(r,true,true).from),type:BlockType.Text}}function blockAt(e,t){var n=e.visualLineAt(t);if(Array.isArray(n.type))for(var r=0,i=n.type;r<i.length;r++){var o=i[r];if(o.to>t||o.to==t&&(o.to==n.to||o.type==BlockType.Text))return o}return n}function measureRange(e,t){if(t.to<=e.viewport.from||t.from>=e.viewport.to)return[];var n=Math.max(t.from,e.viewport.from),r=Math.min(t.to,e.viewport.to);var i=e.textDirection==Direction.LTR;var o=e.contentDOM,a=o.getBoundingClientRect(),s=getBase(e);var c=window.getComputedStyle(o.firstChild);var u=a.left+parseInt(c.paddingLeft);var l=a.right-parseInt(c.paddingRight);var f=blockAt(e,n),h=blockAt(e,r);var d=f.type==BlockType.Text?f:null;var p=h.type==BlockType.Text?h:null;if(e.lineWrapping){if(d)d=wrappedLine(e,n,d);if(p)p=wrappedLine(e,r,p)}if(d&&p&&d.from==p.from){return b(w(t.from,t.to,d))}else{var v=d?w(t.from,null,d):x(f,false);var m=p?w(null,t.to,p):x(h,true);var g=[];if((d||f).to<(p||h).from-1)g.push(y(u,v.bottom,l,m.top));else if(v.bottom<m.top&&blockAt(e,(v.bottom+m.top)/2).type==BlockType.Text)v.bottom=m.top=(v.bottom+m.top)/2;return b(v).concat(g).concat(b(m))}function y(e,t,n,r){return new Piece(e-s.left,t-s.top,n-e,r-t,"cm-selectionBackground")}function b(e){var t=e.top,n=e.bottom,r=e.horizontal;var i=[];for(var o=0;o<r.length;o+=2)i.push(y(r[o],t,r[o+1],n));return i}function w(t,n,r){var o=1e9,a=-1e9,s=[];function c(t,n,c,f,h){var d=e.coordsAtPos(t,t==r.to?-2:2);var p=e.coordsAtPos(c,c==r.from?2:-2);o=Math.min(d.top,p.top,o);a=Math.max(d.bottom,p.bottom,a);if(h==Direction.LTR)s.push(i&&n?u:d.left,i&&f?l:p.right);else s.push(!i&&f?u:p.left,!i&&n?l:d.right)}var f=t!==null&&t!==void 0?t:r.from,h=n!==null&&n!==void 0?n:r.to;for(var d=0,p=e.visibleRanges;d<p.length;d++){var v=p[d];if(v.to>f&&v.from<h){for(var m=Math.max(v.from,f),g=Math.min(v.to,h);;){var y=e.state.doc.lineAt(m);for(var b=0,w=e.bidiSpans(y);b<w.length;b++){var x=w[b];var S=x.from+y.from,k=x.to+y.from;if(S>=g)break;if(k>m)c(Math.max(S,m),t==null&&S<=f,Math.min(k,g),n==null&&k>=h,x.dir)}m=y.to+1;if(m>=g)break}}}if(s.length==0)c(f,t==null,h,n==null,e.textDirection);return{top:o,bottom:a,horizontal:s}}function x(e,t){var n=a.top+(t?e.top:e.bottom);return{top:n,bottom:n,horizontal:[]}}}function measureCursor(e,t,n){var r=e.coordsAtPos(t.head,t.assoc||1);if(!r)return null;var i=getBase(e);return new Piece(r.left-i.left,r.top-i.top,-1,r.bottom-r.top,n?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}function iterMatches(e,t,n,r,i){t.lastIndex=0;for(var o=e.iterRange(n,r),a=n,s=void 0;!o.next().done;a+=o.value.length){if(!o.lineBreak)while(s=t.exec(o.value))i(a+s.index,a+s.index+s[0].length,s)}}var MatchDecorator=function(){function e(e){var t=e.regexp,n=e.decoration,r=e.boundary;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t;this.getDeco=typeof n=="function"?n:function(){return n};this.boundary=r}e.prototype.createDeco=function(e){var t=this;var n=new RangeSetBuilder;for(var r=0,i=e.visibleRanges;r<i.length;r++){var o=i[r],a=o.from,s=o.to;iterMatches(e.state.doc,this.regexp,a,s,(function(r,i,o){return n.add(r,i,t.getDeco(o,e,r))}))}return n.finish()};e.prototype.updateDeco=function(e,t){var n=1e9,r=-1;if(e.docChanged)e.changes.iterChanges((function(t,i,o,a){if(a>e.view.viewport.from&&o<e.view.viewport.to){n=Math.min(o,n);r=Math.max(a,r)}}));if(e.viewportChanged||r-n>1e3)return this.createDeco(e.view);if(r>-1)return this.updateRange(e.view,t.map(e.changes),n,r);return t};e.prototype.updateRange=function(e,t,n,r){var i=this;var o=function(o){var s=Math.max(o.from,n),c=Math.min(o.to,r);if(c>s){var u=e.state.doc.lineAt(s),l=u.to<c?e.state.doc.lineAt(c):u;var f=Math.max(o.from,u.from),h=Math.min(o.to,l.to);if(a.boundary){for(;s>u.from;s--)if(a.boundary.test(u.text[s-1-u.from])){f=s;break}for(;c<l.to;c++)if(a.boundary.test(l.text[c-l.from])){h=c;break}}var d=[],p=void 0;if(u==l){a.regexp.lastIndex=f-u.from;while((p=a.regexp.exec(u.text))&&p.index<h-u.from){var v=p.index+u.from;d.push(a.getDeco(p,e,v).range(v,v+p[0].length))}}else{iterMatches(e.state.doc,a.regexp,f,h,(function(t,n,r){return d.push(i.getDeco(r,e,t).range(t,n))}))}t=t.update({filterFrom:f,filterTo:h,filter:function(){return false},add:d})}};var a=this;for(var s=0,c=e.visibleRanges;s<c.length;s++){var u=c[s];o(u)}return t};return e}();var UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g";var Specials=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029\ufeff￹-￼]",UnicodeRegexpSupport);var Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};var _supportsTabSize=null;function supportsTabSize(){var e;if(_supportsTabSize==null&&typeof document!="undefined"&&document.body){var t=document.body.style;_supportsTabSize=((e=t.tabSize)!==null&&e!==void 0?e:t.MozTabSize)!=null}return _supportsTabSize||false}var specialCharConfig=Facet.define({combine:function(e){var t=combineConfig(e,{render:null,specialChars:Specials,addSpecialChars:null});if(t.replaceTabs=!supportsTabSize())t.specialChars=new RegExp("\t|"+t.specialChars.source,UnicodeRegexpSupport);if(t.addSpecialChars)t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,UnicodeRegexpSupport);return t}});function highlightSpecialChars(e){if(e===void 0){e={}}return[specialCharConfig.of(e),specialCharPlugin()]}var _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.decorations=Decoration.none;this.decorationCache=Object.create(null);this.decorator=this.makeDecorator(e.state.facet(specialCharConfig));this.decorations=this.decorator.createDeco(e)}e.prototype.makeDecorator=function(e){var t=this;return new MatchDecorator({regexp:e.specialChars,decoration:function(n,r,i){var o=r.state.doc;var a=codePointAt(n[0],0);if(a==9){var s=o.lineAt(i);var c=r.state.tabSize,u=countColumn(o.sliceString(s.from,i),0,c);return Decoration.replace({widget:new TabWidget((c-u%c)*t.view.defaultCharacterWidth)})}return t.decorationCache[a]||(t.decorationCache[a]=Decoration.replace({widget:new SpecialCharWidget(e,a)}))},boundary:e.replaceTabs?undefined:/[^]/})};e.prototype.update=function(e){var t=e.state.facet(specialCharConfig);if(e.startState.facet(specialCharConfig)!=t){this.decorator=this.makeDecorator(t);this.decorations=this.decorator.createDeco(e.view)}else{this.decorations=this.decorator.updateDeco(e,this.decorations)}};return e}(),{decorations:function(e){return e.decorations}}))}var DefaultPlaceholder="•";function placeholder$1(e){if(e>=32)return DefaultPlaceholder;if(e==10)return"␤";return String.fromCharCode(9216+e)}var SpecialCharWidget=function(e){__extends(t,e);function t(t,n){var r=e.call(this)||this;r.options=t;r.code=n;return r}t.prototype.eq=function(e){return e.code==this.code};t.prototype.toDOM=function(e){var t=placeholder$1(this.code);var n=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16));var r=this.options.render&&this.options.render(this.code,n,t);if(r)return r;var i=document.createElement("span");i.textContent=t;i.title=n;i.setAttribute("aria-label",n);i.className="cm-specialChar";return i};t.prototype.ignoreEvent=function(){return false};return t}(WidgetType);var TabWidget=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.width=t;return n}t.prototype.eq=function(e){return e.width==this.width};t.prototype.toDOM=function(){var e=document.createElement("span");e.textContent="\t";e.className="cm-tab";e.style.width=this.width+"px";return e};t.prototype.ignoreEvent=function(){return false};return t}(WidgetType);var ios=typeof navigator!="undefined"&&!/Edge\/(\d+)/.exec(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2);var Outside="-10000px";var tooltipPlugin=ViewPlugin.fromClass(function(){function e(e){var t=this;this.view=e;this.inView=true;this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this};this.input=e.state.facet(showTooltip);this.tooltips=this.input.filter((function(e){return e}));this.tooltipViews=this.tooltips.map((function(e){return t.createTooltip(e)}))}e.prototype.update=function(e){var t=e.state.facet(showTooltip);if(t==this.input){for(var n=0,r=this.tooltipViews;n<r.length;n++){var i=r[n];if(i.update)i.update(e)}}else{var o=t.filter((function(e){return e}));var a=[];for(var s=0;s<o.length;s++){var c=o[s],u=-1;if(!c)continue;for(var l=0;l<this.tooltips.length;l++){var f=this.tooltips[l];if(f&&f.create==c.create)u=l}if(u<0){a[s]=this.createTooltip(c)}else{var h=a[s]=this.tooltipViews[u];if(h.update)h.update(e)}}for(var d=0,p=this.tooltipViews;d<p.length;d++){var v=p[d];if(a.indexOf(v)<0)v.dom.remove()}this.input=t;this.tooltips=o;this.tooltipViews=a;this.maybeMeasure()}};e.prototype.createTooltip=function(e){var t=e.create(this.view);t.dom.classList.add("cm-tooltip");if(e.class)t.dom.classList.add(e.class);t.dom.style.top=Outside;this.view.dom.appendChild(t.dom);if(t.mount)t.mount(this.view);return t};e.prototype.destroy=function(){for(var e=0,t=this.tooltipViews;e<t.length;e++){var n=t[e].dom;n.remove()}};e.prototype.readMeasure=function(){var e=this;return{editor:this.view.dom.getBoundingClientRect(),pos:this.tooltips.map((function(t){return e.view.coordsAtPos(t.pos)})),size:this.tooltipViews.map((function(e){var t=e.dom;return t.getBoundingClientRect()})),innerWidth:window.innerWidth,innerHeight:window.innerHeight}};e.prototype.writeMeasure=function(e){var t=e.editor;for(var n=0;n<this.tooltipViews.length;n++){var r=this.tooltips[n],i=this.tooltipViews[n],o=i.dom;var a=e.pos[n],s=e.size[n];if(!a||a.bottom<=t.top||a.top>=t.bottom||a.right<=t.left||a.left>=t.right){o.style.top=Outside;continue}var c=s.right-s.left,u=s.bottom-s.top;var l=this.view.textDirection==Direction.LTR?Math.min(a.left,e.innerWidth-c):Math.max(0,a.left-c);var f=!!r.above;if(!r.strictSide&&(f?a.top-(s.bottom-s.top)<0:a.bottom+(s.bottom-s.top)>e.innerHeight))f=!f;if(ios){o.style.top=(f?a.top-u:a.bottom)-t.top+"px";o.style.left=l-t.left+"px";o.style.position="absolute"}else{o.style.top=(f?a.top-u:a.bottom)+"px";o.style.left=l+"px"}o.classList.toggle("cm-tooltip-above",f);o.classList.toggle("cm-tooltip-below",!f);if(i.positioned)i.positioned()}};e.prototype.maybeMeasure=function(){if(this.tooltips.length){if(this.view.inView||this.inView)this.view.requestMeasure(this.measureReq);this.inView=this.view.inView}};return e}(),{eventHandlers:{scroll:function(){this.maybeMeasure()}}});var baseTheme$7=EditorView.baseTheme({".cm-tooltip":{position:"fixed",zIndex:100},"&light .cm-tooltip":{border:"1px solid #ddd",backgroundColor:"#f5f5f5"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"}});var showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$7]});var DefaultBufferLength=1024;var nextPropID=0;var CachedNode=new WeakMap;var NodeProp=function(){function e(e){var t=e===void 0?{}:e,n=t.deserialize;this.id=nextPropID++;this.deserialize=n||function(){throw new Error("This node type doesn't define a deserialize function")}}e.string=function(){return new e({deserialize:function(e){return e}})};e.number=function(){return new e({deserialize:Number})};e.flag=function(){return new e({deserialize:function(){return true}})};e.prototype.set=function(e,t){e[this.id]=t;return e};e.prototype.add=function(e){var t=this;if(typeof e!="function")e=NodeType.match(e);return function(n){var r=e(n);return r===undefined?null:[t,r]}};return e}();NodeProp.closedBy=new NodeProp({deserialize:function(e){return e.split(" ")}});NodeProp.openedBy=new NodeProp({deserialize:function(e){return e.split(" ")}});NodeProp.group=new NodeProp({deserialize:function(e){return e.split(" ")}});var noProps=Object.create(null);var NodeType=function(){function e(e,t,n,r){if(r===void 0){r=0}this.name=e;this.props=t;this.id=n;this.flags=r}e.define=function(t){var n=t.props&&t.props.length?Object.create(null):noProps;var r=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0);var i=new e(t.name||"",n,t.id,r);if(t.props)for(var o=0,a=t.props;o<a.length;o++){var s=a[o];if(!Array.isArray(s))s=s(i);if(s)s[0].set(n,s[1])}return i};e.prototype.prop=function(e){return this.props[e.id]};Object.defineProperty(e.prototype,"isTop",{get:function(){return(this.flags&1)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"isSkipped",{get:function(){return(this.flags&2)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"isError",{get:function(){return(this.flags&4)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"isAnonymous",{get:function(){return(this.flags&8)>0},enumerable:false,configurable:true});e.prototype.is=function(e){if(typeof e=="string"){if(this.name==e)return true;var t=this.prop(NodeProp.group);return t?t.indexOf(e)>-1:false}return this.id==e};e.match=function(e){var t=Object.create(null);for(var n in e)for(var r=0,i=n.split(" ");r<i.length;r++){var o=i[r];t[o]=e[n]}return function(e){for(var n=e.prop(NodeProp.group),r=-1;r<(n?n.length:0);r++){var i=t[r<0?e.name:n[r]];if(i)return i}}};return e}();NodeType.none=new NodeType("",Object.create(null),0,8);var NodeSet=function(){function e(e){this.types=e;for(var t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}e.prototype.extend=function(){var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}var r=[];for(var i=0,o=this.types;i<o.length;i++){var a=o[i];var s=null;for(var c=0,u=t;c<u.length;c++){var l=u[c];var f=l(a);if(f){if(!s)s=Object.assign({},a.props);f[0].set(s,f[1])}}r.push(s?new NodeType(a.name,s,a.id,a.flags):a)}return new e(r)};return e}();var Tree=function(){function e(e,t,n,r){this.type=e;this.children=t;this.positions=n;this.length=r}e.prototype.toString=function(){var e=this.children.map((function(e){return e.toString()})).join();return!this.type.name?e:(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":"")};e.prototype.cursor=function(e,t){if(t===void 0){t=0}var n=e!=null&&CachedNode.get(this)||this.topNode;var r=new TreeCursor(n);if(e!=null){r.moveTo(e,t);CachedNode.set(this,r._tree)}return r};e.prototype.fullCursor=function(){return new TreeCursor(this.topNode,true)};Object.defineProperty(e.prototype,"topNode",{get:function(){return new TreeNode(this,0,0,null)},enumerable:false,configurable:true});e.prototype.resolve=function(e,t){if(t===void 0){t=0}return this.cursor(e,t).node};e.prototype.iterate=function(e){var t=e.enter,n=e.leave,r=e.from,i=r===void 0?0:r,o=e.to,a=o===void 0?this.length:o;for(var s=this.cursor();;){var c=false;if(s.from<=a&&s.to>=i&&(s.type.isAnonymous||t(s.type,s.from,s.to)!==false)){if(s.firstChild())continue;if(!s.type.isAnonymous)c=true}for(;;){if(c&&n)n(s.type,s.from,s.to);c=s.type.isAnonymous;if(s.nextSibling())break;if(!s.parent())return;c=true}}};e.prototype.balance=function(e){if(e===void 0){e=DefaultBufferLength}return this.children.length<=BalanceBranchFactor?this:balanceRange(this.type,NodeType.none,this.children,this.positions,0,this.children.length,0,e,this.length,0)};e.build=function(e){return buildTree(e)};return e}();Tree.empty=new Tree(NodeType.none,[],[],0);function withHash(e,t){if(t)e.contextHash=t;return e}var TreeBuffer=function(){function e(e,t,n,r){if(r===void 0){r=NodeType.none}this.buffer=e;this.length=t;this.set=n;this.type=r}e.prototype.toString=function(){var e=[];for(var t=0;t<this.buffer.length;){e.push(this.childString(t));t=this.buffer[t+3]}return e.join(",")};e.prototype.childString=function(e){var t=this.buffer[e],n=this.buffer[e+3];var r=this.set.types[t],i=r.name;if(/\W/.test(i)&&!r.isError)i=JSON.stringify(i);e+=4;if(n==e)return i;var o=[];while(e<n){o.push(this.childString(e));e=this.buffer[e+3]}return i+"("+o.join(",")+")"};e.prototype.findChild=function(e,t,n,r){var i=this.buffer,o=-1;for(var a=e;a!=t;a=i[a+3]){if(r!=-1e8){var s=i[a+1],c=i[a+2];if(n>0){if(c>r)o=a;if(c>r)break}else{if(s<r)o=a;if(c>=r)break}}else{o=a;if(n>0)break}}return o};return e}();var TreeNode=function(){function e(e,t,n,r){this.node=e;this.from=t;this.index=n;this._parent=r}Object.defineProperty(e.prototype,"type",{get:function(){return this.node.type},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"name",{get:function(){return this.node.type.name},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"to",{get:function(){return this.from+this.node.length},enumerable:false,configurable:true});e.prototype.nextChild=function(t,n,r,i){if(i===void 0){i=false}for(var o=this;;){for(var a=o.node,s=a.children,c=a.positions,u=n>0?s.length:-1;t!=u;t+=n){var l=s[t],f=c[t]+o.from;if(r!=-1e8&&(n<0?f>=r:f+l.length<=r))continue;if(l instanceof TreeBuffer){var h=l.findChild(0,l.buffer.length,n,r==-1e8?-1e8:r-f);if(h>-1)return new BufferNode(new BufferContext(o,l,t,f),null,h)}else if(i||(!l.type.isAnonymous||hasChild(l))){var d=new e(l,f,t,o);return i||!d.type.isAnonymous?d:d.nextChild(n<0?l.children.length-1:0,n,r)}}if(i||!o.type.isAnonymous)return null;t=o.index+n;o=o._parent;if(!o)return null}};Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.nextChild(0,1,-1e8)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.nextChild(this.node.children.length-1,-1,-1e8)},enumerable:false,configurable:true});e.prototype.childAfter=function(e){return this.nextChild(0,1,e)};e.prototype.childBefore=function(e){return this.nextChild(this.node.children.length-1,-1,e)};e.prototype.nextSignificantParent=function(){var e=this;while(e.type.isAnonymous&&e._parent)e=e._parent;return e};Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent?this._parent.nextSignificantParent():null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this._parent?this._parent.nextChild(this.index+1,1,-1):null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"prevSibling",{get:function(){return this._parent?this._parent.nextChild(this.index-1,-1,-1):null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"cursor",{get:function(){return new TreeCursor(this)},enumerable:false,configurable:true});e.prototype.resolve=function(e,t){if(t===void 0){t=0}return this.cursor.moveTo(e,t).node};e.prototype.getChild=function(e,t,n){if(t===void 0){t=null}if(n===void 0){n=null}var r=getChildren(this,e,t,n);return r.length?r[0]:null};e.prototype.getChildren=function(e,t,n){if(t===void 0){t=null}if(n===void 0){n=null}return getChildren(this,e,t,n)};e.prototype.toString=function(){return this.node.toString()};return e}();function getChildren(e,t,n,r){var i=e.cursor,o=[];if(!i.firstChild())return o;if(n!=null)while(!i.type.is(n))if(!i.nextSibling())return o;for(;;){if(r!=null&&i.type.is(r))return o;if(i.type.is(t))o.push(i.node);if(!i.nextSibling())return r==null?o:[]}}var BufferContext=function(){function e(e,t,n,r){this.parent=e;this.buffer=t;this.index=n;this.start=r}return e}();var BufferNode=function(){function e(e,t,n){this.context=e;this._parent=t;this.index=n;this.type=e.buffer.set.types[e.buffer.buffer[n]]}Object.defineProperty(e.prototype,"name",{get:function(){return this.type.name},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"from",{get:function(){return this.context.start+this.context.buffer.buffer[this.index+1]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"to",{get:function(){return this.context.start+this.context.buffer.buffer[this.index+2]},enumerable:false,configurable:true});e.prototype.child=function(t,n){var r=this.context.buffer;var i=r.findChild(this.index+4,r.buffer[this.index+3],t,n==-1e8?-1e8:n-this.context.start);return i<0?null:new e(this.context,this,i)};Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.child(1,-1e8)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.child(-1,-1e8)},enumerable:false,configurable:true});e.prototype.childAfter=function(e){return this.child(1,e)};e.prototype.childBefore=function(e){return this.child(-1,e)};Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent||this.context.parent.nextSignificantParent()},enumerable:false,configurable:true});e.prototype.externalSibling=function(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,-1)};Object.defineProperty(e.prototype,"nextSibling",{get:function(){var t=this.context.buffer;var n=t.buffer[this.index+3];if(n<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length))return new e(this.context,this._parent,n);return this.externalSibling(1)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"prevSibling",{get:function(){var t=this.context.buffer;var n=this._parent?this._parent.index+4:0;if(this.index==n)return this.externalSibling(-1);return new e(this.context,this._parent,t.findChild(n,this.index,-1,-1e8))},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"cursor",{get:function(){return new TreeCursor(this)},enumerable:false,configurable:true});e.prototype.resolve=function(e,t){if(t===void 0){t=0}return this.cursor.moveTo(e,t).node};e.prototype.toString=function(){return this.context.buffer.childString(this.index)};e.prototype.getChild=function(e,t,n){if(t===void 0){t=null}if(n===void 0){n=null}var r=getChildren(this,e,t,n);return r.length?r[0]:null};e.prototype.getChildren=function(e,t,n){if(t===void 0){t=null}if(n===void 0){n=null}return getChildren(this,e,t,n)};return e}();var TreeCursor=function(){function e(e,t){if(t===void 0){t=false}this.full=t;this.buffer=null;this.stack=[];this.index=0;this.bufferNode=null;if(e instanceof TreeNode){this.yieldNode(e)}else{this._tree=e.context.parent;this.buffer=e.context;for(var n=e._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=e;this.yieldBuf(e.index)}}Object.defineProperty(e.prototype,"name",{get:function(){return this.type.name},enumerable:false,configurable:true});e.prototype.yieldNode=function(e){if(!e)return false;this._tree=e;this.type=e.type;this.from=e.from;this.to=e.to;return true};e.prototype.yieldBuf=function(e,t){this.index=e;var n=this.buffer,r=n.start,i=n.buffer;this.type=t||i.set.types[i.buffer[e]];this.from=r+i.buffer[e+1];this.to=r+i.buffer[e+2];return true};e.prototype.yield=function(e){if(!e)return false;if(e instanceof TreeNode){this.buffer=null;return this.yieldNode(e)}this.buffer=e.context;return this.yieldBuf(e.index,e.type)};e.prototype.toString=function(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()};e.prototype.enter=function(e,t){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree.node.children.length-1:0,e,t,this.full));var n=this.buffer.buffer;var r=n.findChild(this.index+4,n.buffer[this.index+3],e,t==-1e8?-1e8:t-this.buffer.start);if(r<0)return false;this.stack.push(this.index);return this.yieldBuf(r)};e.prototype.firstChild=function(){return this.enter(1,-1e8)};e.prototype.lastChild=function(){return this.enter(-1,-1e8)};e.prototype.childAfter=function(e){return this.enter(1,e)};e.prototype.childBefore=function(e){return this.enter(-1,e)};e.prototype.parent=function(){if(!this.buffer)return this.yieldNode(this.full?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());var e=this.full?this.buffer.parent:this.buffer.parent.nextSignificantParent();this.buffer=null;return this.yieldNode(e)};e.prototype.sibling=function(e){if(!this.buffer)return!this._tree._parent?false:this.yield(this._tree._parent.nextChild(this._tree.index+e,e,-1e8,this.full));var t=this.buffer.buffer,n=this.stack.length-1;if(e<0){var r=n<0?0:this.stack[n]+4;if(this.index!=r)return this.yieldBuf(t.findChild(r,this.index,-1,-1e8))}else{var i=t.buffer[this.index+3];if(i<(n<0?t.buffer.length:t.buffer[this.stack[n]+3]))return this.yieldBuf(i)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,-1e8,this.full)):false};e.prototype.nextSibling=function(){return this.sibling(1)};e.prototype.prevSibling=function(){return this.sibling(-1)};e.prototype.atLastNode=function(e){var t,n;var r,i,o=this.buffer;if(o){if(e>0){if(this.index<o.buffer.buffer.length)return false}else{for(var a=0;a<this.index;a++)if(o.buffer.buffer[a+3]<this.index)return false}r=o.index,i=o.parent}else{t=this._tree,r=t.index,i=t._parent}for(;i;n=i,r=n.index,i=n._parent){for(var s=r+e,c=e<0?-1:i.node.children.length;s!=c;s+=e){var u=i.node.children[s];if(this.full||!u.type.isAnonymous||u instanceof TreeBuffer||hasChild(u))return false}}return true};e.prototype.move=function(e){if(this.enter(e,-1e8))return true;for(;;){if(this.sibling(e))return true;if(this.atLastNode(e)||!this.parent())return false}};e.prototype.next=function(){return this.move(1)};e.prototype.prev=function(){return this.move(-1)};e.prototype.moveTo=function(e,t){if(t===void 0){t=0}while(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))if(!this.parent())break;for(;;){if(t<0?!this.childBefore(e):!this.childAfter(e))break;if(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e)){this.parent();break}}return this};Object.defineProperty(e.prototype,"node",{get:function(){if(!this.buffer)return this._tree;var e=this.bufferNode,t=null,n=0;if(e&&e.context==this.buffer){e:for(var r=this.index,i=this.stack.length;i>=0;){for(var o=e;o;o=o._parent)if(o.index==r){if(r==this.index)return o;t=o;n=i+1;break e}r=this.stack[--i]}}for(var a=n;a<this.stack.length;a++)t=new BufferNode(this.buffer,t,this.stack[a]);return this.bufferNode=new BufferNode(this.buffer,t,this.index)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"tree",{get:function(){return this.buffer?null:this._tree.node},enumerable:false,configurable:true});return e}();function hasChild(e){return e.children.some((function(e){return!e.type.isAnonymous||e instanceof TreeBuffer||hasChild(e)}))}var FlatBufferCursor=function(){function e(e,t){this.buffer=e;this.index=t}Object.defineProperty(e.prototype,"id",{get:function(){return this.buffer[this.index-4]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"start",{get:function(){return this.buffer[this.index-3]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"end",{get:function(){return this.buffer[this.index-2]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"size",{get:function(){return this.buffer[this.index-1]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"pos",{get:function(){return this.index},enumerable:false,configurable:true});e.prototype.next=function(){this.index-=4};e.prototype.fork=function(){return new e(this.buffer,this.index)};return e}();var BalanceBranchFactor=8;function buildTree(e){var t;var n=e.buffer,r=e.nodeSet,i=e.topID,o=i===void 0?0:i,a=e.maxBufferLength,s=a===void 0?DefaultBufferLength:a,c=e.reused,u=c===void 0?[]:c,l=e.minRepeatType,f=l===void 0?r.types.length:l;var h=Array.isArray(n)?new FlatBufferCursor(n,n.length):n;var d=r.types;var p=0;function v(e,t,n,i,o){var a=h.id,c=h.start,l=h.end,y=h.size;var b=c-e;if(y<0){if(y==-1){n.push(u[a]);i.push(b)}else{p=a}h.next();return}var w=d[a],x,S;if(l-c<=s&&(S=m(h.pos-t,o))){var k=new Uint16Array(S.size-S.skip);var C=h.pos-S.size,A=k.length;while(h.pos>C)A=g(S.start,k,A,o);x=new TreeBuffer(k,l-S.start,r,o<0?NodeType.none:d[o]);b=S.start-e}else{var C=h.pos-y;h.next();var M=[],I=[];var E=a>=f?a:-1;while(h.pos>C){if(h.id==E)h.next();else v(c,C,M,I,E)}M.reverse();I.reverse();if(E>-1&&M.length>BalanceBranchFactor)x=balanceRange(w,w,M,I,0,M.length,0,s,l-c,p);else x=withHash(new Tree(w,M,I,l-c),p)}n.push(x);i.push(b)}function m(e,t){var n=h.fork();var r=0,i=0,o=0,a=n.end-s;var c={size:0,start:0,skip:0};e:for(var u=n.pos-e;n.pos>u;){if(n.id==t){c.size=r;c.start=i;c.skip=o;o+=4;r+=4;n.next();continue}var l=n.size,d=n.pos-l;if(l<0||d<u||n.start<a)break;var p=n.id>=f?4:0;var v=n.start;n.next();while(n.pos>d){if(n.size<0)break e;if(n.id>=f)p+=4;n.next()}i=v;r+=l;o+=p}if(t<0||r==e){c.size=r;c.start=i;c.skip=o}return c.size>4?c:undefined}function g(e,t,n,r){var i=h.id,o=h.start,a=h.end,s=h.size;h.next();if(i==r)return n;var c=n;if(s>4){var u=h.pos-(s-4);while(h.pos>u)n=g(e,t,n,r)}if(i<f){t[--n]=c;t[--n]=a-e;t[--n]=o-e;t[--n]=i}return n}var y=[],b=[];while(h.pos>0)v(e.start||0,0,y,b,-1);var w=(t=e.length)!==null&&t!==void 0?t:y.length?b[0]+y[0].length:0;return new Tree(d[o],y.reverse(),b.reverse(),w)}function balanceRange(e,t,n,r,i,o,a,s,c,u){var l=[],f=[];if(c<=s){for(var h=i;h<o;h++){l.push(n[h]);f.push(r[h]-a)}}else{var d=Math.max(s,Math.ceil(c*1.5/BalanceBranchFactor));for(var p=i;p<o;){var v=p,m=r[p];p++;for(;p<o;p++){var g=r[p]+n[p].length;if(g-m>d)break}if(p==v+1){var y=n[v];if(y instanceof Tree&&y.type==t&&y.length>d<<1){for(var b=0;b<y.children.length;b++){l.push(y.children[b]);f.push(y.positions[b]+m-a)}continue}l.push(y)}else if(p==v+1){l.push(n[v])}else{var w=balanceRange(t,t,n,r,v,p,m,s,r[p-1]+n[p-1].length-m,u);if(t!=NodeType.none&&!containsType(w.children,t))w=withHash(new Tree(NodeType.none,w.children,w.positions,w.length),u);l.push(w)}f.push(m-a)}}return withHash(new Tree(e,l,f,c),u)}function containsType(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i.type==t)return true}return false}var TreeFragment=function(){function e(e,t,n,r,i){this.from=e;this.to=t;this.tree=n;this.offset=r;this.open=i}Object.defineProperty(e.prototype,"openStart",{get:function(){return(this.open&1)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"openEnd",{get:function(){return(this.open&2)>0},enumerable:false,configurable:true});e.applyChanges=function(t,n,r){if(r===void 0){r=128}if(!n.length)return t;var i=[];var o=1,a=t.length?t[0]:null;var s=0,c=0,u=0;for(;;){var l=s<n.length?n[s++]:null;var f=l?l.fromA:1e9;if(f-c>=r)while(a&&a.from<f){var h=a;if(c>=h.from||f<=h.to||u){var d=Math.max(h.from,c)-u,p=Math.min(h.to,f)-u;h=d>=p?null:new e(d,p,h.tree,h.offset+u,(s>0?1:0)|(l?2:0))}if(h)i.push(h);if(a.to>f)break;a=o<t.length?t[o++]:null}if(!l)break;c=l.toA;u=l.toA-l.toB}return i};e.addTree=function(t,n,r){if(n===void 0){n=[]}if(r===void 0){r=false}var i=[new e(0,t.length,t,0,r?2:0)];for(var o=0,a=n;o<a.length;o++){var s=a[o];if(s.to>t.length)i.push(s)}return i};return e}();function stringInput(e){return new StringInput(e)}var StringInput=function(){function e(e,t){if(t===void 0){t=e.length}this.string=e;this.length=t}e.prototype.get=function(e){return e<0||e>=this.length?-1:this.string.charCodeAt(e)};e.prototype.lineAfter=function(e){if(e<0)return"";var t=this.string.indexOf("\n",e);return this.string.slice(e,t<0?this.length:Math.min(t,this.length))};e.prototype.read=function(e,t){return this.string.slice(e,Math.min(this.length,t))};e.prototype.clip=function(t){return new e(this.string,t)};return e}();var languageDataProp=new NodeProp;function defineLanguageFacet(e){return Facet.define({combine:e?function(t){return t.concat(e)}:undefined})}var Language=function(){function e(e,t,n,r){if(r===void 0){r=[]}this.data=e;this.topNode=n;if(!EditorState.prototype.hasOwnProperty("tree"))Object.defineProperty(EditorState.prototype,"tree",{get:function(){return syntaxTree(this)}});this.parser=t;this.extension=[language.of(this),EditorState.languageData.of((function(e,t){return e.facet(languageDataFacetAt(e,t))}))].concat(r)}e.prototype.isActiveAt=function(e,t){return languageDataFacetAt(e,t)==this.data};e.prototype.findRegions=function(e){var t=this;var n=e.facet(language);if((n===null||n===void 0?void 0:n.data)==this.data)return[{from:0,to:e.doc.length}];if(!n||!n.allowsNesting)return[];var r=[];syntaxTree(e).iterate({enter:function(e,n,i){if(e.isTop&&e.prop(languageDataProp)==t.data){r.push({from:n,to:i});return false}return undefined}});return r};Object.defineProperty(e.prototype,"allowsNesting",{get:function(){return true},enumerable:false,configurable:true});e.prototype.parseString=function(e){var t=Text.of(e.split("\n"));var n=this.parser.startParse(new DocInput(t),0,new EditorParseContext(this.parser,EditorState.create({doc:t}),[],Tree.empty,{from:0,to:e.length},[],null));var r;while(!(r=n.advance())){}return r};return e}();Language.setState=StateEffect.define();function languageDataFacetAt(e,t){var n=e.facet(language);if(!n)return null;if(!n.allowsNesting)return n.data;var r=syntaxTree(e);var i=r.resolve(t,-1);while(i){var o=i.type.prop(languageDataProp);if(o)return o;i=i.parent}return n.data}var LezerLanguage=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t,n,n.topNode)||this;r.parser=n;return r}t.define=function(e){var n=defineLanguageFacet(e.languageData);return new t(n,e.parser.configure({props:[languageDataProp.add((function(e){return e.isTop?n:undefined}))]}))};t.prototype.configure=function(e){return new t(this.data,this.parser.configure(e))};Object.defineProperty(t.prototype,"allowsNesting",{get:function(){return this.parser.hasNested},enumerable:false,configurable:true});return t}(Language);function syntaxTree(e){var t=e.field(Language.state,false);return t?t.tree:Tree.empty}var DocInput=function(){function e(e,t){if(t===void 0){t=e.length}this.doc=e;this.length=t;this.cursorPos=0;this.string="";this.prevString="";this.cursor=e.iter()}e.prototype.syncTo=function(e){if(e<this.cursorPos){this.cursor=this.doc.iter();this.cursorPos=0}this.prevString=e==this.cursorPos?this.string:"";this.string=this.cursor.next(e-this.cursorPos).value;this.cursorPos=e+this.string.length;return this.cursorPos-this.string.length};e.prototype.get=function(e){if(e>=this.length)return-1;var t=this.cursorPos-this.string.length;if(e<t||e>=this.cursorPos){if(e<t&&e>=t-this.prevString.length)return this.prevString.charCodeAt(e-(t-this.prevString.length));t=this.syncTo(e)}return this.string.charCodeAt(e-t)};e.prototype.lineAfter=function(e){if(e>=this.length||e<0)return"";var t=this.cursorPos-this.string.length;if(e<t||e>=this.cursorPos)t=this.syncTo(e);return this.cursor.lineBreak?"":this.string.slice(e-t,Math.min(this.length-t,this.string.length))};e.prototype.read=function(e,t){var n=this.cursorPos-this.string.length;if(e<n||t>=this.cursorPos)return this.doc.sliceString(e,t);else return this.string.slice(e-n,t-n)};e.prototype.clip=function(t){return new e(this.doc,t)};return e}();var EditorParseContext=function(){function e(e,t,n,r,i,o,a){if(n===void 0){n=[]}this.parser=e;this.state=t;this.fragments=n;this.tree=r;this.viewport=i;this.skipped=o;this.scheduleOn=a;this.parse=null;this.tempSkipped=[]}e.prototype.work=function(e,t){if(this.tree!=Tree.empty&&(t==null?this.tree.length==this.state.doc.length:this.tree.length>=t)){this.takeTree();return true}if(!this.parse)this.parse=this.parser.startParse(new DocInput(this.state.doc),0,this);var n=Date.now()+e;for(;;){var r=this.parse.advance();if(r){this.fragments=this.withoutTempSkipped(TreeFragment.addTree(r));this.parse=null;this.tree=r;return true}else if(t!=null&&this.parse.pos>=t){this.takeTree();return true}if(Date.now()>n)return false}};e.prototype.takeTree=function(){if(this.parse&&this.parse.pos>this.tree.length){this.tree=this.parse.forceFinish();this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,true))}};e.prototype.withoutTempSkipped=function(e){for(var t=void 0;t=this.tempSkipped.pop();)e=cutFragments(e,t.from,t.to);return e};e.prototype.changes=function(t,n){var r=this,i=r.fragments,o=r.tree,a=r.viewport,s=r.skipped;this.takeTree();if(!t.empty){var c=[];t.iterChangedRanges((function(e,t,n,r){return c.push({fromA:e,toA:t,fromB:n,toB:r})}));i=TreeFragment.applyChanges(i,c);o=Tree.empty;a={from:t.mapPos(a.from,-1),to:t.mapPos(a.to,1)};if(this.skipped.length){s=[];for(var u=0,l=this.skipped;u<l.length;u++){var f=l[u];var h=t.mapPos(f.from,1),d=t.mapPos(f.to,-1);if(h<d)s.push({from:h,to:d})}}}return new e(this.parser,n,i,o,a,s,this.scheduleOn)};e.prototype.updateViewport=function(e){this.viewport=e;var t=this.skipped.length;for(var n=0;n<this.skipped.length;n++){var r=this.skipped[n],i=r.from,o=r.to;if(i<e.to&&o>e.from){this.fragments=cutFragments(this.fragments,i,o);this.skipped.splice(n--,1)}}return this.skipped.length<t};e.prototype.reset=function(){if(this.parse){this.takeTree();this.parse=null}};e.prototype.skipUntilInView=function(e,t){this.skipped.push({from:e,to:t})};e.getSkippingParser=function(e){return{startParse:function(t,n,r){return{pos:n,advance:function(){var i=r;i.tempSkipped.push({from:n,to:t.length});if(e)i.scheduleOn=i.scheduleOn?Promise.all([i.scheduleOn,e]):e;this.pos=t.length;return new Tree(NodeType.none,[],[],t.length-n)},forceFinish:function(){return this.advance()}}}}};e.prototype.movedPast=function(e){return this.tree.length<e&&this.parse&&this.parse.pos>=e};return e}();EditorParseContext.skippingParser=EditorParseContext.getSkippingParser();function cutFragments(e,t,n){return TreeFragment.applyChanges(e,[{fromA:t,toA:n,fromB:t,toB:n}])}var LanguageState=function(){function e(e){this.context=e;this.tree=e.tree}e.prototype.apply=function(t){if(!t.docChanged)return this;var n=this.context.changes(t.changes,t.state);var r=this.context.tree.length==t.startState.doc.length?undefined:Math.max(t.changes.mapPos(this.context.tree.length),n.viewport.to);if(!n.work(25,r))n.takeTree();return new e(n)};e.init=function(t){var n=new EditorParseContext(t.facet(language).parser,t,[],Tree.empty,{from:0,to:t.doc.length},[],null);if(!n.work(25))n.takeTree();return new e(n)};return e}();Language.state=StateField.define({create:LanguageState.init,update:function(e,t){for(var n=0,r=t.effects;n<r.length;n++){var i=r[n];if(i.is(Language.setState))return i.value}if(t.startState.facet(language)!=t.state.facet(language))return LanguageState.init(t.state);return e.apply(t)}});var requestIdle=typeof window!="undefined"&&window.requestIdleCallback||function(e,t){var n=t.timeout;return setTimeout(e,n)};var cancelIdle=typeof window!="undefined"&&window.cancelIdleCallback||clearTimeout;var parseWorker=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.working=-1;this.chunkEnd=-1;this.chunkBudget=-1;this.work=this.work.bind(this);this.scheduleWork()}e.prototype.update=function(e){var t=this.view.state.field(Language.state).context;if(e.viewportChanged){if(t.updateViewport(e.view.viewport))t.reset();if(this.view.viewport.to>t.tree.length)this.scheduleWork()}if(e.docChanged){if(this.view.hasFocus)this.chunkBudget+=50;this.scheduleWork()}this.checkAsyncSchedule(t)};e.prototype.scheduleWork=function(){if(this.working>-1)return;var e=this.view.state,t=e.field(Language.state),n=t.context.fragments;if(t.tree.length>=e.doc.length&&n.length&&n[0].from==0&&n[0].to>=e.doc.length)return;this.working=requestIdle(this.work,{timeout:500})};e.prototype.work=function(e){this.working=-1;var t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)){this.chunkEnd=t+3e4;this.chunkBudget=3e3}if(this.chunkBudget<=0)return;var n=this.view,r=n.state,i=n.viewport.to,o=r.field(Language.state);if(o.tree.length>=i+1e6)return;var a=Math.min(this.chunkBudget,e?Math.max(25,e.timeRemaining()):100);var s=o.context.work(a,i+1e6);this.chunkBudget-=Date.now()-t;if(s||this.chunkBudget<=0||o.context.movedPast(i)){o.context.takeTree();this.view.dispatch({effects:Language.setState.of(new LanguageState(o.context))})}if(!s&&this.chunkBudget>0)this.scheduleWork();this.checkAsyncSchedule(o.context)};e.prototype.checkAsyncSchedule=function(e){var t=this;if(e.scheduleOn){e.scheduleOn.then((function(){return t.scheduleWork()}));e.scheduleOn=null}};e.prototype.destroy=function(){if(this.working>=0)cancelIdle(this.working)};return e}(),{eventHandlers:{focus:function(){this.scheduleWork()}}});var language=Facet.define({combine:function(e){return e.length?e[0]:null},enables:[Language.state,parseWorker]});var LanguageSupport=function(){function e(e,t){if(t===void 0){t=[]}this.language=e;this.support=t;this.extension=[e,t]}return e}();var LanguageDescription=function(){function e(e,t,n,r,i){this.name=e;this.alias=t;this.extensions=n;this.filename=r;this.loadFunc=i;this.support=undefined;this.loading=null}e.prototype.load=function(){var e=this;return this.loading||(this.loading=this.loadFunc().then((function(t){return e.support=t}),(function(t){e.loading=null;throw t})))};e.of=function(t){return new e(t.name,(t.alias||[]).concat(t.name).map((function(e){return e.toLowerCase()})),t.extensions||[],t.filename,t.load)};e.matchFilename=function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i.filename&&i.filename.test(t))return i}var o=/\.([^.]+)$/.exec(t);if(o)for(var a=0,s=e;a<s.length;a++){var i=s[a];if(i.extensions.indexOf(o[1])>-1)return i}return null};e.matchLanguageName=function(e,t,n){if(n===void 0){n=true}t=t.toLowerCase();for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.alias.some((function(e){return e==t})))return o}if(n)for(var a=0,s=e;a<s.length;a++){var o=s[a];for(var c=0,u=o.alias;c<u.length;c++){var l=u[c];var f=t.indexOf(l);if(f>-1&&(l.length>2||!/\w/.test(t[f-1])&&!/\w/.test(t[f+l.length])))return o}}return null};return e}();var indentService=Facet.define();var indentUnit=Facet.define({combine:function(e){if(!e.length)return"  ";if(!/^(?: +|\t+)$/.test(e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return e[0]}});function getIndentUnit(e){var t=e.facet(indentUnit);return t.charCodeAt(0)==9?e.tabSize*t.length:t.length}function indentString(e,t){var n="",r=e.tabSize;if(e.facet(indentUnit).charCodeAt(0)==9)while(t>=r){n+="\t";t-=r}for(var i=0;i<t;i++)n+=" ";return n}function getIndentation(e,t){if(e instanceof EditorState)e=new IndentContext(e);for(var n=0,r=e.state.facet(indentService);n<r.length;n++){var i=r[n];var o=i(e,t);if(o!=null)return o}var a=syntaxTree(e.state);return a?syntaxIndentation(e,a,t):null}var IndentContext=function(){function e(e,t){if(t===void 0){t={}}this.state=e;this.options=t;this.unit=getIndentUnit(e)}e.prototype.textAfterPos=function(e){var t,n;var r=(t=this.options)===null||t===void 0?void 0:t.simulateBreak;if(e==r&&((n=this.options)===null||n===void 0?void 0:n.simulateDoubleBreak))return"";return this.state.sliceDoc(e,Math.min(e+100,r!=null&&r>e?r:1e9,this.state.doc.lineAt(e).to))};e.prototype.column=function(e){var t;var n=this.state.doc.lineAt(e),r=n.text.slice(0,e-n.from);var i=this.countColumn(r,e-n.from);var o=((t=this.options)===null||t===void 0?void 0:t.overrideIndentation)?this.options.overrideIndentation(n.from):-1;if(o>-1)i+=o-this.countColumn(r,r.search(/\S/));return i};e.prototype.countColumn=function(e,t){return countColumn(t<0?e:e.slice(0,t),0,this.state.tabSize)};e.prototype.lineIndent=function(e){var t;var n=(t=this.options)===null||t===void 0?void 0:t.overrideIndentation;if(n){var r=n(e.from);if(r>-1)return r}return this.countColumn(e.text,e.text.search(/\S/))};return e}();var indentNodeProp=new NodeProp;function syntaxIndentation(e,t,n){var r=t.resolve(n);for(var i=r,o=n;;){var a=i.childBefore(o);if(!a)break;if(a.type.isError&&a.from==a.to){r=i;o=a.from}else{i=a;o=i.to+1}}return indentFrom(r,n,e)}function ignoreClosed(e){var t,n;return e.pos==((t=e.options)===null||t===void 0?void 0:t.simulateBreak)&&((n=e.options)===null||n===void 0?void 0:n.simulateDoubleBreak)}function indentStrategy(e){var t=e.type.prop(indentNodeProp);if(t)return t;var n=e.firstChild,r;if(n&&(r=n.type.prop(NodeProp.closedBy))){var i=e.lastChild,o=i&&r.indexOf(i.name)>-1;return function(e){return delimitedStrategy(e,true,1,undefined,o&&!ignoreClosed(e)?i.from:undefined)}}return e.parent==null?topIndent:null}function indentFrom(e,t,n){for(;e;e=e.parent){var r=indentStrategy(e);if(r)return r(new TreeIndentContext(n,t,e))}return null}function topIndent(){return 0}var TreeIndentContext=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this,t.state,t.options)||this;i.base=t;i.pos=n;i.node=r;return i}Object.defineProperty(t.prototype,"textAfter",{get:function(){return this.textAfterPos(this.pos)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"baseIndent",{get:function(){var e=this.state.doc.lineAt(this.node.from);for(;;){var t=this.node.resolve(e.from);while(t.parent&&t.parent.from==t.from)t=t.parent;if(isParent(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e)},enumerable:false,configurable:true});t.prototype.continue=function(){var e=this.node.parent;return e?indentFrom(e,this.pos,this.base):0};return t}(IndentContext);function isParent(e,t){for(var n=t;n;n=n.parent)if(e==n)return true;return false}function bracketedAligned(e){var t;var n=e.node;var r=n.childAfter(n.from),i=n.lastChild;if(!r)return null;var o=(t=e.options)===null||t===void 0?void 0:t.simulateBreak;var a=e.state.doc.lineAt(r.from);var s=o==null||o<=a.from?a.to:Math.min(a.to,o);for(var c=r.to;;){var u=n.childAfter(c);if(!u||u==i)return null;if(!u.type.isSkipped)return u.from<s?r:null;c=u.to}}function delimitedIndent(e){var t=e.closing,n=e.align,r=n===void 0?true:n,i=e.units,o=i===void 0?1:i;return function(e){return delimitedStrategy(e,r,o,t)}}function delimitedStrategy(e,t,n,r,i){var o=e.textAfter,a=o.match(/^\s*/)[0].length;var s=r&&o.slice(a,a+r.length)==r||i==e.pos+a;var c=t?bracketedAligned(e):null;if(c)return s?e.column(c.from):e.column(c.to);return e.baseIndent+(s?0:e.unit*n)}var flatIndent=function(e){return e.baseIndent};function continuedIndent(e){var t=e===void 0?{}:e,n=t.except,r=t.units,i=r===void 0?1:r;return function(e){var t=n&&n.test(e.textAfter);return e.baseIndent+(t?0:i*e.unit)}}var foldService=Facet.define();var foldNodeProp=new NodeProp;function foldInside$1(e){var t=e.firstChild,n=e.lastChild;return t&&t.to<n.from?{from:t.to,to:n.type.isError?e.to:n.from}:null}function syntaxFolding(e,t,n){var r=syntaxTree(e);if(r.length==0)return null;var i=r.resolve(n);var o=null;for(var a=i;a;a=a.parent){if(a.to<=n||a.from>n)continue;if(o&&a.from<t)break;var s=a.type.prop(foldNodeProp);if(s){var c=s(a,e);if(c&&c.from<=n&&c.from>=t&&c.to>n)o=c}}return o}function foldable(e,t,n){for(var r=0,i=e.facet(foldService);r<i.length;r++){var o=i[r];var a=o(e,t,n);if(a)return a}return syntaxFolding(e,t,n)}var CompletionContext=function(){function e(e,t,n){this.state=e;this.pos=t;this.explicit=n;this.abortListeners=[]}e.prototype.tokenBefore=function(e){var t=syntaxTree(this.state).resolve(this.pos,-1);while(t&&e.indexOf(t.name)<0)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null};e.prototype.matchBefore=function(e){var t=this.state.doc.lineAt(this.pos);var n=Math.max(t.from,this.pos-250);var r=t.text.slice(n-t.from,this.pos-t.from);var i=r.search(ensureAnchor(e,false));return i<0?null:{from:n+i,to:this.pos,text:r.slice(i)}};Object.defineProperty(e.prototype,"aborted",{get:function(){return this.abortListeners==null},enumerable:false,configurable:true});e.prototype.addEventListener=function(e,t){if(e=="abort"&&this.abortListeners)this.abortListeners.push(t)};return e}();function toSet(e){var t=Object.keys(e).join("");var n=/\w/.test(t);if(n)t=t.replace(/\w/g,"");return"["+(n?"\\w":"")+t.replace(/[^\w\s]/g,"\\$&")+"]"}function prefixMatch(e){var t=Object.create(null),n=Object.create(null);for(var r=0,i=e;r<i.length;r++){var o=i[r].label;t[o[0]]=true;for(var a=1;a<o.length;a++)n[o[a]]=true}var s=toSet(t)+toSet(n)+"*$";return[new RegExp("^"+s),new RegExp(s)]}function completeFromList(e){var t=e.map((function(e){return typeof e=="string"?{label:e}:e}));var n=t.every((function(e){return/^\w+$/.test(e.label)}))?[/\w*$/,/\w+$/]:prefixMatch(t),r=n[0],i=n[1];return function(e){var n=e.matchBefore(i);return n||e.explicit?{from:n?n.from:e.pos,options:t,span:r}:null}}function ifNotIn(e,t){return function(n){for(var r=syntaxTree(n.state).resolve(n.pos,-1);r;r=r.parent)if(e.indexOf(r.name)>-1)return null;return t(n)}}var Option=function(){function e(e,t,n){this.completion=e;this.source=t;this.match=n}return e}();function cur(e){return e.selection.main.head}function ensureAnchor(e,t){var n;var r=e.source;var i=t&&r[0]!="^",o=r[r.length-1]!="$";if(!i&&!o)return e;return new RegExp((i?"^":"")+"(?:"+r+")"+(o?"$":""),(n=e.flags)!==null&&n!==void 0?n:e.ignoreCase?"i":"")}function applyCompletion(e,t){var n=t.completion.apply||t.completion.label;var r=t.source;if(typeof n=="string"){e.dispatch({changes:{from:r.from,to:r.to,insert:n},selection:{anchor:r.from+n.length}})}else{n(e,t.completion,r.from,r.to)}}var SourceCache=new WeakMap;function asSource(e){if(!Array.isArray(e))return e;var t=SourceCache.get(e);if(!t)SourceCache.set(e,t=completeFromList(e));return t}var FuzzyMatcher=function(){function e(e){this.pattern=e;this.chars=[];this.folded=[];this.any=[];this.precise=[];this.byWord=[];for(var t=0;t<e.length;){var n=codePointAt(e,t),r=codePointSize(n);this.chars.push(n);var i=e.slice(t,t+r),o=i.toUpperCase();this.folded.push(codePointAt(o==i?i.toLowerCase():o,0));t+=r}this.astral=e.length!=this.chars.length}e.prototype.match=function(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;var t=this,n=t.chars,r=t.folded,i=t.any,o=t.precise,a=t.byWord;if(n.length==1){var s=codePointAt(e,0);return s==n[0]?[0,0,codePointSize(s)]:s==r[0]?[-200,0,codePointSize(s)]:null}var c=e.indexOf(this.pattern);if(c==0)return[0,0,this.pattern.length];var u=n.length,l=0;if(c<0){for(var f=0,h=Math.min(e.length,200);f<h&&l<u;){var d=codePointAt(e,f);if(d==n[l]||d==r[l])i[l++]=f;f+=codePointSize(d)}if(l<u)return null}var p=0;var v=0,m=false;var g=0,y=-1,b=-1;var w=/[a-z]/.test(e);for(var x=0,h=Math.min(e.length,200),S=0;x<h&&v<u;){var d=codePointAt(e,x);if(c<0){if(p<u&&d==n[p])o[p++]=x;if(g<u){if(d==n[g]||d==r[g]){if(g==0)y=x;b=x;g++}else{g=0}}}var k=void 0,C=d<255?d>=48&&d<=57||d>=97&&d<=122?2:d>=65&&d<=90?1:0:(k=fromCodePoint(d))!=k.toLowerCase()?1:k!=k.toUpperCase()?2:0;if((C==1&&w||S==0&&C!=0)&&(n[v]==d||r[v]==d&&(m=true)))a[v++]=x;S=C;x+=codePointSize(d)}if(v==u&&a[0]==0)return this.result(-100+(m?-200:0),a,e);if(g==u&&y==0)return[-200,0,b];if(c>-1)return[-700,c,c+this.pattern.length];if(g==u)return[-200+-700,y,b];if(v==u)return this.result(-100+(m?-200:0)+-700,a,e);return n.length==2?null:this.result((i[0]?-700:0)+-200+-1100,i,e)};e.prototype.result=function(e,t,n){var r=[e],i=1;for(var o=0,a=t;o<a.length;o++){var s=a[o];var c=s+(this.astral?codePointSize(codePointAt(n,s)):1);if(i>1&&r[i-1]==s)r[i-1]=c;else{r[i++]=s;r[i++]=c}}return r};return e}();var completionConfig=Facet.define({combine:function(e){return combineConfig(e,{activateOnTyping:true,override:null,maxRenderedOptions:100,defaultKeymap:true},{defaultKeymap:function(e,t){return e&&t}})}});var MaxInfoWidth=300;var baseTheme$6=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{cursor:"pointer",padding:"1px 1em 1px 3px",lineHeight:1.2},"& > li[aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"}}},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:MaxInfoWidth+"px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});function createListBox(e,t,n){var r;var i=document.createElement("ul");i.id=t;i.setAttribute("role","listbox");i.setAttribute("aria-expanded","true");for(var o=n.from;o<n.to;o++){var a=e[o],s=a.completion,c=a.match;var u=i.appendChild(document.createElement("li"));u.id=t+"-"+o;var l=u.appendChild(document.createElement("div"));l.classList.add("cm-completionIcon");if(s.type)(r=l.classList).add.apply(r,s.type.split(/\s+/g).map((function(e){return"cm-completionIcon-"+e})));l.setAttribute("aria-hidden","true");var f=u.appendChild(document.createElement("span"));f.className="cm-completionLabel";var h=s.label,d=s.detail,p=0;for(var v=1;v<c.length;){var m=c[v++],g=c[v++];if(m>p)f.appendChild(document.createTextNode(h.slice(p,m)));var y=f.appendChild(document.createElement("span"));y.appendChild(document.createTextNode(h.slice(m,g)));y.className="cm-completionMatchedText";p=g}if(p<h.length)f.appendChild(document.createTextNode(h.slice(p)));if(d){var b=u.appendChild(document.createElement("span"));b.className="cm-completionDetail";b.textContent=d}u.setAttribute("role","option")}if(n.from)i.classList.add("cm-completionListIncompleteTop");if(n.to<e.length)i.classList.add("cm-completionListIncompleteBottom");return i}function createInfoDialog(e,t){var n=document.createElement("div");n.className="cm-tooltip cm-completionInfo";var r=e.completion.info;if(typeof r=="string"){n.textContent=r}else{var i=r(e.completion);if(i.then)i.then((function(e){return n.appendChild(e)}),(function(e){return logException(t.state,e,"completion info")}));else n.appendChild(i)}return n}function rangeAroundSelected(e,t,n){if(e<=n)return{from:0,to:e};if(t<=e>>1){var r=Math.floor(t/n);return{from:r*n,to:(r+1)*n}}var i=Math.floor((e-t)/n);return{from:e-(i+1)*n,to:e-i*n}}var CompletionTooltip=function(){function e(e,t){var n=this;this.view=e;this.stateField=t;this.info=null;this.placeInfo={read:function(){return n.measureInfo()},write:function(e){return n.positionInfo(e)},key:this};var r=e.state.field(t);var i=r.open,o=i.options,a=i.selected;var s=e.state.facet(completionConfig);this.range=rangeAroundSelected(o.length,a,s.maxRenderedOptions);this.dom=document.createElement("div");this.dom.className="cm-tooltip-autocomplete";this.dom.addEventListener("mousedown",(function(t){for(var r=t.target,i=void 0;r&&r!=n.dom;r=r.parentNode){if(r.nodeName=="LI"&&(i=/-(\d+)$/.exec(r.id))&&+i[1]<o.length){applyCompletion(e,o[+i[1]]);t.preventDefault();return}}}));this.list=this.dom.appendChild(createListBox(o,r.id,this.range));this.list.addEventListener("scroll",(function(){if(n.info)n.view.requestMeasure(n.placeInfo)}))}e.prototype.mount=function(){this.updateSel()};e.prototype.update=function(e){if(e.state.field(this.stateField)!=e.startState.field(this.stateField))this.updateSel()};e.prototype.positioned=function(){if(this.info)this.view.requestMeasure(this.placeInfo)};e.prototype.updateSel=function(){var e=this;var t=this.view.state.field(this.stateField),n=t.open;if(n.selected<this.range.from||n.selected>=this.range.to){this.range=rangeAroundSelected(n.options.length,n.selected,this.view.state.facet(completionConfig).maxRenderedOptions);this.list.remove();this.list=this.dom.appendChild(createListBox(n.options,t.id,this.range));this.list.addEventListener("scroll",(function(){if(e.info)e.view.requestMeasure(e.placeInfo)}))}if(this.updateSelectedOption(n.selected)){if(this.info){this.info.remove();this.info=null}var r=n.options[n.selected];if(r.completion.info){this.info=this.dom.appendChild(createInfoDialog(r,this.view));this.view.requestMeasure(this.placeInfo)}}};e.prototype.updateSelectedOption=function(e){var t=null;for(var n=this.list.firstChild,r=this.range.from;n;n=n.nextSibling,r++){if(r==e){if(!n.hasAttribute("aria-selected")){n.setAttribute("aria-selected","true");t=n}}else{if(n.hasAttribute("aria-selected"))n.removeAttribute("aria-selected")}}if(t)scrollIntoView(this.list,t);return t};e.prototype.measureInfo=function(){var e=this.dom.querySelector("[aria-selected]");if(!e)return null;var t=this.dom.getBoundingClientRect();var n=e.getBoundingClientRect().top-t.top;if(n<0||n>this.list.clientHeight-10)return null;var r=this.view.textDirection==Direction.RTL;var i=t.left,o=innerWidth-t.right;if(r&&i<Math.min(MaxInfoWidth,o))r=false;else if(!r&&o<Math.min(MaxInfoWidth,i))r=true;return{top:n,left:r}};e.prototype.positionInfo=function(e){if(this.info&&e){this.info.style.top=e.top+"px";this.info.classList.toggle("cm-completionInfo-left",e.left);this.info.classList.toggle("cm-completionInfo-right",!e.left)}};return e}();function completionTooltip(e){return function(t){return new CompletionTooltip(t,e)}}function scrollIntoView(e,t){var n=e.getBoundingClientRect();var r=t.getBoundingClientRect();if(r.top<n.top)e.scrollTop-=n.top-r.top;else if(r.bottom>n.bottom)e.scrollTop+=r.bottom-n.bottom}var MaxOptions=300;function score(e){return(e.boost||0)*100+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}function sortOptions(e,t){var n=[],r=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];if(a.hasResult()){if(a.result.filter===false){for(var s=0,c=a.result.options;s<c.length;s++){var u=c[s];n.push(new Option(u,a,[1e9-r++]))}}else{var l=new FuzzyMatcher(t.sliceDoc(a.from,a.to)),f=void 0;for(var h=0,d=a.result.options;h<d.length;h++){var u=d[h];if(f=l.match(u.label)){if(u.boost!=null)f[0]+=u.boost;n.push(new Option(u,a,f))}}}}}n.sort(cmpOption);var p=[],v=null;for(var m=0,g=n.sort(cmpOption);m<g.length;m++){var y=g[m];if(p.length==MaxOptions)break;if(!v||v.label!=y.completion.label||v.detail!=y.completion.detail)p.push(y);else if(score(y.completion)>score(v))p[p.length-1]=y;v=y.completion}return p}var CompletionDialog=function(){function e(e,t,n,r,i){this.options=e;this.attrs=t;this.tooltip=n;this.timestamp=r;this.selected=i}e.prototype.setSelected=function(t,n){return t==this.selected||t>=this.options.length?this:new e(this.options,makeAttrs(n,t),this.tooltip,this.timestamp,t)};e.build=function(t,n,r,i){var o=sortOptions(t,n);if(!o.length)return null;var a=0;if(i&&i.selected){var s=i.options[i.selected].completion;for(var c=0;c<o.length&&!a;c++){if(o[c].completion==s)a=c}}return new e(o,makeAttrs(r,a),{pos:t.reduce((function(e,t){return t.hasResult()?Math.min(e,t.from):e}),1e8),create:completionTooltip(completionState)},i?i.timestamp:Date.now(),a)};e.prototype.map=function(t){return new e(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)};return e}();var CompletionState=function(){function e(e,t,n){this.active=e;this.id=t;this.open=n}e.start=function(){return new e(none$1,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)};e.prototype.update=function(t){var n=this;var r=t.state,i=r.facet(completionConfig);var o=i.override||r.languageDataAt("autocomplete",cur(r)).map(asSource);var a=o.map((function(e){var r=n.active.find((function(t){return t.source==e}))||new ActiveSource(e,n.active.some((function(e){return e.state!=0}))?1:0);return r.update(t,i)}));if(a.length==this.active.length&&a.every((function(e,t){return e==n.active[t]})))a=this.active;var s=t.selection||a.some((function(e){return e.hasResult()&&t.changes.touchesRange(e.from,e.to)}))||!sameResults(a,this.active)?CompletionDialog.build(a,r,this.id,this.open):this.open&&t.docChanged?this.open.map(t.changes):this.open;if(!s&&a.every((function(e){return e.state!=1}))&&a.some((function(e){return e.hasResult()})))a=a.map((function(e){return e.hasResult()?new ActiveSource(e.source,0):e}));for(var c=0,u=t.effects;c<u.length;c++){var l=u[c];if(l.is(setSelectedEffect))s=s&&s.setSelected(l.value,this.id)}return a==this.active&&s==this.open?this:new e(a,this.id,s)};Object.defineProperty(e.prototype,"tooltip",{get:function(){return this.open?this.open.tooltip:null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"attrs",{get:function(){return this.open?this.open.attrs:baseAttrs},enumerable:false,configurable:true});return e}();function sameResults(e,t){if(e==t)return true;for(var n=0,r=0;;){while(n<e.length&&!e[n].hasResult)n++;while(r<t.length&&!t[r].hasResult)r++;var i=n==e.length,o=r==t.length;if(i||o)return i==o;if(e[n++].result!=t[r++].result)return false}}function makeAttrs(e,t){return{"aria-autocomplete":"list","aria-activedescendant":e+"-"+t,"aria-owns":e}}var baseAttrs={"aria-autocomplete":"list"},none$1=[];function cmpOption(e,t){var n=t.match[0]-e.match[0];if(n)return n;var r=e.completion.label,i=t.completion.label;return r<i?-1:r==i?0:1}var ActiveSource=function(){function e(e,t,n){if(n===void 0){n=-1}this.source=e;this.state=t;this.explicitPos=n}e.prototype.hasResult=function(){return false};e.prototype.update=function(t,n){var r=t.annotation(Transaction.userEvent),i=this;if(r=="input"||r=="delete")i=i.handleUserEvent(t,r,n);else if(t.docChanged)i=i.handleChange(t);else if(t.selection&&i.state!=0)i=new e(i.source,0);for(var o=0,a=t.effects;o<a.length;o++){var s=a[o];if(s.is(startCompletionEffect))i=new e(i.source,1,s.value?cur(t.state):-1);else if(s.is(closeCompletionEffect))i=new e(i.source,0);else if(s.is(setActiveEffect))for(var c=0,u=s.value;c<u.length;c++){var l=u[c];if(l.source==i.source)i=l}}return i};e.prototype.handleUserEvent=function(t,n,r){return n=="delete"||!r.activateOnTyping?this.map(t.changes):new e(this.source,1)};e.prototype.handleChange=function(t){return t.changes.touchesRange(cur(t.startState))?new e(this.source,0):this.map(t.changes)};e.prototype.map=function(t){return t.empty||this.explicitPos<0?this:new e(this.source,this.state,t.mapPos(this.explicitPos))};return e}();var ActiveResult=function(e){__extends(t,e);function t(t,n,r,i,o,a){var s=e.call(this,t,2,n)||this;s.result=r;s.from=i;s.to=o;s.span=a;return s}t.prototype.hasResult=function(){return true};t.prototype.handleUserEvent=function(e,n,r){var i=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1);var a=cur(e.state);if((this.explicitPos>-1?a<i:a<=i)||a>o)return new ActiveSource(this.source,n=="input"&&r.activateOnTyping?1:0);var s=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);if(this.span&&(i==o||this.span.test(e.state.sliceDoc(i,o))))return new t(this.source,s,this.result,i,o,this.span);return new ActiveSource(this.source,1,s)};t.prototype.handleChange=function(e){return e.changes.touchesRange(this.from,this.to)?new ActiveSource(this.source,0):this.map(e.changes)};t.prototype.map=function(e){return e.empty?this:new t(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1),this.span)};return t}(ActiveSource);var startCompletionEffect=StateEffect.define();var closeCompletionEffect=StateEffect.define();var setActiveEffect=StateEffect.define({map:function(e,t){return e.map((function(e){return e.map(t)}))}});var setSelectedEffect=StateEffect.define();var completionState=StateField.define({create:function(){return CompletionState.start()},update:function(e,t){return e.update(t)},provide:function(e){return[showTooltip.from(e,(function(e){return e.tooltip})),EditorView.contentAttributes.from(e,(function(e){return e.attrs}))]}});var CompletionInteractMargin=75;function moveCompletionSelection(e,t){if(t===void 0){t="option"}return function(n){var r=n.state.field(completionState,false);if(!r||!r.open||Date.now()-r.open.timestamp<CompletionInteractMargin)return false;var i=1,o;if(t=="page"&&(o=n.dom.querySelector(".cm-tooltip-autocomplete")))i=Math.max(2,Math.floor(o.offsetHeight/o.firstChild.offsetHeight));var a=r.open.selected+i*(e?1:-1),s=r.open.options.length;if(a<0)a=t=="page"?0:s-1;else if(a>=s)a=t=="page"?s-1:0;n.dispatch({effects:setSelectedEffect.of(a)});return true}}var acceptCompletion=function(e){var t=e.state.field(completionState,false);if(!t||!t.open||Date.now()-t.open.timestamp<CompletionInteractMargin)return false;applyCompletion(e,t.open.options[t.open.selected]);return true};var startCompletion=function(e){var t=e.state.field(completionState,false);if(!t)return false;e.dispatch({effects:startCompletionEffect.of(true)});return true};var closeCompletion=function(e){var t=e.state.field(completionState,false);if(!t||!t.active.some((function(e){return e.state!=0})))return false;e.dispatch({effects:closeCompletionEffect.of(null)});return true};var RunningQuery=function(){function e(e,t){this.active=e;this.context=t;this.time=Date.now();this.updates=[];this.done=undefined}return e}();var DebounceTime=50,MaxUpdateCount=50,MinAbortTime=1e3;var completionPlugin=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.debounceUpdate=-1;this.running=[];this.debounceAccept=-1;this.composing=0;for(var t=0,n=e.state.field(completionState).active;t<n.length;t++){var r=n[t];if(r.state==1)this.startQuery(r)}}e.prototype.update=function(e){var t;var n=this;var r=e.state.field(completionState);if(!e.selectionSet&&!e.docChanged&&e.startState.field(completionState)==r)return;var i=e.transactions.some((function(e){var t=e.annotation(Transaction.userEvent);return(e.selection||e.docChanged)&&t!="input"&&t!="delete"}));for(var o=0;o<this.running.length;o++){var a=this.running[o];if(i||a.updates.length+e.transactions.length>MaxUpdateCount&&a.time-Date.now()>MinAbortTime){for(var s=0,c=a.context.abortListeners;s<c.length;s++){var u=c[s];try{u()}catch(d){logException(this.view.state,d)}}a.context.abortListeners=null;this.running.splice(o--,1)}else{(t=a.updates).push.apply(t,e.transactions)}}if(this.debounceUpdate>-1)clearTimeout(this.debounceUpdate);this.debounceUpdate=r.active.some((function(e){return e.state==1&&!n.running.some((function(t){return t.active.source==e.source}))}))?setTimeout((function(){return n.startUpdate()}),DebounceTime):-1;if(this.composing!=0)for(var l=0,f=e.transactions;l<f.length;l++){var h=f[l];if(h.annotation(Transaction.userEvent)=="input")this.composing=2;else if(this.composing==2&&h.selection)this.composing=3}};e.prototype.startUpdate=function(){this.debounceUpdate=-1;var e=this.view.state,t=e.field(completionState);var n=function(e){if(e.state==1&&!r.running.some((function(t){return t.active.source==e.source})))r.startQuery(e)};var r=this;for(var i=0,o=t.active;i<o.length;i++){var a=o[i];n(a)}};e.prototype.startQuery=function(e){var t=this;var n=this.view.state,r=cur(n);var i=new CompletionContext(n,r,e.explicitPos==r);var o=new RunningQuery(e,i);this.running.push(o);Promise.resolve(e.source(i)).then((function(e){if(!o.context.aborted){o.done=e||null;t.scheduleAccept()}}),(function(e){t.view.dispatch({effects:closeCompletionEffect.of(null)});logException(t.view.state,e)}))};e.prototype.scheduleAccept=function(){var e=this;if(this.running.every((function(e){return e.done!==undefined})))this.accept();else if(this.debounceAccept<0)this.debounceAccept=setTimeout((function(){return e.accept()}),DebounceTime)};e.prototype.accept=function(){var e;if(this.debounceAccept>-1)clearTimeout(this.debounceAccept);this.debounceAccept=-1;var t=[];var n=this.view.state.facet(completionConfig);var r=function(r){var a=i.running[r];if(a.done===undefined)return o=r,"continue";i.running.splice(r--,1);if(a.done){var s=new ActiveResult(a.active.source,a.active.explicitPos,a.done,a.done.from,(e=a.done.to)!==null&&e!==void 0?e:cur(a.updates.length?a.updates[0].startState:i.view.state),a.done.span&&a.done.filter!==false?ensureAnchor(a.done.span,true):null);for(var c=0,u=a.updates;c<u.length;c++){var l=u[c];s=s.update(l,n)}if(s.hasResult()){t.push(s);return o=r,"continue"}}var f=i.view.state.field(completionState).active.find((function(e){return e.source==a.active.source}));if(f&&f.state==1){if(a.done==null){var s=new ActiveSource(a.active.source,0);for(var h=0,d=a.updates;h<d.length;h++){var l=d[h];s=s.update(l,n)}if(s.state!=1)t.push(s)}else{i.startQuery(f)}}o=r};var i=this,o;for(var a=0;a<this.running.length;a++){r(a);a=o}if(t.length)this.view.dispatch({effects:setActiveEffect.of(t)})};return e}(),{eventHandlers:{compositionstart:function(){this.composing=1},compositionend:function(){var e=this;if(this.composing==3){setTimeout((function(){return e.view.dispatch({effects:startCompletionEffect.of(false)})}),20)}this.composing=0}}});var FieldPos=function(){function e(e,t,n,r){this.field=e;this.line=t;this.from=n;this.to=r}return e}();var FieldRange=function(){function e(e,t,n){this.field=e;this.from=t;this.to=n}e.prototype.map=function(t){return new e(this.field,t.mapPos(this.from,-1),t.mapPos(this.to,1))};return e}();var Snippet=function(){function e(e,t){this.lines=e;this.fieldPositions=t}e.prototype.instantiate=function(e,t){var n=[],r=[t];var i=e.doc.lineAt(t),o=/^\s*/.exec(i.text)[0];for(var a=0,s=this.lines;a<s.length;a++){var c=s[a];if(n.length){var u=o,l=/^\t*/.exec(c)[0].length;for(var f=0;f<l;f++)u+=e.facet(indentUnit);r.push(t+u.length-l);c=u+c.slice(l)}n.push(c);t+=c.length+1}var h=this.fieldPositions.map((function(e){return new FieldRange(e.field,r[e.line]+e.from,r[e.line]+e.to)}));return{text:n,ranges:h}};e.parse=function(t){var n=[];var r=[],i=[],o;for(var a=0,s=t.split(/\r\n?|\n/);a<s.length;a++){var c=s[a];while(o=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(c)){var u=o[1]?+o[1]:null,l=o[2]||o[3],f=-1;for(var h=0;h<n.length;h++){if(u!=null?n[h].seq==u:l?n[h].name==l:false)f=h}if(f<0){var d=0;while(d<n.length&&(u==null||n[d].seq!=null&&n[d].seq<u))d++;n.splice(d,0,{seq:u,name:l||null});f=d;for(var p=0,v=i;p<v.length;p++){var m=v[p];if(m.field>=f)m.field++}}i.push(new FieldPos(f,r.length,o.index,o.index+l.length));c=c.slice(0,o.index)+l+c.slice(o.index+o[0].length)}r.push(c)}return new e(r,i)};return e}();var fieldMarker=Decoration.widget({widget:new(function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.toDOM=function(){var e=document.createElement("span");e.className="cm-snippetFieldPosition";return e};t.prototype.ignoreEvent=function(){return false};return t}(WidgetType))});var fieldRange=Decoration.mark({class:"cm-snippetField"});var ActiveSnippet=function(){function e(e,t){this.ranges=e;this.active=t;this.deco=Decoration.set(e.map((function(e){return(e.from==e.to?fieldMarker:fieldRange).range(e.from,e.to)})))}e.prototype.map=function(t){return new e(this.ranges.map((function(e){return e.map(t)})),this.active)};e.prototype.selectionInsideField=function(e){var t=this;return e.ranges.every((function(e){return t.ranges.some((function(n){return n.field==t.active&&n.from<=e.from&&n.to>=e.to}))}))};return e}();var setActive=StateEffect.define({map:function(e,t){return e&&e.map(t)}});var moveToField=StateEffect.define();var snippetState=StateField.define({create:function(){return null},update:function(e,t){for(var n=0,r=t.effects;n<r.length;n++){var i=r[n];if(i.is(setActive))return i.value;if(i.is(moveToField)&&e)return new ActiveSnippet(e.ranges,i.value)}if(e&&t.docChanged)e=e.map(t.changes);if(e&&t.selection&&!e.selectionInsideField(t.selection))e=null;return e},provide:function(e){return EditorView.decorations.from(e,(function(e){return e?e.deco:Decoration.none}))}});function fieldSelection(e,t){return EditorSelection.create(e.filter((function(e){return e.field==t})).map((function(e){return EditorSelection.range(e.from,e.to)})))}function snippet(e){var t=Snippet.parse(e);return function(e,n,r,i){var o=t.instantiate(e.state,r),a=o.text,s=o.ranges;var c={changes:{from:r,to:i,insert:Text.of(a)}};if(s.length)c.selection=fieldSelection(s,0);if(s.length>1){var u=new ActiveSnippet(s,0);var l=c.effects=[setActive.of(u)];if(e.state.field(snippetState,false)===undefined)l.push(StateEffect.appendConfig.of([snippetState.init((function(){return u})),addSnippetKeymap,snippetPointerHandler,baseTheme$6]))}e.dispatch(e.state.update(c))}}function moveField(e){return function(t){var n=t.state,r=t.dispatch;var i=n.field(snippetState,false);if(!i||e<0&&i.active==0)return false;var o=i.active+e,a=e>0&&!i.ranges.some((function(t){return t.field==o+e}));r(n.update({selection:fieldSelection(i.ranges,o),effects:setActive.of(a?null:new ActiveSnippet(i.ranges,o))}));return true}}var clearSnippet=function(e){var t=e.state,n=e.dispatch;var r=t.field(snippetState,false);if(!r)return false;n(t.update({effects:setActive.of(null)}));return true};var nextSnippetField=moveField(1);var prevSnippetField=moveField(-1);var defaultSnippetKeymap=[{key:"Tab",run:nextSnippetField,shift:prevSnippetField},{key:"Escape",run:clearSnippet}];var snippetKeymap=Facet.define({combine:function(e){return e.length?e[0]:defaultSnippetKeymap}});var addSnippetKeymap=Prec.override(keymap.compute([snippetKeymap],(function(e){return e.facet(snippetKeymap)})));function snippetCompletion(e,t){return Object.assign(Object.assign({},t),{apply:snippet(e)})}var snippetPointerHandler=EditorView.domEventHandlers({mousedown:function(e,t){var n=t.state.field(snippetState,false),r;if(!n||(r=t.posAtCoords({x:e.clientX,y:e.clientY}))==null)return false;var i=n.ranges.find((function(e){return e.from<=r&&e.to>=r}));if(!i||i.field==n.active)return false;t.dispatch({selection:fieldSelection(n.ranges,i.field),effects:setActive.of(n.ranges.some((function(e){return e.field>i.field}))?new ActiveSnippet(n.ranges,i.field):null)});return true}});var completeAnyWord=function(e){var t=[],n=Object.create(null);var r=e.state.charCategorizer(e.pos);var i=Math.max(0,e.pos-5e4),o=Math.min(e.state.doc.length,i+5e4*2);var a=e.pos;for(var s=e.state.doc.iterRange(i,o),c=i;!s.next().done;){var u=s.value,l=-1;for(var f=0;;f++){if(f<u.length&&r(u[f])==CharCategory.Word){if(l<0)l=f}else if(l>-1){if(c+l<=e.pos&&c+f>=e.pos){a=c+l}else{var h=u.slice(l,f);if(!n[h]){t.push({type:"text",label:h});n[h]=true}}l=-1}if(f==u.length)break}c+=u.length}return{from:a,options:t,span:/^\w*/}};function autocompletion(e){if(e===void 0){e={}}return[completionState,completionConfig.of(e),completionPlugin,completionKeymapExt,baseTheme$6]}var completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(true)},{key:"ArrowUp",run:moveCompletionSelection(false)},{key:"PageDown",run:moveCompletionSelection(true,"page")},{key:"PageUp",run:moveCompletionSelection(false,"page")},{key:"Enter",run:acceptCompletion}];var completionKeymapExt=Prec.override(keymap.computeN([completionConfig],(function(e){return e.facet(completionConfig).defaultKeymap?[completionKeymap]:[]})));var defaults$1={brackets:["(","[","{","'",'"'],before:")]}'\":;>"};var closeBracketEffect=StateEffect.define({map:function(e,t){var n=t.mapPos(e,-1,MapMode.TrackAfter);return n==null?undefined:n}});var skipBracketEffect=StateEffect.define({map:function(e,t){return t.mapPos(e)}});var closedBracket=new(function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(RangeValue));closedBracket.startSide=1;closedBracket.endSide=-1;var bracketState=StateField.define({create:function(){return RangeSet.empty},update:function(e,t){if(t.selection){var n=t.state.doc.lineAt(t.selection.main.head).from;var r=t.startState.doc.lineAt(t.startState.selection.main.head).from;if(n!=t.changes.mapPos(r,-1))e=RangeSet.empty}e=e.map(t.changes);var i=function(t){if(t.is(closeBracketEffect))e=e.update({add:[closedBracket.range(t.value,t.value+1)]});else if(t.is(skipBracketEffect))e=e.update({filter:function(e){return e!=t.value}})};for(var o=0,a=t.effects;o<a.length;o++){var s=a[o];i(s)}return e}});function closeBrackets(){return[EditorView.inputHandler.of(handleInput),bracketState]}var definedClosing="()[]{}<>";function closing(e){for(var t=0;t<definedClosing.length;t+=2)if(definedClosing.charCodeAt(t)==e)return definedClosing.charAt(t+1);return fromCodePoint(e<128?e:e+1)}function config(e,t){return e.languageDataAt("closeBrackets",t)[0]||defaults$1}function handleInput(e,t,n,r){if(e.composing)return false;var i=e.state.selection.main;if(r.length>2||r.length==2&&codePointSize(codePointAt(r,0))==1||t!=i.from||n!=i.to)return false;var o=insertBracket(e.state,r);if(!o)return false;e.dispatch(o);return true}var deleteBracketPair=function(e){var t=e.state,n=e.dispatch;var r=config(t,t.selection.main.head);var i=r.brackets||defaults$1.brackets;var o=null,a=t.changeByRange((function(e){if(e.empty){var n=prevChar(t.doc,e.head);for(var r=0,a=i;r<a.length;r++){var s=a[r];if(s==n&&nextChar(t.doc,e.head)==closing(codePointAt(s,0)))return{changes:{from:e.head-s.length,to:e.head+s.length},range:EditorSelection.cursor(e.head-s.length),annotations:Transaction.userEvent.of("delete")}}}return{range:o=e}}));if(!o)n(t.update(a,{scrollIntoView:true}));return!o};var closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(e,t){var n=config(e,e.selection.main.head);var r=n.brackets||defaults$1.brackets;for(var i=0,o=r;i<o.length;i++){var a=o[i];var s=closing(codePointAt(a,0));if(t==a)return s==a?handleSame(e,a,r.indexOf(a+a+a)>-1):handleOpen(e,a,s,n.before||defaults$1.before);if(t==s&&closedBracketAt(e,e.selection.main.from))return handleClose(e,a,s)}return null}function closedBracketAt(e,t){var n=false;e.field(bracketState).between(0,e.doc.length,(function(e){if(e==t)n=true}));return n}function nextChar(e,t){var n=e.sliceString(t,t+2);return n.slice(0,codePointSize(codePointAt(n,0)))}function prevChar(e,t){var n=e.sliceString(t-2,t);return codePointSize(codePointAt(n,0))==n.length?n:n.slice(1)}function handleOpen(e,t,n,r){var i=null,o=e.changeByRange((function(o){if(!o.empty)return{changes:[{insert:t,from:o.from},{insert:n,from:o.to}],effects:closeBracketEffect.of(o.to+t.length),range:EditorSelection.range(o.anchor+t.length,o.head+t.length)};var a=nextChar(e.doc,o.head);if(!a||/\s/.test(a)||r.indexOf(a)>-1)return{changes:{insert:t+n,from:o.head},effects:closeBracketEffect.of(o.head+t.length),range:EditorSelection.cursor(o.head+t.length)};return{range:i=o}}));return i?null:e.update(o,{scrollIntoView:true,annotations:Transaction.userEvent.of("input")})}function handleClose(e,t,n){var r=null,i=e.selection.ranges.map((function(t){if(t.empty&&nextChar(e.doc,t.head)==n)return EditorSelection.cursor(t.head+n.length);return r=t}));return r?null:e.update({selection:EditorSelection.create(i,e.selection.mainIndex),scrollIntoView:true,effects:e.selection.ranges.map((function(e){var t=e.from;return skipBracketEffect.of(t)}))})}function handleSame(e,t,n){var r=null,i=e.changeByRange((function(i){if(!i.empty)return{changes:[{insert:t,from:i.from},{insert:t,from:i.to}],effects:closeBracketEffect.of(i.to+t.length),range:EditorSelection.range(i.anchor+t.length,i.head+t.length)};var o=i.head,a=nextChar(e.doc,o);if(a==t){if(nodeStart(e,o)){return{changes:{insert:t+t,from:o},effects:closeBracketEffect.of(o+t.length),range:EditorSelection.cursor(o+t.length)}}else if(closedBracketAt(e,o)){var s=n&&e.sliceDoc(o,o+t.length*3)==t+t+t;return{range:EditorSelection.cursor(o+t.length*(s?3:1)),effects:skipBracketEffect.of(o)}}}else if(n&&e.sliceDoc(o-2*t.length,o)==t+t&&nodeStart(e,o-2*t.length)){return{changes:{insert:t+t+t+t,from:o},effects:closeBracketEffect.of(o+t.length),range:EditorSelection.cursor(o+t.length)}}else if(e.charCategorizer(o)(a)!=CharCategory.Word){var c=e.sliceDoc(o-1,o);if(c!=t&&e.charCategorizer(o)(c)!=CharCategory.Word)return{changes:{insert:t+t,from:o},effects:closeBracketEffect.of(o+t.length),range:EditorSelection.cursor(o+t.length)}}return{range:r=i}}));return r?null:e.update(i,{scrollIntoView:true,annotations:Transaction.userEvent.of("input")})}function nodeStart(e,t){var n=syntaxTree(e).resolve(t+1);return n.parent&&n.from==t}var baseTheme$5=EditorView.baseTheme({".cm-matchingBracket":{color:"#0b0"},".cm-nonmatchingBracket":{color:"#a22"}});var DefaultScanDist=1e4,DefaultBrackets="()[]{}";var bracketMatchingConfig=Facet.define({combine:function(e){return combineConfig(e,{afterCursor:true,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist})}});var matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});var bracketMatchingState=StateField.define({create:function(){return Decoration.none},update:function(e,t){if(!t.docChanged&&!t.selection)return e;var n=[];var r=t.state.facet(bracketMatchingConfig);for(var i=0,o=t.state.selection.ranges;i<o.length;i++){var a=o[i];if(!a.empty)continue;var s=matchBrackets(t.state,a.head,-1,r)||a.head>0&&matchBrackets(t.state,a.head-1,1,r)||r.afterCursor&&(matchBrackets(t.state,a.head,1,r)||a.head<t.state.doc.length&&matchBrackets(t.state,a.head+1,-1,r));if(!s)continue;var c=s.matched?matchingMark:nonmatchingMark;n.push(c.range(s.start.from,s.start.to));if(s.end)n.push(c.range(s.end.from,s.end.to))}return Decoration.set(n,true)},provide:function(e){return EditorView.decorations.from(e)}});var bracketMatchingUnique=[bracketMatchingState,baseTheme$5];function bracketMatching(e){if(e===void 0){e={}}return[bracketMatchingConfig.of(e),bracketMatchingUnique]}function matchingNodes(e,t,n){var r=e.prop(t<0?NodeProp.openedBy:NodeProp.closedBy);if(r)return r;if(e.name.length==1){var i=n.indexOf(e.name);if(i>-1&&i%2==(t<0?1:0))return[n[i+t]]}return null}function matchBrackets(e,t,n,r){if(r===void 0){r={}}var i=r.maxScanDistance||DefaultScanDist,o=r.brackets||DefaultBrackets;var a=syntaxTree(e),s=a.resolve(t,n),c;if(c=matchingNodes(s.type,n,o))return matchMarkedBrackets(e,t,n,s,c,o);else return matchPlainBrackets(e,t,n,a,s.type,i,o)}function matchMarkedBrackets(e,t,n,r,i,o){var a=r.parent,s={from:r.from,to:r.to};var c=0,u=a===null||a===void 0?void 0:a.cursor;if(u&&(n<0?u.childBefore(r.from):u.childAfter(r.to)))do{if(n<0?u.to<=r.from:u.from>=r.to){if(c==0&&i.indexOf(u.type.name)>-1){return{start:s,end:{from:u.from,to:u.to},matched:true}}else if(matchingNodes(u.type,n,o)){c++}else if(matchingNodes(u.type,-n,o)){c--;if(c==0)return{start:s,end:{from:u.from,to:u.to},matched:false}}}}while(n<0?u.prevSibling():u.nextSibling());return{start:s,matched:false}}function matchPlainBrackets(e,t,n,r,i,o,a){var s=n<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1);var c=a.indexOf(s);if(c<0||c%2==0!=n>0)return null;var u={from:n<0?t-1:t,to:n>0?t+1:t};var l=e.doc.iterRange(t,n>0?e.doc.length:0),f=0;for(var h=0;!l.next().done&&h<=o;){var d=l.value;if(n<0)h+=d.length;var p=t+h*n;for(var v=n>0?0:d.length-1,m=n>0?d.length:-1;v!=m;v+=n){var g=a.indexOf(d[v]);if(g<0||r.resolve(p+v,1).type!=i)continue;if(g%2==0==n>0){f++}else if(f==1){return{start:u,end:{from:p+v,to:p+v+1},matched:g>>1==c>>1}}else{f--}}if(n>0)h+=d.length}return l.done?{start:u,matched:false}:null}function updateSel(e,t){return EditorSelection.create(e.ranges.map(t),e.mainIndex)}function setSel(e,t){return e.update({selection:t,scrollIntoView:true,annotations:Transaction.userEvent.of("keyboardselection")})}function moveSel(e,t){var n=e.state,r=e.dispatch;var i=updateSel(n.selection,t);if(i.eq(n.selection))return false;r(setSel(n,i));return true}function rangeEnd(e,t){return EditorSelection.cursor(t?e.to:e.from)}function cursorByChar(e,t){return moveSel(e,(function(n){return n.empty?e.moveByChar(n,t):rangeEnd(n,t)}))}var cursorCharLeft=function(e){return cursorByChar(e,e.textDirection!=Direction.LTR)};var cursorCharRight=function(e){return cursorByChar(e,e.textDirection==Direction.LTR)};function cursorByGroup(e,t){return moveSel(e,(function(n){return n.empty?e.moveByGroup(n,t):rangeEnd(n,t)}))}var cursorGroupLeft=function(e){return cursorByGroup(e,e.textDirection!=Direction.LTR)};var cursorGroupRight=function(e){return cursorByGroup(e,e.textDirection==Direction.LTR)};var cursorGroupForward=function(e){return cursorByGroup(e,true)};var cursorGroupBackward=function(e){return cursorByGroup(e,false)};function interestingNode(e,t,n){if(t.type.prop(n))return true;var r=t.to-t.from;return r&&(r>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function moveBySyntax(e,t,n){var r=syntaxTree(e).resolve(t.head);var i=n?NodeProp.closedBy:NodeProp.openedBy;for(var o=t.head;;){var a=n?r.childAfter(o):r.childBefore(o);if(!a)break;if(interestingNode(e,a,i))r=a;else o=n?a.to:a.from}var s=r.type.prop(i),c,u;if(s&&(c=n?matchBrackets(e,r.from,1):matchBrackets(e,r.to,-1))&&c.matched)u=n?c.end.to:c.end.from;else u=n?r.to:r.from;return EditorSelection.cursor(u,n?-1:1)}var cursorSyntaxLeft=function(e){return moveSel(e,(function(t){return moveBySyntax(e.state,t,e.textDirection!=Direction.LTR)}))};var cursorSyntaxRight=function(e){return moveSel(e,(function(t){return moveBySyntax(e.state,t,e.textDirection==Direction.LTR)}))};function cursorByLine(e,t){return moveSel(e,(function(n){return n.empty?e.moveVertically(n,t):rangeEnd(n,t)}))}var cursorLineUp=function(e){return cursorByLine(e,false)};var cursorLineDown=function(e){return cursorByLine(e,true)};function cursorByPage(e,t){return moveSel(e,(function(n){return n.empty?e.moveVertically(n,t,e.dom.clientHeight):rangeEnd(n,t)}))}var cursorPageUp=function(e){return cursorByPage(e,false)};var cursorPageDown=function(e){return cursorByPage(e,true)};function moveByLineBoundary(e,t,n){var r=e.visualLineAt(t.head),i=e.moveToLineBoundary(t,n);if(i.head==t.head&&i.head!=(n?r.to:r.from))i=e.moveToLineBoundary(t,n,false);if(!n&&i.head==r.from&&r.length){var o=/^\s*/.exec(e.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;if(o&&t.head!=r.from+o)i=EditorSelection.cursor(r.from+o)}return i}var cursorLineBoundaryForward=function(e){return moveSel(e,(function(t){return moveByLineBoundary(e,t,true)}))};var cursorLineBoundaryBackward=function(e){return moveSel(e,(function(t){return moveByLineBoundary(e,t,false)}))};var cursorLineStart=function(e){return moveSel(e,(function(t){return EditorSelection.cursor(e.visualLineAt(t.head).from,1)}))};var cursorLineEnd=function(e){return moveSel(e,(function(t){return EditorSelection.cursor(e.visualLineAt(t.head).to,-1)}))};function toMatchingBracket(e,t,n){var r=false,i=updateSel(e.selection,(function(t){var i=matchBrackets(e,t.head,-1)||matchBrackets(e,t.head,1)||t.head>0&&matchBrackets(e,t.head-1,1)||t.head<e.doc.length&&matchBrackets(e,t.head+1,-1);if(!i||!i.end)return t;r=true;var o=i.start.from==t.head?i.end.to:i.end.from;return n?EditorSelection.range(t.anchor,o):EditorSelection.cursor(o)}));if(!r)return false;t(setSel(e,i));return true}var cursorMatchingBracket=function(e){var t=e.state,n=e.dispatch;return toMatchingBracket(t,n,false)};function extendSel(e,t){var n=updateSel(e.state.selection,(function(e){var n=t(e);return EditorSelection.range(e.anchor,n.head,n.goalColumn)}));if(n.eq(e.state.selection))return false;e.dispatch(setSel(e.state,n));return true}function selectByChar(e,t){return extendSel(e,(function(n){return e.moveByChar(n,t)}))}var selectCharLeft=function(e){return selectByChar(e,e.textDirection!=Direction.LTR)};var selectCharRight=function(e){return selectByChar(e,e.textDirection==Direction.LTR)};function selectByGroup(e,t){return extendSel(e,(function(n){return e.moveByGroup(n,t)}))}var selectGroupLeft=function(e){return selectByGroup(e,e.textDirection!=Direction.LTR)};var selectGroupRight=function(e){return selectByGroup(e,e.textDirection==Direction.LTR)};var selectGroupForward=function(e){return selectByGroup(e,true)};var selectGroupBackward=function(e){return selectByGroup(e,false)};var selectSyntaxLeft=function(e){return extendSel(e,(function(t){return moveBySyntax(e.state,t,e.textDirection!=Direction.LTR)}))};var selectSyntaxRight=function(e){return extendSel(e,(function(t){return moveBySyntax(e.state,t,e.textDirection==Direction.LTR)}))};function selectByLine(e,t){return extendSel(e,(function(n){return e.moveVertically(n,t)}))}var selectLineUp=function(e){return selectByLine(e,false)};var selectLineDown=function(e){return selectByLine(e,true)};function selectByPage(e,t){return extendSel(e,(function(n){return e.moveVertically(n,t,e.dom.clientHeight)}))}var selectPageUp=function(e){return selectByPage(e,false)};var selectPageDown=function(e){return selectByPage(e,true)};var selectLineBoundaryForward=function(e){return extendSel(e,(function(t){return moveByLineBoundary(e,t,true)}))};var selectLineBoundaryBackward=function(e){return extendSel(e,(function(t){return moveByLineBoundary(e,t,false)}))};var selectLineStart=function(e){return extendSel(e,(function(t){return EditorSelection.cursor(e.visualLineAt(t.head).from)}))};var selectLineEnd=function(e){return extendSel(e,(function(t){return EditorSelection.cursor(e.visualLineAt(t.head).to)}))};var cursorDocStart=function(e){var t=e.state,n=e.dispatch;n(setSel(t,{anchor:0}));return true};var cursorDocEnd=function(e){var t=e.state,n=e.dispatch;n(setSel(t,{anchor:t.doc.length}));return true};var selectDocStart=function(e){var t=e.state,n=e.dispatch;n(setSel(t,{anchor:t.selection.main.anchor,head:0}));return true};var selectDocEnd=function(e){var t=e.state,n=e.dispatch;n(setSel(t,{anchor:t.selection.main.anchor,head:t.doc.length}));return true};var selectAll=function(e){var t=e.state,n=e.dispatch;n(t.update({selection:{anchor:0,head:t.doc.length},annotations:Transaction.userEvent.of("keyboardselection")}));return true};var selectLine=function(e){var t=e.state,n=e.dispatch;var r=selectedLineBlocks(t).map((function(e){var n=e.from,r=e.to;return EditorSelection.range(n,Math.min(r+1,t.doc.length))}));n(t.update({selection:EditorSelection.create(r),annotations:Transaction.userEvent.of("keyboardselection")}));return true};var selectParentSyntax=function(e){var t=e.state,n=e.dispatch;var r=updateSel(t.selection,(function(e){var n;var r=syntaxTree(t).resolve(e.head,1);while(!(r.from<e.from&&r.to>=e.to||r.to>e.to&&r.from<=e.from||!((n=r.parent)===null||n===void 0?void 0:n.parent)))r=r.parent;return EditorSelection.range(r.to,r.from)}));n(setSel(t,r));return true};var simplifySelection=function(e){var t=e.state,n=e.dispatch;var r=t.selection,i=null;if(r.ranges.length>1)i=EditorSelection.create([r.main]);else if(!r.main.empty)i=EditorSelection.create([EditorSelection.cursor(r.main.head)]);if(!i)return false;n(setSel(t,i));return true};function deleteBy(e,t){var n=e.state,r=e.dispatch;var i=n.changeByRange((function(e){var n=e.from,r=e.to;if(n==r){var i=t(n);n=Math.min(n,i);r=Math.max(r,i)}return n==r?{range:e}:{changes:{from:n,to:r},range:EditorSelection.cursor(n)}}));if(i.changes.empty)return false;r(n.update(i,{scrollIntoView:true,annotations:Transaction.userEvent.of("delete")}));return true}var deleteByChar=function(e,t,n){return deleteBy(e,(function(r){var i=e.state,o=i.doc.lineAt(r),a;if(!t&&r>o.from&&r<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,r-o.from))){if(a[a.length-1]=="\t")return r-1;var s=countColumn(a,0,i.tabSize),c=s%getIndentUnit(i)||getIndentUnit(i);for(var u=0;u<c&&a[a.length-1-u]==" ";u++)r--;return r}var l;if(n){var f=o.text.slice(r-o.from+(t?0:-2),r-o.from+(t?2:0));var h=f?codePointSize(codePointAt(f,0)):1;l=t?Math.min(i.doc.length,r+h):Math.max(0,r-h)}else{l=findClusterBreak(o.text,r-o.from,t)+o.from}if(l==r&&o.number!=(t?i.doc.lines:1))l+=t?1:-1;return l}))};var deleteCodePointBackward=function(e){return deleteByChar(e,false,true)};var deleteCharBackward=function(e){return deleteByChar(e,false,false)};var deleteCharForward=function(e){return deleteByChar(e,true,false)};var deleteByGroup=function(e,t){return deleteBy(e,(function(n){var r=n,i=e.state,o=i.doc.lineAt(r);var a=i.charCategorizer(r);for(var s=null;;){if(r==(t?o.to:o.from)){if(r==n&&o.number!=(t?i.doc.lines:1))r+=t?1:-1;break}var c=findClusterBreak(o.text,r-o.from,t)+o.from;var u=o.text.slice(Math.min(r,c)-o.from,Math.max(r,c)-o.from);var l=a(u);if(s!=null&&l!=s)break;if(u!=" "||r!=n)s=l;r=c}return r}))};var deleteGroupBackward=function(e){return deleteByGroup(e,false)};var deleteGroupForward=function(e){return deleteByGroup(e,true)};var deleteToLineEnd=function(e){return deleteBy(e,(function(t){var n=e.visualLineAt(t).to;if(t<n)return n;return Math.min(e.state.doc.length,t+1)}))};var deleteToLineStart=function(e){return deleteBy(e,(function(t){var n=e.visualLineAt(t).from;if(t>n)return n;return Math.max(0,t-1)}))};var splitLine=function(e){var t=e.state,n=e.dispatch;var r=t.changeByRange((function(e){return{changes:{from:e.from,to:e.to,insert:Text.of(["",""])},range:EditorSelection.cursor(e.from)}}));n(t.update(r,{scrollIntoView:true,annotations:Transaction.userEvent.of("input")}));return true};var transposeChars=function(e){var t=e.state,n=e.dispatch;var r=t.changeByRange((function(e){if(!e.empty||e.from==0||e.from==t.doc.length)return{range:e};var n=e.from,r=t.doc.lineAt(n);var i=n==r.from?n-1:findClusterBreak(r.text,n-r.from,false)+r.from;var o=n==r.to?n+1:findClusterBreak(r.text,n-r.from,true)+r.from;return{changes:{from:i,to:o,insert:t.doc.slice(n,o).append(t.doc.slice(i,n))},range:EditorSelection.cursor(o)}}));if(r.changes.empty)return false;n(t.update(r,{scrollIntoView:true}));return true};function selectedLineBlocks(e){var t=[],n=-1;for(var r=0,i=e.selection.ranges;r<i.length;r++){var o=i[r];var a=e.doc.lineAt(o.from),s=e.doc.lineAt(o.to);if(!o.empty&&o.to==s.from)s=e.doc.lineAt(o.to-1);if(n>=a.number){var c=t[t.length-1];c.to=s.to;c.ranges.push(o)}else{t.push({from:a.from,to:s.to,ranges:[o]})}n=s.number+1}return t}function moveLine(e,t,n){var r=[],i=[];for(var o=0,a=selectedLineBlocks(e);o<a.length;o++){var s=a[o];if(n?s.to==e.doc.length:s.from==0)continue;var c=e.doc.lineAt(n?s.to+1:s.from-1);var u=c.length+1;if(n){r.push({from:s.to,to:c.to},{from:s.from,insert:c.text+e.lineBreak});for(var l=0,f=s.ranges;l<f.length;l++){var h=f[l];i.push(EditorSelection.range(Math.min(e.doc.length,h.anchor+u),Math.min(e.doc.length,h.head+u)))}}else{r.push({from:c.from,to:s.from},{from:s.to,insert:e.lineBreak+c.text});for(var d=0,p=s.ranges;d<p.length;d++){var h=p[d];i.push(EditorSelection.range(h.anchor-u,h.head-u))}}}if(!r.length)return false;t(e.update({changes:r,scrollIntoView:true,selection:EditorSelection.create(i,e.selection.mainIndex)}));return true}var moveLineUp=function(e){var t=e.state,n=e.dispatch;return moveLine(t,n,false)};var moveLineDown=function(e){var t=e.state,n=e.dispatch;return moveLine(t,n,true)};function copyLine(e,t,n){var r=[];for(var i=0,o=selectedLineBlocks(e);i<o.length;i++){var a=o[i];if(n)r.push({from:a.from,insert:e.doc.slice(a.from,a.to)+e.lineBreak});else r.push({from:a.to,insert:e.lineBreak+e.doc.slice(a.from,a.to)})}t(e.update({changes:r,scrollIntoView:true}));return true}var copyLineUp=function(e){var t=e.state,n=e.dispatch;return copyLine(t,n,false)};var copyLineDown=function(e){var t=e.state,n=e.dispatch;return copyLine(t,n,true)};var deleteLine=function(e){var t=e.state,n=t.changes(selectedLineBlocks(t).map((function(e){var n=e.from,r=e.to;if(n>0)n--;else if(r<t.doc.length)r++;return{from:n,to:r}})));var r=updateSel(t.selection,(function(t){return e.moveVertically(t,true)})).map(n);e.dispatch({changes:n,selection:r,scrollIntoView:true});return true};function isBetweenBrackets(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};var n=syntaxTree(e).resolve(t);var r=n.childBefore(t),i=n.childAfter(t),o;if(r&&i&&r.to<=t&&i.from>=t&&(o=r.type.prop(NodeProp.closedBy))&&o.indexOf(i.name)>-1&&e.doc.lineAt(r.to).from==e.doc.lineAt(i.from).from)return{from:r.to,to:i.from};return null}var insertNewlineAndIndent=function(e){var t=e.state,n=e.dispatch;var r=t.changeByRange((function(e){var n=e.from,r=e.to;var i=n==r&&isBetweenBrackets(t,n);var o=new IndentContext(t,{simulateBreak:n,simulateDoubleBreak:!!i});var a=getIndentation(o,n);if(a==null)a=/^\s*/.exec(t.doc.lineAt(n).text)[0].length;var s=t.doc.lineAt(n);while(r<s.to&&/\s/.test(s.text.slice(r-s.from,r+1-s.from)))r++;if(i)n=i.from,r=i.to;else if(n>s.from&&n<s.from+100&&!/\S/.test(s.text.slice(0,n)))n=s.from;var c=["",indentString(t,a)];if(i)c.push(indentString(t,o.lineIndent(s)));return{changes:{from:n,to:r,insert:Text.of(c)},range:EditorSelection.cursor(n+1+c[1].length)}}));n(t.update(r,{scrollIntoView:true}));return true};function changeBySelectedLine(e,t){var n=-1;return e.changeByRange((function(r){var i=[];for(var o=r.from;o<=r.to;){var a=e.doc.lineAt(o);if(a.number>n&&(r.empty||r.to>a.from)){t(a,i,r);n=a.number}o=a.to+1}var s=e.changes(i);return{changes:i,range:EditorSelection.range(s.mapPos(r.anchor,1),s.mapPos(r.head,1))}}))}var indentSelection=function(e){var t=e.state,n=e.dispatch;var r=Object.create(null);var i=new IndentContext(t,{overrideIndentation:function(e){var t=r[e];return t==null?-1:t}});var o=changeBySelectedLine(t,(function(e,n,o){var a=getIndentation(i,e.from);if(a==null)return;var s=/^\s*/.exec(e.text)[0];var c=indentString(t,a);if(s!=c||o.from<e.from+s.length){r[e.from]=a;n.push({from:e.from,to:e.from+s.length,insert:c})}}));if(!o.changes.empty)n(t.update(o));return true};var indentMore=function(e){var t=e.state,n=e.dispatch;n(t.update(changeBySelectedLine(t,(function(e,n){n.push({from:e.from,insert:t.facet(indentUnit)})}))));return true};var indentLess=function(e){var t=e.state,n=e.dispatch;n(t.update(changeBySelectedLine(t,(function(e,n){var r=/^\s*/.exec(e.text)[0];if(!r)return;var i=countColumn(r,0,t.tabSize),o=0;var a=indentString(t,Math.max(0,i-getIndentUnit(t)));while(o<r.length&&o<a.length&&r.charCodeAt(o)==a.charCodeAt(o))o++;n.push({from:e.from+o,to:e.from+r.length,insert:a.slice(o)})}))));return true};var emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:true},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Alt-d",run:deleteGroupForward},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Alt-f",run:cursorGroupForward,shift:selectGroupForward},{key:"Alt-b",run:cursorGroupBackward,shift:selectGroupBackward},{key:"Alt-<",run:cursorDocStart},{key:"Alt->",run:cursorDocEnd},{key:"Ctrl-v",run:cursorPageDown},{key:"Alt-v",run:cursorPageUp}];var standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:true},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:true},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:true},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:true},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCodePointBackward,shift:deleteCodePointBackward},{key:"Delete",run:deleteCharForward,shift:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteToLineStart},{mac:"Mod-Delete",run:deleteToLineEnd}].concat(emacsStyleKeymap.map((function(e){return{mac:e.key,run:e.run,shift:e.shift}})));var defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:true},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket}].concat(standardKeymap);var toggleComment=function(e){var t=getConfig(e.state);return t.line?toggleLineComment(e):t.block?toggleBlockComment(e):false};function command(e,t){return function(n){var r=n.state,i=n.dispatch;var o=e(t,r.selection.ranges,r);if(!o)return false;i(r.update(o));return true}}var toggleLineComment=command(changeLineComment,0);var toggleBlockComment=command(changeBlockComment,0);var commentKeymap=[{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment}];function getConfig(e,t){if(t===void 0){t=e.selection.main.head}var n=e.languageDataAt("commentTokens",t);return n.length?n[0]:{}}var SearchMargin=50;function findBlockComment(e,t,n,r){var i=t.open,o=t.close;var a=e.sliceDoc(n-SearchMargin,n);var s=e.sliceDoc(r,r+SearchMargin);var c=/\s*$/.exec(a)[0].length,u=/^\s*/.exec(s)[0].length;var l=a.length-c;if(a.slice(l-i.length,l)==i&&s.slice(u,u+o.length)==o){return{open:{pos:n-c,margin:c&&1},close:{pos:r+u,margin:u&&1}}}var f,h;if(r-n<=2*SearchMargin){f=h=e.sliceDoc(n,r)}else{f=e.sliceDoc(n,n+SearchMargin);h=e.sliceDoc(r-SearchMargin,r)}var d=/^\s*/.exec(f)[0].length,p=/\s*$/.exec(h)[0].length;var v=h.length-p-o.length;if(f.slice(d,d+i.length)==i&&h.slice(v,v+o.length)==o){return{open:{pos:n+d+i.length,margin:/\s/.test(f.charAt(d+i.length))?1:0},close:{pos:r-p-o.length,margin:/\s/.test(h.charAt(v-1))?1:0}}}return null}function changeBlockComment(e,t,n){var r=t.map((function(e){return getConfig(n,e.from).block}));if(!r.every((function(e){return e})))return null;var i=t.map((function(e,t){return findBlockComment(n,r[t],e.from,e.to)}));if(e!=2&&!i.every((function(e){return e}))){var o=0;return n.changeByRange((function(e){var t=r[o++],n=t.open,a=t.close;if(i[o])return{range:e};var s=n.length+1;return{changes:[{from:e.from,insert:n+" "},{from:e.to,insert:" "+a}],range:EditorSelection.range(e.anchor+s,e.head+s)}}))}else if(e!=1&&i.some((function(e){return e}))){var a=[];for(var s=0,c;s<i.length;s++)if(c=i[s]){var u=r[s],l=c.open,f=c.close;a.push({from:l.pos-u.open.length,to:l.pos+l.margin},{from:f.pos-f.margin,to:f.pos+u.close.length})}return{changes:a}}return null}function changeLineComment(e,t,n){var r=[];var i=-1;for(var o=0,a=t;o<a.length;o++){var s=a[o],c=s.from,u=s.to;var l=r.length,f=1e9;for(var h=c;h<=u;){var d=n.doc.lineAt(h);if(d.from>i&&(c==u||u>d.from)){i=d.from;var p=getConfig(n,h).line;if(!p)continue;var v=/^\s*/.exec(d.text)[0].length;var m=v==d.length;var g=d.text.slice(v,v+p.length)==p?v:-1;if(v<d.text.length&&v<f)f=v;r.push({line:d,comment:g,token:p,indent:v,empty:m,single:false})}h=d.to+1}if(f<1e9)for(var y=l;y<r.length;y++)if(r[y].indent<r[y].line.text.length)r[y].indent=f;if(r.length==l+1)r[l].single=true}if(e!=2&&r.some((function(e){return e.comment<0&&(!e.empty||e.single)}))){var b=[];for(var w=0,x=r;w<x.length;w++){var S=x[w],d=S.line,p=S.token,v=S.indent,k=S.empty,C=S.single;if(C||!k)b.push({from:d.from+v,insert:p+" "})}var A=n.changes(b);return{changes:A,selection:n.selection.map(A,1)}}else if(e!=1&&r.some((function(e){return e.comment>=0}))){var b=[];for(var M=0,I=r;M<I.length;M++){var E=I[M],d=E.line,R=E.comment,p=E.token;if(R>=0){var c=d.from+R,u=c+p.length;if(d.text[u-d.from]==" ")u++;b.push({from:c,to:u})}}return{changes:b}}return null}var GutterMarker=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.compare=function(e){return this==e||this.constructor==e.constructor&&this.eq(e)};t.prototype.eq=function(e){return false};t.prototype.at=function(e){return this.range(e)};return t}(RangeValue);GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=undefined;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.point=true;var gutterLineClass=Facet.define();var defaults={class:"",renderEmptyElements:false,elementStyle:"",markers:function(){return RangeSet.empty},lineMarker:function(){return null},initialSpacer:null,updateSpacer:null,domEventHandlers:{}};var activeGutters=Facet.define();function gutter(e){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults),e))]}var baseTheme$4=EditorView.baseTheme({".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#999",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",height:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"}});var unfixGutters=Facet.define({combine:function(e){return e.some((function(e){return e}))}});function gutters(e){var t=[gutterView,baseTheme$4];if(e&&e.fixed===false)t.push(unfixGutters.of(true));return t}var gutterView=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.dom=document.createElement("div");this.dom.className="cm-gutters";this.dom.setAttribute("aria-hidden","true");this.gutters=e.state.facet(activeGutters).map((function(t){return new SingleGutterView(e,t)}));for(var t=0,n=this.gutters;t<n.length;t++){var r=n[t];this.dom.appendChild(r.dom)}this.fixed=!e.state.facet(unfixGutters);if(this.fixed){this.dom.style.position="sticky"}e.scrollDOM.insertBefore(this.dom,e.contentDOM);this.syncGutters()}e.prototype.update=function(e){if(this.updateGutters(e))this.syncGutters()};e.prototype.syncGutters=function(){var e=this;var t=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from);var n=[];var r=this.gutters.map((function(t){return new UpdateContext(t,e.view.viewport)}));this.view.viewportLines((function(i){var o;if(Array.isArray(i.type)){for(var a=0,s=i.type;a<s.length;a++){var c=s[a];if(c.type==BlockType.Text){o=c;break}}}else{o=i.type==BlockType.Text?i:undefined}if(!o)return;if(n.length)n=[];advanceCursor(t,n,i.from);for(var u=0,l=r;u<l.length;u++){var f=l[u];f.line(e.view,o,n)}}),0);for(var i=0,o=r;i<o.length;i++){var a=o[i];a.finish()}this.dom.style.minHeight=this.view.contentHeight+"px";if(this.view.state.facet(unfixGutters)!=!this.fixed){this.fixed=!this.fixed;this.dom.style.position=this.fixed?"sticky":""}};e.prototype.updateGutters=function(e){var t=e.startState.facet(activeGutters),n=e.state.facet(activeGutters);var r=e.docChanged||e.heightChanged||e.viewportChanged||!RangeSet.eq(e.startState.facet(gutterLineClass),e.state.facet(gutterLineClass),e.view.viewport.from,e.view.viewport.to);if(t==n){for(var i=0,o=this.gutters;i<o.length;i++){var a=o[i];if(a.update(e))r=true}}else{r=true;var s=[];for(var c=0,u=n;c<u.length;c++){var l=u[c];var f=t.indexOf(l);if(f<0){s.push(new SingleGutterView(this.view,l))}else{this.gutters[f].update(e);s.push(this.gutters[f])}}for(var h=0,d=this.gutters;h<d.length;h++){var p=d[h];p.dom.remove()}for(var v=0,m=s;v<m.length;v++){var p=m[v];this.dom.appendChild(p.dom)}this.gutters=s}return r};e.prototype.destroy=function(){this.dom.remove()};return e}(),{provide:PluginField.scrollMargins.from((function(e){if(e.gutters.length==0||!e.fixed)return null;return e.view.textDirection==Direction.LTR?{left:e.dom.offsetWidth}:{right:e.dom.offsetWidth}}))});function asArray(e){return Array.isArray(e)?e:[e]}function advanceCursor(e,t,n){while(e.value&&e.from<=n){if(e.from==n)t.push(e.value);e.next()}}var UpdateContext=function(){function e(e,t){this.gutter=e;this.localMarkers=[];this.i=0;this.height=0;this.cursor=RangeSet.iter(e.markers,t.from)}e.prototype.line=function(e,t,n){if(this.localMarkers.length)this.localMarkers=[];advanceCursor(this.cursor,this.localMarkers,t.from);var r=n.length?this.localMarkers.concat(n):this.localMarkers;var i=this.gutter.config.lineMarker(e,t,r);if(i)r.unshift(i);var o=this.gutter;if(r.length==0&&!o.config.renderEmptyElements)return;var a=t.top-this.height;if(this.i==o.elements.length){var s=new GutterElement(e,t.height,a,r);o.elements.push(s);o.dom.appendChild(s.dom)}else{var c=o.elements[this.i];if(sameMarkers(r,c.markers))r=c.markers;c.update(e,t.height,a,r)}this.height=t.bottom;this.i++};e.prototype.finish=function(){var e=this.gutter;while(e.elements.length>this.i)e.dom.removeChild(e.elements.pop().dom)};return e}();var SingleGutterView=function(){function e(e,t){this.view=e;this.config=t;this.elements=[];this.spacer=null;this.dom=document.createElement("div");this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");var n=function(n){r.dom.addEventListener(n,(function(r){var i=e.visualLineAtHeight(r.clientY,e.contentDOM.getBoundingClientRect().top);if(t.domEventHandlers[n](e,i,r))r.preventDefault()}))};var r=this;for(var i in t.domEventHandlers){n(i)}this.markers=asArray(t.markers(e));if(t.initialSpacer){this.spacer=new GutterElement(e,0,0,[t.initialSpacer(e)]);this.dom.appendChild(this.spacer.dom);this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none"}}e.prototype.update=function(e){var t=this.markers;this.markers=asArray(this.config.markers(e.view));if(this.spacer&&this.config.updateSpacer){var n=this.config.updateSpacer(this.spacer.markers[0],e);if(n!=this.spacer.markers[0])this.spacer.update(e.view,0,0,[n])}var r=e.view.viewport;return!RangeSet.eq(this.markers,t,r.from,r.to)};return e}();var GutterElement=function(){function e(e,t,n,r){this.height=-1;this.above=0;this.dom=document.createElement("div");this.update(e,t,n,r)}e.prototype.update=function(e,t,n,r){if(this.height!=t)this.dom.style.height=(this.height=t)+"px";if(this.above!=n)this.dom.style.marginTop=(this.above=n)?n+"px":"";if(this.markers!=r){this.markers=r;for(var i=void 0;i=this.dom.lastChild;)i.remove();var o="cm-gutterElement";for(var a=0,s=r;a<s.length;a++){var c=s[a];if(c.toDOM)this.dom.appendChild(c.toDOM(e));var u=c.elementClass;if(u)o+=" "+u}this.dom.className=o}};return e}();function sameMarkers(e,t){if(e.length!=t.length)return false;for(var n=0;n<e.length;n++)if(!e[n].compare(t[n]))return false;return true}var lineNumberMarkers=Facet.define();var lineNumberConfig=Facet.define({combine:function(e){return combineConfig(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers:function(e,t){var n=Object.assign({},e);var r=function(e){var r=n[e],i=t[e];n[e]=r?function(e,t,n){return r(e,t,n)||i(e,t,n)}:i};for(var i in t){r(i)}return n}})}});var NumberMarker=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.number=t;return n}t.prototype.eq=function(e){return this.number==e.number};t.prototype.toDOM=function(e){return document.createTextNode(this.number)};return t}(GutterMarker);function formatNumber(e,t){return e.state.facet(lineNumberConfig).formatNumber(t,e.state)}var lineNumberGutter=gutter({class:"cm-lineNumbers",markers:function(e){return e.state.facet(lineNumberMarkers)},lineMarker:function(e,t,n){if(n.some((function(e){return e.toDOM})))return null;return new NumberMarker(formatNumber(e,e.state.doc.lineAt(t.from).number))},initialSpacer:function(e){return new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines)))},updateSpacer:function(e,t){var n=formatNumber(t.view,maxLineNumber(t.view.state.doc.lines));return n==e.number?e:new NumberMarker(n)}});function lineNumbers(e){if(e===void 0){e={}}return[lineNumberConfig.of(e),lineNumberGutter]}function maxLineNumber(e){var t=9;while(t<e)t=t*10+9;return t}function mapRange(e,t){var n=t.mapPos(e.from,1),r=t.mapPos(e.to,-1);return n>=r?undefined:{from:n,to:r}}var foldEffect=StateEffect.define({map:mapRange});var unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(e){var t=[];var n=function(n){if(t.some((function(e){return e.from<=n&&e.to>=n})))return"continue";t.push(e.visualLineAt(n))};for(var r=0,i=e.state.selection.ranges;r<i.length;r++){var o=i[r].head;n(o)}return t}var foldState=StateField.define({create:function(){return Decoration.none},update:function(e,t){e=e.map(t.changes);var n=function(t){if(t.is(foldEffect)&&!foldExists(e,t.value.from,t.value.to))e=e.update({add:[foldWidget.range(t.value.from,t.value.to)]});else if(t.is(unfoldEffect))e=e.update({filter:function(e,n){return t.value.from!=e||t.value.to!=n},filterFrom:t.value.from,filterTo:t.value.to})};for(var r=0,i=t.effects;r<i.length;r++){var o=i[r];n(o)}if(t.selection){var a=false,s=t.selection.main.head;e.between(s,s,(function(e,t){if(e<s&&t>s)a=true}));if(a)e=e.update({filterFrom:s,filterTo:s,filter:function(e,t){return t<=s||e>=s}})}return e},provide:function(e){return EditorView.decorations.compute([e],(function(t){return t.field(e)}))}});function foldInside(e,t,n){var r;var i=null;(r=e.field(foldState,false))===null||r===void 0?void 0:r.between(t,n,(function(e,t){if(!i||i.from>e)i={from:e,to:t}}));return i}function foldExists(e,t,n){var r=false;e.between(t,t,(function(e,i){if(e==t&&i==n)r=true}));return r}function maybeEnable(e,t){return e.field(foldState,false)?t:t.concat(StateEffect.appendConfig.of(codeFolding()))}var foldCode=function(e){for(var t=0,n=selectedLines(e);t<n.length;t++){var r=n[t];var i=foldable(e.state,r.from,r.to);if(i){e.dispatch({effects:maybeEnable(e.state,[foldEffect.of(i),announceFold(e,i)])});return true}}return false};var unfoldCode=function(e){if(!e.state.field(foldState,false))return false;var t=[];for(var n=0,r=selectedLines(e);n<r.length;n++){var i=r[n];var o=foldInside(e.state,i.from,i.to);if(o)t.push(unfoldEffect.of(o),announceFold(e,o,false))}if(t.length)e.dispatch({effects:t});return t.length>0};function announceFold(e,t,n){if(n===void 0){n=true}var r=e.state.doc.lineAt(t.from).number,i=e.state.doc.lineAt(t.to).number;return EditorView.announce.of(e.state.phrase(n?"Folded lines":"Unfolded lines")+" "+r+" "+e.state.phrase("to")+" "+i+".")}var foldAll=function(e){var t=e.state,n=[];for(var r=0;r<t.doc.length;){var i=e.visualLineAt(r),o=foldable(t,i.from,i.to);if(o)n.push(foldEffect.of(o));r=(o?e.visualLineAt(o.to):i).to+1}if(n.length)e.dispatch({effects:maybeEnable(e.state,n)});return!!n.length};var unfoldAll=function(e){var t=e.state.field(foldState,false);if(!t||!t.size)return false;var n=[];t.between(0,e.state.doc.length,(function(e,t){n.push(unfoldEffect.of({from:e,to:t}))}));e.dispatch({effects:n});return true};var foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}];var defaultConfig={placeholderDOM:null,placeholderText:"…"};var foldConfig=Facet.define({combine:function(e){return combineConfig(e,defaultConfig)}});function codeFolding(e){var t=[foldState,baseTheme$3];if(e)t.push(foldConfig.of(e));return t}var foldWidget=Decoration.replace({widget:new(function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.ignoreEvents=function(){return false};t.prototype.toDOM=function(e){var t=e.state,n=t.facet(foldConfig);if(n.placeholderDOM)return n.placeholderDOM();var r=document.createElement("span");r.textContent=n.placeholderText;r.setAttribute("aria-label",t.phrase("folded code"));r.title=t.phrase("unfold");r.className="cm-foldPlaceholder";r.onclick=function(t){var n=e.visualLineAt(e.posAtDOM(t.target));var r=foldInside(e.state,n.from,n.to);if(r)e.dispatch({effects:unfoldEffect.of(r)});t.preventDefault()};return r};return t}(WidgetType))});var foldGutterDefaults={openText:"⌄",closedText:"›"};var FoldMarker=function(e){__extends(t,e);function t(t,n){var r=e.call(this)||this;r.config=t;r.open=n;return r}t.prototype.eq=function(e){return this.config==e.config&&this.open==e.open};t.prototype.toDOM=function(e){var t=document.createElement("span");t.textContent=this.open?this.config.openText:this.config.closedText;t.title=e.state.phrase(this.open?"Fold line":"Unfold line");return t};return t}(GutterMarker);function foldGutter(e){if(e===void 0){e={}}var t=Object.assign(Object.assign({},foldGutterDefaults),e);var n=new FoldMarker(t,true),r=new FoldMarker(t,false);var i=ViewPlugin.fromClass(function(){function e(e){this.from=e.viewport.from;this.markers=this.buildMarkers(e)}e.prototype.update=function(e){if(e.docChanged||e.viewportChanged||e.startState.facet(language)!=e.state.facet(language)||e.startState.field(foldState,false)!=e.state.field(foldState,false))this.markers=this.buildMarkers(e.view)};e.prototype.buildMarkers=function(e){var t=new RangeSetBuilder;e.viewportLines((function(i){var o=foldInside(e.state,i.from,i.to)?r:foldable(e.state,i.from,i.to)?n:null;if(o)t.add(i.from,i.from,o)}));return t.finish()};return e}());return[i,gutter({class:"cm-foldGutter",markers:function(e){var t;return((t=e.plugin(i))===null||t===void 0?void 0:t.markers)||RangeSet.empty},initialSpacer:function(){return new FoldMarker(t,false)},domEventHandlers:{click:function(e,t){var n=foldInside(e.state,t.from,t.to);if(n){e.dispatch({effects:unfoldEffect.of(n)});return true}var r=foldable(e.state,t.from,t.to);if(r){e.dispatch({effects:foldEffect.of(r)});return true}return false}}}),codeFolding()]}var baseTheme$3=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter .cm-gutterElement":{padding:"0 1px",cursor:"pointer"}});var nextTagID=0;var Tag=function(){function e(e,t,n){this.set=e;this.base=t;this.modified=n;this.id=nextTagID++}e.define=function(t){if(t===null||t===void 0?void 0:t.base)throw new Error("Can not derive from a modified tag");var n=new e([],null,[]);n.set.push(n);if(t)for(var r=0,i=t.set;r<i.length;r++){var o=i[r];n.set.push(o)}return n};e.defineModifier=function(){var e=new Modifier;return function(t){if(t.modified.indexOf(e)>-1)return t;return Modifier.get(t.base||t,t.modified.concat(e).sort((function(e,t){return e.id-t.id})))}};return e}();var nextModifierID=0;var Modifier=function(){function e(){this.instances=[];this.id=nextModifierID++}e.get=function(t,n){if(!n.length)return t;var r=n[0].instances.find((function(e){return e.base==t&&sameArray(n,e.modified)}));if(r)return r;var i=[],o=new Tag(i,t,n);for(var a=0,s=n;a<s.length;a++){var c=s[a];c.instances.push(o)}var u=permute(n);for(var l=0,f=t.set;l<f.length;l++){var h=f[l];for(var d=0,p=u;d<p.length;d++){var v=p[d];i.push(e.get(h,v))}}return o};return e}();function sameArray(e,t){return e.length==t.length&&e.every((function(e,n){return e==t[n]}))}function permute(e){var t=[e];for(var n=0;n<e.length;n++){for(var r=0,i=permute(e.slice(0,n).concat(e.slice(n+1)));r<i.length;r++){var o=i[r];t.push(o)}}return t}function styleTags(e){var t=Object.create(null);for(var n in e){var r=e[n];if(!Array.isArray(r))r=[r];for(var i=0,o=n.split(" ");i<o.length;i++){var a=o[i];if(a){var s=[],c=2,u=a;for(var l=0;;){if(u=="..."&&l>0&&l+3==a.length){c=1;break}var f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(u);if(!f)throw new RangeError("Invalid path: "+a);s.push(f[0]=="*"?null:f[0][0]=='"'?JSON.parse(f[0]):f[0]);l+=f[0].length;if(l==a.length)break;var h=a[l++];if(l==a.length&&h=="!"){c=0;break}if(h!="/")throw new RangeError("Invalid path: "+a);u=a.slice(l)}var d=s.length-1,p=s[d];if(!p)throw new RangeError("Invalid path: "+a);var v=new Rule(r,c,d>0?s.slice(0,d):null);t[p]=v.sort(t[p])}}}return ruleNodeProp.add(t)}var ruleNodeProp=new NodeProp;var highlightStyle=Facet.define({combine:function(e){return e.length?HighlightStyle.combinedMatch(e):null}});var fallbackHighlightStyle=Facet.define({combine:function(e){return e.length?e[0].match:null}});function getHighlightStyle(e){return e.facet(highlightStyle)||e.facet(fallbackHighlightStyle)}var Rule=function(){function e(e,t,n,r){this.tags=e;this.mode=t;this.context=n;this.next=r}e.prototype.sort=function(e){if(!e||e.depth<this.depth){this.next=e;return this}e.next=this.sort(e.next);return e};Object.defineProperty(e.prototype,"depth",{get:function(){return this.context?this.context.length:0},enumerable:false,configurable:true});return e}();var HighlightStyle=function(){function e(e,t){this.map=Object.create(null);var n;function r(e){var t=StyleModule.newName();(n||(n=Object.create(null)))["."+t]=e;return t}this.all=typeof t.all=="string"?t.all:t.all?r(t.all):null;for(var i=0,o=e;i<o.length;i++){var a=o[i];var s=(a.class||r(Object.assign({},a,{tag:null})))+(this.all?" "+this.all:"");var c=a.tag;if(!Array.isArray(c))this.map[c.id]=s;else for(var u=0,l=c;u<l.length;u++){var f=l[u];this.map[f.id]=s}}this.module=n?new StyleModule(n):null;this.scope=t.scope||null;this.match=this.match.bind(this);var h=[treeHighlighter];if(this.module)h.push(EditorView.styleModule.of(this.module));this.extension=h.concat(highlightStyle.of(this));this.fallback=h.concat(fallbackHighlightStyle.of(this))}e.prototype.match=function(e,t){if(this.scope&&t!=this.scope)return null;for(var n=0,r=e.set;n<r.length;n++){var i=r[n];var o=this.map[i.id];if(o!==undefined){if(i!=e)this.map[e.id]=o;return o}}return this.map[e.id]=this.all};e.combinedMatch=function(e){if(e.length==1)return e[0].match;var t=e.some((function(e){return e.scope}))?undefined:Object.create(null);return function(n,r){var i=t&&t[n.id];if(i!==undefined)return i;var o=null;for(var a=0,s=e;a<s.length;a++){var c=s[a];var u=c.match(n,r);if(u)o=o?o+" "+u:u}if(t)t[n.id]=o;return o}};e.define=function(t,n){return new e(t,n||{})};e.get=function(e,t,n){var r=getHighlightStyle(e);return r&&r(t,n||NodeType.none)};return e}();var TreeHighlighter=function(){function e(e){this.markCache=Object.create(null);this.tree=syntaxTree(e.state);this.decorations=this.buildDeco(e,getHighlightStyle(e.state))}e.prototype.update=function(e){var t=syntaxTree(e.state),n=getHighlightStyle(e.state);var r=n!=e.startState.facet(highlightStyle);if(t.length<e.view.viewport.to&&!r){this.decorations=this.decorations.map(e.changes)}else if(t!=this.tree||e.viewportChanged||r){this.tree=t;this.decorations=this.buildDeco(e.view,n)}};e.prototype.buildDeco=function(e,t){var n=this;if(!t||!this.tree.length)return Decoration.none;var r=new RangeSetBuilder;for(var i=0,o=e.visibleRanges;i<o.length;i++){var a=o[i],s=a.from,c=a.to;highlightTreeRange(this.tree,s,c,t,(function(e,t,i){r.add(e,t,n.markCache[i]||(n.markCache[i]=Decoration.mark({class:i})))}))}return r.finish()};return e}();var treeHighlighter=Prec.fallback(ViewPlugin.fromClass(TreeHighlighter,{decorations:function(e){return e.decorations}}));var nodeStack=[""];function highlightTreeRange(e,t,n,r,i){var o=t,a="";var s=e.topNode.cursor;function c(e,t){if(a)i(o,e,a);o=e;a=t}function u(e,i,o){var l=s.type,f=s.from,h=s.to;if(f>=n||h<=t)return;nodeStack[i]=l.name;if(l.isTop)o=l;var d=e;var p=l.prop(ruleNodeProp),v=false;while(p){if(!p.context||matchContext(p.context,nodeStack,i)){for(var m=0,g=p.tags;m<g.length;m++){var y=g[m];var b=r(y,o);if(b){if(d)d+=" ";d+=b;if(p.mode==1)e+=(e?" ":"")+b;else if(p.mode==0)v=true}}break}p=p.next}var w=f;if(!v&&s.firstChild()){do{if(s.from>w&&a!=d)c(w,d);w=s.to;u(e,i+1,o)}while(s.nextSibling());s.parent()}if(h>w&&a!=d)c(w,d)}u("",0,e.type);c(n,"")}function matchContext(e,t,n){if(e.length>n-1)return false;for(var r=n-1,i=e.length-1;i>=0;i--,r--){var o=e[i];if(o&&o!=t[r])return false}return true}var t=Tag.define;var comment=t(),name=t(),typeName=t(name),literal=t(),string=t(literal),number$1=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t();var tags={comment:comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name:name,variableName:t(name),typeName:typeName,tagName:t(typeName),propertyName:t(name),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal:literal,string:string,docString:t(string),character:t(string),number:number$1,integer:t(number$1),float:t(number$1),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword:keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),operator:operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation:punctuation,separator:t(punctuation),bracket:bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content:content,heading:heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta:meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier(),constant:Tag.defineModifier(),function:Tag.defineModifier(),standard:Tag.defineModifier(),local:Tag.defineModifier(),special:Tag.defineModifier()};var defaultHighlightStyle=HighlightStyle.define([{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.keyword,color:"#708"},{tag:[tags.atom,tags.bool,tags.url,tags.contentSeparator,tags.labelName],color:"#219"},{tag:[tags.literal,tags.inserted],color:"#164"},{tag:[tags.string,tags.deleted],color:"#a11"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],color:"#e40"},{tag:tags.definition(tags.variableName),color:"#00f"},{tag:tags.local(tags.variableName),color:"#30a"},{tag:[tags.typeName,tags.namespace],color:"#085"},{tag:tags.className,color:"#167"},{tag:[tags.special(tags.variableName),tags.macroName],color:"#256"},{tag:tags.definition(tags.propertyName),color:"#00c"},{tag:tags.comment,color:"#940"},{tag:tags.meta,color:"#7a757a"},{tag:tags.invalid,color:"#f00"}]);var fromHistory=Annotation.define();var isolateHistory=Annotation.define();var invertedEffects=Facet.define();var historyConfig=Facet.define({combine:function(e){return combineConfig(e,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});var historyField_=StateField.define({create:function(){return HistoryState.empty},update:function(e,t){var n=t.state.facet(historyConfig);var r=t.annotation(fromHistory);if(r){var i=HistEvent.fromTransaction(t),o=r.side;var a=o==0?e.undone:e.done;if(i)a=updateBranch(a,a.length,n.minDepth,i);else a=addSelection(a,t.startState.selection);return new HistoryState(o==0?r.rest:a,o==0?a:r.rest)}var s=t.annotation(isolateHistory);if(s=="full"||s=="before")e=e.isolate();if(t.annotation(Transaction.addToHistory)===false)return!t.changes.empty?e.addMapping(t.changes.desc):e;var c=HistEvent.fromTransaction(t);var u=t.annotation(Transaction.time),l=t.annotation(Transaction.userEvent);if(c)e=e.addChanges(c,u,l,n.newGroupDelay,n.minDepth);else if(t.selection)e=e.addSelection(t.startState.selection,u,l,n.newGroupDelay);if(s=="full"||s=="after")e=e.isolate();return e},toJSON:function(e){return{done:e.done.map((function(e){return e.toJSON()})),undone:e.undone.map((function(e){return e.toJSON()}))}},fromJSON:function(e){return new HistoryState(e.done.map(HistEvent.fromJSON),e.undone.map(HistEvent.fromJSON))}});function history(e){if(e===void 0){e={}}return[historyField_,historyConfig.of(e),EditorView.domEventHandlers({beforeinput:function(e,t){if(e.inputType=="historyUndo")return undo(t);if(e.inputType=="historyRedo")return redo(t);return false}})]}function cmd(e,t){return function(n){var r=n.state,i=n.dispatch;var o=r.field(historyField_,false);if(!o)return false;var a=o.pop(e,r,t);if(!a)return false;i(a);return true}}var undo=cmd(0,false);var redo=cmd(1,false);var undoSelection=cmd(0,true);var redoSelection=cmd(1,true);var HistEvent=function(){function e(e,t,n,r,i){this.changes=e;this.effects=t;this.mapped=n;this.startSelection=r;this.selectionsAfter=i}e.prototype.setSelAfter=function(t){return new e(this.changes,this.effects,this.mapped,this.startSelection,t)};e.prototype.toJSON=function(){var e,t,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map((function(e){return e.toJSON()}))}};e.fromJSON=function(t){return new e(t.changes&&ChangeSet.fromJSON(t.changes),[],t.mapped&&ChangeDesc.fromJSON(t.mapped),t.startSelection&&EditorSelection.fromJSON(t.startSelection),t.selectionsAfter.map(EditorSelection.fromJSON))};e.fromTransaction=function(t){var n=none;for(var r=0,i=t.startState.facet(invertedEffects);r<i.length;r++){var o=i[r];var a=o(t);if(a.length)n=n.concat(a)}if(!n.length&&t.changes.empty)return null;return new e(t.changes.invert(t.startState.doc),n,undefined,t.startState.selection,none)};e.selection=function(t){return new e(undefined,none,undefined,undefined,t)};return e}();function updateBranch(e,t,n,r){var i=t+1>n+20?t-n-1:0;var o=e.slice(i,t);o.push(r);return o}function isAdjacent(e,t){var n=[],r=false;e.iterChangedRanges((function(e,t){return n.push(e,t)}));t.iterChangedRanges((function(e,t,i,o){for(var a=0;a<n.length;){var s=n[a++],c=n[a++];if(o>=s&&i<=c)r=true}}));return r}function eqSelectionShape(e,t){return e.ranges.length==t.ranges.length&&e.ranges.filter((function(e,n){return e.empty!=t.ranges[n].empty})).length===0}function conc(e,t){return!e.length?t:!t.length?e:e.concat(t)}var none=[];var MaxSelectionsPerEvent=200;function addSelection(e,t){if(!e.length){return[HistEvent.selection([t])]}else{var n=e[e.length-1];var r=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-MaxSelectionsPerEvent));if(r.length&&r[r.length-1].eq(t))return e;r.push(t);return updateBranch(e,e.length-1,1e9,n.setSelAfter(r))}}function popSelection(e){var t=e[e.length-1];var n=e.slice();n[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1));return n}function addMappingToBranch(e,t){if(!e.length)return e;var n=e.length,r=none;while(n){var i=mapEvent(e[n-1],t,r);if(i.changes&&!i.changes.empty||i.effects.length){var o=e.slice(0,n);o[n-1]=i;return o}else{t=i.mapped;n--;r=i.selectionsAfter}}return r.length?[HistEvent.selection(r)]:none}function mapEvent(e,t,n){var r=conc(e.selectionsAfter.length?e.selectionsAfter.map((function(e){return e.map(t)})):none,n);if(!e.changes)return HistEvent.selection(r);var i=e.changes.map(t),o=t.mapDesc(e.changes,true);var a=e.mapped?e.mapped.composeDesc(o):o;return new HistEvent(i,StateEffect.mapEffects(e.effects,t),a,e.startSelection.map(o),r)}var HistoryState=function(){function e(e,t,n,r){if(n===void 0){n=0}if(r===void 0){r=undefined}this.done=e;this.undone=t;this.prevTime=n;this.prevUserEvent=r}e.prototype.isolate=function(){return this.prevTime?new e(this.done,this.undone):this};e.prototype.addChanges=function(t,n,r,i,o){var a=this.done,s=a[a.length-1];if(s&&s.changes&&n-this.prevTime<i&&!s.selectionsAfter.length&&!s.changes.empty&&t.changes&&isAdjacent(s.changes,t.changes)){a=updateBranch(a,a.length-1,o,new HistEvent(t.changes.compose(s.changes),conc(t.effects,s.effects),s.mapped,s.startSelection,none))}else{a=updateBranch(a,a.length,o,t)}return new e(a,none,n,r)};e.prototype.addSelection=function(t,n,r,i){var o=this.done.length?this.done[this.done.length-1].selectionsAfter:none;if(o.length>0&&n-this.prevTime<i&&r=="keyboardselection"&&this.prevUserEvent==r&&eqSelectionShape(o[o.length-1],t))return this;return new e(addSelection(this.done,t),this.undone,n,r)};e.prototype.addMapping=function(t){return new e(addMappingToBranch(this.done,t),addMappingToBranch(this.undone,t),this.prevTime,this.prevUserEvent)};e.prototype.pop=function(e,t,n){var r=e==0?this.done:this.undone;if(r.length==0)return null;var i=r[r.length-1];if(n&&i.selectionsAfter.length){return t.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(r)})})}else if(!i.changes){return null}else{var o=r.length==1?none:r.slice(0,r.length-1);if(i.mapped)o=addMappingToBranch(o,i.mapped);return t.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:fromHistory.of({side:e,rest:o}),filter:false})}};return e}();HistoryState.empty=new HistoryState(none,none);var historyKeymap=[{key:"Mod-z",run:undo,preventDefault:true},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:true},{key:"Mod-u",run:undoSelection,preventDefault:true},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:true}];var panelConfig=Facet.define({combine:function(e){var t,n;for(var r=0,i=e;r<i.length;r++){var o=i[r];t=t||o.topContainer;n=n||o.bottomContainer}return{topContainer:t,bottomContainer:n}}});function getPanel(e,t){var n=e.plugin(panelPlugin);var r=n?n.specs.indexOf(t):-1;return r>-1?n.panels[r]:null}var panelPlugin=ViewPlugin.fromClass(function(){function e(e){this.input=e.state.facet(showPanel);this.specs=this.input.filter((function(e){return e}));this.panels=this.specs.map((function(t){return t(e)}));var t=e.state.facet(panelConfig);this.top=new PanelGroup(e,true,t.topContainer);this.bottom=new PanelGroup(e,false,t.bottomContainer);this.top.sync(this.panels.filter((function(e){return e.top})));this.bottom.sync(this.panels.filter((function(e){return!e.top})));for(var n=0,r=this.panels;n<r.length;n++){var i=r[n];i.dom.classList.add("cm-panel");if(i.class)i.dom.classList.add(i.class);if(i.mount)i.mount()}}e.prototype.update=function(e){var t=e.state.facet(panelConfig);if(this.top.container!=t.topContainer){this.top.sync([]);this.top=new PanelGroup(e.view,true,t.topContainer)}if(this.bottom.container!=t.bottomContainer){this.bottom.sync([]);this.bottom=new PanelGroup(e.view,false,t.bottomContainer)}this.top.syncClasses();this.bottom.syncClasses();var n=e.state.facet(showPanel);if(n!=this.input){var r=n.filter((function(e){return e}));var i=[],o=[],a=[],s=[];for(var c=0,u=r;c<u.length;c++){var l=u[c];var f=this.specs.indexOf(l),h=void 0;if(f<0){h=l(e.view);s.push(h)}else{h=this.panels[f];if(h.update)h.update(e)}i.push(h);(h.top?o:a).push(h)}this.specs=r;this.panels=i;this.top.sync(o);this.bottom.sync(a);for(var d=0,p=s;d<p.length;d++){var v=p[d];v.dom.classList.add("cm-panel");if(v.class)v.dom.classList.add(v.class);if(v.mount)v.mount()}}else{for(var m=0,g=this.panels;m<g.length;m++){var v=g[m];if(v.update)v.update(e)}}};e.prototype.destroy=function(){this.top.sync([]);this.bottom.sync([])};return e}(),{provide:PluginField.scrollMargins.from((function(e){return{top:e.top.scrollMargin(),bottom:e.bottom.scrollMargin()}}))});var PanelGroup=function(){function e(e,t,n){this.view=e;this.top=t;this.container=n;this.dom=undefined;this.classes="";this.panels=[];this.syncClasses()}e.prototype.sync=function(e){this.panels=e;this.syncDOM()};e.prototype.syncDOM=function(){if(this.panels.length==0){if(this.dom){this.dom.remove();this.dom=undefined}return}if(!this.dom){this.dom=document.createElement("div");this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom";this.dom.style[this.top?"top":"bottom"]="0";var e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}var t=this.dom.firstChild;for(var n=0,r=this.panels;n<r.length;n++){var i=r[n];if(i.dom.parentNode==this.dom){while(t!=i.dom)t=rm(t);t=t.nextSibling}else{this.dom.insertBefore(i.dom,t)}}while(t)t=rm(t)};e.prototype.scrollMargin=function(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)};e.prototype.syncClasses=function(){if(!this.container||this.classes==this.view.themeClasses)return;for(var e=0,t=this.classes.split(" ");e<t.length;e++){var n=t[e];if(n)this.container.classList.remove(n)}for(var r=0,i=(this.classes=this.view.themeClasses).split(" ");r<i.length;r++){var n=i[r];if(n)this.container.classList.add(n)}};return e}();function rm(e){var t=e.nextSibling;e.remove();return t}var baseTheme$2=EditorView.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}});var showPanel=Facet.define({enables:[panelPlugin,baseTheme$2]});function crelt(){var e=arguments[0];if(typeof e=="string")e=document.createElement(e);var t=1,n=arguments[1];if(n&&typeof n=="object"&&n.nodeType==null&&!Array.isArray(n)){for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=n[r];if(typeof i=="string")e.setAttribute(r,i);else if(i!=null)e[r]=i}t++}for(;t<arguments.length;t++)add(e,arguments[t]);return e}function add(e,t){if(typeof t=="string"){e.appendChild(document.createTextNode(t))}else if(t==null);else if(t.nodeType!=null){e.appendChild(t)}else if(Array.isArray(t)){for(var n=0;n<t.length;n++)add(e,t[n])}else{throw new RangeError("Unsupported child node: "+t)}}var basicNormalize=typeof String.prototype.normalize=="function"?function(e){return e.normalize("NFKD")}:function(e){return e};var SearchCursor=function(){function e(e,t,n,r,i){if(n===void 0){n=0}if(r===void 0){r=e.length}this.value={from:0,to:0};this.done=false;this.matches=[];this.buffer="";this.bufferPos=0;this.iter=e.iterRange(n,r);this.bufferStart=n;this.normalize=i?function(e){return i(basicNormalize(e))}:basicNormalize;this.query=this.normalize(t)}e.prototype.peek=function(){if(this.bufferPos==this.buffer.length){this.bufferStart+=this.buffer.length;this.iter.next();if(this.iter.done)return-1;this.bufferPos=0;this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)};e.prototype.next=function(){while(this.matches.length)this.matches.pop();return this.nextOverlapping()};e.prototype.nextOverlapping=function(){for(;;){var e=this.peek();if(e<0){this.done=true;return this}var t=fromCodePoint(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(e);var r=this.normalize(t);for(var i=0,o=n;;i++){var a=r.charCodeAt(i);var s=this.match(a,o);if(s){this.value=s;return this}if(i==r.length-1)break;if(o==n&&i<t.length&&t.charCodeAt(i)==a)o++}}};e.prototype.match=function(e,t){var n=null;for(var r=0;r<this.matches.length;r+=2){var i=this.matches[r],o=false;if(this.query.charCodeAt(i)==e){if(i==this.query.length-1){n={from:this.matches[r+1],to:t+1}}else{this.matches[r]++;o=true}}if(!o){this.matches.splice(r,2);r-=2}}if(this.query.charCodeAt(0)==e){if(this.query.length==1)n={from:t,to:t+1};else this.matches.push(1,t)}return n};return e}();var empty={from:-1,to:-1,match:/.*/.exec("")};var baseFlags="gm"+(/x/.unicode==null?"":"u");var RegExpCursor=function(){function e(e,t,n,r,i){if(r===void 0){r=0}if(i===void 0){i=e.length}this.to=i;this.curLine="";this.done=false;this.value=empty;if(/\\[sWDnr]|\n|\r|\[\^/.test(t))return new MultilineRegExpCursor(e,t,n,r,i);this.re=new RegExp(t,baseFlags+((n===null||n===void 0?void 0:n.ignoreCase)?"i":""));this.iter=e.iter();var o=e.lineAt(r);this.curLineStart=o.from;this.matchPos=r;this.getLine(this.curLineStart)}e.prototype.getLine=function(e){this.iter.next(e);if(this.iter.lineBreak){this.curLine=""}else{this.curLine=this.iter.value;if(this.curLineStart+this.curLine.length>this.to)this.curLine=this.curLine.slice(0,this.to-this.curLineStart);this.iter.next()}};e.prototype.nextLine=function(){this.curLineStart=this.curLineStart+this.curLine.length+1;if(this.curLineStart>this.to)this.curLine="";else this.getLine(0)};e.prototype.next=function(){for(var e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;var t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){var n=this.curLineStart+t.index,r=n+t[0].length;this.matchPos=r+(n==r?1:0);if(n==this.curLine.length)this.nextLine();if(n<r||n>this.value.to){this.value={from:n,to:r,match:t};return this}e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to){this.nextLine();e=0}else{this.done=true;return this}}};return e}();var flattened=new WeakMap;var FlattenedDoc=function(){function e(e,t){this.from=e;this.text=t}Object.defineProperty(e.prototype,"to",{get:function(){return this.from+this.text.length},enumerable:false,configurable:true});e.get=function(t,n,r){var i=flattened.get(t);if(!i||i.from>=r||i.to<=n){var o=new e(n,t.sliceString(n,r));flattened.set(t,o);return o}if(i.from==n&&i.to==r)return i;var a=i.text,s=i.from;if(s>n){a=t.sliceString(n,s)+a;s=n}if(i.to<r)a+=t.sliceString(i.to,r);flattened.set(t,new e(s,a));return new e(n,a.slice(n-s,r-s))};return e}();var MultilineRegExpCursor=function(){function e(e,t,n,r,i){this.text=e;this.to=i;this.done=false;this.value=empty;this.matchPos=r;this.re=new RegExp(t,baseFlags+((n===null||n===void 0?void 0:n.ignoreCase)?"i":""));this.flat=FlattenedDoc.get(e,r,this.chunkEnd(r+5e3))}e.prototype.chunkEnd=function(e){return e>=this.to?this.to:this.text.lineAt(e).to};e.prototype.next=function(){for(;;){var e=this.re.lastIndex=this.matchPos-this.flat.from;var t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e){this.re.lastIndex=e+1;t=this.re.exec(this.flat.text)}if(t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10)t=null;if(t){var n=this.flat.from+t.index,r=n+t[0].length;this.value={from:n,to:r,match:t};this.matchPos=r+(n==r?1:0);return this}else{if(this.flat.to==this.to){this.done=true;return this}this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};return e}();function validRegExp(e){try{return true}catch(t){return false}}function createLineDialog(e){var t=crelt("input",{class:"cm-textfield",name:"line"});var n=crelt("form",{class:"cm-gotoLine",onkeydown:function(t){if(t.keyCode==27){t.preventDefault();e.dispatch({effects:dialogEffect.of(false)});e.focus()}else if(t.keyCode==13){t.preventDefault();r()}},onsubmit:function(e){e.preventDefault();r()}},crelt("label",e.state.phrase("Go to line"),": ",t)," ",crelt("button",{class:"cm-button",type:"submit"},e.state.phrase("go")));function r(){var n=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!n)return;var r=e.state,i=r.doc.lineAt(r.selection.main.head);var o=n[1],a=n[2],s=n[3],c=n[4];var u=s?+s.slice(1):0;var l=a?+a:i.number;if(a&&c){var f=l/100;if(o)f=f*(o=="-"?-1:1)+i.number/r.doc.lines;l=Math.round(r.doc.lines*f)}else if(a&&o){l=l*(o=="-"?-1:1)+i.number}var h=r.doc.line(Math.max(1,Math.min(r.doc.lines,l)));e.dispatch({effects:dialogEffect.of(false),selection:EditorSelection.cursor(h.from+Math.max(0,Math.min(u,h.length))),scrollIntoView:true});e.focus()}return{dom:n,pos:-10}}var dialogEffect=StateEffect.define();var dialogField=StateField.define({create:function(){return true},update:function(e,t){for(var n=0,r=t.effects;n<r.length;n++){var i=r[n];if(i.is(dialogEffect))e=i.value}return e},provide:function(e){return showPanel.from(e,(function(e){return e?createLineDialog:null}))}});var gotoLine=function(e){var t=getPanel(e,createLineDialog);if(!t){var n=[dialogEffect.of(true)];if(e.state.field(dialogField,false)==null)n.push(StateEffect.appendConfig.of([dialogField,baseTheme$1]));e.dispatch({effects:n});t=getPanel(e,createLineDialog)}if(t)t.dom.querySelector("input").focus();return true};var baseTheme$1=EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}});var selectWord=function(e){var t=e.state,n=e.dispatch;var r=t.selection;var i=EditorSelection.create(r.ranges.map((function(e){return t.wordAt(e.head)||EditorSelection.cursor(e.head)})),r.mainIndex);if(i.eq(r))return false;n(t.update({selection:i}));return true};function findNextOccurrence(e,t){var n=e.selection.ranges;var r=new SearchCursor(e.doc,t,n[n.length-1].to).next();if(!r.done)return r.value;var i=new SearchCursor(e.doc,t,0,Math.max(0,n[n.length-1].from-1));while(!i.next().done){if(!n.some((function(e){return e.from===i.value.from})))return i.value}return null}var selectNextOccurrence=function(e){var t=e.state,n=e.dispatch;var r=t.selection.ranges;if(r.some((function(e){return e.from===e.to})))return selectWord({state:t,dispatch:n});var i=t.sliceDoc(r[0].from,r[0].to);if(t.selection.ranges.some((function(e){return t.sliceDoc(e.from,e.to)!=i})))return false;var o=findNextOccurrence(t,i);if(!o)return false;n(t.update({selection:t.selection.addRange(EditorSelection.range(o.from,o.to)),scrollIntoView:true}));return true};var searchConfigFacet=Facet.define({combine:function(e){return{top:e.some((function(e){return e.top}))}}});function searchConfig(e){return searchConfigFacet.of(e)}var Query=function(){function e(e,t,n){this.search=e;this.replace=t;this.caseInsensitive=n}e.prototype.eq=function(e){return this.search==e.search&&this.replace==e.replace&&this.caseInsensitive==e.caseInsensitive&&this.constructor==e.constructor};return e}();var StringQuery=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this,t,n,r)||this;i.unquoted=t.replace(/\\([nrt\\])/g,(function(e,t){return t=="n"?"\n":t=="r"?"\r":t=="t"?"\t":"\\"}));return i}t.prototype.cursor=function(e,t,n){if(t===void 0){t=0}if(n===void 0){n=e.length}return new SearchCursor(e,this.unquoted,t,n,this.caseInsensitive?function(e){return e.toLowerCase()}:undefined)};t.prototype.nextMatch=function(e,t,n){var r=this.cursor(e,n).nextOverlapping();if(r.done)r=this.cursor(e,0,t).nextOverlapping();return r.done?null:r.value};t.prototype.prevMatchInRange=function(e,t,n){for(var r=n;;){var i=Math.max(t,r-1e4-this.unquoted.length);var o=this.cursor(e,i,r),a=null;while(!o.nextOverlapping().done)a=o.value;if(a)return a;if(i==t)return null;r-=1e4}};t.prototype.prevMatch=function(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.length)};t.prototype.getReplacement=function(e){return this.replace};t.prototype.matchAll=function(e,t){var n=this.cursor(e),r=[];while(!n.next().done){if(r.length>=t)return null;r.push(n.value)}return r};t.prototype.highlight=function(e,t,n,r){var i=this.cursor(e,Math.max(0,t-this.unquoted.length),Math.min(n+this.unquoted.length,e.length));while(!i.next().done)r(i.value.from,i.value.to)};Object.defineProperty(t.prototype,"valid",{get:function(){return!!this.search},enumerable:false,configurable:true});return t}(Query);var RegExpQuery=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this,t,n,r)||this;i.valid=!!t&&validRegExp();return i}t.prototype.cursor=function(e,t,n){if(t===void 0){t=0}if(n===void 0){n=e.length}return new RegExpCursor(e,this.search,this.caseInsensitive?{ignoreCase:true}:undefined,t,n)};t.prototype.nextMatch=function(e,t,n){var r=this.cursor(e,n).next();if(r.done)r=this.cursor(e,0,t).next();return r.done?null:r.value};t.prototype.prevMatchInRange=function(e,t,n){for(var r=1;;r++){var i=Math.max(t,n-r*1e4);var o=this.cursor(e,i,n),a=null;while(!o.next().done)a=o.value;if(a&&(i==t||a.from>i+10))return a;if(i==t)return null}};t.prototype.prevMatch=function(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.length)};t.prototype.getReplacement=function(e){return this.replace.replace(/\$([$&\d+])/g,(function(t,n){return n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:t}))};t.prototype.matchAll=function(e,t){var n=this.cursor(e),r=[];while(!n.next().done){if(r.length>=t)return null;r.push(n.value)}return r};t.prototype.highlight=function(e,t,n,r){var i=this.cursor(e,Math.max(0,t-250),Math.min(n+250,e.length));while(!i.next().done)r(i.value.from,i.value.to)};return t}(Query);var setQuery=StateEffect.define();var togglePanel=StateEffect.define();var searchState=StateField.define({create:function(e){return new SearchState(defaultQuery(e),createSearchPanel)},update:function(e,t){for(var n=0,r=t.effects;n<r.length;n++){var i=r[n];if(i.is(setQuery))e=new SearchState(i.value,e.panel);else if(i.is(togglePanel))e=new SearchState(e.query,i.value?createSearchPanel:null)}return e},provide:function(e){return showPanel.from(e,(function(e){return e.panel}))}});var SearchState=function(){function e(e,t){this.query=e;this.panel=t}return e}();var matchMark=Decoration.mark({class:"cm-searchMatch"}),selectedMatchMark=Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"});var searchHighlighter=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.decorations=this.highlight(e.state.field(searchState))}e.prototype.update=function(e){var t=e.state.field(searchState);if(t!=e.startState.field(searchState)||e.docChanged||e.selectionSet)this.decorations=this.highlight(t)};e.prototype.highlight=function(e){var t=e.query,n=e.panel;if(!n||!t.valid)return Decoration.none;var r=this.view;var i=new RangeSetBuilder;for(var o=0,a=r.visibleRanges,s=a.length;o<s;o++){var c=a[o],u=c.from,l=c.to;while(o<s-1&&l>a[o+1].from-2*250)l=a[++o].to;t.highlight(r.state.doc,u,l,(function(e,t){var n=r.state.selection.ranges.some((function(n){return n.from==e&&n.to==t}));i.add(e,t,n?selectedMatchMark:matchMark)}))}return i.finish()};return e}(),{decorations:function(e){return e.decorations}});function searchCommand(e){return function(t){var n=t.state.field(searchState,false);return n&&n.query.valid?e(t,n):openSearchPanel(t)}}var findNext=searchCommand((function(e,t){var n=t.query;var r=e.state.selection.main,i=r.from,o=r.to;var a=n.nextMatch(e.state.doc,i,o);if(!a||a.from==i&&a.to==o)return false;e.dispatch({selection:{anchor:a.from,head:a.to},scrollIntoView:true,effects:announceMatch(e,a)});return true}));var findPrevious=searchCommand((function(e,t){var n=t.query;var r=e.state,i=r.selection.main,o=i.from,a=i.to;var s=n.prevMatch(r.doc,o,a);if(!s)return false;e.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:true,effects:announceMatch(e,s)});return true}));var selectMatches=searchCommand((function(e,t){var n=t.query;var r=n.matchAll(e.state.doc,1e3);if(!r||!r.length)return false;e.dispatch({selection:EditorSelection.create(r.map((function(e){return EditorSelection.range(e.from,e.to)})))});return true}));var selectSelectionMatches=function(e){var t=e.state,n=e.dispatch;var r=t.selection;if(r.ranges.length>1||r.main.empty)return false;var i=r.main,o=i.from,a=i.to;var s=[],c=0;for(var u=new SearchCursor(t.doc,t.sliceDoc(o,a));!u.next().done;){if(s.length>1e3)return false;if(u.value.from==o)c=s.length;s.push(EditorSelection.range(u.value.from,u.value.to))}n(t.update({selection:EditorSelection.create(s,c)}));return true};var replaceNext=searchCommand((function(e,t){var n=t.query;var r=e.state,i=r.selection.main,o=i.from,a=i.to;var s=n.nextMatch(r.doc,o,o);if(!s)return false;var c=[],u,l;if(s.from==o&&s.to==a){l=r.toText(n.getReplacement(s));c.push({from:s.from,to:s.to,insert:l});s=n.nextMatch(r.doc,s.from,s.to)}if(s){var f=c.length==0||c[0].from>=s.to?0:s.to-s.from-l.length;u={anchor:s.from-f,head:s.to-f}}e.dispatch({changes:c,selection:u,scrollIntoView:!!u,effects:s?announceMatch(e,s):undefined});return true}));var replaceAll=searchCommand((function(e,t){var n=t.query;var r=n.matchAll(e.state.doc,1e9).map((function(e){var t=e.from,r=e.to;return{from:t,to:r,insert:n.getReplacement(e)}}));if(!r.length)return false;e.dispatch({changes:r});return true}));function createSearchPanel(e){var t=e.state.field(searchState).query;return{dom:buildPanel({view:e,query:t,updateQuery:function(n){if(!t.eq(n)){t=n;e.dispatch({effects:setQuery.of(t)})}}}),mount:function(){this.dom.querySelector("[name=search]").select()},pos:80,top:e.state.facet(searchConfigFacet).top}}function defaultQuery(e,t){var n=e.selection.main;var r=n.empty||n.to>n.from+100?"":e.sliceDoc(n.from,n.to);return t&&!r?t:new StringQuery(r.replace(/\n/g,"\\n"),"",(t===null||t===void 0?void 0:t.caseInsensitive)||false)}var openSearchPanel=function(e){var t=e.state.field(searchState,false);if(t&&t.panel){var n=getPanel(e,createSearchPanel);if(!n)return false;n.dom.querySelector("[name=search]").focus()}else{e.dispatch({effects:[togglePanel.of(true),t?setQuery.of(defaultQuery(e.state,t.query)):StateEffect.appendConfig.of(searchExtensions)]})}return true};var closeSearchPanel=function(e){var t=e.state.field(searchState,false);if(!t||!t.panel)return false;var n=getPanel(e,createSearchPanel);if(n&&n.dom.contains(e.root.activeElement))e.focus();e.dispatch({effects:togglePanel.of(false)});return true};var searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel"},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel"},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence}];function buildPanel(e){function t(t){return e.view.state.phrase(t)}var n=crelt("input",{value:e.query.search,placeholder:t("Find"),"aria-label":t("Find"),class:"cm-textfield",name:"search",onchange:a,onkeyup:a});var r=crelt("input",{value:e.query.replace,placeholder:t("Replace"),"aria-label":t("Replace"),class:"cm-textfield",name:"replace",onchange:a,onkeyup:a});var i=crelt("input",{type:"checkbox",name:"case",checked:!e.query.caseInsensitive,onchange:a});var o=crelt("input",{type:"checkbox",name:"re",checked:e.query instanceof RegExpQuery,onchange:a});function a(){e.updateQuery(new(o.checked?RegExpQuery:StringQuery)(n.value,r.value,!i.checked))}function s(t){if(runScopeHandlers(e.view,t,"search-panel")){t.preventDefault()}else if(t.keyCode==13&&t.target==n){t.preventDefault();(t.shiftKey?findPrevious:findNext)(e.view)}else if(t.keyCode==13&&t.target==r){t.preventDefault();replaceNext(e.view)}}function c(e,t,n){return crelt("button",{class:"cm-button",name:e,onclick:t},n)}var u=crelt("div",{onkeydown:s,class:"cm-search"},[n,c("next",(function(){return findNext(e.view)}),[t("next")]),c("prev",(function(){return findPrevious(e.view)}),[t("previous")]),c("select",(function(){return selectMatches(e.view)}),[t("all")]),crelt("label",null,[i,t("match case")]),crelt("label",null,[o,t("regexp")]),crelt("br"),r,c("replace",(function(){return replaceNext(e.view)}),[t("replace")]),c("replaceAll",(function(){return replaceAll(e.view)}),[t("replace all")]),crelt("button",{name:"close",onclick:function(){return closeSearchPanel(e.view)},"aria-label":t("close")},["×"])]);return u}var AnnounceMargin=30;var Break=/[\s\.,:;?!]/;function announceMatch(e,t){var n=t.from,r=t.to;var i=e.state.doc.lineAt(n).from,o=e.state.doc.lineAt(r).to;var a=Math.max(i,n-AnnounceMargin),s=Math.min(o,r+AnnounceMargin);var c=e.state.sliceDoc(a,s);if(a!=i){for(var u=0;u<AnnounceMargin;u++)if(!Break.test(c[u+1])&&Break.test(c[u])){c=c.slice(u);break}}if(s!=o){for(var l=c.length-1;l>c.length-AnnounceMargin;l--)if(!Break.test(c[l-1])&&Break.test(c[l])){c=c.slice(0,l);break}}return EditorView.announce.of(e.state.phrase("current match")+". "+c+" "+e.state.phrase("on line")+" "+e.state.doc.lineAt(n).number)}var baseTheme=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}});var searchExtensions=[searchState,Prec.override(searchHighlighter),baseTheme];var languageAliases={Bash:["bash","shell","sh"],Dockerfile:["dockerfile"],HTML:["html"],JavaScript:["javascript","js"],JSON:["json"],LaTeX:["latex","stex","tex"],Markdown:["markdown","md"],"Plain Text":["txt"],Python:["python","py"],R:["r"],RMD:["rmd"],TOML:["toml"],XML:["xml"],YAML:["yaml"]};var defaultLanguageCapabilities=Object.keys(languageAliases);var languageByAlias=function(e){var t;var n=e.toLowerCase();var r=((t=Object.entries(languageAliases).find((function(e){var t=e[0],r=e[1];return r.includes(n)})))!==null&&t!==void 0?t:[])[0];return r!==null&&r!==void 0?r:"Plain Text"};var LanguagePicker=function(e){var t=languageByAlias(e.activeLanguage);return h("label",{"aria-label":"Programming Language"},h("stencila-icon",{icon:"terminal"}),h("select",{onChange:e.onSetLanguage},e.languageCapabilities.map((function(e){return h("option",{value:e.toLowerCase(),selected:languageByAlias(e)===t},e)}))))};var updateErrors=StateEffect.define();var renderErrors=function(e){if(e===void 0){e=[]}return e.map((function(e){if(typeof e==="string"){return'<stencila-code-error kind="warning">'+e+"</stencila-code-error>"}return"<stencila-code-error kind="+e.errorType+' has-stacktrace="'+(e.stackTrace!==undefined)+'">'+e.errorMessage+'<pre slot="stacktrace">'+e.stackTrace+"</pre></stencila-code-error>"})).join("\n")};var errorPanel=function(){var e=document.createElement("div");e.innerHTML=renderErrors();return{dom:e,update:function(t){for(var n=0,r=t.transactions;n<r.length;n++){var i=r[n];for(var o=0,a=i.effects;o<a.length;o++){var s=a[o];if(s.is(updateErrors)){e.innerHTML=renderErrors(s.value)}}}}}};var codeErrors=function(){return showPanel.of(errorPanel)};var defaultEditorCss="*.sc-stencila-editor-default,.sc-stencila-editor-default:after,.sc-stencila-editor-default:before{border:0 solid;-webkit-box-sizing:border-box;box-sizing:border-box}html.sc-stencila-editor-default{font-size:16px}.hidden.sc-stencila-editor-default{display:none}.sc-stencila-editor-default-h,stencila-editor.sc-stencila-editor-default{--gutter-background:var(\n    --color-background,var(--color-neutral-50,#e9eaf1)\n  );--gutter-color:var(--color-neutral-500,#6e7591);all:initial}.sc-stencila-editor-default-h,stencila-editor.sc-stencila-editor-default{display:-ms-flexbox;display:flex;max-width:100%}.sc-stencila-editor-default-h,stencila-editor.sc-stencila-editor-default{--border-width:1px;--background-color:transparent}.sc-stencila-editor-default-h .editorContainer.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default .editorContainer.sc-stencila-editor-default{background-color:var(--background-color);border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-radius:.25rem;border-width:1px;border-width:var(--border-width);display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;max-width:100%}.sc-stencila-editor-default-h .editorContainer.sc-stencila-editor-default:focus-within,stencila-editor.sc-stencila-editor-default .editorContainer.sc-stencila-editor-default:focus-within{-webkit-box-shadow:inset 0 0 0 2px var(--color-neutral-200);box-shadow:inset 0 0 0 2px var(--color-neutral-200)}.sc-stencila-editor-default-h .editor.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default .editor.sc-stencila-editor-default{cursor:text;-ms-flex-positive:1;flex-grow:1;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;max-width:100%;overflow:auto}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-wrap,.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-wrap *,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-wrap,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-wrap *{font-family:monospace;font-family:var(--font-family-mono,monospace)}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-wrap,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-wrap{line-height:1.5}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .codemirror-focused,stencila-editor.sc-stencila-editor-default-s>.editorContainer .codemirror-focused{outline:2px solid transparent;outline-offset:2px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .codemirror-scroller,stencila-editor.sc-stencila-editor-default-s>.editorContainer .codemirror-scroller{overflow:auto}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-gutters,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-gutters{background-color:var(--gutter-background);color:var(--gutter-color)}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li{font-size:90%;padding-bottom:2px;padding-top:2px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-completionIcon,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-completionIcon{min-width:1.375em;min-width:2ch}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer stencila-code-error,stencila-editor.sc-stencila-editor-default-s>.editorContainer stencila-code-error{border-bottom-style:solid;border-radius:0;border-width:0 0 1px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer stencila-code-error:last-of-type,stencila-editor.sc-stencila-editor-default-s>.editorContainer stencila-code-error:last-of-type{border-bottom-width:0}.sc-stencila-editor-default-h menu.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default{border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-top-width:1px;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;margin:0;padding:1px 0}.sc-stencila-editor-default-h menu.sc-stencila-editor-default stencila-icon.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default stencila-icon.sc-stencila-editor-default{--height:1em;--width:1em;margin-right:.25rem}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-style:none;color:#444a5e;color:var(--color-neutral-700,#444a5e);font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.75rem;line-height:1rem;margin-right:.5rem;text-align:left}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default option.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default option.sc-stencila-editor-default{font-family:sans-serif;font-family:var(--font-family-body,sans-serif);text-align:right}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:active,.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:focus,.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:hover,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:active,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:focus,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:hover{color:#1f212a;color:var(--color-neutral-900,#1f212a)}";var editorMaterialCss="*.sc-stencila-editor-material,.sc-stencila-editor-material:after,.sc-stencila-editor-material:before{border:0 solid;-webkit-box-sizing:border-box;box-sizing:border-box}html.sc-stencila-editor-material{font-size:16px}.hidden.sc-stencila-editor-material{display:none}.sc-stencila-editor-material-h,stencila-editor.sc-stencila-editor-material{--gutter-background:var(\n    --color-background,var(--color-neutral-50,#e9eaf1)\n  );--gutter-color:var(--color-neutral-500,#6e7591);all:initial}.sc-stencila-editor-material-h,stencila-editor.sc-stencila-editor-material{display:-ms-flexbox;display:flex;max-width:100%}.sc-stencila-editor-material-h,stencila-editor.sc-stencila-editor-material{--border-width:1px;--background-color:transparent}.sc-stencila-editor-material-h .editorContainer.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material .editorContainer.sc-stencila-editor-material{background-color:var(--background-color);border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-radius:.25rem;border-width:1px;border-width:var(--border-width);display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;max-width:100%}.sc-stencila-editor-material-h .editorContainer.sc-stencila-editor-material:focus-within,stencila-editor.sc-stencila-editor-material .editorContainer.sc-stencila-editor-material:focus-within{-webkit-box-shadow:inset 0 0 0 2px var(--color-neutral-200);box-shadow:inset 0 0 0 2px var(--color-neutral-200)}.sc-stencila-editor-material-h .editor.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material .editor.sc-stencila-editor-material{cursor:text;-ms-flex-positive:1;flex-grow:1;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;max-width:100%;overflow:auto}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-wrap,.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-wrap *,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-wrap,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-wrap *{font-family:monospace;font-family:var(--font-family-mono,monospace)}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-wrap,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-wrap{line-height:1.5}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .codemirror-focused,stencila-editor.sc-stencila-editor-material-s>.editorContainer .codemirror-focused{outline:2px solid transparent;outline-offset:2px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .codemirror-scroller,stencila-editor.sc-stencila-editor-material-s>.editorContainer .codemirror-scroller{overflow:auto}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-gutters,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-gutters{background-color:var(--gutter-background);color:var(--gutter-color)}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li{font-size:90%;padding-bottom:2px;padding-top:2px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-completionIcon,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-completionIcon{min-width:1.375em;min-width:2ch}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer stencila-code-error,stencila-editor.sc-stencila-editor-material-s>.editorContainer stencila-code-error{border-bottom-style:solid;border-radius:0;border-width:0 0 1px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer stencila-code-error:last-of-type,stencila-editor.sc-stencila-editor-material-s>.editorContainer stencila-code-error:last-of-type{border-bottom-width:0}.sc-stencila-editor-material-h menu.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material{border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-top-width:1px;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;margin:0;padding:1px 0}.sc-stencila-editor-material-h menu.sc-stencila-editor-material stencila-icon.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material stencila-icon.sc-stencila-editor-material{--height:1em;--width:1em;margin-right:.25rem}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-style:none;color:#444a5e;color:var(--color-neutral-700,#444a5e);font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.75rem;line-height:1rem;margin-right:.5rem;text-align:left}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material option.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material option.sc-stencila-editor-material{font-family:sans-serif;font-family:var(--font-family-body,sans-serif);text-align:right}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:active,.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:focus,.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:hover,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:active,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:focus,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:hover{color:#1f212a;color:var(--color-neutral-900,#1f212a)}";var slots$1={text:"text"};var cssClasses={container:"editorContainer",editor:"editor"};var cssIds={editorTarget:"editorTarget"};var Editor=function(){function e(e){var t=this;registerInstance(this,e);this.setLanguage=createEvent(this,"setLanguage",7);var n,r;this.isReady=false;this.isControlled=false;this.languageCapabilities=defaultLanguageCapabilities;this.readOnly=false;this.readOnlyConf=new Compartment;this.activeLanguage=(r=(n=this.languageCapabilities[0])===null||n===void 0?void 0:n.toLowerCase())!==null&&r!==void 0?r:"";this.dispatchEffect=function(e){var n,r,i;var o=(n=t.editorRef)===null||n===void 0?void 0:n.state;var a=(r=o===null||o===void 0?void 0:o.update({effects:[e]}))!==null&&r!==void 0?r:{};(i=t.editorRef)===null||i===void 0?void 0:i.dispatch(a)};this.getLang=function(e){return __awaiter(t,void 0,void 0,(function(){var t,n,r,n,i,n,o,n,a,n,s,n,c,u,l,f,h,d,p,n,r,p;return __generator(this,(function(v){switch(v.label){case 0:t=e.toLowerCase();switch(t){case"r":return[3,1];case"bash":return[3,4];case"shell":return[3,4];case"sh":return[3,4];case"latex":return[3,7];case"stex":return[3,7];case"tex":return[3,7];case"toml":return[3,10];case"yaml":return[3,13];case"dockerfile":return[3,16];case"html":return[3,19];case"javascript":return[3,21];case"json":return[3,23];case"xml":return[3,25];case"python":return[3,27];case"rmd":return[3,29];case"md":return[3,33];case"markdown":return[3,33]}return[3,33];case 1:return[4,import("./index-2c756fbf.js")];case 2:n=v.sent().StreamLanguage;return[4,import("./r-6f6c9fd0.js")];case 3:r=v.sent().r;return[2,n.define(r)];case 4:return[4,import("./index-2c756fbf.js")];case 5:n=v.sent().StreamLanguage;return[4,import("./shell-f1520e9d.js")];case 6:i=v.sent().shell;return[2,n.define(i)];case 7:return[4,import("./index-2c756fbf.js")];case 8:n=v.sent().StreamLanguage;return[4,import("./stex-5289b311.js")];case 9:o=v.sent().stexMath;return[2,n.define(o)];case 10:return[4,import("./index-2c756fbf.js")];case 11:n=v.sent().StreamLanguage;return[4,import("./toml-9561606b.js")];case 12:a=v.sent().toml;return[2,n.define(a)];case 13:return[4,import("./index-2c756fbf.js")];case 14:n=v.sent().StreamLanguage;return[4,import("./yaml-c86188d3.js")];case 15:s=v.sent().yaml;return[2,n.define(s)];case 16:return[4,import("./index-2c756fbf.js")];case 17:n=v.sent().StreamLanguage;return[4,import("./dockerfile-fbfef70c.js")];case 18:c=v.sent().dockerFile;return[2,n.define(c)];case 19:return[4,import("./index-030925b5.js")];case 20:u=v.sent().html;return[2,u()];case 21:return[4,import("./index-a3dcf4a4.js")];case 22:l=v.sent().javascript;return[2,l()];case 23:return[4,import("./index-e908ade2.js")];case 24:f=v.sent().json;return[2,f()];case 25:return[4,import("./index-a90c4c1d.js")];case 26:h=v.sent().xml;return[2,h()];case 27:return[4,import("./index-cbff18c5.js")];case 28:d=v.sent().python;return[2,d()];case 29:return[4,import("./index-ea631fa1.js")];case 30:p=v.sent().markdown;return[4,import("./index-2c756fbf.js")];case 31:n=v.sent().StreamLanguage;return[4,import("./r-6f6c9fd0.js")];case 32:r=v.sent().r;return[2,p({defaultCodeLanguage:n.define(r)})];case 33:return[4,import("./index-ea631fa1.js")];case 34:p=v.sent().markdown;return[2,p()]}}))}))};this.languageConf=new Compartment;this.setLanguageHandler=function(e){return __awaiter(t,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:this.setLanguage.emit(e);return[4,this.getLang(e)];case 1:t=n.sent();this.activeLanguage=e;this.dispatchEffect(this.languageConf.reconfigure(t));return[2]}}))}))};this.onSetLanguage=function(e){return __awaiter(t,void 0,void 0,(function(){var t,n;return __generator(this,(function(r){t=e.currentTarget;n=languageByAlias(t.value);return[2,this.setLanguageHandler(n)]}))}))};this.execute=function(){t.getContents().then((function(e){return t.executeHandler?t.executeHandler(e):e})).catch((function(e){console.error(e);return false}));return true};this.autofocus=false;this.lineNumbersConf=new Compartment;this.lineNumbers=true;this.lineWrappingConf=new Compartment;this.lineWrapping=false;this.foldGutterConf=new Compartment;this.foldGutter=true;this.keymap=[];this.getCodeMirrorConfig=function(e){if(e===void 0){e={}}return __awaiter(t,void 0,void 0,(function(){var t,n,r,i,o,a,s;return __generator(this,(function(c){switch(c.label){case 0:t=Object.assign({language:this.activeLanguage,foldGutterEnabled:this.foldGutter,lineNumbersEnabled:this.lineNumbers,lineWrappingEnabled:this.lineWrapping},e),n=t.language,r=t.foldGutterEnabled,i=t.lineNumbersEnabled,o=t.lineWrappingEnabled;return[4,this.getLang(n)];case 1:a=c.sent();s=[history(),autocompletion(),EditorState.languageData.of((function(){return[{autocomplete:completeAnyWord}]})),bracketMatching(),closeBrackets(),Prec.fallback(defaultHighlightStyle),this.languageConf.of(a),this.lineWrappingConf.of(o?EditorView.lineWrapping:[]),this.lineNumbersConf.of(i?lineNumbers():[]),this.foldGutterConf.of(r?foldGutter():[]),drawSelection(),EditorState.allowMultipleSelections.of(true),searchConfig({top:true}),highlightSpecialChars(),keymap.of(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],defaultKeymap),commentKeymap),closeBracketsKeymap),historyKeymap),foldKeymap),searchKeymap),[{key:"Ctrl-Space",run:startCompletion},{key:"Shift-Enter",run:this.execute}]),this.keymap)),this.readOnlyConf.of(EditorView.editable.of(!this.readOnly)),codeErrors()];return[2,s]}}))}))};this.initCodeMirror=function(){return __awaiter(t,void 0,void 0,(function(){var e,t,n,r,i,o,a,s,c;var u,l;return __generator(this,(function(f){switch(f.label){case 0:n=this.el;r=getSlotByName(n)(slots$1.text);i=(t=(e=this.contents)!==null&&e!==void 0?e:r===null||r===void 0?void 0:r.textContent)!==null&&t!==void 0?t:"";o=this;a=EditorView.bind;u={};c=(s=EditorState).create;l={doc:i};return[4,this.getCodeMirrorConfig()];case 1:o.editorRef=new(a.apply(EditorView,[void 0,(u.state=c.apply(s,[(l.extensions=f.sent(),l)]),u)]));this.isReady=true;return[2]}}))}))};this.attachEditorToDom=function(){var e,n,r;var i=(e=t.editorRef)===null||e===void 0?void 0:e.dom;if(i){(r=(n=t.el)===null||n===void 0?void 0:n.querySelector("#"+cssIds.editorTarget))===null||r===void 0?void 0:r.replaceWith(i)}};this.setContentsHandler=function(e){var n,r,i;var o=(n=t.editorRef)===null||n===void 0?void 0:n.state;var a=(r=o===null||o===void 0?void 0:o.update({changes:{from:0,to:o.doc.length,insert:e},scrollIntoView:true}))!==null&&r!==void 0?r:{};(i=t.editorRef)===null||i===void 0?void 0:i.dispatch(a)};this.stopEventPropagation=function(e){e.stopPropagation()};this.focus=function(){var e;(e=t.editorRef)===null||e===void 0?void 0:e.focus()}}e.prototype.contentsChanged=function(e,t){if(!this.isControlled&&e!==t){this.setContentsHandler(e)}};e.prototype.readOnlyChanged=function(e,t){if(e!==t){this.dispatchEffect(this.readOnlyConf.reconfigure(EditorView.editable.of(!this.readOnly)))}};e.prototype.activeLanguageOnlyChanged=function(e,t){if(!this.isControlled&&e!==t){this.setLanguageHandler(e).catch((function(e){console.log(e)}))}};e.prototype.onSetLineNumbers=function(e,t){if(!this.isControlled&&e!==t){this.dispatchEffect(this.lineNumbersConf.reconfigure(e?lineNumbers():[]))}};e.prototype.onSetLineWrapping=function(e,t){if(!this.isControlled&&e!==t){this.dispatchEffect(this.lineWrappingConf.reconfigure(e?EditorView.lineWrapping:[]))}};e.prototype.onSetfoldGutter=function(e,t){if(!this.isControlled&&e!==t){this.dispatchEffect(this.foldGutterConf.reconfigure(e?foldGutter():[]))}};e.prototype.errorsChanged=function(e){var t;(t=this.editorRef)===null||t===void 0?void 0:t.dispatch({effects:updateErrors.of(e)})};e.prototype.getContents=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(n){return[2,{text:(t=(e=this.editorRef)===null||e===void 0?void 0:e.state.doc.toString())!==null&&t!==void 0?t:"",language:this.activeLanguage}]}))}))};e.prototype.setContents=function(e){this.setContentsHandler(e);return Promise.resolve(e)};e.prototype.setState=function(e,t,n,r){return __awaiter(this,void 0,void 0,(function(){var i,o,a,s,c,u,l;var f;return __generator(this,(function(h){switch(h.label){case 0:if(!((i=this.editorRef)===null||i===void 0))return[3,1];o=void 0;return[3,5];case 1:s=(a=i).setState;u=(c=EditorState).create;f={doc:e};if(!(n!==null&&n!==void 0))return[3,2];l=n;return[3,4];case 2:return[4,this.getCodeMirrorConfig(t)];case 3:l=h.sent();h.label=4;case 4:o=s.apply(a,[u.apply(c,[(f.extensions=l,f.selection=r,f)])]);h.label=5;case 5:o;return[2,Promise.resolve(e)]}}))}))};e.prototype.getRef=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){if(this.editorRef){return[2,this.editorRef]}return[2,new Promise((function(t,n){var r=true;var i=3e3;var o=setTimeout((function(){r=false}),i);var a=function(){setInterval((function(){if(e.editorRef&&e.isReady){clearTimeout(o);t(e.editorRef)}else if(!r){n(new Error("Editor wasn’t instantiated in time ("+i+"ms), please try again."))}else{a()}}),100)};a()}))]}))}))};e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){try{return[2,this.initCodeMirror()]}catch(t){console.log("Encountered error while initializing code editor\n",t)}return[2]}))}))};e.prototype.componentDidLoad=function(){this.attachEditorToDom();if(this.autofocus){this.focus()}};e.prototype.disconnectedCallback=function(){var e;(e=this.editorRef)===null||e===void 0?void 0:e.destroy()};e.prototype.render=function(){return h(Host,null,h("div",{class:cssClasses.container},h("div",{class:cssClasses.editor,onKeyDown:this.stopEventPropagation,onClick:this.focus},h("div",{class:"hidden"},h("slot",{name:slots$1.text})),h("div",{id:cssIds.editorTarget})),h("menu",null,h(LanguagePicker,{activeLanguage:this.activeLanguage,onSetLanguage:this.onSetLanguage,languageCapabilities:this.languageCapabilities}))))};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{contents:["contentsChanged"],readOnly:["readOnlyChanged"],activeLanguage:["activeLanguageOnlyChanged"],lineNumbers:["onSetLineNumbers"],lineWrapping:["onSetLineWrapping"],foldGutter:["onSetfoldGutter"],errors:["errorsChanged"]}},enumerable:false,configurable:true});return e}();Editor.style={default:defaultEditorCss,material:editorMaterialCss};var Ord=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.ordDate=t.ordNumber=t.ordString=t.ordBoolean=t.ord=t.getDualOrd=t.getTupleOrd=t.between=t.clamp=t.max=t.min=t.geq=t.leq=t.gt=t.lt=t.Contravariant=t.getMonoid=t.getSemigroup=t.URI=t.contramap=t.reverse=t.tuple=t.fromCompare=t.equalsDefault=void 0;var n=function(e){return function(t,n){return t===n||e(t,n)===0}};t.equalsDefault=n;var r=function(e){return{equals:t.equalsDefault(e),compare:function(t,n){return t===n?0:e(t,n)}}};t.fromCompare=r;var i=function(){var e=[];for(var n=0;n<arguments.length;n++){e[n]=arguments[n]}return t.fromCompare((function(t,n){var r=0;for(;r<e.length-1;r++){var i=e[r].compare(t[r],n[r]);if(i!==0){return i}}return e[r].compare(t[r],n[r])}))};t.tuple=i;var o=function(e){return t.fromCompare((function(t,n){return e.compare(n,t)}))};t.reverse=o;var a=function(e,n){return _function.pipe(e,t.contramap(n))};var s=function(e){return function(n){return t.fromCompare((function(t,r){return n.compare(e(t),e(r))}))}};t.contramap=s;t.URI="Ord";var c=function(){return{concat:function(e,n){return t.fromCompare((function(t,r){var i=e.compare(t,r);return i!==0?i:n.compare(t,r)}))}}};t.getSemigroup=c;var u=function(){return{concat:t.getSemigroup().concat,empty:t.fromCompare((function(){return 0}))}};t.getMonoid=u;t.Contravariant={URI:t.URI,contramap:a};var l=function(e){return function(t,n){return e.compare(t,n)===-1}};t.lt=l;var f=function(e){return function(t,n){return e.compare(t,n)===1}};t.gt=f;var h=function(e){return function(t,n){return e.compare(t,n)!==1}};t.leq=h;var d=function(e){return function(t,n){return e.compare(t,n)!==-1}};t.geq=d;var p=function(e){return function(t,n){return t===n||e.compare(t,n)<1?t:n}};t.min=p;var v=function(e){return function(t,n){return t===n||e.compare(t,n)>-1?t:n}};t.max=v;var m=function(e){var n=t.min(e);var r=t.max(e);return function(e,t){return function(i){return r(n(i,t),e)}}};t.clamp=m;var g=function(e){var n=t.lt(e);var r=t.gt(e);return function(e,t){return function(i){return n(i,e)||r(i,t)?false:true}}};t.between=g;t.getTupleOrd=t.tuple;t.getDualOrd=t.reverse;t.ord=t.Contravariant;function y(e,t){return e<t?-1:e>t?1:0}var b={equals:Eq.eqStrict.equals,compare:y};t.ordBoolean=b;t.ordString=b;t.ordNumber=b;t.ordDate=_function.pipe(t.ordNumber,t.contramap((function(e){return e.valueOf()})))}));var Semigroup=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.semigroupProduct=t.semigroupSum=t.semigroupString=t.getFunctionSemigroup=t.semigroupAny=t.semigroupAll=t.fold=t.getIntercalateSemigroup=t.getMeetSemigroup=t.getJoinSemigroup=t.getDualSemigroup=t.getStructSemigroup=t.getTupleSemigroup=t.getFirstSemigroup=t.getLastSemigroup=t.getObjectSemigroup=t.concatAll=t.semigroupVoid=t.last=t.first=t.intercalate=t.tuple=t.struct=t.reverse=t.constant=t.max=t.min=void 0;var o=i(internal);var a=i(Ord);var s=function(e){return{concat:a.min(e)}};t.min=s;var c=function(e){return{concat:a.max(e)}};t.max=c;var u=function(e){return{concat:function(){return e}}};t.constant=u;var l=function(e){return{concat:function(t,n){return e.concat(n,t)}}};t.reverse=l;var f=function(e){return{concat:function(t,n){var r={};for(var i in e){if(o.has.call(e,i)){r[i]=e[i].concat(t[i],n[i])}}return r}}};t.struct=f;var h=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return{concat:function(t,n){return e.map((function(e,r){return e.concat(t[r],n[r])}))}}};t.tuple=h;var d=function(e){return function(t){return{concat:function(n,r){return t.concat(n,t.concat(e,r))}}}};t.intercalate=d;var p=function(){return{concat:_function.identity}};t.first=p;var v=function(){return{concat:function(e,t){return t}}};t.last=v;t.semigroupVoid=t.constant(undefined);var m=function(e){return function(t){return function(n){return n.reduce(e.concat,t)}}};t.concatAll=m;var g=function(){return{concat:function(e,t){return Object.assign({},e,t)}}};t.getObjectSemigroup=g;t.getLastSemigroup=t.last;t.getFirstSemigroup=t.first;t.getTupleSemigroup=t.tuple;t.getStructSemigroup=t.struct;t.getDualSemigroup=t.reverse;t.getJoinSemigroup=t.max;t.getMeetSemigroup=t.min;t.getIntercalateSemigroup=t.intercalate;function y(e){var n=t.concatAll(e);return function(e,t){return t===undefined?n(e):n(e)(t)}}t.fold=y;t.semigroupAll={concat:function(e,t){return e&&t}};t.semigroupAny={concat:function(e,t){return e||t}};t.getFunctionSemigroup=_function.getSemigroup;t.semigroupString={concat:function(e,t){return e+t}};t.semigroupSum={concat:function(e,t){return e+t}};t.semigroupProduct={concat:function(e,t){return e*t}}}));var ReadonlyNonEmptyArray=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};var o=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:true});t.traverse=t.reduceRightWithIndex=t.foldMapWithIndex=t.reduceWithIndex=t.reduceRight=t.foldMap=t.reduce=t.mapWithIndex=t.map=t.flatten=t.duplicate=t.extend=t.chain=t.ap=t.alt=t.altW=t.of=t.chunksOf=t.splitAt=t.chop=t.chainWithIndex=t.intersperse=t.prependAll=t.unzip=t.zip=t.zipWith=t.modifyAt=t.updateAt=t.sort=t.groupBy=t.groupSort=t.group=t.reverse=t.concat=t.fromArray=t.unappend=t.unprepend=t.fromReadonlyArray=t.makeBy=t.rotate=t.union=t.sortBy=t.uniq=t.unsafeUpdateAt=t.unsafeInsertAt=t.append=t.prepend=t.isOutOfBound=t.isNonEmpty=t.empty=void 0;t.readonlyNonEmptyArray=t.fold=t.prependToAll=t.insertAt=t.snoc=t.cons=t.unsnoc=t.uncons=t.filterWithIndex=t.filter=t.concatAll=t.max=t.min=t.init=t.last=t.tail=t.head=t.apS=t.bind=t.bindTo=t.Do=t.Comonad=t.Alt=t.TraversableWithIndex=t.Traversable=t.FoldableWithIndex=t.Foldable=t.Monad=t.chainFirst=t.Chain=t.Applicative=t.apSecond=t.apFirst=t.Apply=t.FunctorWithIndex=t.Pointed=t.flap=t.Functor=t.getEq=t.getSemigroup=t.getShow=t.URI=t.extract=t.traverseWithIndex=t.sequence=void 0;var a=i(internal);var s=i(Option$1);var c=i(Semigroup);t.empty=[];var u=function(e){return e.length>0};t.isNonEmpty=u;var l=function(e,t){return e<0||e>=t.length};t.isOutOfBound=l;var f=function(e){return function(t){return o([e],t)}};t.prepend=f;var h=function(e){return function(t){return C(t,[e])}};t.append=h;var d=function(e,n,r){if(t.isNonEmpty(r)){var i=a.fromReadonlyNonEmptyArray(r);i.splice(e,0,n);return i}return[n]};t.unsafeInsertAt=d;var p=function(e,t,n){if(n[e]===t){return n}else{var r=a.fromReadonlyNonEmptyArray(n);r[e]=t;return r}};t.unsafeUpdateAt=p;var v=function(e){return function(n){if(n.length===1){return n}var r=[t.head(n)];var i=t.tail(n);var o=function(t){if(r.every((function(n){return!e.equals(n,t)}))){r.push(t)}};for(var a=0,s=i;a<s.length;a++){var c=s[a];o(c)}return r}};t.uniq=v;var m=function(e){if(t.isNonEmpty(e)){var n=Ord.getMonoid();return t.sort(e.reduce(n.concat,n.empty))}return _function.identity};t.sortBy=m;var g=function(e){var n=t.uniq(e);return function(e,t){return n(C(e,t))}};t.union=g;var y=function(e){return function(n){var r=n.length;var i=Math.round(e)%r;if(t.isOutOfBound(Math.abs(i),n)||i===0){return n}if(i<0){var o=t.splitAt(-i)(n),a=o[0],s=o[1];return C(s,a)}else{return t.rotate(i-r)(n)}}};t.rotate=y;var b=function(e,t){var n=Math.max(0,Math.floor(e));var r=[t(0)];for(var i=1;i<n;i++){r.push(t(i))}return r};t.makeBy=b;var w=function(e){return t.isNonEmpty(e)?s.some(e):s.none};t.fromReadonlyArray=w;var x=function(e){return[t.head(e),t.tail(e)]};t.unprepend=x;var S=function(e){return[t.init(e),t.last(e)]};t.unappend=S;var k=function(e){return t.fromReadonlyArray(e.slice())};t.fromArray=k;function C(e,t){return e.concat(t)}t.concat=C;var A=function(e){return e.length===1?e:o([t.last(e)],e.slice(0,-1).reverse())};t.reverse=A;function M(e){return function(n){var r=n.length;if(r===0){return t.empty}var i=[];var o=n[0];var a=[o];for(var s=1;s<r;s++){var c=n[s];if(e.equals(c,o)){a.push(c)}else{i.push(a);o=c;a=[o]}}i.push(a);return i}}t.group=M;function I(e){var n=t.sort(e);var r=M(e);return function(e){return t.isNonEmpty(e)?r(n(e)):t.empty}}t.groupSort=I;var E=function(e){return function(t){var n={};for(var r=0,i=t;r<i.length;r++){var o=i[r];var a=e(o);if(n.hasOwnProperty(a)){n[a].push(o)}else{n[a]=[o]}}return n}};t.groupBy=E;var R=function(e){return function(t){return t.length===1?t:t.slice().sort(e.compare)}};t.sort=R;var T=function(e,n){return t.modifyAt(e,(function(){return n}))};t.updateAt=T;var P=function(e,n){return function(r){return t.isOutOfBound(e,r)?s.none:s.some(t.unsafeUpdateAt(e,n(r[e]),r))}};t.modifyAt=P;var O=function(e,t,n){var r=[n(e[0],t[0])];var i=Math.min(e.length,t.length);for(var o=1;o<i;o++){r[o]=n(e[o],t[o])}return r};t.zipWith=O;function D(e,n){if(n===undefined){return function(t){return D(t,e)}}return t.zipWith(e,n,(function(e,t){return[e,t]}))}t.zip=D;var B=function(e){var t=[e[0][0]];var n=[e[0][1]];for(var r=1;r<e.length;r++){t[r]=e[r][0];n[r]=e[r][1]}return[t,n]};t.unzip=B;var L=function(e){return function(t){var n=[e,t[0]];for(var r=1;r<t.length;r++){n.push(e,t[r])}return n}};t.prependAll=L;var _=function(e){return function(n){var r=t.tail(n);return t.isNonEmpty(r)?_function.pipe(r,t.prependAll(e),t.prepend(t.head(n))):n}};t.intersperse=_;var N=function(e){return function(n){var r=a.fromReadonlyNonEmptyArray(e(0,t.head(n)));for(var i=1;i<n.length;i++){r.push.apply(r,e(i,n[i]))}return r}};t.chainWithIndex=N;var W=function(e){return function(n){var r=e(n),i=r[0],o=r[1];var a=[i];var s=o;while(t.isNonEmpty(s)){var c=e(s),u=c[0],l=c[1];a.push(u);s=l}return a}};t.chop=W;var F=function(e){return function(n){var r=Math.max(1,e);return r>=n.length?[n,t.empty]:[_function.pipe(n.slice(1,r),t.prepend(t.head(n))),n.slice(r)]}};t.splitAt=F;var j=function(e){return t.chop(t.splitAt(e))};t.chunksOf=j;var V=function(e,n){return _function.pipe(e,t.map(n))};var U=function(e,n){return _function.pipe(e,t.mapWithIndex(n))};var q=function(e,n){return _function.pipe(e,t.ap(n))};var H=function(e,n){return _function.pipe(e,t.chain(n))};var z=function(e,n){return _function.pipe(e,t.extend(n))};var G=function(e,n,r){return _function.pipe(e,t.reduce(n,r))};var $=function(e){var n=t.foldMap(e);return function(e,t){return _function.pipe(e,n(t))}};var K=function(e,n,r){return _function.pipe(e,t.reduceRight(n,r))};var J=function(e){var n=t.traverse(e);return function(e,t){return _function.pipe(e,n(t))}};var Q=function(e,n){return _function.pipe(e,t.alt(n))};var X=function(e,n,r){return _function.pipe(e,t.reduceWithIndex(n,r))};var Y=function(e){var n=t.foldMapWithIndex(e);return function(e,t){return _function.pipe(e,n(t))}};var Z=function(e,n,r){return _function.pipe(e,t.reduceRightWithIndex(n,r))};var ee=function(e){var n=t.traverseWithIndex(e);return function(e,t){return _function.pipe(e,n(t))}};var te=function(e){return[e]};t.of=te;var ne=function(e){return function(t){return C(t,e())}};t.altW=ne;t.alt=t.altW;var re=function(e){return t.chain((function(n){return _function.pipe(e,t.map(n))}))};t.ap=re;var ie=function(e){return t.chainWithIndex((function(t,n){return e(n)}))};t.chain=ie;var oe=function(e){return function(n){var r=t.tail(n);var i=[e(n)];while(t.isNonEmpty(r)){i.push(e(r));r=t.tail(r)}return i}};t.extend=oe;t.duplicate=t.extend(_function.identity);t.flatten=t.chain(_function.identity);var ae=function(e){return t.mapWithIndex((function(t,n){return e(n)}))};t.map=ae;var se=function(e){return function(n){var r=[e(0,t.head(n))];for(var i=1;i<n.length;i++){r.push(e(i,n[i]))}return r}};t.mapWithIndex=se;var ce=function(e,n){return t.reduceWithIndex(e,(function(e,t,r){return n(t,r)}))};t.reduce=ce;var ue=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r){return e.concat(n,t(r))}),t(n[0]))}}};t.foldMap=ue;var le=function(e,n){return t.reduceRightWithIndex(e,(function(e,t,r){return n(t,r)}))};t.reduceRight=le;var fe=function(e,t){return function(n){return n.reduce((function(e,n,r){return t(r,e,n)}),e)}};t.reduceWithIndex=fe;var he=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r,i){return e.concat(n,t(i+1,r))}),t(0,n[0]))}}};t.foldMapWithIndex=he;var de=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}};t.reduceRightWithIndex=de;var pe=function(e){var n=t.traverseWithIndex(e);return function(e){return n((function(t,n){return e(n)}))}};t.traverse=pe;var ve=function(e){return t.traverseWithIndex(e)((function(e,t){return t}))};t.sequence=ve;var me=function(e){return function(n){return function(r){var i=e.map(n(0,t.head(r)),t.of);for(var o=1;o<r.length;o++){i=e.ap(e.map(i,(function(e){return function(n){return _function.pipe(e,t.append(n))}})),n(o,r[o]))}return i}}};t.traverseWithIndex=me;var ge=function(e){return e[0]};t.extract=ge;t.URI="ReadonlyNonEmptyArray";var ye=function(e){return{show:function(t){return"["+t.map(e.show).join(", ")+"]"}}};t.getShow=ye;var be=function(){return{concat:C}};t.getSemigroup=be;var we=function(e){return Eq.fromEquals((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))};t.getEq=we;t.Functor={URI:t.URI,map:V};t.flap=Functor.flap(t.Functor);t.Pointed={URI:t.URI,of:t.of};t.FunctorWithIndex={URI:t.URI,map:V,mapWithIndex:U};t.Apply={URI:t.URI,map:V,ap:q};t.apFirst=Apply.apFirst(t.Apply);t.apSecond=Apply.apSecond(t.Apply);t.Applicative={URI:t.URI,map:V,ap:q,of:t.of};t.Chain={URI:t.URI,map:V,ap:q,chain:H};t.chainFirst=Chain.chainFirst(t.Chain);t.Monad={URI:t.URI,map:V,ap:q,of:t.of,chain:H};t.Foldable={URI:t.URI,reduce:G,foldMap:$,reduceRight:K};t.FoldableWithIndex={URI:t.URI,reduce:G,foldMap:$,reduceRight:K,reduceWithIndex:X,foldMapWithIndex:Y,reduceRightWithIndex:Z};t.Traversable={URI:t.URI,map:V,reduce:G,foldMap:$,reduceRight:K,traverse:J,sequence:t.sequence};t.TraversableWithIndex={URI:t.URI,map:V,mapWithIndex:U,reduce:G,foldMap:$,reduceRight:K,traverse:J,sequence:t.sequence,reduceWithIndex:X,foldMapWithIndex:Y,reduceRightWithIndex:Z,traverseWithIndex:ee};t.Alt={URI:t.URI,map:V,alt:Q};t.Comonad={URI:t.URI,map:V,extend:z,extract:t.extract};t.Do=t.of({});t.bindTo=Functor.bindTo(t.Functor);t.bind=Chain.bind(t.Chain);t.apS=Apply.apS(t.Apply);t.head=t.extract;var xe=function(e){return e.slice(1)};t.tail=xe;var Se=function(e){return e[e.length-1]};t.last=Se;var ke=function(e){return e.slice(0,-1)};t.init=ke;var Ce=function(e){var t=c.min(e);return function(e){return e.reduce(t.concat)}};t.min=Ce;var Ae=function(e){var t=c.max(e);return function(e){return e.reduce(t.concat)}};t.max=Ae;var Me=function(e){return function(t){return t.reduce(e.concat)}};t.concatAll=Me;function Ie(e){return t.filterWithIndex((function(t,n){return e(n)}))}t.filter=Ie;var Ee=function(e){return function(n){return t.fromReadonlyArray(n.filter((function(t,n){return e(n,t)})))}};t.filterWithIndex=Ee;t.uncons=t.unprepend;t.unsnoc=t.unappend;function Re(e,n){return n===undefined?t.prepend(e):_function.pipe(n,t.prepend(e))}t.cons=Re;var Te=function(e,t){return C(e,[t])};t.snoc=Te;var Pe=function(e,n){return function(r){return e<0||e>r.length?s.none:s.some(t.unsafeInsertAt(e,n,r))}};t.insertAt=Pe;t.prependToAll=t.prependAll;t.fold=t.concatAll;t.readonlyNonEmptyArray={URI:t.URI,of:t.of,map:V,mapWithIndex:U,ap:q,chain:H,extend:z,extract:t.extract,reduce:G,foldMap:$,reduceRight:K,traverse:J,sequence:t.sequence,reduceWithIndex:X,foldMapWithIndex:Y,reduceRightWithIndex:Z,traverseWithIndex:ee,alt:Q}}));var NonEmptyArray=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};var o=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:true});t.reduceRightWithIndex=t.reduceRight=t.reduceWithIndex=t.reduce=t.mapWithIndex=t.map=t.flatten=t.duplicate=t.extend=t.chain=t.ap=t.alt=t.altW=t.chunksOf=t.splitAt=t.chop=t.chainWithIndex=t.foldMap=t.foldMapWithIndex=t.intersperse=t.prependAll=t.unzip=t.zip=t.zipWith=t.of=t.copy=t.modifyAt=t.updateAt=t.insertAt=t.sort=t.groupBy=t.groupSort=t.group=t.reverse=t.concat=t.unappend=t.unprepend=t.fromArray=t.fromReadonlyNonEmptyArray=t.makeBy=t.rotate=t.union=t.sortBy=t.uniq=t.unsafeUpdateAt=t.unsafeInsertAt=t.append=t.prepend=t.isOutOfBound=t.isNonEmpty=void 0;t.nonEmptyArray=t.fold=t.prependToAll=t.snoc=t.cons=t.unsnoc=t.uncons=t.filterWithIndex=t.filter=t.concatAll=t.max=t.min=t.init=t.last=t.tail=t.head=t.apS=t.bind=t.bindTo=t.Do=t.Comonad=t.Alt=t.TraversableWithIndex=t.Traversable=t.FoldableWithIndex=t.Foldable=t.Monad=t.chainFirst=t.Chain=t.Applicative=t.apSecond=t.apFirst=t.Apply=t.FunctorWithIndex=t.Pointed=t.flap=t.Functor=t.getEq=t.getSemigroup=t.getShow=t.URI=t.extract=t.traverseWithIndex=t.sequence=t.traverse=void 0;var a=i(internal);var s=i(Option$1);var c=i(ReadonlyNonEmptyArray);var u=function(e){return e.length>0};t.isNonEmpty=u;var l=function(e,t){return e<0||e>=t.length};t.isOutOfBound=l;var f=function(e){return function(t){return o([e],t)}};t.prepend=f;var h=function(e){return function(t){return k(t,[e])}};t.append=h;var d=function(e,n,r){if(t.isNonEmpty(r)){var i=t.fromReadonlyNonEmptyArray(r);i.splice(e,0,n);return i}return[n]};t.unsafeInsertAt=d;var p=function(e,n,r){var i=t.fromReadonlyNonEmptyArray(r);i[e]=n;return i};t.unsafeUpdateAt=p;var v=function(e){return function(n){if(n.length===1){return t.copy(n)}var r=[t.head(n)];var i=t.tail(n);var o=function(t){if(r.every((function(n){return!e.equals(n,t)}))){r.push(t)}};for(var a=0,s=i;a<s.length;a++){var c=s[a];o(c)}return r}};t.uniq=v;var m=function(e){if(t.isNonEmpty(e)){var n=Ord.getMonoid();return t.sort(e.reduce(n.concat,n.empty))}return t.copy};t.sortBy=m;var g=function(e){var n=t.uniq(e);return function(e,t){return n(k(e,t))}};t.union=g;var y=function(e){return function(n){var r=n.length;var i=Math.round(e)%r;if(t.isOutOfBound(Math.abs(i),n)||i===0){return t.copy(n)}if(i<0){var o=t.splitAt(-i)(n),a=o[0],s=o[1];return k(s,a)}else{return t.rotate(i-r)(n)}}};t.rotate=y;var b=function(e,t){var n=Math.max(0,Math.floor(e));var r=[t(0)];for(var i=1;i<n;i++){r.push(t(i))}return r};t.makeBy=b;t.fromReadonlyNonEmptyArray=a.fromReadonlyNonEmptyArray;var w=function(e){return t.isNonEmpty(e)?s.some(e):s.none};t.fromArray=w;var x=function(e){return[t.head(e),t.tail(e)]};t.unprepend=x;var S=function(e){return[t.init(e),t.last(e)]};t.unappend=S;function k(e,t){return e.concat(t)}t.concat=k;var C=function(e){return o([t.last(e)],e.slice(0,-1).reverse())};t.reverse=C;function A(e){return function(t){var n=t.length;if(n===0){return[]}var r=[];var i=t[0];var o=[i];for(var a=1;a<n;a++){var s=t[a];if(e.equals(s,i)){o.push(s)}else{r.push(o);i=s;o=[i]}}r.push(o);return r}}t.group=A;function M(e){var n=t.sort(e);var r=A(e);return function(e){return t.isNonEmpty(e)?r(n(e)):[]}}t.groupSort=M;var I=function(e){return function(t){var n={};for(var r=0,i=t;r<i.length;r++){var o=i[r];var a=e(o);if(n.hasOwnProperty(a)){n[a].push(o)}else{n[a]=[o]}}return n}};t.groupBy=I;var E=function(e){return function(t){return t.slice().sort(e.compare)}};t.sort=E;var R=function(e,n){return function(r){return e<0||e>r.length?s.none:s.some(t.unsafeInsertAt(e,n,r))}};t.insertAt=R;var T=function(e,n){return t.modifyAt(e,(function(){return n}))};t.updateAt=T;var P=function(e,n){return function(r){return t.isOutOfBound(e,r)?s.none:s.some(t.unsafeUpdateAt(e,n(r[e]),r))}};t.modifyAt=P;t.copy=t.fromReadonlyNonEmptyArray;var O=function(e){return[e]};t.of=O;var D=function(e,t,n){var r=[n(e[0],t[0])];var i=Math.min(e.length,t.length);for(var o=1;o<i;o++){r[o]=n(e[o],t[o])}return r};t.zipWith=D;function B(e,n){if(n===undefined){return function(t){return B(t,e)}}return t.zipWith(e,n,(function(e,t){return[e,t]}))}t.zip=B;var L=function(e){var t=[e[0][0]];var n=[e[0][1]];for(var r=1;r<e.length;r++){t[r]=e[r][0];n[r]=e[r][1]}return[t,n]};t.unzip=L;var _=function(e){return function(t){var n=[e,t[0]];for(var r=1;r<t.length;r++){n.push(e,t[r])}return n}};t.prependAll=_;var N=function(e){return function(n){var r=t.tail(n);return t.isNonEmpty(r)?_function.pipe(r,t.prependAll(e),t.prepend(t.head(n))):t.copy(n)}};t.intersperse=N;t.foldMapWithIndex=c.foldMapWithIndex;t.foldMap=c.foldMap;var W=function(e){return function(n){var r=t.fromReadonlyNonEmptyArray(e(0,t.head(n)));for(var i=1;i<n.length;i++){r.push.apply(r,e(i,n[i]))}return r}};t.chainWithIndex=W;var F=function(e){return function(n){var r=e(n),i=r[0],o=r[1];var a=[i];var s=o;while(t.isNonEmpty(s)){var c=e(s),u=c[0],l=c[1];a.push(u);s=l}return a}};t.chop=F;var j=function(e){return function(n){var r=Math.max(1,e);return r>=n.length?[t.copy(n),[]]:[_function.pipe(n.slice(1,r),t.prepend(t.head(n))),n.slice(r)]}};t.splitAt=j;var V=function(e){return t.chop(t.splitAt(e))};t.chunksOf=V;var U=function(e,n){return _function.pipe(e,t.map(n))};var q=function(e,n){return _function.pipe(e,t.mapWithIndex(n))};var H=function(e,n){return _function.pipe(e,t.ap(n))};var z=function(e,n){return _function.pipe(e,t.chain(n))};var G=function(e,n){return _function.pipe(e,t.extend(n))};var $=function(e,n,r){return _function.pipe(e,t.reduce(n,r))};var K=function(e){var n=t.foldMap(e);return function(e,t){return _function.pipe(e,n(t))}};var J=function(e,n,r){return _function.pipe(e,t.reduceRight(n,r))};var Q=function(e){var n=t.traverse(e);return function(e,t){return _function.pipe(e,n(t))}};var X=function(e,n){return _function.pipe(e,t.alt(n))};var Y=function(e,n,r){return _function.pipe(e,t.reduceWithIndex(n,r))};var Z=function(e){var n=t.foldMapWithIndex(e);return function(e,t){return _function.pipe(e,n(t))}};var ee=function(e,n,r){return _function.pipe(e,t.reduceRightWithIndex(n,r))};var te=function(e){var n=t.traverseWithIndex(e);return function(e,t){return _function.pipe(e,n(t))}};var ne=function(e){return function(t){return k(t,e())}};t.altW=ne;t.alt=t.altW;var re=function(e){return t.chain((function(n){return _function.pipe(e,t.map(n))}))};t.ap=re;var ie=function(e){return t.chainWithIndex((function(t,n){return e(n)}))};t.chain=ie;var oe=function(e){return function(n){var r=t.tail(n);var i=[e(n)];while(t.isNonEmpty(r)){i.push(e(r));r=t.tail(r)}return i}};t.extend=oe;t.duplicate=t.extend(_function.identity);t.flatten=t.chain(_function.identity);var ae=function(e){return t.mapWithIndex((function(t,n){return e(n)}))};t.map=ae;var se=function(e){return function(n){var r=[e(0,t.head(n))];for(var i=1;i<n.length;i++){r.push(e(i,n[i]))}return r}};t.mapWithIndex=se;t.reduce=c.reduce;t.reduceWithIndex=c.reduceWithIndex;t.reduceRight=c.reduceRight;t.reduceRightWithIndex=c.reduceRightWithIndex;var ce=function(e){var n=t.traverseWithIndex(e);return function(e){return n((function(t,n){return e(n)}))}};t.traverse=ce;var ue=function(e){return t.traverseWithIndex(e)((function(e,t){return t}))};t.sequence=ue;var le=function(e){return function(n){return function(r){var i=e.map(n(0,t.head(r)),t.of);for(var o=1;o<r.length;o++){i=e.ap(e.map(i,(function(e){return function(n){return _function.pipe(e,t.append(n))}})),n(o,r[o]))}return i}}};t.traverseWithIndex=le;t.extract=c.head;t.URI="NonEmptyArray";t.getShow=c.getShow;var fe=function(){return{concat:k}};t.getSemigroup=fe;t.getEq=c.getEq;t.Functor={URI:t.URI,map:U};t.flap=Functor.flap(t.Functor);t.Pointed={URI:t.URI,of:t.of};t.FunctorWithIndex={URI:t.URI,map:U,mapWithIndex:q};t.Apply={URI:t.URI,map:U,ap:H};t.apFirst=Apply.apFirst(t.Apply);t.apSecond=Apply.apSecond(t.Apply);t.Applicative={URI:t.URI,map:U,ap:H,of:t.of};t.Chain={URI:t.URI,map:U,ap:H,chain:z};t.chainFirst=Chain.chainFirst(t.Chain);t.Monad={URI:t.URI,map:U,ap:H,of:t.of,chain:z};t.Foldable={URI:t.URI,reduce:$,foldMap:K,reduceRight:J};t.FoldableWithIndex={URI:t.URI,reduce:$,foldMap:K,reduceRight:J,reduceWithIndex:Y,foldMapWithIndex:Z,reduceRightWithIndex:ee};t.Traversable={URI:t.URI,map:U,reduce:$,foldMap:K,reduceRight:J,traverse:Q,sequence:t.sequence};t.TraversableWithIndex={URI:t.URI,map:U,mapWithIndex:q,reduce:$,foldMap:K,reduceRight:J,traverse:Q,sequence:t.sequence,reduceWithIndex:Y,foldMapWithIndex:Z,reduceRightWithIndex:ee,traverseWithIndex:te};t.Alt={URI:t.URI,map:U,alt:X};t.Comonad={URI:t.URI,map:U,extend:G,extract:t.extract};t.Do=t.of({});t.bindTo=Functor.bindTo(t.Functor);t.bind=Chain.bind(t.Chain);t.apS=Apply.apS(t.Apply);t.head=c.head;var he=function(e){return e.slice(1)};t.tail=he;t.last=c.last;var de=function(e){return e.slice(0,-1)};t.init=de;t.min=c.min;t.max=c.max;var pe=function(e){return function(t){return t.reduce(e.concat)}};t.concatAll=pe;function ve(e){return t.filterWithIndex((function(t,n){return e(n)}))}t.filter=ve;var me=function(e){return function(n){return t.fromArray(n.filter((function(t,n){return e(n,t)})))}};t.filterWithIndex=me;t.uncons=t.unprepend;t.unsnoc=t.unappend;function ge(e,n){return n===undefined?t.prepend(e):_function.pipe(n,t.prepend(e))}t.cons=ge;var ye=function(e,n){return _function.pipe(e,t.append(n))};t.snoc=ye;t.prependToAll=t.prependAll;t.fold=c.concatAll;t.nonEmptyArray={URI:t.URI,of:t.of,map:U,mapWithIndex:q,ap:H,chain:z,extend:G,extract:t.extract,reduce:$,foldMap:K,reduceRight:J,traverse:Q,sequence:t.sequence,reduceWithIndex:Y,foldMapWithIndex:Z,reduceRightWithIndex:ee,traverseWithIndex:te,alt:X}}));var Bounded=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.boundedNumber=void 0;t.boundedNumber={equals:Ord.ordNumber.equals,compare:Ord.ordNumber.compare,top:Infinity,bottom:-Infinity}}));var Field=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:true});t.fieldNumber=t.lcm=t.gcd=void 0;function n(e,t){var n=t.zero;var r=function(i,o){return e.equals(o,n)?i:r(o,t.mod(i,o))};return r}t.gcd=n;function r(e,t){var r=t.zero;var i=n(e,t);return function(n,o){return e.equals(n,r)||e.equals(o,r)?r:t.div(t.mul(n,o),i(n,o))}}t.lcm=r;t.fieldNumber={add:function(e,t){return e+t},zero:0,mul:function(e,t){return e*t},one:1,sub:function(e,t){return e-t},degree:function(e){return 1},div:function(e,t){return e/t},mod:function(e,t){return e%t}}}));var Show=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.showNumber=t.showString=t.showBoolean=t.getStructShow=t.getTupleShow=t.tuple=t.struct=void 0;var o=i(internal);var a=function(e){return{show:function(t){var n="{";for(var r in e){if(o.has.call(e,r)){n+=" "+r+": "+e[r].show(t[r])+","}}if(n.length>1){n=n.slice(0,-1)+" "}n+="}";return n}}};t.struct=a;var s=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return{show:function(t){return"["+t.map((function(t,n){return e[n].show(t)})).join(", ")+"]"}}};t.tuple=s;t.getTupleShow=t.tuple;t.getStructShow=t.struct;t.showBoolean={show:function(e){return JSON.stringify(e)}};t.showString={show:function(e){return JSON.stringify(e)}};t.showNumber={show:function(e){return JSON.stringify(e)}}}));var Monoid=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.monoidProduct=t.monoidSum=t.monoidString=t.getEndomorphismMonoid=t.getFunctionMonoid=t.monoidAny=t.monoidAll=t.fold=t.getMeetMonoid=t.getJoinMonoid=t.getDualMonoid=t.getStructMonoid=t.getTupleMonoid=t.concatAll=t.monoidVoid=t.tuple=t.struct=t.reverse=t.max=t.min=void 0;var o=i(internal);var a=i(Semigroup);var s=function(e){return{concat:a.min(e).concat,empty:e.top}};t.min=s;var c=function(e){return{concat:a.max(e).concat,empty:e.bottom}};t.max=c;var u=function(e){return{concat:a.reverse(e).concat,empty:e.empty}};t.reverse=u;var l=function(e){var t={};for(var n in e){if(o.has.call(e,n)){t[n]=e[n].empty}}return{concat:a.struct(e).concat,empty:t}};t.struct=l;var f=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return{concat:a.tuple.apply(a,e).concat,empty:e.map((function(e){return e.empty}))}};t.tuple=f;t.monoidVoid={concat:a.semigroupVoid.concat,empty:undefined};var h=function(e){return a.concatAll(e)(e.empty)};t.concatAll=h;t.getTupleMonoid=t.tuple;t.getStructMonoid=t.struct;t.getDualMonoid=t.reverse;t.getJoinMonoid=t.max;t.getMeetMonoid=t.min;t.fold=t.concatAll;t.monoidAll={concat:a.semigroupAll.concat,empty:true};t.monoidAny={concat:a.semigroupAny.concat,empty:false};t.getFunctionMonoid=_function.getMonoid;var d=function(){return t.reverse(_function.getEndomorphismMonoid())};t.getEndomorphismMonoid=d;t.monoidString={concat:a.semigroupString.concat,empty:""};t.monoidSum={concat:a.semigroupSum.concat,empty:0};t.monoidProduct={concat:a.semigroupProduct.concat,empty:1}}));var number=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.MonoidProduct=t.MonoidSum=t.SemigroupProduct=t.SemigroupSum=t.Show=t.Field=t.Bounded=t.Ord=t.Eq=void 0;var o=i(Bounded);var a=i(Eq);var s=i(Field);var c=i(Ord);var u=i(Show);t.Eq=a.eqNumber;t.Ord=c.ordNumber;t.Bounded=o.boundedNumber;t.Field=s.fieldNumber;t.Show=u.showNumber;t.SemigroupSum=Semigroup.semigroupSum;t.SemigroupProduct=Semigroup.semigroupProduct;t.MonoidSum=Monoid.monoidSum;t.MonoidProduct=Monoid.monoidProduct}));var ReadonlyArray=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.uniq=t.elem=t.rotate=t.intersperse=t.prependAll=t.unzip=t.zip=t.zipWith=t.sort=t.lefts=t.rights=t.reverse=t.modifyAt=t.deleteAt=t.updateAt=t.insertAt=t.findLastIndex=t.findLastMap=t.findLast=t.findFirstMap=t.findFirst=t.findIndex=t.dropLeftWhile=t.dropRight=t.dropLeft=t.spanLeft=t.takeLeftWhile=t.takeRight=t.takeLeft=t.init=t.tail=t.last=t.head=t.lookup=t.isOutOfBound=t.size=t.isNonEmpty=t.isEmpty=t.scanRight=t.scanLeft=t.chainWithIndex=t.foldRight=t.matchRight=t.foldLeft=t.matchLeft=t.replicate=t.range=t.makeBy=t.append=t.prepend=void 0;t.Pointed=t.flap=t.Functor=t.getOrd=t.getEq=t.getMonoid=t.getSemigroup=t.getShow=t.URI=t.unfold=t.wilt=t.wither=t.traverseWithIndex=t.sequence=t.traverse=t.reduceRightWithIndex=t.reduceRight=t.reduceWithIndex=t.foldMap=t.reduce=t.foldMapWithIndex=t.duplicate=t.extend=t.filterWithIndex=t.partitionMapWithIndex=t.partitionMap=t.partitionWithIndex=t.partition=t.compact=t.filterMap=t.filterMapWithIndex=t.filter=t.separate=t.mapWithIndex=t.map=t.flatten=t.chain=t.ap=t.alt=t.altW=t.zero=t.of=t.difference=t.intersection=t.union=t.comprehension=t.chunksOf=t.splitAt=t.chop=t.sortBy=void 0;t.readonlyArray=t.prependToAll=t.snoc=t.cons=t.apS=t.bind=t.bindTo=t.Do=t.some=t.every=t.empty=t.fromArray=t.toArray=t.unsafeDeleteAt=t.unsafeUpdateAt=t.unsafeInsertAt=t.Witherable=t.TraversableWithIndex=t.Traversable=t.FoldableWithIndex=t.Foldable=t.FilterableWithIndex=t.Filterable=t.Compactable=t.Extend=t.Alternative=t.Alt=t.Unfoldable=t.chainFirst=t.Monad=t.Chain=t.Applicative=t.apSecond=t.apFirst=t.Apply=t.FunctorWithIndex=void 0;var o=i(number);var a=i(Option$1);var s=i(ReadonlyNonEmptyArray);t.prepend=s.prepend;t.append=s.append;var c=function(e,n){return e<=0?t.empty:s.makeBy(e,n)};t.makeBy=c;var u=function(e,n){return e<=n?t.makeBy(n-e+1,(function(t){return e+t})):[e]};t.range=u;var l=function(e,n){return t.makeBy(e,(function(){return n}))};t.replicate=l;var f=function(e,n){return function(r){return t.isNonEmpty(r)?n(s.head(r),s.tail(r)):e()}};t.matchLeft=f;t.foldLeft=t.matchLeft;var h=function(e,n){return function(r){return t.isNonEmpty(r)?n(s.init(r),s.last(r)):e()}};t.matchRight=h;t.foldRight=t.matchRight;var d=function(e){return function(n){if(t.isEmpty(n)){return t.empty}var r=[];for(var i=0;i<n.length;i++){r.push.apply(r,e(i,n[i]))}return r}};t.chainWithIndex=d;var p=function(e,t){return function(n){var r=n.length;var i=new Array(r+1);i[0]=e;for(var o=0;o<r;o++){i[o+1]=t(i[o],n[o])}return i}};t.scanLeft=p;var v=function(e,t){return function(n){var r=n.length;var i=new Array(r+1);i[r]=e;for(var o=r-1;o>=0;o--){i[o]=t(n[o],i[o+1])}return i}};t.scanRight=v;var m=function(e){return e.length===0};t.isEmpty=m;t.isNonEmpty=s.isNonEmpty;var g=function(e){return e.length};t.size=g;t.isOutOfBound=s.isOutOfBound;function y(e,n){return n===undefined?function(t){return y(e,t)}:t.isOutOfBound(e,n)?a.none:a.some(n[e])}t.lookup=y;var b=function(e){return t.isNonEmpty(e)?a.some(s.head(e)):a.none};t.head=b;var w=function(e){return t.isNonEmpty(e)?a.some(s.last(e)):a.none};t.last=w;var x=function(e){return t.isNonEmpty(e)?a.some(s.tail(e)):a.none};t.tail=x;var S=function(e){return t.isNonEmpty(e)?a.some(s.init(e)):a.none};t.init=S;var k=function(e){return function(n){return t.isOutOfBound(e,n)?n:e===0?t.empty:n.slice(0,e)}};t.takeLeft=k;var C=function(e){return function(n){return t.isOutOfBound(e,n)?n:e===0?t.empty:n.slice(-e)}};t.takeRight=C;function A(e){return function(n){var r=[];for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!e(a)){break}r.push(a)}var s=r.length;return s===n.length?n:s===0?t.empty:r}}t.takeLeftWhile=A;var M=function(e,t){var n=e.length;var r=0;for(;r<n;r++){if(!t(e[r])){break}}return r};function I(e){return function(n){var r=t.splitAt(M(n,e))(n),i=r[0],o=r[1];return{init:i,rest:o}}}t.spanLeft=I;var E=function(e){return function(n){return e<=0||t.isEmpty(n)?n:e>=n.length?t.empty:n.slice(e,n.length)}};t.dropLeft=E;var R=function(e){return function(n){return e<=0||t.isEmpty(n)?n:e>=n.length?t.empty:n.slice(0,n.length-e)}};t.dropRight=R;var T=function(e){return function(n){var r=M(n,e);return r===0?n:r===n.length?t.empty:n.slice(r)}};t.dropLeftWhile=T;var P=function(e){return function(t){for(var n=0;n<t.length;n++){if(e(t[n])){return a.some(n)}}return a.none}};t.findIndex=P;function O(e){return function(t){for(var n=0;n<t.length;n++){if(e(t[n])){return a.some(t[n])}}return a.none}}t.findFirst=O;var D=function(e){return function(t){for(var n=0;n<t.length;n++){var r=e(t[n]);if(a.isSome(r)){return r}}return a.none}};t.findFirstMap=D;function B(e){return function(t){for(var n=t.length-1;n>=0;n--){if(e(t[n])){return a.some(t[n])}}return a.none}}t.findLast=B;var L=function(e){return function(t){for(var n=t.length-1;n>=0;n--){var r=e(t[n]);if(a.isSome(r)){return r}}return a.none}};t.findLastMap=L;var _=function(e){return function(t){for(var n=t.length-1;n>=0;n--){if(e(t[n])){return a.some(n)}}return a.none}};t.findLastIndex=_;t.insertAt=s.insertAt;var N=function(e,n){return t.modifyAt(e,(function(){return n}))};t.updateAt=N;var W=function(e){return function(n){return t.isOutOfBound(e,n)?a.none:a.some(t.unsafeDeleteAt(e,n))}};t.deleteAt=W;var F=function(e,n){return function(r){return t.isOutOfBound(e,r)?a.none:a.some(t.unsafeUpdateAt(e,n(r[e]),r))}};t.modifyAt=F;var j=function(e){return e.length<=1?e:e.slice().reverse()};t.reverse=j;var V=function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r._tag==="Right"){t.push(r.right)}}return t};t.rights=V;var U=function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r._tag==="Left"){t.push(r.left)}}return t};t.lefts=U;var q=function(e){return function(t){return t.length<=1?t:t.slice().sort(e.compare)}};t.sort=q;var H=function(e,t,n){var r=[];var i=Math.min(e.length,t.length);for(var o=0;o<i;o++){r[o]=n(e[o],t[o])}return r};t.zipWith=H;function z(e,n){if(n===undefined){return function(t){return z(t,e)}}return t.zipWith(e,n,(function(e,t){return[e,t]}))}t.zip=z;var G=function(e){var t=[];var n=[];for(var r=0;r<e.length;r++){t[r]=e[r][0];n[r]=e[r][1]}return[t,n]};t.unzip=G;var $=function(e){var n=s.prependAll(e);return function(e){return t.isNonEmpty(e)?n(e):e}};t.prependAll=$;var K=function(e){var n=s.intersperse(e);return function(e){return t.isNonEmpty(e)?n(e):e}};t.intersperse=K;var J=function(e){var n=s.rotate(e);return function(e){return t.isNonEmpty(e)?n(e):e}};t.rotate=J;function Q(e){return function(t,n){if(n===undefined){var r=Q(e);return function(e){return r(t,e)}}var i=function(n){return e.equals(n,t)};var o=0;for(;o<n.length;o++){if(i(n[o])){return true}}return false}}t.elem=Q;var X=function(e){var n=s.uniq(e);return function(e){return t.isNonEmpty(e)?n(e):e}};t.uniq=X;var Y=function(e){var n=s.sortBy(e);return function(e){return t.isNonEmpty(e)?n(e):e}};t.sortBy=Y;var Z=function(e){var n=s.chop(e);return function(e){return t.isNonEmpty(e)?n(e):t.empty}};t.chop=Z;var ee=function(e){return function(n){return e>=1&&t.isNonEmpty(n)?s.splitAt(e)(n):t.isEmpty(n)?[n,t.empty]:[t.empty,n]}};t.splitAt=ee;var te=function(e){var n=s.chunksOf(e);return function(e){return t.isNonEmpty(e)?n(e):t.empty}};t.chunksOf=te;function ne(e,n,r){if(r===void 0){r=function(){return true}}var i=function(e,o){return t.isNonEmpty(o)?_function.pipe(s.head(o),t.chain((function(n){return i(_function.pipe(e,t.append(n)),s.tail(o))}))):r.apply(void 0,e)?[n.apply(void 0,e)]:t.empty};return i(t.empty,e)}t.comprehension=ne;function re(e){var n=s.union(e);return function(r,i){if(i===undefined){var o=re(e);return function(e){return o(e,r)}}return t.isNonEmpty(r)&&t.isNonEmpty(i)?n(r,i):t.isNonEmpty(r)?r:i}}t.union=re;function ie(e){var t=Q(e);return function(n,r){if(r===undefined){var i=ie(e);return function(e){return i(e,n)}}return n.filter((function(e){return t(e,r)}))}}t.intersection=ie;function oe(e){var t=Q(e);return function(n,r){if(r===undefined){var i=oe(e);return function(e){return i(e,n)}}return n.filter((function(e){return!t(e,r)}))}}t.difference=oe;var ae=function(e,n){return _function.pipe(e,t.map(n))};var se=function(e,n){return _function.pipe(e,t.mapWithIndex(n))};var ce=function(e,n){return _function.pipe(e,t.ap(n))};var ue=function(e,n){return _function.pipe(e,t.chain(n))};var le=function(e,n){return _function.pipe(e,t.filter(n))};var fe=function(e,n){return _function.pipe(e,t.filterMap(n))};var he=function(e,n){return _function.pipe(e,t.partition(n))};var de=function(e,n){return _function.pipe(e,t.partitionMap(n))};var pe=function(e,n){return _function.pipe(e,t.partitionWithIndex(n))};var ve=function(e,n){return _function.pipe(e,t.partitionMapWithIndex(n))};var me=function(e,n){return _function.pipe(e,t.alt(n))};var ge=function(e,n,r){return _function.pipe(e,t.reduce(n,r))};var ye=function(e){var n=t.foldMap(e);return function(e,t){return _function.pipe(e,n(t))}};var be=function(e,n,r){return _function.pipe(e,t.reduceRight(n,r))};var we=function(e,n,r){return _function.pipe(e,t.reduceWithIndex(n,r))};var xe=function(e){var n=t.foldMapWithIndex(e);return function(e,t){return _function.pipe(e,n(t))}};var Se=function(e,n,r){return _function.pipe(e,t.reduceRightWithIndex(n,r))};var ke=function(e,n){return _function.pipe(e,t.filterMapWithIndex(n))};var Ce=function(e,n){return _function.pipe(e,t.filterWithIndex(n))};var Ae=function(e,n){return _function.pipe(e,t.extend(n))};var Me=function(e){var n=t.traverse(e);return function(e,t){return _function.pipe(e,n(t))}};var Ie=function(e){var n=t.traverseWithIndex(e);return function(e,t){return _function.pipe(e,n(t))}};var Ee=function(e){var n=t.wither(e);return function(e,t){return _function.pipe(e,n(t))}};var Re=function(e){var n=t.wilt(e);return function(e,t){return _function.pipe(e,n(t))}};t.of=s.of;var Te=function(){return t.empty};t.zero=Te;var Pe=function(e){return function(t){return t.concat(e())}};t.altW=Pe;t.alt=t.altW;var Oe=function(e){return t.chain((function(n){return _function.pipe(e,t.map(n))}))};t.ap=Oe;var De=function(e){return function(n){return _function.pipe(n,t.chainWithIndex((function(t,n){return e(n)})))}};t.chain=De;t.flatten=t.chain(_function.identity);var Be=function(e){return function(t){return t.map((function(t){return e(t)}))}};t.map=Be;var Le=function(e){return function(t){return t.map((function(t,n){return e(n,t)}))}};t.mapWithIndex=Le;var _e=function(e){var t=[];var n=[];for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o._tag==="Left"){t.push(o.left)}else{n.push(o.right)}}return Separated.separated(t,n)};t.separate=_e;var Ne=function(e){return function(t){return t.filter(e)}};t.filter=Ne;var We=function(e){return function(t){var n=[];for(var r=0;r<t.length;r++){var i=e(r,t[r]);if(a.isSome(i)){n.push(i.value)}}return n}};t.filterMapWithIndex=We;var Fe=function(e){return t.filterMapWithIndex((function(t,n){return e(n)}))};t.filterMap=Fe;t.compact=t.filterMap(_function.identity);var je=function(e){return t.partitionWithIndex((function(t,n){return e(n)}))};t.partition=je;var Ve=function(e){return function(t){var n=[];var r=[];for(var i=0;i<t.length;i++){var o=t[i];if(e(i,o)){r.push(o)}else{n.push(o)}}return Separated.separated(n,r)}};t.partitionWithIndex=Ve;var Ue=function(e){return t.partitionMapWithIndex((function(t,n){return e(n)}))};t.partitionMap=Ue;var qe=function(e){return function(t){var n=[];var r=[];for(var i=0;i<t.length;i++){var o=e(i,t[i]);if(o._tag==="Left"){n.push(o.left)}else{r.push(o.right)}}return Separated.separated(n,r)}};t.partitionMapWithIndex=qe;var He=function(e){return function(t){return t.filter((function(t,n){return e(n,t)}))}};t.filterWithIndex=He;var ze=function(e){return function(t){return t.map((function(n,r){return e(t.slice(r))}))}};t.extend=ze;t.duplicate=t.extend(_function.identity);var Ge=function(e){return function(t){return function(n){return n.reduce((function(n,r,i){return e.concat(n,t(i,r))}),e.empty)}}};t.foldMapWithIndex=Ge;var $e=function(e,n){return t.reduceWithIndex(e,(function(e,t,r){return n(t,r)}))};t.reduce=$e;var Ke=function(e){var n=t.foldMapWithIndex(e);return function(e){return n((function(t,n){return e(n)}))}};t.foldMap=Ke;var Je=function(e,t){return function(n){var r=n.length;var i=e;for(var o=0;o<r;o++){i=t(o,i,n[o])}return i}};t.reduceWithIndex=Je;var Qe=function(e,n){return t.reduceRightWithIndex(e,(function(e,t,r){return n(t,r)}))};t.reduceRight=Qe;var Xe=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}};t.reduceRightWithIndex=Xe;var Ye=function(e){var n=t.traverseWithIndex(e);return function(e){return n((function(t,n){return e(n)}))}};t.traverse=Ye;var Ze=function(e){return function(n){return ge(n,e.of(t.zero()),(function(n,r){return e.ap(e.map(n,(function(e){return function(n){return _function.pipe(e,t.append(n))}})),r)}))}};t.sequence=Ze;var et=function(e){return function(n){return t.reduceWithIndex(e.of(t.zero()),(function(r,i,o){return e.ap(e.map(i,(function(e){return function(n){return _function.pipe(e,t.append(n))}})),n(r,o))}))}};t.traverseWithIndex=et;var tt=function(e){var n=t.traverse(e);return function(r){return function(i){return e.map(_function.pipe(i,n(r)),t.compact)}}};t.wither=tt;var nt=function(e){var n=t.traverse(e);return function(r){return function(i){return e.map(_function.pipe(i,n(r)),t.separate)}}};t.wilt=nt;var rt=function(e,t){var n=[];var r=e;while(true){var i=t(r);if(a.isSome(i)){var o=i.value,s=o[0],c=o[1];n.push(s);r=c}else{break}}return n};t.unfold=rt;t.URI="ReadonlyArray";var it=function(e){return{show:function(t){return"["+t.map(e.show).join(", ")+"]"}}};t.getShow=it;var ot=function(){return{concat:function(e,n){return t.isEmpty(e)?n:t.isEmpty(n)?e:e.concat(n)}}};t.getSemigroup=ot;var at=function(){return{concat:t.getSemigroup().concat,empty:t.empty}};t.getMonoid=at;var st=function(e){return Eq.fromEquals((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))};t.getEq=st;var ct=function(e){return Ord.fromCompare((function(t,n){var r=t.length;var i=n.length;var a=Math.min(r,i);for(var s=0;s<a;s++){var c=e.compare(t[s],n[s]);if(c!==0){return c}}return o.Ord.compare(r,i)}))};t.getOrd=ct;t.Functor={URI:t.URI,map:ae};t.flap=Functor.flap(t.Functor);t.Pointed={URI:t.URI,of:t.of};t.FunctorWithIndex={URI:t.URI,map:ae,mapWithIndex:se};t.Apply={URI:t.URI,map:ae,ap:ce};t.apFirst=Apply.apFirst(t.Apply);t.apSecond=Apply.apSecond(t.Apply);t.Applicative={URI:t.URI,map:ae,ap:ce,of:t.of};t.Chain={URI:t.URI,map:ae,ap:ce,chain:ue};t.Monad={URI:t.URI,map:ae,ap:ce,of:t.of,chain:ue};t.chainFirst=Chain.chainFirst(t.Chain);t.Unfoldable={URI:t.URI,unfold:t.unfold};t.Alt={URI:t.URI,map:ae,alt:me};t.Alternative={URI:t.URI,map:ae,ap:ce,of:t.of,alt:me,zero:t.zero};t.Extend={URI:t.URI,map:ae,extend:Ae};t.Compactable={URI:t.URI,compact:t.compact,separate:t.separate};t.Filterable={URI:t.URI,map:ae,compact:t.compact,separate:t.separate,filter:le,filterMap:fe,partition:he,partitionMap:de};t.FilterableWithIndex={URI:t.URI,map:ae,mapWithIndex:se,compact:t.compact,separate:t.separate,filter:le,filterMap:fe,partition:he,partitionMap:de,partitionMapWithIndex:ve,partitionWithIndex:pe,filterMapWithIndex:ke,filterWithIndex:Ce};t.Foldable={URI:t.URI,reduce:ge,foldMap:ye,reduceRight:be};t.FoldableWithIndex={URI:t.URI,reduce:ge,foldMap:ye,reduceRight:be,reduceWithIndex:we,foldMapWithIndex:xe,reduceRightWithIndex:Se};t.Traversable={URI:t.URI,map:ae,reduce:ge,foldMap:ye,reduceRight:be,traverse:Me,sequence:t.sequence};t.TraversableWithIndex={URI:t.URI,map:ae,mapWithIndex:se,reduce:ge,foldMap:ye,reduceRight:be,reduceWithIndex:we,foldMapWithIndex:xe,reduceRightWithIndex:Se,traverse:Me,sequence:t.sequence,traverseWithIndex:Ie};t.Witherable={URI:t.URI,map:ae,compact:t.compact,separate:t.separate,filter:le,filterMap:fe,partition:he,partitionMap:de,reduce:ge,foldMap:ye,reduceRight:be,traverse:Me,sequence:t.sequence,wither:Ee,wilt:Re};t.unsafeInsertAt=s.unsafeInsertAt;var ut=function(e,n,r){return t.isNonEmpty(r)?s.unsafeUpdateAt(e,n,r):r};t.unsafeUpdateAt=ut;var lt=function(e,t){var n=t.slice();n.splice(e,1);return n};t.unsafeDeleteAt=lt;var ft=function(e){return e.slice()};t.toArray=ft;var ht=function(e){return t.isEmpty(e)?t.empty:e.slice()};t.fromArray=ht;t.empty=s.empty;var dt=function(e){return function(t){return t.every(e)}};t.every=dt;var pt=function(e){return function(t){return t.some(e)}};t.some=pt;t.Do=t.of({});t.bindTo=Functor.bindTo(t.Functor);t.bind=Chain.bind(t.Chain);t.apS=Apply.apS(t.Apply);t.cons=s.cons;t.snoc=s.snoc;t.prependToAll=t.prependAll;t.readonlyArray={URI:t.URI,compact:t.compact,separate:t.separate,map:ae,ap:ce,of:t.of,chain:ue,filter:le,filterMap:fe,partition:he,partitionMap:de,mapWithIndex:se,partitionMapWithIndex:ve,partitionWithIndex:pe,filterMapWithIndex:ke,filterWithIndex:Ce,alt:me,zero:t.zero,unfold:t.unfold,reduce:ge,foldMap:ye,reduceRight:be,traverse:Me,sequence:t.sequence,reduceWithIndex:we,foldMapWithIndex:xe,reduceRightWithIndex:Se,traverseWithIndex:Ie,extend:Ae,wither:Ee,wilt:Re}}));var _Array=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){if(r===undefined)r=n;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[n]}})}:function(e,t,n,r){if(r===undefined)r=n;e[r]=t[n]});var r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.prototype.hasOwnProperty.call(e,i))n(t,e,i);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.elem=t.rotate=t.intersperse=t.prependAll=t.unzip=t.zip=t.zipWith=t.sort=t.lefts=t.rights=t.reverse=t.modifyAt=t.deleteAt=t.updateAt=t.insertAt=t.copy=t.findLastIndex=t.findLastMap=t.findLast=t.findFirstMap=t.findFirst=t.findIndex=t.dropLeftWhile=t.dropRight=t.dropLeft=t.spanLeft=t.takeLeftWhile=t.takeRight=t.takeLeft=t.init=t.tail=t.last=t.head=t.lookup=t.isOutOfBound=t.size=t.isNonEmpty=t.isEmpty=t.scanRight=t.scanLeft=t.chainWithIndex=t.foldRight=t.matchRight=t.foldLeft=t.matchLeft=t.replicate=t.range=t.makeBy=t.append=t.prepend=void 0;t.flap=t.Functor=t.getOrd=t.getEq=t.getMonoid=t.getSemigroup=t.getShow=t.URI=t.unfold=t.wilt=t.wither=t.traverseWithIndex=t.sequence=t.traverse=t.reduceRightWithIndex=t.reduceRight=t.reduceWithIndex=t.reduce=t.foldMapWithIndex=t.foldMap=t.duplicate=t.extend=t.filterWithIndex=t.alt=t.altW=t.partitionMapWithIndex=t.partitionMap=t.partitionWithIndex=t.partition=t.filter=t.separate=t.compact=t.filterMap=t.filterMapWithIndex=t.mapWithIndex=t.flatten=t.chain=t.ap=t.map=t.zero=t.of=t.difference=t.intersection=t.union=t.comprehension=t.chunksOf=t.splitAt=t.chop=t.sortBy=t.uniq=void 0;t.array=t.prependToAll=t.snoc=t.cons=t.empty=t.apS=t.bind=t.bindTo=t.Do=t.some=t.every=t.unsafeDeleteAt=t.unsafeUpdateAt=t.unsafeInsertAt=t.Witherable=t.TraversableWithIndex=t.Traversable=t.FoldableWithIndex=t.Foldable=t.FilterableWithIndex=t.Filterable=t.Compactable=t.Extend=t.Alternative=t.Alt=t.Unfoldable=t.Monad=t.chainFirst=t.Chain=t.Applicative=t.apSecond=t.apFirst=t.Apply=t.FunctorWithIndex=t.Pointed=void 0;var o=i(NonEmptyArray);var a=i(Option$1);var s=i(ReadonlyArray);t.prepend=o.prepend;t.append=o.append;var c=function(e,t){return e<=0?[]:o.makeBy(e,t)};t.makeBy=c;var u=function(e,n){return e<=n?t.makeBy(n-e+1,(function(t){return e+t})):[e]};t.range=u;var l=function(e,n){return t.makeBy(e,(function(){return n}))};t.replicate=l;var f=function(e,n){return function(r){return t.isNonEmpty(r)?n(o.head(r),o.tail(r)):e()}};t.matchLeft=f;t.foldLeft=t.matchLeft;var h=function(e,n){return function(r){return t.isNonEmpty(r)?n(o.init(r),o.last(r)):e()}};t.matchRight=h;t.foldRight=t.matchRight;var d=function(e){return function(t){var n=[];for(var r=0;r<t.length;r++){n.push.apply(n,e(r,t[r]))}return n}};t.chainWithIndex=d;var p=function(e,t){return function(n){var r=n.length;var i=new Array(r+1);i[0]=e;for(var o=0;o<r;o++){i[o+1]=t(i[o],n[o])}return i}};t.scanLeft=p;var v=function(e,t){return function(n){var r=n.length;var i=new Array(r+1);i[r]=e;for(var o=r-1;o>=0;o--){i[o]=t(n[o],i[o+1])}return i}};t.scanRight=v;t.isEmpty=s.isEmpty;t.isNonEmpty=o.isNonEmpty;var m=function(e){return e.length};t.size=m;t.isOutOfBound=o.isOutOfBound;t.lookup=s.lookup;t.head=s.head;t.last=s.last;var g=function(e){return t.isNonEmpty(e)?a.some(o.tail(e)):a.none};t.tail=g;var y=function(e){return t.isNonEmpty(e)?a.some(o.init(e)):a.none};t.init=y;var b=function(e){return function(n){return t.isOutOfBound(e,n)?t.copy(n):n.slice(0,e)}};t.takeLeft=b;var w=function(e){return function(n){return t.isOutOfBound(e,n)?t.copy(n):e===0?[]:n.slice(-e)}};t.takeRight=w;function x(e){return function(t){var n=[];for(var r=0,i=t;r<i.length;r++){var o=i[r];if(!e(o)){break}n.push(o)}return n}}t.takeLeftWhile=x;var S=function(e,t){var n=e.length;var r=0;for(;r<n;r++){if(!t(e[r])){break}}return r};function k(e){return function(n){var r=t.splitAt(S(n,e))(n),i=r[0],o=r[1];return{init:i,rest:o}}}t.spanLeft=k;var C=function(e){return function(n){return e<=0||t.isEmpty(n)?t.copy(n):e>=n.length?[]:n.slice(e,n.length)}};t.dropLeft=C;var A=function(e){return function(n){return e<=0||t.isEmpty(n)?t.copy(n):e>=n.length?[]:n.slice(0,n.length-e)}};t.dropRight=A;var M=function(e){return function(t){return t.slice(S(t,e))}};t.dropLeftWhile=M;t.findIndex=s.findIndex;function I(e){return s.findFirst(e)}t.findFirst=I;t.findFirstMap=s.findFirstMap;function E(e){return s.findLast(e)}t.findLast=E;t.findLastMap=s.findLastMap;t.findLastIndex=s.findLastIndex;var R=function(e){return e.slice()};t.copy=R;var T=function(e,n){return function(r){return e<0||e>r.length?a.none:a.some(t.unsafeInsertAt(e,n,r))}};t.insertAt=T;var P=function(e,n){return t.modifyAt(e,(function(){return n}))};t.updateAt=P;var O=function(e){return function(n){return t.isOutOfBound(e,n)?a.none:a.some(t.unsafeDeleteAt(e,n))}};t.deleteAt=O;var D=function(e,n){return function(r){return t.isOutOfBound(e,r)?a.none:a.some(t.unsafeUpdateAt(e,n(r[e]),r))}};t.modifyAt=D;var B=function(e){return t.isEmpty(e)?[]:e.slice().reverse()};t.reverse=B;var L=function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r._tag==="Right"){t.push(r.right)}}return t};t.rights=L;var _=function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r._tag==="Left"){t.push(r.left)}}return t};t.lefts=_;var N=function(e){return function(n){return n.length<=1?t.copy(n):n.slice().sort(e.compare)}};t.sort=N;var W=function(e,t,n){var r=[];var i=Math.min(e.length,t.length);for(var o=0;o<i;o++){r[o]=n(e[o],t[o])}return r};t.zipWith=W;function F(e,n){if(n===undefined){return function(t){return F(t,e)}}return t.zipWith(e,n,(function(e,t){return[e,t]}))}t.zip=F;var j=function(e){var t=[];var n=[];for(var r=0;r<e.length;r++){t[r]=e[r][0];n[r]=e[r][1]}return[t,n]};t.unzip=j;var V=function(e){var n=o.prependAll(e);return function(e){return t.isNonEmpty(e)?n(e):[]}};t.prependAll=V;var U=function(e){var n=o.intersperse(e);return function(e){return t.isNonEmpty(e)?n(e):t.copy(e)}};t.intersperse=U;var q=function(e){var n=o.rotate(e);return function(e){return t.isNonEmpty(e)?n(e):t.copy(e)}};t.rotate=q;t.elem=s.elem;var H=function(e){var n=o.uniq(e);return function(e){return t.isNonEmpty(e)?n(e):t.copy(e)}};t.uniq=H;var z=function(e){var n=o.sortBy(e);return function(e){return t.isNonEmpty(e)?n(e):t.copy(e)}};t.sortBy=z;var G=function(e){var n=o.chop(e);return function(e){return t.isNonEmpty(e)?n(e):[]}};t.chop=G;var $=function(e){return function(n){return e>=1&&t.isNonEmpty(n)?o.splitAt(e)(n):t.isEmpty(n)?[t.copy(n),[]]:[[],t.copy(n)]}};t.splitAt=$;var K=function(e){var n=o.chunksOf(e);return function(e){return t.isNonEmpty(e)?n(e):[]}};t.chunksOf=K;function J(e,n,r){if(r===void 0){r=function(){return true}}var i=function(e,a){return t.isNonEmpty(a)?_function.pipe(o.head(a),t.chain((function(n){return i(_function.pipe(e,t.append(n)),o.tail(a))}))):r.apply(void 0,e)?[n.apply(void 0,e)]:[]};return i([],e)}t.comprehension=J;function Q(e){var n=o.union(e);return function(r,i){if(i===undefined){var o=Q(e);return function(e){return o(e,r)}}return t.isNonEmpty(r)&&t.isNonEmpty(i)?n(r,i):t.isNonEmpty(r)?t.copy(r):t.copy(i)}}t.union=Q;function X(e){var n=t.elem(e);return function(t,r){if(r===undefined){var i=X(e);return function(e){return i(e,t)}}return t.filter((function(e){return n(e,r)}))}}t.intersection=X;function Y(e){var n=t.elem(e);return function(t,r){if(r===undefined){var i=Y(e);return function(e){return i(e,t)}}return t.filter((function(e){return!n(e,r)}))}}t.difference=Y;var Z=function(e,n){return _function.pipe(e,t.map(n))};var ee=function(e,n){return _function.pipe(e,t.mapWithIndex(n))};var te=function(e,n){return _function.pipe(e,t.ap(n))};var ne=function(e,n){return _function.pipe(e,t.chain(n))};var re=function(e,n){return _function.pipe(e,t.filter(n))};var ie=function(e,n){return _function.pipe(e,t.filterMap(n))};var oe=function(e,n){return _function.pipe(e,t.partition(n))};var ae=function(e,n){return _function.pipe(e,t.partitionMap(n))};var se=function(e,n){return _function.pipe(e,t.partitionWithIndex(n))};var ce=function(e,n){return _function.pipe(e,t.partitionMapWithIndex(n))};var ue=function(e,n){return _function.pipe(e,t.alt(n))};var le=function(e,n,r){return _function.pipe(e,t.reduce(n,r))};var fe=function(e){var n=t.foldMap(e);return function(e,t){return _function.pipe(e,n(t))}};var he=function(e,n,r){return _function.pipe(e,t.reduceRight(n,r))};var de=function(e,n,r){return _function.pipe(e,t.reduceWithIndex(n,r))};var pe=function(e){var n=t.foldMapWithIndex(e);return function(e,t){return _function.pipe(e,n(t))}};var ve=function(e,n,r){return _function.pipe(e,t.reduceRightWithIndex(n,r))};var me=function(e,n){return _function.pipe(e,t.filterMapWithIndex(n))};var ge=function(e,n){return _function.pipe(e,t.filterWithIndex(n))};var ye=function(e,n){return _function.pipe(e,t.extend(n))};var be=function(e){var n=t.traverse(e);return function(e,t){return _function.pipe(e,n(t))}};var we=function(e){var n=t.traverseWithIndex(e);return function(e,t){return _function.pipe(e,n(t))}};var xe=function(e){var n=t.wither(e);return function(e,t){return _function.pipe(e,n(t))}};var Se=function(e){var n=t.wilt(e);return function(e,t){return _function.pipe(e,n(t))}};t.of=o.of;var ke=function(){return[]};t.zero=ke;var Ce=function(e){return function(t){return t.map((function(t){return e(t)}))}};t.map=Ce;var Ae=function(e){return t.chain((function(n){return _function.pipe(e,t.map(n))}))};t.ap=Ae;var Me=function(e){return function(n){return _function.pipe(n,t.chainWithIndex((function(t,n){return e(n)})))}};t.chain=Me;t.flatten=t.chain(_function.identity);var Ie=function(e){return function(t){return t.map((function(t,n){return e(n,t)}))}};t.mapWithIndex=Ie;var Ee=function(e){return function(t){var n=[];for(var r=0;r<t.length;r++){var i=e(r,t[r]);if(a.isSome(i)){n.push(i.value)}}return n}};t.filterMapWithIndex=Ee;var Re=function(e){return t.filterMapWithIndex((function(t,n){return e(n)}))};t.filterMap=Re;t.compact=t.filterMap(_function.identity);var Te=function(e){var t=[];var n=[];for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o._tag==="Left"){t.push(o.left)}else{n.push(o.right)}}return Separated.separated(t,n)};t.separate=Te;var Pe=function(e){return function(t){return t.filter(e)}};t.filter=Pe;var Oe=function(e){return t.partitionWithIndex((function(t,n){return e(n)}))};t.partition=Oe;var De=function(e){return function(t){var n=[];var r=[];for(var i=0;i<t.length;i++){var o=t[i];if(e(i,o)){r.push(o)}else{n.push(o)}}return Separated.separated(n,r)}};t.partitionWithIndex=De;var Be=function(e){return t.partitionMapWithIndex((function(t,n){return e(n)}))};t.partitionMap=Be;var Le=function(e){return function(t){var n=[];var r=[];for(var i=0;i<t.length;i++){var o=e(i,t[i]);if(o._tag==="Left"){n.push(o.left)}else{r.push(o.right)}}return Separated.separated(n,r)}};t.partitionMapWithIndex=Le;var _e=function(e){return function(t){return t.concat(e())}};t.altW=_e;t.alt=t.altW;var Ne=function(e){return function(t){return t.filter((function(t,n){return e(n,t)}))}};t.filterWithIndex=Ne;var We=function(e){return function(t){return t.map((function(n,r){return e(t.slice(r))}))}};t.extend=We;t.duplicate=t.extend(_function.identity);t.foldMap=s.foldMap;t.foldMapWithIndex=s.foldMapWithIndex;t.reduce=s.reduce;t.reduceWithIndex=s.reduceWithIndex;t.reduceRight=s.reduceRight;t.reduceRightWithIndex=s.reduceRightWithIndex;var Fe=function(e){var n=t.traverseWithIndex(e);return function(e){return n((function(t,n){return e(n)}))}};t.traverse=Fe;var je=function(e){return function(n){return le(n,e.of(t.zero()),(function(n,r){return e.ap(e.map(n,(function(e){return function(n){return _function.pipe(e,t.append(n))}})),r)}))}};t.sequence=je;var Ve=function(e){return function(n){return t.reduceWithIndex(e.of(t.zero()),(function(r,i,o){return e.ap(e.map(i,(function(e){return function(n){return _function.pipe(e,t.append(n))}})),n(r,o))}))}};t.traverseWithIndex=Ve;var Ue=function(e){var n=t.traverse(e);return function(r){return function(i){return e.map(_function.pipe(i,n(r)),t.compact)}}};t.wither=Ue;var qe=function(e){var n=t.traverse(e);return function(r){return function(i){return e.map(_function.pipe(i,n(r)),t.separate)}}};t.wilt=qe;var He=function(e,t){var n=[];var r=e;while(true){var i=t(r);if(a.isSome(i)){var o=i.value,s=o[0],c=o[1];n.push(s);r=c}else{break}}return n};t.unfold=He;t.URI="Array";t.getShow=s.getShow;var ze=function(){return{concat:function(e,t){return e.concat(t)}}};t.getSemigroup=ze;var Ge=function(){return{concat:t.getSemigroup().concat,empty:[]}};t.getMonoid=Ge;t.getEq=s.getEq;t.getOrd=s.getOrd;t.Functor={URI:t.URI,map:Z};t.flap=Functor.flap(t.Functor);t.Pointed={URI:t.URI,of:t.of};t.FunctorWithIndex={URI:t.URI,map:Z,mapWithIndex:ee};t.Apply={URI:t.URI,map:Z,ap:te};t.apFirst=Apply.apFirst(t.Apply);t.apSecond=Apply.apSecond(t.Apply);t.Applicative={URI:t.URI,map:Z,ap:te,of:t.of};t.Chain={URI:t.URI,map:Z,ap:te,chain:ne};t.chainFirst=Chain.chainFirst(t.Chain);t.Monad={URI:t.URI,map:Z,ap:te,of:t.of,chain:ne};t.Unfoldable={URI:t.URI,unfold:t.unfold};t.Alt={URI:t.URI,map:Z,alt:ue};t.Alternative={URI:t.URI,map:Z,ap:te,of:t.of,alt:ue,zero:t.zero};t.Extend={URI:t.URI,map:Z,extend:ye};t.Compactable={URI:t.URI,compact:t.compact,separate:t.separate};t.Filterable={URI:t.URI,map:Z,compact:t.compact,separate:t.separate,filter:re,filterMap:ie,partition:oe,partitionMap:ae};t.FilterableWithIndex={URI:t.URI,map:Z,mapWithIndex:ee,compact:t.compact,separate:t.separate,filter:re,filterMap:ie,partition:oe,partitionMap:ae,partitionMapWithIndex:ce,partitionWithIndex:se,filterMapWithIndex:me,filterWithIndex:ge};t.Foldable={URI:t.URI,reduce:le,foldMap:fe,reduceRight:he};t.FoldableWithIndex={URI:t.URI,reduce:le,foldMap:fe,reduceRight:he,reduceWithIndex:de,foldMapWithIndex:pe,reduceRightWithIndex:ve};t.Traversable={URI:t.URI,map:Z,reduce:le,foldMap:fe,reduceRight:he,traverse:be,sequence:t.sequence};t.TraversableWithIndex={URI:t.URI,map:Z,mapWithIndex:ee,reduce:le,foldMap:fe,reduceRight:he,reduceWithIndex:de,foldMapWithIndex:pe,reduceRightWithIndex:ve,traverse:be,sequence:t.sequence,traverseWithIndex:we};t.Witherable={URI:t.URI,map:Z,compact:t.compact,separate:t.separate,filter:re,filterMap:ie,partition:oe,partitionMap:ae,reduce:le,foldMap:fe,reduceRight:he,traverse:be,sequence:t.sequence,wither:xe,wilt:Se};t.unsafeInsertAt=o.unsafeInsertAt;var $e=function(e,n,r){return t.isNonEmpty(r)?o.unsafeUpdateAt(e,n,r):[]};t.unsafeUpdateAt=$e;var Ke=function(e,t){var n=t.slice();n.splice(e,1);return n};t.unsafeDeleteAt=Ke;t.every=s.every;var Je=function(e){return function(t){return t.some(e)}};t.some=Je;t.Do=t.of({});t.bindTo=Functor.bindTo(t.Functor);t.bind=Chain.bind(t.Chain);t.apS=Apply.apS(t.Apply);t.empty=[];t.cons=o.cons;t.snoc=o.snoc;t.prependToAll=t.prependAll;t.array={URI:t.URI,compact:t.compact,separate:t.separate,map:Z,ap:te,of:t.of,chain:ne,filter:re,filterMap:ie,partition:oe,partitionMap:ae,mapWithIndex:ee,partitionMapWithIndex:ce,partitionWithIndex:se,filterMapWithIndex:me,filterWithIndex:ge,alt:ue,zero:t.zero,unfold:t.unfold,reduce:le,foldMap:fe,reduceRight:he,traverse:be,sequence:t.sequence,reduceWithIndex:de,foldMapWithIndex:pe,reduceRightWithIndex:ve,traverseWithIndex:we,extend:ye,wither:xe,wilt:Se}}));var preferredImageObjectComponent=function(e){var t=e.content;if(t&&t.length>0){for(var n=0,r=t;n<r.length;n++){var i=r[n];if(isPlotlyObject(i))return h("stencila-image-plotly",{config:i.config,data:i.data,layout:i.layout},h("picture",null,h("stencila-image-object",{image:e})));if(isVegaObject(i)){return h("stencila-image-vega",{spec:i.spec,options:i.options},h("picture",null,h("stencila-image-object",{image:e})))}}}return h("stencila-image-object",{image:e})};var defaultNodeListCss="*.sc-stencila-node-list-default,.sc-stencila-node-list-default:after,.sc-stencila-node-list-default:before{border:0 solid;-webkit-box-sizing:border-box;box-sizing:border-box}html.sc-stencila-node-list-default{font-size:16px}.hidden.sc-stencila-node-list-default{display:none}code.sc-stencila-node-list-default,code[class*=language-].sc-stencila-node-list-default,output.sc-stencila-node-list-default{font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:75%}pre.sc-stencila-node-list-default{border:1px solid #cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-radius:.25rem;margin:.5rem;overflow:auto;padding:.5rem}.sc-stencila-node-list-default-h,stencila-node-list.sc-stencila-node-list-default{display:block}.sc-stencila-node-list-default-h .hidden.sc-stencila-node-list-default+.sc-stencila-node-list-default:nth-child(2),.sc-stencila-node-list-default-h>.sc-stencila-node-list-default:first-child,stencila-node-list.sc-stencila-node-list-default .hidden.sc-stencila-node-list-default+.sc-stencila-node-list-default:nth-child(2),stencila-node-list.sc-stencila-node-list-default>.sc-stencila-node-list-default:first-child{border-top-width:0;margin-top:0;padding-top:0}.sc-stencila-node-list-default-h>.sc-stencila-node-list-default:last-child,stencila-node-list.sc-stencila-node-list-default>.sc-stencila-node-list-default:last-child{margin-bottom:0}.sc-stencila-node-list-default-h .hidden.sc-stencila-node-list-default,stencila-node-list.sc-stencila-node-list-default .hidden.sc-stencila-node-list-default{display:none}.sc-stencila-node-list-default-h .emptyContentMessage.sc-stencila-node-list-default,stencila-node-list.sc-stencila-node-list-default .emptyContentMessage.sc-stencila-node-list-default{color:#6e7591;color:var(--color-neutral-500,#6e7591);font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:1rem;line-height:1.5rem}.sc-stencila-node-list-default-h stencila-code-error.sc-stencila-node-list-default,stencila-node-list.sc-stencila-node-list-default stencila-code-error.sc-stencila-node-list-default{border-width:0}.sc-stencila-node-list-default-h stencila-image-object.sc-stencila-node-list-default,stencila-node-list.sc-stencila-node-list-default stencila-image-object.sc-stencila-node-list-default{display:block;height:auto;max-width:100%}.sc-stencila-node-list-default-h .sc-stencila-node-list-default-s>[slot=outputs],.sc-stencila-node-list-default-h>*.sc-stencila-node-list-default,.sc-stencila-node-list-default-h figure.sc-stencila-node-list-default,stencila-node-list.sc-stencila-node-list-default-s>[slot=outputs],stencila-node-list .sc-stencila-node-list-default-s>[slot=outputs],stencila-node-list.sc-stencila-node-list-default>*.sc-stencila-node-list-default,stencila-node-list.sc-stencila-node-list-default figure.sc-stencila-node-list-default{margin:0;overflow:auto;padding:0}.sc-stencila-node-list-default-h .sc-stencila-node-list-default-s>[slot=outputs]:first-child,.sc-stencila-node-list-default-h>.sc-stencila-node-list-default:first-child,.sc-stencila-node-list-default-h figure.sc-stencila-node-list-default:first-child,stencila-node-list.sc-stencila-node-list-default-s>[slot=outputs]:first-child,stencila-node-list .sc-stencila-node-list-default-s>[slot=outputs]:first-child,stencila-node-list.sc-stencila-node-list-default>.sc-stencila-node-list-default:first-child,stencila-node-list.sc-stencila-node-list-default figure.sc-stencila-node-list-default:first-child{margin-top:0}.sc-stencila-node-list-default-h .sc-stencila-node-list-default-s>[slot=outputs] pre,.sc-stencila-node-list-default-h>*.sc-stencila-node-list-default pre.sc-stencila-node-list-default,.sc-stencila-node-list-default-h figure.sc-stencila-node-list-default pre.sc-stencila-node-list-default,stencila-node-list.sc-stencila-node-list-default-s>[slot=outputs] pre,stencila-node-list .sc-stencila-node-list-default-s>[slot=outputs] pre,stencila-node-list.sc-stencila-node-list-default>*.sc-stencila-node-list-default pre.sc-stencila-node-list-default,stencila-node-list.sc-stencila-node-list-default figure.sc-stencila-node-list-default pre.sc-stencila-node-list-default{border-width:0;margin:0;padding:0}.sc-stencila-node-list-default-h .sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption),.sc-stencila-node-list-default-h>*.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption),.sc-stencila-node-list-default-h figure.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption),stencila-node-list.sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption),stencila-node-list .sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption),stencila-node-list.sc-stencila-node-list-default>*.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption),stencila-node-list.sc-stencila-node-list-default figure.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption){margin-bottom:.75rem;margin-top:.75rem;padding-top:.75rem}.sc-stencila-node-list-default-h .sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption):first-child,.sc-stencila-node-list-default-h>*.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption):first-child,.sc-stencila-node-list-default-h figure.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption):first-child,stencila-node-list.sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption):first-child,stencila-node-list .sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption):first-child,stencila-node-list.sc-stencila-node-list-default>*.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption):first-child,stencila-node-list.sc-stencila-node-list-default figure.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption):first-child{margin-top:0;padding-top:0}.sc-stencila-node-list-default-h .sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption):last-child,.sc-stencila-node-list-default-h>*.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption):last-child,.sc-stencila-node-list-default-h figure.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption):last-child,stencila-node-list.sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption):last-child,stencila-node-list .sc-stencila-node-list-default-s>[slot=outputs]>:not(figcaption):last-child,stencila-node-list.sc-stencila-node-list-default>*.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption):last-child,stencila-node-list.sc-stencila-node-list-default figure.sc-stencila-node-list-default>.sc-stencila-node-list-default:not(figcaption):last-child{margin-bottom:0}";var materialNodeListCss="*.sc-stencila-node-list-material,.sc-stencila-node-list-material:after,.sc-stencila-node-list-material:before{border:0 solid;-webkit-box-sizing:border-box;box-sizing:border-box}html.sc-stencila-node-list-material{font-size:16px}.hidden.sc-stencila-node-list-material{display:none}code.sc-stencila-node-list-material,code[class*=language-].sc-stencila-node-list-material,output.sc-stencila-node-list-material{font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:75%}pre.sc-stencila-node-list-material{border:1px solid #cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-radius:.25rem;margin:.5rem;overflow:auto;padding:.5rem}.sc-stencila-node-list-material-h,stencila-node-list.sc-stencila-node-list-material{display:block}.sc-stencila-node-list-material-h .hidden.sc-stencila-node-list-material+.sc-stencila-node-list-material:nth-child(2),.sc-stencila-node-list-material-h>.sc-stencila-node-list-material:first-child,stencila-node-list.sc-stencila-node-list-material .hidden.sc-stencila-node-list-material+.sc-stencila-node-list-material:nth-child(2),stencila-node-list.sc-stencila-node-list-material>.sc-stencila-node-list-material:first-child{border-top-width:0;margin-top:0;padding-top:0}.sc-stencila-node-list-material-h>.sc-stencila-node-list-material:last-child,stencila-node-list.sc-stencila-node-list-material>.sc-stencila-node-list-material:last-child{margin-bottom:0}.sc-stencila-node-list-material-h .hidden.sc-stencila-node-list-material,stencila-node-list.sc-stencila-node-list-material .hidden.sc-stencila-node-list-material{display:none}.sc-stencila-node-list-material-h .emptyContentMessage.sc-stencila-node-list-material,stencila-node-list.sc-stencila-node-list-material .emptyContentMessage.sc-stencila-node-list-material{color:#6e7591;color:var(--color-neutral-500,#6e7591);font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:1rem;line-height:1.5rem}.sc-stencila-node-list-material-h stencila-code-error.sc-stencila-node-list-material,stencila-node-list.sc-stencila-node-list-material stencila-code-error.sc-stencila-node-list-material{border-width:0}.sc-stencila-node-list-material-h stencila-image-object.sc-stencila-node-list-material,stencila-node-list.sc-stencila-node-list-material stencila-image-object.sc-stencila-node-list-material{display:block;height:auto;max-width:100%}.sc-stencila-node-list-material-h .sc-stencila-node-list-material-s>[slot=outputs],.sc-stencila-node-list-material-h>*.sc-stencila-node-list-material,.sc-stencila-node-list-material-h figure.sc-stencila-node-list-material,stencila-node-list.sc-stencila-node-list-material-s>[slot=outputs],stencila-node-list .sc-stencila-node-list-material-s>[slot=outputs],stencila-node-list.sc-stencila-node-list-material>*.sc-stencila-node-list-material,stencila-node-list.sc-stencila-node-list-material figure.sc-stencila-node-list-material{margin:0;overflow:auto;padding:0}.sc-stencila-node-list-material-h .sc-stencila-node-list-material-s>[slot=outputs]:first-child,.sc-stencila-node-list-material-h>.sc-stencila-node-list-material:first-child,.sc-stencila-node-list-material-h figure.sc-stencila-node-list-material:first-child,stencila-node-list.sc-stencila-node-list-material-s>[slot=outputs]:first-child,stencila-node-list .sc-stencila-node-list-material-s>[slot=outputs]:first-child,stencila-node-list.sc-stencila-node-list-material>.sc-stencila-node-list-material:first-child,stencila-node-list.sc-stencila-node-list-material figure.sc-stencila-node-list-material:first-child{margin-top:0}.sc-stencila-node-list-material-h .sc-stencila-node-list-material-s>[slot=outputs] pre,.sc-stencila-node-list-material-h>*.sc-stencila-node-list-material pre.sc-stencila-node-list-material,.sc-stencila-node-list-material-h figure.sc-stencila-node-list-material pre.sc-stencila-node-list-material,stencila-node-list.sc-stencila-node-list-material-s>[slot=outputs] pre,stencila-node-list .sc-stencila-node-list-material-s>[slot=outputs] pre,stencila-node-list.sc-stencila-node-list-material>*.sc-stencila-node-list-material pre.sc-stencila-node-list-material,stencila-node-list.sc-stencila-node-list-material figure.sc-stencila-node-list-material pre.sc-stencila-node-list-material{border-width:0;margin:0;padding:0}.sc-stencila-node-list-material-h .sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption),.sc-stencila-node-list-material-h>*.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption),.sc-stencila-node-list-material-h figure.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption),stencila-node-list.sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption),stencila-node-list .sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption),stencila-node-list.sc-stencila-node-list-material>*.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption),stencila-node-list.sc-stencila-node-list-material figure.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption){margin-bottom:.75rem;margin-top:.75rem;padding-top:.75rem}.sc-stencila-node-list-material-h .sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption):first-child,.sc-stencila-node-list-material-h>*.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption):first-child,.sc-stencila-node-list-material-h figure.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption):first-child,stencila-node-list.sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption):first-child,stencila-node-list .sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption):first-child,stencila-node-list.sc-stencila-node-list-material>*.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption):first-child,stencila-node-list.sc-stencila-node-list-material figure.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption):first-child{margin-top:0;padding-top:0}.sc-stencila-node-list-material-h .sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption):last-child,.sc-stencila-node-list-material-h>*.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption):last-child,.sc-stencila-node-list-material-h figure.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption):last-child,stencila-node-list.sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption):last-child,stencila-node-list .sc-stencila-node-list-material-s>[slot=outputs]>:not(figcaption):last-child,stencila-node-list.sc-stencila-node-list-material>*.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption):last-child,stencila-node-list.sc-stencila-node-list-material figure.sc-stencila-node-list-material>.sc-stencila-node-list-material:not(figcaption):last-child{margin-bottom:0}";var slots={nodes:"outputs",errors:"errors"};var OutputsList=function(){function e(e){var t=this;registerInstance(this,e);this.nodes=undefined;this.isEmpty=this.nodes===undefined||this.nodes!==undefined&&_Array.isEmpty(this.nodes);this.checkIfEmpty=function(){var e;var n;if(t.nodes!==undefined){n=_Array.isEmpty(t.nodes);t.isEmpty=n;return n}n=t.el.children.length===0||Array.from((e=t.el.children)!==null&&e!==void 0?e:[]).reduce((function(e,t){return e+t.innerHTML.trim()}),"")==="";t.isEmpty=n;return n};this.emptyOutputMessage="No output to show";this.renderNodes=function(e){return e===null||e===void 0?void 0:e.map((function(e){return t.renderNode(e)}))};this.renderNode=function(e){if(He(e)){var t=typeof e==="string"||typeof e==="number"?e:JSON.stringify(e);return h("pre",null,h("output",null,t))}else if(Xe("CodeTypes",e)){return h("pre",null,h("output",null,e.text))}else if(Je("ImageObject",e)){return preferredImageObjectComponent(e)}else if(Je("Datatable",e)){return h("stencila-data-table",{table:e})}return JSON.stringify(e)}}e.prototype.componentWillLoad=function(){this.checkIfEmpty()};e.prototype.componentWillUpdate=function(){this.checkIfEmpty()};e.prototype.render=function(){return h(Host,null,h("div",{class:{hidden:this.nodes!==undefined,slot:true}},h("slot",{name:slots.nodes})),this.isEmpty&&h("em",{class:"emptyContentMessage"},this.emptyOutputMessage),!this.isEmpty&&h("figure",null,this.renderNodes(this.nodes)),h("slot",null))};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return e}();OutputsList.style={default:defaultNodeListCss,material:materialNodeListCss};export{EditorParseContext as A,ActionMenu as B,Editor as C,DefaultBufferLength as D,EditorSelection as E,Language as L,NodeType as N,OutputsList as O,Prec as P,Tree as T,styleTags as a,NodeSet as b,countColumn as c,defineLanguageFacet as d,NodeProp as e,LanguageSupport as f,getIndentUnit as g,LezerLanguage as h,indentService as i,indentNodeProp as j,continuedIndent as k,languageDataProp as l,foldNodeProp as m,foldInside$1 as n,snippetCompletion as o,flatIndent as p,delimitedIndent as q,ifNotIn as r,syntaxTree as s,tags as t,completeFromList as u,stringInput as v,TreeBuffer as w,Text as x,keymap as y,LanguageDescription as z};