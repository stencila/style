var __extends=this&&this.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]};return e(t,n)};return function(t,n){if(typeof n!=="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(t,n,r,i){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(e){o(e)}}function u(t){try{l(i["throw"](t))}catch(e){o(e)}}function l(e){e.done?r(e.value):a(e.value).then(s,u)}l((i=i.apply(t,n||[])).next())}))};var __generator=this&&this.__generator||function(t,n){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,a,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(e){return function(t){return l([e,t])}}function l(s){if(i)throw new TypeError("Generator is already executing.");while(r)try{if(i=1,a&&(o=s[0]&2?a["return"]:s[0]?a["throw"]||((o=a["return"])&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;if(a=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:r.label++;return{value:s[1],done:false};case 5:r.label++;a=s[1];s=[0];continue;case 7:s=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(s[0]===6&&r.label<o[1]){r.label=o[1];o=s;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(s);break}if(o[2])r.ops.pop();r.trys.pop();continue}s=n.call(t,r)}catch(e){s=[6,e];a=0}finally{i=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var __rest=this&&this.__rest||function(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n};var __spreadArray=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};var __values=this&&this.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var _e,_h,_j,_l,_m,_v,_w,_z,_3,_5;import{r as registerInstance,h as h$1,c as createEvent,a as getElement,H as Host}from"./index-e3052a43.js";import{p as plotlyMediaType,g as getVegaVersion,v as vegaMediaType,b as getVegaLibSrc}from"./imagePlotlyUtils-86d8b4db.js";import{c as createCommonjsModule}from"./_commonjsHelpers-8a9f3b18.js";var defaultDataTableCss='[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default{border-collapse:collapse;display:block;font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.875rem;line-height:1.25rem;overflow:auto}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default td.sc-stencila-data-table-default,[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default th.sc-stencila-data-table-default{padding:.25rem .5rem}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default th.sc-stencila-data-table-default{font-weight:700}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default tbody.sc-stencila-data-table-default tr.sc-stencila-data-table-default:nth-child(2n),[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-default th.sc-stencila-data-table-default{background-color:#e9eaf1;background-color:var(--color-neutral-50,#e9eaf1)}';var materialDataTableCss='[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material{border-collapse:collapse;display:block;font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.875rem;line-height:1.25rem;overflow:auto}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material td.sc-stencila-data-table-material,[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material th.sc-stencila-data-table-material{padding:.25rem .5rem}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material th.sc-stencila-data-table-material{font-weight:700}[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material tbody.sc-stencila-data-table-material tr.sc-stencila-data-table-material:nth-child(2n),[itemtype="https://schema.stenci.la/Datatable"].sc-stencila-data-table-material th.sc-stencila-data-table-material{background-color:#e9eaf1;background-color:var(--color-neutral-50,#e9eaf1)}';var DataTable=function(){function e(e){registerInstance(this,e)}e.prototype.render=function(){var e;var t=this.table.columns;var n=(e=t===null||t===void 0?void 0:t[0].values.map((function(e,t){return t})))!==null&&e!==void 0?e:[];return h$1("table",{itemtype:"https://schema.stenci.la/Datatable"},h$1("thead",null,h$1("tr",null,t.map((function(e){return h$1("th",null,e.name)})))),h$1("tbody",null,n.map((function(e,n){return h$1("tr",null,t.map((function(e){return h$1("td",null,e.values[n])})))}))))};return e}();DataTable.style={default:defaultDataTableCss,material:materialDataTableCss};var defaultImageObjectCss=".sc-stencila-image-object-default-h img.sc-stencila-image-object-default,stencila-image-object.sc-stencila-image-object-default img.sc-stencila-image-object-default{height:auto;max-width:100%}";var materialImageObjectCss=".sc-stencila-image-object-material-h img.sc-stencila-image-object-material,stencila-image-object.sc-stencila-image-object-material img.sc-stencila-image-object-material{height:auto;max-width:100%}";var ImageObjectComponent=function(){function e(e){registerInstance(this,e)}e.prototype.render=function(){return h$1("img",{alt:this.image.text,itemscope:true,itemtype:"http://schema.org/ImageObject",src:this.image.contentUrl})};return e}();ImageObjectComponent.style={default:defaultImageObjectCss,material:materialImageObjectCss};var isScriptPresent=function(e){return document.querySelector('head script[src="'+e+'"]')!==null};var injectScriptSrc=function(e){var t=e.src,n=e.onInit,r=e.onLoad;var i;if(isScriptPresent(t))return;var a=document.createElement("script");a.setAttribute("src",t);n===null||n===void 0?void 0:n();a.addEventListener("load",r);(i=document.querySelector("head"))===null||i===void 0?void 0:i.appendChild(a)};var createPlotContainer=function(e){var t=document.createElement("div");var n=e.querySelector("picture");var r=n!==null&&n!==void 0?n:e;r.appendChild(t);return t};var defaultImagePlotlyCss=".sc-stencila-image-plotly-default-h{display:block}.sc-stencila-image-plotly-default-h.imgHidden.sc-stencila-image-plotly-default-s>picture>:not(.js-plotly-plot){display:none}";var materialImagePlotlyCss=".sc-stencila-image-plotly-material-h{display:block}.sc-stencila-image-plotly-material-h.imgHidden.sc-stencila-image-plotly-material-s>picture>:not(.js-plotly-plot){display:none}";var plotlySrc="https://cdn.plot.ly/plotly-latest.min.js";var plotlyIsLoaded;var ImagePlotlyComponent=function(){function e(e){var t=this;registerInstance(this,e);this.plotlyLoaded=createEvent(this,"plotlyLoaded",7);this.plotIsRendered=false;this.renderPlot=function(){var e,n,r;var i=(e=t.getPlotContent())!==null&&e!==void 0?e:{},a=i.data,o=i.layout,s=o===void 0?t.layout:o,u=i.config,l=u===void 0?t.config:u;if(!a)return;t.plotContainer=(n=t.plotContainer)!==null&&n!==void 0?n:createPlotContainer(t.el);(r=window.Plotly)===null||r===void 0?void 0:r.react(t.plotContainer,a,s,l).then((function(){if(!t.plotIsRendered){t.plotIsRendered=true}})).catch((function(e){console.error("Failed to render plot",e)}))};this.getPlotContent=function(){if(t.data){return{data:t.data,layout:t.layout,config:t.config}}var e=t.el.querySelector('[type="'+plotlyMediaType+'"]');if(e){try{var n=e.textContent;var r=JSON.parse(n!==null&&n!==void 0?n:"");return Array.isArray(r)?{data:r}:r}catch(i){console.error("Could not parse plot data")}}return undefined}}e.prototype.onPlotlyLoaded=function(){if(!this.plotIsRendered){this.renderPlot()}};e.prototype.componentWillLoad=function(){var e=this;if(!this.plotIsRendered&&plotlyIsLoaded){this.renderPlot()}else{injectScriptSrc({src:plotlySrc,onLoad:function(){plotlyIsLoaded=true;e.plotlyLoaded.emit()}})}};e.prototype.componentShouldUpdate=function(e,t,n){if(n==="plotIsRendered"&&t===e){return false}return true};e.prototype.componentWillUpdate=function(){this.renderPlot()};e.prototype.render=function(){return h$1(Host,{class:{imgHidden:this.plotIsRendered}})};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return e}();ImagePlotlyComponent.style={default:defaultImagePlotlyCss,material:materialImagePlotlyCss};
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var __extends=undefined&&undefined.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();var _hasOwnProperty=Object.prototype.hasOwnProperty;function hasOwnProperty(e,t){return _hasOwnProperty.call(e,t)}function _objectKeys(e){if(Array.isArray(e)){var t=new Array(e.length);for(var n=0;n<t.length;n++){t[n]=""+n}return t}if(Object.keys){return Object.keys(e)}var t=[];for(var r in e){if(hasOwnProperty(e,r)){t.push(r)}}return t}function _deepClone(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function isInteger$1(e){var t=0;var n=e.length;var r;while(t<n){r=e.charCodeAt(t);if(r>=48&&r<=57){t++;continue}return false}return true}function escapePathComponent(e){if(e.indexOf("/")===-1&&e.indexOf("~")===-1)return e;return e.replace(/~/g,"~0").replace(/\//g,"~1")}function unescapePathComponent(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function hasUndefined(e){if(e===undefined){return true}if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++){if(hasUndefined(e[t])){return true}}}else if(typeof e==="object"){var r=_objectKeys(e);var i=r.length;for(var t=0;t<i;t++){if(hasUndefined(e[r[t]])){return true}}}}return false}function patchErrorMessageFormatter(e,t){var n=[e];for(var r in t){var i=typeof t[r]==="object"?JSON.stringify(t[r],null,2):t[r];if(typeof i!=="undefined"){n.push(r+": "+i)}}return n.join("\n")}var PatchError=function(e){__extends(t,e);function t(t,n,r,i,a){var o=this.constructor;var s=e.call(this,patchErrorMessageFormatter(t,{name:n,index:r,operation:i,tree:a}))||this;s.name=n;s.index=r;s.operation=i;s.tree=a;Object.setPrototypeOf(s,o.prototype);s.message=patchErrorMessageFormatter(t,{name:n,index:r,operation:i,tree:a});return s}return t}(Error);var JsonPatchError=PatchError;var deepClone=_deepClone;var objOps={add:function(e,t,n){e[t]=this.value;return{newDocument:n}},remove:function(e,t,n){var r=e[t];delete e[t];return{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];e[t]=this.value;return{newDocument:n,removed:r}},move:function(e,t,n){var r=getValueByPointer(n,this.path);if(r){r=_deepClone(r)}var i=applyOperation(n,{op:"remove",path:this.from}).removed;applyOperation(n,{op:"add",path:this.path,value:i});return{newDocument:n,removed:r}},copy:function(e,t,n){var r=getValueByPointer(n,this.from);applyOperation(n,{op:"add",path:this.path,value:_deepClone(r)});return{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:_areEquals(e[t],this.value)}},_get:function(e,t,n){this.value=e[t];return{newDocument:n}}};var arrOps={add:function(e,t,n){if(isInteger$1(t)){e.splice(t,0,this.value)}else{e[t]=this.value}return{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];e[t]=this.value;return{newDocument:n,removed:r}},move:objOps.move,copy:objOps.copy,test:objOps.test,_get:objOps._get};function getValueByPointer(e,t){if(t==""){return e}var n={op:"_get",path:t};applyOperation(e,n);return n.value}function applyOperation(e,t,n,r,i,a){if(n===void 0){n=false}if(r===void 0){r=true}if(i===void 0){i=true}if(a===void 0){a=0}if(n){if(typeof n=="function"){n(t,0,e,t.path)}else{validator(t,0)}}if(t.path===""){var o={newDocument:e};if(t.op==="add"){o.newDocument=t.value;return o}else if(t.op==="replace"){o.newDocument=t.value;o.removed=e;return o}else if(t.op==="move"||t.op==="copy"){o.newDocument=getValueByPointer(e,t.from);if(t.op==="move"){o.removed=e}return o}else if(t.op==="test"){o.test=_areEquals(e,t.value);if(o.test===false){throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",a,t,e)}o.newDocument=e;return o}else if(t.op==="remove"){o.removed=e;o.newDocument=null;return o}else if(t.op==="_get"){t.value=e;return o}else{if(n){throw new JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e)}else{return o}}}else{if(!r){e=_deepClone(e)}var s=t.path||"";var u=s.split("/");var l=e;var f=1;var c=u.length;var d=undefined;var p=void 0;var h=void 0;if(typeof n=="function"){h=n}else{h=validator}while(true){p=u[f];if(i&&p=="__proto__"){throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README")}if(n){if(d===undefined){if(l[p]===undefined){d=u.slice(0,f).join("/")}else if(f==c-1){d=t.path}if(d!==undefined){h(t,0,e,d)}}}f++;if(Array.isArray(l)){if(p==="-"){p=l.length}else{if(n&&!isInteger$1(p)){throw new JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e)}else if(isInteger$1(p)){p=~~p}}if(f>=c){if(n&&t.op==="add"&&p>l.length){throw new JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e)}var o=arrOps[t.op].call(t,l,p,e);if(o.test===false){throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",a,t,e)}return o}}else{if(p&&p.indexOf("~")!=-1){p=unescapePathComponent(p)}if(f>=c){var o=objOps[t.op].call(t,l,p,e);if(o.test===false){throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",a,t,e)}return o}}l=l[p]}}}function applyPatch(e,t,n,r,i){if(r===void 0){r=true}if(i===void 0){i=true}if(n){if(!Array.isArray(t)){throw new JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY")}}if(!r){e=_deepClone(e)}var a=new Array(t.length);for(var o=0,s=t.length;o<s;o++){a[o]=applyOperation(e,t[o],n,true,i,o);e=a[o].newDocument}a.newDocument=e;return a}function applyReducer(e,t,n){var r=applyOperation(e,t);if(r.test===false){throw new JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",n,t,e)}return r.newDocument}function validator(e,t,n,r){if(typeof e!=="object"||e===null||Array.isArray(e)){throw new JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n)}else if(!objOps[e.op]){throw new JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}else if(typeof e.path!=="string"){throw new JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n)}else if(e.path.indexOf("/")!==0&&e.path.length>0){throw new JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n)}else if((e.op==="move"||e.op==="copy")&&typeof e.from!=="string"){throw new JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n)}else if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===undefined){throw new JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n)}else if((e.op==="add"||e.op==="replace"||e.op==="test")&&hasUndefined(e.value)){throw new JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n)}else if(n){if(e.op=="add"){var i=e.path.split("/").length;var a=r.split("/").length;if(i!==a+1&&i!==a){throw new JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r){throw new JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:undefined};var s=validate([o],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE"){throw new JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}}function validate(t,n,r){try{if(!Array.isArray(t)){throw new JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY")}if(n){applyPatch(_deepClone(n),_deepClone(t),r||true)}else{r=r||validator;for(var i=0;i<t.length;i++){r(t[i],i,n,undefined)}}}catch(e){if(e instanceof JsonPatchError){return e}else{throw e}}}function _areEquals(e,t){if(e===t)return true;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,a,o;if(n&&r){a=e.length;if(a!=t.length)return false;for(i=a;i--!==0;)if(!_areEquals(e[i],t[i]))return false;return true}if(n!=r)return false;var s=Object.keys(e);a=s.length;if(a!==Object.keys(t).length)return false;for(i=a;i--!==0;)if(!t.hasOwnProperty(s[i]))return false;for(i=a;i--!==0;){o=s[i];if(!_areEquals(e[o],t[o]))return false}return true}return e!==e&&t!==t}var core=Object.freeze({__proto__:null,JsonPatchError:JsonPatchError,deepClone:deepClone,getValueByPointer:getValueByPointer,applyOperation:applyOperation,applyPatch:applyPatch,applyReducer:applyReducer,validator:validator,validate:validate,_areEquals:_areEquals});
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var beforeDict=new WeakMap;var Mirror=function(){function e(e){this.observers=new Map;this.obj=e}return e}();var ObserverInfo=function(){function e(e,t){this.callback=e;this.observer=t}return e}();function getMirror(e){return beforeDict.get(e)}function getObserverFromMirror(e,t){return e.observers.get(t)}function removeObserverFromMirror(e,t){e.observers.delete(t.callback)}function unobserve(e,t){t.unobserve()}function observe(e,t){var n=[];var r;var i=getMirror(e);if(!i){i=new Mirror(e);beforeDict.set(e,i)}else{var a=getObserverFromMirror(i,t);r=a&&a.observer}if(r){return r}r={};i.value=_deepClone(e);if(t){r.callback=t;r.next=null;var o=function(){generate$1(r)};var s=function(){clearTimeout(r.next);r.next=setTimeout(o)};if(typeof window!=="undefined"){window.addEventListener("mouseup",s);window.addEventListener("keyup",s);window.addEventListener("mousedown",s);window.addEventListener("keydown",s);window.addEventListener("change",s)}}r.patches=n;r.object=e;r.unobserve=function(){generate$1(r);clearTimeout(r.next);removeObserverFromMirror(i,r);if(typeof window!=="undefined"){window.removeEventListener("mouseup",s);window.removeEventListener("keyup",s);window.removeEventListener("mousedown",s);window.removeEventListener("keydown",s);window.removeEventListener("change",s)}};i.observers.set(t,new ObserverInfo(t,r));return r}function generate$1(e,t){if(t===void 0){t=false}var n=beforeDict.get(e.object);_generate(n.value,e.object,e.patches,"",t);if(e.patches.length){applyPatch(n.value,e.patches)}var r=e.patches;if(r.length>0){e.patches=[];if(e.callback){e.callback(r)}}return r}function _generate(e,t,n,r,i){if(t===e){return}if(typeof t.toJSON==="function"){t=t.toJSON()}var a=_objectKeys(t);var o=_objectKeys(e);var s=false;for(var u=o.length-1;u>=0;u--){var l=o[u];var f=e[l];if(hasOwnProperty(t,l)&&!(t[l]===undefined&&f!==undefined&&Array.isArray(t)===false)){var c=t[l];if(typeof f=="object"&&f!=null&&typeof c=="object"&&c!=null){_generate(f,c,n,r+"/"+escapePathComponent(l),i)}else{if(f!==c){if(i){n.push({op:"test",path:r+"/"+escapePathComponent(l),value:_deepClone(f)})}n.push({op:"replace",path:r+"/"+escapePathComponent(l),value:_deepClone(c)})}}}else if(Array.isArray(e)===Array.isArray(t)){if(i){n.push({op:"test",path:r+"/"+escapePathComponent(l),value:_deepClone(f)})}n.push({op:"remove",path:r+"/"+escapePathComponent(l)});s=true}else{if(i){n.push({op:"test",path:r,value:e})}n.push({op:"replace",path:r,value:t})}}if(!s&&a.length==o.length){return}for(var u=0;u<a.length;u++){var l=a[u];if(!hasOwnProperty(e,l)&&t[l]!==undefined){n.push({op:"add",path:r+"/"+escapePathComponent(l),value:_deepClone(t[l])})}}}function compare$3(e,t,n){if(n===void 0){n=false}var r=[];_generate(e,t,r,"",n);return r}var duplex=Object.freeze({__proto__:null,unobserve:unobserve,observe:observe,generate:generate$1,compare:compare$3});Object.assign({},core,duplex,{JsonPatchError:PatchError,deepClone:_deepClone,escapePathComponent:escapePathComponent,unescapePathComponent:unescapePathComponent});var stringOrChar=/("(?:[^\\"]|\\.)*")|[:,]/g;var jsonStringifyPrettyCompact=function e(t,n){var r,i,a;n=n||{};r=JSON.stringify([1],undefined,n.indent===undefined?2:n.indent).slice(2,-3);i=r===""?Infinity:n.maxLength===undefined?80:n.maxLength;a=n.replacer;return function e(t,n,o){var s,u,l,f,c,d,p,h,g,m,v,y;if(t&&typeof t.toJSON==="function"){t=t.toJSON()}v=JSON.stringify(t,a);if(v===undefined){return v}p=i-n.length-o;if(v.length<=p){g=v.replace(stringOrChar,(function(e,t){return t||e+" "}));if(g.length<=p){return g}}if(a!=null){t=JSON.parse(v);a=undefined}if(typeof t==="object"&&t!==null){h=n+r;l=[];u=0;if(Array.isArray(t)){m="[";s="]";p=t.length;for(;u<p;u++){l.push(e(t[u],h,u===p-1?0:1)||"null")}}else{m="{";s="}";d=Object.keys(t);p=d.length;for(;u<p;u++){f=d[u];c=JSON.stringify(f)+": ";y=e(t[f],h,c.length+(u===p-1?0:1));if(y!==undefined){l.push(c+y)}}}if(l.length>0){return[m,r+l.join(",\n"+h),s].join("\n"+n)}}return v}(t,"",0)};var SEMVER_SPEC_VERSION="2.0.0";var MAX_LENGTH$2=256;var MAX_SAFE_INTEGER$1=Number.MAX_SAFE_INTEGER||9007199254740991;var MAX_SAFE_COMPONENT_LENGTH=16;var constants$1={SEMVER_SPEC_VERSION:SEMVER_SPEC_VERSION,MAX_LENGTH:MAX_LENGTH$2,MAX_SAFE_INTEGER:MAX_SAFE_INTEGER$1,MAX_SAFE_COMPONENT_LENGTH:MAX_SAFE_COMPONENT_LENGTH};var debug$2=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return console.error.apply(console,__spreadArray(["SEMVER"],e))}:function(){};var debug_1=debug$2;var re_1=createCommonjsModule((function(e,t){var n=constants$1.MAX_SAFE_COMPONENT_LENGTH;t=e.exports={};var r=t.re=[];var i=t.src=[];var a=t.t={};var o=0;var s=function(e,t,n){var s=o++;debug_1(s,t);a[e]=s;i[s]=t;r[s]=new RegExp(t,n?"g":undefined)};s("NUMERICIDENTIFIER","0|[1-9]\\d*");s("NUMERICIDENTIFIERLOOSE","[0-9]+");s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");s("MAINVERSION","("+i[a.NUMERICIDENTIFIER]+")\\."+("("+i[a.NUMERICIDENTIFIER]+")\\.")+("("+i[a.NUMERICIDENTIFIER]+")"));s("MAINVERSIONLOOSE","("+i[a.NUMERICIDENTIFIERLOOSE]+")\\."+("("+i[a.NUMERICIDENTIFIERLOOSE]+")\\.")+("("+i[a.NUMERICIDENTIFIERLOOSE]+")"));s("PRERELEASEIDENTIFIER","(?:"+i[a.NUMERICIDENTIFIER]+"|"+i[a.NONNUMERICIDENTIFIER]+")");s("PRERELEASEIDENTIFIERLOOSE","(?:"+i[a.NUMERICIDENTIFIERLOOSE]+"|"+i[a.NONNUMERICIDENTIFIER]+")");s("PRERELEASE","(?:-("+i[a.PRERELEASEIDENTIFIER]+"(?:\\."+i[a.PRERELEASEIDENTIFIER]+")*))");s("PRERELEASELOOSE","(?:-?("+i[a.PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+i[a.PRERELEASEIDENTIFIERLOOSE]+")*))");s("BUILDIDENTIFIER","[0-9A-Za-z-]+");s("BUILD","(?:\\+("+i[a.BUILDIDENTIFIER]+"(?:\\."+i[a.BUILDIDENTIFIER]+")*))");s("FULLPLAIN","v?"+i[a.MAINVERSION]+i[a.PRERELEASE]+"?"+i[a.BUILD]+"?");s("FULL","^"+i[a.FULLPLAIN]+"$");s("LOOSEPLAIN","[v=\\s]*"+i[a.MAINVERSIONLOOSE]+i[a.PRERELEASELOOSE]+"?"+i[a.BUILD]+"?");s("LOOSE","^"+i[a.LOOSEPLAIN]+"$");s("GTLT","((?:<|>)?=?)");s("XRANGEIDENTIFIERLOOSE",i[a.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*");s("XRANGEIDENTIFIER",i[a.NUMERICIDENTIFIER]+"|x|X|\\*");s("XRANGEPLAIN","[v=\\s]*("+i[a.XRANGEIDENTIFIER]+")"+("(?:\\.("+i[a.XRANGEIDENTIFIER]+")")+("(?:\\.("+i[a.XRANGEIDENTIFIER]+")")+("(?:"+i[a.PRERELEASE]+")?"+i[a.BUILD]+"?")+")?)?");s("XRANGEPLAINLOOSE","[v=\\s]*("+i[a.XRANGEIDENTIFIERLOOSE]+")"+("(?:\\.("+i[a.XRANGEIDENTIFIERLOOSE]+")")+("(?:\\.("+i[a.XRANGEIDENTIFIERLOOSE]+")")+("(?:"+i[a.PRERELEASELOOSE]+")?"+i[a.BUILD]+"?")+")?)?");s("XRANGE","^"+i[a.GTLT]+"\\s*"+i[a.XRANGEPLAIN]+"$");s("XRANGELOOSE","^"+i[a.GTLT]+"\\s*"+i[a.XRANGEPLAINLOOSE]+"$");s("COERCE",""+"(^|[^\\d])"+"(\\d{1,"+n+"})"+("(?:\\.(\\d{1,"+n+"}))?")+("(?:\\.(\\d{1,"+n+"}))?")+"(?:$|[^\\d])");s("COERCERTL",i[a.COERCE],true);s("LONETILDE","(?:~>?)");s("TILDETRIM","(\\s*)"+i[a.LONETILDE]+"\\s+",true);t.tildeTrimReplace="$1~";s("TILDE","^"+i[a.LONETILDE]+i[a.XRANGEPLAIN]+"$");s("TILDELOOSE","^"+i[a.LONETILDE]+i[a.XRANGEPLAINLOOSE]+"$");s("LONECARET","(?:\\^)");s("CARETTRIM","(\\s*)"+i[a.LONECARET]+"\\s+",true);t.caretTrimReplace="$1^";s("CARET","^"+i[a.LONECARET]+i[a.XRANGEPLAIN]+"$");s("CARETLOOSE","^"+i[a.LONECARET]+i[a.XRANGEPLAINLOOSE]+"$");s("COMPARATORLOOSE","^"+i[a.GTLT]+"\\s*("+i[a.LOOSEPLAIN]+")$|^$");s("COMPARATOR","^"+i[a.GTLT]+"\\s*("+i[a.FULLPLAIN]+")$|^$");s("COMPARATORTRIM","(\\s*)"+i[a.GTLT]+"\\s*("+i[a.LOOSEPLAIN]+"|"+i[a.XRANGEPLAIN]+")",true);t.comparatorTrimReplace="$1$2$3";s("HYPHENRANGE","^\\s*("+i[a.XRANGEPLAIN]+")"+"\\s+-\\s+"+("("+i[a.XRANGEPLAIN]+")")+"\\s*$");s("HYPHENRANGELOOSE","^\\s*("+i[a.XRANGEPLAINLOOSE]+")"+"\\s+-\\s+"+("("+i[a.XRANGEPLAINLOOSE]+")")+"\\s*$");s("STAR","(<|>)?=?\\s*\\*");s("GTE0","^\\s*>=\\s*0.0.0\\s*$");s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}));var opts=["includePrerelease","loose","rtl"];var parseOptions=function(e){return!e?{}:typeof e!=="object"?{loose:true}:opts.filter((function(t){return e[t]})).reduce((function(e,t){e[t]=true;return e}),{})};var parseOptions_1=parseOptions;var numeric=/^[0-9]+$/;var compareIdentifiers$1=function(e,t){var n=numeric.test(e);var r=numeric.test(t);if(n&&r){e=+e;t=+t}return e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var rcompareIdentifiers=function(e,t){return compareIdentifiers$1(t,e)};var identifiers={compareIdentifiers:compareIdentifiers$1,rcompareIdentifiers:rcompareIdentifiers};var MAX_LENGTH$1=constants$1.MAX_LENGTH,MAX_SAFE_INTEGER=constants$1.MAX_SAFE_INTEGER;var re$5=re_1.re,t$4=re_1.t;var compareIdentifiers=identifiers.compareIdentifiers;var SemVer=function(){function e(t,n){n=parseOptions_1(n);if(t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease){return t}else{t=t.version}}else if(typeof t!=="string"){throw new TypeError("Invalid Version: "+t)}if(t.length>MAX_LENGTH$1){throw new TypeError("version is longer than "+MAX_LENGTH$1+" characters")}debug_1("SemVer",t,n);this.options=n;this.loose=!!n.loose;this.includePrerelease=!!n.includePrerelease;var r=t.trim().match(n.loose?re$5[t$4.LOOSE]:re$5[t$4.FULL]);if(!r){throw new TypeError("Invalid Version: "+t)}this.raw=t;this.major=+r[1];this.minor=+r[2];this.patch=+r[3];if(this.major>MAX_SAFE_INTEGER||this.major<0){throw new TypeError("Invalid major version")}if(this.minor>MAX_SAFE_INTEGER||this.minor<0){throw new TypeError("Invalid minor version")}if(this.patch>MAX_SAFE_INTEGER||this.patch<0){throw new TypeError("Invalid patch version")}if(!r[4]){this.prerelease=[]}else{this.prerelease=r[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<MAX_SAFE_INTEGER){return t}}return e}))}this.build=r[5]?r[5].split("."):[];this.format()}e.prototype.format=function(){this.version=this.major+"."+this.minor+"."+this.patch;if(this.prerelease.length){this.version+="-"+this.prerelease.join(".")}return this.version};e.prototype.toString=function(){return this.version};e.prototype.compare=function(t){debug_1("SemVer.compare",this.version,this.options,t);if(!(t instanceof e)){if(typeof t==="string"&&t===this.version){return 0}t=new e(t,this.options)}if(t.version===this.version){return 0}return this.compareMain(t)||this.comparePre(t)};e.prototype.compareMain=function(t){if(!(t instanceof e)){t=new e(t,this.options)}return compareIdentifiers(this.major,t.major)||compareIdentifiers(this.minor,t.minor)||compareIdentifiers(this.patch,t.patch)};e.prototype.comparePre=function(t){if(!(t instanceof e)){t=new e(t,this.options)}if(this.prerelease.length&&!t.prerelease.length){return-1}else if(!this.prerelease.length&&t.prerelease.length){return 1}else if(!this.prerelease.length&&!t.prerelease.length){return 0}var n=0;do{var r=this.prerelease[n];var i=t.prerelease[n];debug_1("prerelease compare",n,r,i);if(r===undefined&&i===undefined){return 0}else if(i===undefined){return 1}else if(r===undefined){return-1}else if(r===i){continue}else{return compareIdentifiers(r,i)}}while(++n)};e.prototype.compareBuild=function(t){if(!(t instanceof e)){t=new e(t,this.options)}var n=0;do{var r=this.build[n];var i=t.build[n];debug_1("prerelease compare",n,r,i);if(r===undefined&&i===undefined){return 0}else if(i===undefined){return 1}else if(r===undefined){return-1}else if(r===i){continue}else{return compareIdentifiers(r,i)}}while(++n)};e.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc("pre",t);break;case"preminor":this.prerelease.length=0;this.patch=0;this.minor++;this.inc("pre",t);break;case"prepatch":this.prerelease.length=0;this.inc("patch",t);this.inc("pre",t);break;case"prerelease":if(this.prerelease.length===0){this.inc("patch",t)}this.inc("pre",t);break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0){this.major++}this.minor=0;this.patch=0;this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0){this.minor++}this.patch=0;this.prerelease=[];break;case"patch":if(this.prerelease.length===0){this.patch++}this.prerelease=[];break;case"pre":if(this.prerelease.length===0){this.prerelease=[0]}else{var n=this.prerelease.length;while(--n>=0){if(typeof this.prerelease[n]==="number"){this.prerelease[n]++;n=-2}}if(n===-1){this.prerelease.push(0)}}if(t){if(this.prerelease[0]===t){if(isNaN(this.prerelease[1])){this.prerelease=[t,0]}}else{this.prerelease=[t,0]}}break;default:throw new Error("invalid increment argument: "+e)}this.format();this.raw=this.version;return this};return e}();var semver$1=SemVer;var MAX_LENGTH=constants$1.MAX_LENGTH;var re$4=re_1.re,t$3=re_1.t;var parse$6=function(e,t){t=parseOptions_1(t);if(e instanceof semver$1){return e}if(typeof e!=="string"){return null}if(e.length>MAX_LENGTH){return null}var n=t.loose?re$4[t$3.LOOSE]:re$4[t$3.FULL];if(!n.test(e)){return null}try{return new semver$1(e,t)}catch(r){return null}};var parse_1=parse$6;var valid$1=function(e,t){var n=parse_1(e,t);return n?n.version:null};var valid_1=valid$1;var clean=function(e,t){var n=parse_1(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var clean_1=clean;var inc=function(e,t,n,r){if(typeof n==="string"){r=n;n=undefined}try{return new semver$1(e,n).inc(t,r).version}catch(i){return null}};var inc_1=inc;var compare$2=function(e,t,n){return new semver$1(e,n).compare(new semver$1(t,n))};var compare_1=compare$2;var eq=function(e,t,n){return compare_1(e,t,n)===0};var eq_1=eq;var diff=function(e,t){if(eq_1(e,t)){return null}else{var n=parse_1(e);var r=parse_1(t);var i=n.prerelease.length||r.prerelease.length;var a=i?"pre":"";var o=i?"prerelease":"";for(var s in n){if(s==="major"||s==="minor"||s==="patch"){if(n[s]!==r[s]){return a+s}}}return o}};var diff_1=diff;var major=function(e,t){return new semver$1(e,t).major};var major_1=major;var minor=function(e,t){return new semver$1(e,t).minor};var minor_1=minor;var patch$1=function(e,t){return new semver$1(e,t).patch};var patch_1=patch$1;var prerelease=function(e,t){var n=parse_1(e,t);return n&&n.prerelease.length?n.prerelease:null};var prerelease_1=prerelease;var rcompare=function(e,t,n){return compare_1(t,e,n)};var rcompare_1=rcompare;var compareLoose=function(e,t){return compare_1(e,t,true)};var compareLoose_1=compareLoose;var compareBuild=function(e,t,n){var r=new semver$1(e,n);var i=new semver$1(t,n);return r.compare(i)||r.compareBuild(i)};var compareBuild_1=compareBuild;var sort$1=function(e,t){return e.sort((function(e,n){return compareBuild_1(e,n,t)}))};var sort_1=sort$1;var rsort=function(e,t){return e.sort((function(e,n){return compareBuild_1(n,e,t)}))};var rsort_1=rsort;var gt=function(e,t,n){return compare_1(e,t,n)>0};var gt_1=gt;var lt=function(e,t,n){return compare_1(e,t,n)<0};var lt_1=lt;var neq=function(e,t,n){return compare_1(e,t,n)!==0};var neq_1=neq;var gte=function(e,t,n){return compare_1(e,t,n)>=0};var gte_1=gte;var lte=function(e,t,n){return compare_1(e,t,n)<=0};var lte_1=lte;var cmp=function(e,t,n,r){switch(t){case"===":if(typeof e==="object")e=e.version;if(typeof n==="object")n=n.version;return e===n;case"!==":if(typeof e==="object")e=e.version;if(typeof n==="object")n=n.version;return e!==n;case"":case"=":case"==":return eq_1(e,n,r);case"!=":return neq_1(e,n,r);case">":return gt_1(e,n,r);case">=":return gte_1(e,n,r);case"<":return lt_1(e,n,r);case"<=":return lte_1(e,n,r);default:throw new TypeError("Invalid operator: "+t)}};var cmp_1=cmp;var re$3=re_1.re,t$2=re_1.t;var coerce=function(e,t){if(e instanceof semver$1){return e}if(typeof e==="number"){e=String(e)}if(typeof e!=="string"){return null}t=t||{};var n=null;if(!t.rtl){n=e.match(re$3[t$2.COERCE])}else{var r=void 0;while((r=re$3[t$2.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length)){if(!n||r.index+r[0].length!==n.index+n[0].length){n=r}re$3[t$2.COERCERTL].lastIndex=r.index+r[1].length+r[2].length}re$3[t$2.COERCERTL].lastIndex=-1}if(n===null)return null;return parse_1(n[2]+"."+(n[3]||"0")+"."+(n[4]||"0"),t)};var coerce_1=coerce;var iterator=function(e){e.prototype[Symbol.iterator]=function(){var e;return __generator(this,(function(t){switch(t.label){case 0:e=this.head;t.label=1;case 1:if(!e)return[3,4];return[4,e.value];case 2:t.sent();t.label=3;case 3:e=e.next;return[3,1];case 4:return[2]}}))}};var yallist=Yallist;Yallist.Node=Node$2;Yallist.create=Yallist;function Yallist(e){var t=this;if(!(t instanceof Yallist)){t=new Yallist}t.tail=null;t.head=null;t.length=0;if(e&&typeof e.forEach==="function"){e.forEach((function(e){t.push(e)}))}else if(arguments.length>0){for(var n=0,r=arguments.length;n<r;n++){t.push(arguments[n])}}return t}Yallist.prototype.removeNode=function(e){if(e.list!==this){throw new Error("removing node which does not belong to this list")}var t=e.next;var n=e.prev;if(t){t.prev=n}if(n){n.next=t}if(e===this.head){this.head=t}if(e===this.tail){this.tail=n}e.list.length--;e.next=null;e.prev=null;e.list=null;return t};Yallist.prototype.unshiftNode=function(e){if(e===this.head){return}if(e.list){e.list.removeNode(e)}var t=this.head;e.list=this;e.next=t;if(t){t.prev=e}this.head=e;if(!this.tail){this.tail=e}this.length++};Yallist.prototype.pushNode=function(e){if(e===this.tail){return}if(e.list){e.list.removeNode(e)}var t=this.tail;e.list=this;e.prev=t;if(t){t.next=e}this.tail=e;if(!this.head){this.head=e}this.length++};Yallist.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++){push(this,arguments[e])}return this.length};Yallist.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++){unshift(this,arguments[e])}return this.length};Yallist.prototype.pop=function(){if(!this.tail){return undefined}var e=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null}else{this.head=null}this.length--;return e};Yallist.prototype.shift=function(){if(!this.head){return undefined}var e=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null}else{this.tail=null}this.length--;return e};Yallist.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;n!==null;r++){e.call(t,n.value,r,this);n=n.next}};Yallist.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;n!==null;r--){e.call(t,n.value,r,this);n=n.prev}};Yallist.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++){n=n.next}if(t===e&&n!==null){return n.value}};Yallist.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++){n=n.prev}if(t===e&&n!==null){return n.value}};Yallist.prototype.map=function(e,t){t=t||this;var n=new Yallist;for(var r=this.head;r!==null;){n.push(e.call(t,r.value,this));r=r.next}return n};Yallist.prototype.mapReverse=function(e,t){t=t||this;var n=new Yallist;for(var r=this.tail;r!==null;){n.push(e.call(t,r.value,this));r=r.prev}return n};Yallist.prototype.reduce=function(e,t){var n;var r=this.head;if(arguments.length>1){n=t}else if(this.head){r=this.head.next;n=this.head.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=0;r!==null;i++){n=e(n,r.value,i);r=r.next}return n};Yallist.prototype.reduceReverse=function(e,t){var n;var r=this.tail;if(arguments.length>1){n=t}else if(this.tail){r=this.tail.prev;n=this.tail.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=this.length-1;r!==null;i--){n=e(n,r.value,i);r=r.prev}return n};Yallist.prototype.toArray=function(){var e=new Array(this.length);for(var t=0,n=this.head;n!==null;t++){e[t]=n.value;n=n.next}return e};Yallist.prototype.toArrayReverse=function(){var e=new Array(this.length);for(var t=0,n=this.tail;n!==null;t++){e[t]=n.value;n=n.prev}return e};Yallist.prototype.slice=function(e,t){t=t||this.length;if(t<0){t+=this.length}e=e||0;if(e<0){e+=this.length}var n=new Yallist;if(t<e||t<0){return n}if(e<0){e=0}if(t>this.length){t=this.length}for(var r=0,i=this.head;i!==null&&r<e;r++){i=i.next}for(;i!==null&&r<t;r++,i=i.next){n.push(i.value)}return n};Yallist.prototype.sliceReverse=function(e,t){t=t||this.length;if(t<0){t+=this.length}e=e||0;if(e<0){e+=this.length}var n=new Yallist;if(t<e||t<0){return n}if(e<0){e=0}if(t>this.length){t=this.length}for(var r=this.length,i=this.tail;i!==null&&r>t;r--){i=i.prev}for(;i!==null&&r>e;r--,i=i.prev){n.push(i.value)}return n};Yallist.prototype.splice=function(e,t){var n=[];for(var r=2;r<arguments.length;r++){n[r-2]=arguments[r]}if(e>this.length){e=this.length-1}if(e<0){e=this.length+e}for(var i=0,a=this.head;a!==null&&i<e;i++){a=a.next}var o=[];for(var i=0;a&&i<t;i++){o.push(a.value);a=this.removeNode(a)}if(a===null){a=this.tail}if(a!==this.head&&a!==this.tail){a=a.prev}for(var i=0;i<n.length;i++){a=insert$1(this,a,n[i])}return o};Yallist.prototype.reverse=function(){var e=this.head;var t=this.tail;for(var n=e;n!==null;n=n.prev){var r=n.prev;n.prev=n.next;n.next=r}this.head=t;this.tail=e;return this};function insert$1(e,t,n){var r=t===e.head?new Node$2(n,null,t,e):new Node$2(n,t,t.next,e);if(r.next===null){e.tail=r}if(r.prev===null){e.head=r}e.length++;return r}function push(e,t){e.tail=new Node$2(t,e.tail,null,e);if(!e.head){e.head=e.tail}e.length++}function unshift(e,t){e.head=new Node$2(t,null,e.head,e);if(!e.tail){e.tail=e.head}e.length++}function Node$2(e,t,n,r){if(!(this instanceof Node$2)){return new Node$2(e,t,n,r)}this.list=r;this.value=e;if(t){t.next=this;this.prev=t}else{this.prev=null}if(n){n.prev=this;this.next=n}else{this.next=null}}try{iterator(Yallist)}catch(er){}var MAX=Symbol("max");var LENGTH=Symbol("length");var LENGTH_CALCULATOR=Symbol("lengthCalculator");var ALLOW_STALE=Symbol("allowStale");var MAX_AGE=Symbol("maxAge");var DISPOSE=Symbol("dispose");var NO_DISPOSE_ON_SET=Symbol("noDisposeOnSet");var LRU_LIST=Symbol("lruList");var CACHE$1=Symbol("cache");var UPDATE_AGE_ON_GET=Symbol("updateAgeOnGet");var naiveLength=function(){return 1};var LRUCache=function(){function e(e){if(typeof e==="number")e={max:e};if(!e)e={};if(e.max&&(typeof e.max!=="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[MAX]=e.max||Infinity;var t=e.length||naiveLength;this[LENGTH_CALCULATOR]=typeof t!=="function"?naiveLength:t;this[ALLOW_STALE]=e.stale||false;if(e.maxAge&&typeof e.maxAge!=="number")throw new TypeError("maxAge must be a number");this[MAX_AGE]=e.maxAge||0;this[DISPOSE]=e.dispose;this[NO_DISPOSE_ON_SET]=e.noDisposeOnSet||false;this[UPDATE_AGE_ON_GET]=e.updateAgeOnGet||false;this.reset()}Object.defineProperty(e.prototype,"max",{get:function(){return this[MAX]},set:function(e){if(typeof e!=="number"||e<0)throw new TypeError("max must be a non-negative number");this[MAX]=e||Infinity;trim(this)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"allowStale",{get:function(){return this[ALLOW_STALE]},set:function(e){this[ALLOW_STALE]=!!e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"maxAge",{get:function(){return this[MAX_AGE]},set:function(e){if(typeof e!=="number")throw new TypeError("maxAge must be a non-negative number");this[MAX_AGE]=e;trim(this)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lengthCalculator",{get:function(){return this[LENGTH_CALCULATOR]},set:function(e){var t=this;if(typeof e!=="function")e=naiveLength;if(e!==this[LENGTH_CALCULATOR]){this[LENGTH_CALCULATOR]=e;this[LENGTH]=0;this[LRU_LIST].forEach((function(e){e.length=t[LENGTH_CALCULATOR](e.value,e.key);t[LENGTH]+=e.length}))}trim(this)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"length",{get:function(){return this[LENGTH]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"itemCount",{get:function(){return this[LRU_LIST].length},enumerable:false,configurable:true});e.prototype.rforEach=function(e,t){t=t||this;for(var n=this[LRU_LIST].tail;n!==null;){var r=n.prev;forEachStep(this,e,n,t);n=r}};e.prototype.forEach=function(e,t){t=t||this;for(var n=this[LRU_LIST].head;n!==null;){var r=n.next;forEachStep(this,e,n,t);n=r}};e.prototype.keys=function(){return this[LRU_LIST].toArray().map((function(e){return e.key}))};e.prototype.values=function(){return this[LRU_LIST].toArray().map((function(e){return e.value}))};e.prototype.reset=function(){var e=this;if(this[DISPOSE]&&this[LRU_LIST]&&this[LRU_LIST].length){this[LRU_LIST].forEach((function(t){return e[DISPOSE](t.key,t.value)}))}this[CACHE$1]=new Map;this[LRU_LIST]=new yallist;this[LENGTH]=0};e.prototype.dump=function(){var e=this;return this[LRU_LIST].map((function(t){return isStale(e,t)?false:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}})).toArray().filter((function(e){return e}))};e.prototype.dumpLru=function(){return this[LRU_LIST]};e.prototype.set=function(e,t,n){n=n||this[MAX_AGE];if(n&&typeof n!=="number")throw new TypeError("maxAge must be a number");var r=n?Date.now():0;var i=this[LENGTH_CALCULATOR](t,e);if(this[CACHE$1].has(e)){if(i>this[MAX]){del(this,this[CACHE$1].get(e));return false}var a=this[CACHE$1].get(e);var o=a.value;if(this[DISPOSE]){if(!this[NO_DISPOSE_ON_SET])this[DISPOSE](e,o.value)}o.now=r;o.maxAge=n;o.value=t;this[LENGTH]+=i-o.length;o.length=i;this.get(e);trim(this);return true}var s=new Entry$1(e,t,i,r,n);if(s.length>this[MAX]){if(this[DISPOSE])this[DISPOSE](e,t);return false}this[LENGTH]+=s.length;this[LRU_LIST].unshift(s);this[CACHE$1].set(e,this[LRU_LIST].head);trim(this);return true};e.prototype.has=function(e){if(!this[CACHE$1].has(e))return false;var t=this[CACHE$1].get(e).value;return!isStale(this,t)};e.prototype.get=function(e){return get$5(this,e,true)};e.prototype.peek=function(e){return get$5(this,e,false)};e.prototype.pop=function(){var e=this[LRU_LIST].tail;if(!e)return null;del(this,e);return e.value};e.prototype.del=function(e){del(this,this[CACHE$1].get(e))};e.prototype.load=function(e){this.reset();var t=Date.now();for(var n=e.length-1;n>=0;n--){var r=e[n];var i=r.e||0;if(i===0)this.set(r.k,r.v);else{var a=i-t;if(a>0){this.set(r.k,r.v,a)}}}};e.prototype.prune=function(){var e=this;this[CACHE$1].forEach((function(t,n){return get$5(e,n,false)}))};return e}();var get$5=function(e,t,n){var r=e[CACHE$1].get(t);if(r){var i=r.value;if(isStale(e,i)){del(e,r);if(!e[ALLOW_STALE])return undefined}else{if(n){if(e[UPDATE_AGE_ON_GET])r.value.now=Date.now();e[LRU_LIST].unshiftNode(r)}}return i.value}};var isStale=function(e,t){if(!t||!t.maxAge&&!e[MAX_AGE])return false;var n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[MAX_AGE]&&n>e[MAX_AGE]};var trim=function(e){if(e[LENGTH]>e[MAX]){for(var t=e[LRU_LIST].tail;e[LENGTH]>e[MAX]&&t!==null;){var n=t.prev;del(e,t);t=n}}};var del=function(e,t){if(t){var n=t.value;if(e[DISPOSE])e[DISPOSE](n.key,n.value);e[LENGTH]-=n.length;e[CACHE$1].delete(n.key);e[LRU_LIST].removeNode(t)}};var Entry$1=function(){function e(e,t,n,r,i){this.key=e;this.value=t;this.length=n;this.now=r;this.maxAge=i||0}return e}();var forEachStep=function(e,t,n,r){var i=n.value;if(isStale(e,i)){del(e,n);if(!e[ALLOW_STALE])i=undefined}if(i)t.call(r,i.value,i.key,e)};var lruCache$1=LRUCache;var Range=function(){function e(t,n){var r=this;n=parseOptions_1(n);if(t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease){return t}else{return new e(t.raw,n)}}if(t instanceof comparator$1){this.raw=t.value;this.set=[[t]];this.format();return this}this.options=n;this.loose=!!n.loose;this.includePrerelease=!!n.includePrerelease;this.raw=t;this.set=t.split(/\s*\|\|\s*/).map((function(e){return r.parseRange(e.trim())})).filter((function(e){return e.length}));if(!this.set.length){throw new TypeError("Invalid SemVer Range: "+t)}if(this.set.length>1){var i=this.set[0];this.set=this.set.filter((function(e){return!isNullSet(e[0])}));if(this.set.length===0)this.set=[i];else if(this.set.length>1){for(var a=0,o=this.set;a<o.length;a++){var s=o[a];if(s.length===1&&isAny(s[0])){this.set=[s];break}}}}this.format()}e.prototype.format=function(){this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim();return this.range};e.prototype.toString=function(){return this.range};e.prototype.parseRange=function(e){var t=this;e=e.trim();var n=Object.keys(this.options).join(",");var r="parseRange:"+n+":"+e;var i=cache$1.get(r);if(i)return i;var a=this.options.loose;var o=a?re$2[t$1.HYPHENRANGELOOSE]:re$2[t$1.HYPHENRANGE];e=e.replace(o,hyphenReplace(this.options.includePrerelease));debug_1("hyphen replace",e);e=e.replace(re$2[t$1.COMPARATORTRIM],comparatorTrimReplace);debug_1("comparator trim",e,re$2[t$1.COMPARATORTRIM]);e=e.replace(re$2[t$1.TILDETRIM],tildeTrimReplace);e=e.replace(re$2[t$1.CARETTRIM],caretTrimReplace);e=e.split(/\s+/).join(" ");var s=a?re$2[t$1.COMPARATORLOOSE]:re$2[t$1.COMPARATOR];var u=e.split(" ").map((function(e){return parseComparator(e,t.options)})).join(" ").split(/\s+/).map((function(e){return replaceGTE0(e,t.options)})).filter(this.options.loose?function(e){return!!e.match(s)}:function(){return true}).map((function(e){return new comparator$1(e,t.options)}));var l=new Map;for(var f=0,c=u;f<c.length;f++){var d=c[f];if(isNullSet(d))return[d];l.set(d.value,d)}if(l.size>1&&l.has(""))l.delete("");var p=__spreadArray([],l.values());cache$1.set(r,p);return p};e.prototype.intersects=function(t,n){if(!(t instanceof e)){throw new TypeError("a Range is required")}return this.set.some((function(e){return isSatisfiable(e,n)&&t.set.some((function(t){return isSatisfiable(t,n)&&e.every((function(e){return t.every((function(t){return e.intersects(t,n)}))}))}))}))};e.prototype.test=function(e){if(!e){return false}if(typeof e==="string"){try{e=new semver$1(e,this.options)}catch(er){return false}}for(var t=0;t<this.set.length;t++){if(testSet(this.set[t],e,this.options)){return true}}return false};return e}();var range$4=Range;var cache$1=new lruCache$1({max:1e3});var re$2=re_1.re,t$1=re_1.t,comparatorTrimReplace=re_1.comparatorTrimReplace,tildeTrimReplace=re_1.tildeTrimReplace,caretTrimReplace=re_1.caretTrimReplace;var isNullSet=function(e){return e.value==="<0.0.0-0"};var isAny=function(e){return e.value===""};var isSatisfiable=function(e,t){var n=true;var r=e.slice();var i=r.pop();while(n&&r.length){n=r.every((function(e){return i.intersects(e,t)}));i=r.pop()}return n};var parseComparator=function(e,t){debug_1("comp",e,t);e=replaceCarets(e,t);debug_1("caret",e);e=replaceTildes(e,t);debug_1("tildes",e);e=replaceXRanges(e,t);debug_1("xrange",e);e=replaceStars(e,t);debug_1("stars",e);return e};var isX$1=function(e){return!e||e.toLowerCase()==="x"||e==="*"};var replaceTildes=function(e,t){return e.trim().split(/\s+/).map((function(e){return replaceTilde(e,t)})).join(" ")};var replaceTilde=function(e,t){var n=t.loose?re$2[t$1.TILDELOOSE]:re$2[t$1.TILDE];return e.replace(n,(function(t,n,r,i,a){debug_1("tilde",e,t,n,r,i,a);var o;if(isX$1(n)){o=""}else if(isX$1(r)){o=">="+n+".0.0 <"+(+n+1)+".0.0-0"}else if(isX$1(i)){o=">="+n+"."+r+".0 <"+n+"."+(+r+1)+".0-0"}else if(a){debug_1("replaceTilde pr",a);o=">="+n+"."+r+"."+i+"-"+a+" <"+n+"."+(+r+1)+".0-0"}else{o=">="+n+"."+r+"."+i+" <"+n+"."+(+r+1)+".0-0"}debug_1("tilde return",o);return o}))};var replaceCarets=function(e,t){return e.trim().split(/\s+/).map((function(e){return replaceCaret(e,t)})).join(" ")};var replaceCaret=function(e,t){debug_1("caret",e,t);var n=t.loose?re$2[t$1.CARETLOOSE]:re$2[t$1.CARET];var r=t.includePrerelease?"-0":"";return e.replace(n,(function(t,n,i,a,o){debug_1("caret",e,t,n,i,a,o);var s;if(isX$1(n)){s=""}else if(isX$1(i)){s=">="+n+".0.0"+r+" <"+(+n+1)+".0.0-0"}else if(isX$1(a)){if(n==="0"){s=">="+n+"."+i+".0"+r+" <"+n+"."+(+i+1)+".0-0"}else{s=">="+n+"."+i+".0"+r+" <"+(+n+1)+".0.0-0"}}else if(o){debug_1("replaceCaret pr",o);if(n==="0"){if(i==="0"){s=">="+n+"."+i+"."+a+"-"+o+" <"+n+"."+i+"."+(+a+1)+"-0"}else{s=">="+n+"."+i+"."+a+"-"+o+" <"+n+"."+(+i+1)+".0-0"}}else{s=">="+n+"."+i+"."+a+"-"+o+" <"+(+n+1)+".0.0-0"}}else{debug_1("no pr");if(n==="0"){if(i==="0"){s=">="+n+"."+i+"."+a+r+" <"+n+"."+i+"."+(+a+1)+"-0"}else{s=">="+n+"."+i+"."+a+r+" <"+n+"."+(+i+1)+".0-0"}}else{s=">="+n+"."+i+"."+a+" <"+(+n+1)+".0.0-0"}}debug_1("caret return",s);return s}))};var replaceXRanges=function(e,t){debug_1("replaceXRanges",e,t);return e.split(/\s+/).map((function(e){return replaceXRange(e,t)})).join(" ")};var replaceXRange=function(e,t){e=e.trim();var n=t.loose?re$2[t$1.XRANGELOOSE]:re$2[t$1.XRANGE];return e.replace(n,(function(n,r,i,a,o,s){debug_1("xRange",e,n,r,i,a,o,s);var u=isX$1(i);var l=u||isX$1(a);var f=l||isX$1(o);var c=f;if(r==="="&&c){r=""}s=t.includePrerelease?"-0":"";if(u){if(r===">"||r==="<"){n="<0.0.0-0"}else{n="*"}}else if(r&&c){if(l){a=0}o=0;if(r===">"){r=">=";if(l){i=+i+1;a=0;o=0}else{a=+a+1;o=0}}else if(r==="<="){r="<";if(l){i=+i+1}else{a=+a+1}}if(r==="<")s="-0";n=r+i+"."+a+"."+o+s}else if(l){n=">="+i+".0.0"+s+" <"+(+i+1)+".0.0-0"}else if(f){n=">="+i+"."+a+".0"+s+" <"+i+"."+(+a+1)+".0-0"}debug_1("xRange return",n);return n}))};var replaceStars=function(e,t){debug_1("replaceStars",e,t);return e.trim().replace(re$2[t$1.STAR],"")};var replaceGTE0=function(e,t){debug_1("replaceGTE0",e,t);return e.trim().replace(re$2[t.includePrerelease?t$1.GTE0PRE:t$1.GTE0],"")};var hyphenReplace=function(e){return function(t,n,r,i,a,o,s,u,l,f,c,d,p){if(isX$1(r)){n=""}else if(isX$1(i)){n=">="+r+".0.0"+(e?"-0":"")}else if(isX$1(a)){n=">="+r+"."+i+".0"+(e?"-0":"")}else if(o){n=">="+n}else{n=">="+n+(e?"-0":"")}if(isX$1(l)){u=""}else if(isX$1(f)){u="<"+(+l+1)+".0.0-0"}else if(isX$1(c)){u="<"+l+"."+(+f+1)+".0-0"}else if(d){u="<="+l+"."+f+"."+c+"-"+d}else if(e){u="<"+l+"."+f+"."+(+c+1)+"-0"}else{u="<="+u}return(n+" "+u).trim()}};var testSet=function(e,t,n){for(var r=0;r<e.length;r++){if(!e[r].test(t)){return false}}if(t.prerelease.length&&!n.includePrerelease){for(var r=0;r<e.length;r++){debug_1(e[r].semver);if(e[r].semver===comparator$1.ANY){continue}if(e[r].semver.prerelease.length>0){var i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch){return true}}}return false}return true};var ANY$2=Symbol("SemVer ANY");var Comparator=function(){function e(t,n){n=parseOptions_1(n);if(t instanceof e){if(t.loose===!!n.loose){return t}else{t=t.value}}debug_1("comparator",t,n);this.options=n;this.loose=!!n.loose;this.parse(t);if(this.semver===ANY$2){this.value=""}else{this.value=this.operator+this.semver.version}debug_1("comp",this)}Object.defineProperty(e,"ANY",{get:function(){return ANY$2},enumerable:false,configurable:true});e.prototype.parse=function(e){var n=this.options.loose?re$1[t.COMPARATORLOOSE]:re$1[t.COMPARATOR];var r=e.match(n);if(!r){throw new TypeError("Invalid comparator: "+e)}this.operator=r[1]!==undefined?r[1]:"";if(this.operator==="="){this.operator=""}if(!r[2]){this.semver=ANY$2}else{this.semver=new semver$1(r[2],this.options.loose)}};e.prototype.toString=function(){return this.value};e.prototype.test=function(e){debug_1("Comparator.test",e,this.options.loose);if(this.semver===ANY$2||e===ANY$2){return true}if(typeof e==="string"){try{e=new semver$1(e,this.options)}catch(er){return false}}return cmp_1(e,this.operator,this.semver,this.options)};e.prototype.intersects=function(t,n){if(!(t instanceof e)){throw new TypeError("a Comparator is required")}if(!n||typeof n!=="object"){n={loose:!!n,includePrerelease:false}}if(this.operator===""){if(this.value===""){return true}return new range$4(t.value,n).test(this.value)}else if(t.operator===""){if(t.value===""){return true}return new range$4(this.value,n).test(t.semver)}var r=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">");var i=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<");var a=this.semver.version===t.semver.version;var o=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<=");var s=cmp_1(this.semver,"<",t.semver,n)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<");var u=cmp_1(this.semver,">",t.semver,n)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return r||i||a&&o||s||u};return e}();var comparator$1=Comparator;var re$1=re_1.re,t=re_1.t;var satisfies=function(e,t,n){try{t=new range$4(t,n)}catch(er){return false}return t.test(e)};var satisfies_1=satisfies;var toComparators=function(e,t){return new range$4(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))};var toComparators_1=toComparators;var maxSatisfying=function(e,t,n){var r=null;var i=null;var a=null;try{a=new range$4(t,n)}catch(er){return null}e.forEach((function(e){if(a.test(e)){if(!r||i.compare(e)===-1){r=e;i=new semver$1(r,n)}}}));return r};var maxSatisfying_1=maxSatisfying;var minSatisfying=function(e,t,n){var r=null;var i=null;var a=null;try{a=new range$4(t,n)}catch(er){return null}e.forEach((function(e){if(a.test(e)){if(!r||i.compare(e)===1){r=e;i=new semver$1(r,n)}}}));return r};var minSatisfying_1=minSatisfying;var minVersion=function(e,t){e=new range$4(e,t);var n=new semver$1("0.0.0");if(e.test(n)){return n}n=new semver$1("0.0.0-0");if(e.test(n)){return n}n=null;var r=function(t){var r=e.set[t];var i=null;r.forEach((function(e){var t=new semver$1(e.semver.version);switch(e.operator){case">":if(t.prerelease.length===0){t.patch++}else{t.prerelease.push(0)}t.raw=t.format();case"":case">=":if(!i||gt_1(t,i)){i=t}break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}));if(i&&(!n||gt_1(n,i)))n=i};for(var i=0;i<e.set.length;++i){r(i)}if(n&&e.test(n)){return n}return null};var minVersion_1=minVersion;var validRange=function(e,t){try{return new range$4(e,t).range||"*"}catch(er){return null}};var valid=validRange;var ANY$1=comparator$1.ANY;var outside=function(e,t,n,r){e=new semver$1(e,r);t=new range$4(t,r);var i,a,o,s,u;switch(n){case">":i=gt_1;a=lte_1;o=lt_1;s=">";u=">=";break;case"<":i=lt_1;a=gte_1;o=gt_1;s="<";u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(satisfies_1(e,t,r)){return false}var l=function(n){var l=t.set[n];var f=null;var c=null;l.forEach((function(e){if(e.semver===ANY$1){e=new comparator$1(">=0.0.0")}f=f||e;c=c||e;if(i(e.semver,f.semver,r)){f=e}else if(o(e.semver,c.semver,r)){c=e}}));if(f.operator===s||f.operator===u){return{value:false}}if((!c.operator||c.operator===s)&&a(e,c.semver)){return{value:false}}else if(c.operator===u&&o(e,c.semver)){return{value:false}}};for(var f=0;f<t.set.length;++f){var c=l(f);if(typeof c==="object")return c.value}return true};var outside_1=outside;var gtr=function(e,t,n){return outside_1(e,t,">",n)};var gtr_1=gtr;var ltr=function(e,t,n){return outside_1(e,t,"<",n)};var ltr_1=ltr;var intersects$1=function(e,t,n){e=new range$4(e,n);t=new range$4(t,n);return e.intersects(t)};var intersects_1=intersects$1;var simplify=function(e,t,n){var r=[];var i=null;var a=null;var o=e.sort((function(e,t){return compare_1(e,t,n)}));for(var s=0,u=o;s<u.length;s++){var l=u[s];var f=satisfies_1(l,t,n);if(f){a=l;if(!i)i=l}else{if(a){r.push([i,a])}a=null;i=null}}if(i)r.push([i,null]);var c=[];for(var d=0,p=r;d<p.length;d++){var h=p[d],g=h[0],m=h[1];if(g===m)c.push(g);else if(!m&&g===o[0])c.push("*");else if(!m)c.push(">="+g);else if(g===o[0])c.push("<="+m);else c.push(g+" - "+m)}var v=c.join(" || ");var y=typeof t.raw==="string"?t.raw:String(t);return v.length<y.length?v:t};var ANY=comparator$1.ANY;var subset=function(e,t,n){if(n===void 0){n={}}if(e===t)return true;e=new range$4(e,n);t=new range$4(t,n);var r=false;e:for(var i=0,a=e.set;i<a.length;i++){var o=a[i];for(var s=0,u=t.set;s<u.length;s++){var l=u[s];var f=simpleSubset(o,l,n);r=r||f!==null;if(f)continue e}if(r)return false}return true};var simpleSubset=function(e,t,n){if(e===t)return true;if(e.length===1&&e[0].semver===ANY){if(t.length===1&&t[0].semver===ANY)return true;else if(n.includePrerelease)e=[new comparator$1(">=0.0.0-0")];else e=[new comparator$1(">=0.0.0")]}if(t.length===1&&t[0].semver===ANY){if(n.includePrerelease)return true;else t=[new comparator$1(">=0.0.0")]}var r=new Set;var i,a;for(var o=0,s=e;o<s.length;o++){var u=s[o];if(u.operator===">"||u.operator===">=")i=higherGT(i,u,n);else if(u.operator==="<"||u.operator==="<=")a=lowerLT(a,u,n);else r.add(u.semver)}if(r.size>1)return null;var l;if(i&&a){l=compare_1(i.semver,a.semver,n);if(l>0)return null;else if(l===0&&(i.operator!==">="||a.operator!=="<="))return null}for(var f=0,c=r;f<c.length;f++){var d=c[f];if(i&&!satisfies_1(d,String(i),n))return null;if(a&&!satisfies_1(d,String(a),n))return null;for(var p=0,h=t;p<h.length;p++){var g=h[p];if(!satisfies_1(d,String(g),n))return false}return true}var m,v;var y,_;var b=a&&!n.includePrerelease&&a.semver.prerelease.length?a.semver:false;var x=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:false;if(b&&b.prerelease.length===1&&a.operator==="<"&&b.prerelease[0]===0){b=false}for(var E=0,S=t;E<S.length;E++){var $=S[E];_=_||$.operator===">"||$.operator===">=";y=y||$.operator==="<"||$.operator==="<=";if(i){if(x){if($.semver.prerelease&&$.semver.prerelease.length&&$.semver.major===x.major&&$.semver.minor===x.minor&&$.semver.patch===x.patch){x=false}}if($.operator===">"||$.operator===">="){m=higherGT(i,$,n);if(m===$&&m!==i)return false}else if(i.operator===">="&&!satisfies_1(i.semver,String($),n))return false}if(a){if(b){if($.semver.prerelease&&$.semver.prerelease.length&&$.semver.major===b.major&&$.semver.minor===b.minor&&$.semver.patch===b.patch){b=false}}if($.operator==="<"||$.operator==="<="){v=lowerLT(a,$,n);if(v===$&&v!==a)return false}else if(a.operator==="<="&&!satisfies_1(a.semver,String($),n))return false}if(!$.operator&&(a||i)&&l!==0)return false}if(i&&y&&!a&&l!==0)return false;if(a&&_&&!i&&l!==0)return false;if(x||b)return false;return true};var higherGT=function(e,t,n){if(!e)return t;var r=compare_1(e.semver,t.semver,n);return r>0?e:r<0?t:t.operator===">"&&e.operator===">="?t:e};var lowerLT=function(e,t,n){if(!e)return t;var r=compare_1(e.semver,t.semver,n);return r<0?e:r>0?t:t.operator==="<"&&e.operator==="<="?t:e};var subset_1=subset;var semver={re:re_1.re,src:re_1.src,tokens:re_1.t,SEMVER_SPEC_VERSION:constants$1.SEMVER_SPEC_VERSION,SemVer:semver$1,compareIdentifiers:identifiers.compareIdentifiers,rcompareIdentifiers:identifiers.rcompareIdentifiers,parse:parse_1,valid:valid_1,clean:clean_1,inc:inc_1,diff:diff_1,major:major_1,minor:minor_1,patch:patch_1,prerelease:prerelease_1,compare:compare_1,rcompare:rcompare_1,compareLoose:compareLoose_1,compareBuild:compareBuild_1,sort:sort_1,rsort:rsort_1,gt:gt_1,lt:lt_1,eq:eq_1,neq:neq_1,gte:gte_1,lte:lte_1,cmp:cmp_1,coerce:coerce_1,Comparator:comparator$1,Range:range$4,satisfies:satisfies_1,toComparators:toComparators_1,maxSatisfying:maxSatisfying_1,minSatisfying:minSatisfying_1,minVersion:minVersion_1,validRange:valid,outside:outside_1,gtr:gtr_1,ltr:ltr_1,intersects:intersects_1,simplifyRange:simplify,subset:subset_1};function accessor(e,t,n){e.fields=t||[];e.fname=n;return e}function accessorName(e){return e==null?null:e.fname}function accessorFields(e){return e==null?null:e.fields}function getter(e){return e.length===1?get1(e[0]):getN(e)}var get1=function(e){return function(t){return t[e]}};var getN=function(e){var t=e.length;return function(n){for(var r=0;r<t;++r){n=n[e[r]]}return n}};function error(e){throw Error(e)}function splitAccessPath(e){var t=[],n=e.length;var r=null,i=0,a="",o,s,u;e=e+"";function l(){t.push(a+e.substring(o,s));a="";o=s+1}for(o=s=0;s<n;++s){u=e[s];if(u==="\\"){a+=e.substring(o,s);a+=e.substring(++s,++s);o=s}else if(u===r){l();r=null;i=-1}else if(r){continue}else if(o===i&&u==='"'){o=s+1;r=u}else if(o===i&&u==="'"){o=s+1;r=u}else if(u==="."&&!i){if(s>o){l()}else{o=s+1}}else if(u==="["){if(s>o)l();i=o=s+1}else if(u==="]"){if(!i)error("Access path missing open bracket: "+e);if(i>0)l();i=0;o=s+1}}if(i)error("Access path missing closing bracket: "+e);if(r)error("Access path missing closing quote: "+e);if(s>o){s++;l()}return t}function field$1(e,t,n){var r=splitAccessPath(e);e=r.length===1?r[0]:e;return accessor((n&&n.get||getter)(r),[e],t||e)}var id=field$1("id");var identity$6=accessor((function(e){return e}),[],"identity");var zero$3=accessor((function(){return 0}),[],"zero");var one$2=accessor((function(){return 1}),[],"one");var truthy=accessor((function(){return true}),[],"true");var falsy=accessor((function(){return false}),[],"false");function log$1$1(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var None$2=0;var Error$1=1;var Warn=2;var Info=3;var Debug=4;function logger(e,t){var n=e||None$2;return{level:function(e){if(arguments.length){n=+e;return this}else{return n}},error:function(){if(n>=Error$1)log$1$1(t||"error","ERROR",arguments);return this},warn:function(){if(n>=Warn)log$1$1(t||"warn","WARN",arguments);return this},info:function(){if(n>=Info)log$1$1(t||"log","INFO",arguments);return this},debug:function(){if(n>=Debug)log$1$1(t||"log","DEBUG",arguments);return this}}}var isArray=Array.isArray;function isObject(e){return e===Object(e)}var isLegalKey=function(e){return e!=="__proto__"};function mergeConfig(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e.reduce((function(e,t){for(var n in t){if(n==="signals"){e.signals=mergeNamed(e.signals,t.signals)}else{var r=n==="legend"?{layout:1}:n==="style"?true:null;writeConfig(e,n,t[n],r)}}return e}),{})}function writeConfig(e,t,n,r){if(!isLegalKey(t))return;var i,a;if(isObject(n)&&!isArray(n)){a=isObject(e[t])?e[t]:e[t]={};for(i in n){if(r&&(r===true||r[i])){writeConfig(a,i,n[i])}else if(isLegalKey(i)){a[i]=n[i]}}}else{e[t]=n}}function mergeNamed(e,t){if(e==null)return t;var n={},r=[];function i(e){if(!n[e.name]){n[e.name]=1;r.push(e)}}t.forEach(i);e.forEach(i);return r}function peek$1(e){return e[e.length-1]}function toNumber(e){return e==null||e===""?null:+e}var exp$2=function(e){return function(t){return e*Math.exp(t)}};var log$4=function(e){return function(t){return Math.log(e*t)}};var symlog$1=function(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}};var symexp=function(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}};var pow$4=function(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}};function pan(e,t,n,r){var i=n(e[0]),a=n(peek$1(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function panLinear(e,t){return pan(e,t,toNumber,identity$6)}function panLog(e,t){var n=Math.sign(e[0]);return pan(e,t,log$4(n),exp$2(n))}function panPow(e,t,n){return pan(e,t,pow$4(n),pow$4(1/n))}function panSymlog(e,t,n){return pan(e,t,symlog$1(n),symexp(n))}function zoom$2(e,t,n,r,i){var a=r(e[0]),o=r(peek$1(e)),s=t!=null?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function zoomLinear(e,t,n){return zoom$2(e,t,n,toNumber,identity$6)}function zoomLog(e,t,n){var r=Math.sign(e[0]);return zoom$2(e,t,n,log$4(r),exp$2(r))}function zoomPow(e,t,n,r){return zoom$2(e,t,n,pow$4(r),pow$4(1/r))}function zoomSymlog(e,t,n,r){return zoom$2(e,t,n,symlog$1(r),symexp(r))}function quarter(e){return 1+~~(new Date(e).getMonth()/3)}function utcquarter(e){return 1+~~(new Date(e).getUTCMonth()/3)}function array$5(e){return e!=null?isArray(e)?e:[e]:[]}function clampRange(e,t,n){var r=e[0],i=e[1],a;if(i<r){a=i;i=r;r=a}a=i-r;return a>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-a),r+a]}function isFunction(e){return typeof e==="function"}var DESCENDING="descending";function compare$1(e,t,n){n=n||{};t=array$5(t)||[];var r=[],i=[],a={},o=n.comparator||comparator;array$5(e).forEach((function(e,o){if(e==null)return;r.push(t[o]===DESCENDING?-1:1);i.push(e=isFunction(e)?e:field$1(e,null,n));(accessorFields(e)||[]).forEach((function(e){return a[e]=1}))}));return i.length===0?null:accessor(o(i,r),Object.keys(a))}var ascending$3=function(e,t){return(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0};var comparator=function(e,t){return e.length===1?compare1(e[0],t[0]):compareN(e,t,e.length)};var compare1=function(e,t){return function(n,r){return ascending$3(e(n),e(r))*t}};var compareN=function(e,t,n){t.push(0);return function(r,i){var a,o=0,s=-1;while(o===0&&++s<n){a=e[s];o=ascending$3(a(r),a(i))}return o*t[s]}};function constant$4(e){return isFunction(e)?e:function(){return e}}function debounce(e,t){var n;return function(r){if(n)clearTimeout(n);n=setTimeout((function(){return t(r),n=null}),e)}}function extend$1(e){for(var t,n=void 0,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t){e[n]=t[n]}}return e}function extent(e,t){var n=0,r,i,a,o;if(e&&(r=e.length)){if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);a=o=i;for(;n<r;++n){i=e[n];if(i!=null){if(i<a)a=i;if(i>o)o=i}}}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));a=o=i;for(;n<r;++n){i=t(e[n]);if(i!=null){if(i<a)a=i;if(i>o)o=i}}}}return[a,o]}function extentIndex(e,t){var n=e.length;var r=-1,i,a,o,s,u;if(t==null){while(++r<n){a=e[r];if(a!=null&&a>=a){i=o=a;break}}if(r===n)return[-1,-1];s=u=r;while(++r<n){a=e[r];if(a!=null){if(i>a){i=a;s=r}if(o<a){o=a;u=r}}}}else{while(++r<n){a=t(e[r],r,e);if(a!=null&&a>=a){i=o=a;break}}if(r===n)return[-1,-1];s=u=r;while(++r<n){a=t(e[r],r,e);if(a!=null){if(i>a){i=a;s=r}if(o<a){o=a;u=r}}}}return[s,u]}var hop=Object.prototype.hasOwnProperty;function has$1(e,t){return hop.call(e,t)}var NULL={};function fastmap(e){var t={},n;function r(e){return has$1(t,e)&&t[e]!==NULL}var i={size:0,empty:0,object:t,has:r,get:function(e){return r(e)?t[e]:undefined},set:function(e,n){if(!r(e)){++i.size;if(t[e]===NULL)--i.empty}t[e]=n;return this},delete:function(e){if(r(e)){--i.size;++i.empty;t[e]=NULL}return this},clear:function(){i.size=i.empty=0;i.object=t={}},test:function(e){if(arguments.length){n=e;return i}else{return n}},clean:function(){var e={};var r=0;for(var a in t){var o=t[a];if(o!==NULL&&(!n||!n(o))){e[a]=o;++r}}i.size=r;i.empty=0;i.object=t=e}};if(e)Object.keys(e).forEach((function(t){i.set(t,e[t])}));return i}function flush(e,t,n,r,i,a){if(!n&&n!==0)return a;var o=+n;var s=e[0],u=peek$1(e),l;if(u<s){l=s;s=u;u=l}l=Math.abs(t-s);var f=Math.abs(u-t);return l<f&&l<=o?r:f<=o?i:a}function inherits(e,t,n){var r=e.prototype=Object.create(t.prototype);Object.defineProperty(r,"constructor",{value:e,writable:true,enumerable:true,configurable:true});return extend$1(r,n)}function inrange(e,t,n,r){var i=t[0],a=t[t.length-1],o;if(i>a){o=i;i=a;a=o}n=n===undefined||n;r=r===undefined||r;return(n?i<=e:i<e)&&(r?e<=a:e<a)}function isBoolean$2(e){return typeof e==="boolean"}function isDate$1(e){return Object.prototype.toString.call(e)==="[object Date]"}function isIterable(e){return e&&isFunction(e[Symbol.iterator])}function isNumber$1(e){return typeof e==="number"}function isRegExp(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function isString(e){return typeof e==="string"}function key(e,t,n){if(e){e=t?array$5(e).map((function(e){return e.replace(/\\(.)/g,"$1")})):array$5(e)}var r=e&&e.length,i=n&&n.get||getter,a=function(e){return i(t?[e]:splitAccessPath(e))};var o;if(!r){o=function(){return""}}else if(r===1){var s=a(e[0]);o=function(e){return""+s(e)}}else{var u=e.map(a);o=function(e){var t=""+u[0](e),n=0;while(++n<r)t+="|"+u[n](e);return t}}return accessor(o,e,"key")}function lerp(e,t){var n=e[0],r=peek$1(e),i=+t;return!i?n:i===1?r:n+i*(r-n)}var DEFAULT_MAX_SIZE=1e4;function lruCache(e){e=+e||DEFAULT_MAX_SIZE;var t,n,r;var i=function(){t={};n={};r=0};var a=function(i,a){if(++r>e){n=t;t={};r=1}return t[i]=a};i();return{clear:i,has:function(e){return has$1(t,e)||has$1(n,e)},get:function(e){return has$1(t,e)?t[e]:has$1(n,e)?a(e,n[e]):undefined},set:function(e,n){return has$1(t,e)?t[e]=n:a(e,n)}}}function merge$3(e,t,n,r){var i=t.length,a=n.length;if(!a)return t;if(!i)return n;var o=r||new t.constructor(i+a);var s=0,u=0,l=0;for(;s<i&&u<a;++l){o[l]=e(t[s],n[u])>0?n[u++]:t[s++]}for(;s<i;++s,++l){o[l]=t[s]}for(;u<a;++u,++l){o[l]=n[u]}return o}function repeat(e,t){var n="";while(--t>=0)n+=e;return n}function pad$2(e,t,n,r){var i=n||" ",a=e+"",o=t-a.length;return o<=0?a:r==="left"?repeat(i,o)+a:r==="center"?repeat(i,~~(o/2))+a+repeat(i,Math.ceil(o/2)):a+repeat(i,o)}function span(e){return e&&peek$1(e)-e[0]||0}function $$1(e){return isArray(e)?"["+e.map($$1)+"]":isObject(e)||isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function toBoolean(e){return e==null||e===""?null:!e||e==="false"||e==="0"?false:!!e}var defaultParser=function(e){return isNumber$1(e)?e:isDate$1(e)?e:Date.parse(e)};function toDate(e,t){t=t||defaultParser;return e==null||e===""?null:t(e)}function toString(e){return e==null||e===""?null:e+""}function toSet(e){var t={},n=e.length;for(var r=0;r<n;++r)t[e[r]]=true;return t}function truncate$1(e,t,n,r){var i=r!=null?r:"…",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:n==="left"?i+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function visitArray(e,t,n){if(e){if(t){var r=e.length;for(var i=0;i<r;++i){var a=t(e[i]);if(a)n(a,i,e)}}else{e.forEach(n)}}}var protocol_re=/^([A-Za-z]+:)?\/\//;var allowed_re=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i;var whitespace_re=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;var fileProtocol="file://";function loaderFactory(e,t){return function(n){return{options:n||{},sanitize:sanitize,load:load$1,fileAccess:!!t,file:fileLoader(t),http:httpLoader(e)}}}function load$1(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.sanitize(e,t)];case 1:n=i.sent(),r=n.href;return[2,n.localFile?this.file(r):this.http(r,t)]}}))}))}function sanitize(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i,a,o,s,u;return __generator(this,(function(l){t=extend$1({},this.options,t);n=this.fileAccess,r={href:null};s=allowed_re.test(e.replace(whitespace_re,""));if(e==null||typeof e!=="string"||!s){error("Sanitize failure, invalid URI: "+$$1(e))}u=protocol_re.test(e);if((o=t.baseURL)&&!u){if(!e.startsWith("/")&&o[o.length-1]!=="/"){e="/"+e}e=o+e}a=(i=e.startsWith(fileProtocol))||t.mode==="file"||t.mode!=="http"&&!u&&n;if(i){e=e.slice(fileProtocol.length)}else if(e.startsWith("//")){if(t.defaultProtocol==="file"){e=e.slice(2);a=true}else{e=(t.defaultProtocol||"http")+":"+e}}Object.defineProperty(r,"localFile",{value:!!a});r.href=e;if(t.target){r.target=t.target+""}if(t.rel){r.rel=t.rel+""}if(t.context==="image"&&t.crossOrigin){r.crossOrigin=t.crossOrigin+""}return[2,r]}))}))}function fileLoader(e){return e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){if(e)r(e);else n(t)}))}))}:fileReject}function fileReject(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){error("No file system access.");return[2]}))}))}function httpLoader(e){return e?function(t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,a;return __generator(this,(function(o){switch(o.label){case 0:r=extend$1({},this.options.http,n),i=n&&n.response;return[4,e(t,r)];case 1:a=o.sent();return[2,!a.ok?error(a.status+""+a.statusText):isFunction(a[i])?a[i]():a.text()]}}))}))}:httpReject}function httpReject(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){error("No HTTP fetch method available.");return[2]}))}))}var isValid=function(e){return e!=null&&e===e};var isBoolean$1=function(e){return e==="true"||e==="false"||e===true||e===false};var isDate=function(e){return!Number.isNaN(Date.parse(e))};var isNumber=function(e){return!Number.isNaN(+e)&&!(e instanceof Date)};var isInteger=function(e){return isNumber(e)&&Number.isInteger(+e)};var typeParsers={boolean:toBoolean,integer:toNumber,number:toNumber,date:toDate,string:toString,unknown:identity$6};var typeTests=[isBoolean$1,isInteger,isNumber,isDate];var typeList=["boolean","integer","number","date"];function inferType(e,t){if(!e||!e.length)return"unknown";var n=e.length,r=typeTests.length,i=typeTests.map((function(e,t){return t+1}));for(var a=0,o=0,s=void 0,u;a<n;++a){u=t?e[a][t]:e[a];for(s=0;s<r;++s){if(i[s]&&isValid(u)&&!typeTests[s](u)){i[s]=0;++o;if(o===typeTests.length)return"string"}}}return typeList[i.reduce((function(e,t){return e===0?t:e}),0)-1]}function inferTypes(e,t){return t.reduce((function(t,n){t[n]=inferType(e,n);return t}),{})}var EOL={},EOF={},QUOTE=34,NEWLINE=10,RETURN=13;function objectConverter(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function customConverter(e,t){var n=objectConverter(e);return function(r,i){return t(n(r),i,e)}}function inferColumns(e){var t=Object.create(null),n=[];e.forEach((function(e){for(var r in e){if(!(r in t)){n.push(t[r]=r)}}}));return n}function pad$1(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function formatYear$1(e){return e<0?"-"+pad$1(-e,6):e>9999?"+"+pad$1(e,6):pad$1(e,4)}function formatDate(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":formatYear$1(e.getUTCFullYear())+"-"+pad$1(e.getUTCMonth()+1,2)+"-"+pad$1(e.getUTCDate(),2)+(i?"T"+pad$1(t,2)+":"+pad$1(n,2)+":"+pad$1(r,2)+"."+pad$1(i,3)+"Z":r?"T"+pad$1(t,2)+":"+pad$1(n,2)+":"+pad$1(r,2)+"Z":n||t?"T"+pad$1(t,2)+":"+pad$1(n,2)+"Z":"")}function dsvFormat(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var n,r,a=i(e,(function(e,i){if(n)return n(e,i-1);r=e,n=t?customConverter(e,t):objectConverter(e)}));a.columns=r||[];return a}function i(e,t){var r=[],i=e.length,a=0,o=0,s,u=i<=0,l=false;if(e.charCodeAt(i-1)===NEWLINE)--i;if(e.charCodeAt(i-1)===RETURN)--i;function f(){if(u)return EOF;if(l)return l=false,EOL;var t,r=a,o;if(e.charCodeAt(r)===QUOTE){while(a++<i&&e.charCodeAt(a)!==QUOTE||e.charCodeAt(++a)===QUOTE);if((t=a)>=i)u=true;else if((o=e.charCodeAt(a++))===NEWLINE)l=true;else if(o===RETURN){l=true;if(e.charCodeAt(a)===NEWLINE)++a}return e.slice(r+1,t-1).replace(/""/g,'"')}while(a<i){if((o=e.charCodeAt(t=a++))===NEWLINE)l=true;else if(o===RETURN){l=true;if(e.charCodeAt(a)===NEWLINE)++a}else if(o!==n)continue;return e.slice(r,t)}return u=true,e.slice(r,i)}while((s=f())!==EOF){var c=[];while(s!==EOL&&s!==EOF)c.push(s),s=f();if(t&&(c=t(c,o++))==null)continue;r.push(c)}return r}function a(t,n){return t.map((function(t){return n.map((function(e){return f(t[e])})).join(e)}))}function o(t,n){if(n==null)n=inferColumns(t);return[n.map(f).join(e)].concat(a(t,n)).join("\n")}function s(e,t){if(t==null)t=inferColumns(e);return a(e,t).join("\n")}function u(e){return e.map(l).join("\n")}function l(t){return t.map(f).join(e)}function f(e){return e==null?"":e instanceof Date?formatDate(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:r,parseRows:i,format:o,formatBody:s,formatRows:u,formatRow:l,formatValue:f}}function delimitedFormat(e){var t=function(t,n){var r={delimiter:e};return dsv(t,n?extend$1(n,r):r)};t.responseType="text";return t}function dsv(e,t){if(t.header){e=t.header.map($$1).join(t.delimiter)+"\n"+e}return dsvFormat(t.delimiter).parse(e+"")}dsv.responseType="text";function isBuffer(e){return typeof Buffer==="function"&&isFunction(Buffer.isBuffer)?Buffer.isBuffer(e):false}function json(e,t){var n=t&&t.property?field$1(t.property):identity$6;return isObject(e)&&!isBuffer(e)?parseJSON(n(e),t):n(JSON.parse(e))}json.responseType="json";function parseJSON(e,t){if(!isArray(e)&&isIterable(e)){e=__spreadArray([],e)}return t&&t.copy?JSON.parse(JSON.stringify(e)):e}function identity$5(e){return e}function transform$3(e){if(e==null)return identity$5;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){if(!s)t=n=0;var u=2,l=e.length,f=new Array(l);f[0]=(t+=e[0])*r+a;f[1]=(n+=e[1])*i+o;while(u<l)f[u]=e[u],++u;return f}}function reverse$2(e,t){var n,r=e.length,i=r-t;while(i<--r)n=e[i],e[i++]=e[r],e[r]=n}function feature(e,t){if(typeof t==="string")t=e.objects[t];return t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map((function(t){return feature$1(e,t)}))}:feature$1(e,t)}function feature$1(e,t){var n=t.id,r=t.bbox,i=t.properties==null?{}:t.properties,a=object$1(e,t);return n==null&&r==null?{type:"Feature",properties:i,geometry:a}:r==null?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function object$1(e,t){var n=transform$3(e.transform),r=e.arcs;function i(e,t){if(t.length)t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a){t.push(n(i[a],a))}if(e<0)reverse$2(t,o)}function a(e){return n(e)}function o(e){var t=[];for(var n=0,r=e.length;n<r;++n)i(e[n],t);if(t.length<2)t.push(t[0]);return t}function s(e){var t=o(e);while(t.length<4)t.push(t[0]);return t}function u(e){return e.map(s)}function l(e){var t=e.type,n;switch(t){case"GeometryCollection":return{type:t,geometries:e.geometries.map(l)};case"Point":n=a(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(a);break;case"LineString":n=o(e.arcs);break;case"MultiLineString":n=e.arcs.map(o);break;case"Polygon":n=u(e.arcs);break;case"MultiPolygon":n=e.arcs.map(u);break;default:return null}return{type:t,coordinates:n}}return l(t)}function stitch(e,t){var n={},r={},i={},a=[],o=-1;t.forEach((function(n,r){var i=e.arcs[n<0?~n:n],a;if(i.length<3&&!i[1][0]&&!i[1][1]){a=t[++o],t[o]=n,t[r]=a}}));t.forEach((function(e){var t=s(e),n=t[0],a=t[1],o,u;if(o=i[n]){delete i[o.end];o.push(e);o.end=a;if(u=r[a]){delete r[u.start];var l=u===o?o:o.concat(u);r[l.start=o.start]=i[l.end=u.end]=l}else{r[o.start]=i[o.end]=o}}else if(o=r[a]){delete r[o.start];o.unshift(e);o.start=n;if(u=i[n]){delete i[u.end];var f=u===o?o:u.concat(o);r[f.start=u.start]=i[f.end=o.end]=f}else{r[o.start]=i[o.end]=o}}else{o=[e];r[o.start=n]=i[o.end=a]=o}}));function s(t){var n=e.arcs[t<0?~t:t],r=n[0],i;if(e.transform)i=[0,0],n.forEach((function(e){i[0]+=e[0],i[1]+=e[1]}));else i=n[n.length-1];return t<0?[i,r]:[r,i]}function u(e,t){for(var r in e){var i=e[r];delete t[i.start];delete i.start;delete i.end;i.forEach((function(e){n[e<0?~e:e]=1}));a.push(i)}}u(i,r);u(r,i);t.forEach((function(e){if(!n[e<0?~e:e])a.push([e])}));return a}function mesh(e){return object$1(e,meshArcs.apply(this,arguments))}function meshArcs(e,t,n){var r,i,a;if(arguments.length>1)r=extractArcs(e,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:stitch(e,r)}}function extractArcs(e,t,n){var r=[],i=[],a;function o(e){var t=e<0?~e:e;(i[t]||(i[t]=[])).push({i:e,g:a})}function s(e){e.forEach(o)}function u(e){e.forEach(s)}function l(e){e.forEach(u)}function f(e){switch(a=e,e.type){case"GeometryCollection":e.geometries.forEach(f);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":u(e.arcs);break;case"MultiPolygon":l(e.arcs);break}}f(t);i.forEach(n==null?function(e){r.push(e[0].i)}:function(e){if(n(e[0].g,e[e.length-1].g))r.push(e[0].i)});return r}var filters={interior:function(e,t){return e!==t},exterior:function(e,t){return e===t}};function topojson(e,t){var n,r,i,a;e=json(e,t);if(t&&t.feature){n=feature;i=t.feature}else if(t&&t.mesh){n=mesh;i=t.mesh;a=filters[t.filter]}else{error("Missing TopoJSON feature or mesh parameter.")}r=(r=e.objects[i])?n(e,r,a):error("Invalid TopoJSON object: "+i);return r&&r.features||[r]}topojson.responseType="json";var format$3={dsv:dsv,csv:delimitedFormat(","),tsv:delimitedFormat("\t"),json:json,topojson:topojson};function formats$1(e,t){if(arguments.length>1){format$3[e]=t;return this}else{return has$1(format$3,e)?format$3[e]:null}}function responseType(e){var t=formats$1(e);return t&&t.responseType||"text"}function ascending$2(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function bisector$1(e){var t=e;var n=e;if(e.length===1){t=function(t,n){return e(t)-n};n=ascendingComparator$1(e)}function r(e,t,r,i){if(r==null)r=0;if(i==null)i=e.length;while(r<i){var a=r+i>>>1;if(n(e[a],t)<0)r=a+1;else i=a}return r}function i(e,t,r,i){if(r==null)r=0;if(i==null)i=e.length;while(r<i){var a=r+i>>>1;if(n(e[a],t)>0)i=a;else r=a+1}return r}function a(e,n,i,a){if(i==null)i=0;if(a==null)a=e.length;var o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o}return{left:r,center:a,right:i}}function ascendingComparator$1(e){return function(t,n){return ascending$2(e(t),n)}}function number$6(e){return e===null?NaN:+e}function numbers$2(e,t){var n,r,i,a,o,s,u;return __generator(this,(function(l){switch(l.label){case 0:if(!(t===undefined))return[3,5];n=0,r=e;l.label=1;case 1:if(!(n<r.length))return[3,4];i=r[n];if(!(i!=null&&(i=+i)>=i))return[3,3];return[4,i];case 2:l.sent();l.label=3;case 3:n++;return[3,1];case 4:return[3,9];case 5:a=-1;o=0,s=e;l.label=6;case 6:if(!(o<s.length))return[3,9];u=s[o];if(!((u=t(u,++a,e))!=null&&(u=+u)>=u))return[3,8];return[4,u];case 7:l.sent();l.label=8;case 8:o++;return[3,6];case 9:return[2]}}))}var ascendingBisect=bisector$1(ascending$2);var bisectRight$1=ascendingBisect.right;var bisectLeft$1=ascendingBisect.left;bisector$1(number$6).center;function variance(e,t){var n=0;var r;var i=0;var a=0;if(t===undefined){for(var o=0,s=e;o<s.length;o++){var u=s[o];if(u!=null&&(u=+u)>=u){r=u-i;i+=r/++n;a+=r*(u-i)}}}else{var l=-1;for(var f=0,c=e;f<c.length;f++){var d=c[f];if((d=t(d,++l,e))!=null&&(d=+d)>=d){r=d-i;i+=r/++n;a+=r*(d-i)}}}if(n>1)return a/(n-1)}function deviation(e,t){var n=variance(e,t);return n?Math.sqrt(n):n}var Adder=function(){function e(){this._partials=new Float64Array(32);this._n=0}e.prototype.add=function(e){var t=this._partials;var n=0;for(var r=0;r<this._n&&r<32;r++){var i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);if(o)t[n++]=o;e=a}t[n]=e;this._n=n+1;return this};e.prototype.valueOf=function(){var e=this._partials;var t=this._n,n,r,i,a=0;if(t>0){a=e[--t];while(t>0){n=a;r=e[--t];a=n+r;i=r-(a-n);if(i)break}if(t>0&&(i<0&&e[t-1]<0||i>0&&e[t-1]>0)){r=i*2;n=a+r;if(r==n-a)a=n}}return a};return e}();function permute(e,t){return Array.from(t,(function(t){return e[t]}))}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(e,t,n){var r,i=-1,a,o,s;t=+t,e=+e,n=+n;if(e===t&&n>0)return[e];if(r=t<e)a=e,e=t,t=a;if((s=tickIncrement(e,t,n))===0||!isFinite(s))return[];if(s>0){var u=Math.round(e/s),l=Math.round(t/s);if(u*s<e)++u;if(l*s>t)--l;o=new Array(a=l-u+1);while(++i<a)o[i]=(u+i)*s}else{s=-s;var u=Math.round(e*s),l=Math.round(t*s);if(u/s<e)++u;if(l/s>t)--l;o=new Array(a=l-u+1);while(++i<a)o[i]=(u+i)/s}if(r)o.reverse();return o}function tickIncrement(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=e10?10:a>=e5?5:a>=e2?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=e10?10:a>=e5?5:a>=e2?2:1)}function tickStep(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;if(a>=e10)i*=10;else if(a>=e5)i*=5;else if(a>=e2)i*=2;return t<e?-i:i}function max$2(e,t){var n;if(t===undefined){for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a!=null&&(n<a||n===undefined&&a>=a)){n=a}}}else{var o=-1;for(var s=0,u=e;s<u.length;s++){var l=u[s];if((l=t(l,++o,e))!=null&&(n<l||n===undefined&&l>=l)){n=l}}}return n}function min$2(e,t){var n;if(t===undefined){for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a!=null&&(n>a||n===undefined&&a>=a)){n=a}}}else{var o=-1;for(var s=0,u=e;s<u.length;s++){var l=u[s];if((l=t(l,++o,e))!=null&&(n>l||n===undefined&&l>=l)){n=l}}}return n}function quickselect(e,t,n,r,i){if(n===void 0){n=0}if(r===void 0){r=e.length-1}if(i===void 0){i=ascending$2}while(r>n){if(r-n>600){var a=r-n+1;var o=t-n+1;var s=Math.log(a);var u=.5*Math.exp(2*s/3);var l=.5*Math.sqrt(s*u*(a-u)/a)*(o-a/2<0?-1:1);var f=Math.max(n,Math.floor(t-o*u/a+l));var c=Math.min(r,Math.floor(t+(a-o)*u/a+l));quickselect(e,t,f,c,i)}var d=e[t];var p=n;var h=r;swap$1(e,n,t);if(i(e[r],d)>0)swap$1(e,n,r);while(p<h){swap$1(e,p,h),++p,--h;while(i(e[p],d)<0)++p;while(i(e[h],d)>0)--h}if(i(e[n],d)===0)swap$1(e,n,h);else++h,swap$1(e,h,r);if(h<=t)n=h+1;if(t<=h)r=h-1}return e}function swap$1(e,t,n){var r=e[t];e[t]=e[n];e[n]=r}function quantile$1(e,t,n){e=Float64Array.from(numbers$2(e,n));if(!(r=e.length))return;if((t=+t)<=0||r<2)return min$2(e);if(t>=1)return max$2(e);var r,i=(r-1)*t,a=Math.floor(i),o=max$2(quickselect(e,a).subarray(0,a+1)),s=min$2(e.subarray(a+1));return o+(s-o)*(i-a)}function quantileSorted(e,t,n){if(n===void 0){n=number$6}if(!(r=e.length))return;if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(i-a)}function mean(e,t){var n=0;var r=0;if(t===undefined){for(var i=0,a=e;i<a.length;i++){var o=a[i];if(o!=null&&(o=+o)>=o){++n,r+=o}}}else{var s=-1;for(var u=0,l=e;u<l.length;u++){var f=l[u];if((f=t(f,++s,e))!=null&&(f=+f)>=f){++n,r+=f}}}if(n)return r/n}function median(e,t){return quantile$1(e,.5,t)}function flatten(e){var t,n,r;return __generator(this,(function(i){switch(i.label){case 0:t=0,n=e;i.label=1;case 1:if(!(t<n.length))return[3,4];r=n[t];return[5,__values(r)];case 2:i.sent();i.label=3;case 3:t++;return[3,1];case 4:return[2]}}))}function merge$2(e){return Array.from(flatten(e))}function range$1$1(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(i);while(++r<i){a[r]=e+r*n}return a}function sum(e,t){var n=0;if(t===undefined){for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a=+a){n+=a}}}else{var o=-1;for(var s=0,u=e;s<u.length;s++){var l=u[s];if(l=+t(l,++o,e)){n+=l}}}return n}function formatDecimal(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function formatDecimalParts(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function exponent(e){return e=formatDecimalParts(Math.abs(e)),e?e[1]:NaN}function formatGroup(e,t){return function(n,r){var i=n.length,a=[],o=0,s=e[0],u=0;while(i>0&&s>0){if(u+s+1>r)s=Math.max(1,r-u);a.push(n.substring(i-=s,i+s));if((u+=s+1)>r)break;s=e[o=(o+1)%e.length]}return a.reverse().join(t)}}function formatNumerals(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}var re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(e){if(!(t=re.exec(e)))throw new Error("invalid format: "+e);var t;return new FormatSpecifier({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}formatSpecifier.prototype=FormatSpecifier.prototype;function FormatSpecifier(e){this.fill=e.fill===undefined?" ":e.fill+"";this.align=e.align===undefined?">":e.align+"";this.sign=e.sign===undefined?"-":e.sign+"";this.symbol=e.symbol===undefined?"":e.symbol+"";this.zero=!!e.zero;this.width=e.width===undefined?undefined:+e.width;this.comma=!!e.comma;this.precision=e.precision===undefined?undefined:+e.precision;this.trim=!!e.trim;this.type=e.type===undefined?"":e.type+""}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===undefined?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===undefined?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function formatTrim(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n){switch(e[n]){case".":r=i=n;break;case"0":if(r===0)r=n;i=n;break;default:if(!+e[n])break e;if(r>0)r=0;break}}return r>0?e.slice(0,r)+e.slice(i+1):e}var prefixExponent;function formatPrefixAuto(e,t){var n=formatDecimalParts(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+formatDecimalParts(e,Math.max(0,t+a-1))[0]}function formatRounded(e,t){var n=formatDecimalParts(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var formatTypes={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:formatDecimal,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return formatRounded(e*100,t)},r:formatRounded,s:formatPrefixAuto,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function identity$4(e){return e}var map$1=Array.prototype.map,prefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function formatLocale$1(e){var t=e.grouping===undefined||e.thousands===undefined?identity$4:formatGroup(map$1.call(e.grouping,Number),e.thousands+""),n=e.currency===undefined?"":e.currency[0]+"",r=e.currency===undefined?"":e.currency[1]+"",i=e.decimal===undefined?".":e.decimal+"",a=e.numerals===undefined?identity$4:formatNumerals(map$1.call(e.numerals,String)),o=e.percent===undefined?"%":e.percent+"",s=e.minus===undefined?"−":e.minus+"",u=e.nan===undefined?"NaN":e.nan+"";function l(e){e=formatSpecifier(e);var l=e.fill,f=e.align,c=e.sign,d=e.symbol,p=e.zero,h=e.width,g=e.comma,m=e.precision,v=e.trim,y=e.type;if(y==="n")g=true,y="g";else if(!formatTypes[y])m===undefined&&(m=12),v=true,y="g";if(p||l==="0"&&f==="=")p=true,l="0",f="=";var _=d==="$"?n:d==="#"&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b=d==="$"?r:/[%p]/.test(y)?o:"";var x=formatTypes[y],E=/[defgprs%]/.test(y);m=m===undefined?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m));function S(e){var n=_,r=b,o,d,S;if(y==="c"){r=x(e)+r;e=""}else{e=+e;var $=e<0||1/e<0;e=isNaN(e)?u:x(Math.abs(e),m);if(v)e=formatTrim(e);if($&&+e===0&&c!=="+")$=false;n=($?c==="("?c:s:c==="-"||c==="("?"":c)+n;r=(y==="s"?prefixes[8+prefixExponent/3]:"")+r+($&&c==="("?")":"");if(E){o=-1,d=e.length;while(++o<d){if(S=e.charCodeAt(o),48>S||S>57){r=(S===46?i+e.slice(o+1):e.slice(o))+r;e=e.slice(0,o);break}}}}if(g&&!p)e=t(e,Infinity);var A=n.length+e.length+r.length,D=A<h?new Array(h-A+1).join(l):"";if(g&&p)e=t(D+e,D.length?h-r.length:Infinity),D="";switch(f){case"<":e=n+e+r+D;break;case"=":e=n+D+e+r;break;case"^":e=D.slice(0,A=D.length>>1)+n+e+r+D.slice(A);break;default:e=D+n+e+r;break}return a(e)}S.toString=function(){return e+""};return S}function f(e,t){var n=l((e=formatSpecifier(e),e.type="f",e)),r=Math.max(-8,Math.min(8,Math.floor(exponent(t)/3)))*3,i=Math.pow(10,-r),a=prefixes[8+r/3];return function(e){return n(i*e)+a}}return{format:l,formatPrefix:f}}var locale$2;var format$2;var formatPrefix;defaultLocale$2({thousands:",",grouping:[3],currency:["$",""]});function defaultLocale$2(e){locale$2=formatLocale$1(e);format$2=locale$2.format;formatPrefix=locale$2.formatPrefix;return locale$2}function precisionFixed(e){return Math.max(0,-exponent(Math.abs(e)))}function precisionPrefix(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(exponent(t)/3)))*3-exponent(Math.abs(e)))}function precisionRound(e,t){e=Math.abs(e),t=Math.abs(t)-e;return Math.max(0,exponent(t)-exponent(e))+1}var t0$2=new Date,t1$1=new Date;function newInterval(e,t,n,r){function i(t){return e(t=arguments.length===0?new Date:new Date(+t)),t}i.floor=function(t){return e(t=new Date(+t)),t};i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n};i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n};i.offset=function(e,n){return t(e=new Date(+e),n==null?1:Math.floor(n)),e};i.range=function(n,r,a){var o=[],s;n=i.ceil(n);a=a==null?1:Math.floor(a);if(!(n<r)||!(a>0))return o;do{o.push(s=new Date(+n)),t(n,a),e(n)}while(s<n&&n<r);return o};i.filter=function(n){return newInterval((function(t){if(t>=t)while(e(t),!n(t))t.setTime(t-1)}),(function(e,r){if(e>=e){if(r<0)while(++r<=0){while(t(e,-1),!n(e)){}}else while(--r>=0){while(t(e,+1),!n(e)){}}}}))};if(n){i.count=function(t,r){t0$2.setTime(+t),t1$1.setTime(+r);e(t0$2),e(t1$1);return Math.floor(n(t0$2,t1$1))};i.every=function(e){e=Math.floor(e);return!isFinite(e)||!(e>0)?null:!(e>1)?i:i.filter(r?function(t){return r(t)%e===0}:function(t){return i.count(0,t)%e===0})}}return i}var millisecond=newInterval((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));millisecond.every=function(e){e=Math.floor(e);if(!isFinite(e)||!(e>0))return null;if(!(e>1))return millisecond;return newInterval((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e}))};var durationSecond$1=1e3;var durationMinute$1=durationSecond$1*60;var durationHour$1=durationMinute$1*60;var durationDay$1=durationHour$1*24;var durationWeek$1=durationDay$1*7;var durationMonth$1=durationDay$1*30;var durationYear$1=durationDay$1*365;var second=newInterval((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*durationSecond$1)}),(function(e,t){return(t-e)/durationSecond$1}),(function(e){return e.getUTCSeconds()}));var minute=newInterval((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*durationSecond$1)}),(function(e,t){e.setTime(+e+t*durationMinute$1)}),(function(e,t){return(t-e)/durationMinute$1}),(function(e){return e.getMinutes()}));var hour=newInterval((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*durationSecond$1-e.getMinutes()*durationMinute$1)}),(function(e,t){e.setTime(+e+t*durationHour$1)}),(function(e,t){return(t-e)/durationHour$1}),(function(e){return e.getHours()}));var day=newInterval((function(e){return e.setHours(0,0,0,0)}),(function(e,t){return e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*durationMinute$1)/durationDay$1}),(function(e){return e.getDate()-1}));function weekday$1(e){return newInterval((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7);t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t*7)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*durationMinute$1)/durationWeek$1}))}var sunday=weekday$1(0);var monday=weekday$1(1);weekday$1(2);weekday$1(3);var thursday=weekday$1(4);weekday$1(5);weekday$1(6);var month=newInterval((function(e){e.setDate(1);e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12}),(function(e){return e.getMonth()}));var year=newInterval((function(e){e.setMonth(0,1);e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));year.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:newInterval((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e);t.setMonth(0,1);t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)}))};var utcMinute=newInterval((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*durationMinute$1)}),(function(e,t){return(t-e)/durationMinute$1}),(function(e){return e.getUTCMinutes()}));var utcHour=newInterval((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*durationHour$1)}),(function(e,t){return(t-e)/durationHour$1}),(function(e){return e.getUTCHours()}));var utcDay=newInterval((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/durationDay$1}),(function(e){return e.getUTCDate()-1}));function utcWeekday(e){return newInterval((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7);t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t*7)}),(function(e,t){return(t-e)/durationWeek$1}))}var utcSunday=utcWeekday(0);var utcMonday=utcWeekday(1);utcWeekday(2);utcWeekday(3);var utcThursday=utcWeekday(4);utcWeekday(5);utcWeekday(6);var utcMonth=newInterval((function(e){e.setUTCDate(1);e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12}),(function(e){return e.getUTCMonth()}));var utcYear=newInterval((function(e){e.setUTCMonth(0,1);e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));utcYear.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:newInterval((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e);t.setUTCMonth(0,1);t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)}))};function ticker(e,t,n,r,i,a){var o=[[second,1,durationSecond$1],[second,5,5*durationSecond$1],[second,15,15*durationSecond$1],[second,30,30*durationSecond$1],[a,1,durationMinute$1],[a,5,5*durationMinute$1],[a,15,15*durationMinute$1],[a,30,30*durationMinute$1],[i,1,durationHour$1],[i,3,3*durationHour$1],[i,6,6*durationHour$1],[i,12,12*durationHour$1],[r,1,durationDay$1],[r,2,2*durationDay$1],[n,1,durationWeek$1],[t,1,durationMonth$1],[t,3,3*durationMonth$1],[e,1,durationYear$1]];function s(e,t,n){var r;var i=t<e;if(i)r=[t,e],e=r[0],t=r[1];var a=n&&typeof n.range==="function"?n:u(e,t,n);var o=a?a.range(e,+t+1):[];return i?o.reverse():o}function u(t,n,r){var i=Math.abs(n-t)/r;var a=bisector$1((function(e){var t=e[2];return t})).right(o,i);if(a===o.length)return e.every(tickStep(t/durationYear$1,n/durationYear$1,r));if(a===0)return millisecond.every(Math.max(tickStep(t,n,r),1));var s=o[i/o[a-1][2]<o[a][2]/i?a-1:a],u=s[0],l=s[1];return u.every(l)}return[s,u]}var _6=ticker(utcYear,utcMonth,utcSunday,utcDay,utcHour,utcMinute),utcTicks=_6[0],utcTickInterval=_6[1];var _7=ticker(year,month,sunday,day,hour,minute),timeTicks=_7[0],timeTickInterval=_7[1];var YEAR="year";var QUARTER="quarter";var MONTH="month";var WEEK="week";var DATE="date";var DAY="day";var DAYOFYEAR="dayofyear";var HOURS="hours";var MINUTES="minutes";var SECONDS="seconds";var MILLISECONDS="milliseconds";var TIME_UNITS=[YEAR,QUARTER,MONTH,WEEK,DATE,DAY,DAYOFYEAR,HOURS,MINUTES,SECONDS,MILLISECONDS];var UNITS=TIME_UNITS.reduce((function(e,t,n){return e[t]=1+n,e}),{});function timeUnits(e){var t=array$5(e).slice(),n={};if(!t.length)error("Missing time unit.");t.forEach((function(e){if(has$1(UNITS,e)){n[e]=1}else{error("Invalid time unit: ".concat(e,"."))}}));var r=(n[WEEK]||n[DAY]?1:0)+(n[QUARTER]||n[MONTH]||n[DATE]?1:0)+(n[DAYOFYEAR]?1:0);if(r>1){error("Incompatible time units: ".concat(e))}t.sort((function(e,t){return UNITS[e]-UNITS[t]}));return t}var defaultSpecifiers=(_e={},_e[YEAR]="%Y ",_e[QUARTER]="Q%q ",_e[MONTH]="%b ",_e[DATE]="%d ",_e[WEEK]="W%U ",_e[DAY]="%a ",_e[DAYOFYEAR]="%j ",_e[HOURS]="%H:00",_e[MINUTES]="00:%M",_e[SECONDS]=":%S",_e[MILLISECONDS]=".%L",_e["".concat(YEAR,"-").concat(MONTH)]="%Y-%m ",_e["".concat(YEAR,"-").concat(MONTH,"-").concat(DATE)]="%Y-%m-%d ",_e["".concat(HOURS,"-").concat(MINUTES)]="%H:%M",_e);function timeUnitSpecifier(e,t){var n=extend$1({},defaultSpecifiers,t),r=timeUnits(e),i=r.length;var a="",o=0,s,u;for(o=0;o<i;){for(s=r.length;s>o;--s){u=r.slice(o,s).join("-");if(n[u]!=null){a+=n[u];o=s;break}}}return a.trim()}var t0$1=new Date;function localYear(e){t0$1.setFullYear(e);t0$1.setMonth(0);t0$1.setDate(1);t0$1.setHours(0,0,0,0);return t0$1}function dayofyear(e){return localDayOfYear(new Date(e))}function week(e){return localWeekNum(new Date(e))}function localDayOfYear(e){return day.count(localYear(e.getFullYear())-1,e)}function localWeekNum(e){return sunday.count(localYear(e.getFullYear())-1,e)}function localFirst(e){return localYear(e).getDay()}function localDate$1(e,t,n,r,i,a,o){if(0<=e&&e<100){var s=new Date(-1,t,n,r,i,a,o);s.setFullYear(e);return s}return new Date(e,t,n,r,i,a,o)}function utcdayofyear(e){return utcDayOfYear(new Date(e))}function utcweek(e){return utcWeekNum(new Date(e))}function utcDayOfYear(e){var t=Date.UTC(e.getUTCFullYear(),0,1);return utcDay.count(t-1,e)}function utcWeekNum(e){var t=Date.UTC(e.getUTCFullYear(),0,1);return utcSunday.count(t-1,e)}function utcFirst(e){t0$1.setTime(Date.UTC(e,0,1));return t0$1.getUTCDay()}function utcDate$1(e,t,n,r,i,a,o){if(0<=e&&e<100){var s=new Date(Date.UTC(-1,t,n,r,i,a,o));s.setUTCFullYear(n.y);return s}return new Date(Date.UTC(e,t,n,r,i,a,o))}function floor(e,t,n,r,i){var a=t||1,o=peek$1(e),s=function(e,t,i){i=i||e;return getUnit(n[i],r[i],e===o&&a,t)};var u=new Date,l=toSet(e),f=l[YEAR]?s(YEAR):constant$4(2012),c=l[MONTH]?s(MONTH):l[QUARTER]?s(QUARTER):zero$3,d=l[WEEK]&&l[DAY]?s(DAY,1,WEEK+DAY):l[WEEK]?s(WEEK,1):l[DAY]?s(DAY,1):l[DATE]?s(DATE,1):l[DAYOFYEAR]?s(DAYOFYEAR,1):one$2,p=l[HOURS]?s(HOURS):zero$3,h=l[MINUTES]?s(MINUTES):zero$3,g=l[SECONDS]?s(SECONDS):zero$3,m=l[MILLISECONDS]?s(MILLISECONDS):zero$3;return function(e){u.setTime(+e);var t=f(u);return i(t,c(u),d(u,t),p(u),h(u),g(u),m(u))}}function getUnit(e,t,n,r){var i=n<=1?e:r?function(t,i){return r+n*Math.floor((e(t,i)-r)/n)}:function(t,r){return n*Math.floor(e(t,r)/n)};return t?function(e,n){return t(i(e,n),n)}:i}function weekday(e,t,n){return t+e*7-(n+6)%7}var localGet=(_h={},_h[YEAR]=function(e){return e.getFullYear()},_h[QUARTER]=function(e){return Math.floor(e.getMonth()/3)},_h[MONTH]=function(e){return e.getMonth()},_h[DATE]=function(e){return e.getDate()},_h[HOURS]=function(e){return e.getHours()},_h[MINUTES]=function(e){return e.getMinutes()},_h[SECONDS]=function(e){return e.getSeconds()},_h[MILLISECONDS]=function(e){return e.getMilliseconds()},_h[DAYOFYEAR]=function(e){return localDayOfYear(e)},_h[WEEK]=function(e){return localWeekNum(e)},_h[WEEK+DAY]=function(e,t){return weekday(localWeekNum(e),e.getDay(),localFirst(t))},_h[DAY]=function(e,t){return weekday(1,e.getDay(),localFirst(t))},_h);var localInv=(_j={},_j[QUARTER]=function(e){return 3*e},_j[WEEK]=function(e,t){return weekday(e,0,localFirst(t))},_j);function timeFloor(e,t){return floor(e,t||1,localGet,localInv,localDate$1)}var utcGet=(_l={},_l[YEAR]=function(e){return e.getUTCFullYear()},_l[QUARTER]=function(e){return Math.floor(e.getUTCMonth()/3)},_l[MONTH]=function(e){return e.getUTCMonth()},_l[DATE]=function(e){return e.getUTCDate()},_l[HOURS]=function(e){return e.getUTCHours()},_l[MINUTES]=function(e){return e.getUTCMinutes()},_l[SECONDS]=function(e){return e.getUTCSeconds()},_l[MILLISECONDS]=function(e){return e.getUTCMilliseconds()},_l[DAYOFYEAR]=function(e){return utcDayOfYear(e)},_l[WEEK]=function(e){return utcWeekNum(e)},_l[DAY]=function(e,t){return weekday(1,e.getUTCDay(),utcFirst(t))},_l[WEEK+DAY]=function(e,t){return weekday(utcWeekNum(e),e.getUTCDay(),utcFirst(t))},_l);var utcInv=(_m={},_m[QUARTER]=function(e){return 3*e},_m[WEEK]=function(e,t){return weekday(e,0,utcFirst(t))},_m);function utcFloor(e,t){return floor(e,t||1,utcGet,utcInv,utcDate$1)}var timeIntervals=(_v={},_v[YEAR]=year,_v[QUARTER]=month.every(3),_v[MONTH]=month,_v[WEEK]=sunday,_v[DATE]=day,_v[DAY]=day,_v[DAYOFYEAR]=day,_v[HOURS]=hour,_v[MINUTES]=minute,_v[SECONDS]=second,_v[MILLISECONDS]=millisecond,_v);var utcIntervals=(_w={},_w[YEAR]=utcYear,_w[QUARTER]=utcMonth.every(3),_w[MONTH]=utcMonth,_w[WEEK]=utcSunday,_w[DATE]=utcDay,_w[DAY]=utcDay,_w[DAYOFYEAR]=utcDay,_w[HOURS]=utcHour,_w[MINUTES]=utcMinute,_w[SECONDS]=second,_w[MILLISECONDS]=millisecond,_w);function timeInterval(e){return timeIntervals[e]}function utcInterval(e){return utcIntervals[e]}function offset$3(e,t,n){return e?e.offset(t,n):undefined}function timeOffset(e,t,n){return offset$3(timeInterval(e),t,n)}function utcOffset(e,t,n){return offset$3(utcInterval(e),t,n)}function sequence$1(e,t,n,r){return e?e.range(t,n,r):undefined}function timeSequence(e,t,n,r){return sequence$1(timeInterval(e),t,n,r)}function utcSequence(e,t,n,r){return sequence$1(utcInterval(e),t,n,r)}var durationSecond=1e3,durationMinute=durationSecond*60,durationHour=durationMinute*60,durationDay=durationHour*24,durationWeek=durationDay*7,durationMonth=durationDay*30,durationYear=durationDay*365;var Milli=[YEAR,MONTH,DATE,HOURS,MINUTES,SECONDS,MILLISECONDS],Seconds=Milli.slice(0,-1),Minutes=Seconds.slice(0,-1),Hours=Minutes.slice(0,-1),Day=Hours.slice(0,-1),Week=[YEAR,WEEK],Month=[YEAR,MONTH],Year=[YEAR];var intervals=[[Seconds,1,durationSecond],[Seconds,5,5*durationSecond],[Seconds,15,15*durationSecond],[Seconds,30,30*durationSecond],[Minutes,1,durationMinute],[Minutes,5,5*durationMinute],[Minutes,15,15*durationMinute],[Minutes,30,30*durationMinute],[Hours,1,durationHour],[Hours,3,3*durationHour],[Hours,6,6*durationHour],[Hours,12,12*durationHour],[Day,1,durationDay],[Week,1,durationWeek],[Month,1,durationMonth],[Month,3,3*durationMonth],[Year,1,durationYear]];function bin$2(e){var t=e.extent,n=e.maxbins||40,r=Math.abs(span(t))/n;var i=bisector$1((function(e){return e[2]})).right(intervals,r),a,o;if(i===intervals.length){a=Year,o=tickStep(t[0]/durationYear,t[1]/durationYear,n)}else if(i){i=intervals[r/intervals[i-1][2]<intervals[i][2]/r?i-1:i];a=i[0];o=i[1]}else{a=Milli;o=Math.max(tickStep(t[0],t[1],n),1)}return{units:a,step:o}}function localDate(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);t.setFullYear(e.y);return t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function utcDate(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));t.setUTCFullYear(e.y);return t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function newDate(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function formatLocale(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,u=e.shortMonths;var l=formatRe(i),f=formatLookup(i),c=formatRe(a),d=formatLookup(a),p=formatRe(o),h=formatLookup(o),g=formatRe(s),m=formatLookup(s),v=formatRe(u),y=formatLookup(u);var _={a:R,A:F,b:L,B:P,c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,g:formatYearISO,G:formatFullYearISO,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:I,q:M,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent};var b={a:z,A:B,b:U,B:j,c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,g:formatUTCYearISO,G:formatUTCFullYearISO,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:H,q:q,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent};var x={a:D,A:w,b:C,B:T,c:k,d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,g:parseYear,G:parseFullYear,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:A,q:parseQuarter,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:O,X:N,y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};_.x=E(n,_);_.X=E(r,_);_.c=E(t,_);b.x=E(n,b);b.X=E(r,b);b.c=E(t,b);function E(e,t){return function(n){var r=[],i=-1,a=0,o=e.length,s,u,l;if(!(n instanceof Date))n=new Date(+n);while(++i<o){if(e.charCodeAt(i)===37){r.push(e.slice(a,i));if((u=pads[s=e.charAt(++i)])!=null)s=e.charAt(++i);else u=s==="e"?" ":"0";if(l=t[s])s=l(n,u);r.push(s);a=i+1}}r.push(e.slice(a,i));return r.join("")}}function S(e,t){return function(n){var r=newDate(1900,undefined,1),i=$(r,e,n+="",0),a,o;if(i!=n.length)return null;if("Q"in r)return new Date(r.Q);if("s"in r)return new Date(r.s*1e3+("L"in r?r.L:0));if(t&&!("Z"in r))r.Z=0;if("p"in r)r.H=r.H%12+r.p*12;if(r.m===undefined)r.m="q"in r?r.q:0;if("V"in r){if(r.V<1||r.V>53)return null;if(!("w"in r))r.w=1;if("Z"in r){a=utcDate(newDate(r.y,0,1)),o=a.getUTCDay();a=o>4||o===0?utcMonday.ceil(a):utcMonday(a);a=utcDay.offset(a,(r.V-1)*7);r.y=a.getUTCFullYear();r.m=a.getUTCMonth();r.d=a.getUTCDate()+(r.w+6)%7}else{a=localDate(newDate(r.y,0,1)),o=a.getDay();a=o>4||o===0?monday.ceil(a):monday(a);a=day.offset(a,(r.V-1)*7);r.y=a.getFullYear();r.m=a.getMonth();r.d=a.getDate()+(r.w+6)%7}}else if("W"in r||"U"in r){if(!("w"in r))r.w="u"in r?r.u%7:"W"in r?1:0;o="Z"in r?utcDate(newDate(r.y,0,1)).getUTCDay():localDate(newDate(r.y,0,1)).getDay();r.m=0;r.d="W"in r?(r.w+6)%7+r.W*7-(o+5)%7:r.w+r.U*7-(o+6)%7}if("Z"in r){r.H+=r.Z/100|0;r.M+=r.Z%100;return utcDate(r)}return localDate(r)}}function $(e,t,n,r){var i=0,a=t.length,o=n.length,s,u;while(i<a){if(r>=o)return-1;s=t.charCodeAt(i++);if(s===37){s=t.charAt(i++);u=x[s in pads?t.charAt(i++):s];if(!u||(r=u(e,n,r))<0)return-1}else if(s!=n.charCodeAt(r++)){return-1}}return r}function A(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=f.get(r[0].toLowerCase()),n+r[0].length):-1}function D(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=h.get(r[0].toLowerCase()),n+r[0].length):-1}function w(e,t,n){var r=c.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1}function C(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1}function T(e,t,n){var r=g.exec(t.slice(n));return r?(e.m=m.get(r[0].toLowerCase()),n+r[0].length):-1}function k(e,n,r){return $(e,t,n,r)}function O(e,t,r){return $(e,n,t,r)}function N(e,t,n){return $(e,r,t,n)}function R(e){return o[e.getDay()]}function F(e){return a[e.getDay()]}function L(e){return u[e.getMonth()]}function P(e){return s[e.getMonth()]}function I(e){return i[+(e.getHours()>=12)]}function M(e){return 1+~~(e.getMonth()/3)}function z(e){return o[e.getUTCDay()]}function B(e){return a[e.getUTCDay()]}function U(e){return u[e.getUTCMonth()]}function j(e){return s[e.getUTCMonth()]}function H(e){return i[+(e.getUTCHours()>=12)]}function q(e){return 1+~~(e.getUTCMonth()/3)}return{format:function(e){var t=E(e+="",_);t.toString=function(){return e};return t},parse:function(e){var t=S(e+="",false);t.toString=function(){return e};return t},utcFormat:function(e){var t=E(e+="",b);t.toString=function(){return e};return t},utcParse:function(e){var t=S(e+="",true);t.toString=function(){return e};return t}}}var pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function requote(e){return e.replace(requoteRe,"\\$&")}function formatRe(e){return new RegExp("^(?:"+e.map(requote).join("|")+")","i")}function formatLookup(e){return new Map(e.map((function(e,t){return[e.toLowerCase(),t]})))}function parseWeekdayNumberSunday(e,t,n){var r=numberRe.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function parseWeekdayNumberMonday(e,t,n){var r=numberRe.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function parseWeekNumberSunday(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function parseWeekNumberISO(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function parseWeekNumberMonday(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function parseFullYear(e,t,n){var r=numberRe.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function parseYear(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function parseZone(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function parseQuarter(e,t,n){var r=numberRe.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function parseMonthNumber(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function parseDayOfMonth(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function parseDayOfYear(e,t,n){var r=numberRe.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function parseHour24(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function parseMinutes(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function parseSeconds(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function parseMilliseconds(e,t,n){var r=numberRe.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function parseMicroseconds(e,t,n){var r=numberRe.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function parseLiteralPercent(e,t,n){var r=percentRe.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function parseUnixTimestamp(e,t,n){var r=numberRe.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function parseUnixTimestampSeconds(e,t,n){var r=numberRe.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function formatDayOfMonth(e,t){return pad(e.getDate(),t,2)}function formatHour24(e,t){return pad(e.getHours(),t,2)}function formatHour12(e,t){return pad(e.getHours()%12||12,t,2)}function formatDayOfYear(e,t){return pad(1+day.count(year(e),e),t,3)}function formatMilliseconds(e,t){return pad(e.getMilliseconds(),t,3)}function formatMicroseconds(e,t){return formatMilliseconds(e,t)+"000"}function formatMonthNumber(e,t){return pad(e.getMonth()+1,t,2)}function formatMinutes(e,t){return pad(e.getMinutes(),t,2)}function formatSeconds(e,t){return pad(e.getSeconds(),t,2)}function formatWeekdayNumberMonday(e){var t=e.getDay();return t===0?7:t}function formatWeekNumberSunday(e,t){return pad(sunday.count(year(e)-1,e),t,2)}function dISO(e){var t=e.getDay();return t>=4||t===0?thursday(e):thursday.ceil(e)}function formatWeekNumberISO(e,t){e=dISO(e);return pad(thursday.count(year(e),e)+(year(e).getDay()===4),t,2)}function formatWeekdayNumberSunday(e){return e.getDay()}function formatWeekNumberMonday(e,t){return pad(monday.count(year(e)-1,e),t,2)}function formatYear(e,t){return pad(e.getFullYear()%100,t,2)}function formatYearISO(e,t){e=dISO(e);return pad(e.getFullYear()%100,t,2)}function formatFullYear(e,t){return pad(e.getFullYear()%1e4,t,4)}function formatFullYearISO(e,t){var n=e.getDay();e=n>=4||n===0?thursday(e):thursday.ceil(e);return pad(e.getFullYear()%1e4,t,4)}function formatZone(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+pad(t/60|0,"0",2)+pad(t%60,"0",2)}function formatUTCDayOfMonth(e,t){return pad(e.getUTCDate(),t,2)}function formatUTCHour24(e,t){return pad(e.getUTCHours(),t,2)}function formatUTCHour12(e,t){return pad(e.getUTCHours()%12||12,t,2)}function formatUTCDayOfYear(e,t){return pad(1+utcDay.count(utcYear(e),e),t,3)}function formatUTCMilliseconds(e,t){return pad(e.getUTCMilliseconds(),t,3)}function formatUTCMicroseconds(e,t){return formatUTCMilliseconds(e,t)+"000"}function formatUTCMonthNumber(e,t){return pad(e.getUTCMonth()+1,t,2)}function formatUTCMinutes(e,t){return pad(e.getUTCMinutes(),t,2)}function formatUTCSeconds(e,t){return pad(e.getUTCSeconds(),t,2)}function formatUTCWeekdayNumberMonday(e){var t=e.getUTCDay();return t===0?7:t}function formatUTCWeekNumberSunday(e,t){return pad(utcSunday.count(utcYear(e)-1,e),t,2)}function UTCdISO(e){var t=e.getUTCDay();return t>=4||t===0?utcThursday(e):utcThursday.ceil(e)}function formatUTCWeekNumberISO(e,t){e=UTCdISO(e);return pad(utcThursday.count(utcYear(e),e)+(utcYear(e).getUTCDay()===4),t,2)}function formatUTCWeekdayNumberSunday(e){return e.getUTCDay()}function formatUTCWeekNumberMonday(e,t){return pad(utcMonday.count(utcYear(e)-1,e),t,2)}function formatUTCYear(e,t){return pad(e.getUTCFullYear()%100,t,2)}function formatUTCYearISO(e,t){e=UTCdISO(e);return pad(e.getUTCFullYear()%100,t,2)}function formatUTCFullYear(e,t){return pad(e.getUTCFullYear()%1e4,t,4)}function formatUTCFullYearISO(e,t){var n=e.getUTCDay();e=n>=4||n===0?utcThursday(e):utcThursday.ceil(e);return pad(e.getUTCFullYear()%1e4,t,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(e){return+e}function formatUnixTimestampSeconds(e){return Math.floor(+e/1e3)}var locale$1;var timeFormat$2;var timeParse$1;var utcFormat$1;var utcParse$1;defaultLocale$1({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function defaultLocale$1(e){locale$1=formatLocale(e);timeFormat$2=locale$1.format;timeParse$1=locale$1.parse;utcFormat$1=locale$1.utcFormat;utcParse$1=locale$1.utcParse;return locale$1}function memoize(e){var t={};return function(n){return t[n]||(t[n]=e(n))}}function trimZeroes(e,t){return function(n){var r=e(n),i=r.indexOf(t);if(i<0)return r;var a=rightmostDigit(r,i);var o=a<r.length?r.slice(a):"";while(--a>i)if(r[a]!=="0"){++a;break}return r.slice(0,a)+o}}function rightmostDigit(e,t){var n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;){r=e.charCodeAt(n);if(r>=48&&r<=57)return n+1}}function numberLocale(e){var t=memoize(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat:function(e){var n=formatSpecifier(e||",");if(n.precision==null){n.precision=12;switch(n.type){case"%":n.precision-=2;break;case"e":n.precision-=1;break}return trimZeroes(t(n),t(".1f")(1)[1])}else{return t(n)}},formatSpan:function(e,r,i,a){a=formatSpecifier(a==null?",f":a);var o=tickStep(e,r,i),s=Math.max(Math.abs(e),Math.abs(r));var u;if(a.precision==null){switch(a.type){case"s":{if(!isNaN(u=precisionPrefix(o,s))){a.precision=u}return n(a,s)}case"":case"e":case"g":case"p":case"r":{if(!isNaN(u=precisionRound(o,s))){a.precision=u-(a.type==="e")}break}case"f":case"%":{if(!isNaN(u=precisionFixed(o))){a.precision=u-(a.type==="%")*2}break}}}return t(a)}}}var defaultNumberLocale;resetNumberFormatDefaultLocale();function resetNumberFormatDefaultLocale(){return defaultNumberLocale=numberLocale({format:format$2,formatPrefix:formatPrefix})}function numberFormatLocale(e){return numberLocale(formatLocale$1(e))}function numberFormatDefaultLocale(e){return arguments.length?defaultNumberLocale=numberFormatLocale(e):defaultNumberLocale}function timeMultiFormat(e,t,n){n=n||{};if(!isObject(n)){error("Invalid time multi-format specifier: ".concat(n))}var r=t(SECONDS),i=t(MINUTES),a=t(HOURS),o=t(DATE),s=t(WEEK),u=t(MONTH),l=t(QUARTER),f=t(YEAR),c=e(n[MILLISECONDS]||".%L"),d=e(n[SECONDS]||":%S"),p=e(n[MINUTES]||"%I:%M"),h=e(n[HOURS]||"%I %p"),g=e(n[DATE]||n[DAY]||"%a %d"),m=e(n[WEEK]||"%b %d"),v=e(n[MONTH]||"%B"),y=e(n[QUARTER]||"%B"),_=e(n[YEAR]||"%Y");return function(e){return(r(e)<e?c:i(e)<e?d:a(e)<e?p:o(e)<e?h:u(e)<e?s(e)<e?g:m:f(e)<e?l(e)<e?v:y:_)(e)}}function timeLocale(e){var t=memoize(e.format),n=memoize(e.utcFormat);return{timeFormat:function(e){return isString(e)?t(e):timeMultiFormat(t,timeInterval,e)},utcFormat:function(e){return isString(e)?n(e):timeMultiFormat(n,utcInterval,e)},timeParse:memoize(e.parse),utcParse:memoize(e.utcParse)}}var defaultTimeLocale;resetTimeFormatDefaultLocale();function resetTimeFormatDefaultLocale(){return defaultTimeLocale=timeLocale({format:timeFormat$2,parse:timeParse$1,utcFormat:utcFormat$1,utcParse:utcParse$1})}function timeFormatLocale(e){return timeLocale(formatLocale(e))}function timeFormatDefaultLocale(e){return arguments.length?defaultTimeLocale=timeFormatLocale(e):defaultTimeLocale}var createLocale=function(e,t){return extend$1({},e,t)};function locale(e,t){var n=e?numberFormatLocale(e):numberFormatDefaultLocale();var r=t?timeFormatLocale(t):timeFormatDefaultLocale();return createLocale(n,r)}function defaultLocale(e,t){var n=arguments.length;if(n&&n!==2){error("defaultLocale expects either zero or two arguments.")}return n?createLocale(numberFormatDefaultLocale(e),timeFormatDefaultLocale(t)):createLocale(numberFormatDefaultLocale(),timeFormatDefaultLocale())}function resetDefaultLocale(){resetNumberFormatDefaultLocale();resetTimeFormatDefaultLocale();return defaultLocale()}function read(e,t,n,r){t=t||{};var i=formats$1(t.type||"json");if(!i)error("Unknown data format type: "+t.type);e=i(e,t);if(t.parse)parse$5(e,t.parse,n,r);if(has$1(e,"columns"))delete e.columns;return e}function parse$5(e,t,n,r){if(!e.length)return;var i=timeFormatDefaultLocale();n=n||i.timeParse;r=r||i.utcParse;var a=e.columns||Object.keys(e[0]),o,s,u,l,f,c;if(t==="auto")t=inferTypes(e,a);a=Object.keys(t);var d=a.map((function(e){var i=t[e];var a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:"))){a=i.split(/:(.+)?/,2);o=a[1];if(o[0]==="'"&&o[o.length-1]==="'"||o[0]==='"'&&o[o.length-1]==='"'){o=o.slice(1,-1)}var s=a[0]==="utc"?r:n;return s(o)}if(!typeParsers[i]){throw Error("Illegal format pattern: "+e+":"+i)}return typeParsers[i]}));for(u=0,f=e.length,c=a.length;u<f;++u){o=e[u];for(l=0;l<c;++l){s=a[l];o[s]=d[l](o[s])}}}var loader=loaderFactory(typeof fetch!=="undefined"&&fetch,null);function UniqueList(e){var t=e||identity$6,n=[],r={};n.add=function(e){var i=t(e);if(!r[i]){r[i]=1;n.push(e)}return n};n.remove=function(e){var i=t(e);if(r[i]){r[i]=0;var a=n.indexOf(e);if(a>=0)n.splice(a,1)}return n};return n}function asyncCallback(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,t(e)];case 1:r.sent();return[3,3];case 2:n=r.sent();e.error(n);return[3,3];case 3:return[2]}}))}))}var TUPLE_ID_KEY=Symbol("vega_id");var TUPLE_ID=1;function isTuple(e){return!!(e&&tupleid(e))}function tupleid(e){return e[TUPLE_ID_KEY]}function setid(e,t){e[TUPLE_ID_KEY]=t;return e}function ingest$1(e){var t=e===Object(e)?e:{data:e};return tupleid(t)?t:setid(t,TUPLE_ID++)}function derive(e){return rederive(e,ingest$1({}))}function rederive(e,t){for(var n in e)t[n]=e[n];return t}function replace$1(e,t){return setid(t,tupleid(e))}function stableCompare(e,t){return!e?null:t?function(n,r){return e(n,r)||tupleid(t(n))-tupleid(t(r))}:function(t,n){return e(t,n)||tupleid(t)-tupleid(n)}}function isChangeSet(e){return e&&e.constructor===changeset}function changeset(){var e=[],t=[],n=[],r=[],i=[];var a=null,o=false;return{constructor:changeset,insert:function(t){var n=array$5(t),r=n.length;for(var i=0;i<r;++i)e.push(n[i]);return this},remove:function(e){var n=isFunction(e)?r:t,i=array$5(e),a=i.length;for(var o=0;o<a;++o)n.push(i[o]);return this},modify:function(e,t,r){var a={field:t,value:constant$4(r)};if(isFunction(e)){a.filter=e;i.push(a)}else{a.tuple=e;n.push(a)}return this},encode:function(e,t){if(isFunction(e))i.push({filter:e,field:t});else n.push({tuple:e,field:t});return this},clean:function(e){a=e;return this},reflow:function(){o=true;return this},pulse:function(s,u){var l={},f={};var c,d,p,h,g,m;for(c=0,d=u.length;c<d;++c){l[tupleid(u[c])]=1}for(c=0,d=t.length;c<d;++c){g=t[c];l[tupleid(g)]=-1}for(c=0,d=r.length;c<d;++c){h=r[c];u.forEach((function(e){if(h(e))l[tupleid(e)]=-1}))}for(c=0,d=e.length;c<d;++c){g=e[c];m=tupleid(g);if(l[m]){l[m]=1}else{s.add.push(ingest$1(e[c]))}}for(c=0,d=u.length;c<d;++c){g=u[c];if(l[tupleid(g)]<0)s.rem.push(g)}function v(e,t,n){if(n){e[t]=n(e)}else{s.encode=t}if(!o)f[tupleid(e)]=e}for(c=0,d=n.length;c<d;++c){p=n[c];g=p.tuple;h=p.field;m=l[tupleid(g)];if(m>0){v(g,h,p.value);s.modifies(h)}}for(c=0,d=i.length;c<d;++c){p=i[c];h=p.filter;u.forEach((function(e){if(h(e)&&l[tupleid(e)]>0){v(e,p.field,p.value)}}));s.modifies(p.field)}if(o){s.mod=t.length||r.length?u.filter((function(e){return l[tupleid(e)]>0})):u.slice()}else{for(m in f)s.mod.push(f[m])}if(a||a==null&&(t.length||r.length)){s.clean(true)}return s}}}var CACHE="_:mod:_";function Parameters(){Object.defineProperty(this,CACHE,{writable:true,value:{}})}Parameters.prototype={set:function(e,t,n,r){var i=this,a=i[e],o=i[CACHE];if(t!=null&&t>=0){if(a[t]!==n||r){a[t]=n;o[t+":"+e]=-1;o[e]=-1}}else if(a!==n||r){i[e]=n;o[e]=isArray(n)?1+n.length:-1}return i},modified:function(e,t){var n=this[CACHE];if(!arguments.length){for(var r in n){if(n[r])return true}return false}else if(isArray(e)){for(var r=0;r<e.length;++r){if(n[e[r]])return true}return false}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear:function(){this[CACHE]={};return this}};var OP_ID=0;var PULSE="pulse",NO_PARAMS=new Parameters;var SKIP$1$1=1,MODIFIED=2;function Operator(e,t,n,r){this.id=++OP_ID;this.value=e;this.stamp=-1;this.rank=-1;this.qrank=-1;this.flags=0;if(t){this._update=t}if(n)this.parameters(n,r)}function flag(e){return function(t){var n=this.flags;if(arguments.length===0)return!!(n&e);this.flags=t?n|e:n&~e;return this}}Operator.prototype={targets:function(){return this._targets||(this._targets=UniqueList(id))},set:function(e){if(this.value!==e){this.value=e;return 1}else{return 0}},skip:flag(SKIP$1$1),modified:flag(MODIFIED),parameters:function(e,t,n){var r=this;t=t!==false;var i=this._argval=this._argval||new Parameters,a=this._argops=this._argops||[],o=[];var s,u,l,f;var c=function(e,n,s){if(s instanceof Operator){if(s!==r){if(t)s.targets().add(r);o.push(s)}a.push({op:s,name:e,index:n})}else{i.set(e,n,s)}};for(s in e){u=e[s];if(s===PULSE){array$5(u).forEach((function(e){if(!(e instanceof Operator)){error("Pulse parameters must be operator instances.")}else if(e!==r){e.targets().add(r);o.push(e)}}));this.source=u}else if(isArray(u)){i.set(s,-1,Array(l=u.length));for(f=0;f<l;++f)c(s,f,u[f])}else{c(s,-1,u)}}this.marshall().clear();if(n)a.initonly=true;return o},marshall:function(e){var t=this._argval||NO_PARAMS,n=this._argops;var r,i,a,o;if(n){var s=n.length;for(i=0;i<s;++i){r=n[i];a=r.op;o=a.modified()&&a.stamp===e;t.set(r.name,r.index,a.value,o)}if(n.initonly){for(i=0;i<s;++i){r=n[i];r.op.targets().remove(this)}this._argops=null;this._update=null}}return t},detach:function(){var e=this._argops;var t,n,r,i;if(e){for(t=0,n=e.length;t<n;++t){r=e[t];i=r.op;if(i._targets){i._targets.remove(this)}}}this.pulse=null;this.source=null},evaluate:function(e){var t=this._update;if(t){var n=this.marshall(e.stamp),r=t.call(this,n,e);n.clear();if(r!==this.value){this.value=r}else if(!this.modified()){return e.StopPropagation}}},run:function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;if(this.skip()){this.skip(false);t=0}else{t=this.evaluate(e)}return this.pulse=t||e}};function add$4(e,t,n,r){var i=1,a;if(e instanceof Operator){a=e}else if(e&&e.prototype instanceof Operator){a=new e}else if(isFunction(e)){a=new Operator(null,e)}else{i=0;a=new Operator(e,t)}this.rank(a);if(i){r=n;n=t}if(n)this.connect(a,a.parameters(n,r));this.touch(a);return a}function connect(e,t){var n=e.rank,r=t.length;for(var i=0;i<r;++i){if(n<t[i].rank){this.rerank(e);return}}}var STREAM_ID=0;function EventStream(e,t,n){this.id=++STREAM_ID;this.value=null;if(n)this.receive=n;if(e)this._filter=e;if(t)this._apply=t}function stream(e,t,n){return new EventStream(e,t,n)}EventStream.prototype={_filter:truthy,_apply:identity$6,targets:function(){return this._targets||(this._targets=UniqueList(id))},consume:function(e){if(!arguments.length)return!!this._consume;this._consume=!!e;return this},receive:function(e){if(this._filter(e)){var t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(var i=0;i<r;++i)n[i].receive(t);if(this._consume){e.preventDefault();e.stopPropagation()}}},filter:function(e){var t=stream(e);this.targets().add(t);return t},apply:function(e){var t=stream(null,e);this.targets().add(t);return t},merge:function(){var e=stream();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t){arguments[t].targets().add(e)}return e},throttle:function(e){var t=-1;return this.filter((function(){var n=Date.now();if(n-t>e){t=n;return 1}else{return 0}}))},debounce:function(e){var t=stream();this.targets().add(stream(null,null,debounce(e,(function(e){var n=e.dataflow;t.receive(e);if(n&&n.run)n.run()}))));return t},between:function(e,t){var n=false;e.targets().add(stream(null,null,(function(){return n=true})));t.targets().add(stream(null,null,(function(){return n=false})));return this.filter((function(){return n}))},detach:function(){this._filter=truthy;this._targets=null}};function events$2(e,t,n,r){var i=this,a=stream(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(error){i.error(error)}finally{i.run()}};var s;if(typeof e==="string"&&typeof document!=="undefined"){s=document.querySelectorAll(e)}else{s=array$5(e)}var u=s.length;for(var l=0;l<u;++l){s[l].addEventListener(t,o)}return a}function parse$4(e,t){var n=this.locale();return read(e,t,n.timeParse,n.utcParse)}function ingest(e,t,n){t=this.parse(t,n);return this.pulse(e,this.changeset().insert(t))}function request(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i,a;return __generator(this,(function(o){switch(o.label){case 0:n=this;r=0;o.label=1;case 1:o.trys.push([1,3,,4]);return[4,n.loader().load(e,{context:"dataflow",response:responseType(t&&t.type)})];case 2:i=o.sent();try{i=n.parse(i,t)}catch(s){r=-2;n.warn("Data ingestion failed",e,s)}return[3,4];case 3:a=o.sent();r=-1;n.warn("Loading failed",e,a);return[3,4];case 4:return[2,{data:i,status:r}]}}))}))}function preload(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,a;return __generator(this,(function(o){switch(o.label){case 0:r=this,i=r._pending||loadPending(r);i.requests+=1;return[4,r.request(t,n)];case 1:a=o.sent();r.pulse(e,r.changeset().remove(truthy).insert(a.data||[]));i.done();return[2,a]}}))}))}function loadPending(e){var t;var n=new Promise((function(e){return t=e}));n.requests=0;n.done=function(){if(--n.requests===0){e._pending=null;t(e)}};return e._pending=n}var SKIP$2={skip:true};function on(e,t,n,r,i){var a=e instanceof Operator?onOperator:onStream;a(this,e,t,n,r,i);return this}function onStream(e,t,n,r,i,a){var o=extend$1({},a,SKIP$2);var s,u;if(!isFunction(n))n=constant$4(n);if(r===undefined){s=function(t){return e.touch(n(t))}}else if(isFunction(r)){u=new Operator(null,r,i,false);s=function(t){u.evaluate(t);var r=n(t),i=u.value;isChangeSet(i)?e.pulse(r,i,a):e.update(r,i,o)}}else{s=function(t){return e.update(n(t),r,o)}}t.apply(s)}function onOperator(e,t,n,r,i,a){if(r===undefined){t.targets().add(n)}else{var o=a||{},s=new Operator(null,updater(n,r),i,false);s.modified(o.force);s.rank=t.rank;t.targets().add(s);if(n){s.skip(true);s.value=n.value;s.targets().add(n);e.connect(n,[s])}}}function updater(e,t){t=isFunction(t)?t:constant$4(t);return e?function(n,r){var i=t(n,r);if(!e.skip()){e.skip(i!==this.value).value=i}return i}:t}function rank(e){e.rank=++this._rank}function rerank(e){var t=[e];var n,r,i;while(t.length){this.rank(n=t.pop());if(r=n._targets){for(i=r.length;--i>=0;){t.push(n=r[i]);if(n===e)error("Cycle detected in dataflow graph.")}}}}var StopPropagation={};var ADD=1<<0,REM=1<<1,MOD$1=1<<2,ADD_REM=ADD|REM,ADD_MOD=ADD|MOD$1,ALL=ADD|REM|MOD$1,REFLOW=1<<3,SOURCE=1<<4,NO_SOURCE=1<<5,NO_FIELDS=1<<6;function Pulse(e,t,n){this.dataflow=e;this.stamp=t==null?-1:t;this.add=[];this.rem=[];this.mod=[];this.fields=null;this.encode=n||null}function materialize(e,t){var n=[];visitArray(e,t,(function(e){return n.push(e)}));return n}function filter$1(e,t){var n={};e.visit(t,(function(e){n[tupleid(e)]=1}));return function(e){return n[tupleid(e)]?null:e}}function addFilter(e,t){return e?function(n,r){return e(n,r)&&t(n,r)}:t}Pulse.prototype={StopPropagation:StopPropagation,ADD:ADD,REM:REM,MOD:MOD$1,ADD_REM:ADD_REM,ADD_MOD:ADD_MOD,ALL:ALL,REFLOW:REFLOW,SOURCE:SOURCE,NO_SOURCE:NO_SOURCE,NO_FIELDS:NO_FIELDS,fork:function(e){return new Pulse(this.dataflow).init(this,e)},clone:function(){var e=this.fork(ALL);e.add=e.add.slice();e.rem=e.rem.slice();e.mod=e.mod.slice();if(e.source)e.source=e.source.slice();return e.materialize(ALL|SOURCE)},addAll:function(){var e=this;var t=!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length;if(t){return e}else{e=new Pulse(this.dataflow).init(this);e.add=e.source;e.rem=[];return e}},init:function(e,t){var n=this;n.stamp=e.stamp;n.encode=e.encode;if(e.fields&&!(t&NO_FIELDS)){n.fields=e.fields}if(t&ADD){n.addF=e.addF;n.add=e.add}else{n.addF=null;n.add=[]}if(t&REM){n.remF=e.remF;n.rem=e.rem}else{n.remF=null;n.rem=[]}if(t&MOD$1){n.modF=e.modF;n.mod=e.mod}else{n.modF=null;n.mod=[]}if(t&NO_SOURCE){n.srcF=null;n.source=null}else{n.srcF=e.srcF;n.source=e.source;if(e.cleans)n.cleans=e.cleans}return n},runAfter:function(e){this.dataflow.runAfter(e)},changed:function(e){var t=e||ALL;return t&ADD&&this.add.length||t&REM&&this.rem.length||t&MOD$1&&this.mod.length},reflow:function(e){if(e)return this.fork(ALL).reflow();var t=this.add.length,n=this.source&&this.source.length;if(n&&n!==t){this.mod=this.source;if(t)this.filter(MOD$1,filter$1(this,ADD))}return this},clean:function(e){if(arguments.length){this.cleans=!!e;return this}else{return this.cleans}},modifies:function(e){var t=this.fields||(this.fields={});if(isArray(e)){e.forEach((function(e){return t[e]=true}))}else{t[e]=true}return this},modified:function(e,t){var n=this.fields;return!((t||this.mod.length)&&n)?false:!arguments.length?!!n:isArray(e)?e.some((function(e){return n[e]})):n[e]},filter:function(e,t){var n=this;if(e&ADD)n.addF=addFilter(n.addF,t);if(e&REM)n.remF=addFilter(n.remF,t);if(e&MOD$1)n.modF=addFilter(n.modF,t);if(e&SOURCE)n.srcF=addFilter(n.srcF,t);return n},materialize:function(e){e=e||ALL;var t=this;if(e&ADD&&t.addF){t.add=materialize(t.add,t.addF);t.addF=null}if(e&REM&&t.remF){t.rem=materialize(t.rem,t.remF);t.remF=null}if(e&MOD$1&&t.modF){t.mod=materialize(t.mod,t.modF);t.modF=null}if(e&SOURCE&&t.srcF){t.source=t.source.filter(t.srcF);t.srcF=null}return t},visit:function(e,t){var n=this,r=t;if(e&SOURCE){visitArray(n.source,n.srcF,r);return n}if(e&ADD)visitArray(n.add,n.addF,r);if(e&REM)visitArray(n.rem,n.remF,r);if(e&MOD$1)visitArray(n.mod,n.modF,r);var i=n.source;if(e&REFLOW&&i){var a=n.add.length+n.mod.length;if(a===i.length);else if(a){visitArray(i,filter$1(n,ADD_MOD),r)}else{visitArray(i,n.srcF,r)}}return n}};function MultiPulse(e,t,n,r){var i=this,a=n.length;var o=0;this.dataflow=e;this.stamp=t;this.fields=null;this.encode=r||null;this.pulses=n;for(var s=0;s<a;++s){var u=n[s];if(u.stamp!==t)continue;if(u.fields){var l=i.fields||(i.fields={});for(var f in u.fields){l[f]=1}}if(u.changed(i.ADD))o|=i.ADD;if(u.changed(i.REM))o|=i.REM;if(u.changed(i.MOD))o|=i.MOD}this.changes=o}inherits(MultiPulse,Pulse,{fork:function(e){var t=new Pulse(this.dataflow).init(this,e&this.NO_FIELDS);if(e!==undefined){if(e&t.ADD)this.visit(t.ADD,(function(e){return t.add.push(e)}));if(e&t.REM)this.visit(t.REM,(function(e){return t.rem.push(e)}));if(e&t.MOD)this.visit(t.MOD,(function(e){return t.mod.push(e)}))}return t},changed:function(e){return this.changes&e},modified:function(e){var t=this,n=t.fields;return!(n&&t.changes&t.MOD)?0:isArray(e)?e.some((function(e){return n[e]})):n[e]},filter:function(){error("MultiPulse does not support filtering.")},materialize:function(){error("MultiPulse does not support materialization.")},visit:function(e,t){var n=this,r=n.pulses,i=r.length;var a=0;if(e&n.SOURCE){for(;a<i;++a){r[a].visit(e,t)}}else{for(;a<i;++a){if(r[a].stamp===n.stamp){r[a].visit(e,t)}}}return n}});function evaluate(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,a,o,s,u,l,f,c,d;return __generator(this,(function(p){switch(p.label){case 0:r=this,i=[];if(r._pulse)return[2,reentrant(r)];if(!r._pending)return[3,2];return[4,r._pending];case 1:p.sent();p.label=2;case 2:if(!t)return[3,4];return[4,asyncCallback(r,t)];case 3:p.sent();p.label=4;case 4:if(!r._touched.length){r.debug("Dataflow invoked, but nothing to do.");return[2,r]}a=++r._clock;r._pulse=new Pulse(r,a,e);r._touched.forEach((function(e){return r._enqueue(e,true)}));r._touched=UniqueList(id);o=0;p.label=5;case 5:p.trys.push([5,11,,12]);p.label=6;case 6:if(!(r._heap.size()>0))return[3,10];s=r._heap.pop();if(s.rank!==s.qrank){r._enqueue(s,true);return[3,6]}u=s.run(r._getPulse(s,e));if(!u.then)return[3,8];return[4,u];case 7:u=p.sent();return[3,9];case 8:if(u.async){i.push(u.async);u=StopPropagation}p.label=9;case 9:if(u!==StopPropagation){if(s._targets)s._targets.forEach((function(e){return r._enqueue(e)}))}++o;return[3,6];case 10:return[3,12];case 11:f=p.sent();r._heap.clear();l=f;return[3,12];case 12:r._input={};r._pulse=null;r.debug("Pulse "+a+": "+o+" operators");if(l){r._postrun=[];r.error(l)}if(!r._postrun.length)return[3,16];c=r._postrun.sort((function(e,t){return t.priority-e.priority}));r._postrun=[];d=0;p.label=13;case 13:if(!(d<c.length))return[3,16];return[4,asyncCallback(r,c[d].callback)];case 14:p.sent();p.label=15;case 15:++d;return[3,13];case 16:if(!n)return[3,18];return[4,asyncCallback(r,n)];case 17:p.sent();p.label=18;case 18:if(i.length){Promise.all(i).then((function(e){return r.runAsync(null,(function(){e.forEach((function(e){try{e(r)}catch(t){r.error(t)}}))}))}))}return[2,r]}}))}))}function runAsync(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r;var i=this;return __generator(this,(function(a){switch(a.label){case 0:if(!this._running)return[3,2];return[4,this._running];case 1:a.sent();return[3,0];case 2:r=function(){return i._running=null};(this._running=this.evaluate(e,t,n)).then(r,r);return[2,this._running]}}))}))}function run(e,t,n){return this._pulse?reentrant(this):(this.evaluate(e,t,n),this)}function runAfter(e,t,n){if(this._pulse||t){this._postrun.push({priority:n||0,callback:e})}else{try{e(this)}catch(r){this.error(r)}}}function reentrant(e){e.error("Dataflow already running. Use runAsync() to chain invocations.");return e}function enqueue(e,t){var n=e.stamp<this._clock;if(n)e.stamp=this._clock;if(n||t){e.qrank=e.rank;this._heap.push(e)}}function getPulse(e,t){var n=e.source,r=this._clock;return n&&isArray(n)?new MultiPulse(this,r,n.map((function(e){return e.pulse})),t):this._input[e.id]||singlePulse(this._pulse,n&&n.pulse)}function singlePulse(e,t){if(t&&t.stamp===e.stamp){return t}e=e.fork();if(t&&t!==StopPropagation){e.source=t.source}return e}var NO_OPT={skip:false,force:false};function touch(e,t){var n=t||NO_OPT;if(this._pulse){this._enqueue(e)}else{this._touched.add(e)}if(n.skip)e.skip(true);return this}function update$6(e,t,n){var r=n||NO_OPT;if(e.set(t)||r.force){this.touch(e,r)}return this}function pulse(e,t,n){this.touch(e,n||NO_OPT);var r=new Pulse(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];r.target=e;this._input[e.id]=t.pulse(r,i);return this}function Heap(e){var t=[];return{clear:function(){return t=[]},size:function(){return t.length},peek:function(){return t[0]},push:function(n){t.push(n);return siftdown(t,0,t.length-1,e)},pop:function(){var n=t.pop();var r;if(t.length){r=t[0];t[0]=n;siftup(t,0,e)}else{r=n}return r}}}function siftdown(e,t,n,r){var i,a;var o=e[n];while(n>t){a=n-1>>1;i=e[a];if(r(o,i)<0){e[n]=i;n=a;continue}break}return e[n]=o}function siftup(e,t,n){var r=t,i=e.length,a=e[t];var o=(t<<1)+1,s;while(o<i){s=o+1;if(s<i&&n(e[o],e[s])>=0){o=s}e[t]=e[o];t=o;o=(t<<1)+1}e[t]=a;return siftdown(e,r,t,n)}function Dataflow(){this.logger(logger());this.logLevel(Error$1);this._clock=0;this._rank=0;this._locale=defaultLocale();try{this._loader=loader()}catch(e){}this._touched=UniqueList(id);this._input={};this._pulse=null;this._heap=Heap((function(e,t){return e.qrank-t.qrank}));this._postrun=[]}function logMethod(e){return function(){return this._log[e].apply(this,arguments)}}Dataflow.prototype={stamp:function(){return this._clock},loader:function(e){if(arguments.length){this._loader=e;return this}else{return this._loader}},locale:function(e){if(arguments.length){this._locale=e;return this}else{return this._locale}},logger:function(e){if(arguments.length){this._log=e;return this}else{return this._log}},error:logMethod("error"),warn:logMethod("warn"),info:logMethod("info"),debug:logMethod("debug"),logLevel:logMethod("level"),cleanThreshold:1e4,add:add$4,connect:connect,rank:rank,rerank:rerank,pulse:pulse,touch:touch,update:update$6,changeset:changeset,ingest:ingest,parse:parse$4,preload:preload,request:request,events:events$2,on:on,evaluate:evaluate,run:run,runAsync:runAsync,runAfter:runAfter,_enqueue:enqueue,_getPulse:getPulse};function Transform(e,t){Operator.call(this,e,null,t)}inherits(Transform,Operator,{run:function(e){var t=this;if(e.stamp<this.stamp)return e.StopPropagation;var n;if(this.skip()){this.skip(false)}else{n=this.evaluate(e)}n=n||e;if(n.then){n=n.then((function(e){return t.pulse=e}))}else if(n!==e.StopPropagation){this.pulse=n}return n},evaluate:function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);t.clear();return n},transform:function(){}});var transforms={};function definition$1(e){var t=transform$2(e);return t&&t.Definition||null}function transform$2(e){e=e&&e.toLowerCase();return has$1(transforms,e)?transforms[e]:null}function numbers$1(e,t){var n,r,i,a,o,s,u;return __generator(this,(function(l){switch(l.label){case 0:if(!(t==null))return[3,5];n=0,r=e;l.label=1;case 1:if(!(n<r.length))return[3,4];i=r[n];if(!(i!=null&&i!==""&&(i=+i)>=i))return[3,3];return[4,i];case 2:l.sent();l.label=3;case 3:n++;return[3,1];case 4:return[3,9];case 5:a=-1;o=0,s=e;l.label=6;case 6:if(!(o<s.length))return[3,9];u=s[o];u=t(u,++a,e);if(!(u!=null&&u!==""&&(u=+u)>=u))return[3,8];return[4,u];case 7:l.sent();l.label=8;case 8:o++;return[3,6];case 9:return[2]}}))}function quantiles(e,t,n){var r=Float64Array.from(numbers$1(e,n));r.sort(ascending$2);return t.map((function(e){return quantileSorted(r,e)}))}function quartiles(e,t){return quantiles(e,[.25,.5,.75],t)}function estimateBandwidth(e,t){var n=e.length,r=deviation(e,t),i=quartiles(e,t),a=(i[2]-i[0])/1.34,o=Math.min(r,a)||r||Math.abs(i[0])||1;return 1.06*o*Math.pow(n,-.2)}function bin$1(e){var t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];var a=e.extent[0],o=e.extent[1],s,u,l,f,c,d;var p=e.span||o-a||Math.abs(a)||1;if(e.step){s=e.step}else if(e.steps){f=p/t;for(c=0,d=e.steps.length;c<d&&e.steps[c]<f;++c);s=e.steps[Math.max(0,c-1)]}else{u=Math.ceil(Math.log(t)/r);l=e.minstep||0;s=Math.max(l,Math.pow(n,Math.round(Math.log(p)/r)-u));while(Math.ceil(p/s)>t){s*=n}for(c=0,d=i.length;c<d;++c){f=s/i[c];if(f>=l&&p/f<=t)s=f}}f=Math.log(s);var h=f>=0?0:~~(-f/r)+1,g=Math.pow(n,-h-1);if(e.nice||e.nice===undefined){f=Math.floor(a/s+g)*s;a=a<f?f-s:f;o=Math.ceil(o/s)*s}return{start:a,stop:o===a?a+s:o,step:s}}var random=Math.random;function setRandom(e){random=e}function bootstrapCI(e,t,n,r){if(!e.length)return[undefined,undefined];var i=Float64Array.from(numbers$1(e,r)),a=i.length,o=t;var s,u,l,f;for(l=0,f=Array(o);l<o;++l){for(s=0,u=0;u<a;++u){s+=i[~~(random()*a)]}f[l]=s/a}f.sort(ascending$2);return[quantile$1(f,n/2),quantile$1(f,1-n/2)]}function dotbin(e,t,n,r){r=r||function(e){return e};var i=e.length,a=new Float64Array(i);var o=0,s=1,u=r(e[0]),l=u,f=u+t,c;for(;s<i;++s){c=r(e[s]);if(c>=f){l=(u+l)/2;for(;o<s;++o)a[o]=l;f=c+t;u=c}l=c}l=(u+l)/2;for(;o<s;++o)a[o]=l;return n?smoothing(a,t+t/4):a}function smoothing(e,t){var n=e.length;var r=0,i=1,a,o;while(e[r]===e[i])++i;while(i<n){a=i+1;while(e[i]===e[a])++a;if(e[i]-e[i-1]<t){o=i+(r+a-i-i>>1);while(o<i)e[o++]=e[i];while(o>i)e[o--]=e[r]}r=i;i=a}return e}function lcg$1(e){return function(){e=(1103515245*e+12345)%2147483647;return e/2147483647}}function integer(e,t){if(t==null){t=e;e=0}var n,r,i;var a={min:function(e){if(arguments.length){n=e||0;i=r-n;return a}else{return n}},max:function(e){if(arguments.length){r=e||0;i=r-n;return a}else{return r}},sample:function(){return n+Math.floor(i*random())},pdf:function(e){return e===Math.floor(e)&&e>=n&&e<r?1/i:0},cdf:function(e){var t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:function(e){return e>=0&&e<=1?n-1+Math.floor(e*i):NaN}};return a.min(e).max(t)}var SQRT2PI=Math.sqrt(2*Math.PI);var SQRT2=Math.SQRT2;var nextSample=NaN;function sampleNormal(e,t){e=e||0;t=t==null?1:t;var n=0,r=0,i,a;if(nextSample===nextSample){n=nextSample;nextSample=NaN}else{do{n=random()*2-1;r=random()*2-1;i=n*n+r*r}while(i===0||i>1);a=Math.sqrt(-2*Math.log(i)/i);n*=a;nextSample=r*a}return e+n*t}function densityNormal(e,t,n){n=n==null?1:n;var r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*SQRT2PI)}function cumulativeNormal(e,t,n){t=t||0;n=n==null?1:n;var r=(e-t)/n,i=Math.abs(r);var a;if(i>37){a=0}else{var o=Math.exp(-i*i/2);var s;if(i<7.07106781186547){s=.0352624965998911*i+.700383064443688;s=s*i+6.37396220353165;s=s*i+33.912866078383;s=s*i+112.079291497871;s=s*i+221.213596169931;s=s*i+220.206867912376;a=o*s;s=.0883883476483184*i+1.75566716318264;s=s*i+16.064177579207;s=s*i+86.7807322029461;s=s*i+296.564248779674;s=s*i+637.333633378831;s=s*i+793.826512519948;s=s*i+440.413735824752;a=a/s}else{s=i+.65;s=i+4/s;s=i+3/s;s=i+2/s;s=i+1/s;a=o/s/2.506628274631}}return r>0?1-a:a}function quantileNormal(e,t,n){if(e<0||e>1)return NaN;return(t||0)+(n==null?1:n)*SQRT2*erfinv(2*e-1)}function erfinv(e){var t=-Math.log((1-e)*(1+e)),n;if(t<6.25){t-=3.125;n=-364441206401782e-35;n=-16850591381820166e-35+n*t;n=128584807152564e-32+n*t;n=11157877678025181e-33+n*t;n=-1333171662854621e-31+n*t;n=20972767875968562e-33+n*t;n=6637638134358324e-30+n*t;n=-4054566272975207e-29+n*t;n=-8151934197605472e-29+n*t;n=26335093153082323e-28+n*t;n=-12975133253453532e-27+n*t;n=-5415412054294628e-26+n*t;n=1.0512122733215323e-9+n*t;n=-4.112633980346984e-9+n*t;n=-2.9070369957882005e-8+n*t;n=4.2347877827932404e-7+n*t;n=-13654692000834679e-22+n*t;n=-13882523362786469e-21+n*t;n=.00018673420803405714+n*t;n=-.000740702534166267+n*t;n=-.006033670871430149+n*t;n=.24015818242558962+n*t;n=1.6536545626831027+n*t}else if(t<16){t=Math.sqrt(t)-3.25;n=2.2137376921775787e-9;n=9.075656193888539e-8+n*t;n=-2.7517406297064545e-7+n*t;n=1.8239629214389228e-8+n*t;n=15027403968909828e-22+n*t;n=-4013867526981546e-21+n*t;n=29234449089955446e-22+n*t;n=12475304481671779e-21+n*t;n=-47318229009055734e-21+n*t;n=6828485145957318e-20+n*t;n=24031110387097894e-21+n*t;n=-.0003550375203628475+n*t;n=.0009532893797373805+n*t;n=-.0016882755560235047+n*t;n=.002491442096107851+n*t;n=-.003751208507569241+n*t;n=.005370914553590064+n*t;n=1.0052589676941592+n*t;n=3.0838856104922208+n*t}else if(Number.isFinite(t)){t=Math.sqrt(t)-5;n=-27109920616438573e-27;n=-2.555641816996525e-10+n*t;n=1.5076572693500548e-9+n*t;n=-3.789465440126737e-9+n*t;n=7.61570120807834e-9+n*t;n=-1.496002662714924e-8+n*t;n=2.914795345090108e-8+n*t;n=-6.771199775845234e-8+n*t;n=2.2900482228026655e-7+n*t;n=-9.9298272942317e-7+n*t;n=4526062597223154e-21+n*t;n=-1968177810553167e-20+n*t;n=7599527703001776e-20+n*t;n=-.00021503011930044477+n*t;n=-.00013871931833623122+n*t;n=1.0103004648645344+n*t;n=4.849906401408584+n*t}else{n=Infinity}return n*e}function gaussian(e,t){var n,r;var i={mean:function(e){if(arguments.length){n=e||0;return i}else{return n}},stdev:function(e){if(arguments.length){r=e==null?1:e;return i}else{return r}},sample:function(){return sampleNormal(n,r)},pdf:function(e){return densityNormal(e,n,r)},cdf:function(e){return cumulativeNormal(e,n,r)},icdf:function(e){return quantileNormal(e,n,r)}};return i.mean(e).stdev(t)}function kde(e,t){var n=gaussian();var r=0;var i={data:function(n){if(arguments.length){e=n;r=n?n.length:0;return i.bandwidth(t)}else{return e}},bandwidth:function(n){if(!arguments.length)return t;t=n;if(!t&&e)t=estimateBandwidth(e);return i},sample:function(){return e[~~(random()*r)]+t*n.sample()},pdf:function(i){var a=0,o=0;for(;o<r;++o){a+=n.pdf((i-e[o])/t)}return a/t/r},cdf:function(i){var a=0,o=0;for(;o<r;++o){a+=n.cdf((i-e[o])/t)}return a/r},icdf:function(){throw Error("KDE icdf not supported.")}};return i.data(e)}function sampleLogNormal(e,t){e=e||0;t=t==null?1:t;return Math.exp(e+sampleNormal()*t)}function densityLogNormal(e,t,n){if(e<=0)return 0;t=t||0;n=n==null?1:n;var r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*SQRT2PI*e)}function cumulativeLogNormal(e,t,n){return cumulativeNormal(Math.log(e),t,n)}function quantileLogNormal(e,t,n){return Math.exp(quantileNormal(e,t,n))}function lognormal(e,t){var n,r;var i={mean:function(e){if(arguments.length){n=e||0;return i}else{return n}},stdev:function(e){if(arguments.length){r=e==null?1:e;return i}else{return r}},sample:function(){return sampleLogNormal(n,r)},pdf:function(e){return densityLogNormal(e,n,r)},cdf:function(e){return cumulativeLogNormal(e,n,r)},icdf:function(e){return quantileLogNormal(e,n,r)}};return i.mean(e).stdev(t)}function mixture$1(e,t){var n=0,r;function i(e){var t=[];var r=0,i;for(i=0;i<n;++i){r+=t[i]=e[i]==null?1:+e[i]}for(i=0;i<n;++i){t[i]/=r}return t}var a={weights:function(e){if(arguments.length){r=i(t=e||[]);return a}return t},distributions:function(r){if(arguments.length){if(r){n=r.length;e=r}else{n=0;e=[]}return a.weights(t)}return e},sample:function(){var t=random();var i=e[n-1],a=r[0],o=0;for(;o<n-1;a+=r[++o]){if(t<a){i=e[o];break}}return i.sample()},pdf:function(t){var i=0,a=0;for(;a<n;++a){i+=r[a]*e[a].pdf(t)}return i},cdf:function(t){var i=0,a=0;for(;a<n;++a){i+=r[a]*e[a].cdf(t)}return i},icdf:function(){throw Error("Mixture icdf not supported.")}};return a.distributions(e).weights(t)}function sampleUniform(e,t){if(t==null){t=e==null?1:e;e=0}return e+(t-e)*random()}function densityUniform(e,t,n){if(n==null){n=t==null?1:t;t=0}return e>=t&&e<=n?1/(n-t):0}function cumulativeUniform(e,t,n){if(n==null){n=t==null?1:t;t=0}return e<t?0:e>n?1:(e-t)/(n-t)}function quantileUniform(e,t,n){if(n==null){n=t==null?1:t;t=0}return e>=0&&e<=1?t+e*(n-t):NaN}function uniform(e,t){var n,r;var i={min:function(e){if(arguments.length){n=e||0;return i}else{return n}},max:function(e){if(arguments.length){r=e==null?1:e;return i}else{return r}},sample:function(){return sampleUniform(n,r)},pdf:function(e){return densityUniform(e,n,r)},cdf:function(e){return cumulativeUniform(e,n,r)},icdf:function(e){return quantileUniform(e,n,r)}};if(t==null){t=e==null?1:e;e=0}return i.min(e).max(t)}function ols(e,t,n,r){var i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i,o=t-a*e;return[o,a]}function points(e,t,n,r){e=e.filter((function(e){var r=t(e),i=n(e);return r!=null&&(r=+r)>=r&&i!=null&&(i=+i)>=i}));if(r){e.sort((function(e,n){return t(e)-t(n)}))}var i=e.length,a=new Float64Array(i),o=new Float64Array(i);var s=0,u=0,l=0,f,c,d;for(var p=0,h=e;p<h.length;p++){d=h[p];a[s]=f=+t(d);o[s]=c=+n(d);++s;u+=(f-u)/s;l+=(c-l)/s}for(s=0;s<i;++s){a[s]-=u;o[s]-=l}return[a,o,u,l]}function visitPoints(e,t,n,r){var i=-1,a,o;for(var s=0,u=e;s<u.length;s++){var l=u[s];a=t(l);o=n(l);if(a!=null&&(a=+a)>=a&&o!=null&&(o=+o)>=o){r(a,o,++i)}}}function rSquared(e,t,n,r,i){var a=0,o=0;visitPoints(e,t,n,(function(e,t){var n=t-i(e),s=t-r;a+=n*n;o+=s*s}));return 1-a/o}function linear$2(e,t,n){var r=0,i=0,a=0,o=0,s=0;visitPoints(e,t,n,(function(e,t){++s;r+=(e-r)/s;i+=(t-i)/s;a+=(e*t-a)/s;o+=(e*e-o)/s}));var u=ols(r,i,a,o),l=function(e){return u[0]+u[1]*e};return{coef:u,predict:l,rSquared:rSquared(e,t,n,i,l)}}function log$3(e,t,n){var r=0,i=0,a=0,o=0,s=0;visitPoints(e,t,n,(function(e,t){++s;e=Math.log(e);r+=(e-r)/s;i+=(t-i)/s;a+=(e*t-a)/s;o+=(e*e-o)/s}));var u=ols(r,i,a,o),l=function(e){return u[0]+u[1]*Math.log(e)};return{coef:u,predict:l,rSquared:rSquared(e,t,n,i,l)}}function exp$1(e,t,n){var r=points(e,t,n),i=r[0],a=r[1],o=r[2],s=r[3];var u=0,l=0,f=0,c=0,d=0,p,h,g;visitPoints(e,t,n,(function(e,t){p=i[d++];h=Math.log(t);g=p*t;u+=(t*h-u)/d;l+=(g-l)/d;f+=(g*h-f)/d;c+=(p*g-c)/d}));var m=ols(l/s,u/s,f/s,c/s),v=m[0],y=m[1],_=function(e){return Math.exp(v+y*(e-o))};return{coef:[Math.exp(v-y*o),y],predict:_,rSquared:rSquared(e,t,n,s,_)}}function pow$3(e,t,n){var r=0,i=0,a=0,o=0,s=0,u=0;visitPoints(e,t,n,(function(e,t){var n=Math.log(e),l=Math.log(t);++u;r+=(n-r)/u;i+=(l-i)/u;a+=(n*l-a)/u;o+=(n*n-o)/u;s+=(t-s)/u}));var l=ols(r,i,a,o),f=function(e){return l[0]*Math.pow(e,l[1])};l[0]=Math.exp(l[0]);return{coef:l,predict:f,rSquared:rSquared(e,t,n,s,f)}}function quad(e,t,n){var r=points(e,t,n),i=r[0],a=r[1],o=r[2],s=r[3],u=i.length;var l=0,f=0,c=0,d=0,p=0,h,g,m,v;for(h=0;h<u;){g=i[h];m=a[h++];v=g*g;l+=(v-l)/h;f+=(v*g-f)/h;c+=(v*v-c)/h;d+=(g*m-d)/h;p+=(v*m-p)/h}var y=c-l*l,_=l*y-f*f,b=(p*l-d*f)/_,x=(d*y-p*f)/_,E=-b*l,S=function(e){e=e-o;return b*e*e+x*e+E+s};return{coef:[E-x*o+b*o*o+s,x-2*b*o,b],predict:S,rSquared:rSquared(e,t,n,s,S)}}function poly(e,t,n,r){if(r===1)return linear$2(e,t,n);if(r===2)return quad(e,t,n);var i=points(e,t,n),a=i[0],o=i[1],s=i[2],u=i[3],l=a.length,f=[],c=[],d=r+1;var p,h,g,m,v;for(p=0;p<d;++p){for(g=0,m=0;g<l;++g){m+=Math.pow(a[g],p)*o[g]}f.push(m);v=new Float64Array(d);for(h=0;h<d;++h){for(g=0,m=0;g<l;++g){m+=Math.pow(a[g],p+h)}v[h]=m}c.push(v)}c.push(f);var y=gaussianElimination(c),_=function(e){e-=s;var t=u+y[0]+y[1]*e+y[2]*e*e;for(p=3;p<d;++p)t+=y[p]*Math.pow(e,p);return t};return{coef:uncenter(d,y,-s,u),predict:_,rSquared:rSquared(e,t,n,u,_)}}function uncenter(e,t,n,r){var i=Array(e);var a,o,s,u;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a){s=t[a];u=1;i[a]+=s;for(o=1;o<=a;++o){u*=(a+1-o)/o;i[a-o]+=s*Math.pow(n,o)*u}}i[0]+=r;return i}function gaussianElimination(e){var t=e.length-1,n=[];var r,i,a,o,s;for(r=0;r<t;++r){o=r;for(i=r+1;i<t;++i){if(Math.abs(e[r][i])>Math.abs(e[r][o])){o=i}}for(a=r;a<t+1;++a){s=e[a][r];e[a][r]=e[a][o];e[a][o]=s}for(i=r+1;i<t;++i){for(a=t;a>=r;a--){e[a][i]-=e[a][r]*e[r][i]/e[r][r]}}}for(i=t-1;i>=0;--i){s=0;for(a=i+1;a<t;++a){s+=e[a][i]*n[a]}n[i]=(e[t][i]-s)/e[i][i]}return n}var maxiters=2,epsilon$5=1e-12;function loess(e,t,n,r){var i=points(e,t,n,true),a=i[0],o=i[1],s=i[2],u=i[3],l=a.length,f=Math.max(2,~~(r*l)),c=new Float64Array(l),d=new Float64Array(l),p=new Float64Array(l).fill(1);for(var h=-1;++h<=maxiters;){var g=[0,f-1];for(var m=0;m<l;++m){var v=a[m],y=g[0],_=g[1],b=v-a[y]>a[_]-v?y:_;var x=0,E=0,S=0,$=0,A=0;var D=1/Math.abs(a[b]-v||1);for(var w=y;w<=_;++w){var C=a[w],T=o[w],k=tricube(Math.abs(v-C)*D)*p[w],O=C*k;x+=k;E+=O;S+=T*k;$+=T*O;A+=C*O}var N=ols(E/x,S/x,$/x,A/x),R=N[0],F=N[1];c[m]=R+F*v;d[m]=Math.abs(o[m]-c[m]);updateInterval(a,m+1,g)}if(h===maxiters){break}var L=median(d);if(Math.abs(L)<epsilon$5)break;for(var m=0,P=void 0,I;m<l;++m){P=d[m]/(6*L);p[m]=P>=1?epsilon$5:(I=1-P*P)*I}}return output$1(a,c,s,u)}function tricube(e){return(e=1-e*e*e)*e*e}function updateInterval(e,t,n){var r=e[t];var i=n[0],a=n[1]+1;if(a>=e.length)return;while(t>i&&e[a]-r<=r-e[i]){n[0]=++i;n[1]=a;++a}}function output$1(e,t,n,r){var i=e.length,a=[];var o=0,s=0,u=[],l;for(;o<i;++o){l=e[o]+n;if(u[0]===l){u[1]+=(t[o]-u[1])/++s}else{s=0;u[1]+=r;u=[l,t[o]];a.push(u)}}u[1]+=r;return a}var MIN_RADIANS=.1*Math.PI/180;function sampleCurve(e,t,n,r){n=n||25;r=Math.max(n,r||200);var i=function(t){return[t,e(t)]},a=t[0],o=t[1],s=o-a,u=s/r,l=[i(a)],f=[];if(n===r){for(var c=1;c<r;++c){l.push(i(a+c/n*s))}l.push(i(o));return l}else{f.push(i(o));for(var c=n;--c>0;){f.push(i(a+c/n*s))}}var d=l[0],p=f[f.length-1];while(p){var h=i((d[0]+p[0])/2);if(h[0]-d[0]>=u&&angleDelta(d,h,p)>MIN_RADIANS){f.push(h)}else{d=p;l.push(p);f.pop()}p=f[f.length-1]}return l}function angleDelta(e,t,n){var r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}function multikey(e){return function(t){var n=e.length;var r=1,i=String(e[0](t));for(;r<n;++r){i+="|"+e[r](t)}return i}}function groupkey(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:multikey(e)}function measureName(e,t,n){return n||e+(!t?"":"_"+t)}var noop$4=function(){};var base_op={init:noop$4,add:noop$4,rem:noop$4,idx:0};var AggregateOps={values:{init:function(e){return e.cell.store=true},value:function(e){return e.cell.data.values()},idx:-1},count:{value:function(e){return e.cell.num}},__count__:{value:function(e){return e.missing+e.valid}},missing:{value:function(e){return e.missing}},valid:{value:function(e){return e.valid}},sum:{init:function(e){return e.sum=0},value:function(e){return e.sum},add:function(e,t){return e.sum+=+t},rem:function(e,t){return e.sum-=t}},product:{init:function(e){return e.product=1},value:function(e){return e.valid?e.product:undefined},add:function(e,t){return e.product*=t},rem:function(e,t){return e.product/=t}},mean:{init:function(e){return e.mean=0},value:function(e){return e.valid?e.mean:undefined},add:function(e,t){return e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid},rem:function(e,t){return e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean}},average:{value:function(e){return e.valid?e.mean:undefined},req:["mean"],idx:1},variance:{init:function(e){return e.dev=0},value:function(e){return e.valid>1?e.dev/(e.valid-1):undefined},add:function(e,t){return e.dev+=e.mean_d*(t-e.mean)},rem:function(e,t){return e.dev-=e.mean_d*(t-e.mean)},req:["mean"],idx:1},variancep:{value:function(e){return e.valid>1?e.dev/e.valid:undefined},req:["variance"],idx:2},stdev:{value:function(e){return e.valid>1?Math.sqrt(e.dev/(e.valid-1)):undefined},req:["variance"],idx:2},stdevp:{value:function(e){return e.valid>1?Math.sqrt(e.dev/e.valid):undefined},req:["variance"],idx:2},stderr:{value:function(e){return e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):undefined},req:["variance"],idx:2},distinct:{value:function(e){return e.cell.data.distinct(e.get)},req:["values"],idx:3},ci0:{value:function(e){return e.cell.data.ci0(e.get)},req:["values"],idx:3},ci1:{value:function(e){return e.cell.data.ci1(e.get)},req:["values"],idx:3},median:{value:function(e){return e.cell.data.q2(e.get)},req:["values"],idx:3},q1:{value:function(e){return e.cell.data.q1(e.get)},req:["values"],idx:3},q3:{value:function(e){return e.cell.data.q3(e.get)},req:["values"],idx:3},min:{init:function(e){return e.min=undefined},value:function(e){return e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min},add:function(e,t){if(t<e.min||e.min===undefined)e.min=t},rem:function(e,t){if(t<=e.min)e.min=NaN},req:["values"],idx:4},max:{init:function(e){return e.max=undefined},value:function(e){return e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max},add:function(e,t){if(t>e.max||e.max===undefined)e.max=t},rem:function(e,t){if(t>=e.max)e.max=NaN},req:["values"],idx:4},argmin:{init:function(e){return e.argmin=undefined},value:function(e){return e.argmin||e.cell.data.argmin(e.get)},add:function(e,t,n){if(t<e.min)e.argmin=n},rem:function(e,t){if(t<=e.min)e.argmin=undefined},req:["min","values"],idx:3},argmax:{init:function(e){return e.argmax=undefined},value:function(e){return e.argmax||e.cell.data.argmax(e.get)},add:function(e,t,n){if(t>e.max)e.argmax=n},rem:function(e,t){if(t>=e.max)e.argmax=undefined},req:["max","values"],idx:3}};var ValidAggregateOps=Object.keys(AggregateOps);function measure(e,t){return function(n){return extend$1({name:e,out:n||e},base_op,t)}}ValidAggregateOps.forEach((function(e){AggregateOps[e]=measure(e,AggregateOps[e])}));function createMeasure(e,t){return AggregateOps[e](t)}function compareIndex(e,t){return e.idx-t.idx}function resolve(e){var t={};e.forEach((function(e){return t[e.name]=e}));var n=function(e){if(!e.req)return;e.req.forEach((function(e){if(!t[e])n(t[e]=AggregateOps[e]())}))};e.forEach(n);return Object.values(t).sort(compareIndex)}function init(){var e=this;this.valid=0;this.missing=0;this._ops.forEach((function(t){return t.init(e)}))}function add$3(e,t){var n=this;if(e==null||e===""){++this.missing;return}if(e!==e)return;++this.valid;this._ops.forEach((function(r){return r.add(n,e,t)}))}function rem(e,t){var n=this;if(e==null||e===""){--this.missing;return}if(e!==e)return;--this.valid;this._ops.forEach((function(r){return r.rem(n,e,t)}))}function set$4(e){var t=this;this._out.forEach((function(n){return e[n.out]=n.value(t)}));return e}function compileMeasures(e,t){var n=t||identity$6,r=resolve(e),i=e.slice().sort(compareIndex);function a(e){this._ops=r;this._out=i;this.cell=e;this.init()}a.prototype.init=init;a.prototype.add=add$3;a.prototype.rem=rem;a.prototype.set=set$4;a.prototype.get=n;a.fields=e.map((function(e){return e.out}));return a}function TupleStore(e){this._key=e?field$1(e):tupleid;this.reset()}var prototype$1=TupleStore.prototype;prototype$1.reset=function(){this._add=[];this._rem=[];this._ext=null;this._get=null;this._q=null};prototype$1.add=function(e){this._add.push(e)};prototype$1.rem=function(e){this._rem.push(e)};prototype$1.values=function(){this._get=null;if(this._rem.length===0)return this._add;var e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};var s,u,l;for(s=0;s<i;++s){o[n(t[s])]=1}for(s=0,u=0;s<r;++s){if(o[n(l=e[s])]){o[n(l)]=0}else{a[u++]=l}}this._rem=[];return this._add=a};prototype$1.distinct=function(e){var t=this.values(),n={};var r=t.length,i=0,a;while(--r>=0){a=e(t[r])+"";if(!has$1(n,a)){n[a]=1;++i}}return i};prototype$1.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=extentIndex(t,e);this._ext=[t[n[0]],t[n[1]]];this._get=e}return this._ext};prototype$1.argmin=function(e){return this.extent(e)[0]||{}};prototype$1.argmax=function(e){return this.extent(e)[1]||{}};prototype$1.min=function(e){var t=this.extent(e)[0];return t!=null?e(t):undefined};prototype$1.max=function(e){var t=this.extent(e)[1];return t!=null?e(t):undefined};prototype$1.quartile=function(e){if(this._get!==e||!this._q){this._q=quartiles(this.values(),e);this._get=e}return this._q};prototype$1.q1=function(e){return this.quartile(e)[0]};prototype$1.q2=function(e){return this.quartile(e)[1]};prototype$1.q3=function(e){return this.quartile(e)[2]};prototype$1.ci=function(e){if(this._get!==e||!this._ci){this._ci=bootstrapCI(this.values(),1e3,.05,e);this._get=e}return this._ci};prototype$1.ci0=function(e){return this.ci(e)[0]};prototype$1.ci1=function(e){return this.ci(e)[1]};function Aggregate$1(e){Transform.call(this,null,e);this._adds=[];this._mods=[];this._alen=0;this._mlen=0;this._drop=true;this._cross=false;this._dims=[];this._dnames=[];this._measures=[];this._countOnly=false;this._counts=null;this._prev=null;this._inputs=null;this._outputs=null}Aggregate$1.Definition={type:"Aggregate",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:ValidAggregateOps},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"drop",type:"boolean",default:true},{name:"cross",type:"boolean",default:false},{name:"key",type:"field"}]};inherits(Aggregate$1,Transform,{transform:function(e,t){var n=this;var r=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=e.modified();r.stamp=i.stamp;if(r.value&&(a||t.modified(r._inputs,true))){r._prev=r.value;r.value=a?r.init(e):{};t.visit(t.SOURCE,(function(e){return r.add(e)}))}else{r.value=r.value||r.init(e);t.visit(t.REM,(function(e){return r.rem(e)}));t.visit(t.ADD,(function(e){return r.add(e)}))}i.modifies(r._outputs);r._drop=e.drop!==false;if(e.cross&&r._dims.length>1){r._drop=false;r.cross()}if(t.clean()&&r._drop){i.clean(true).runAfter((function(){return n.clean()}))}return r.changes(i)},cross:function(){var e=this,t=e.value,n=e._dnames,r=n.map((function(){return{}})),i=n.length;function a(e){var t,a,o,s;for(t in e){o=e[t].tuple;for(a=0;a<i;++a){r[a][s=o[n[a]]]=s}}}a(e._prev);a(t);function o(a,s,u){var l=n[u],f=r[u++];for(var c in f){var d=a?a+"|"+c:c;s[l]=f[c];if(u<i)o(d,s,u);else if(!t[d])e.cell(d,s)}}o("",{},0)},init:function(e){var t=this._inputs=[],n=this._outputs=[],r={};function i(e){var n=array$5(accessorFields(e)),i=n.length;var a=0,o;for(;a<i;++a){if(!r[o=n[a]]){r[o]=1;t.push(o)}}}this._dims=array$5(e.groupby);this._dnames=this._dims.map((function(e){var t=accessorName(e);i(e);n.push(t);return t}));this.cellkey=e.key?e.key:groupkey(this._dims);this._countOnly=true;this._counts=[];this._measures=[];var a=e.fields||[null],o=e.ops||["count"],s=e.as||[],u=a.length,l={};var f,c,d,p,h,g;if(u!==o.length){error("Unmatched number of fields and aggregate ops.")}for(g=0;g<u;++g){f=a[g];c=o[g];if(f==null&&c!=="count"){error("Null aggregate field specified.")}p=accessorName(f);h=measureName(c,p,s[g]);n.push(h);if(c==="count"){this._counts.push(h);continue}d=l[p];if(!d){i(f);d=l[p]=[];d.field=f;this._measures.push(d)}if(c!=="count")this._countOnly=false;d.push(createMeasure(c,h))}this._measures=this._measures.map((function(e){return compileMeasures(e,e.field)}));return{}},cellkey:groupkey(),cell:function(e,t){var n=this.value[e];if(!n){n=this.value[e]=this.newcell(e,t);this._adds[this._alen++]=n}else if(n.num===0&&this._drop&&n.stamp<this.stamp){n.stamp=this.stamp;this._adds[this._alen++]=n}else if(n.stamp<this.stamp){n.stamp=this.stamp;this._mods[this._mlen++]=n}return n},newcell:function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:false};if(!this._countOnly){var r=this._measures,i=r.length;n.agg=Array(i);for(var a=0;a<i;++a){n.agg[a]=new r[a](n)}}if(n.store){n.data=new TupleStore}return n},newtuple:function(e,t){var n=this._dnames,r=this._dims,i=r.length,a={};for(var o=0;o<i;++o){a[n[o]]=r[o](e)}return t?replace$1(t.tuple,a):ingest$1(a)},clean:function(){var e=this.value;for(var t in e){if(e[t].num===0){delete e[t]}}},add:function(e){var t=this.cellkey(e),n=this.cell(t,e);n.num+=1;if(this._countOnly)return;if(n.store)n.data.add(e);var r=n.agg;for(var i=0,a=r.length;i<a;++i){r[i].add(r[i].get(e),e)}},rem:function(e){var t=this.cellkey(e),n=this.cell(t,e);n.num-=1;if(this._countOnly)return;if(n.store)n.data.rem(e);var r=n.agg;for(var i=0,a=r.length;i<a;++i){r[i].rem(r[i].get(e),e)}},celltuple:function(e){var t=e.tuple,n=this._counts;if(e.store){e.data.values()}for(var r=0,i=n.length;r<i;++r){t[n[r]]=e.num}if(!this._countOnly){var a=e.agg;for(var r=0,i=a.length;r<i;++r){a[r].set(t)}}return t},changes:function(e){var t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;var u,l,f,c;if(r)for(l in r){u=r[l];if(!i||u.num)o.push(u.tuple)}for(f=0,c=this._alen;f<c;++f){a.push(this.celltuple(t[f]));t[f]=null}for(f=0,c=this._mlen;f<c;++f){u=n[f];(u.num===0&&i?o:s).push(this.celltuple(u));n[f]=null}this._alen=this._mlen=0;this._prev=null;return e}});var EPSILON$1=1e-14;function Bin(e){Transform.call(this,null,e)}Bin.Definition={type:"Bin",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"interval",type:"boolean",default:true},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:true,default:[5,2]},{name:"extent",type:"number",array:true,length:2,required:true},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:true},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:true},{name:"name",type:"string"},{name:"as",type:"string",array:true,length:2,default:["bin0","bin1"]}]};inherits(Bin,Transform,{transform:function(e,t){var n=e.interval!==false,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],u=o[1];var l;if(e.modified()){t=t.reflow(true);l=t.SOURCE}else{l=t.modified(accessorFields(e.field))?t.ADD_MOD:t.ADD}t.visit(l,n?function(e){var t=r(e);e[s]=t;e[u]=t==null?null:i+a*(1+(t-i)/a)}:function(e){return e[s]=r(e)});return t.modifies(n?o:s)},_bins:function(e){if(this.value&&!e.modified()){return this.value}var t=e.field,n=bin$1(e),r=n.step;var i=n.start,a=i+Math.ceil((n.stop-i)/r)*r,o,s;if((o=e.anchor)!=null){s=o-(i+r*Math.floor((o-i)/r));i+=s;a+=s}var u=function(e){var n=toNumber(t(e));return n==null?null:n<i?-Infinity:n>a?+Infinity:(n=Math.max(i,Math.min(n,a-r)),i+r*Math.floor(EPSILON$1+(n-i)/r))};u.start=i;u.stop=n.stop;u.step=r;return this.value=accessor(u,accessorFields(t),e.name||"bin_"+accessorName(t))}});function SortedList(e,t,n){var r=e;var i=t||[],a=n||[],o={},s=0;return{add:function(e){return a.push(e)},remove:function(e){return o[r(e)]=++s},size:function(){return i.length},data:function(e,t){if(s){i=i.filter((function(e){return!o[r(e)]}));o={};s=0}if(t&&e){i.sort(e)}if(a.length){i=e?merge$3(e,i,a.sort(e)):i.concat(a);a=[]}return i}}}function Collect$1(e){Transform.call(this,[],e)}Collect$1.Definition={type:"Collect",metadata:{source:true},params:[{name:"sort",type:"compare"}]};inherits(Collect$1,Transform,{transform:function(e,t){var n=t.fork(t.ALL),r=SortedList(tupleid,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));n.visit(n.REM,r.remove);this.modified(a);this.value=n.source=r.data(stableCompare(i),a);if(t.source&&t.source.root){this.value.root=t.source.root}return n}});function Compare$1(e){Operator.call(this,null,update$5,e)}inherits(Compare$1,Operator);function update$5(e){return this.value&&!e.modified()?this.value:compare$1(e.fields,e.orders)}function CountPattern(e){Transform.call(this,null,e)}CountPattern.Definition={type:"CountPattern",metadata:{generates:true,changes:true},params:[{name:"field",type:"field",required:true},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:true,length:2,default:["text","count"]}]};function tokenize(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}inherits(CountPattern,Transform,{transform:function(e,t){var n=function(t){return function(n){var r=tokenize(s(n),e.case,a)||[],i;for(var u=0,l=r.length;u<l;++u){if(!o.test(i=r[u]))t(i)}}};var r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,u=e.as||["text","count"],l=n((function(e){return i[e]=1+(i[e]||0)})),f=n((function(e){return i[e]-=1}));if(r){t.visit(t.SOURCE,l)}else{t.visit(t.ADD,l);t.visit(t.REM,f)}return this._finish(t,u)},_parameterCheck:function(e,t){var n=false;if(e.modified("stopwords")||!this._stop){this._stop=new RegExp("^"+(e.stopwords||"")+"$","i");n=true}if(e.modified("pattern")||!this._match){this._match=new RegExp(e.pattern||"[\\w']+","g");n=true}if(e.modified("field")||t.modified(e.field.fields)){n=true}if(n)this._counts={};return n},_finish:function(e,t){var n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);var s,u,l;for(s in n){u=r[s];l=n[s]||0;if(!u&&l){r[s]=u=ingest$1({});u[i]=s;u[a]=l;o.add.push(u)}else if(l===0){if(u)o.rem.push(u);n[s]=null;r[s]=null}else if(u[a]!==l){u[a]=l;o.mod.push(u)}}return o.modifies(t)}});function Cross(e){Transform.call(this,null,e)}Cross.Definition={type:"Cross",metadata:{generates:true},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:true,length:2,default:["a","b"]}]};inherits(Cross,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");var s=this.value;if(o){if(s)n.rem=s;s=t.materialize(t.SOURCE).source;n.add=this.value=cross(s,i,a,e.filter||truthy)}else{n.mod=s}n.source=this.value;return n.modifies(r)}});function cross(e,t,n,r){var i=[],a={},o=e.length,s=0,u,l;for(;s<o;++s){a[t]=l=e[s];for(u=0;u<o;++u){a[n]=e[u];if(r(a)){i.push(ingest$1(a));a={};a[t]=l}}}return i}var Distributions={kde:kde,mixture:mixture$1,normal:gaussian,lognormal:lognormal,uniform:uniform};var DISTRIBUTIONS="distributions",FUNCTION="function",FIELD="field";function parse$3(e,t){var n=e[FUNCTION];if(!has$1(Distributions,n)){error("Unknown distribution function: "+n)}var r=Distributions[n]();for(var i in e){if(i===FIELD){r.data((e.from||t()).map(e[i]))}else if(i===DISTRIBUTIONS){r[i](e[i].map((function(e){return parse$3(e,t)})))}else if(typeof r[i]===FUNCTION){r[i](e[i])}}return r}function Density(e){Transform.call(this,null,e)}var distributions=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:true},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];var mixture={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:true,params:distributions},{name:"weights",type:"number",array:true}]};Density.Definition={type:"Density",metadata:{generates:true},params:[{name:"extent",type:"number",array:true,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:distributions.concat(mixture)},{name:"as",type:"string",array:true,default:["value","density"]}]};inherits(Density,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=parse$3(e.distribution,source$1(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;var o=e.method||"pdf";if(o!=="pdf"&&o!=="cdf"){error("Invalid density method: "+o)}if(!e.extent&&!r.data){error("Missing density extent parameter.")}o=r[o];var s=e.as||["value","density"],u=e.extent||extent(r.data()),l=sampleCurve(o,u,i,a).map((function(e){var t={};t[s[0]]=e[0];t[s[1]]=e[1];return ingest$1(t)}));if(this.value)n.rem=this.value;this.value=n.add=n.source=l}return n}});function source$1(e){return function(){return e.materialize(e.SOURCE).source}}function fieldNames(e,t){if(!e)return null;return e.map((function(e,n){return t[n]||accessorName(e)}))}function partition$1$1(e,t,n){var r=[],i=function(e){return e(u)};var a,o,s,u,l,f;if(t==null){r.push(e.map(n))}else{for(a={},o=0,s=e.length;o<s;++o){u=e[o];l=t.map(i);f=a[l];if(!f){a[l]=f=[];f.dims=l;r.push(f)}f.push(n(u))}}return r}var Output$4="bin";function DotBin(e){Transform.call(this,null,e)}DotBin.Definition={type:"DotBin",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:false},{name:"as",type:"string",default:Output$4}]};var autostep=function(e,t){return span(extent(e,t))/30};inherits(DotBin,Transform,{transform:function(e,t){if(this.value&&!(e.modified()||t.changed())){return t}var n=t.materialize(t.SOURCE).source,r=partition$1$1(t.source,e.groupby,identity$6),i=e.smooth||false,a=e.field,o=e.step||autostep(n,a),s=stableCompare((function(e,t){return a(e)-a(t)})),u=e.as||Output$4,l=r.length;var f=Infinity,c=-Infinity,d=0,p;for(;d<l;++d){var h=r[d].sort(s);p=-1;for(var g=0,m=dotbin(h,o,i,a);g<m.length;g++){var v=m[g];if(v<f)f=v;if(v>c)c=v;h[++p][u]=v}}this.value={start:f,stop:c,step:o};return t.reflow(true).modifies(u)}});function Expression$1(e){Operator.call(this,null,update$4,e);this.modified(true)}inherits(Expression$1,Operator);function update$4(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:accessor((function(n){return t(n,e)}),accessorFields(t),accessorName(t))}function Extent(e){Transform.call(this,[undefined,undefined],e)}Extent.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:true}]};inherits(Extent,Transform,{transform:function(e,t){var n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");var a=n[0],o=n[1];if(i||a==null){a=+Infinity;o=-Infinity}t.visit(i?t.SOURCE:t.ADD,(function(e){var t=toNumber(r(e));if(t!=null){if(t<a)a=t;if(t>o)o=t}}));if(!Number.isFinite(a)||!Number.isFinite(o)){var s=accessorName(r);if(s)s=' for field "'+s+'"';t.dataflow.warn("Infinite extent"+s+": ["+a+", "+o+"]");a=o=undefined}this.value=[a,o]}});function Subflow(e,t){Operator.call(this,e);this.parent=t;this.count=0}inherits(Subflow,Operator,{connect:function(e){this.detachSubflow=e.detachSubflow;this.targets().add(e);return e.source=this},add:function(e){this.count+=1;this.value.add.push(e)},rem:function(e){this.count-=1;this.value.rem.push(e)},mod:function(e){this.value.mod.push(e)},init:function(e){this.value.init(e,e.NO_SOURCE)},evaluate:function(){return this.value}});function Facet$1(e){Transform.call(this,{},e);this._keys=fastmap();var t=this._targets=[];t.active=0;t.forEach=function(e){for(var n=0,r=t.active;n<r;++n){e(t[n],n,t)}}}inherits(Facet$1,Transform,{activate:function(e){this._targets[this._targets.active++]=e},subflow:function(e,t,n,r){var i=this.value;var a=has$1(i,e)&&i[e],o,s;if(!a){s=r||(s=this._group[e])&&s.tuple;o=n.dataflow;a=new Subflow(n.fork(n.NO_SOURCE),this);o.add(a).connect(t(o,e,s));i[e]=a;this.activate(a)}else if(a.value.stamp<n.stamp){a.init(n);this.activate(a)}return a},clean:function(){var e=this.value;var t=0;for(var n in e){if(e[n].count===0){var r=e[n].detachSubflow;if(r)r();delete e[n];++t}}if(t){var i=this._targets.filter((function(e){return e&&e.count>0}));this.initTargets(i)}},initTargets:function(e){var t=this._targets,n=t.length,r=e?e.length:0;var i=0;for(;i<r;++i){t[i]=e[i]}for(;i<n&&t[i]!=null;++i){t[i]=null}t.active=r},transform:function(e,t){var n=this;var r=t.dataflow,i=e.key,a=e.subflow,o=this._keys,s=e.modified("key"),u=function(e){return n.subflow(e,a,t)};this._group=e.group||{};this.initTargets();t.visit(t.REM,(function(e){var t=tupleid(e),n=o.get(t);if(n!==undefined){o.delete(t);u(n).rem(e)}}));t.visit(t.ADD,(function(e){var t=i(e);o.set(tupleid(e),t);u(t).add(e)}));if(s||t.modified(i.fields)){t.visit(t.MOD,(function(e){var t=tupleid(e),n=o.get(t),r=i(e);if(n===r){u(r).mod(e)}else{o.set(t,r);u(n).rem(e);u(r).add(e)}}))}else if(t.changed(t.MOD)){t.visit(t.MOD,(function(e){u(o.get(tupleid(e))).mod(e)}))}if(s){t.visit(t.REFLOW,(function(e){var t=tupleid(e),n=o.get(t),r=i(e);if(n!==r){o.set(t,r);u(n).rem(e);u(r).add(e)}}))}if(t.clean()){r.runAfter((function(){n.clean();o.clean()}))}else if(o.empty>r.cleanThreshold){r.runAfter(o.clean)}return t}});function Field$1(e){Operator.call(this,null,update$3,e)}inherits(Field$1,Operator);function update$3(e){return this.value&&!e.modified()?this.value:isArray(e.name)?array$5(e.name).map((function(e){return field$1(e)})):field$1(e.name,e.as)}function Filter(e){Transform.call(this,fastmap(),e)}Filter.Definition={type:"Filter",metadata:{changes:true},params:[{name:"expr",type:"expr",required:true}]};inherits(Filter,Transform,{transform:function(e,t){var n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,u=e.expr;var l=true;t.visit(t.REM,(function(e){var t=tupleid(e);if(!r.has(t))o.push(e);else r.delete(t)}));t.visit(t.ADD,(function(t){if(u(t,e))a.push(t);else r.set(tupleid(t),1)}));function f(t){var n=tupleid(t),i=u(t,e),f=r.get(n);if(i&&f){r.delete(n);a.push(t)}else if(!i&&!f){r.set(n,1);o.push(t)}else if(l&&i&&!f){s.push(t)}}t.visit(t.MOD,f);if(e.modified()){l=false;t.visit(t.REFLOW,f)}if(r.empty>n.cleanThreshold)n.runAfter(r.clean);return i}});function Flatten(e){Transform.call(this,[],e)}Flatten.Definition={type:"Flatten",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"index",type:"string"},{name:"as",type:"string",array:true}]};inherits(Flatten,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=fieldNames(r,e.as||[]),a=e.index||null,o=i.length;n.rem=this.value;t.visit(t.SOURCE,(function(e){var t=r.map((function(t){return t(e)})),s=t.reduce((function(e,t){return Math.max(e,t.length)}),0);var u=0,l,f,c;for(;u<s;++u){f=derive(e);for(l=0;l<o;++l){f[i[l]]=(c=t[l][u])==null?null:c}if(a){f[a]=u}n.add.push(f)}}));this.value=n.source=n.add;if(a)n.modifies(a);return n.modifies(i)}});function Fold(e){Transform.call(this,[],e)}Fold.Definition={type:"Fold",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true,length:2,default:["key","value"]}]};inherits(Fold,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(accessorName),a=e.as||["key","value"],o=a[0],s=a[1],u=r.length;n.rem=this.value;t.visit(t.SOURCE,(function(e){for(var t=0,a=void 0;t<u;++t){a=derive(e);a[o]=i[t];a[s]=r[t](e);n.add.push(a)}}));this.value=n.source=n.add;return n.modifies(a)}});function Formula(e){Transform.call(this,null,e)}Formula.Definition={type:"Formula",metadata:{modifies:true},params:[{name:"expr",type:"expr",required:true},{name:"as",type:"string",required:true},{name:"initonly",type:"boolean"}]};inherits(Formula,Transform,{transform:function(e,t){var n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;if(i){t=t.materialize().reflow(true)}if(!e.initonly){t.modifies(r)}return t.visit(a,(function(t){return t[r]=n(t,e)}))}});function Generate(e){Transform.call(this,[],e)}inherits(Generate,Transform,{transform:function(e,t){var n=t.fork(t.ALL),r=e.generator;var i=this.value,a=e.size-i.length,o,s,u;if(a>0){for(o=[];--a>=0;){o.push(u=ingest$1(r(e)));i.push(u)}n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else{s=i.slice(0,-a);n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s;i=i.slice(-a)}n.source=this.value=i;return n}});var Methods$1={value:"value",median:median,mean:mean,min:min$2,max:max$2};var Empty$1=[];function Impute(e){Transform.call(this,[],e)}Impute.Definition={type:"Impute",metadata:{changes:true},params:[{name:"field",type:"field",required:true},{name:"key",type:"field",required:true},{name:"keyvals",array:true},{name:"groupby",type:"field",array:true},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function getValue(e){var t=e.method||Methods$1.value,n;if(Methods$1[t]==null){error("Unrecognized imputation method: "+t)}else if(t===Methods$1.value){n=e.value!==undefined?e.value:0;return function(){return n}}else{return Methods$1[t]}}function getField$1(e){var t=e.field;return function(e){return e?t(e):NaN}}inherits(Impute,Transform,{transform:function(e,t){var n=t.fork(t.ALL),r=getValue(e),i=getField$1(e),a=accessorName(e.field),o=accessorName(e.key),s=(e.groupby||[]).map(accessorName),u=partition$4(t.source,e.groupby,e.key,e.keyvals),l=[],f=this.value,c=u.domain.length,d,p,h,g,m,v,y,_,b,x;for(m=0,_=u.length;m<_;++m){d=u[m];h=d.values;p=NaN;for(y=0;y<c;++y){if(d[y]!=null)continue;g=u.domain[y];x={_impute:true};for(v=0,b=h.length;v<b;++v)x[s[v]]=h[v];x[o]=g;x[a]=Number.isNaN(p)?p=r(d,i):p;l.push(ingest$1(x))}}if(l.length)n.add=n.materialize(n.ADD).add.concat(l);if(f.length)n.rem=n.materialize(n.REM).rem.concat(f);this.value=l;return n}});function partition$4(e,t,n,r){var i=function(e){return e(m)},a=[],o=r?r.slice():[],s={},u={},l,f,c,d,p,h,g,m;o.forEach((function(e,t){return s[e]=t+1}));for(d=0,g=e.length;d<g;++d){m=e[d];h=n(m);p=s[h]||(s[h]=o.push(h));f=(l=t?t.map(i):Empty$1)+"";if(!(c=u[f])){c=u[f]=[];a.push(c);c.values=l}c[p-1]=m}a.domain=o;return a}function JoinAggregate(e){Aggregate$1.call(this,e)}JoinAggregate.Definition={type:"JoinAggregate",metadata:{modifies:true},params:[{name:"groupby",type:"field",array:true},{name:"fields",type:"field",null:true,array:true},{name:"ops",type:"enum",array:true,values:ValidAggregateOps},{name:"as",type:"string",null:true,array:true},{name:"key",type:"field"}]};inherits(JoinAggregate,Aggregate$1,{transform:function(e,t){var n=this,r=e.modified();var i;if(n.value&&(r||t.modified(n._inputs,true))){i=n.value=r?n.init(e):{};t.visit(t.SOURCE,(function(e){return n.add(e)}))}else{i=n.value=n.value||this.init(e);t.visit(t.REM,(function(e){return n.rem(e)}));t.visit(t.ADD,(function(e){return n.add(e)}))}n.changes();t.visit(t.SOURCE,(function(e){extend$1(e,i[n.cellkey(e)].tuple)}));return t.reflow(r).modifies(this._outputs)},changes:function(){var e=this._adds,t=this._mods;var n,r;for(n=0,r=this._alen;n<r;++n){this.celltuple(e[n]);e[n]=null}for(n=0,r=this._mlen;n<r;++n){this.celltuple(t[n]);t[n]=null}this._alen=this._mlen=0}});function KDE(e){Transform.call(this,null,e)}KDE.Definition={type:"KDE",metadata:{generates:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"cumulative",type:"boolean",default:false},{name:"counts",type:"boolean",default:false},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:true,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:true,default:["value","density"]}]};inherits(KDE,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=t.materialize(t.SOURCE).source,i=partition$1$1(r,e.groupby,e.field),a=(e.groupby||[]).map(accessorName),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];var f=e.extent,c=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;if(s!=="pdf"&&s!=="cdf"){error("Invalid density method: "+s)}if(e.resolve==="shared"){if(!f)f=extent(r,e.field);c=d=e.steps||d}i.forEach((function(t){var n=kde(t,o)[s],r=e.counts?t.length:1,i=f||extent(t);sampleCurve(n,i,c,d).forEach((function(e){var n={};for(var i=0;i<a.length;++i){n[a[i]]=t.dims[i]}n[u[0]]=e[0];n[u[1]]=e[1]*r;l.push(ingest$1(n))}))}));if(this.value)n.rem=this.value;this.value=n.add=n.source=l}return n}});function Key$1(e){Operator.call(this,null,update$2,e)}inherits(Key$1,Operator);function update$2(e){return this.value&&!e.modified()?this.value:key(e.fields,e.flat)}function Load$1(e){Transform.call(this,[],e);this._pending=null}inherits(Load$1,Transform,{transform:function(e,t){var n=this;var r=t.dataflow;if(this._pending){return output(this,t,this._pending)}if(stop(e))return t.StopPropagation;if(e.values){return output(this,t,r.parse(e.values,e.format))}else if(e.async){var i=r.request(e.url,e.format).then((function(e){n._pending=array$5(e.data);return function(e){return e.touch(n)}}));return{async:i}}else{return r.request(e.url,e.format).then((function(e){return output(n,t,array$5(e.data))}))}}});function stop(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function output(e,t,n){n.forEach(ingest$1);var r=t.fork(t.NO_FIELDS&t.NO_SOURCE);r.rem=e.value;e.value=r.source=r.add=n;e._pending=null;if(r.rem.length)r.clean(true);return r}function Lookup(e){Transform.call(this,{},e)}Lookup.Definition={type:"Lookup",metadata:{modifies:true},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:true},{name:"key",type:"field",required:true}]},{name:"values",type:"field",array:true},{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true},{name:"default",default:null}]};inherits(Lookup,Transform,{transform:function(e,t){var n=e.fields,r=e.index,i=e.values,a=e.default==null?null:e.default,o=e.modified(),s=n.length;var u=o?t.SOURCE:t.ADD,l=t,f=e.as,c,d,p;if(i){d=i.length;if(s>1&&!f){error('Multi-field lookup requires explicit "as" parameter.')}if(f&&f.length!==s*d){error('The "as" parameter has too few output field names.')}f=f||i.map(accessorName);c=function(e){for(var t=0,o=0,u,l;t<s;++t){l=r.get(n[t](e));if(l==null)for(u=0;u<d;++u,++o)e[f[o]]=a;else for(u=0;u<d;++u,++o)e[f[o]]=i[u](l)}}}else{if(!f){error("Missing output field names.")}c=function(e){for(var t=0,i;t<s;++t){i=r.get(n[t](e));e[f[t]]=i==null?a:i}}}if(o){l=t.reflow(true)}else{p=n.some((function(e){return t.modified(e.fields)}));u|=p?t.MOD:0}t.visit(u,c);return l.modifies(f)}});function MultiExtent$1(e){Operator.call(this,null,update$1,e)}inherits(MultiExtent$1,Operator);function update$1(e){if(this.value&&!e.modified()){return this.value}var t=e.extents,n=t.length;var r=+Infinity,i=-Infinity,a,o;for(a=0;a<n;++a){o=t[a];if(o[0]<r)r=o[0];if(o[1]>i)i=o[1]}return[r,i]}function MultiValues$1(e){Operator.call(this,null,update,e)}inherits(MultiValues$1,Operator);function update(e){return this.value&&!e.modified()?this.value:e.values.reduce((function(e,t){return e.concat(t)}),[])}function Params$2(e){Transform.call(this,null,e)}inherits(Params$2,Transform,{transform:function(e,t){this.modified(e.modified());this.value=e;return t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Pivot(e){Aggregate$1.call(this,e)}Pivot.Definition={type:"Pivot",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"value",type:"field",required:true},{name:"op",type:"enum",values:ValidAggregateOps,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};inherits(Pivot,Aggregate$1,{_transform:Aggregate$1.prototype.transform,transform:function(e,t){return this._transform(aggregateParams(e,t),t)}});function aggregateParams(e,t){var n=e.field,r=e.value,i=(e.op==="count"?"__count__":e.op)||"sum",a=accessorFields(n).concat(accessorFields(r)),o=pivotKeys(n,e.limit||0,t);if(t.changed())e.set("__pivot__",null,null,true);return{key:e.key,groupby:e.groupby,ops:o.map((function(){return i})),fields:o.map((function(e){return get$4(e,n,r,a)})),as:o.map((function(e){return e+""})),modified:e.modified.bind(e)}}function get$4(e,t,n,r){return accessor((function(r){return t(r)===e?n(r):NaN}),r,e+"")}function pivotKeys(e,t,n){var r={},i=[];n.visit(n.SOURCE,(function(t){var n=e(t);if(!r[n]){r[n]=1;i.push(n)}}));i.sort(ascending$3);return t?i.slice(0,t):i}function PreFacet$1(e){Facet$1.call(this,e)}inherits(PreFacet$1,Facet$1,{transform:function(e,t){var n=this;var r=e.subflow,i=e.field,a=function(e){return n.subflow(tupleid(e),r,t,e)};if(e.modified("field")||i&&t.modified(accessorFields(i))){error("PreFacet does not support field modification.")}this.initTargets();if(i){t.visit(t.MOD,(function(e){var t=a(e);i(e).forEach((function(e){return t.mod(e)}))}));t.visit(t.ADD,(function(e){var t=a(e);i(e).forEach((function(e){return t.add(ingest$1(e))}))}));t.visit(t.REM,(function(e){var t=a(e);i(e).forEach((function(e){return t.rem(e)}))}))}else{t.visit(t.MOD,(function(e){return a(e).mod(e)}));t.visit(t.ADD,(function(e){return a(e).add(e)}));t.visit(t.REM,(function(e){return a(e).rem(e)}))}if(t.clean()){t.runAfter((function(){return n.clean()}))}return t}});function Project(e){Transform.call(this,null,e)}Project.Definition={type:"Project",metadata:{generates:true,changes:true},params:[{name:"fields",type:"field",array:true},{name:"as",type:"string",null:true,array:true}]};inherits(Project,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.fields,i=fieldNames(e.fields,e.as||[]),a=r?function(e,t){return project$1(e,t,r,i)}:rederive;var o;if(this.value){o=this.value}else{t=t.addAll();o=this.value={}}t.visit(t.REM,(function(e){var t=tupleid(e);n.rem.push(o[t]);o[t]=null}));t.visit(t.ADD,(function(e){var t=a(e,ingest$1({}));o[tupleid(e)]=t;n.add.push(t)}));t.visit(t.MOD,(function(e){n.mod.push(a(e,o[tupleid(e)]))}));return n}});function project$1(e,t,n,r){for(var i=0,a=n.length;i<a;++i){t[r[i]]=n[i](e)}return t}function Proxy$1(e){Transform.call(this,null,e)}inherits(Proxy$1,Transform,{transform:function(e,t){this.value=e.value;return e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Quantile$1(e){Transform.call(this,null,e)}Quantile$1.Definition={type:"Quantile",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"probs",type:"number",array:true},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:true,default:["prob","value"]}]};var EPSILON$2=1e-14;inherits(Quantile$1,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed()){n.source=this.value;return n}var i=t.materialize(t.SOURCE).source,a=partition$1$1(i,e.groupby,e.field),o=(e.groupby||[]).map(accessorName),s=[],u=e.step||.01,l=e.probs||range$1$1(u/2,1-EPSILON$2,u),f=l.length;a.forEach((function(e){var t=quantiles(e,l);for(var n=0;n<f;++n){var i={};for(var a=0;a<o.length;++a){i[o[a]]=e.dims[a]}i[r[0]]=l[n];i[r[1]]=t[n];s.push(ingest$1(i))}}));if(this.value)n.rem=this.value;this.value=n.add=n.source=s;return n}});function Relay$1(e){Transform.call(this,null,e)}inherits(Relay$1,Transform,{transform:function(e,t){var n,r;if(this.value){r=this.value}else{n=t=t.addAll();r=this.value={}}if(e.derive){n=t.fork(t.NO_SOURCE);t.visit(t.REM,(function(e){var t=tupleid(e);n.rem.push(r[t]);r[t]=null}));t.visit(t.ADD,(function(e){var t=derive(e);r[tupleid(e)]=t;n.add.push(t)}));t.visit(t.MOD,(function(e){var t=r[tupleid(e)];for(var i in e){t[i]=e[i];n.modifies(i)}n.mod.push(t)}))}return n}});function Sample(e){Transform.call(this,[],e);this.count=0}Sample.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};inherits(Sample,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce((function(e,t){return e[tupleid(t)]=1,e}),{});var o=this.value,s=this.count,u=0;function l(e){var t,r;if(o.length<i){o.push(e)}else{r=~~((s+1)*random());if(r<o.length&&r>=u){t=o[r];if(a[tupleid(t)])n.rem.push(t);o[r]=e}}++s}if(t.rem.length){t.visit(t.REM,(function(e){var t=tupleid(e);if(a[t]){a[t]=-1;n.rem.push(e)}--s}));o=o.filter((function(e){return a[tupleid(e)]!==-1}))}if((t.rem.length||r)&&o.length<i&&t.source){u=s=o.length;t.visit(t.SOURCE,(function(e){if(!a[tupleid(e)])l(e)}));u=-1}if(r&&o.length>i){var f=o.length-i;for(var c=0;c<f;++c){a[tupleid(o[c])]=-1;n.rem.push(o[c])}o=o.slice(f)}if(t.mod.length){t.visit(t.MOD,(function(e){if(a[tupleid(e)])n.mod.push(e)}))}if(t.add.length){t.visit(t.ADD,l)}if(t.add.length||u<0){n.add=o.filter((function(e){return!a[tupleid(e)]}))}this.count=s;this.value=n.source=o;return n}});function Sequence(e){Transform.call(this,null,e)}Sequence.Definition={type:"Sequence",metadata:{generates:true,changes:true},params:[{name:"start",type:"number",required:true},{name:"stop",type:"number",required:true},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};inherits(Sequence,Transform,{transform:function(e,t){if(this.value&&!e.modified())return;var n=t.materialize().fork(t.MOD),r=e.as||"data";n.rem=this.value?t.rem.concat(this.value):t.rem;this.value=range$1$1(e.start,e.stop,e.step||1).map((function(e){var t={};t[r]=e;return ingest$1(t)}));n.add=t.add.concat(this.value);return n}});function Sieve$1(e){Transform.call(this,null,e);this.modified(true)}inherits(Sieve$1,Transform,{transform:function(e,t){this.value=t.source;return t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function TimeUnit(e){Transform.call(this,null,e)}var OUTPUT=["unit0","unit1"];TimeUnit.Definition={type:"TimeUnit",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"interval",type:"boolean",default:true},{name:"units",type:"enum",values:TIME_UNITS,array:true},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:true},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:true,length:2,default:OUTPUT}]};inherits(TimeUnit,Transform,{transform:function(e,t){var n=e.field,r=e.interval!==false,i=e.timezone==="utc",a=this._floor(e,t),o=(i?utcInterval:timeInterval)(a.unit).offset,s=e.as||OUTPUT,u=s[0],l=s[1],f=a.step;var c=a.start||Infinity,d=a.stop||-Infinity,p=t.ADD;if(e.modified()||t.modified(accessorFields(n))){t=t.reflow(true);p=t.SOURCE;c=Infinity;d=-Infinity}t.visit(p,(function(e){var t=n(e);var i,s;if(t==null){e[u]=null;if(r)e[l]=null}else{e[u]=i=s=a(t);if(r)e[l]=s=o(i,f);if(i<c)c=i;if(s>d)d=s}}));a.start=c;a.stop=d;return t.modifies(r?s:u)},_floor:function(e,t){var n=e.timezone==="utc";var r=e.units?{units:e.units,step:e.step||1}:bin$2({extent:e.extent||extent(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),i=r.units,a=r.step;var o=timeUnits(i),s=this.value||{},u=(n?utcFloor:timeFloor)(o,a);u.unit=peek$1(o);u.units=o;u.step=a;u.start=s.start;u.stop=s.stop;return this.value=u}});function TupleIndex(e){Transform.call(this,fastmap(),e)}inherits(TupleIndex,Transform,{transform:function(e,t){var n=t.dataflow,r=e.field,i=this.value,a=function(e){return i.set(r(e),e)};var o=true;if(e.modified("field")||t.modified(r.fields)){i.clear();t.visit(t.SOURCE,a)}else if(t.changed()){t.visit(t.REM,(function(e){return i.delete(r(e))}));t.visit(t.ADD,a)}else{o=false}this.modified(o);if(i.empty>n.cleanThreshold)n.runAfter(i.clean);return t.fork()}});function Values$1(e){Transform.call(this,null,e)}inherits(Values$1,Transform,{transform:function(e,t){var n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);if(n){this.value=(e.sort?t.source.slice().sort(stableCompare(e.sort)):t.source).map(e.field)}}});function WindowOp(e,t,n,r){var i=WindowOps[e](t,n);return{init:i.init||zero$3,update:function(e,t){t[r]=i.next(e)}}}var WindowOps={row_number:function(){return{next:function(e){return e.index+1}}},rank:function(){var e;return{init:function(){return e=1},next:function(t){var n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){var e;return{init:function(){return e=1},next:function(t){var n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){var e=WindowOps.rank(),t=e.next;return{init:e.init,next:function(e){return(t(e)-1)/(e.data.length-1)}}},cume_dist:function(){var e;return{init:function(){return e=0},next:function(t){var n=t.data,r=t.compare;var i=t.index;if(e<i){while(i+1<n.length&&!r(n[i],n[i+1]))++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){t=+t;if(!(t>0))error("ntile num must be greater than zero.");var n=WindowOps.cume_dist(),r=n.next;return{init:n.init,next:function(e){return Math.ceil(t*r(e))}}},lag:function(e,t){t=+t||1;return{next:function(n){var r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){t=+t||1;return{next:function(n){var r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:function(t){return e(t.data[t.i0])}}},last_value:function(e){return{next:function(t){return e(t.data[t.i1-1])}}},nth_value:function(e,t){t=+t;if(!(t>0))error("nth_value nth must be greater than zero.");return{next:function(n){var r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){var t;return{init:function(){return t=null},next:function(n){var r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){var t,n;return{init:function(){return t=null,n=-1},next:function(r){var i=r.data;return r.index<=n?t:(n=find$2(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};function find$2(e,t,n){for(var r=t.length;n<r;++n){var i=e(t[n]);if(i!=null)return n}return-1}var ValidWindowOps=Object.keys(WindowOps);function WindowState(e){var t=array$5(e.ops),n=array$5(e.fields),r=array$5(e.params),i=array$5(e.as),a=this.outputs=[],o=this.windows=[],s={},u={},l=[],f=[];var c=true;function d(e){array$5(accessorFields(e)).forEach((function(e){return s[e]=1}))}d(e.sort);t.forEach((function(e,t){var s=n[t],p=accessorName(s),h=measureName(e,p,i[t]);d(s);a.push(h);if(has$1(WindowOps,e)){o.push(WindowOp(e,n[t],r[t],h))}else{if(s==null&&e!=="count"){error("Null aggregate field specified.")}if(e==="count"){l.push(h);return}c=false;var g=u[p];if(!g){g=u[p]=[];g.field=s;f.push(g)}g.push(createMeasure(e,h))}}));if(l.length||f.length){this.cell=cell(f,l,c)}this.inputs=Object.keys(s)}var prototype=WindowState.prototype;prototype.init=function(){this.windows.forEach((function(e){return e.init()}));if(this.cell)this.cell.init()};prototype.update=function(e,t){var n=this.cell,r=this.windows,i=e.data,a=r&&r.length;var o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)};function cell(e,t,n){e=e.map((function(e){return compileMeasures(e,e.field)}));var r={num:0,agg:null,store:false,count:t};if(!n){var i=e.length,a=r.agg=Array(i),o=0;for(;o<i;++o)a[o]=new e[o](r)}if(r.store){var s=r.data=new TupleStore}r.add=function(e){r.num+=1;if(n)return;if(s)s.add(e);for(var t=0;t<i;++t){a[t].add(a[t].get(e),e)}};r.rem=function(e){r.num-=1;if(n)return;if(s)s.rem(e);for(var t=0;t<i;++t){a[t].rem(a[t].get(e),e)}};r.set=function(e){var i,o;if(s)s.values();for(i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)};r.init=function(){r.num=0;if(s)s.reset();for(var e=0;e<i;++e)a[e].init()};return r}function Window(e){Transform.call(this,{},e);this._mlen=0;this._mods=[]}Window.Definition={type:"Window",metadata:{modifies:true},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:ValidWindowOps.concat(ValidAggregateOps)},{name:"params",type:"number",null:true,array:true},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"frame",type:"number",null:true,array:true,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:false}]};inherits(Window,Transform,{transform:function(e,t){var n=this;this.stamp=t.stamp;var r=e.modified(),i=stableCompare(e.sort),a=groupkey(e.groupby),o=function(e){return n.group(a(e))};var s=this.state;if(!s||r){s=this.state=new WindowState(e)}if(r||t.modified(s.inputs)){this.value={};t.visit(t.SOURCE,(function(e){return o(e).add(e)}))}else{t.visit(t.REM,(function(e){return o(e).remove(e)}));t.visit(t.ADD,(function(e){return o(e).add(e)}))}for(var u=0,l=this._mlen;u<l;++u){processPartition(this._mods[u],s,i,e)}this._mlen=0;this._mods=[];return t.reflow(r).modifies(s.outputs)},group:function(e){var t=this.value[e];if(!t){t=this.value[e]=SortedList(tupleid);t.stamp=-1}if(t.stamp<this.stamp){t.stamp=this.stamp;this._mods[this._mlen++]=t}return t}});function processPartition(e,t,n,r){var i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),u=s.length,l=a?bisector$1(i):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||constant$4(-1)};t.init();for(var c=0;c<u;++c){setWindow(f,o,c,u);if(a)adjustRange(f,l);t.update(f,s[c])}}function setWindow(e,t,n,r){e.p0=e.i0;e.p1=e.i1;e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0]));e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1);e.index=n}function adjustRange(e,t){var n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;if(n>0&&!i(a[n],a[n-1]))e.i0=t.left(a,a[n]);if(r<o&&!i(a[r],a[r+1]))e.i1=t.right(a,a[r])}var tx=Object.freeze({__proto__:null,aggregate:Aggregate$1,bin:Bin,collect:Collect$1,compare:Compare$1,countpattern:CountPattern,cross:Cross,density:Density,dotbin:DotBin,expression:Expression$1,extent:Extent,facet:Facet$1,field:Field$1,filter:Filter,flatten:Flatten,fold:Fold,formula:Formula,generate:Generate,impute:Impute,joinaggregate:JoinAggregate,kde:KDE,key:Key$1,load:Load$1,lookup:Lookup,multiextent:MultiExtent$1,multivalues:MultiValues$1,params:Params$2,pivot:Pivot,prefacet:PreFacet$1,project:Project,proxy:Proxy$1,quantile:Quantile$1,relay:Relay$1,sample:Sample,sequence:Sequence,sieve:Sieve$1,subflow:Subflow,timeunit:TimeUnit,tupleindex:TupleIndex,values:Values$1,window:Window});var pi$3=Math.PI,tau$3=2*pi$3,epsilon$4=1e-6,tauEpsilon=tau$3-epsilon$4;function Path$1(){this._x0=this._y0=this._x1=this._y1=null;this._=""}function path$3(){return new Path$1}Path$1.prototype=path$3.prototype={constructor:Path$1,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){if(this._x1!==null){this._x1=this._x0,this._y1=this._y0;this._+="Z"}},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,s=n-e,u=r-t,l=a-e,f=o-t,c=l*l+f*f;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null){this._+="M"+(this._x1=e)+","+(this._y1=t)}else if(!(c>epsilon$4));else if(!(Math.abs(f*s-u*l)>epsilon$4)||!i){this._+="L"+(this._x1=e)+","+(this._y1=t)}else{var d=n-a,p=r-o,h=s*s+u*u,g=d*d+p*p,m=Math.sqrt(h),v=Math.sqrt(c),y=i*Math.tan((pi$3-Math.acos((h+c-g)/(2*m*v)))/2),_=y/v,b=y/m;if(Math.abs(_-1)>epsilon$4){this._+="L"+(e+_*l)+","+(t+_*f)}this._+="A"+i+","+i+",0,0,"+ +(f*d>l*p)+","+(this._x1=e+b*s)+","+(this._y1=t+b*u)}},arc:function(e,t,n,r,i,a){e=+e,t=+t,n=+n,a=!!a;var o=n*Math.cos(r),s=n*Math.sin(r),u=e+o,l=t+s,f=1^a,c=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);if(this._x1===null){this._+="M"+u+","+l}else if(Math.abs(this._x1-u)>epsilon$4||Math.abs(this._y1-l)>epsilon$4){this._+="L"+u+","+l}if(!n)return;if(c<0)c=c%tau$3+tau$3;if(c>tauEpsilon){this._+="A"+n+","+n+",0,1,"+f+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+f+","+(this._x1=u)+","+(this._y1=l)}else if(c>epsilon$4){this._+="A"+n+","+n+",0,"+ +(c>=pi$3)+","+f+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))}},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function constant$3(e){return function t(){return e}}var abs$2=Math.abs;var atan2$1=Math.atan2;var cos$2=Math.cos;var max$1=Math.max;var min$1=Math.min;var sin$2=Math.sin;var sqrt$3=Math.sqrt;var epsilon$3=1e-12;var pi$2=Math.PI;var halfPi$2=pi$2/2;var tau$2=2*pi$2;function acos$1(e){return e>1?0:e<-1?pi$2:Math.acos(e)}function asin$2(e){return e>=1?halfPi$2:e<=-1?-halfPi$2:Math.asin(e)}function arcInnerRadius(e){return e.innerRadius}function arcOuterRadius(e){return e.outerRadius}function arcStartAngle(e){return e.startAngle}function arcEndAngle(e){return e.endAngle}function arcPadAngle(e){return e&&e.padAngle}function intersect$3(e,t,n,r,i,a,o,s){var u=n-e,l=r-t,f=o-i,c=s-a,d=c*u-f*l;if(d*d<epsilon$3)return;d=(f*(t-a)-c*(e-i))/d;return[e+d*u,t+d*l]}function cornerTangents(e,t,n,r,i,a,o){var s=e-n,u=t-r,l=(o?a:-a)/sqrt$3(s*s+u*u),f=l*u,c=-l*s,d=e+f,p=t+c,h=n+f,g=r+c,m=(d+h)/2,v=(p+g)/2,y=h-d,_=g-p,b=y*y+_*_,x=i-a,E=d*g-h*p,S=(_<0?-1:1)*sqrt$3(max$1(0,x*x*b-E*E)),$=(E*_-y*S)/b,A=(-E*y-_*S)/b,D=(E*_+y*S)/b,w=(-E*y+_*S)/b,C=$-m,T=A-v,k=D-m,O=w-v;if(C*C+T*T>k*k+O*O)$=D,A=w;return{cx:$,cy:A,x01:-f,y01:-c,x11:$*(i/x-1),y11:A*(i/x-1)}}function arc$2$1(){var e=arcInnerRadius,t=arcOuterRadius,n=constant$3(0),r=null,i=arcStartAngle,a=arcEndAngle,o=arcPadAngle,s=null;function u(){var u,l,f=+e.apply(this,arguments),c=+t.apply(this,arguments),d=i.apply(this,arguments)-halfPi$2,p=a.apply(this,arguments)-halfPi$2,h=abs$2(p-d),g=p>d;if(!s)s=u=path$3();if(c<f)l=c,c=f,f=l;if(!(c>epsilon$3))s.moveTo(0,0);else if(h>tau$2-epsilon$3){s.moveTo(c*cos$2(d),c*sin$2(d));s.arc(0,0,c,d,p,!g);if(f>epsilon$3){s.moveTo(f*cos$2(p),f*sin$2(p));s.arc(0,0,f,p,d,g)}}else{var m=d,v=p,y=d,_=p,b=h,x=h,E=o.apply(this,arguments)/2,S=E>epsilon$3&&(r?+r.apply(this,arguments):sqrt$3(f*f+c*c)),$=min$1(abs$2(c-f)/2,+n.apply(this,arguments)),A=$,D=$,w,C;if(S>epsilon$3){var T=asin$2(S/f*sin$2(E)),k=asin$2(S/c*sin$2(E));if((b-=T*2)>epsilon$3)T*=g?1:-1,y+=T,_-=T;else b=0,y=_=(d+p)/2;if((x-=k*2)>epsilon$3)k*=g?1:-1,m+=k,v-=k;else x=0,m=v=(d+p)/2}var O=c*cos$2(m),N=c*sin$2(m),R=f*cos$2(_),F=f*sin$2(_);if($>epsilon$3){var L=c*cos$2(v),P=c*sin$2(v),I=f*cos$2(y),M=f*sin$2(y),z;if(h<pi$2&&(z=intersect$3(O,N,I,M,L,P,R,F))){var B=O-z[0],U=N-z[1],j=L-z[0],H=P-z[1],q=1/sin$2(acos$1((B*j+U*H)/(sqrt$3(B*B+U*U)*sqrt$3(j*j+H*H)))/2),G=sqrt$3(z[0]*z[0]+z[1]*z[1]);A=min$1($,(f-G)/(q-1));D=min$1($,(c-G)/(q+1))}}if(!(x>epsilon$3))s.moveTo(O,N);else if(D>epsilon$3){w=cornerTangents(I,M,O,N,c,D,g);C=cornerTangents(L,P,R,F,c,D,g);s.moveTo(w.cx+w.x01,w.cy+w.y01);if(D<$)s.arc(w.cx,w.cy,D,atan2$1(w.y01,w.x01),atan2$1(C.y01,C.x01),!g);else{s.arc(w.cx,w.cy,D,atan2$1(w.y01,w.x01),atan2$1(w.y11,w.x11),!g);s.arc(0,0,c,atan2$1(w.cy+w.y11,w.cx+w.x11),atan2$1(C.cy+C.y11,C.cx+C.x11),!g);s.arc(C.cx,C.cy,D,atan2$1(C.y11,C.x11),atan2$1(C.y01,C.x01),!g)}}else s.moveTo(O,N),s.arc(0,0,c,m,v,!g);if(!(f>epsilon$3)||!(b>epsilon$3))s.lineTo(R,F);else if(A>epsilon$3){w=cornerTangents(R,F,L,P,f,-A,g);C=cornerTangents(O,N,I,M,f,-A,g);s.lineTo(w.cx+w.x01,w.cy+w.y01);if(A<$)s.arc(w.cx,w.cy,A,atan2$1(w.y01,w.x01),atan2$1(C.y01,C.x01),!g);else{s.arc(w.cx,w.cy,A,atan2$1(w.y01,w.x01),atan2$1(w.y11,w.x11),!g);s.arc(0,0,f,atan2$1(w.cy+w.y11,w.cx+w.x11),atan2$1(C.cy+C.y11,C.cx+C.x11),g);s.arc(C.cx,C.cy,A,atan2$1(C.y11,C.x11),atan2$1(C.y01,C.x01),!g)}}else s.arc(0,0,f,_,y,g)}s.closePath();if(u)return s=null,u+""||null}u.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-pi$2/2;return[cos$2(r)*n,sin$2(r)*n]};u.innerRadius=function(t){return arguments.length?(e=typeof t==="function"?t:constant$3(+t),u):e};u.outerRadius=function(e){return arguments.length?(t=typeof e==="function"?e:constant$3(+e),u):t};u.cornerRadius=function(e){return arguments.length?(n=typeof e==="function"?e:constant$3(+e),u):n};u.padRadius=function(e){return arguments.length?(r=e==null?null:typeof e==="function"?e:constant$3(+e),u):r};u.startAngle=function(e){return arguments.length?(i=typeof e==="function"?e:constant$3(+e),u):i};u.endAngle=function(e){return arguments.length?(a=typeof e==="function"?e:constant$3(+e),u):a};u.padAngle=function(e){return arguments.length?(o=typeof e==="function"?e:constant$3(+e),u):o};u.context=function(e){return arguments.length?(s=e==null?null:e,u):s};return u}function array$4(e){return typeof e==="object"&&"length"in e?e:Array.from(e)}function Linear$1(e){this._context=e}Linear$1.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function curveLinear(e){return new Linear$1(e)}function x$3(e){return e[0]}function y$3(e){return e[1]}function line$2$1(e,t){var n=constant$3(true),r=null,i=curveLinear,a=null;e=typeof e==="function"?e:e===undefined?x$3:constant$3(e);t=typeof t==="function"?t:t===undefined?y$3:constant$3(t);function o(o){var s,u=(o=array$4(o)).length,l,f=false,c;if(r==null)a=i(c=path$3());for(s=0;s<=u;++s){if(!(s<u&&n(l=o[s],s,o))===f){if(f=!f)a.lineStart();else a.lineEnd()}if(f)a.point(+e(l,s,o),+t(l,s,o))}if(c)return a=null,c+""||null}o.x=function(t){return arguments.length?(e=typeof t==="function"?t:constant$3(+t),o):e};o.y=function(e){return arguments.length?(t=typeof e==="function"?e:constant$3(+e),o):t};o.defined=function(e){return arguments.length?(n=typeof e==="function"?e:constant$3(!!e),o):n};o.curve=function(e){return arguments.length?(i=e,r!=null&&(a=i(r)),o):i};o.context=function(e){return arguments.length?(e==null?r=a=null:a=i(r=e),o):r};return o}function area$2$1(e,t,n){var r=null,i=constant$3(true),a=null,o=curveLinear,s=null;e=typeof e==="function"?e:e===undefined?x$3:constant$3(+e);t=typeof t==="function"?t:t===undefined?constant$3(0):constant$3(+t);n=typeof n==="function"?n:n===undefined?y$3:constant$3(+n);function u(u){var l,f,c,d=(u=array$4(u)).length,p,h=false,g,m=new Array(d),v=new Array(d);if(a==null)s=o(g=path$3());for(l=0;l<=d;++l){if(!(l<d&&i(p=u[l],l,u))===h){if(h=!h){f=l;s.areaStart();s.lineStart()}else{s.lineEnd();s.lineStart();for(c=l-1;c>=f;--c){s.point(m[c],v[c])}s.lineEnd();s.areaEnd()}}if(h){m[l]=+e(p,l,u),v[l]=+t(p,l,u);s.point(r?+r(p,l,u):m[l],n?+n(p,l,u):v[l])}}if(g)return s=null,g+""||null}function l(){return line$2$1().defined(i).curve(o).context(a)}u.x=function(t){return arguments.length?(e=typeof t==="function"?t:constant$3(+t),r=null,u):e};u.x0=function(t){return arguments.length?(e=typeof t==="function"?t:constant$3(+t),u):e};u.x1=function(e){return arguments.length?(r=e==null?null:typeof e==="function"?e:constant$3(+e),u):r};u.y=function(e){return arguments.length?(t=typeof e==="function"?e:constant$3(+e),n=null,u):t};u.y0=function(e){return arguments.length?(t=typeof e==="function"?e:constant$3(+e),u):t};u.y1=function(e){return arguments.length?(n=e==null?null:typeof e==="function"?e:constant$3(+e),u):n};u.lineX0=u.lineY0=function(){return l().x(e).y(t)};u.lineY1=function(){return l().x(e).y(n)};u.lineX1=function(){return l().x(r).y(t)};u.defined=function(e){return arguments.length?(i=typeof e==="function"?e:constant$3(!!e),u):i};u.curve=function(e){return arguments.length?(o=e,a!=null&&(s=o(a)),u):o};u.context=function(e){return arguments.length?(e==null?a=s=null:s=o(a=e),u):a};return u}var circle$2={draw:function(e,t){var n=Math.sqrt(t/pi$2);e.moveTo(n,0);e.arc(0,0,n,0,tau$2)}};function symbol$2(e,t){var n=null;e=typeof e==="function"?e:constant$3(e||circle$2);t=typeof t==="function"?t:constant$3(t===undefined?64:+t);function r(){var r;if(!n)n=r=path$3();e.apply(this,arguments).draw(n,+t.apply(this,arguments));if(r)return n=null,r+""||null}r.type=function(t){return arguments.length?(e=typeof t==="function"?t:constant$3(t),r):e};r.size=function(e){return arguments.length?(t=typeof e==="function"?e:constant$3(+e),r):t};r.context=function(e){return arguments.length?(n=e==null?null:e,r):n};return r}function noop$3(){}function point$7(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Basis(e){this._context=e}Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){switch(this._point){case 3:point$7(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point$7(this,e,t);break}this._x0=this._x1,this._x1=e;this._y0=this._y1,this._y1=t}};function curveBasis(e){return new Basis(e)}function BasisClosed(e){this._context=e}BasisClosed.prototype={areaStart:noop$3,areaEnd:noop$3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2);this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3);this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3);this._context.closePath();break}case 3:{this.point(this._x2,this._y2);this.point(this._x3,this._y3);this.point(this._x4,this._y4);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._x2=e,this._y2=t;break;case 1:this._point=2;this._x3=e,this._y3=t;break;case 2:this._point=3;this._x4=e,this._y4=t;this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:point$7(this,e,t);break}this._x0=this._x1,this._x1=e;this._y0=this._y1,this._y1=t}};function curveBasisClosed(e){return new BasisClosed(e)}function BasisOpen(e){this._context=e}BasisOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:point$7(this,e,t);break}this._x0=this._x1,this._x1=e;this._y0=this._y1,this._y1=t}};function curveBasisOpen(e){return new BasisOpen(e)}function Bundle(e,t){this._basis=new Basis(e);this._beta=t}Bundle.prototype={lineStart:function(){this._x=[];this._y=[];this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0){var r=e[0],i=t[0],a=e[n]-r,o=t[n]-i,s=-1,u;while(++s<=n){u=s/n;this._basis.point(this._beta*e[s]+(1-this._beta)*(r+u*a),this._beta*t[s]+(1-this._beta)*(i+u*o))}}this._x=this._y=null;this._basis.lineEnd()},point:function(e,t){this._x.push(+e);this._y.push(+t)}};var curveBundle=function e(t){function n(e){return t===1?new Basis(e):new Bundle(e,t)}n.beta=function(t){return e(+t)};return n}(.85);function point$6(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Cardinal(e,t){this._context=e;this._k=(1-t)/6}Cardinal.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:point$6(this,this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;this._x1=e,this._y1=t;break;case 2:this._point=3;default:point$6(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var curveCardinal=function e(t){function n(e){return new Cardinal(e,t)}n.tension=function(t){return e(+t)};return n}(0);function CardinalClosed(e,t){this._context=e;this._k=(1-t)/6}CardinalClosed.prototype={areaStart:noop$3,areaEnd:noop$3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._x3=e,this._y3=t;break;case 1:this._point=2;this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3;this._x5=e,this._y5=t;break;default:point$6(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var curveCardinalClosed=function e(t){function n(e){return new CardinalClosed(e,t)}n.tension=function(t){return e(+t)};return n}(0);function CardinalOpen(e,t){this._context=e;this._k=(1-t)/6}CardinalOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$6(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var curveCardinalOpen=function e(t){function n(e){return new CardinalOpen(e,t)}n.tension=function(t){return e(+t)};return n}(0);function point$5(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>epsilon$3){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/u;i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>epsilon$3){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,f=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*l+e._x1*e._l23_2a-t*e._l12_2a)/f;o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/f}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function CatmullRom(e,t){this._context=e;this._alpha=t}CatmullRom.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;if(this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:point$5(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var curveCatmullRom=function e(t){function n(e){return t?new CatmullRom(e,t):new Cardinal(e,0)}n.alpha=function(t){return e(+t)};return n}(.5);function CatmullRomClosed(e,t){this._context=e;this._alpha=t}CatmullRomClosed.prototype={areaStart:noop$3,areaEnd:noop$3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;if(this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;this._x3=e,this._y3=t;break;case 1:this._point=2;this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3;this._x5=e,this._y5=t;break;default:point$5(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var curveCatmullRomClosed=function e(t){function n(e){return t?new CatmullRomClosed(e,t):new CardinalClosed(e,0)}n.alpha=function(t){return e(+t)};return n}(.5);function CatmullRomOpen(e,t){this._context=e;this._alpha=t}CatmullRomOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(e,t){e=+e,t=+t;if(this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$5(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=e;this._y0=this._y1,this._y1=this._y2,this._y2=t}};var curveCatmullRomOpen=function e(t){function n(e){return t?new CatmullRomOpen(e,t):new CardinalOpen(e,0)}n.alpha=function(t){return e(+t)};return n}(.5);function LinearClosed(e){this._context=e}LinearClosed.prototype={areaStart:noop$3,areaEnd:noop$3,lineStart:function(){this._point=0},lineEnd:function(){if(this._point)this._context.closePath()},point:function(e,t){e=+e,t=+t;if(this._point)this._context.lineTo(e,t);else this._point=1,this._context.moveTo(e,t)}};function curveLinearClosed(e){return new LinearClosed(e)}function sign$1(e){return e<0?-1:1}function slope3(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(sign$1(a)+sign$1(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function slope2(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function point$4(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function MonotoneX(e){this._context=e}MonotoneX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:point$4(this,this._t0,slope2(this,this._t0));break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(e,t){var n=NaN;e=+e,t=+t;if(e===this._x1&&t===this._y1)return;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;point$4(this,slope2(this,n=slope3(this,e,t)),n);break;default:point$4(this,this._t0,n=slope3(this,e,t));break}this._x0=this._x1,this._x1=e;this._y0=this._y1,this._y1=t;this._t0=n}};function MonotoneY(e){this._context=new ReflectContext(e)}(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(e,t){MonotoneX.prototype.point.call(this,t,e)};function ReflectContext(e){this._context=e}ReflectContext.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}};function monotoneX(e){return new MonotoneX(e)}function monotoneY(e){return new MonotoneY(e)}function Natural(e){this._context=e}Natural.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[];this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n){this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]);if(n===2){this._context.lineTo(e[1],t[1])}else{var r=controlPoints(e),i=controlPoints(t);for(var a=0,o=1;o<n;++a,++o){this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o])}}}if(this._line||this._line!==0&&n===1)this._context.closePath();this._line=1-this._line;this._x=this._y=null},point:function(e,t){this._x.push(+e);this._y.push(+t)}};function controlPoints(e){var t,n=e.length-1,r,i=new Array(n),a=new Array(n),o=new Array(n);i[0]=0,a[0]=2,o[0]=e[0]+2*e[1];for(t=1;t<n-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];i[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n];for(t=1;t<n;++t)r=i[t]/a[t-1],a[t]-=r,o[t]-=r*o[t-1];i[n-1]=o[n-1]/a[n-1];for(t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];a[n-1]=(e[n]+i[n-1])/2;for(t=0;t<n-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function curveNatural(e){return new Natural(e)}function Step(e,t){this._context=e;this._t=t}Step.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN;this._point=0},lineEnd:function(){if(0<this._t&&this._t<1&&this._point===2)this._context.lineTo(this._x,this._y);if(this._line||this._line!==0&&this._point===1)this._context.closePath();if(this._line>=0)this._t=1-this._t,this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0){this._context.lineTo(this._x,t);this._context.lineTo(e,t)}else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y);this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function curveStep(e){return new Step(e,.5)}function stepBefore(e){return new Step(e,0)}function stepAfter(e){return new Step(e,1)}function domCanvas(e,t){if(typeof document!=="undefined"&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext){n.width=e;n.height=t;return n}}return null}var domImage=function(){return typeof Image!=="undefined"?Image:null};function initRange(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function initInterpolator(e,t){switch(arguments.length){case 0:break;case 1:{if(typeof e==="function")this.interpolator(e);else this.range(e);break}default:{this.domain(e);if(typeof t==="function")this.interpolator(t);else this.range(t);break}}return this}var implicit=Symbol("implicit");function ordinal(){var e=new Map,t=[],n=[],r=implicit;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==implicit)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(var r=0,a=n;r<a.length;r++){var o=a[r];var s=o+"";if(e.has(s))continue;e.set(s,t.push(o))}return i};i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()};i.unknown=function(e){return arguments.length?(r=e,i):r};i.copy=function(){return ordinal(t,n).unknown(r)};initRange.apply(i,arguments);return i}function define(e,t,n){e.prototype=t.prototype=n;n.constructor=e}function extend(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Color(){}var darker=.7;var brighter=1/darker;var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$");var named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color$3,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb});function color_formatHex(){return this.rgb().formatHex()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color$3(e){var t,n;e=(e+"").trim().toLowerCase();return(t=reHex.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?rgbn(t):n===3?new Rgb(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?rgba(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?rgba(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=reRgbInteger.exec(e))?new Rgb(t[1],t[2],t[3],1):(t=reRgbPercent.exec(e))?new Rgb(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=reRgbaInteger.exec(e))?rgba(t[1],t[2],t[3],t[4]):(t=reRgbaPercent.exec(e))?rgba(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=reHslPercent.exec(e))?hsla(t[1],t[2]/100,t[3]/100,1):(t=reHslaPercent.exec(e))?hsla(t[1],t[2]/100,t[3]/100,t[4]):named.hasOwnProperty(e)?rgbn(named[e]):e==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(e){return new Rgb(e>>16&255,e>>8&255,e&255,1)}function rgba(e,t,n,r){if(r<=0)e=t=n=NaN;return new Rgb(e,t,n,r)}function rgbConvert(e){if(!(e instanceof Color))e=color$3(e);if(!e)return new Rgb;e=e.rgb();return new Rgb(e.r,e.g,e.b,e.opacity)}function rgb$1(e,t,n,r){return arguments.length===1?rgbConvert(e):new Rgb(e,t,n,r==null?1:r)}function Rgb(e,t,n,r){this.r=+e;this.g=+t;this.b=+n;this.opacity=+r}define(Rgb,rgb$1,extend(Color,{brighter:function(e){e=e==null?brighter:Math.pow(brighter,e);return new Rgb(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){e=e==null?darker:Math.pow(darker,e);return new Rgb(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&(-.5<=this.g&&this.g<255.5)&&(-.5<=this.b&&this.b<255.5)&&(0<=this.opacity&&this.opacity<=1)},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb}));function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var e=this.opacity;e=isNaN(e)?1:Math.max(0,Math.min(1,e));return(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function hex(e){e=Math.max(0,Math.min(255,Math.round(e)||0));return(e<16?"0":"")+e.toString(16)}function hsla(e,t,n,r){if(r<=0)e=t=n=NaN;else if(n<=0||n>=1)e=t=NaN;else if(t<=0)e=NaN;return new Hsl(e,t,n,r)}function hslConvert(e){if(e instanceof Hsl)return new Hsl(e.h,e.s,e.l,e.opacity);if(!(e instanceof Color))e=color$3(e);if(!e)return new Hsl;if(e instanceof Hsl)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;if(s){if(t===a)o=(n-r)/s+(n<r)*6;else if(n===a)o=(r-t)/s+2;else o=(t-n)/s+4;s/=u<.5?a+i:2-a-i;o*=60}else{s=u>0&&u<1?0:o}return new Hsl(o,s,u,e.opacity)}function hsl$2(e,t,n,r){return arguments.length===1?hslConvert(e):new Hsl(e,t,n,r==null?1:r)}function Hsl(e,t,n,r){this.h=+e;this.s=+t;this.l=+n;this.opacity=+r}define(Hsl,hsl$2,extend(Color,{brighter:function(e){e=e==null?brighter:Math.pow(brighter,e);return new Hsl(this.h,this.s,this.l*e,this.opacity)},darker:function(e){e=e==null?darker:Math.pow(darker,e);return new Hsl(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Rgb(hsl2rgb(e>=240?e-240:e+120,i,r),hsl2rgb(e,i,r),hsl2rgb(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&(0<=this.l&&this.l<=1)&&(0<=this.opacity&&this.opacity<=1)},formatHsl:function(){var e=this.opacity;e=isNaN(e)?1:Math.max(0,Math.min(1,e));return(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function hsl2rgb(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var radians$1=Math.PI/180;var degrees$2=180/Math.PI;var K=18,Xn=.96422,Yn=1,Zn=.82521,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1;function labConvert(e){if(e instanceof Lab)return new Lab(e.l,e.a,e.b,e.opacity);if(e instanceof Hcl)return hcl2lab(e);if(!(e instanceof Rgb))e=rgbConvert(e);var t=rgb2lrgb(e.r),n=rgb2lrgb(e.g),r=rgb2lrgb(e.b),i=xyz2lab((.2225045*t+.7168786*n+.0606169*r)/Yn),a,o;if(t===n&&n===r)a=o=i;else{a=xyz2lab((.4360747*t+.3850649*n+.1430804*r)/Xn);o=xyz2lab((.0139322*t+.0971045*n+.7141733*r)/Zn)}return new Lab(116*i-16,500*(a-i),200*(i-o),e.opacity)}function lab$1(e,t,n,r){return arguments.length===1?labConvert(e):new Lab(e,t,n,r==null?1:r)}function Lab(e,t,n,r){this.l=+e;this.a=+t;this.b=+n;this.opacity=+r}define(Lab,lab$1,extend(Color,{brighter:function(e){return new Lab(this.l+K*(e==null?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Lab(this.l-K*(e==null?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;t=Xn*lab2xyz(t);e=Yn*lab2xyz(e);n=Zn*lab2xyz(n);return new Rgb(lrgb2rgb(3.1338561*t-1.6168667*e-.4906146*n),lrgb2rgb(-.9787684*t+1.9161415*e+.033454*n),lrgb2rgb(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function xyz2lab(e){return e>t3?Math.pow(e,1/3):e/t2+t0}function lab2xyz(e){return e>t1?e*e*e:t2*(e-t0)}function lrgb2rgb(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function rgb2lrgb(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function hclConvert(e){if(e instanceof Hcl)return new Hcl(e.h,e.c,e.l,e.opacity);if(!(e instanceof Lab))e=labConvert(e);if(e.a===0&&e.b===0)return new Hcl(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*degrees$2;return new Hcl(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function hcl$2(e,t,n,r){return arguments.length===1?hclConvert(e):new Hcl(e,t,n,r==null?1:r)}function Hcl(e,t,n,r){this.h=+e;this.c=+t;this.l=+n;this.opacity=+r}function hcl2lab(e){if(isNaN(e.h))return new Lab(e.l,0,0,e.opacity);var t=e.h*radians$1;return new Lab(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}define(Hcl,hcl$2,extend(Color,{brighter:function(e){return new Hcl(this.h,this.c,this.l+K*(e==null?1:e),this.opacity)},darker:function(e){return new Hcl(this.h,this.c,this.l-K*(e==null?1:e),this.opacity)},rgb:function(){return hcl2lab(this).rgb()}}));var A=-.14861,B=+1.78277,C$1=-.29227,D=-.90649,E=+1.97294,ED=E*D,EB=E*B,BC_DA=B*C$1-D*A;function cubehelixConvert(e){if(e instanceof Cubehelix)return new Cubehelix(e.h,e.s,e.l,e.opacity);if(!(e instanceof Rgb))e=rgbConvert(e);var t=e.r/255,n=e.g/255,r=e.b/255,i=(BC_DA*r+ED*t-EB*n)/(BC_DA+ED-EB),a=r-i,o=(E*(n-i)-C$1*a)/D,s=Math.sqrt(o*o+a*a)/(E*i*(1-i)),u=s?Math.atan2(o,a)*degrees$2-120:NaN;return new Cubehelix(u<0?u+360:u,s,i,e.opacity)}function cubehelix$2(e,t,n,r){return arguments.length===1?cubehelixConvert(e):new Cubehelix(e,t,n,r==null?1:r)}function Cubehelix(e,t,n,r){this.h=+e;this.s=+t;this.l=+n;this.opacity=+r}define(Cubehelix,cubehelix$2,extend(Color,{brighter:function(e){e=e==null?brighter:Math.pow(brighter,e);return new Cubehelix(this.h,this.s,this.l*e,this.opacity)},darker:function(e){e=e==null?darker:Math.pow(darker,e);return new Cubehelix(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*radians$1,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Rgb(255*(t+n*(A*r+B*i)),255*(t+n*(C$1*r+D*i)),255*(t+n*(E*r)),this.opacity)}}));function basis(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function basis$1(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return basis((n-r/t)*t,o,i,a,s)}}function basisClosed(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return basis((n-r/t)*t,i,a,o,s)}}var constant$2=function(e){return function(){return e}};function linear$1(e,t){return function(n){return e+n*t}}function exponential(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function hue$1(e,t){var n=t-e;return n?linear$1(e,n>180||n<-180?n-360*Math.round(n/360):n):constant$2(isNaN(e)?t:e)}function gamma(e){return(e=+e)===1?nogamma:function(t,n){return n-t?exponential(t,n,e):constant$2(isNaN(t)?n:t)}}function nogamma(e,t){var n=t-e;return n?linear$1(e,n):constant$2(isNaN(e)?t:e)}var rgb=function e(t){var n=gamma(t);function r(e,t){var r=n((e=rgb$1(e)).r,(t=rgb$1(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=nogamma(e.opacity,t.opacity);return function(t){e.r=r(t);e.g=i(t);e.b=a(t);e.opacity=o(t);return e+""}}r.gamma=e;return r}(1);function rgbSpline(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),a=new Array(n),o,s;for(o=0;o<n;++o){s=rgb$1(t[o]);r[o]=s.r||0;i[o]=s.g||0;a[o]=s.b||0}r=e(r);i=e(i);a=e(a);s.opacity=1;return function(e){s.r=r(e);s.g=i(e);s.b=a(e);return s+""}}}var rgbBasis=rgbSpline(basis$1);var rgbBasisClosed=rgbSpline(basisClosed);function numberArray(e,t){if(!t)t=[];var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=e[i]*(1-a)+t[i]*a;return r}}function isNumberArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function array$3(e,t){return(isNumberArray(t)?numberArray:genericArray)(e,t)}function genericArray(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=interpolate$1$1(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(e){for(o=0;o<r;++o)a[o]=i[o](e);return a}}function date$1(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function interpolateNumber(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function object(e,t){var n={},r={},i;if(e===null||typeof e!=="object")e={};if(t===null||typeof t!=="object")t={};for(i in t){if(i in e){n[i]=interpolate$1$1(e[i],t[i])}else{r[i]=t[i]}}return function(e){for(i in n)r[i]=n[i](e);return r}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero$2(e){return function(){return e}}function one$1(e){return function(t){return e(t)+""}}function string(e,t){var n=reA.lastIndex=reB.lastIndex=0,r,i,a,o=-1,s=[],u=[];e=e+"",t=t+"";while((r=reA.exec(e))&&(i=reB.exec(t))){if((a=i.index)>n){a=t.slice(n,a);if(s[o])s[o]+=a;else s[++o]=a}if((r=r[0])===(i=i[0])){if(s[o])s[o]+=i;else s[++o]=i}else{s[++o]=null;u.push({i:o,x:interpolateNumber(r,i)})}n=reB.lastIndex}if(n<t.length){a=t.slice(n);if(s[o])s[o]+=a;else s[++o]=a}return s.length<2?u[0]?one$1(u[0].x):zero$2(t):(t=u.length,function(e){for(var n=0,r;n<t;++n)s[(r=u[n]).i]=r.x(e);return s.join("")})}function interpolate$1$1(e,t){var n=typeof t,r;return t==null||n==="boolean"?constant$2(t):(n==="number"?interpolateNumber:n==="string"?(r=color$3(t))?(t=r,rgb):string:t instanceof color$3?rgb:t instanceof Date?date$1:isNumberArray(t)?numberArray:Array.isArray(t)?genericArray:typeof t.valueOf!=="function"&&typeof t.toString!=="function"||isNaN(t)?object:interpolateNumber)(e,t)}function discrete$1(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function hue(e,t){var n=hue$1(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}}function interpolateRound(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var degrees$1=180/Math.PI;var identity$3={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(e,t,n,r,i,a){var o,s,u;if(o=Math.sqrt(e*e+t*t))e/=o,t/=o;if(u=e*n+t*r)n-=e*u,r-=t*u;if(s=Math.sqrt(n*n+r*r))n/=s,r/=s,u/=s;if(e*r<t*n)e=-e,t=-t,u=-u,o=-o;return{translateX:i,translateY:a,rotate:Math.atan2(t,e)*degrees$1,skewX:Math.atan(u)*degrees$1,scaleX:o,scaleY:s}}var svgNode;function parseCss(e){var t=new(typeof DOMMatrix==="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?identity$3:decompose(t.a,t.b,t.c,t.d,t.e,t.f)}function parseSvg(e){if(e==null)return identity$3;if(!svgNode)svgNode=document.createElementNS("http://www.w3.org/2000/svg","g");svgNode.setAttribute("transform",e);if(!(e=svgNode.transform.baseVal.consolidate()))return identity$3;e=e.matrix;return decompose(e.a,e.b,e.c,e.d,e.e,e.f)}function interpolateTransform(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}function a(e,r,i,a,o,s){if(e!==i||r!==a){var u=o.push("translate(",null,t,null,n);s.push({i:u-4,x:interpolateNumber(e,i)},{i:u-2,x:interpolateNumber(r,a)})}else if(i||a){o.push("translate("+i+t+a+n)}}function o(e,t,n,a){if(e!==t){if(e-t>180)t+=360;else if(t-e>180)e+=360;a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:interpolateNumber(e,t)})}else if(t){n.push(i(n)+"rotate("+t+r)}}function s(e,t,n,a){if(e!==t){a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:interpolateNumber(e,t)})}else if(t){n.push(i(n)+"skewX("+t+r)}}function u(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:interpolateNumber(e,n)},{i:s-2,x:interpolateNumber(t,r)})}else if(n!==1||r!==1){a.push(i(a)+"scale("+n+","+r+")")}}return function(t,n){var r=[],i=[];t=e(t),n=e(n);a(t.translateX,t.translateY,n.translateX,n.translateY,r,i);o(t.rotate,n.rotate,r,i);s(t.skewX,n.skewX,r,i);u(t.scaleX,t.scaleY,n.scaleX,n.scaleY,r,i);t=n=null;return function(e){var t=-1,n=i.length,a;while(++t<n)r[(a=i[t]).i]=a.x(e);return r.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)");var interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");var epsilon2$1=1e-12;function cosh(e){return((e=Math.exp(e))+1/e)/2}function sinh(e){return((e=Math.exp(e))-1/e)/2}function tanh(e){return((e=Math.exp(2*e))-1)/(e+1)}var zoom$1=function e(t,n,r){function i(e,i){var a=e[0],o=e[1],s=e[2],u=i[0],l=i[1],f=i[2],c=u-a,d=l-o,p=c*c+d*d,h,g;if(p<epsilon2$1){g=Math.log(f/s)/t;h=function(e){return[a+e*c,o+e*d,s*Math.exp(t*e*g)]}}else{var m=Math.sqrt(p),v=(f*f-s*s+r*p)/(2*s*n*m),y=(f*f-s*s-r*p)/(2*f*n*m),_=Math.log(Math.sqrt(v*v+1)-v),b=Math.log(Math.sqrt(y*y+1)-y);g=(b-_)/t;h=function(e){var r=e*g,i=cosh(_),u=s/(n*m)*(i*tanh(t*r+_)-sinh(_));return[a+u*c,o+u*d,s*i/cosh(t*r+_)]}}h.duration=g*1e3*t/Math.SQRT2;return h}i.rho=function(t){var n=Math.max(.001,+t),r=n*n,i=r*r;return e(n,r,i)};return i}(Math.SQRT2,2,4);function hsl(e){return function(t,n){var r=e((t=hsl$2(t)).h,(n=hsl$2(n)).h),i=nogamma(t.s,n.s),a=nogamma(t.l,n.l),o=nogamma(t.opacity,n.opacity);return function(e){t.h=r(e);t.s=i(e);t.l=a(e);t.opacity=o(e);return t+""}}}var hsl$1=hsl(hue$1);var hslLong=hsl(nogamma);function lab(e,t){var n=nogamma((e=lab$1(e)).l,(t=lab$1(t)).l),r=nogamma(e.a,t.a),i=nogamma(e.b,t.b),a=nogamma(e.opacity,t.opacity);return function(t){e.l=n(t);e.a=r(t);e.b=i(t);e.opacity=a(t);return e+""}}function hcl(e){return function(t,n){var r=e((t=hcl$2(t)).h,(n=hcl$2(n)).h),i=nogamma(t.c,n.c),a=nogamma(t.l,n.l),o=nogamma(t.opacity,n.opacity);return function(e){t.h=r(e);t.c=i(e);t.l=a(e);t.opacity=o(e);return t+""}}}var hcl$1=hcl(hue$1);var hclLong=hcl(nogamma);function cubehelix(e){return function t(n){n=+n;function r(t,r){var i=e((t=cubehelix$2(t)).h,(r=cubehelix$2(r)).h),a=nogamma(t.s,r.s),o=nogamma(t.l,r.l),s=nogamma(t.opacity,r.opacity);return function(e){t.h=i(e);t.s=a(e);t.l=o(Math.pow(e,n));t.opacity=s(e);return t+""}}r.gamma=t;return r}(1)}var cubehelix$1=cubehelix(hue$1);var cubehelixLong=cubehelix(nogamma);function piecewise(e,t){if(t===undefined)t=e,e=interpolate$1$1;var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);while(n<r)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}function quantize$2(e,t){var n=new Array(t);for(var r=0;r<t;++r)n[r]=e(r/(t-1));return n}var $=Object.freeze({__proto__:null,interpolate:interpolate$1$1,interpolateArray:array$3,interpolateBasis:basis$1,interpolateBasisClosed:basisClosed,interpolateDate:date$1,interpolateDiscrete:discrete$1,interpolateHue:hue,interpolateNumber:interpolateNumber,interpolateNumberArray:numberArray,interpolateObject:object,interpolateRound:interpolateRound,interpolateString:string,interpolateTransformCss:interpolateTransformCss,interpolateTransformSvg:interpolateTransformSvg,interpolateZoom:zoom$1,interpolateRgb:rgb,interpolateRgbBasis:rgbBasis,interpolateRgbBasisClosed:rgbBasisClosed,interpolateHsl:hsl$1,interpolateHslLong:hslLong,interpolateLab:lab,interpolateHcl:hcl$1,interpolateHclLong:hclLong,interpolateCubehelix:cubehelix$1,interpolateCubehelixLong:cubehelixLong,piecewise:piecewise,quantize:quantize$2});function constants(e){return function(){return e}}function number$5(e){return+e}var unit=[0,1];function identity$2(e){return e}function normalize$1(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:constants(isNaN(t)?NaN:.5)}function clamper(e,t){var n;if(e>t)n=e,e=t,t=n;return function(n){return Math.max(e,Math.min(t,n))}}function bimap(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];if(i<r)r=normalize$1(i,r),a=n(o,a);else r=normalize$1(r,i),a=n(a,o);return function(e){return a(r(e))}}function polymap(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;if(e[r]<e[0]){e=e.slice().reverse();t=t.slice().reverse()}while(++o<r){i[o]=normalize$1(e[o],e[o+1]);a[o]=n(t[o],t[o+1])}return function(t){var n=bisectRight$1(e,t,1,r)-1;return a[n](i[n](t))}}function copy$2(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function transformer$3(){var e=unit,t=unit,n=interpolate$1$1,r,i,a,o=identity$2,s,u,l;function f(){var n=Math.min(e.length,t.length);if(o!==identity$2)o=clamper(e[0],e[n-1]);s=n>2?polymap:bimap;u=l=null;return c}function c(i){return i==null||isNaN(i=+i)?a:(u||(u=s(e.map(r),t,n)))(r(o(i)))}c.invert=function(n){return o(i((l||(l=s(t,e.map(r),interpolateNumber)))(n)))};c.domain=function(t){return arguments.length?(e=Array.from(t,number$5),f()):e.slice()};c.range=function(e){return arguments.length?(t=Array.from(e),f()):t.slice()};c.rangeRound=function(e){return t=Array.from(e),n=interpolateRound,f()};c.clamp=function(e){return arguments.length?(o=e?true:identity$2,f()):o!==identity$2};c.interpolate=function(e){return arguments.length?(n=e,f()):n};c.unknown=function(e){return arguments.length?(a=e,c):a};return function(e,t){r=e,i=t;return f()}}function continuous$1(){return transformer$3()(identity$2,identity$2)}function tickFormat$1(e,t,n,r){var i=tickStep(e,t,n),a;r=formatSpecifier(r==null?",f":r);switch(r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));if(r.precision==null&&!isNaN(a=precisionPrefix(i,o)))r.precision=a;return formatPrefix(r,o)}case"":case"e":case"g":case"p":case"r":{if(r.precision==null&&!isNaN(a=precisionRound(i,Math.max(Math.abs(e),Math.abs(t)))))r.precision=a-(r.type==="e");break}case"f":case"%":{if(r.precision==null&&!isNaN(a=precisionFixed(i)))r.precision=a-(r.type==="%")*2;break}}return format$2(r)}function linearish(e){var t=e.domain;e.ticks=function(e){var n=t();return ticks(n[0],n[n.length-1],e==null?10:e)};e.tickFormat=function(e,n){var r=t();return tickFormat$1(r[0],r[r.length-1],e==null?10:e,n)};e.nice=function(n){if(n==null)n=10;var r=t();var i=0;var a=r.length-1;var o=r[i];var s=r[a];var u;var l;var f=10;if(s<o){l=o,o=s,s=l;l=i,i=a,a=l}while(f-- >0){l=tickIncrement(o,s,n);if(l===u){r[i]=o;r[a]=s;return t(r)}else if(l>0){o=Math.floor(o/l)*l;s=Math.ceil(s/l)*l}else if(l<0){o=Math.ceil(o*l)/l;s=Math.floor(s*l)/l}else{break}u=l}return e};return e}function linear(){var e=continuous$1();e.copy=function(){return copy$2(e,linear())};initRange.apply(e,arguments);return linearish(e)}function identity$1(e){var t;function n(e){return e==null||isNaN(e=+e)?t:e}n.invert=n;n.domain=n.range=function(t){return arguments.length?(e=Array.from(t,number$5),n):e.slice()};n.unknown=function(e){return arguments.length?(t=e,n):t};n.copy=function(){return identity$1(e).unknown(t)};e=arguments.length?Array.from(e,number$5):[0,1];return linearish(n)}function nice$1(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],a=e[r],o;if(a<i){o=n,n=r,r=o;o=i,i=a,a=o}e[n]=t.floor(i);e[r]=t.ceil(a);return e}function transformLog(e){return Math.log(e)}function transformExp(e){return Math.exp(e)}function transformLogn(e){return-Math.log(-e)}function transformExpn(e){return-Math.exp(-e)}function pow10(e){return isFinite(e)?+("1e"+e):e<0?0:e}function powp(e){return e===10?pow10:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function logp(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function reflect(e){return function(t){return-e(-t)}}function loggish(e){var t=e(transformLog,transformExp),n=t.domain,r=10,i,a;function o(){i=logp(r),a=powp(r);if(n()[0]<0){i=reflect(i),a=reflect(a);e(transformLogn,transformExpn)}else{e(transformLog,transformExp)}return t}t.base=function(e){return arguments.length?(r=+e,o()):r};t.domain=function(e){return arguments.length?(n(e),o()):n()};t.ticks=function(e){var t=n(),o=t[0],s=t[t.length-1],u;if(u=s<o)l=o,o=s,s=l;var l=i(o),f=i(s),c,d,p,h=e==null?10:+e,g=[];if(!(r%1)&&f-l<h){l=Math.floor(l),f=Math.ceil(f);if(o>0)for(;l<=f;++l){for(d=1,c=a(l);d<r;++d){p=c*d;if(p<o)continue;if(p>s)break;g.push(p)}}else for(;l<=f;++l){for(d=r-1,c=a(l);d>=1;--d){p=c*d;if(p<o)continue;if(p>s)break;g.push(p)}}if(g.length*2<h)g=ticks(o,s,h)}else{g=ticks(l,f,Math.min(f-l,h)).map(a)}return u?g.reverse():g};t.tickFormat=function(e,n){if(n==null)n=r===10?".0e":",";if(typeof n!=="function")n=format$2(n);if(e===Infinity)return n;if(e==null)e=10;var o=Math.max(1,r*e/t.ticks().length);return function(e){var t=e/a(Math.round(i(e)));if(t*r<r-.5)t*=r;return t<=o?n(e):""}};t.nice=function(){return n(nice$1(n(),{floor:function(e){return a(Math.floor(i(e)))},ceil:function(e){return a(Math.ceil(i(e)))}}))};return t}function log$2(){var e=loggish(transformer$3()).domain([1,10]);e.copy=function(){return copy$2(e,log$2()).base(e.base())};initRange.apply(e,arguments);return e}function transformSymlog(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function transformSymexp(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function symlogish(e){var t=1,n=e(transformSymlog(t),transformSymexp(t));n.constant=function(n){return arguments.length?e(transformSymlog(t=+n),transformSymexp(t)):t};return linearish(n)}function symlog(){var e=symlogish(transformer$3());e.copy=function(){return copy$2(e,symlog()).constant(e.constant())};return initRange.apply(e,arguments)}function transformPow(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function transformSqrt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function transformSquare(e){return e<0?-e*e:e*e}function powish(e){var t=e(identity$2,identity$2),n=1;function r(){return n===1?e(identity$2,identity$2):n===.5?e(transformSqrt,transformSquare):e(transformPow(n),transformPow(1/n))}t.exponent=function(e){return arguments.length?(n=+e,r()):n};return linearish(t)}function pow$2(){var e=powish(transformer$3());e.copy=function(){return copy$2(e,pow$2()).exponent(e.exponent())};initRange.apply(e,arguments);return e}function sqrt$2(){return pow$2.apply(null,arguments).exponent(.5)}function quantile(){var e=[],t=[],n=[],r;function i(){var r=0,i=Math.max(1,t.length);n=new Array(i-1);while(++r<i)n[r-1]=quantileSorted(e,r/i);return a}function a(e){return e==null||isNaN(e=+e)?r:t[bisectRight$1(n,e)]}a.invertExtent=function(r){var i=t.indexOf(r);return i<0?[NaN,NaN]:[i>0?n[i-1]:e[0],i<n.length?n[i]:e[e.length-1]]};a.domain=function(t){if(!arguments.length)return e.slice();e=[];for(var n=0,r=t;n<r.length;n++){var a=r[n];if(a!=null&&!isNaN(a=+a))e.push(a)}e.sort(ascending$2);return i()};a.range=function(e){return arguments.length?(t=Array.from(e),i()):t.slice()};a.unknown=function(e){return arguments.length?(r=e,a):r};a.quantiles=function(){return n.slice()};a.copy=function(){return quantile().domain(e).range(t).unknown(r)};return initRange.apply(a,arguments)}function quantize$1(){var e=0,t=1,n=1,r=[.5],i=[0,1],a;function o(e){return e!=null&&e<=e?i[bisectRight$1(r,e,0,n)]:a}function s(){var i=-1;r=new Array(n);while(++i<n)r[i]=((i+1)*t-(i-n)*e)/(n+1);return o}o.domain=function(n){return arguments.length?(e=n[0],t=n[1],e=+e,t=+t,s()):[e,t]};o.range=function(e){return arguments.length?(n=(i=Array.from(e)).length-1,s()):i.slice()};o.invertExtent=function(a){var o=i.indexOf(a);return o<0?[NaN,NaN]:o<1?[e,r[0]]:o>=n?[r[n-1],t]:[r[o-1],r[o]]};o.unknown=function(e){return arguments.length?(a=e,o):o};o.thresholds=function(){return r.slice()};o.copy=function(){return quantize$1().domain([e,t]).range(i).unknown(a)};return initRange.apply(linearish(o),arguments)}function threshold(){var e=[.5],t=[0,1],n,r=1;function i(i){return i!=null&&i<=i?t[bisectRight$1(e,i,0,r)]:n}i.domain=function(n){return arguments.length?(e=Array.from(n),r=Math.min(e.length,t.length-1),i):e.slice()};i.range=function(n){return arguments.length?(t=Array.from(n),r=Math.min(e.length,t.length-1),i):t.slice()};i.invertExtent=function(n){var r=t.indexOf(n);return[e[r-1],e[r]]};i.unknown=function(e){return arguments.length?(n=e,i):n};i.copy=function(){return threshold().domain(e).range(t).unknown(n)};return initRange.apply(i,arguments)}function date(e){return new Date(e)}function number$4(e){return e instanceof Date?+e:+new Date(+e)}function calendar(e,t,n,r,i,a,o,s,u,l){var f=continuous$1(),c=f.invert,d=f.domain;var p=l(".%L"),h=l(":%S"),g=l("%I:%M"),m=l("%I %p"),v=l("%a %d"),y=l("%b %d"),_=l("%B"),b=l("%Y");function x(e){return(u(e)<e?p:s(e)<e?h:o(e)<e?g:a(e)<e?m:r(e)<e?i(e)<e?v:y:n(e)<e?_:b)(e)}f.invert=function(e){return new Date(c(e))};f.domain=function(e){return arguments.length?d(Array.from(e,number$4)):d().map(date)};f.ticks=function(t){var n=d();return e(n[0],n[n.length-1],t==null?10:t)};f.tickFormat=function(e,t){return t==null?x:l(t)};f.nice=function(e){var n=d();if(!e||typeof e.range!=="function")e=t(n[0],n[n.length-1],e==null?10:e);return e?d(nice$1(n,e)):f};f.copy=function(){return copy$2(f,calendar(e,t,n,r,i,a,o,s,u,l))};return f}function time$1(){return initRange.apply(calendar(timeTicks,timeTickInterval,year,month,sunday,day,hour,minute,second,timeFormat$2).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function utcTime(){return initRange.apply(calendar(utcTicks,utcTickInterval,utcYear,utcMonth,utcSunday,utcDay,utcHour,utcMinute,second,utcFormat$1).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function transformer$2(){var e=0,t=1,n,r,i,a,o=identity$2,s=false,u;function l(e){return e==null||isNaN(e=+e)?u:o(i===0?.5:(e=(a(e)-n)*i,s?Math.max(0,Math.min(1,e)):e))}l.domain=function(o){return arguments.length?(e=o[0],t=o[1],n=a(e=+e),r=a(t=+t),i=n===r?0:1/(r-n),l):[e,t]};l.clamp=function(e){return arguments.length?(s=!!e,l):s};l.interpolator=function(e){return arguments.length?(o=e,l):o};function f(e){return function(t){var n,r;return arguments.length?(n=t[0],r=t[1],o=e(n,r),l):[o(0),o(1)]}}l.range=f(interpolate$1$1);l.rangeRound=f(interpolateRound);l.unknown=function(e){return arguments.length?(u=e,l):u};return function(o){a=o,n=o(e),r=o(t),i=n===r?0:1/(r-n);return l}}function copy$1(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function sequential(){var e=linearish(transformer$2()(identity$2));e.copy=function(){return copy$1(e,sequential())};return initInterpolator.apply(e,arguments)}function sequentialLog(){var e=loggish(transformer$2()).domain([1,10]);e.copy=function(){return copy$1(e,sequentialLog()).base(e.base())};return initInterpolator.apply(e,arguments)}function sequentialSymlog(){var e=symlogish(transformer$2());e.copy=function(){return copy$1(e,sequentialSymlog()).constant(e.constant())};return initInterpolator.apply(e,arguments)}function sequentialPow(){var e=powish(transformer$2());e.copy=function(){return copy$1(e,sequentialPow()).exponent(e.exponent())};return initInterpolator.apply(e,arguments)}function sequentialSqrt(){return sequentialPow.apply(null,arguments).exponent(.5)}function transformer$1(){var e=0,t=.5,n=1,r=1,i,a,o,s,u,l=identity$2,f,c=false,d;function p(e){return isNaN(e=+e)?d:(e=.5+((e=+f(e))-a)*(r*e<r*a?s:u),l(c?Math.max(0,Math.min(1,e)):e))}p.domain=function(l){return arguments.length?(e=l[0],t=l[1],n=l[2],i=f(e=+e),a=f(t=+t),o=f(n=+n),s=i===a?0:.5/(a-i),u=a===o?0:.5/(o-a),r=a<i?-1:1,p):[e,t,n]};p.clamp=function(e){return arguments.length?(c=!!e,p):c};p.interpolator=function(e){return arguments.length?(l=e,p):l};function h(e){return function(t){var n,r,i;return arguments.length?(n=t[0],r=t[1],i=t[2],l=piecewise(e,[n,r,i]),p):[l(0),l(.5),l(1)]}}p.range=h(interpolate$1$1);p.rangeRound=h(interpolateRound);p.unknown=function(e){return arguments.length?(d=e,p):d};return function(l){f=l,i=l(e),a=l(t),o=l(n),s=i===a?0:.5/(a-i),u=a===o?0:.5/(o-a),r=a<i?-1:1;return p}}function diverging(){var e=linearish(transformer$1()(identity$2));e.copy=function(){return copy$1(e,diverging())};return initInterpolator.apply(e,arguments)}function divergingLog(){var e=loggish(transformer$1()).domain([.1,1,10]);e.copy=function(){return copy$1(e,divergingLog()).base(e.base())};return initInterpolator.apply(e,arguments)}function divergingSymlog(){var e=symlogish(transformer$1());e.copy=function(){return copy$1(e,divergingSymlog()).constant(e.constant())};return initInterpolator.apply(e,arguments)}function divergingPow(){var e=powish(transformer$1());e.copy=function(){return copy$1(e,divergingPow()).exponent(e.exponent())};return initInterpolator.apply(e,arguments)}function divergingSqrt(){return divergingPow.apply(null,arguments).exponent(.5)}function bandSpace(e,t,n){var r=e-t+n*2;return e?r>0?r:1:0}var Identity="identity";var Linear="linear";var Log="log";var Pow="pow";var Sqrt="sqrt";var Symlog="symlog";var Time="time";var UTC="utc";var Sequential="sequential";var Diverging="diverging";var Quantile="quantile";var Quantize="quantize";var Threshold="threshold";var Ordinal="ordinal";var Point="point";var Band="band";var BinOrdinal="bin-ordinal";var Continuous="continuous";var Discrete$1="discrete";var Discretizing="discretizing";var Interpolating="interpolating";var Temporal="temporal";function invertRange(e){return function(t){var n=t[0],r=t[1],i;if(r<n){i=n;n=r;r=i}return[e.invert(n),e.invert(r)]}}function invertRangeExtent(e){return function(t){var n=e.range();var r=t[0],i=t[1],a=-1,o,s,u,l;if(i<r){s=r;r=i;i=s}for(u=0,l=n.length;u<l;++u){if(n[u]>=r&&n[u]<=i){if(a<0)a=u;o=u}}if(a<0)return undefined;r=e.invertExtent(n[a]);i=e.invertExtent(n[o]);return[r[0]===undefined?r[1]:r[0],i[1]===undefined?i[0]:i[1]]}}function band(){var e=ordinal().unknown(undefined),t=e.domain,n=e.range;var r=[0,1],i,a,o=false,s=0,u=0,l=.5;delete e.unknown;function f(){var e=t().length,f=r[1]<r[0],c=r[1-f],d=bandSpace(e,s,u);var p=r[f-0];i=(c-p)/(d||1);if(o){i=Math.floor(i)}p+=(c-p-i*(e-s))*l;a=i*(1-s);if(o){p=Math.round(p);a=Math.round(a)}var h=range$1$1(e).map((function(e){return p+i*e}));return n(f?h.reverse():h)}e.domain=function(e){if(arguments.length){t(e);return f()}else{return t()}};e.range=function(e){if(arguments.length){r=[+e[0],+e[1]];return f()}else{return r.slice()}};e.rangeRound=function(e){r=[+e[0],+e[1]];o=true;return f()};e.bandwidth=function(){return a};e.step=function(){return i};e.round=function(e){if(arguments.length){o=!!e;return f()}else{return o}};e.padding=function(e){if(arguments.length){u=Math.max(0,Math.min(1,e));s=u;return f()}else{return s}};e.paddingInner=function(e){if(arguments.length){s=Math.max(0,Math.min(1,e));return f()}else{return s}};e.paddingOuter=function(e){if(arguments.length){u=Math.max(0,Math.min(1,e));return f()}else{return u}};e.align=function(e){if(arguments.length){l=Math.max(0,Math.min(1,e));return f()}else{return l}};e.invertRange=function(e){if(e[0]==null||e[1]==null)return;var i=r[1]<r[0],o=i?n().reverse():n(),s=o.length-1;var u=+e[0],l=+e[1],f,c,d;if(u!==u||l!==l)return;if(l<u){d=u;u=l;l=d}if(l<o[0]||u>r[1-i])return;f=Math.max(0,bisectRight$1(o,u)-1);c=u===l?f:bisectRight$1(o,l)-1;if(u-o[f]>a+1e-10)++f;if(i){d=f;f=s-c;c=s-d}return f>c?undefined:t().slice(f,c+1)};e.invert=function(t){var n=e.invertRange([t,t]);return n?n[0]:n};e.copy=function(){return band().domain(t()).range(r).round(o).paddingInner(s).paddingOuter(u).align(l)};return f()}function pointish(e){var t=e.copy;e.padding=e.paddingOuter;delete e.paddingInner;e.copy=function(){return pointish(t())};return e}function point$3(){return pointish(band().paddingInner(1))}var map=Array.prototype.map;function numbers(e){return map.call(e,toNumber)}var slice$1=Array.prototype.slice;function scaleBinOrdinal(){var e=[],t=[];function n(n){return n==null||n!==n?undefined:t[(bisectRight$1(e,n)-1)%t.length]}n.domain=function(t){if(arguments.length){e=numbers(t);return n}else{return e.slice()}};n.range=function(e){if(arguments.length){t=slice$1.call(e);return n}else{return t.slice()}};n.tickFormat=function(t,n){return tickFormat$1(e[0],peek$1(e),t==null?10:t,n)};n.copy=function(){return scaleBinOrdinal().domain(n.domain()).range(n.range())};return n}var scales={};function create$2(e,t,n){var r=function n(){var r=t();if(!r.invertRange){r.invertRange=r.invert?invertRange(r):r.invertExtent?invertRangeExtent(r):undefined}r.type=e;return r};r.metadata=toSet(array$5(n));return r}function scale$4(e,t,n){if(arguments.length>1){scales[e]=create$2(e,t,n);return this}else{return isValidScaleType(e)?scales[e]:undefined}}scale$4(Identity,identity$1);scale$4(Linear,linear,Continuous);scale$4(Log,log$2,[Continuous,Log]);scale$4(Pow,pow$2,Continuous);scale$4(Sqrt,sqrt$2,Continuous);scale$4(Symlog,symlog,Continuous);scale$4(Time,time$1,[Continuous,Temporal]);scale$4(UTC,utcTime,[Continuous,Temporal]);scale$4(Sequential,sequential,[Continuous,Interpolating]);scale$4("".concat(Sequential,"-").concat(Linear),sequential,[Continuous,Interpolating]);scale$4("".concat(Sequential,"-").concat(Log),sequentialLog,[Continuous,Interpolating,Log]);scale$4("".concat(Sequential,"-").concat(Pow),sequentialPow,[Continuous,Interpolating]);scale$4("".concat(Sequential,"-").concat(Sqrt),sequentialSqrt,[Continuous,Interpolating]);scale$4("".concat(Sequential,"-").concat(Symlog),sequentialSymlog,[Continuous,Interpolating]);scale$4("".concat(Diverging,"-").concat(Linear),diverging,[Continuous,Interpolating]);scale$4("".concat(Diverging,"-").concat(Log),divergingLog,[Continuous,Interpolating,Log]);scale$4("".concat(Diverging,"-").concat(Pow),divergingPow,[Continuous,Interpolating]);scale$4("".concat(Diverging,"-").concat(Sqrt),divergingSqrt,[Continuous,Interpolating]);scale$4("".concat(Diverging,"-").concat(Symlog),divergingSymlog,[Continuous,Interpolating]);scale$4(Quantile,quantile,[Discretizing,Quantile]);scale$4(Quantize,quantize$1,Discretizing);scale$4(Threshold,threshold,Discretizing);scale$4(BinOrdinal,scaleBinOrdinal,[Discrete$1,Discretizing]);scale$4(Ordinal,ordinal,Discrete$1);scale$4(Band,band,Discrete$1);scale$4(Point,point$3,Discrete$1);function isValidScaleType(e){return has$1(scales,e)}function hasType(e,t){var n=scales[e];return n&&n.metadata[t]}function isContinuous(e){return hasType(e,Continuous)}function isDiscrete$1(e){return hasType(e,Discrete$1)}function isDiscretizing$1(e){return hasType(e,Discretizing)}function isLogarithmic(e){return hasType(e,Log)}function isTemporal(e){return hasType(e,Temporal)}function isInterpolating(e){return hasType(e,Interpolating)}function isQuantile$1(e){return hasType(e,Quantile)}var scaleProps=["clamp","base","constant","exponent"];function interpolateRange$1(e,t){var n=t[0],r=peek$1(t)-n;return function(t){return e(n+t*r)}}function interpolateColors(e,t,n){return piecewise(interpolate$1(t||"rgb",n),e)}function quantizeInterpolator(e,t){var n=new Array(t),r=t+1;for(var i=0;i<t;)n[i]=e(++i/r);return n}function scaleFraction(e,t,n){var r=n-t;var i,a,o;if(!r||!Number.isFinite(r)){return constant$4(.5)}else{i=(a=e.type).indexOf("-");a=i<0?a:a.slice(i+1);o=scale$4(a)().domain([t,n]).range([0,1]);scaleProps.forEach((function(t){return e[t]?o[t](e[t]()):0}));return o}}function interpolate$1(e,t){var n=$[method(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function method(e){return"interpolate"+e.toLowerCase().split("-").map((function(e){return e[0].toUpperCase()+e.slice(1)})).join("")}var continuous={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"};var discrete={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function colors(e){var t=e.length/6|0,n=new Array(t);for(var r=0;r<t;){n[r]="#"+e.slice(r*6,++r*6)}return n}function apply(e,t){for(var n in e)scheme$1(n,t(e[n]))}var schemes={};apply(discrete,colors);apply(continuous,(function(e){return interpolateColors(colors(e))}));function scheme$1(e,t){e=e&&e.toLowerCase();if(arguments.length>1){schemes[e]=t;return this}else{return schemes[e]}}var SymbolLegend="symbol";var DiscreteLegend="discrete";var GradientLegend="gradient";var defaultFormatter=function(e){return isArray(e)?e.map((function(e){return String(e)})):String(e)};var ascending$1=function(e,t){return e[1]-t[1]};var descending=function(e,t){return t[1]-e[1]};function tickCount(e,t,n){var r;if(isNumber$1(t)){if(e.bins){t=Math.max(t,e.bins.length)}if(n!=null){t=Math.min(t,Math.floor(span(e.domain())/n||1))}}if(isObject(t)){r=t.step;t=t.interval}if(isString(t)){t=e.type===Time?timeInterval(t):e.type==UTC?utcInterval(t):error("Only time and utc scales accept interval strings.");if(r)t=t.every(r)}return t}function validTicks(e,t,n){var r=e.range(),i=r[0],a=peek$1(r),o=ascending$1;if(i>a){r=a;a=i;i=r;o=descending}i=Math.floor(i);a=Math.ceil(a);t=t.map((function(t){return[t,e(t)]})).filter((function(e){return i<=e[1]&&e[1]<=a})).sort(o).map((function(e){return e[0]}));if(n>0&&t.length>1){var s=[t[0],peek$1(t)];while(t.length>n&&t.length>=3){t=t.filter((function(e,t){return!(t%2)}))}if(t.length<3){t=s}}return t}function tickValues(e,t){return e.bins?validTicks(e,e.bins):e.ticks?e.ticks(t):e.domain()}function tickFormat(e,t,n,r,i,a){var o=t.type;var s=defaultFormatter;if(o===Time||i===Time){s=e.timeFormat(r)}else if(o===UTC||i===UTC){s=e.utcFormat(r)}else if(isLogarithmic(o)){var u=e.formatFloat(r);if(a||t.bins){s=u}else{var l=tickLog(t,n,false);s=function(e){return l(e)?u(e):""}}}else if(t.tickFormat){var f=t.domain();s=e.formatSpan(f[0],f[f.length-1],n,r)}else if(r){s=e.format(r)}return s}function tickLog(e,t,n){var r=tickValues(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length);var s=function(e){var t=e/Math.pow(i,Math.round(Math.log(e)/a));if(t*i<i-.5)t*=i;return t<=o};return n?r.filter(s):s}var symbols$2=(_z={},_z[Quantile]="quantiles",_z[Quantize]="thresholds",_z[Threshold]="domain",_z);var formats=(_3={},_3[Quantile]="quantiles",_3[Quantize]="domain",_3);function labelValues(e,t){return e.bins?binValues(e.bins):e.type===Log?tickLog(e,t,true):symbols$2[e.type]?thresholdValues(e[symbols$2[e.type]]()):tickValues(e,t)}function thresholdFormat(e,t,n){var r=t[formats[t.type]](),i=r.length;var a=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o){a=Math.min(a,r[o]-r[o-1])}return e.formatSpan(0,a,3*10,n)}function thresholdValues(e){var t=[-Infinity].concat(e);t.max=+Infinity;return t}function binValues(e){var t=e.slice(0,-1);t.max=peek$1(e);return t}var isDiscreteRange=function(e){return symbols$2[e.type]||e.bins};function labelFormat(e,t,n,r,i,a,o){var s=formats[t.type]&&a!==Time&&a!==UTC?thresholdFormat(e,t,i):tickFormat(e,t,n,i,a,o);return r===SymbolLegend&&isDiscreteRange(t)?formatRange(s):r===DiscreteLegend?formatDiscrete(s):formatPoint(s)}var formatRange=function(e){return function(t,n,r){var i=get$3(r[n+1],get$3(r.max,+Infinity)),a=formatValue$2(t,e),o=formatValue$2(i,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a}};var get$3=function(e,t){return e!=null?e:t};var formatDiscrete=function(e){return function(t,n){return n?e(t):null}};var formatPoint=function(e){return function(t){return e(t)}};var formatValue$2=function(e,t){return Number.isFinite(e)?t(e):null};function labelFraction(e){var t=e.domain(),n=t.length-1;var r=+t[0],i=+peek$1(t),a=i-r;if(e.type===Threshold){var o=n?a/n:.1;r-=o;i+=o;a=i-r}return function(e){return(e-r)/a}}function format$1(e,t,n,r){var i=r||t.type;if(isString(n)&&isTemporal(i)){n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")}return!n&&i===Time?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===UTC?e.utcFormat("%A, %d %B %Y, %X UTC"):labelFormat(e,t,5,null,n,r,true)}function domainCaption(e,t,n){n=n||{};var r=Math.max(3,n.maxlen||7),i=format$1(e,t,n.format,n.formatType);if(isDiscretizing$1(t.type)){var a=labelValues(t).slice(1).map(i),o=a.length;return"".concat(o," boundar").concat(o===1?"y":"ies",": ").concat(a.join(", "))}else if(isDiscrete$1(t.type)){var s=t.domain(),o=s.length,a=o>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return"".concat(o," value").concat(o===1?"":"s",": ").concat(a)}else{var s=t.domain();return"values from ".concat(i(s[0])," to ").concat(i(peek$1(s)))}}var gradient_id=0;function resetSVGGradientId(){gradient_id=0}var patternPrefix="p_";function isGradient(e){return e&&e.gradient}function gradientRef(e,t,n){var r=e.gradient;var i=e.id,a=r==="radial"?patternPrefix:"";if(!i){i=e.id="gradient_"+gradient_id++;if(r==="radial"){e.x1=get$2(e.x1,.5);e.y1=get$2(e.y1,.5);e.r1=get$2(e.r1,0);e.x2=get$2(e.x2,.5);e.y2=get$2(e.y2,.5);e.r2=get$2(e.r2,.5);a=patternPrefix}else{e.x1=get$2(e.x1,0);e.y1=get$2(e.y1,0);e.x2=get$2(e.x2,1);e.y2=get$2(e.y2,0)}}t[i]=e;return"url("+(n||"")+"#"+a+i+")"}function get$2(e,t){return e!=null?e:t}function Gradient$1(e,t){var n=[],r;return r={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(e,t){n.push({offset:e,color:t});return r}}}var lookup$4={basis:{curve:curveBasis},"basis-closed":{curve:curveBasisClosed},"basis-open":{curve:curveBasisOpen},bundle:{curve:curveBundle,tension:"beta",value:.85},cardinal:{curve:curveCardinal,tension:"tension",value:0},"cardinal-open":{curve:curveCardinalOpen,tension:"tension",value:0},"cardinal-closed":{curve:curveCardinalClosed,tension:"tension",value:0},"catmull-rom":{curve:curveCatmullRom,tension:"alpha",value:.5},"catmull-rom-closed":{curve:curveCatmullRomClosed,tension:"alpha",value:.5},"catmull-rom-open":{curve:curveCatmullRomOpen,tension:"alpha",value:.5},linear:{curve:curveLinear},"linear-closed":{curve:curveLinearClosed},monotone:{horizontal:monotoneY,vertical:monotoneX},natural:{curve:curveNatural},step:{curve:curveStep},"step-after":{curve:stepAfter},"step-before":{curve:stepBefore}};function curves(e,t,n){var r=has$1(lookup$4,e)&&lookup$4[e],i=null;if(r){i=r.curve||r[t||"vertical"];if(r.tension&&n!=null){i=i[r.tension](n)}}return i}var cmdlen={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},regexp=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function pathParse(e){var t=[];var n,r,i,a,o,s,u,l,f,c;var d=e.slice().replace(regexp[0],"###$1").split(regexp[1]).slice(1);for(u=0,f=d.length;u<f;++u){n=d[u];r=n.slice(1).trim().replace(regexp[2],"$1###$2").replace(regexp[3],"$1###$2").split(regexp[4]);o=n.charAt(0);i=[o];for(l=0,c=r.length;l<c;++l){if((a=+r[l])===a){i.push(a)}}s=cmdlen[o.toLowerCase()];if(i.length-1>s){var p=i.length;l=1;t.push([o].concat(i.slice(l,l+=s)));o=o==="M"?"L":o==="m"?"l":o;for(;l<p;l+=s){t.push([o].concat(i.slice(l,l+s)))}}else{t.push(i)}}return t}var DegToRad=Math.PI/180;var Epsilon=1e-14;var HalfPi=Math.PI/2;var Tau=Math.PI*2;var HalfSqrt3=Math.sqrt(3)/2;var segmentCache={};var bezierCache={};var join$1=[].join;function segments(e,t,n,r,i,a,o,s,u){var l=join$1.call(arguments);if(segmentCache[l]){return segmentCache[l]}var f=o*DegToRad;var c=Math.sin(f);var d=Math.cos(f);n=Math.abs(n);r=Math.abs(r);var p=d*(s-e)*.5+c*(u-t)*.5;var h=d*(u-t)*.5-c*(s-e)*.5;var g=p*p/(n*n)+h*h/(r*r);if(g>1){g=Math.sqrt(g);n*=g;r*=g}var m=d/n;var v=c/n;var y=-c/r;var _=d/r;var b=m*s+v*u;var x=y*s+_*u;var E=m*e+v*t;var S=y*e+_*t;var $=(E-b)*(E-b)+(S-x)*(S-x);var A=1/$-.25;if(A<0)A=0;var D=Math.sqrt(A);if(a==i)D=-D;var w=.5*(b+E)-D*(S-x);var C=.5*(x+S)+D*(E-b);var T=Math.atan2(x-C,b-w);var k=Math.atan2(S-C,E-w);var O=k-T;if(O<0&&a===1){O+=Tau}else if(O>0&&a===0){O-=Tau}var N=Math.ceil(Math.abs(O/(HalfPi+.001)));var R=[];for(var F=0;F<N;++F){var L=T+F*O/N;var P=T+(F+1)*O/N;R[F]=[w,C,L,P,n,r,c,d]}return segmentCache[l]=R}function bezier(e){var t=join$1.call(e);if(bezierCache[t]){return bezierCache[t]}var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7];var f=l*o;var c=-u*s;var d=u*o;var p=l*s;var h=Math.cos(i);var g=Math.sin(i);var m=Math.cos(a);var v=Math.sin(a);var y=.5*(a-i);var _=Math.sin(y*.5);var b=8/3*_*_/Math.sin(y);var x=n+h-b*g;var E=r+g+b*h;var S=n+m;var $=r+v;var A=S+b*v;var D=$-b*m;return bezierCache[t]=[f*x+c*E,d*x+p*E,f*A+c*D,d*A+p*D,f*S+c*$,d*S+p*$]}var temp=["l",0,0,0,0,0,0,0];function scale$1$1(e,t,n){var r=temp[0]=e[0];if(r==="a"||r==="A"){temp[1]=t*e[1];temp[2]=n*e[2];temp[3]=e[3];temp[4]=e[4];temp[5]=e[5];temp[6]=t*e[6];temp[7]=n*e[7]}else if(r==="h"||r==="H"){temp[1]=t*e[1]}else if(r==="v"||r==="V"){temp[1]=n*e[1]}else{for(var i=1,a=e.length;i<a;++i){temp[i]=(i%2==1?t:n)*e[i]}}return temp}function pathRender(e,t,n,r,i,a){var o,s=null,u=0,l=0,f=0,c=0,d,p,h,g;if(n==null)n=0;if(r==null)r=0;if(i==null)i=1;if(a==null)a=i;if(e.beginPath)e.beginPath();for(var m=0,v=t.length;m<v;++m){o=t[m];if(i!==1||a!==1){o=scale$1$1(o,i,a)}switch(o[0]){case"l":u+=o[1];l+=o[2];e.lineTo(u+n,l+r);break;case"L":u=o[1];l=o[2];e.lineTo(u+n,l+r);break;case"h":u+=o[1];e.lineTo(u+n,l+r);break;case"H":u=o[1];e.lineTo(u+n,l+r);break;case"v":l+=o[1];e.lineTo(u+n,l+r);break;case"V":l=o[1];e.lineTo(u+n,l+r);break;case"m":u+=o[1];l+=o[2];e.moveTo(u+n,l+r);break;case"M":u=o[1];l=o[2];e.moveTo(u+n,l+r);break;case"c":d=u+o[5];p=l+o[6];f=u+o[3];c=l+o[4];e.bezierCurveTo(u+o[1]+n,l+o[2]+r,f+n,c+r,d+n,p+r);u=d;l=p;break;case"C":u=o[5];l=o[6];f=o[3];c=o[4];e.bezierCurveTo(o[1]+n,o[2]+r,f+n,c+r,u+n,l+r);break;case"s":d=u+o[3];p=l+o[4];f=2*u-f;c=2*l-c;e.bezierCurveTo(f+n,c+r,u+o[1]+n,l+o[2]+r,d+n,p+r);f=u+o[1];c=l+o[2];u=d;l=p;break;case"S":d=o[3];p=o[4];f=2*u-f;c=2*l-c;e.bezierCurveTo(f+n,c+r,o[1]+n,o[2]+r,d+n,p+r);u=d;l=p;f=o[1];c=o[2];break;case"q":d=u+o[3];p=l+o[4];f=u+o[1];c=l+o[2];e.quadraticCurveTo(f+n,c+r,d+n,p+r);u=d;l=p;break;case"Q":d=o[3];p=o[4];e.quadraticCurveTo(o[1]+n,o[2]+r,d+n,p+r);u=d;l=p;f=o[1];c=o[2];break;case"t":d=u+o[1];p=l+o[2];if(s[0].match(/[QqTt]/)===null){f=u;c=l}else if(s[0]==="t"){f=2*u-h;c=2*l-g}else if(s[0]==="q"){f=2*u-f;c=2*l-c}h=f;g=c;e.quadraticCurveTo(f+n,c+r,d+n,p+r);u=d;l=p;f=u+o[1];c=l+o[2];break;case"T":d=o[1];p=o[2];f=2*u-f;c=2*l-c;e.quadraticCurveTo(f+n,c+r,d+n,p+r);u=d;l=p;break;case"a":drawArc(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+l+r]);u+=o[6];l+=o[7];break;case"A":drawArc(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]);u=o[6];l=o[7];break;case"z":case"Z":e.closePath();break}s=o}}function drawArc(e,t,n,r){var i=segments(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(var a=0;a<i.length;++a){var o=bezier(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var Tan30=.5773502691896257;var builtins={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0);e.arc(0,0,n,0,Tau)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r);e.lineTo(-n,r);e.lineTo(-r,r);e.lineTo(-r,n);e.lineTo(r,n);e.lineTo(r,r);e.lineTo(n,r);e.lineTo(n,-r);e.lineTo(r,-r);e.lineTo(r,-n);e.lineTo(-r,-n);e.lineTo(-r,-r);e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0);e.lineTo(0,-n);e.lineTo(n,0);e.lineTo(0,n);e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n);e.lineTo(r,n);e.lineTo(r,-a);e.lineTo(i,-a);e.lineTo(0,-n);e.lineTo(-i,-a);e.lineTo(-r,-a);e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=HalfSqrt3*n,i=r-n*Tan30,a=n/4;e.moveTo(0,-r-i);e.lineTo(-a,r-i);e.lineTo(a,r-i);e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=HalfSqrt3*n,i=r-n*Tan30;e.moveTo(0,-r-i);e.lineTo(-n,r-i);e.lineTo(n,r-i);e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=HalfSqrt3*n;e.moveTo(0,-r);e.lineTo(-n,r);e.lineTo(n,r);e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=HalfSqrt3*n;e.moveTo(0,r);e.lineTo(-n,-r);e.lineTo(n,-r);e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=HalfSqrt3*n;e.moveTo(r,0);e.lineTo(-r,-n);e.lineTo(-r,n);e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=HalfSqrt3*n;e.moveTo(-r,0);e.lineTo(r,-n);e.lineTo(r,n);e.closePath()}},stroke:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0);e.lineTo(n,0)}}};function symbols$1(e){return has$1(builtins,e)?builtins[e]:customSymbol(e)}var custom={};function customSymbol(e){if(!has$1(custom,e)){var t=pathParse(e);custom[e]={draw:function(e,n){pathRender(e,t,0,0,Math.sqrt(n)/2)}}}return custom[e]}var C=.448084975506;function rectangleX(e){return e.x}function rectangleY(e){return e.y}function rectangleWidth(e){return e.width}function rectangleHeight(e){return e.height}function number$3(e){return typeof e==="function"?e:function(){return+e}}function clamp(e,t,n){return Math.max(t,Math.min(e,n))}function vg_rect(){var e=rectangleX,t=rectangleY,n=rectangleWidth,r=rectangleHeight,i=number$3(0),a=i,o=i,s=i,u=null;function l(l,f,c){var d,p=f!=null?f:+e.call(this,l),h=c!=null?c:+t.call(this,l),g=+n.call(this,l),m=+r.call(this,l),v=Math.min(g,m)/2,y=clamp(+i.call(this,l),0,v),_=clamp(+a.call(this,l),0,v),b=clamp(+o.call(this,l),0,v),x=clamp(+s.call(this,l),0,v);if(!u)u=d=path$3();if(y<=0&&_<=0&&b<=0&&x<=0){u.rect(p,h,g,m)}else{var E=p+g,S=h+m;u.moveTo(p+y,h);u.lineTo(E-_,h);u.bezierCurveTo(E-C*_,h,E,h+C*_,E,h+_);u.lineTo(E,S-x);u.bezierCurveTo(E,S-C*x,E-C*x,S,E-x,S);u.lineTo(p+b,S);u.bezierCurveTo(p+C*b,S,p,S-C*b,p,S-b);u.lineTo(p,h+y);u.bezierCurveTo(p,h+C*y,p+C*y,h,p+y,h);u.closePath()}if(d){u=null;return d+""||null}}l.x=function(t){if(arguments.length){e=number$3(t);return l}else{return e}};l.y=function(e){if(arguments.length){t=number$3(e);return l}else{return t}};l.width=function(e){if(arguments.length){n=number$3(e);return l}else{return n}};l.height=function(e){if(arguments.length){r=number$3(e);return l}else{return r}};l.cornerRadius=function(e,t,n,r){if(arguments.length){i=number$3(e);a=t!=null?number$3(t):i;s=n!=null?number$3(n):i;o=r!=null?number$3(r):a;return l}else{return i}};l.context=function(e){if(arguments.length){u=e==null?null:e;return l}else{return u}};return l}function vg_trail(){var e,t,n,r,i=null,a,o,s,u;function l(e,t,n){var r=n/2;if(a){var l=s-t,f=e-o;if(l||f){var c=Math.sqrt(l*l+f*f),d=(l/=c)*u,p=(f/=c)*u,h=Math.atan2(f,l);i.moveTo(o-d,s-p);i.lineTo(e-l*r,t-f*r);i.arc(e,t,r,h-Math.PI,h);i.lineTo(o+d,s+p);i.arc(o,s,u,h,h+Math.PI)}else{i.arc(e,t,r,0,Tau)}i.closePath()}else{a=1}o=e;s=t;u=r}function f(o){var s,u=o.length,f,c=false,d;if(i==null)i=d=path$3();for(s=0;s<=u;++s){if(!(s<u&&r(f=o[s],s,o))===c){if(c=!c)a=0}if(c)l(+e(f,s,o),+t(f,s,o),+n(f,s,o))}if(d){i=null;return d+""||null}}f.x=function(t){if(arguments.length){e=t;return f}else{return e}};f.y=function(e){if(arguments.length){t=e;return f}else{return t}};f.size=function(e){if(arguments.length){n=e;return f}else{return n}};f.defined=function(e){if(arguments.length){r=e;return f}else{return r}};f.context=function(e){if(arguments.length){if(e==null){i=null}else{i=e}return f}else{return i}};return f}function value$1(e,t){return e!=null?e:t}var x$2=function(e){return e.x||0},y$2=function(e){return e.y||0},w$1=function(e){return e.width||0},h=function(e){return e.height||0},xw=function(e){return(e.x||0)+(e.width||0)},yh=function(e){return(e.y||0)+(e.height||0)},sa=function(e){return e.startAngle||0},ea=function(e){return e.endAngle||0},pa=function(e){return e.padAngle||0},ir=function(e){return e.innerRadius||0},or=function(e){return e.outerRadius||0},cr=function(e){return e.cornerRadius||0},tl=function(e){return value$1(e.cornerRadiusTopLeft,e.cornerRadius)||0},tr=function(e){return value$1(e.cornerRadiusTopRight,e.cornerRadius)||0},br=function(e){return value$1(e.cornerRadiusBottomRight,e.cornerRadius)||0},bl=function(e){return value$1(e.cornerRadiusBottomLeft,e.cornerRadius)||0},sz=function(e){return value$1(e.size,64)},ts=function(e){return e.size||1},def=function(e){return!(e.defined===false)},type$1=function(e){return symbols$1(e.shape||"circle")};var arcShape=arc$2$1().startAngle(sa).endAngle(ea).padAngle(pa).innerRadius(ir).outerRadius(or).cornerRadius(cr),areavShape=area$2$1().x(x$2).y1(y$2).y0(yh).defined(def),areahShape=area$2$1().y(y$2).x1(x$2).x0(xw).defined(def),lineShape=line$2$1().x(x$2).y(y$2).defined(def),rectShape=vg_rect().x(x$2).y(y$2).width(w$1).height(h).cornerRadius(tl,tr,br,bl),symbolShape=symbol$2().type(type$1).size(sz),trailShape=vg_trail().x(x$2).y(y$2).defined(def).size(ts);function hasCornerRadius(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function arc$1$1(e,t){return arcShape.context(e)(t)}function area$1$1(e,t){var n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?areahShape:areavShape).curve(curves(r,n.orient,n.tension)).context(e)(t)}function line$1$1(e,t){var n=t[0],r=n.interpolate||"linear";return lineShape.curve(curves(r,n.orient,n.tension)).context(e)(t)}function rectangle(e,t,n,r){return rectShape.context(e)(t,n,r)}function shape$1(e,t){return(t.mark.shape||t.shape).context(e)(t)}function symbol$1(e,t){return symbolShape.context(e)(t)}function trail$1(e,t){return trailShape.context(e)(t)}var clip_id=1;function resetSVGClipId(){clip_id=1}function clip$1$1(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+clip_id++),o=i.clipping[a]||(i.clipping[a]={id:a});if(isFunction(r)){o.path=r(null)}else if(hasCornerRadius(n)){o.path=rectangle(null,n,0,0)}else{o.width=n.width||0;o.height=n.height||0}return"url(#"+a+")"}function Bounds(e){this.clear();if(e)this.union(e)}Bounds.prototype={clone:function(){return new Bounds(this)},clear:function(){this.x1=+Number.MAX_VALUE;this.y1=+Number.MAX_VALUE;this.x2=-Number.MAX_VALUE;this.y2=-Number.MAX_VALUE;return this},empty:function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals:function(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set:function(e,t,n,r){if(n<e){this.x2=e;this.x1=n}else{this.x1=e;this.x2=n}if(r<t){this.y2=t;this.y1=r}else{this.y1=t;this.y2=r}return this},add:function(e,t){if(e<this.x1)this.x1=e;if(t<this.y1)this.y1=t;if(e>this.x2)this.x2=e;if(t>this.y2)this.y2=t;return this},expand:function(e){this.x1-=e;this.y1-=e;this.x2+=e;this.y2+=e;return this},round:function(){this.x1=Math.floor(this.x1);this.y1=Math.floor(this.y1);this.x2=Math.ceil(this.x2);this.y2=Math.ceil(this.y2);return this},scale:function(e){this.x1*=e;this.y1*=e;this.x2*=e;this.y2*=e;return this},translate:function(e,t){this.x1+=e;this.x2+=e;this.y1+=t;this.y2+=t;return this},rotate:function(e,t,n){var r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints:function(e,t,n){var r=this,i=r.x1,a=r.y1,o=r.x2,s=r.y2,u=Math.cos(e),l=Math.sin(e),f=t-t*u+n*l,c=n-t*l-n*u;return[u*i-l*a+f,l*i+u*a+c,u*i-l*s+f,l*i+u*s+c,u*o-l*a+f,l*o+u*a+c,u*o-l*s+f,l*o+u*s+c]},union:function(e){if(e.x1<this.x1)this.x1=e.x1;if(e.y1<this.y1)this.y1=e.y1;if(e.x2>this.x2)this.x2=e.x2;if(e.y2>this.y2)this.y2=e.y2;return this},intersect:function(e){if(e.x1>this.x1)this.x1=e.x1;if(e.y1>this.y1)this.y1=e.y1;if(e.x2<this.x2)this.x2=e.x2;if(e.y2<this.y2)this.y2=e.y2;return this},encloses:function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith:function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects:function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains:function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width:function(){return this.x2-this.x1},height:function(){return this.y2-this.y1}};function Item(e){this.mark=e;this.bounds=this.bounds||new Bounds}function GroupItem(e){Item.call(this,e);this.items=this.items||[]}inherits(GroupItem,Item);function ResourceLoader(e){this._pending=0;this._loader=e||loader()}function increment(e){e._pending+=1}function decrement(e){e._pending-=1}ResourceLoader.prototype={pending:function(){return this._pending},sanitizeURL:function(e){var t=this;increment(t);return t._loader.sanitize(e,{context:"href"}).then((function(e){decrement(t);return e})).catch((function(){decrement(t);return null}))},loadImage:function(e){var t=this,n=domImage();increment(t);return t._loader.sanitize(e,{context:"image"}).then((function(e){var r=e.href;if(!r||!n)throw{url:r};var i=new n;var a=has$1(e,"crossOrigin")?e.crossOrigin:"anonymous";if(a!=null)i.crossOrigin=a;i.onload=function(){return decrement(t)};i.onerror=function(){return decrement(t)};i.src=r;return i})).catch((function(e){decrement(t);return{complete:false,width:0,height:0,src:e&&e.url||""}}))},ready:function(){var e=this;return new Promise((function(t){function n(r){if(!e.pending())t(r);else setTimeout((function(){n(true)}),10)}n(false)}))}};function boundStroke(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){var r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?miterAdjustment(t,r):0))}return e}function miterAdjustment(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}var circleThreshold=Tau-1e-8;var bounds,lx,ly,rot,ma,mb,mc,md;var add$2=function(e,t){return bounds.add(e,t)};var addL=function(e,t){return add$2(lx=e,ly=t)};var addX=function(e){return add$2(e,bounds.y1)};var addY=function(e){return add$2(bounds.x1,e)};var px=function(e,t){return ma*e+mc*t};var py=function(e,t){return mb*e+md*t};var addp=function(e,t){return add$2(px(e,t),py(e,t))};var addpL=function(e,t){return addL(px(e,t),py(e,t))};function boundContext(e,t){bounds=e;if(t){rot=t*DegToRad;ma=md=Math.cos(rot);mb=Math.sin(rot);mc=-mb}else{ma=md=1;rot=mb=mc=0}return context$1}var context$1={beginPath:function(){},closePath:function(){},moveTo:addpL,lineTo:addpL,rect:function(e,t,n,r){if(rot){addp(e+n,t);addp(e+n,t+r);addp(e,t+r);addpL(e,t)}else{add$2(e+n,t+r);addL(e,t)}},quadraticCurveTo:function(e,t,n,r){var i=px(e,t),a=py(e,t),o=px(n,r),s=py(n,r);quadExtrema(lx,i,o,addX);quadExtrema(ly,a,s,addY);addL(o,s)},bezierCurveTo:function(e,t,n,r,i,a){var o=px(e,t),s=py(e,t),u=px(n,r),l=py(n,r),f=px(i,a),c=py(i,a);cubicExtrema(lx,o,u,f,addX);cubicExtrema(ly,s,l,c,addY);addL(f,c)},arc:function(e,t,n,r,i,a){r+=rot;i+=rot;lx=n*Math.cos(i)+e;ly=n*Math.sin(i)+t;if(Math.abs(i-r)>circleThreshold){add$2(e-n,t-n);add$2(e+n,t+n)}else{var o=function(r){return add$2(n*Math.cos(r)+e,n*Math.sin(r)+t)};var s=void 0,u=void 0;o(r);o(i);if(i!==r){r=r%Tau;if(r<0)r+=Tau;i=i%Tau;if(i<0)i+=Tau;if(i<r){a=!a;s=r;r=i;i=s}if(a){i-=Tau;s=r-r%HalfPi;for(u=0;u<4&&s>i;++u,s-=HalfPi)o(s)}else{s=r-r%HalfPi+HalfPi;for(u=0;u<4&&s<i;++u,s=s+HalfPi)o(s)}}}}};function quadExtrema(e,t,n,r){var i=(e-t)/(e+n-2*t);if(0<i&&i<1)r(e+(t-e)*i)}function cubicExtrema(e,t,n,r,i){var a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;var u=0,l=0,f;if(Math.abs(a)>Epsilon){f=o*o+s*a;if(f>=0){f=Math.sqrt(f);u=(-o+f)/a;l=(-o-f)/a}}else{u=.5*s/o}if(0<u&&u<1)i(cubic(u,e,t,n,r));if(0<l&&l<1)i(cubic(l,e,t,n,r))}function cubic(e,t,n,r,i){var a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var context$2=(context$2=domCanvas(1,1))?context$2.getContext("2d"):null;var b=new Bounds;function intersectPath(e){return function(t,n){if(!context$2)return true;e(context$2,t);b.clear().union(t.bounds).intersect(n).round();var r=b.x1,i=b.y1,a=b.x2,o=b.y2;for(var s=i;s<=o;++s){for(var u=r;u<=a;++u){if(context$2.isPointInPath(u,s)){return true}}}return false}}function intersectPoint(e,t){return t.contains(e.x||0,e.y||0)}function intersectRect(e,t){var n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(b.set(n,r,n+i,r+a))}function intersectRule(e,t){var n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,a=e.y2!=null?e.y2:r;return intersectBoxLine(t,n,r,i,a)}function intersectBoxLine(e,t,n,r,i){var a=e.x1,o=e.y1,s=e.x2,u=e.y2,l=r-t,f=i-n;var c=0,d=1,p,h,g,m;for(m=0;m<4;++m){if(m===0){p=-l;h=-(a-t)}if(m===1){p=l;h=s-t}if(m===2){p=-f;h=-(o-n)}if(m===3){p=f;h=u-n}if(Math.abs(p)<1e-10&&h<0)return false;g=h/p;if(p<0){if(g>d)return false;else if(g>c)c=g}else if(p>0){if(g<c)return false;else if(g<d)d=g}}return true}function blend(e,t){e.globalCompositeOperation=t.blend||"source-over"}function value$2(e,t){return e==null?t:e}function addStops(e,t){var n=t.length;for(var r=0;r<n;++r){e.addColorStop(t[r].offset,t[r].color)}return e}function gradient$2(e,t,n){var r=n.width(),i=n.height();var a;if(t.gradient==="radial"){a=e.createRadialGradient(n.x1+value$2(t.x1,.5)*r,n.y1+value$2(t.y1,.5)*i,Math.max(r,i)*value$2(t.r1,0),n.x1+value$2(t.x2,.5)*r,n.y1+value$2(t.y2,.5)*i,Math.max(r,i)*value$2(t.r2,.5))}else{var o=value$2(t.x1,0),s=value$2(t.y1,0),u=value$2(t.x2,1),l=value$2(t.y2,0);if(o===u||s===l||r===i){a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+u*r,n.y1+l*i)}else{var f=domCanvas(Math.ceil(r),Math.ceil(i)),c=f.getContext("2d");c.scale(r,i);c.fillStyle=addStops(c.createLinearGradient(o,s,u,l),t.stops);c.fillRect(0,0,r,i);return e.createPattern(f,"no-repeat")}}return addStops(a,t.stops)}function color$2(e,t,n){return isGradient(n)?gradient$2(e,n,t.bounds):n}function fill(e,t,n){n*=t.fillOpacity==null?1:t.fillOpacity;if(n>0){e.globalAlpha=n;e.fillStyle=color$2(e,t,t.fill);return true}else{return false}}var Empty=[];function stroke(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;if(r<=0)return false;n*=t.strokeOpacity==null?1:t.strokeOpacity;if(n>0){e.globalAlpha=n;e.strokeStyle=color$2(e,t,t.stroke);e.lineWidth=r;e.lineCap=t.strokeCap||"butt";e.lineJoin=t.strokeJoin||"miter";e.miterLimit=t.strokeMiterLimit||10;if(e.setLineDash){e.setLineDash(t.strokeDash||Empty);e.lineDashOffset=t.strokeDashOffset||0}return true}else{return false}}function compare(e,t){return e.zindex-t.zindex||e.index-t.index}function zorder(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,a;for(i=0,a=t.length;i<a;++i){r=t[i];r.index=i;if(r.zindex)n.push(r)}e.zdirty=false;return e.zitems=n.sort(compare)}function visit(e,t){var n=e.items,r,i;if(!n||!n.length)return;var a=zorder(e);if(a&&a.length){for(r=0,i=n.length;r<i;++r){if(!n[r].zindex)t(n[r])}n=a}for(r=0,i=n.length;r<i;++r){t(n[r])}}function pickVisit(e,t){var n=e.items,r,i;if(!n||!n.length)return null;var a=zorder(e);if(a&&a.length)n=a;for(i=n.length;--i>=0;){if(r=t(n[i]))return r}if(n===a){for(n=e.items,i=n.length;--i>=0;){if(!n[i].zindex){if(r=t(n[i]))return r}}}return null}function drawAll(e){return function(t,n,r){visit(n,(function(n){if(!r||r.intersects(n.bounds)){drawPath(e,t,n,n)}}))}}function drawOne(e){return function(t,n,r){if(n.items.length&&(!r||r.intersects(n.bounds))){drawPath(e,t,n.items[0],n.items)}}}function drawPath(e,t,n,r){var i=n.opacity==null?1:n.opacity;if(i===0)return;if(e(t,r))return;blend(t,n);if(n.fill&&fill(t,n,i)){t.fill()}if(n.stroke&&stroke(t,n,i)){t.stroke()}}function pick$1(e){e=e||truthy;return function(t,n,r,i,a,o){r*=t.pixelRatio;i*=t.pixelRatio;return pickVisit(n,(function(n){var s=n.bounds;if(s&&!s.contains(a,o)||!s)return;if(e(t,n,r,i,a,o))return n}))}}function hitPath(e,t){return function(n,r,i,a){var o=Array.isArray(r)?r[0]:r,s=t==null?o.fill:t,u=o.stroke&&n.isPointInStroke,l,f;if(u){l=o.strokeWidth;f=o.strokeCap;n.lineWidth=l!=null?l:1;n.lineCap=f!=null?f:"butt"}return e(n,r)?false:s&&n.isPointInPath(i,a)||u&&n.isPointInStroke(i,a)}}function pickPath(e){return pick$1(hitPath(e))}function translate$2(e,t){return"translate("+e+","+t+")"}function rotate(e){return"rotate("+e+")"}function scale$3(e,t){return"scale("+e+","+t+")"}function translateItem(e){return translate$2(e.x||0,e.y||0)}function rotateItem(e){return translate$2(e.x||0,e.y||0)+(e.angle?" "+rotate(e.angle):"")}function transformItem(e){return translate$2(e.x||0,e.y||0)+(e.angle?" "+rotate(e.angle):"")+(e.scaleX||e.scaleY?" "+scale$3(e.scaleX||1,e.scaleY||1):"")}function markItemPath(e,t,n){function r(e,n){e("transform",rotateItem(n));e("d",t(null,n))}function i(e,n){t(boundContext(e,n.angle),n);return boundStroke(e,n).translate(n.x||0,n.y||0)}function a(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i);if(a)e.rotate(a*=DegToRad);e.beginPath();t(e,n);if(a)e.rotate(-a);e.translate(-r,-i)}return{type:e,tag:"path",nested:false,attr:r,bound:i,draw:drawAll(a),pick:pickPath(a),isect:n||intersectPath(a)}}var arc$2=markItemPath("arc",arc$1$1);function pickArea(e,t){var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,a=+Infinity,o,s;while(--i>=0){if(e[i].defined===false)continue;s=Math.abs(e[i][r]-n);if(s<a){a=s;o=e[i]}}return o}function pickLine(e,t){var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,a,o;while(--r>=0){if(e[r].defined===false)continue;i=e[r].x-t[0];a=e[r].y-t[1];o=i*i+a*a;if(o<n)return e[r]}return null}function pickTrail(e,t){var n=e.length,r,i,a;while(--n>=0){if(e[n].defined===false)continue;r=e[n].x-t[0];i=e[n].y-t[1];a=r*r+i*i;r=e[n].size||1;if(a<r*r)return e[n]}return null}function markMultiItemPath(e,t,n){function r(e,n){var r=n.mark.items;if(r.length)e("d",t(null,r))}function i(e,n){var r=n.items;if(r.length===0){return e}else{t(boundContext(e),r);return boundStroke(e,r[0])}}function a(e,n){e.beginPath();t(e,n)}var o=hitPath(a);function s(e,t,n,r,i,a){var s=t.items,u=t.bounds;if(!s||!s.length||u&&!u.contains(i,a)){return null}n*=e.pixelRatio;r*=e.pixelRatio;return o(e,s,n,r)?s[0]:null}return{type:e,tag:"path",nested:true,attr:r,bound:i,draw:drawOne(a),pick:s,isect:intersectPoint,tip:n}}var area$2=markMultiItemPath("area",area$1$1,pickArea);function clip$2(e,t){var n=t.clip;e.save();if(isFunction(n)){e.beginPath();n(e);e.clip()}else{clipGroup(e,t.group)}}function clipGroup(e,t){e.beginPath();hasCornerRadius(t)?rectangle(e,t,0,0):e.rect(0,0,t.width||0,t.height||0);e.clip()}function offset$1(e){var t=value$2(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function attr$5(e,t){e("transform",translateItem(t))}function emitRectangle(e,t){var n=offset$1(t);e("d",rectangle(null,t,n,n))}function background$1(e,t){e("class","background");e("aria-hidden",true);emitRectangle(e,t)}function foreground(e,t){e("class","foreground");e("aria-hidden",true);if(t.strokeForeground){emitRectangle(e,t)}else{e("d","")}}function content(e,t,n){var r=t.clip?clip$1$1(n,t,t):null;e("clip-path",r)}function bound$5(e,t){if(!t.clip&&t.items){var n=t.items,r=n.length;for(var i=0;i<r;++i){e.union(n[i].bounds)}}if((t.clip||t.width||t.height)&&!t.noBound){e.add(0,0).add(t.width||0,t.height||0)}boundStroke(e,t);return e.translate(t.x||0,t.y||0)}function rectanglePath(e,t,n,r){var i=offset$1(t);e.beginPath();rectangle(e,t,(n||0)+i,(r||0)+i)}var hitBackground=hitPath(rectanglePath);var hitForeground=hitPath(rectanglePath,false);var hitCorner=hitPath(rectanglePath,true);function draw$4(e,t,n){var r=this;visit(t,(function(t){var i=t.x||0,a=t.y||0,o=t.strokeForeground,s=t.opacity==null?1:t.opacity;if((t.stroke||t.fill)&&s){rectanglePath(e,t,i,a);blend(e,t);if(t.fill&&fill(e,t,s)){e.fill()}if(t.stroke&&!o&&stroke(e,t,s)){e.stroke()}}e.save();e.translate(i,a);if(t.clip)clipGroup(e,t);if(n)n.translate(-i,-a);visit(t,(function(t){r.draw(e,t,n)}));if(n)n.translate(i,a);e.restore();if(o&&t.stroke&&s){rectanglePath(e,t,i,a);blend(e,t);if(stroke(e,t,s)){e.stroke()}}}))}function pick$2(e,t,n,r,i,a){var o=this;if(t.bounds&&!t.bounds.contains(i,a)||!t.items){return null}var s=n*e.pixelRatio,u=r*e.pixelRatio;return pickVisit(t,(function(l){var f,c,d;var p=l.bounds;if(p&&!p.contains(i,a))return;c=l.x||0;d=l.y||0;var h=c+(l.width||0),g=d+(l.height||0),m=l.clip;if(m&&(i<c||i>h||a<d||a>g))return;e.save();e.translate(c,d);c=i-c;d=a-d;if(m&&hasCornerRadius(l)&&!hitCorner(e,l,s,u)){e.restore();return null}var v=l.strokeForeground,y=t.interactive!==false;if(y&&v&&l.stroke&&hitForeground(e,l,s,u)){e.restore();return l}f=pickVisit(l,(function(e){return pickMark(e,c,d)?o.pick(e,n,r,c,d):null}));if(!f&&y&&(l.fill||!v&&l.stroke)&&hitBackground(e,l,s,u)){f=l}e.restore();return f||null}))}function pickMark(e,t,n){return(e.interactive!==false||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var group={type:"group",tag:"g",nested:false,attr:attr$5,bound:bound$5,draw:draw$4,pick:pick$2,isect:intersectRect,content:content,background:background$1,foreground:foreground};var metadata={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function getImage(e,t){var n=e.image;if(!n||e.url&&e.url!==n.url){n={complete:false,width:0,height:0};t.loadImage(e.url).then((function(t){e.image=t;e.image.url=e.url}))}return n}function imageWidth(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==false&&e.height?e.height*t.width/t.height:t.width}function imageHeight(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==false&&e.width?e.width*t.height/t.width:t.height}function imageXOffset(e,t){return e==="center"?t/2:e==="right"?t:0}function imageYOffset(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function attr$4(e,t,n){var r=getImage(t,n),i=imageWidth(t,r),a=imageHeight(t,r),o=(t.x||0)-imageXOffset(t.align,i),s=(t.y||0)-imageYOffset(t.baseline,a),u=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",u,metadata["xmlns:xlink"],"xlink:href");e("transform",translate$2(o,s));e("width",i);e("height",a);e("preserveAspectRatio",t.aspect===false?"none":"xMidYMid")}function bound$4(e,t){var n=t.image,r=imageWidth(t,n),i=imageHeight(t,n),a=(t.x||0)-imageXOffset(t.align,r),o=(t.y||0)-imageYOffset(t.baseline,i);return e.set(a,o,a+r,o+i)}function draw$3(e,t,n){var r=this;visit(t,(function(t){if(n&&!n.intersects(t.bounds))return;var i=getImage(t,r);var a=imageWidth(t,i);var o=imageHeight(t,i);if(a===0||o===0)return;var s=(t.x||0)-imageXOffset(t.align,a),u=(t.y||0)-imageYOffset(t.baseline,o),l,f,c,d;if(t.aspect!==false){f=i.width/i.height;c=t.width/t.height;if(f===f&&c===c&&f!==c){if(c<f){d=a/f;u+=(o-d)/2;o=d}else{d=o*f;s+=(a-d)/2;a=d}}}if(i.complete||i.toDataURL){blend(e,t);e.globalAlpha=(l=t.opacity)!=null?l:1;e.imageSmoothingEnabled=t.smooth!==false;e.drawImage(i,s,u,a,o)}}))}var image$1={type:"image",tag:"image",nested:false,attr:attr$4,bound:bound$4,draw:draw$3,pick:pick$1(),isect:truthy,get:getImage,xOffset:imageXOffset,yOffset:imageYOffset};var line$2=markMultiItemPath("line",line$1$1,pickLine);function attr$3(e,t){var n=t.scaleX||1,r=t.scaleY||1;if(n!==1||r!==1){e("vector-effect","non-scaling-stroke")}e("transform",transformItem(t));e("d",t.path)}function path$1(e,t){var n=t.path;if(n==null)return true;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*DegToRad,u=t.pathCache;if(!u||u.path!==n){(t.pathCache=u=pathParse(n)).path=n}if(s&&e.rotate&&e.translate){e.translate(r,i);e.rotate(s);pathRender(e,u,0,0,a,o);e.rotate(-s);e.translate(-r,-i)}else{pathRender(e,u,r,i,a,o)}}function bound$3(e,t){return path$1(boundContext(e,t.angle),t)?e.set(0,0,0,0):boundStroke(e,t,true)}var path$2={type:"path",tag:"path",nested:false,attr:attr$3,bound:bound$3,draw:drawAll(path$1),pick:pickPath(path$1),isect:intersectPath(path$1)};function attr$2(e,t){e("d",rectangle(null,t))}function bound$2(e,t){var n,r;return boundStroke(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function draw$2(e,t){e.beginPath();rectangle(e,t)}var rect$1={type:"rect",tag:"path",nested:false,attr:attr$2,bound:bound$2,draw:drawAll(draw$2),pick:pickPath(draw$2),isect:intersectRect};function attr$1(e,t){e("transform",translateItem(t));e("x2",t.x2!=null?t.x2-(t.x||0):0);e("y2",t.y2!=null?t.y2-(t.y||0):0)}function bound$1(e,t){var n,r;return boundStroke(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function path(e,t,n){var r,i,a,o;if(t.stroke&&stroke(e,t,n)){r=t.x||0;i=t.y||0;a=t.x2!=null?t.x2:r;o=t.y2!=null?t.y2:i;e.beginPath();e.moveTo(r,i);e.lineTo(a,o);return true}return false}function draw$1(e,t,n){visit(t,(function(t){if(n&&!n.intersects(t.bounds))return;var r=t.opacity==null?1:t.opacity;if(r&&path(e,t,r)){blend(e,t);e.stroke()}}))}function hit$1(e,t,n,r){if(!e.isPointInStroke)return false;return path(e,t,1)&&e.isPointInStroke(n,r)}var rule$2={type:"rule",tag:"line",nested:false,attr:attr$1,bound:bound$1,draw:draw$1,pick:pick$1(hit$1),isect:intersectRule};var shape=markItemPath("shape",shape$1);var symbol=markItemPath("symbol",symbol$1,intersectPoint);var widthCache=lruCache();var textMetrics={height:fontSize,measureWidth:measureWidth,estimateWidth:estimateWidth,width:estimateWidth,canvas:useCanvas};useCanvas(true);function useCanvas(e){textMetrics.width=e&&context$2?measureWidth:estimateWidth}function estimateWidth(e,t){return _estimateWidth(textValue(e,t),fontSize(e))}function _estimateWidth(e,t){return~~(.8*e.length*t)}function measureWidth(e,t){return fontSize(e)<=0||!(t=textValue(e,t))?0:_measureWidth(t,font$1(e))}function _measureWidth(e,t){var n="("+t+") "+e;var r=widthCache.get(n);if(r===undefined){context$2.font=t;r=context$2.measureText(e).width;widthCache.set(n,r)}return r}function fontSize(e){return e.fontSize!=null?+e.fontSize||0:11}function lineHeight(e){return e.lineHeight!=null?e.lineHeight:fontSize(e)+2}function lineArray(e){return isArray(e)?e.length>1?e:e[0]:e}function textLines(e){return lineArray(e.lineBreak&&e.text&&!isArray(e.text)?e.text.split(e.lineBreak):e.text)}function multiLineOffset(e){var t=textLines(e);return(isArray(t)?t.length-1:0)*lineHeight(e)}function textValue(e,t){var n=t==null?"":(t+"").trim();return e.limit>0&&n.length?truncate(e,n):n}function widthGetter(e){if(textMetrics.width===measureWidth){var t=font$1(e);return function(e){return _measureWidth(e,t)}}else{var n=fontSize(e);return function(e){return _estimateWidth(e,n)}}}function truncate(e,t){var n=+e.limit,r=widthGetter(e);if(r(t)<n)return t;var i=e.ellipsis||"…",a=e.dir==="rtl",o=0,s=t.length,u;n-=r(i);if(a){while(o<s){u=o+s>>>1;if(r(t.slice(u))>n)o=u+1;else s=u}return i+t.slice(o)}else{while(o<s){u=1+(o+s>>>1);if(r(t.slice(0,u))<n)o=u;else s=u-1}return t.slice(0,o)+i}}function fontFamily(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function font$1(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+fontSize(e)+"px "+fontFamily(e,t)}function offset$2(e){var t=e.baseline,n=fontSize(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*lineHeight(e):t==="line-bottom"?.29*n-.5*lineHeight(e):0)}var textAlign={left:"start",center:"middle",right:"end"};var tempBounds$1=new Bounds;function anchorPoint(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;if(r){i=(e.theta||0)-HalfPi;t+=r*Math.cos(i);n+=r*Math.sin(i)}tempBounds$1.x1=t;tempBounds$1.y1=n;return tempBounds$1}function attr(e,t){var n=t.dx||0,r=(t.dy||0)+offset$2(t),i=anchorPoint(t),a=i.x1,o=i.y1,s=t.angle||0,u;e("text-anchor",textAlign[t.align]||"start");if(s){u=translate$2(a,o)+" "+rotate(s);if(n||r)u+=" "+translate$2(n,r)}else{u=translate$2(a+n,o+r)}e("transform",u)}function bound(e,t,n){var r=textMetrics.height(t),i=t.align,a=anchorPoint(t),o=a.x1,s=a.y1,u=t.dx||0,l=(t.dy||0)+offset$2(t)-Math.round(.8*r),f=textLines(t),c;if(isArray(f)){r+=lineHeight(t)*(f.length-1);c=f.reduce((function(e,n){return Math.max(e,textMetrics.width(t,n))}),0)}else{c=textMetrics.width(t,f)}if(i==="center"){u-=c/2}else if(i==="right"){u-=c}else;e.set(u+=o,l+=s,u+c,l+r);if(t.angle&&!n){e.rotate(t.angle*DegToRad,o,s)}else if(n===2){return e.rotatedPoints(t.angle*DegToRad,o,s)}return e}function draw$5(e,t,n){visit(t,(function(t){var r=t.opacity==null?1:t.opacity,i,a,o,s,u,l,f;if(n&&!n.intersects(t.bounds)||r===0||t.fontSize<=0||t.text==null||t.text.length===0)return;e.font=font$1(t);e.textAlign=t.align||"left";i=anchorPoint(t);a=i.x1,o=i.y1;if(t.angle){e.save();e.translate(a,o);e.rotate(t.angle*DegToRad);a=o=0}a+=t.dx||0;o+=(t.dy||0)+offset$2(t);l=textLines(t);blend(e,t);if(isArray(l)){u=lineHeight(t);for(s=0;s<l.length;++s){f=textValue(t,l[s]);if(t.fill&&fill(e,t,r)){e.fillText(f,a,o)}if(t.stroke&&stroke(e,t,r)){e.strokeText(f,a,o)}o+=u}}else{f=textValue(t,l);if(t.fill&&fill(e,t,r)){e.fillText(f,a,o)}if(t.stroke&&stroke(e,t,r)){e.strokeText(f,a,o)}}if(t.angle)e.restore()}))}function hit(e,t,n,r,i,a){if(t.fontSize<=0)return false;if(!t.angle)return true;var o=anchorPoint(t),s=o.x1,u=o.y1,l=bound(tempBounds$1,t,1),f=-t.angle*DegToRad,c=Math.cos(f),d=Math.sin(f),p=c*i-d*a+(s-c*s+d*u),h=d*i+c*a+(u-d*s-c*u);return l.contains(p,h)}function intersectText(e,t){var n=bound(tempBounds$1,e,2);return intersectBoxLine(t,n[0],n[1],n[2],n[3])||intersectBoxLine(t,n[0],n[1],n[4],n[5])||intersectBoxLine(t,n[4],n[5],n[6],n[7])||intersectBoxLine(t,n[2],n[3],n[6],n[7])}var text$2={type:"text",tag:"text",nested:false,attr:attr,bound:bound,draw:draw$5,pick:pick$1(hit),isect:intersectText};var trail$2=markMultiItemPath("trail",trail$1,pickTrail);var Marks={arc:arc$2,area:area$2,group:group,image:image$1,line:line$2,path:path$2,rect:rect$1,rule:rule$2,shape:shape,symbol:symbol,text:text$2,trail:trail$2};function boundItem$1(e,t,n){var r=Marks[e.mark.marktype],i=t||r.bound;if(r.nested)e=e.mark;return i(e.bounds||(e.bounds=new Bounds),e,n)}var DUMMY={mark:null};function boundMark(e,t,n){var r=Marks[e.marktype],i=r.bound,a=e.items,o=a&&a.length,s,u,l,f;if(r.nested){if(o){l=a[0]}else{DUMMY.mark=e;l=DUMMY}f=boundItem$1(l,i,n);t=t&&t.union(f)||f;return t}t=t||e.bounds&&e.bounds.clear()||new Bounds;if(o){for(s=0,u=a.length;s<u;++s){t.union(boundItem$1(a[s],i,n))}}return e.bounds=t}var keys$3=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function sceneToJSON(e,t){return JSON.stringify(e,keys$3,t)}function sceneFromJSON(e){var t=typeof e==="string"?JSON.parse(e):e;return initialize$1(t)}function initialize$1(e){var t=e.marktype,n=e.items,r,i,a;if(n){for(i=0,a=n.length;i<a;++i){r=t?"mark":"group";n[i][r]=e;if(n[i].zindex)n[i][r].zdirty=true;if("group"===(t||r))initialize$1(n[i])}}if(t)boundMark(e);return e}function Scenegraph(e){if(arguments.length){this.root=sceneFromJSON(e)}else{this.root=createMark({marktype:"group",name:"root",role:"frame"});this.root.items=[new GroupItem(this.root)]}}Scenegraph.prototype={toJSON:function(e){return sceneToJSON(this.root,e||0)},mark:function(e,t,n){t=t||this.root.items[0];var r=createMark(e,t);t.items[n]=r;if(r.zindex)r.group.zdirty=true;return r}};function createMark(e,t){var n={bounds:new Bounds,clip:!!e.clip,group:t,interactive:e.interactive===false?false:true,items:[],marktype:e.marktype,name:e.name||undefined,role:e.role||undefined,zindex:e.zindex||0};if(e.aria!=null){n.aria=e.aria}if(e.description){n.description=e.description}return n}function domCreate(e,t,n){if(!e&&typeof document!=="undefined"&&document.createElement){e=document}return e?n?e.createElementNS(n,t):e.createElement(t):null}function domFind(e,t){t=t.toLowerCase();var n=e.childNodes,r=0,i=n.length;for(;r<i;++r)if(n[r].tagName.toLowerCase()===t){return n[r]}}function domChild(e,t,n,r){var i=e.childNodes[t],a;if(!i||i.tagName.toLowerCase()!==n.toLowerCase()){a=i||null;i=domCreate(e.ownerDocument,n,r);e.insertBefore(i,a)}return i}function domClear(e,t){var n=e.childNodes,r=n.length;while(r>t)e.removeChild(n[--r]);return e}function cssClass(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function point$2(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function resolveItem(e,t,n,r){var i=e&&e.mark,a,o;if(i&&(a=Marks[i.marktype]).tip){o=point$2(t,n);o[0]-=r[0];o[1]-=r[1];while(e=e.mark.group){o[0]-=e.x||0;o[1]-=e.y||0}e=a.tip(i.items,o)}return e}function Handler$1(e,t){this._active=null;this._handlers={};this._loader=e||loader();this._tooltip=t||defaultTooltip$1}function defaultTooltip$1(e,t,n,r){e.element().setAttribute("title",r||"")}Handler$1.prototype={initialize:function(e,t,n){this._el=e;this._obj=n||null;return this.origin(t)},element:function(){return this._el},canvas:function(){return this._el&&this._el.firstChild},origin:function(e){if(arguments.length){this._origin=e||[0,0];return this}else{return this._origin.slice()}},scene:function(e){if(!arguments.length)return this._scene;this._scene=e;return this},on:function(){},off:function(){},_handlerIndex:function(e,t,n){for(var r=e?e.length:0;--r>=0;){if(e[r].type===t&&(!n||e[r].handler===n)){return r}}return-1},handlers:function(e){var t=this._handlers,n=[];if(e){n.push.apply(n,t[this.eventName(e)])}else{for(var r in t){n.push.apply(n,t[r])}}return n},eventName:function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref:function(e,t,n){this._loader.sanitize(n,{context:"href"}).then((function(t){var n=new MouseEvent(e.type,e),r=domCreate(null,"a");for(var i in t)r.setAttribute(i,t[i]);r.dispatchEvent(n)})).catch((function(){}))},handleTooltip:function(e,t,n){if(t&&t.tooltip!=null){t=resolveItem(t,e,this.canvas(),this._origin);var r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect:function(e){var t=this.canvas();if(!t)return;var n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();var s=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;while(e.mark&&(e=e.mark.group)){s+=e.x||0;u+=e.y||0}return{x:s,y:u,width:a,height:o,left:s,top:u,right:s+a,bottom:u+o}}};function Renderer(e){this._el=null;this._bgcolor=null;this._loader=new ResourceLoader(e)}Renderer.prototype={initialize:function(e,t,n,r,i){this._el=e;return this.resize(t,n,r,i)},element:function(){return this._el},canvas:function(){return this._el&&this._el.firstChild},background:function(e){if(arguments.length===0)return this._bgcolor;this._bgcolor=e;return this},resize:function(e,t,n,r){this._width=e;this._height=t;this._origin=n||[0,0];this._scale=r||1;return this},dirty:function(){},render:function(e){var t=this;t._call=function(){t._render(e)};t._call();t._call=null;return t},_render:function(){},renderAsync:function(e){var t=this.render(e);return this._ready?this._ready.then((function(){return t})):Promise.resolve(t)},_load:function(e,t){var n=this,r=n._loader[e](t);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then((function(e){if(e)i();n._ready=null}))}return r},sanitizeURL:function(e){return this._load("sanitizeURL",e)},loadImage:function(e){return this._load("loadImage",e)}};var KeyDownEvent="keydown";var KeyPressEvent="keypress";var KeyUpEvent="keyup";var DragEnterEvent="dragenter";var DragLeaveEvent="dragleave";var DragOverEvent="dragover";var MouseDownEvent="mousedown";var MouseUpEvent="mouseup";var MouseMoveEvent="mousemove";var MouseOutEvent="mouseout";var MouseOverEvent="mouseover";var ClickEvent="click";var DoubleClickEvent="dblclick";var WheelEvent="wheel";var MouseWheelEvent="mousewheel";var TouchStartEvent="touchstart";var TouchMoveEvent="touchmove";var TouchEndEvent="touchend";var Events=[KeyDownEvent,KeyPressEvent,KeyUpEvent,DragEnterEvent,DragLeaveEvent,DragOverEvent,MouseDownEvent,MouseUpEvent,MouseMoveEvent,MouseOutEvent,MouseOverEvent,ClickEvent,DoubleClickEvent,WheelEvent,MouseWheelEvent,TouchStartEvent,TouchMoveEvent,TouchEndEvent];var TooltipShowEvent=MouseMoveEvent;var TooltipHideEvent=MouseOutEvent;var HrefEvent=ClickEvent;function CanvasHandler(e,t){Handler$1.call(this,e,t);this._down=null;this._touch=null;this._first=true;this._events={}}var eventBundle=function(e){return e===TouchStartEvent||e===TouchMoveEvent||e===TouchEndEvent?[TouchStartEvent,TouchMoveEvent,TouchEndEvent]:[e]};function eventListenerCheck(e,t){eventBundle(t).forEach((function(t){return addEventListener(e,t)}))}function addEventListener(e,t){var n=e.canvas();if(n&&!e._events[t]){e._events[t]=1;n.addEventListener(t,e[t]?function(n){return e[t](n)}:function(n){return e.fire(t,n)})}}function move(e,t,n){return function(r){var i=this._active,a=this.pickEvent(r);if(a===i){this.fire(e,r)}else{if(!i||!i.exit){this.fire(n,r)}this._active=a;this.fire(t,r);this.fire(e,r)}}}function inactive(e){return function(t){this.fire(e,t);this._active=null}}inherits(CanvasHandler,Handler$1,{initialize:function(e,t,n){var r=this;this._canvas=e&&domFind(e,"canvas");[ClickEvent,MouseDownEvent,MouseMoveEvent,MouseOutEvent,DragLeaveEvent].forEach((function(e){return eventListenerCheck(r,e)}));return Handler$1.prototype.initialize.call(this,e,t,n)},canvas:function(){return this._canvas},context:function(){return this._canvas.getContext("2d")},events:Events,DOMMouseScroll:function(e){this.fire(MouseWheelEvent,e)},mousemove:move(MouseMoveEvent,MouseOverEvent,MouseOutEvent),dragover:move(DragOverEvent,DragEnterEvent,DragLeaveEvent),mouseout:inactive(MouseOutEvent),dragleave:inactive(DragLeaveEvent),mousedown:function(e){this._down=this._active;this.fire(MouseDownEvent,e)},click:function(e){if(this._down===this._active){this.fire(ClickEvent,e);this._down=null}},touchstart:function(e){this._touch=this.pickEvent(e.changedTouches[0]);if(this._first){this._active=this._touch;this._first=false}this.fire(TouchStartEvent,e,true)},touchmove:function(e){this.fire(TouchMoveEvent,e,true)},touchend:function(e){this.fire(TouchEndEvent,e,true);this._touch=null},fire:function(e,t,n){var r=n?this._touch:this._active,i=this._handlers[e];t.vegaType=e;if(e===HrefEvent&&r&&r.href){this.handleHref(t,r,r.href)}else if(e===TooltipShowEvent||e===TooltipHideEvent){this.handleTooltip(t,r,e!==TooltipHideEvent)}if(i){for(var a=0,o=i.length;a<o;++a){i[a].handler.call(this._obj,t,r)}}},on:function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){eventListenerCheck(this,e);(r[n]||(r[n]=[])).push({type:e,handler:t})}return this},off:function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){r.splice(i,1)}return this},pickEvent:function(e){var t=point$2(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick:function(e,t,n,r,i){var a=this.context(),o=Marks[e.marktype];return o.pick.call(this,a,e,t,n,r,i)}});function devicePixelRatio(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var pixelRatio=devicePixelRatio();function resize(e,t,n,r,i,a){var o=typeof HTMLElement!=="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,s=e.getContext("2d"),u=o?pixelRatio:i;e.width=t*u;e.height=n*u;for(var l in a){s[l]=a[l]}if(o&&u!==1){e.style.width=t+"px";e.style.height=n+"px"}s.pixelRatio=u;s.setTransform(u,0,0,u,u*r[0],u*r[1]);return e}function CanvasRenderer(e){Renderer.call(this,e);this._options={};this._redraw=false;this._dirty=new Bounds;this._tempb=new Bounds}var base$1=Renderer.prototype;var viewBounds=function(e,t,n){return(new Bounds).set(0,0,t,n).translate(-e[0],-e[1])};function clipToBounds(e,t,n){t.expand(1).round();if(e.pixelRatio%1){t.scale(e.pixelRatio).round().scale(1/e.pixelRatio)}t.translate(-(n[0]%1),-(n[1]%1));e.beginPath();e.rect(t.x1,t.y1,t.width(),t.height());e.clip();return t}inherits(CanvasRenderer,Renderer,{initialize:function(e,t,n,r,i,a){this._options=a||{};this._canvas=this._options.externalContext?null:domCanvas(1,1);if(e&&this._canvas){domClear(e,0).appendChild(this._canvas);this._canvas.setAttribute("class","marks")}return base$1.initialize.call(this,e,t,n,r,i)},resize:function(e,t,n,r){base$1.resize.call(this,e,t,n,r);if(this._canvas){resize(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context)}else{var i=this._options.externalContext;if(!i)error("CanvasRenderer is missing a valid canvas or context");i.scale(this._scale,this._scale);i.translate(this._origin[0],this._origin[1])}this._redraw=true;return this},canvas:function(){return this._canvas},context:function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty:function(e){var t=this._tempb.clear().union(e.bounds);var n=e.mark.group;while(n){t.translate(n.x||0,n.y||0);n=n.mark.group}this._dirty.union(t)},_render:function(e){var t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=viewBounds(n,r,i);t.save();var s=this._redraw||a.empty()?(this._redraw=false,o.expand(1)):clipToBounds(t,o.intersect(a),n);this.clear(-n[0],-n[1],r,i);this.draw(t,e,s);t.restore();a.clear();return this},draw:function(e,t,n){var r=Marks[t.marktype];if(t.clip)clip$2(e,t);r.draw.call(this,e,t,n);if(t.clip)e.restore()},clear:function(e,t,n,r){var i=this._options,a=this.context();if(i.type!=="pdf"&&!i.externalContext){a.clearRect(e,t,n,r)}if(this._bgcolor!=null){a.fillStyle=this._bgcolor;a.fillRect(e,t,n,r)}}});function SVGHandler(e,t){Handler$1.call(this,e,t);var n=this;n._hrefHandler=listener(n,(function(e,t){if(t&&t.href)n.handleHref(e,t,t.href)}));n._tooltipHandler=listener(n,(function(e,t){n.handleTooltip(e,t,e.type!==TooltipHideEvent)}))}var listener=function(e,t){return function(n){var r=n.target.__data__;r=Array.isArray(r)?r[0]:r;n.vegaType=n.type;t.call(e._obj,n,r)}};inherits(SVGHandler,Handler$1,{initialize:function(e,t,n){var r=this._svg;if(r){r.removeEventListener(HrefEvent,this._hrefHandler);r.removeEventListener(TooltipShowEvent,this._tooltipHandler);r.removeEventListener(TooltipHideEvent,this._tooltipHandler)}this._svg=r=e&&domFind(e,"svg");if(r){r.addEventListener(HrefEvent,this._hrefHandler);r.addEventListener(TooltipShowEvent,this._tooltipHandler);r.addEventListener(TooltipHideEvent,this._tooltipHandler)}return Handler$1.prototype.initialize.call(this,e,t,n)},canvas:function(){return this._svg},on:function(e,t){var n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){var a={type:e,handler:t,listener:listener(this,t)};(r[n]||(r[n]=[])).push(a);if(this._svg){this._svg.addEventListener(n,a.listener)}}return this},off:function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);if(i>=0){if(this._svg){this._svg.removeEventListener(n,r[i].listener)}r.splice(i,1)}return this}});var ARIA_HIDDEN="aria-hidden";var ARIA_LABEL="aria-label";var ARIA_ROLE="role";var ARIA_ROLEDESCRIPTION="aria-roledescription";var GRAPHICS_OBJECT="graphics-object";var GRAPHICS_SYMBOL="graphics-symbol";var bundle=function(e,t,n){var r;return r={},r[ARIA_ROLE]=e,r[ARIA_ROLEDESCRIPTION]=t,r[ARIA_LABEL]=n||undefined,r};var AriaIgnore=toSet(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]);var AriaGuides={axis:{desc:"axis",caption:axisCaption},legend:{desc:"legend",caption:legendCaption},"title-text":{desc:"title",caption:function(e){return"Title text '"+titleCaption(e)+"'"}},"title-subtitle":{desc:"subtitle",caption:function(e){return"Subtitle text '"+titleCaption(e)+"'"}}};var AriaEncode={ariaRole:ARIA_ROLE,ariaRoleDescription:ARIA_ROLEDESCRIPTION,description:ARIA_LABEL};function ariaItemAttributes(e,t){var n=t.aria===false;e(ARIA_HIDDEN,n||undefined);if(n||t.description==null){for(var r in AriaEncode){e(AriaEncode[r],undefined)}}else{var i=t.mark.marktype;e(ARIA_LABEL,t.description);e(ARIA_ROLE,t.ariaRole||(i==="group"?GRAPHICS_OBJECT:GRAPHICS_SYMBOL));e(ARIA_ROLEDESCRIPTION,t.ariaRoleDescription||i+" mark")}}function ariaMarkAttributes(e){var t;return e.aria===false?(t={},t[ARIA_HIDDEN]=true,t):AriaIgnore[e.role]?null:AriaGuides[e.role]?ariaGuide(e,AriaGuides[e.role]):ariaMark(e)}function ariaMark(e){var t=e.marktype;var n=t==="group"||t==="text"||e.items.some((function(e){return e.description!=null&&e.aria!==false}));return bundle(n?GRAPHICS_OBJECT:GRAPHICS_SYMBOL,t+" mark container",e.description)}function ariaGuide(e,t){try{var n=e.items[0],r=t.caption||function(){return""};return bundle(t.role||GRAPHICS_SYMBOL,t.desc,n.description||r(n))}catch(i){return null}}function titleCaption(e){return array$5(e.text).join(" ")}function axisCaption(e){var t=e.datum,n=e.orient,r=t.title?extractTitle(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type,u=n==="left"||n==="right"?"Y":"X";return u+"-axis"+(r?" titled '"+r+"'":"")+(" for a "+(isDiscrete$1(s)?"discrete":s)+" scale")+(" with "+domainCaption(o,a,e))}function legendCaption(e){var t=e.datum,n=t.title?extractTitle(e):null,r=((t.type||"")+" legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,u=o.dataflow.locale();return capitalize(r)+(n?" titled '"+n+"'":"")+(" for "+channelCaption(a))+(" with "+domainCaption(u,s,e))}function extractTitle(e){try{return array$5(peek$1(e.items).items[0].text).join(" ")}catch(t){return null}}function channelCaption(e){e=e.map((function(e){return e+(e==="fill"||e==="stroke"?" color":"")}));return e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+peek$1(e)}function capitalize(e){return e.length?e[0].toUpperCase()+e.slice(1):e}var innerText=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};var attrText=function(e){return innerText(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")};function markup(){var e="",t="",n="";var r=[],i=function(){return t=n=""},a=function(a){if(t){e+=t+">"+n;i()}r.push(a)},o=function(e,n){if(n!=null)t+=" "+e+'="'+attrText(n)+'"';return s},s={open:function(e){var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}a(e);t="<"+e;for(var i=0,u=n;i<u.length;i++){var l=u[i];for(var f in l)o(f,l[f])}return s},close:function(){var a=r.pop();if(t){e+=t+(n?">"+n+"</"+a+">":"/>")}else{e+="</"+a+">"}i();return s},attr:o,text:function(e){return n+=innerText(e),s},toString:function(){return e}};return s}var serializeXML=function(e){return _serialize(markup(),e)+""};function _serialize(e,t){e.open(t.tagName);if(t.hasAttributes()){var n=t.attributes,r=n.length;for(var i=0;i<r;++i){e.attr(n[i].name,n[i].value)}}if(t.hasChildNodes()){var a=t.childNodes,r=a.length;for(var i=0;i<r;i++){var o=a[i];o.nodeType===3?e.text(o.nodeValue):_serialize(e,o)}}return e.close()}var styles={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"};var rootAttributes={fill:"none","stroke-miterlimit":10};var RootIndex=0,xmlns="http://www.w3.org/2000/xmlns/",svgns=metadata.xmlns;function SVGRenderer(e){Renderer.call(this,e);this._dirtyID=0;this._dirty=[];this._svg=null;this._root=null;this._defs=null}var base=Renderer.prototype;inherits(SVGRenderer,Renderer,{initialize:function(e,t,n,r,i){this._defs={};this._clearDefs();if(e){this._svg=domChild(e,0,"svg",svgns);this._svg.setAttributeNS(xmlns,"xmlns",svgns);this._svg.setAttributeNS(xmlns,"xmlns:xlink",metadata["xmlns:xlink"]);this._svg.setAttribute("version",metadata["version"]);this._svg.setAttribute("class","marks");domClear(e,1);this._root=domChild(this._svg,RootIndex,"g",svgns);setAttributes(this._root,rootAttributes);domClear(this._svg,RootIndex+1)}this.background(this._bgcolor);return base.initialize.call(this,e,t,n,r,i)},background:function(e){if(arguments.length&&this._svg){this._svg.style.setProperty("background-color",e)}return base.background.apply(this,arguments)},resize:function(e,t,n,r){base.resize.call(this,e,t,n,r);if(this._svg){setAttributes(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height});this._root.setAttribute("transform","translate("+this._origin+")")}this._dirty=[];return this},canvas:function(){return this._svg},svg:function(){var e=this._svg,t=this._bgcolor;if(!e)return null;var n;if(t){e.removeAttribute("style");n=domChild(e,RootIndex,"rect",svgns);setAttributes(n,{width:this._width,height:this._height,fill:t})}var r=serializeXML(e);if(t){e.removeChild(n);this._svg.style.setProperty("background-color",t)}return r},_render:function(e){if(this._dirtyCheck()){if(this._dirtyAll)this._clearDefs();this.mark(this._root,e);domClear(this._root,1)}this.defs();this._dirty=[];++this._dirtyID;return this},dirty:function(e){if(e.dirty!==this._dirtyID){e.dirty=this._dirtyID;this._dirty.push(e)}},isDirty:function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck:function(){this._dirtyAll=true;var e=this._dirty;if(!e.length||!this._dirtyID)return true;var t=++this._dirtyID;var n,r,i,a,o,s,u;for(o=0,s=e.length;o<s;++o){n=e[o];r=n.mark;if(r.marktype!==i){i=r.marktype;a=Marks[i]}if(r.zdirty&&r.dirty!==t){this._dirtyAll=false;dirtyParents(n,t);r.items.forEach((function(e){e.dirty=t}))}if(r.zdirty)continue;if(n.exit){if(a.nested&&r.items.length){u=r.items[0];if(u._svg)this._update(a,u._svg,u)}else if(n._svg){u=n._svg.parentNode;if(u)u.removeChild(n._svg)}n._svg=null;continue}n=a.nested?r.items[0]:n;if(n._update===t)continue;if(!n._svg||!n._svg.ownerSVGElement){this._dirtyAll=false;dirtyParents(n,t)}else{this._update(a,n._svg,n)}n._update=t}return!this._dirtyAll},mark:function(e,t,n){var r=this;if(!this.isDirty(t))return t._svg;var i=this._svg,a=Marks[t.marktype],o=t.interactive===false?"none":null,s=a.tag==="g";var u=null,l=0;var f=bind$1(t,e,n,"g",i);f.setAttribute("class",cssClass(t));var c=ariaMarkAttributes(t);for(var d in c)setAttribute(f,d,c[d]);if(!s){setAttribute(f,"pointer-events",o)}setAttribute(f,"clip-path",t.clip?clip$1$1(this,t,t.group):null);var p=function(e){var t=r.isDirty(e),n=bind$1(e,f,u,a.tag,i);if(t){r._update(a,n,e);if(s)recurse(r,n,e)}u=n;++l};if(a.nested){if(t.items.length)p(t.items[0])}else{visit(t,p)}domClear(f,l);return f},_update:function(e,t,n){element$1=t;values$3=t.__values__;ariaItemAttributes(emit,n);e.attr(emit,n,this);var r=mark_extras[e.type];if(r)r.call(this,e,t,n);if(element$1)this.style(element$1,n)},style:function(e,t){if(t==null)return;for(var n in styles){var r=n==="font"?fontFamily(t):t[n];if(r===values$3[n])continue;var i=styles[n];if(r==null){e.removeAttribute(i)}else{if(isGradient(r)){r=gradientRef(r,this._defs.gradient,href())}e.setAttribute(i,r+"")}values$3[n]=r}},defs:function(){var e=this._svg,t=this._defs;var n=t.el,r=0;for(var i in t.gradient){if(!n)t.el=n=domChild(e,RootIndex+1,"defs",svgns);r=updateGradient(n,t.gradient[i],r)}for(var a in t.clipping){if(!n)t.el=n=domChild(e,RootIndex+1,"defs",svgns);r=updateClipping(n,t.clipping[a],r)}if(n){r===0?(e.removeChild(n),t.el=null):domClear(n,r)}},_clearDefs:function(){var e=this._defs;e.gradient={};e.clipping={}}});function dirtyParents(e,t){for(;e&&e.dirty!==t;e=e.mark.group){e.dirty=t;if(e.mark&&e.mark.dirty!==t){e.mark.dirty=t}else return}}function updateGradient(e,t,n){var r,i,a;if(t.gradient==="radial"){var o=domChild(e,n++,"pattern",svgns);setAttributes(o,{id:patternPrefix+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"});o=domChild(o,0,"rect",svgns);setAttributes(o,{width:1,height:1,fill:"url("+href()+"#"+t.id+")"});e=domChild(e,n++,"radialGradient",svgns);setAttributes(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else{e=domChild(e,n++,"linearGradient",svgns);setAttributes(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2})}for(r=0,i=t.stops.length;r<i;++r){a=domChild(e,r,"stop",svgns);a.setAttribute("offset",t.stops[r].offset);a.setAttribute("stop-color",t.stops[r].color)}domClear(e,r);return n}function updateClipping(e,t,n){var r;e=domChild(e,n,"clipPath",svgns);e.setAttribute("id",t.id);if(t.path){r=domChild(e,0,"path",svgns);r.setAttribute("d",t.path)}else{r=domChild(e,0,"rect",svgns);setAttributes(r,{x:0,y:0,width:t.width,height:t.height})}domClear(e,1);return n+1}function recurse(e,t,n){t=t.lastChild.previousSibling;var r,i=0;visit(n,(function(n){r=e.mark(t,n,r);++i}));domClear(t,1+i)}function bind$1(e,t,n,r,i){var a=e._svg,o;if(!a){o=t.ownerDocument;a=domCreate(o,r,svgns);e._svg=a;if(e.mark){a.__data__=e;a.__values__={fill:"default"};if(r==="g"){var s=domCreate(o,"path",svgns);a.appendChild(s);s.__data__=e;var u=domCreate(o,"g",svgns);a.appendChild(u);u.__data__=e;var l=domCreate(o,"path",svgns);a.appendChild(l);l.__data__=e;l.__values__={fill:"default"}}}}if(a.ownerSVGElement!==i||siblingCheck(a,n)){t.insertBefore(a,n?n.nextSibling:t.firstChild)}return a}function siblingCheck(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}var element$1=null,values$3=null;var mark_extras={group:function(e,t,n){var r=element$1=t.childNodes[2];values$3=r.__values__;e.foreground(emit,n,this);values$3=t.__values__;element$1=t.childNodes[1];e.content(emit,n,this);var i=element$1=t.childNodes[0];e.background(emit,n,this);var a=n.mark.interactive===false?"none":null;if(a!==values$3.events){setAttribute(r,"pointer-events",a);setAttribute(i,"pointer-events",a);values$3.events=a}if(n.strokeForeground&&n.stroke){var o=n.fill;setAttribute(r,"display",null);this.style(i,n);setAttribute(i,"stroke",null);if(o)n.fill=null;values$3=r.__values__;this.style(r,n);if(o)n.fill=o;element$1=null}else{setAttribute(r,"display","none")}},image:function(e,t,n){if(n.smooth===false){setStyle(t,"image-rendering","optimizeSpeed");setStyle(t,"image-rendering","pixelated")}else{setStyle(t,"image-rendering",null)}},text:function(e,t,n){var r=textLines(n);var i,a,o,s;if(isArray(r)){a=r.map((function(e){return textValue(n,e)}));i=a.join("\n");if(i!==values$3.text){domClear(t,0);o=t.ownerDocument;s=lineHeight(n);a.forEach((function(e,r){var i=domCreate(o,"tspan",svgns);i.__data__=n;i.textContent=e;if(r){i.setAttribute("x",0);i.setAttribute("dy",s)}t.appendChild(i)}));values$3.text=i}}else{a=textValue(n,r);if(a!==values$3.text){t.textContent=a;values$3.text=a}}setAttribute(t,"font-family",fontFamily(n));setAttribute(t,"font-size",fontSize(n)+"px");setAttribute(t,"font-style",n.fontStyle);setAttribute(t,"font-variant",n.fontVariant);setAttribute(t,"font-weight",n.fontWeight)}};function emit(e,t,n){if(t===values$3[e])return;if(n){setAttributeNS(element$1,e,t,n)}else{setAttribute(element$1,e,t)}values$3[e]=t}function setStyle(e,t,n){if(n!==values$3[t]){if(n==null){e.style.removeProperty(t)}else{e.style.setProperty(t,n+"")}values$3[t]=n}}function setAttributes(e,t){for(var n in t){setAttribute(e,n,t[n])}}function setAttribute(e,t,n){if(n!=null){e.setAttribute(t,n)}else{e.removeAttribute(t)}}function setAttributeNS(e,t,n,r){if(n!=null){e.setAttributeNS(r,t,n)}else{e.removeAttributeNS(r,t)}}function href(){var e;return typeof window==="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function SVGStringRenderer(e){Renderer.call(this,e);this._text=null;this._defs={gradient:{},clipping:{}}}inherits(SVGStringRenderer,Renderer,{svg:function(){return this._text},_render:function(e){var t=markup();t.open("svg",extend$1({},metadata,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height}));var n=this._bgcolor;if(n&&n!=="transparent"&&n!=="none"){t.open("rect",{width:this._width,height:this._height,fill:n}).close()}t.open("g",rootAttributes,{transform:"translate("+this._origin+")"});this.mark(t,e);t.close();this.defs(t);this._text=t.close()+"";return this},mark:function(e,t){var n=this;var r=Marks[t.marktype],i=r.tag,a=[ariaItemAttributes,r.attr];e.open("g",{class:cssClass(t),"clip-path":t.clip?clip$1$1(this,t,t.group):null},ariaMarkAttributes(t),{"pointer-events":i!=="g"&&t.interactive===false?"none":null});var o=function(o){var s=n.href(o);if(s)e.open("a",s);e.open(i,n.attr(t,o,a,i!=="g"?i:null));if(i==="text"){var u=textLines(o);if(isArray(u)){var l={x:0,dy:lineHeight(o)};for(var f=0;f<u.length;++f){e.open("tspan",f?l:null).text(textValue(o,u[f])).close()}}else{e.text(textValue(o,u))}}else if(i==="g"){var c=o.strokeForeground,d=o.fill,p=o.stroke;if(c&&p){o.stroke=null}e.open("path",n.attr(t,o,r.background,"bgrect")).close();e.open("g",n.attr(t,o,r.content));visit(o,(function(t){return n.mark(e,t)}));e.close();if(c&&p){if(d)o.fill=null;o.stroke=p;e.open("path",n.attr(t,o,r.foreground,"bgrect")).close();if(d)o.fill=d}else{e.open("path",n.attr(t,o,r.foreground,"bgfore")).close()}}e.close();if(s)e.close()};if(r.nested){if(t.items&&t.items.length)o(t.items[0])}else{visit(t,o)}return e.close()},href:function(e){var t=this;var n=e.href;var r;if(n){if(r=this._hrefs&&this._hrefs[n]){return r}else{this.sanitizeURL(n).then((function(e){e["xlink:href"]=e.href;e.href=null;(t._hrefs||(t._hrefs={}))[n]=e}))}}return null},attr:function(e,t,n,r){var i=this;var a={},o=function(e,t,n,r){a[r||e]=t};if(Array.isArray(n)){n.forEach((function(e){return e(o,t,i)}))}else{n(o,t,this)}if(r){style(a,t,e,r,this._defs)}return a},defs:function(e){var t=this._defs.gradient,n=this._defs.clipping,r=Object.keys(t).length+Object.keys(n).length;if(r===0)return;e.open("defs");for(var i in t){var a=t[i],o=a.stops;if(a.gradient==="radial"){e.open("pattern",{id:patternPrefix+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"});e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close();e.close();e.open("radialGradient",{id:i,fx:a.x1,fy:a.y1,fr:a.r1,cx:a.x2,cy:a.y2,r:a.r2})}else{e.open("linearGradient",{id:i,x1:a.x1,x2:a.x2,y1:a.y1,y2:a.y2})}for(var s=0;s<o.length;++s){e.open("stop",{offset:o[s].offset,"stop-color":o[s].color}).close()}e.close()}for(var u in n){var l=n[u];e.open("clipPath",{id:u});if(l.path){e.open("path",{d:l.path}).close()}else{e.open("rect",{x:0,y:0,width:l.width,height:l.height}).close()}e.close()}e.close()}});function style(e,t,n,r,i){if(t==null)return e;if(r==="bgrect"&&n.interactive===false){e["pointer-events"]="none"}if(r==="bgfore"){if(n.interactive===false){e["pointer-events"]="none"}e.display="none";if(t.fill!==null)return e}if(r==="image"&&t.smooth===false){e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"}if(r==="text"){e["font-family"]=fontFamily(t);e["font-size"]=fontSize(t)+"px";e["font-style"]=t.fontStyle;e["font-variant"]=t.fontVariant;e["font-weight"]=t.fontWeight}for(var a in styles){var o=t[a];var s=styles[a];if(o==="transparent"&&(s==="fill"||s==="stroke"));else if(o!=null){if(isGradient(o)){o=gradientRef(o,i.gradient,"")}e[s]=o}}return e}var Canvas="canvas";var PNG="png";var SVG="svg";var None$1="none";var RenderType={Canvas:Canvas,PNG:PNG,SVG:SVG,None:None$1};var modules={};modules[Canvas]=modules[PNG]={renderer:CanvasRenderer,headless:CanvasRenderer,handler:CanvasHandler};modules[SVG]={renderer:SVGRenderer,headless:SVGStringRenderer,handler:SVGHandler};modules[None$1]={};function renderModule(e,t){e=String(e||"").toLowerCase();if(arguments.length>1){modules[e]=t;return this}else{return modules[e]}}function intersect$2(e,t,n){var r=[],i=(new Bounds).union(t),a=e.marktype;return a?intersectMark(e,i,n,r):a==="group"?intersectGroup(e,i,n,r):error("Intersect scene must be mark node or group item.")}function intersectMark(e,t,n,r){if(visitMark(e,t,n)){var i=e.items,a=e.marktype,o=i.length;var s=0;if(a==="group"){for(;s<o;++s){intersectGroup(i[s],t,n,r)}}else{for(var u=Marks[a].isect;s<o;++s){var l=i[s];if(intersectItem(l,t,u))r.push(l)}}}return r}function visitMark(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==false&&(!n||n(e)))}function intersectGroup(e,t,n,r){if(n&&n(e.mark)&&intersectItem(e,t,Marks.group.isect)){r.push(e)}var i=e.items,a=i&&i.length;if(a){var o=e.x||0,s=e.y||0;t.translate(-o,-s);for(var u=0;u<a;++u){intersectMark(i[u],t,n,r)}t.translate(o,s)}return r}function intersectItem(e,t,n){var r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}var clipBounds=new Bounds;function boundClip(e){var t=e.clip;if(isFunction(t)){t(boundContext(clipBounds.clear()))}else if(t){clipBounds.set(0,0,e.group.width,e.group.height)}else return;e.bounds.intersect(clipBounds)}var TOLERANCE=1e-9;function sceneEqual(e,t,n){return e===t?true:n==="path"?pathEqual(e,t):e instanceof Date&&t instanceof Date?+e===+t:isNumber$1(e)&&isNumber$1(t)?Math.abs(e-t)<=TOLERANCE:!e||!t||!isObject(e)&&!isObject(t)?e==t:objectEqual(e,t)}function pathEqual(e,t){return sceneEqual(pathParse(e),pathParse(t))}function objectEqual(e,t){var n=Object.keys(e),r=Object.keys(t),i,a;if(n.length!==r.length)return false;n.sort();r.sort();for(a=n.length-1;a>=0;a--){if(n[a]!=r[a])return false}for(a=n.length-1;a>=0;a--){i=n[a];if(!sceneEqual(e[i],t[i],i))return false}return typeof e===typeof t}function resetSVGDefIds(){resetSVGClipId();resetSVGGradientId()}var Top$1="top";var Left$1="left";var Right$1="right";var Bottom$1="bottom";var TopLeft="top-left";var TopRight="top-right";var BottomLeft="bottom-left";var BottomRight="bottom-right";var Start$1="start";var Middle$1="middle";var End$1="end";var X$1="x";var Y$1="y";var Group="group";var AxisRole$1="axis";var TitleRole$1="title";var FrameRole$1="frame";var ScopeRole$1="scope";var LegendRole$1="legend";var RowHeader="row-header";var RowFooter="row-footer";var RowTitle="row-title";var ColHeader="column-header";var ColFooter="column-footer";var ColTitle="column-title";var Padding$1="padding";var Symbols$1="symbol";var Fit="fit";var FitX="fit-x";var FitY="fit-y";var Pad="pad";var None="none";var All="all";var Each="each";var Flush="flush";var Column="column";var Row="row";function Bound$1(e){Transform.call(this,null,e)}inherits(Bound$1,Transform,{transform:function(e,t){var n=t.dataflow,r=e.mark,i=r.marktype,a=Marks[i],o=a.bound;var s=r.bounds,u;if(a.nested){if(r.items.length)n.dirty(r.items[0]);s=boundItem(r,o);r.items.forEach((function(e){e.bounds.clear().union(s)}))}else if(i===Group||e.modified()){t.visit(t.MOD,(function(e){return n.dirty(e)}));s.clear();r.items.forEach((function(e){return s.union(boundItem(e,o))}));switch(r.role){case AxisRole$1:case LegendRole$1:case TitleRole$1:t.reflow()}}else{u=t.changed(t.REM);t.visit(t.ADD,(function(e){s.union(boundItem(e,o))}));t.visit(t.MOD,(function(e){u=u||s.alignsWith(e.bounds);n.dirty(e);s.union(boundItem(e,o))}));if(u){s.clear();r.items.forEach((function(e){return s.union(e.bounds)}))}}boundClip(r);return t.modifies("bounds")}});function boundItem(e,t,n){return t(e.bounds.clear(),e,n)}var COUNTER_NAME=":vega_identifier:";function Identifier$1(e){Transform.call(this,0,e)}Identifier$1.Definition={type:"Identifier",metadata:{modifies:true},params:[{name:"as",type:"string",required:true}]};inherits(Identifier$1,Transform,{transform:function(e,t){var n=getCounter(t.dataflow),r=e.as;var i=n.value;t.visit(t.ADD,(function(e){return e[r]=e[r]||++i}));n.set(this.value=i);return t}});function getCounter(e){return e._signals[COUNTER_NAME]||(e._signals[COUNTER_NAME]=e.add(0))}function Mark$2(e){Transform.call(this,null,e)}inherits(Mark$2,Transform,{transform:function(e,t){var n=this.value;if(!n){n=t.dataflow.scenegraph().mark(e.markdef,lookup$3(e),e.index);n.group.context=e.context;if(!e.context.group)e.context.group=n.group;n.source=this.source;n.clip=e.clip;n.interactive=e.interactive;this.value=n}var r=n.marktype===Group?GroupItem:Item;t.visit(t.ADD,(function(e){return r.call(e,n)}));if(e.modified("clip")||e.modified("interactive")){n.clip=e.clip;n.interactive=!!e.interactive;n.zdirty=true;t.reflow()}n.items=t.source;return t}});function lookup$3(e){var t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function Overlap$1(e){Transform.call(this,null,e)}var methods={parity:function(e){return e.filter((function(e,t){return t%2?e.opacity=0:1}))},greedy:function(e,t){var n;return e.filter((function(e,r){return!r||!intersect$1(n.bounds,e.bounds,t)?(n=e,1):e.opacity=0}))}};var intersect$1=function(e,t,n){return n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2)};var hasOverlap=function(e,t){for(var n=1,r=e.length,i=e[0].bounds,a;n<r;i=a,++n){if(intersect$1(i,a=e[n].bounds,t))return true}};var hasBounds=function(e){var t=e.bounds;return t.width()>1&&t.height()>1};var boundTest=function(e,t,n){var r=e.range(),i=new Bounds;if(t===Top$1||t===Bottom$1){i.set(r[0],-Infinity,r[1],+Infinity)}else{i.set(-Infinity,r[0],+Infinity,r[1])}i.expand(n||1);return function(e){return i.encloses(e.bounds)}};var reset$1=function(e){e.forEach((function(e){return e.opacity=1}));return e};var reflow=function(e,t){return e.reflow(t.modified()).modifies("opacity")};inherits(Overlap$1,Transform,{transform:function(e,t){var n=methods[e.method]||methods.parity,r=e.separation||0;var i=t.materialize(t.SOURCE).source,a,o;if(!i||!i.length)return;if(!e.method){if(e.modified("method")){reset$1(i);t=reflow(t,e)}return t}i=i.filter(hasBounds);if(!i.length)return;if(e.sort){i=i.slice().sort(e.sort)}a=reset$1(i);t=reflow(t,e);if(a.length>=3&&hasOverlap(a,r)){do{a=n(a,r)}while(a.length>=3&&hasOverlap(a,r));if(a.length<3&&!peek$1(i).opacity){if(a.length>1)peek$1(a).opacity=0;peek$1(i).opacity=1}}if(e.boundScale&&e.boundTolerance>=0){o=boundTest(e.boundScale,e.boundOrient,+e.boundTolerance);i.forEach((function(e){if(!o(e))e.opacity=0}))}var s=a[0].mark.bounds.clear();i.forEach((function(e){if(e.opacity)s.union(e.bounds)}));return t}});function Render$1(e){Transform.call(this,null,e)}inherits(Render$1,Transform,{transform:function(e,t){var n=t.dataflow;t.visit(t.ALL,(function(e){return n.dirty(e)}));if(t.fields&&t.fields["zindex"]){var r=t.source&&t.source[0];if(r)r.mark.zdirty=true}}});var tempBounds=new Bounds;function set$3(e,t,n){return e[t]===n?0:(e[t]=n,1)}function isYAxis(e){var t=e.items[0].orient;return t===Left$1||t===Right$1}function axisIndices(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function axisLayout(e,t,n,r){var i=t.items[0],a=i.datum,o=i.translate!=null?i.translate:.5,s=i.orient,u=axisIndices(a),l=i.range,f=i.offset,c=i.position,d=i.minExtent,p=i.maxExtent,h=a.title&&i.items[u[2]].items[0],g=i.titlePadding,m=i.bounds,v=h&&multiLineOffset(h),y=0,_=0,b,x;tempBounds.clear().union(m);m.clear();if((b=u[0])>-1)m.union(i.items[b].bounds);if((b=u[1])>-1)m.union(i.items[b].bounds);switch(s){case Top$1:y=c||0;_=-f;x=Math.max(d,Math.min(p,-m.y1));m.add(0,-x).add(l,0);if(h)axisTitleLayout(e,h,x,g,v,0,-1,m);break;case Left$1:y=-f;_=c||0;x=Math.max(d,Math.min(p,-m.x1));m.add(-x,0).add(0,l);if(h)axisTitleLayout(e,h,x,g,v,1,-1,m);break;case Right$1:y=n+f;_=c||0;x=Math.max(d,Math.min(p,m.x2));m.add(0,0).add(x,l);if(h)axisTitleLayout(e,h,x,g,v,1,1,m);break;case Bottom$1:y=c||0;_=r+f;x=Math.max(d,Math.min(p,m.y2));m.add(0,0).add(l,x);if(h)axisTitleLayout(e,h,x,g,0,0,1,m);break;default:y=i.x;_=i.y}boundStroke(m.translate(y,_),i);if(set$3(i,"x",y+o)|set$3(i,"y",_+o)){i.bounds=tempBounds;e.dirty(i);i.bounds=m;e.dirty(i)}return i.mark.bounds.clear().union(m)}function axisTitleLayout(e,t,n,r,i,a,o,s){var u=t.bounds;if(t.auto){var l=o*(n+i+r);var f=0,c=0;e.dirty(t);a?f=(t.x||0)-(t.x=l):c=(t.y||0)-(t.y=l);t.mark.bounds.clear().union(u.translate(-f,-c));e.dirty(t)}s.union(u)}var min=function(e,t){return Math.floor(Math.min(e,t))};var max=function(e,t){return Math.ceil(Math.max(e,t))};function gridLayoutGroups(e){var t,n,r,i,a;var o=e.items,s=o.length,u=0,l,f;var c={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;u<s;++u){l=o[u];f=l.items;if(l.marktype===Group){switch(l.role){case AxisRole$1:case LegendRole$1:case TitleRole$1:break;case RowHeader:(t=c.rowheaders).push.apply(t,f);break;case RowFooter:(n=c.rowfooters).push.apply(n,f);break;case ColHeader:(r=c.colheaders).push.apply(r,f);break;case ColFooter:(i=c.colfooters).push.apply(i,f);break;case RowTitle:c.rowtitle=f[0];break;case ColTitle:c.coltitle=f[0];break;default:(a=c.marks).push.apply(a,f)}}}return c}function bboxFlush(e){return(new Bounds).set(0,0,e.width||0,e.height||0)}function bboxFull(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function get$1(e,t,n){var r=isObject(e)?e[t]:e;return r!=null?r:n!==undefined?n:0}function offsetValue$1(e){return e<0?Math.ceil(-e):0}function gridLayout(e,t,n){var r=!n.nodirty,i=n.bounds===Flush?bboxFlush:bboxFull,a=tempBounds.set(0,0,0,0),o=get$1(n.align,Column),s=get$1(n.align,Row),u=get$1(n.padding,Column),l=get$1(n.padding,Row),f=n.columns||t.length,c=f<=0?1:Math.ceil(t.length/f),d=t.length,p=Array(d),h=Array(f),g=0,m=Array(d),v=Array(c),y=0,_=Array(d),b=Array(d),x=Array(d),E,S,$,A,D,w,C,T,k,O,N;for(S=0;S<f;++S)h[S]=0;for(S=0;S<c;++S)v[S]=0;for(S=0;S<d;++S){w=t[S];D=x[S]=i(w);w.x=w.x||0;_[S]=0;w.y=w.y||0;b[S]=0;$=S%f;A=~~(S/f);g=Math.max(g,C=Math.ceil(D.x2));y=Math.max(y,T=Math.ceil(D.y2));h[$]=Math.max(h[$],C);v[A]=Math.max(v[A],T);p[S]=u+offsetValue$1(D.x1);m[S]=l+offsetValue$1(D.y1);if(r)e.dirty(t[S])}for(S=0;S<d;++S){if(S%f===0)p[S]=0;if(S<f)m[S]=0}if(o===Each){for($=1;$<f;++$){for(N=0,S=$;S<d;S+=f){if(N<p[S])N=p[S]}for(S=$;S<d;S+=f){p[S]=N+h[$-1]}}}else if(o===All){for(N=0,S=0;S<d;++S){if(S%f&&N<p[S])N=p[S]}for(S=0;S<d;++S){if(S%f)p[S]=N+g}}else{for(o=false,$=1;$<f;++$){for(S=$;S<d;S+=f){p[S]+=h[$-1]}}}if(s===Each){for(A=1;A<c;++A){for(N=0,S=A*f,E=S+f;S<E;++S){if(N<m[S])N=m[S]}for(S=A*f;S<E;++S){m[S]=N+v[A-1]}}}else if(s===All){for(N=0,S=f;S<d;++S){if(N<m[S])N=m[S]}for(S=f;S<d;++S){m[S]=N+y}}else{for(s=false,A=1;A<c;++A){for(S=A*f,E=S+f;S<E;++S){m[S]+=v[A-1]}}}for(k=0,S=0;S<d;++S){k=p[S]+(S%f?k:0);_[S]+=k-t[S].x}for($=0;$<f;++$){for(O=0,S=$;S<d;S+=f){O+=m[S];b[S]+=O-t[S].y}}if(o&&get$1(n.center,Column)&&c>1){for(S=0;S<d;++S){D=o===All?g:h[S%f];k=D-x[S].x2-t[S].x-_[S];if(k>0)_[S]+=k/2}}if(s&&get$1(n.center,Row)&&f!==1){for(S=0;S<d;++S){D=s===All?y:v[~~(S/f)];O=D-x[S].y2-t[S].y-b[S];if(O>0)b[S]+=O/2}}for(S=0;S<d;++S){a.union(x[S].translate(_[S],b[S]))}k=get$1(n.anchor,X$1);O=get$1(n.anchor,Y$1);switch(get$1(n.anchor,Column)){case End$1:k-=a.width();break;case Middle$1:k-=a.width()/2}switch(get$1(n.anchor,Row)){case End$1:O-=a.height();break;case Middle$1:O-=a.height()/2}k=Math.round(k);O=Math.round(O);a.clear();for(S=0;S<d;++S){t[S].mark.bounds.clear()}for(S=0;S<d;++S){w=t[S];w.x+=_[S]+=k;w.y+=b[S]+=O;a.union(w.mark.bounds.union(w.bounds.translate(_[S],b[S])));if(r)e.dirty(w)}return a}function trellisLayout(e,t,n){var r=gridLayoutGroups(t),i=r.marks,a=n.bounds===Flush?boundFlush:boundFull,o=n.offset,s=n.columns||i.length,u=s<=0?1:Math.ceil(i.length/s),l=u*s,f,c,d,p,h,g,m;var v=gridLayout(e,i,n);if(v.empty())v.set(0,0,0,0);if(r.rowheaders){g=get$1(n.headerBand,Row,null);f=layoutHeaders(e,r.rowheaders,i,s,u,-get$1(o,"rowHeader"),min,0,a,"x1",0,s,1,g)}if(r.colheaders){g=get$1(n.headerBand,Column,null);c=layoutHeaders(e,r.colheaders,i,s,s,-get$1(o,"columnHeader"),min,1,a,"y1",0,1,s,g)}if(r.rowfooters){g=get$1(n.footerBand,Row,null);d=layoutHeaders(e,r.rowfooters,i,s,u,get$1(o,"rowFooter"),max,0,a,"x2",s-1,s,1,g)}if(r.colfooters){g=get$1(n.footerBand,Column,null);p=layoutHeaders(e,r.colfooters,i,s,s,get$1(o,"columnFooter"),max,1,a,"y2",l-s,1,s,g)}if(r.rowtitle){h=get$1(n.titleAnchor,Row);m=get$1(o,"rowTitle");m=h===End$1?d+m:f-m;g=get$1(n.titleBand,Row,.5);layoutTitle(e,r.rowtitle,m,0,v,g)}if(r.coltitle){h=get$1(n.titleAnchor,Column);m=get$1(o,"columnTitle");m=h===End$1?p+m:c-m;g=get$1(n.titleBand,Column,.5);layoutTitle(e,r.coltitle,m,1,v,g)}}function boundFlush(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):undefined}function boundFull(e,t){return e.bounds[t]}function layoutHeaders(e,t,n,r,i,a,o,s,u,l,f,c,d,p){var h=n.length,g=0,m=0,v,y,_,b,x,E,S,$,A;if(!h)return g;for(v=f;v<h;v+=c){if(n[v])g=o(g,u(n[v],l))}if(!t.length)return g;if(t.length>i){e.warn("Grid headers exceed limit: "+i);t=t.slice(0,i)}g+=a;for(y=0,b=t.length;y<b;++y){e.dirty(t[y]);t[y].mark.bounds.clear()}for(v=f,y=0,b=t.length;y<b;++y,v+=c){E=t[y];x=E.mark.bounds;for(_=v;_>=0&&(S=n[_])==null;_-=d);if(s){$=p==null?S.x:Math.round(S.bounds.x1+p*S.bounds.width());A=g}else{$=g;A=p==null?S.y:Math.round(S.bounds.y1+p*S.bounds.height())}x.union(E.bounds.translate($-(E.x||0),A-(E.y||0)));E.x=$;E.y=A;e.dirty(E);m=o(m,x[l])}return m}function layoutTitle(e,t,n,r,i,a){if(!t)return;e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height());t.bounds.translate(o-(t.x||0),s-(t.y||0));t.mark.bounds.clear().union(t.bounds);t.x=o;t.y=s;e.dirty(t)}function lookup$1$1(e,t){var n=e[t]||{};return function(t,r){return n[t]!=null?n[t]:e[t]!=null?e[t]:r}}function offsets(e,t){var n=-Infinity;e.forEach((function(e){if(e.offset!=null)n=Math.max(n,e.offset)}));return n>-Infinity?n:t}function legendParams(e,t,n,r,i,a,o){var s=lookup$1$1(n,t),u=offsets(e,s("offset",0)),l=s("anchor",Start$1),f=l===End$1?1:l===Middle$1?.5:0;var c={align:Each,bounds:s("bounds",Flush),columns:s("direction")==="vertical"?1:e.length,padding:s("margin",8),center:s("center"),nodirty:true};switch(t){case Left$1:c.anchor={x:Math.floor(r.x1)-u,column:End$1,y:f*(o||r.height()+2*r.y1),row:l};break;case Right$1:c.anchor={x:Math.ceil(r.x2)+u,y:f*(o||r.height()+2*r.y1),row:l};break;case Top$1:c.anchor={y:Math.floor(i.y1)-u,row:End$1,x:f*(a||i.width()+2*i.x1),column:l};break;case Bottom$1:c.anchor={y:Math.ceil(i.y2)+u,x:f*(a||i.width()+2*i.x1),column:l};break;case TopLeft:c.anchor={x:u,y:u};break;case TopRight:c.anchor={x:a-u,y:u,column:End$1};break;case BottomLeft:c.anchor={x:u,y:o-u,row:End$1};break;case BottomRight:c.anchor={x:a-u,y:o-u,column:End$1,row:End$1};break}return c}function legendLayout(e,t){var n=t.items[0],r=n.datum,i=n.orient,a=n.bounds,o=n.x,s=n.y,u,l;n._bounds?n._bounds.clear().union(a):n._bounds=a.clone();a.clear();legendGroupLayout(e,n,n.items[0].items[0]);a=legendBounds(n,a);u=2*n.padding;l=2*n.padding;if(!a.empty()){u=Math.ceil(a.width()+u);l=Math.ceil(a.height()+l)}if(r.type===Symbols$1){legendEntryLayout(n.items[0].items[0].items[0].items)}if(i!==None){n.x=o=0;n.y=s=0}n.width=u;n.height=l;boundStroke(a.set(o,s,o+u,s+l),n);n.mark.bounds.clear().union(a);return n}function legendBounds(e,t){e.items.forEach((function(e){return t.union(e.bounds)}));t.x1=e.padding;t.y1=e.padding;return t}function legendGroupLayout(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(!t.datum.title){if(i||a)translate$1(e,n,i,a)}else{var o=t.items[1].items[0],s=o.anchor,u=t.titlePadding||0,l=r-o.x,f=r-o.y;switch(o.orient){case Left$1:i+=Math.ceil(o.bounds.width())+u;break;case Right$1:case Bottom$1:break;default:a+=o.bounds.height()+u}if(i||a)translate$1(e,n,i,a);switch(o.orient){case Left$1:f+=legendTitleOffset(t,n,o,s,1,1);break;case Right$1:l+=legendTitleOffset(t,n,o,End$1,0,0)+u;f+=legendTitleOffset(t,n,o,s,1,1);break;case Bottom$1:l+=legendTitleOffset(t,n,o,s,0,0);f+=legendTitleOffset(t,n,o,End$1,-1,0,1)+u;break;default:l+=legendTitleOffset(t,n,o,s,0,0)}if(l||f)translate$1(e,o,l,f);if((l=Math.round(o.bounds.x1-r))<0){translate$1(e,n,-l,0);translate$1(e,o,-l,0)}}}function legendTitleOffset(e,t,n,r,i,a,o){var s=e.datum.type!=="symbol",u=n.datum.vgrad,l=s&&(a||!u)&&!o?t.items[0]:t,f=l.bounds[i?"y2":"x2"]-e.padding,c=u&&a?f:0,d=u&&a?0:f,p=i<=0?0:multiLineOffset(n);return Math.round(r===Start$1?c:r===End$1?d-p:.5*(f-p))}function translate$1(e,t,n,r){t.x+=n;t.y+=r;t.bounds.translate(n,r);t.mark.bounds.translate(n,r);e.dirty(t)}function legendEntryLayout(e){var t=e.reduce((function(e,t){e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0);return e}),{});e.forEach((function(e){e.width=t[e.column];e.height=e.bounds.y2-e.y}))}function titleLayout(e,t,n,r,i){var a=t.items[0],o=a.frame,s=a.orient,u=a.anchor,l=a.offset,f=a.padding,c=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],p=s===Left$1||s===Right$1?r:n,h=0,g=0,m=0,v=0,y=0,_;if(o!==Group){s===Left$1?(h=i.y2,p=i.y1):s===Right$1?(h=i.y1,p=i.y2):(h=i.x1,p=i.x2)}else if(s===Left$1){h=r,p=0}_=u===Start$1?h:u===End$1?p:(h+p)/2;if(d&&d.text){switch(s){case Top$1:case Bottom$1:y=c.bounds.height()+f;break;case Left$1:v=c.bounds.width()+f;break;case Right$1:v=-c.bounds.width()-f;break}tempBounds.clear().union(d.bounds);tempBounds.translate(v-(d.x||0),y-(d.y||0));if(set$3(d,"x",v)|set$3(d,"y",y)){e.dirty(d);d.bounds.clear().union(tempBounds);d.mark.bounds.clear().union(tempBounds);e.dirty(d)}tempBounds.clear().union(d.bounds)}else{tempBounds.clear()}tempBounds.union(c.bounds);switch(s){case Top$1:g=_;m=i.y1-tempBounds.height()-l;break;case Left$1:g=i.x1-tempBounds.width()-l;m=_;break;case Right$1:g=i.x2+tempBounds.width()+l;m=_;break;case Bottom$1:g=_;m=i.y2+l;break;default:g=a.x;m=a.y}if(set$3(a,"x",g)|set$3(a,"y",m)){tempBounds.translate(g,m);e.dirty(a);a.bounds.clear().union(tempBounds);t.bounds.clear().union(tempBounds);e.dirty(a)}return a.bounds}function ViewLayout$1(e){Transform.call(this,null,e)}inherits(ViewLayout$1,Transform,{transform:function(e,t){var n=t.dataflow;e.mark.items.forEach((function(t){if(e.layout)trellisLayout(n,t,e.layout);layoutGroup(n,t,e)}));return shouldReflow(e.mark.group)?t.reflow():t}});function shouldReflow(e){return e&&e.mark.role!=="legend-entry"}function layoutGroup(e,t,n){var r=t.items,i=Math.max(0,t.width||0),a=Math.max(0,t.height||0),o=(new Bounds).set(0,0,i,a),s=o.clone(),u=o.clone(),l=[],f,c,d,p,h,g;for(h=0,g=r.length;h<g;++h){c=r[h];switch(c.role){case AxisRole$1:p=isYAxis(c)?s:u;p.union(axisLayout(e,c,i,a));break;case TitleRole$1:f=c;break;case LegendRole$1:l.push(legendLayout(e,c));break;case FrameRole$1:case ScopeRole$1:case RowHeader:case RowFooter:case RowTitle:case ColHeader:case ColFooter:case ColTitle:s.union(c.bounds);u.union(c.bounds);break;default:o.union(c.bounds)}}if(l.length){var m={};l.forEach((function(e){d=e.orient||Right$1;if(d!==None)(m[d]||(m[d]=[])).push(e)}));for(var v in m){var y=m[v];gridLayout(e,y,legendParams(y,v,n.legends,s,u,i,a))}l.forEach((function(t){var r=t.bounds;if(!r.equals(t._bounds)){t.bounds=t._bounds;e.dirty(t);t.bounds=r;e.dirty(t)}if(n.autosize&&n.autosize.type===Fit){switch(t.orient){case Left$1:case Right$1:o.add(r.x1,0).add(r.x2,0);break;case Top$1:case Bottom$1:o.add(0,r.y1).add(0,r.y2)}}else{o.union(r)}}))}o.union(s).union(u);if(f){o.union(titleLayout(e,f,i,a,o))}if(t.clip){o.set(0,0,t.width||0,t.height||0)}viewSizeLayout(e,t,o,n)}function viewSizeLayout(e,t,n,r){var i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;var o=e._width,s=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),f=Math.max(0,t.height||0),c=Math.max(0,Math.ceil(-n.y1));var d=Math.max(0,Math.ceil(n.x2-u)),p=Math.max(0,Math.ceil(n.y2-f));if(i.contains===Padding$1){var h=e.padding();o-=h.left+h.right;s-=h.top+h.bottom}if(a===None){l=0;c=0;u=o;f=s}else if(a===Fit){u=Math.max(0,o-l-d);f=Math.max(0,s-c-p)}else if(a===FitX){u=Math.max(0,o-l-d);s=f+c+p}else if(a===FitY){o=u+l+d;f=Math.max(0,s-c-p)}else if(a===Pad){o=u+l+d;s=f+c+p}e._resizeView(o,s,u,f,[l,c],i.resize)}var vtx=Object.freeze({__proto__:null,bound:Bound$1,identifier:Identifier$1,mark:Mark$2,overlap:Overlap$1,render:Render$1,viewlayout:ViewLayout$1});function AxisTicks$1(e){Transform.call(this,null,e)}inherits(AxisTicks$1,Transform,{transform:function(e,t){if(this.value&&!e.modified()){return t.StopPropagation}var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,s=tickCount(a,o,e.minstep),u=e.format||tickFormat(n,a,s,e.formatSpecifier,e.formatType,!!e.values),l=e.values?validTicks(a,e.values,s):tickValues(a,s);if(i)r.rem=i;i=l.map((function(e,t){return ingest$1({index:t/(l.length-1||1),value:e,label:u(e)})}));if(e.extra&&i.length){i.push(ingest$1({index:-1,extra:{value:i[0].value},label:""}))}r.source=i;r.add=i;this.value=i;return r}});function DataJoin$1(e){Transform.call(this,null,e)}function defaultItemCreate(){return ingest$1({})}function newMap(e){var t=fastmap().test((function(e){return e.exit}));t.lookup=function(n){return t.get(e(n))};return t}inherits(DataJoin$1,Transform,{transform:function(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||defaultItemCreate,a=e.key||tupleid,o=this.value;if(isArray(r.encode)){r.encode=null}if(o&&(e.modified("key")||t.modified(a))){error("DataJoin does not support modified key function or fields.")}if(!o){t=t.addAll();this.value=o=newMap(a)}t.visit(t.ADD,(function(e){var t=a(e);var n=o.get(t);if(n){if(n.exit){o.empty--;r.add.push(n)}else{r.mod.push(n)}}else{n=i(e);o.set(t,n);r.add.push(n)}n.datum=e;n.exit=false}));t.visit(t.MOD,(function(e){var t=a(e),n=o.get(t);if(n){n.datum=e;r.mod.push(n)}}));t.visit(t.REM,(function(e){var t=a(e),n=o.get(t);if(e===n.datum&&!n.exit){r.rem.push(n);n.exit=true;++o.empty}}));if(t.changed(t.ADD_MOD))r.modifies("datum");if(t.clean()||e.clean&&o.empty>n.cleanThreshold){n.runAfter(o.clean)}return r}});function Encode$1(e){Transform.call(this,null,e)}inherits(Encode$1,Transform,{transform:function(e,t){var n=t.fork(t.ADD_REM),r=e.mod||false,i=e.encoders,a=t.encode;if(isArray(a)){if(n.changed()||a.every((function(e){return i[e]}))){a=a[0];n.encode=null}else{return t.StopPropagation}}var o=a==="enter",s=i.update||falsy,u=i.enter||falsy,l=i.exit||falsy,f=(a&&!o?i[a]:s)||falsy;if(t.changed(t.ADD)){t.visit(t.ADD,(function(t){u(t,e);s(t,e)}));n.modifies(u.output);n.modifies(s.output);if(f!==falsy&&f!==s){t.visit(t.ADD,(function(t){f(t,e)}));n.modifies(f.output)}}if(t.changed(t.REM)&&l!==falsy){t.visit(t.REM,(function(t){l(t,e)}));n.modifies(l.output)}if(o||f!==falsy){var c=t.MOD|(e.modified()?t.REFLOW:0);if(o){t.visit(c,(function(t){var i=u(t,e)||r;if(f(t,e)||i)n.mod.push(t)}));if(n.mod.length)n.modifies(u.output)}else{t.visit(c,(function(t){if(f(t,e)||r)n.mod.push(t)}))}if(n.mod.length)n.modifies(f.output)}return n.changed()?n:t.StopPropagation}});function LegendEntries$1(e){Transform.call(this,[],e)}inherits(LegendEntries$1,Transform,{transform:function(e,t){if(this.value!=null&&!e.modified()){return t.StopPropagation}var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.type||SymbolLegend,o=e.scale,s=+e.limit,u=tickCount(o,e.count==null?5:e.count,e.minstep),l=!!e.values||a===SymbolLegend,f=e.format||labelFormat(n,o,u,a,e.formatSpecifier,e.formatType,l),c=e.values||labelValues(o,u),d,p,h,g,m;if(i)r.rem=i;if(a===SymbolLegend){if(s&&c.length>s){t.dataflow.warn("Symbol legend count exceeds limit, filtering items.");i=c.slice(0,s-1);m=true}else{i=c}if(isFunction(h=e.size)){if(!e.values&&o(i[0])===0){i=i.slice(1)}g=i.reduce((function(t,n){return Math.max(t,h(n,e))}),0)}else{h=constant$4(g=h||8)}i=i.map((function(t,n){return ingest$1({index:n,label:f(t,n,i),value:t,offset:g,size:h(t,e)})}));if(m){m=c[i.length];i.push(ingest$1({index:i.length,label:"…".concat(c.length-i.length," entries"),value:m,offset:g,size:h(m,e)}))}}else if(a===GradientLegend){d=o.domain(),p=scaleFraction(o,d[0],peek$1(d));if(c.length<3&&!e.values&&d[0]!==peek$1(d)){c=[d[0],peek$1(d)]}i=c.map((function(e,t){return ingest$1({index:t,label:f(e,t,c),value:e,perc:p(e)})}))}else{h=c.length-1;p=labelFraction(o);i=c.map((function(e,t){return ingest$1({index:t,label:f(e,t,c),value:e,perc:t?p(e):0,perc2:t===h?1:p(c[t+1])})}))}r.source=i;r.add=i;this.value=i;return r}});var sourceX=function(e){return e.source.x};var sourceY=function(e){return e.source.y};var targetX=function(e){return e.target.x};var targetY=function(e){return e.target.y};function LinkPath(e){Transform.call(this,{},e)}LinkPath.Definition={type:"LinkPath",metadata:{modifies:true},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};inherits(LinkPath,Transform,{transform:function(e,t){var n=e.sourceX||sourceX,r=e.sourceY||sourceY,i=e.targetX||targetX,a=e.targetY||targetY,o=e.as||"path",s=e.orient||"vertical",u=e.shape||"line",l=Paths.get(u+"-"+s)||Paths.get(u);if(!l){error("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:""))}t.visit(t.SOURCE,(function(e){e[o]=l(n(e),r(e),i(e),a(e))}));return t.reflow(e.modified()).modifies(o)}});var line$1=function(e,t,n,r){return"M"+e+","+t+"L"+n+","+r};var lineR=function(e,t,n,r){return line$1(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))};var arc$1=function(e,t,n,r){var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2,s=180*Math.atan2(a,i)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+s+" 0 1"+" "+n+","+r};var arcR=function(e,t,n,r){return arc$1(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))};var curve=function(e,t,n,r){var i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r};var curveR=function(e,t,n,r){return curve(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))};var orthoX=function(e,t,n,r){return"M"+e+","+t+"V"+r+"H"+n};var orthoY=function(e,t,n,r){return"M"+e+","+t+"H"+n+"V"+r};var orthoR=function(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s};var diagonalX=function(e,t,n,r){var i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r};var diagonalY=function(e,t,n,r){var i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r};var diagonalR=function(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),u=(t+r)/2;return"M"+t*i+","+t*a+"C"+u*i+","+u*a+" "+u*o+","+u*s+" "+r*o+","+r*s};var Paths=fastmap({line:line$1,"line-radial":lineR,arc:arc$1,"arc-radial":arcR,curve:curve,"curve-radial":curveR,"orthogonal-horizontal":orthoX,"orthogonal-vertical":orthoY,"orthogonal-radial":orthoR,"diagonal-horizontal":diagonalX,"diagonal-vertical":diagonalY,"diagonal-radial":diagonalR});function Pie(e){Transform.call(this,null,e)}Pie.Definition={type:"Pie",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:false},{name:"as",type:"string",array:true,length:2,default:["startAngle","endAngle"]}]};inherits(Pie,Transform,{transform:function(e,t){var n=e.as||["startAngle","endAngle"],r=n[0],i=n[1],a=e.field||one$2,o=e.startAngle||0,s=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(a),f=l.length,c=o,d=(s-o)/sum(l),p=range$1$1(f),h,g,m;if(e.sort){p.sort((function(e,t){return l[e]-l[t]}))}for(h=0;h<f;++h){m=l[p[h]];g=u[p[h]];g[r]=c;g[i]=c+=m*d}this.value=l;return t.reflow(e.modified()).modifies(n)}});var DEFAULT_COUNT=5;function includeZero(e){var t=e.type;return!e.bins&&(t===Linear||t===Pow||t===Sqrt)}function includePad(e){return isContinuous(e)&&e!==Sequential}var SKIP$1=toSet(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Scale$1(e){Transform.call(this,null,e);this.modified(true)}inherits(Scale$1,Transform,{transform:function(e,t){var n=t.dataflow,r=this.value,i=scaleKey(e);if(!r||i!==r.type){this.value=r=scale$4(i)()}for(i in e)if(!SKIP$1[i]){if(i==="padding"&&includePad(r.type))continue;isFunction(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}configureRange(r,e,configureBins(r,e,configureDomain(r,e,n)));return t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function scaleKey(e){var t=e.type,n="",r;if(t===Sequential)return Sequential+"-"+Linear;if(isContinuousColor(e)){r=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0;n=r===2?Sequential+"-":r===3?Diverging+"-":""}return(n+t||Linear).toLowerCase()}function isContinuousColor(e){var t=e.type;return isContinuous(t)&&t!==Time&&t!==UTC&&(e.scheme||e.range&&e.range.length&&e.range.every(isString))}function configureDomain(e,t,n){var r=rawDomain(e,t.domainRaw,n);if(r>-1)return r;var i=t.domain,a=e.type,o=t.zero||t.zero===undefined&&includeZero(e),s,u;if(!i)return 0;if(includePad(a)&&t.padding&&i[0]!==peek$1(i)){i=padDomain(a,i,t.range,t.padding,t.exponent,t.constant)}if(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null){s=(i=i.slice()).length-1||1;if(o){if(i[0]>0)i[0]=0;if(i[s]<0)i[s]=0}if(t.domainMin!=null)i[0]=t.domainMin;if(t.domainMax!=null)i[s]=t.domainMax;if(t.domainMid!=null){u=t.domainMid;var l=u>i[s]?s+1:u<i[0]?0:s;if(l!==s)n.warn("Scale domainMid exceeds domain min or max.",u);i.splice(l,0,u)}}e.domain(domainCheck(a,i,n));if(a===Ordinal){e.unknown(t.domainImplicit?implicit:undefined)}if(t.nice&&e.nice){e.nice(t.nice!==true&&tickCount(e,t.nice)||null)}return i.length}function rawDomain(e,t,n){if(t){e.domain(domainCheck(e.type,t,n));return t.length}else{return-1}}function padDomain(e,t,n,r,i,a){var o=Math.abs(peek$1(n)-n[0]),s=o/(o-2*r),u=e===Log?zoomLog(t,null,s):e===Sqrt?zoomPow(t,null,s,.5):e===Pow?zoomPow(t,null,s,i||1):e===Symlog?zoomSymlog(t,null,s,a||1):zoomLinear(t,null,s);t=t.slice();t[0]=u[0];t[t.length-1]=u[1];return t}function domainCheck(e,t,n){if(isLogarithmic(e)){var r=Math.abs(t.reduce((function(e,t){return e+(t<0?-1:t>0?1:0)}),0));if(r!==t.length){n.warn("Log scale domain includes zero: "+$$1(t))}}return t}function configureBins(e,t,n){var r=t.bins;if(r&&!isArray(r)){var i=e.domain(),a=i[0],o=peek$1(i),s=r.step;var u=r.start==null?a:r.start,l=r.stop==null?o:r.stop;if(!s)error("Scale bins parameter missing step property.");if(u<a)u=s*Math.ceil(a/s);if(l>o)l=s*Math.floor(o/s);r=range$1$1(u,l+s/2,s)}if(r){e.bins=r}else if(e.bins){delete e.bins}if(e.type===BinOrdinal){if(!r){e.bins=e.domain()}else if(!t.domain&&!t.domainRaw){e.domain(r);n=r.length}}return n}function configureRange(e,t,n){var r=e.type,i=t.round||false,a=t.range;if(t.rangeStep!=null){a=configureRangeStep(r,t,n)}else if(t.scheme){a=configureScheme(r,t,n);if(isFunction(a)){if(e.interpolator){return e.interpolator(a)}else{error("Scale type ".concat(r," does not support interpolating color schemes."))}}}if(a&&isInterpolating(r)){return e.interpolator(interpolateColors(flip(a,t.reverse),t.interpolate,t.interpolateGamma))}if(a&&t.interpolate&&e.interpolate){e.interpolate(interpolate$1(t.interpolate,t.interpolateGamma))}else if(isFunction(e.round)){e.round(i)}else if(isFunction(e.rangeRound)){e.interpolate(i?interpolateRound:interpolate$1$1)}if(a)e.range(flip(a,t.reverse))}function configureRangeStep(e,t,n){if(e!==Band&&e!==Point){error("Only band and point scales support rangeStep.")}var r=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,i=e===Point?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*bandSpace(n,i,r)]}function configureScheme(e,t,n){var r=t.schemeExtent,i,a;if(isArray(t.scheme)){a=interpolateColors(t.scheme,t.interpolate,t.interpolateGamma)}else{i=t.scheme.toLowerCase();a=scheme$1(i);if(!a)error("Unrecognized scheme name: ".concat(t.scheme))}n=e===Threshold?n+1:e===BinOrdinal?n-1:e===Quantile||e===Quantize?+t.schemeCount||DEFAULT_COUNT:n;return isInterpolating(e)?adjustScheme(a,r,t.reverse):isFunction(a)?quantizeInterpolator(adjustScheme(a,r),n):e===Ordinal?a:a.slice(0,n)}function adjustScheme(e,t,n){return isFunction(e)&&(t||n)?interpolateRange$1(e,flip(t||[0,1],n)):e}function flip(e,t){return t?e.slice().reverse():e}function SortItems$1(e){Transform.call(this,null,e)}inherits(SortItems$1,Transform,{transform:function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");if(n)t.source.sort(stableCompare(e.sort));this.modified(n);return t}});var Zero="zero",Center$1="center",Normalize="normalize",DefOutput=["y0","y1"];function Stack(e){Transform.call(this,null,e)}Stack.Definition={type:"Stack",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:true},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:Zero,values:[Zero,Center$1,Normalize]},{name:"as",type:"string",array:true,length:2,default:DefOutput}]};inherits(Stack,Transform,{transform:function(e,t){var n=e.as||DefOutput,r=n[0],i=n[1],a=stableCompare(e.sort),o=e.field||one$2,s=e.offset===Center$1?stackCenter:e.offset===Normalize?stackNormalize:stackZero,u,l,f,c;u=partition$3(t.source,e.groupby,a,o);for(l=0,f=u.length,c=u.max;l<f;++l){s(u[l],c,o,r,i)}return t.reflow(e.modified()).modifies(n)}});function stackCenter(e,t,n,r,i){var a=(t-e.sum)/2,o=e.length,s=0,u;for(;s<o;++s){u=e[s];u[r]=a;u[i]=a+=Math.abs(n(u))}}function stackNormalize(e,t,n,r,i){var a=1/e.sum,o=0,s=e.length,u=0,l=0,f;for(;u<s;++u){f=e[u];f[r]=o;f[i]=o=a*(l+=Math.abs(n(f)))}}function stackZero(e,t,n,r,i){var a=0,o=0,s=e.length,u=0,l,f;for(;u<s;++u){f=e[u];l=+n(f);if(l<0){f[r]=o;f[i]=o+=l}else{f[r]=a;f[i]=a+=l}}}function partition$3(e,t,n,r){var i=[],a=function(e){return e(f)},o,s,u,l,f,c,d,p,h;if(t==null){i.push(e.slice())}else{for(o={},s=0,u=e.length;s<u;++s){f=e[s];c=t.map(a);d=o[c];if(!d){o[c]=d=[];i.push(d)}d.push(f)}}for(c=0,h=0,l=i.length;c<l;++c){d=i[c];for(s=0,p=0,u=d.length;s<u;++s){p+=Math.abs(r(d[s]))}d.sum=p;if(p>h)h=p;if(n)d.sort(n)}i.max=h;return i}var encode$1=Object.freeze({__proto__:null,axisticks:AxisTicks$1,datajoin:DataJoin$1,encode:Encode$1,legendentries:LegendEntries$1,linkpath:LinkPath,pie:Pie,scale:Scale$1,sortitems:SortItems$1,stack:Stack});var epsilon$2=1e-6;var epsilon2=1e-12;var pi$1=Math.PI;var halfPi$1=pi$1/2;var quarterPi=pi$1/4;var tau$1=pi$1*2;var degrees=180/pi$1;var radians=pi$1/180;var abs$1=Math.abs;var atan=Math.atan;var atan2=Math.atan2;var cos$1=Math.cos;var ceil=Math.ceil;var exp=Math.exp;var hypot=Math.hypot;var log$1=Math.log;var pow$1=Math.pow;var sin$1=Math.sin;var sign=Math.sign||function(e){return e>0?1:e<0?-1:0};var sqrt$1=Math.sqrt;var tan=Math.tan;function acos(e){return e>1?0:e<-1?pi$1:Math.acos(e)}function asin$1(e){return e>1?halfPi$1:e<-1?-halfPi$1:Math.asin(e)}function noop$2(){}function streamGeometry(e,t){if(e&&streamGeometryType.hasOwnProperty(e.type)){streamGeometryType[e.type](e,t)}}var streamObjectType={Feature:function(e,t){streamGeometry(e.geometry,t)},FeatureCollection:function(e,t){var n=e.features,r=-1,i=n.length;while(++r<i)streamGeometry(n[r].geometry,t)}};var streamGeometryType={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates;t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){streamLine(e.coordinates,t,0)},MultiLineString:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)streamLine(n[r],t,0)},Polygon:function(e,t){streamPolygon(e.coordinates,t)},MultiPolygon:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)streamPolygon(n[r],t)},GeometryCollection:function(e,t){var n=e.geometries,r=-1,i=n.length;while(++r<i)streamGeometry(n[r],t)}};function streamLine(e,t,n){var r=-1,i=e.length-n,a;t.lineStart();while(++r<i)a=e[r],t.point(a[0],a[1],a[2]);t.lineEnd()}function streamPolygon(e,t){var n=-1,r=e.length;t.polygonStart();while(++n<r)streamLine(e[n],t,1);t.polygonEnd()}function geoStream(e,t){if(e&&streamObjectType.hasOwnProperty(e.type)){streamObjectType[e.type](e,t)}else{streamGeometry(e,t)}}var areaRingSum$1=new Adder;var areaSum$1=new Adder,lambda00$2,phi00$2,lambda0$1,cosPhi0,sinPhi0;var areaStream$1={point:noop$2,lineStart:noop$2,lineEnd:noop$2,polygonStart:function(){areaRingSum$1=new Adder;areaStream$1.lineStart=areaRingStart$1;areaStream$1.lineEnd=areaRingEnd$1},polygonEnd:function(){var e=+areaRingSum$1;areaSum$1.add(e<0?tau$1+e:e);this.lineStart=this.lineEnd=this.point=noop$2},sphere:function(){areaSum$1.add(tau$1)}};function areaRingStart$1(){areaStream$1.point=areaPointFirst$1}function areaRingEnd$1(){areaPoint$1(lambda00$2,phi00$2)}function areaPointFirst$1(e,t){areaStream$1.point=areaPoint$1;lambda00$2=e,phi00$2=t;e*=radians,t*=radians;lambda0$1=e,cosPhi0=cos$1(t=t/2+quarterPi),sinPhi0=sin$1(t)}function areaPoint$1(e,t){e*=radians,t*=radians;t=t/2+quarterPi;var n=e-lambda0$1,r=n>=0?1:-1,i=r*n,a=cos$1(t),o=sin$1(t),s=sinPhi0*o,u=cosPhi0*a+s*cos$1(i),l=s*r*sin$1(i);areaRingSum$1.add(atan2(l,u));lambda0$1=e,cosPhi0=a,sinPhi0=o}function geoArea$1(e){areaSum$1=new Adder;geoStream(e,areaStream$1);return areaSum$1*2}function spherical(e){return[atan2(e[1],e[0]),asin$1(e[2])]}function cartesian(e){var t=e[0],n=e[1],r=cos$1(n);return[r*cos$1(t),r*sin$1(t),sin$1(n)]}function cartesianDot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cartesianCross(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function cartesianAddInPlace(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function cartesianScale(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function cartesianNormalizeInPlace(e){var t=sqrt$1(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var lambda0,phi0,lambda1,phi1,lambda2,lambda00$1,phi00$1,p0,deltaSum,ranges,range$3;var boundsStream$1={point:boundsPoint$1,lineStart:boundsLineStart,lineEnd:boundsLineEnd,polygonStart:function(){boundsStream$1.point=boundsRingPoint;boundsStream$1.lineStart=boundsRingStart;boundsStream$1.lineEnd=boundsRingEnd;deltaSum=new Adder;areaStream$1.polygonStart()},polygonEnd:function(){areaStream$1.polygonEnd();boundsStream$1.point=boundsPoint$1;boundsStream$1.lineStart=boundsLineStart;boundsStream$1.lineEnd=boundsLineEnd;if(areaRingSum$1<0)lambda0=-(lambda1=180),phi0=-(phi1=90);else if(deltaSum>epsilon$2)phi1=90;else if(deltaSum<-epsilon$2)phi0=-90;range$3[0]=lambda0,range$3[1]=lambda1},sphere:function(){lambda0=-(lambda1=180),phi0=-(phi1=90)}};function boundsPoint$1(e,t){ranges.push(range$3=[lambda0=e,lambda1=e]);if(t<phi0)phi0=t;if(t>phi1)phi1=t}function linePoint(e,t){var n=cartesian([e*radians,t*radians]);if(p0){var r=cartesianCross(p0,n),i=[r[1],-r[0],0],a=cartesianCross(i,r);cartesianNormalizeInPlace(a);a=spherical(a);var o=e-lambda2,s=o>0?1:-1,u=a[0]*degrees*s,l,f=abs$1(o)>180;if(f^(s*lambda2<u&&u<s*e)){l=a[1]*degrees;if(l>phi1)phi1=l}else if(u=(u+360)%360-180,f^(s*lambda2<u&&u<s*e)){l=-a[1]*degrees;if(l<phi0)phi0=l}else{if(t<phi0)phi0=t;if(t>phi1)phi1=t}if(f){if(e<lambda2){if(angle(lambda0,e)>angle(lambda0,lambda1))lambda1=e}else{if(angle(e,lambda1)>angle(lambda0,lambda1))lambda0=e}}else{if(lambda1>=lambda0){if(e<lambda0)lambda0=e;if(e>lambda1)lambda1=e}else{if(e>lambda2){if(angle(lambda0,e)>angle(lambda0,lambda1))lambda1=e}else{if(angle(e,lambda1)>angle(lambda0,lambda1))lambda0=e}}}}else{ranges.push(range$3=[lambda0=e,lambda1=e])}if(t<phi0)phi0=t;if(t>phi1)phi1=t;p0=n,lambda2=e}function boundsLineStart(){boundsStream$1.point=linePoint}function boundsLineEnd(){range$3[0]=lambda0,range$3[1]=lambda1;boundsStream$1.point=boundsPoint$1;p0=null}function boundsRingPoint(e,t){if(p0){var n=e-lambda2;deltaSum.add(abs$1(n)>180?n+(n>0?360:-360):n)}else{lambda00$1=e,phi00$1=t}areaStream$1.point(e,t);linePoint(e,t)}function boundsRingStart(){areaStream$1.lineStart()}function boundsRingEnd(){boundsRingPoint(lambda00$1,phi00$1);areaStream$1.lineEnd();if(abs$1(deltaSum)>epsilon$2)lambda0=-(lambda1=180);range$3[0]=lambda0,range$3[1]=lambda1;p0=null}function angle(e,t){return(t-=e)<0?t+360:t}function rangeCompare(e,t){return e[0]-t[0]}function rangeContains(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function geoBounds$1(e){var t,n,r,i,a,o,s;phi1=lambda1=-(lambda0=phi0=Infinity);ranges=[];geoStream(e,boundsStream$1);if(n=ranges.length){ranges.sort(rangeCompare);for(t=1,r=ranges[0],a=[r];t<n;++t){i=ranges[t];if(rangeContains(r,i[0])||rangeContains(r,i[1])){if(angle(r[0],i[1])>angle(r[0],r[1]))r[1]=i[1];if(angle(i[0],r[1])>angle(r[0],r[1]))r[0]=i[0]}else{a.push(r=i)}}for(o=-Infinity,n=a.length-1,t=0,r=a[n];t<=n;r=i,++t){i=a[t];if((s=angle(r[1],i[0]))>o)o=s,lambda0=i[0],lambda1=r[1]}}ranges=range$3=null;return lambda0===Infinity||phi0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[lambda0,phi0],[lambda1,phi1]]}var W0,W1,X0$1,Y0$1,Z0$1,X1$1,Y1$1,Z1$1,X2$2,Y2$2,Z2$1,lambda00,phi00,x0$4,y0$4,z0;var centroidStream$1={sphere:noop$2,point:centroidPoint$1,lineStart:centroidLineStart$1,lineEnd:centroidLineEnd$1,polygonStart:function(){centroidStream$1.lineStart=centroidRingStart$1;centroidStream$1.lineEnd=centroidRingEnd$1},polygonEnd:function(){centroidStream$1.lineStart=centroidLineStart$1;centroidStream$1.lineEnd=centroidLineEnd$1}};function centroidPoint$1(e,t){e*=radians,t*=radians;var n=cos$1(t);centroidPointCartesian(n*cos$1(e),n*sin$1(e),sin$1(t))}function centroidPointCartesian(e,t,n){++W0;X0$1+=(e-X0$1)/W0;Y0$1+=(t-Y0$1)/W0;Z0$1+=(n-Z0$1)/W0}function centroidLineStart$1(){centroidStream$1.point=centroidLinePointFirst}function centroidLinePointFirst(e,t){e*=radians,t*=radians;var n=cos$1(t);x0$4=n*cos$1(e);y0$4=n*sin$1(e);z0=sin$1(t);centroidStream$1.point=centroidLinePoint;centroidPointCartesian(x0$4,y0$4,z0)}function centroidLinePoint(e,t){e*=radians,t*=radians;var n=cos$1(t),r=n*cos$1(e),i=n*sin$1(e),a=sin$1(t),o=atan2(sqrt$1((o=y0$4*a-z0*i)*o+(o=z0*r-x0$4*a)*o+(o=x0$4*i-y0$4*r)*o),x0$4*r+y0$4*i+z0*a);W1+=o;X1$1+=o*(x0$4+(x0$4=r));Y1$1+=o*(y0$4+(y0$4=i));Z1$1+=o*(z0+(z0=a));centroidPointCartesian(x0$4,y0$4,z0)}function centroidLineEnd$1(){centroidStream$1.point=centroidPoint$1}function centroidRingStart$1(){centroidStream$1.point=centroidRingPointFirst}function centroidRingEnd$1(){centroidRingPoint(lambda00,phi00);centroidStream$1.point=centroidPoint$1}function centroidRingPointFirst(e,t){lambda00=e,phi00=t;e*=radians,t*=radians;centroidStream$1.point=centroidRingPoint;var n=cos$1(t);x0$4=n*cos$1(e);y0$4=n*sin$1(e);z0=sin$1(t);centroidPointCartesian(x0$4,y0$4,z0)}function centroidRingPoint(e,t){e*=radians,t*=radians;var n=cos$1(t),r=n*cos$1(e),i=n*sin$1(e),a=sin$1(t),o=y0$4*a-z0*i,s=z0*r-x0$4*a,u=x0$4*i-y0$4*r,l=hypot(o,s,u),f=asin$1(l),c=l&&-f/l;X2$2.add(c*o);Y2$2.add(c*s);Z2$1.add(c*u);W1+=f;X1$1+=f*(x0$4+(x0$4=r));Y1$1+=f*(y0$4+(y0$4=i));Z1$1+=f*(z0+(z0=a));centroidPointCartesian(x0$4,y0$4,z0)}function geoCentroid$1(e){W0=W1=X0$1=Y0$1=Z0$1=X1$1=Y1$1=Z1$1=0;X2$2=new Adder;Y2$2=new Adder;Z2$1=new Adder;geoStream(e,centroidStream$1);var t=+X2$2,n=+Y2$2,r=+Z2$1,i=hypot(t,n,r);if(i<epsilon2){t=X1$1,n=Y1$1,r=Z1$1;if(W1<epsilon$2)t=X0$1,n=Y0$1,r=Z0$1;i=hypot(t,n,r);if(i<epsilon2)return[NaN,NaN]}return[atan2(n,t)*degrees,asin$1(r/i)*degrees]}function compose(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}if(e.invert&&t.invert)n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1])};return n}function rotationIdentity(e,t){return[abs$1(e)>pi$1?e+Math.round(-e/tau$1)*tau$1:e,t]}rotationIdentity.invert=rotationIdentity;function rotateRadians(e,t,n){return(e%=tau$1)?t||n?compose(rotationLambda(e),rotationPhiGamma(t,n)):rotationLambda(e):t||n?rotationPhiGamma(t,n):rotationIdentity}function forwardRotationLambda(e){return function(t,n){return t+=e,[t>pi$1?t-tau$1:t<-pi$1?t+tau$1:t,n]}}function rotationLambda(e){var t=forwardRotationLambda(e);t.invert=forwardRotationLambda(-e);return t}function rotationPhiGamma(e,t){var n=cos$1(e),r=sin$1(e),i=cos$1(t),a=sin$1(t);function o(e,t){var o=cos$1(t),s=cos$1(e)*o,u=sin$1(e)*o,l=sin$1(t),f=l*n+s*r;return[atan2(u*i-f*a,s*n-l*r),asin$1(f*i+u*a)]}o.invert=function(e,t){var o=cos$1(t),s=cos$1(e)*o,u=sin$1(e)*o,l=sin$1(t),f=l*i-u*a;return[atan2(u*i+l*a,s*n+f*r),asin$1(f*n-s*r)]};return o}function rotation(e){e=rotateRadians(e[0]*radians,e[1]*radians,e.length>2?e[2]*radians:0);function t(t){t=e(t[0]*radians,t[1]*radians);return t[0]*=degrees,t[1]*=degrees,t}t.invert=function(t){t=e.invert(t[0]*radians,t[1]*radians);return t[0]*=degrees,t[1]*=degrees,t};return t}function circleStream(e,t,n,r,i,a){if(!n)return;var o=cos$1(t),s=sin$1(t),u=r*n;if(i==null){i=t+r*tau$1;a=t-u/2}else{i=circleRadius(o,i);a=circleRadius(o,a);if(r>0?i<a:i>a)i+=r*tau$1}for(var l,f=i;r>0?f>a:f<a;f-=u){l=spherical([o,-s*cos$1(f),-s*sin$1(f)]);e.point(l[0],l[1])}}function circleRadius(e,t){t=cartesian(t),t[0]-=e;cartesianNormalizeInPlace(t);var n=acos(-t[1]);return((-t[2]<0?-n:n)+tau$1-epsilon$2)%tau$1}function clipBuffer(){var e=[],t;return{point:function(e,n,r){t.push([e,n,r])},lineStart:function(){e.push(t=[])},lineEnd:noop$2,rejoin:function(){if(e.length>1)e.push(e.pop().concat(e.shift()))},result:function(){var n=e;e=[];t=null;return n}}}function pointEqual(e,t){return abs$1(e[0]-t[0])<epsilon$2&&abs$1(e[1]-t[1])<epsilon$2}function Intersection(e,t,n,r){this.x=e;this.z=t;this.o=n;this.e=r;this.v=false;this.n=this.p=null}function clipRejoin(e,t,n,r,i){var a=[],o=[],s,u;e.forEach((function(e){if((t=e.length-1)<=0)return;var t,n=e[0],r=e[t],u;if(pointEqual(n,r)){if(!n[2]&&!r[2]){i.lineStart();for(s=0;s<t;++s)i.point((n=e[s])[0],n[1]);i.lineEnd();return}r[0]+=2*epsilon$2}a.push(u=new Intersection(n,e,null,true));o.push(u.o=new Intersection(n,null,u,false));a.push(u=new Intersection(r,e,null,false));o.push(u.o=new Intersection(r,null,u,true))}));if(!a.length)return;o.sort(t);link(a);link(o);for(s=0,u=o.length;s<u;++s){o[s].e=n=!n}var l=a[0],f,c;while(1){var d=l,p=true;while(d.v)if((d=d.n)===l)return;f=d.z;i.lineStart();do{d.v=d.o.v=true;if(d.e){if(p){for(s=0,u=f.length;s<u;++s)i.point((c=f[s])[0],c[1])}else{r(d.x,d.n.x,1,i)}d=d.n}else{if(p){f=d.p.z;for(s=f.length-1;s>=0;--s)i.point((c=f[s])[0],c[1])}else{r(d.x,d.p.x,-1,i)}d=d.p}d=d.o;f=d.z;p=!p}while(!d.v);i.lineEnd()}}function link(e){if(!(t=e.length))return;var t,n=0,r=e[0],i;while(++n<t){r.n=i=e[n];i.p=r;r=i}r.n=i=e[0];i.p=r}function longitude(e){if(abs$1(e[0])<=pi$1)return e[0];else return sign(e[0])*((abs$1(e[0])+pi$1)%tau$1-pi$1)}function polygonContains(e,t){var n=longitude(t),r=t[1],i=sin$1(r),a=[sin$1(n),-cos$1(n),0],o=0,s=0;var u=new Adder;if(i===1)r=halfPi$1+epsilon$2;else if(i===-1)r=-halfPi$1-epsilon$2;for(var l=0,f=e.length;l<f;++l){if(!(d=(c=e[l]).length))continue;var c,d,p=c[d-1],h=longitude(p),g=p[1]/2+quarterPi,m=sin$1(g),v=cos$1(g);for(var y=0;y<d;++y,h=b,m=E,v=S,p=_){var _=c[y],b=longitude(_),x=_[1]/2+quarterPi,E=sin$1(x),S=cos$1(x),$=b-h,A=$>=0?1:-1,D=A*$,w=D>pi$1,C=m*E;u.add(atan2(C*A*sin$1(D),v*S+C*cos$1(D)));o+=w?$+A*tau$1:$;if(w^h>=n^b>=n){var T=cartesianCross(cartesian(p),cartesian(_));cartesianNormalizeInPlace(T);var k=cartesianCross(a,T);cartesianNormalizeInPlace(k);var O=(w^$>=0?-1:1)*asin$1(k[2]);if(r>O||r===O&&(T[0]||T[1])){s+=w^$>=0?1:-1}}}}return(o<-epsilon$2||o<epsilon$2&&u<-epsilon2)^s&1}function clip$1(e,t,n,r){return function(i){var a=t(i),o=clipBuffer(),s=t(o),u=false,l,f,c;var d={point:p,lineStart:g,lineEnd:m,polygonStart:function(){d.point=v;d.lineStart=y;d.lineEnd=_;f=[];l=[]},polygonEnd:function(){d.point=p;d.lineStart=g;d.lineEnd=m;f=merge$2(f);var e=polygonContains(l,r);if(f.length){if(!u)i.polygonStart(),u=true;clipRejoin(f,compareIntersection,e,n,i)}else if(e){if(!u)i.polygonStart(),u=true;i.lineStart();n(null,null,1,i);i.lineEnd()}if(u)i.polygonEnd(),u=false;f=l=null},sphere:function(){i.polygonStart();i.lineStart();n(null,null,1,i);i.lineEnd();i.polygonEnd()}};function p(t,n){if(e(t,n))i.point(t,n)}function h(e,t){a.point(e,t)}function g(){d.point=h;a.lineStart()}function m(){d.point=p;a.lineEnd()}function v(e,t){c.push([e,t]);s.point(e,t)}function y(){s.lineStart();c=[]}function _(){v(c[0][0],c[0][1]);s.lineEnd();var e=s.clean(),t=o.result(),n,r=t.length,a,d,p;c.pop();l.push(c);c=null;if(!r)return;if(e&1){d=t[0];if((a=d.length-1)>0){if(!u)i.polygonStart(),u=true;i.lineStart();for(n=0;n<a;++n)i.point((p=d[n])[0],p[1]);i.lineEnd()}return}if(r>1&&e&2)t.push(t.pop().concat(t.shift()));f.push(t.filter(validSegment))}return d}}function validSegment(e){return e.length>1}function compareIntersection(e,t){return((e=e.x)[0]<0?e[1]-halfPi$1-epsilon$2:halfPi$1-e[1])-((t=t.x)[0]<0?t[1]-halfPi$1-epsilon$2:halfPi$1-t[1])}var clipAntimeridian=clip$1((function(){return true}),clipAntimeridianLine,clipAntimeridianInterpolate,[-pi$1,-halfPi$1]);function clipAntimeridianLine(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart();i=1},point:function(a,o){var s=a>0?pi$1:-pi$1,u=abs$1(a-t);if(abs$1(u-pi$1)<epsilon$2){e.point(t,n=(n+o)/2>0?halfPi$1:-halfPi$1);e.point(r,n);e.lineEnd();e.lineStart();e.point(s,n);e.point(a,n);i=0}else if(r!==s&&u>=pi$1){if(abs$1(t-r)<epsilon$2)t-=r*epsilon$2;if(abs$1(a-s)<epsilon$2)a-=s*epsilon$2;n=clipAntimeridianIntersect(t,n,a,o);e.point(r,n);e.lineEnd();e.lineStart();e.point(s,n);i=0}e.point(t=a,n=o);r=s},lineEnd:function(){e.lineEnd();t=n=NaN},clean:function(){return 2-i}}}function clipAntimeridianIntersect(e,t,n,r){var i,a,o=sin$1(e-n);return abs$1(o)>epsilon$2?atan((sin$1(t)*(a=cos$1(r))*sin$1(n)-sin$1(r)*(i=cos$1(t))*sin$1(e))/(i*a*o)):(t+r)/2}function clipAntimeridianInterpolate(e,t,n,r){var i;if(e==null){i=n*halfPi$1;r.point(-pi$1,i);r.point(0,i);r.point(pi$1,i);r.point(pi$1,0);r.point(pi$1,-i);r.point(0,-i);r.point(-pi$1,-i);r.point(-pi$1,0);r.point(-pi$1,i)}else if(abs$1(e[0]-t[0])>epsilon$2){var a=e[0]<t[0]?pi$1:-pi$1;i=n*a/2;r.point(-a,i);r.point(0,i);r.point(a,i)}else{r.point(t[0],t[1])}}function clipCircle(e){var t=cos$1(e),n=6*radians,r=t>0,i=abs$1(t)>epsilon$2;function a(t,r,i,a){circleStream(a,e,n,i,t,r)}function o(e,n){return cos$1(e)*cos$1(n)>t}function s(e){var t,n,a,s,f;return{lineStart:function(){s=a=false;f=1},point:function(c,d){var p=[c,d],h,g=o(c,d),m=r?g?0:l(c,d):g?l(c+(c<0?pi$1:-pi$1),d):0;if(!t&&(s=a=g))e.lineStart();if(g!==a){h=u(t,p);if(!h||pointEqual(t,h)||pointEqual(p,h))p[2]=1}if(g!==a){f=0;if(g){e.lineStart();h=u(p,t);e.point(h[0],h[1])}else{h=u(t,p);e.point(h[0],h[1],2);e.lineEnd()}t=h}else if(i&&t&&r^g){var v;if(!(m&n)&&(v=u(p,t,true))){f=0;if(r){e.lineStart();e.point(v[0][0],v[0][1]);e.point(v[1][0],v[1][1]);e.lineEnd()}else{e.point(v[1][0],v[1][1]);e.lineEnd();e.lineStart();e.point(v[0][0],v[0][1],3)}}}if(g&&(!t||!pointEqual(t,p))){e.point(p[0],p[1])}t=p,a=g,n=m},lineEnd:function(){if(a)e.lineEnd();t=null},clean:function(){return f|(s&&a)<<1}}}function u(e,n,r){var i=cartesian(e),a=cartesian(n);var o=[1,0,0],s=cartesianCross(i,a),u=cartesianDot(s,s),l=s[0],f=u-l*l;if(!f)return!r&&e;var c=t*u/f,d=-t*l/f,p=cartesianCross(o,s),h=cartesianScale(o,c),g=cartesianScale(s,d);cartesianAddInPlace(h,g);var m=p,v=cartesianDot(h,m),y=cartesianDot(m,m),_=v*v-y*(cartesianDot(h,h)-1);if(_<0)return;var b=sqrt$1(_),x=cartesianScale(m,(-v-b)/y);cartesianAddInPlace(x,h);x=spherical(x);if(!r)return x;var E=e[0],S=n[0],$=e[1],A=n[1],D;if(S<E)D=E,E=S,S=D;var w=S-E,C=abs$1(w-pi$1)<epsilon$2,T=C||w<epsilon$2;if(!C&&A<$)D=$,$=A,A=D;if(T?C?$+A>0^x[1]<(abs$1(x[0]-E)<epsilon$2?$:A):$<=x[1]&&x[1]<=A:w>pi$1^(E<=x[0]&&x[0]<=S)){var k=cartesianScale(m,(-v+b)/y);cartesianAddInPlace(k,h);return[x,spherical(k)]}}function l(t,n){var i=r?e:pi$1-e,a=0;if(t<-i)a|=1;else if(t>i)a|=2;if(n<-i)a|=4;else if(n>i)a|=8;return a}return clip$1(o,s,a,r?[0,-e]:[-pi$1,e-pi$1])}function clipLine(e,t,n,r,i,a){var o=e[0],s=e[1],u=t[0],l=t[1],f=0,c=1,d=u-o,p=l-s,h;h=n-o;if(!d&&h>0)return;h/=d;if(d<0){if(h<f)return;if(h<c)c=h}else if(d>0){if(h>c)return;if(h>f)f=h}h=i-o;if(!d&&h<0)return;h/=d;if(d<0){if(h>c)return;if(h>f)f=h}else if(d>0){if(h<f)return;if(h<c)c=h}h=r-s;if(!p&&h>0)return;h/=p;if(p<0){if(h<f)return;if(h<c)c=h}else if(p>0){if(h>c)return;if(h>f)f=h}h=a-s;if(!p&&h<0)return;h/=p;if(p<0){if(h>c)return;if(h>f)f=h}else if(p>0){if(h<f)return;if(h<c)c=h}if(f>0)e[0]=o+f*d,e[1]=s+f*p;if(c<1)t[0]=o+c*d,t[1]=s+c*p;return true}var clipMax=1e9,clipMin=-clipMax;function clipRectangle(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,l){var f=0,c=0;if(i==null||(f=o(i,s))!==(c=o(a,s))||u(i,a)<0^s>0){do{l.point(f===0||f===3?e:n,f>1?r:t)}while((f=(f+s+4)%4)!==c)}else{l.point(a[0],a[1])}}function o(r,i){return abs$1(r[0]-e)<epsilon$2?i>0?0:3:abs$1(r[0]-n)<epsilon$2?i>0?2:1:abs$1(r[1]-t)<epsilon$2?i>0?1:0:i>0?3:2}function s(e,t){return u(e.x,t.x)}function u(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:n===0?t[1]-e[1]:n===1?e[0]-t[0]:n===2?e[1]-t[1]:t[0]-e[0]}return function(o){var u=o,l=clipBuffer(),f,c,d,p,h,g,m,v,y,_,b;var x={point:E,lineStart:D,lineEnd:w,polygonStart:$,polygonEnd:A};function E(e,t){if(i(e,t))u.point(e,t)}function S(){var t=0;for(var n=0,i=c.length;n<i;++n){for(var a=c[n],o=1,s=a.length,u=a[0],l,f,d=u[0],p=u[1];o<s;++o){l=d,f=p,u=a[o],d=u[0],p=u[1];if(f<=r){if(p>r&&(d-l)*(r-f)>(p-f)*(e-l))++t}else{if(p<=r&&(d-l)*(r-f)<(p-f)*(e-l))--t}}}return t}function $(){u=l,f=[],c=[],b=true}function A(){var e=S(),t=b&&e,n=(f=merge$2(f)).length;if(t||n){o.polygonStart();if(t){o.lineStart();a(null,null,1,o);o.lineEnd()}if(n){clipRejoin(f,s,e,a,o)}o.polygonEnd()}u=o,f=c=d=null}function D(){x.point=C;if(c)c.push(d=[]);_=true;y=false;m=v=NaN}function w(){if(f){C(p,h);if(g&&y)l.rejoin();f.push(l.result())}x.point=E;if(y)u.lineEnd()}function C(a,o){var s=i(a,o);if(c)d.push([a,o]);if(_){p=a,h=o,g=s;_=false;if(s){u.lineStart();u.point(a,o)}}else{if(s&&y)u.point(a,o);else{var l=[m=Math.max(clipMin,Math.min(clipMax,m)),v=Math.max(clipMin,Math.min(clipMax,v))],f=[a=Math.max(clipMin,Math.min(clipMax,a)),o=Math.max(clipMin,Math.min(clipMax,o))];if(clipLine(l,f,e,t,n,r)){if(!y){u.lineStart();u.point(l[0],l[1])}u.point(f[0],f[1]);if(!s)u.lineEnd();b=false}else if(s){u.lineStart();u.point(a,o);b=false}}}m=a,v=o,y=s}return x}}function graticuleX(e,t,n){var r=range$1$1(e,t-epsilon$2,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function graticuleY(e,t,n){var r=range$1$1(e,t-epsilon$2,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}function graticule(){var e,t,n,r,i,a,o,s,u=10,l=u,f=90,c=360,d,p,h,g,m=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return range$1$1(ceil(r/f)*f,n,f).map(h).concat(range$1$1(ceil(s/c)*c,o,c).map(g)).concat(range$1$1(ceil(t/u)*u,e,u).filter((function(e){return abs$1(e%f)>epsilon$2})).map(d)).concat(range$1$1(ceil(a/l)*l,i,l).filter((function(e){return abs$1(e%c)>epsilon$2})).map(p))}v.lines=function(){return y().map((function(e){return{type:"LineString",coordinates:e}}))};v.outline=function(){return{type:"Polygon",coordinates:[h(r).concat(g(o).slice(1),h(n).reverse().slice(1),g(s).reverse().slice(1))]}};v.extent=function(e){if(!arguments.length)return v.extentMinor();return v.extentMajor(e).extentMinor(e)};v.extentMajor=function(e){if(!arguments.length)return[[r,s],[n,o]];r=+e[0][0],n=+e[1][0];s=+e[0][1],o=+e[1][1];if(r>n)e=r,r=n,n=e;if(s>o)e=s,s=o,o=e;return v.precision(m)};v.extentMinor=function(n){if(!arguments.length)return[[t,a],[e,i]];t=+n[0][0],e=+n[1][0];a=+n[0][1],i=+n[1][1];if(t>e)n=t,t=e,e=n;if(a>i)n=a,a=i,i=n;return v.precision(m)};v.step=function(e){if(!arguments.length)return v.stepMinor();return v.stepMajor(e).stepMinor(e)};v.stepMajor=function(e){if(!arguments.length)return[f,c];f=+e[0],c=+e[1];return v};v.stepMinor=function(e){if(!arguments.length)return[u,l];u=+e[0],l=+e[1];return v};v.precision=function(u){if(!arguments.length)return m;m=+u;d=graticuleX(a,i,90);p=graticuleY(t,e,m);h=graticuleX(s,o,90);g=graticuleY(r,n,m);return v};return v.extentMajor([[-180,-90+epsilon$2],[180,90-epsilon$2]]).extentMinor([[-180,-80-epsilon$2],[180,80+epsilon$2]])}var identity=function(e){return e};var areaSum=new Adder,areaRingSum=new Adder,x00$2,y00$2,x0$3,y0$3;var areaStream={point:noop$2,lineStart:noop$2,lineEnd:noop$2,polygonStart:function(){areaStream.lineStart=areaRingStart;areaStream.lineEnd=areaRingEnd},polygonEnd:function(){areaStream.lineStart=areaStream.lineEnd=areaStream.point=noop$2;areaSum.add(abs$1(areaRingSum));areaRingSum=new Adder},result:function(){var e=areaSum/2;areaSum=new Adder;return e}};function areaRingStart(){areaStream.point=areaPointFirst}function areaPointFirst(e,t){areaStream.point=areaPoint;x00$2=x0$3=e,y00$2=y0$3=t}function areaPoint(e,t){areaRingSum.add(y0$3*e-x0$3*t);x0$3=e,y0$3=t}function areaRingEnd(){areaPoint(x00$2,y00$2)}var x0$2=Infinity,y0$2=x0$2,x1=-x0$2,y1=x1;var boundsStream={point:boundsPoint,lineStart:noop$2,lineEnd:noop$2,polygonStart:noop$2,polygonEnd:noop$2,result:function(){var e=[[x0$2,y0$2],[x1,y1]];x1=y1=-(y0$2=x0$2=Infinity);return e}};function boundsPoint(e,t){if(e<x0$2)x0$2=e;if(e>x1)x1=e;if(t<y0$2)y0$2=t;if(t>y1)y1=t}var X0=0,Y0=0,Z0=0,X1=0,Y1=0,Z1=0,X2$1=0,Y2$1=0,Z2=0,x00$1,y00$1,x0$1,y0$1;var centroidStream={point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart;centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.point=centroidPoint;centroidStream.lineStart=centroidLineStart;centroidStream.lineEnd=centroidLineEnd},result:function(){var e=Z2?[X2$1/Z2,Y2$1/Z2]:Z1?[X1/Z1,Y1/Z1]:Z0?[X0/Z0,Y0/Z0]:[NaN,NaN];X0=Y0=Z0=X1=Y1=Z1=X2$1=Y2$1=Z2=0;return e}};function centroidPoint(e,t){X0+=e;Y0+=t;++Z0}function centroidLineStart(){centroidStream.point=centroidPointFirstLine}function centroidPointFirstLine(e,t){centroidStream.point=centroidPointLine;centroidPoint(x0$1=e,y0$1=t)}function centroidPointLine(e,t){var n=e-x0$1,r=t-y0$1,i=sqrt$1(n*n+r*r);X1+=i*(x0$1+e)/2;Y1+=i*(y0$1+t)/2;Z1+=i;centroidPoint(x0$1=e,y0$1=t)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidPointFirstRing}function centroidRingEnd(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(e,t){centroidStream.point=centroidPointRing;centroidPoint(x00$1=x0$1=e,y00$1=y0$1=t)}function centroidPointRing(e,t){var n=e-x0$1,r=t-y0$1,i=sqrt$1(n*n+r*r);X1+=i*(x0$1+e)/2;Y1+=i*(y0$1+t)/2;Z1+=i;i=y0$1*e-x0$1*t;X2$1+=i*(x0$1+e);Y2$1+=i*(y0$1+t);Z2+=i*3;centroidPoint(x0$1=e,y0$1=t)}function PathContext(e){this._context=e}PathContext.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._context.closePath();this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t);this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t);this._context.arc(e,t,this._radius,0,tau$1);break}}},result:noop$2};var lengthSum=new Adder,lengthRing,x00,y00,x0,y0;var lengthStream={point:noop$2,lineStart:function(){lengthStream.point=lengthPointFirst},lineEnd:function(){if(lengthRing)lengthPoint(x00,y00);lengthStream.point=noop$2},polygonStart:function(){lengthRing=true},polygonEnd:function(){lengthRing=null},result:function(){var e=+lengthSum;lengthSum=new Adder;return e}};function lengthPointFirst(e,t){lengthStream.point=lengthPoint;x00=x0=e,y00=y0=t}function lengthPoint(e,t){x0-=e,y0-=t;lengthSum.add(sqrt$1(x0*x0+y0*y0));x0=e,y0=t}function PathString(){this._string=[]}PathString.prototype={_radius:4.5,_circle:circle$1(4.5),pointRadius:function(e){if((e=+e)!==this._radius)this._radius=e,this._circle=null;return this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._string.push("Z");this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t);this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{if(this._circle==null)this._circle=circle$1(this._radius);this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");this._string=[];return e}else{return null}}};function circle$1(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function geoPath(e,t){var n=4.5,r,i;function a(e){if(e){if(typeof n==="function")i.pointRadius(+n.apply(this,arguments));geoStream(e,r(i))}return i.result()}a.area=function(e){geoStream(e,r(areaStream));return areaStream.result()};a.measure=function(e){geoStream(e,r(lengthStream));return lengthStream.result()};a.bounds=function(e){geoStream(e,r(boundsStream));return boundsStream.result()};a.centroid=function(e){geoStream(e,r(centroidStream));return centroidStream.result()};a.projection=function(t){return arguments.length?(r=t==null?(e=null,identity):(e=t).stream,a):e};a.context=function(e){if(!arguments.length)return t;i=e==null?(t=null,new PathString):new PathContext(t=e);if(typeof n!=="function")i.pointRadius(n);return a};a.pointRadius=function(e){if(!arguments.length)return n;n=typeof e==="function"?e:(i.pointRadius(+e),+e);return a};return a.projection(e).context(t)}function transformer(e){return function(t){var n=new TransformStream;for(var r in e)n[r]=e[r];n.stream=t;return n}}function TransformStream(){}TransformStream.prototype={constructor:TransformStream,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function fit$1(e,t,n){var r=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]);if(r!=null)e.clipExtent(null);geoStream(n,e.stream(boundsStream));t(boundsStream.result());if(r!=null)e.clipExtent(r);return e}function fitExtent(e,t,n){return fit$1(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function fitSize(e,t,n){return fitExtent(e,[[0,0],t],n)}function fitWidth(e,t,n){return fit$1(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function fitHeight(e,t,n){return fit$1(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}var maxDepth=16,cosMinDistance=cos$1(30*radians);function resample(e,t){return+t?resample$1(e,t):resampleNone(e)}function resampleNone(e){return transformer({point:function(t,n){t=e(t,n);this.stream.point(t[0],t[1])}})}function resample$1(e,t){function n(r,i,a,o,s,u,l,f,c,d,p,h,g,m){var v=l-r,y=f-i,_=v*v+y*y;if(_>4*t&&g--){var b=o+d,x=s+p,E=u+h,S=sqrt$1(b*b+x*x+E*E),$=asin$1(E/=S),A=abs$1(abs$1(E)-1)<epsilon$2||abs$1(a-c)<epsilon$2?(a+c)/2:atan2(x,b),D=e(A,$),w=D[0],C=D[1],T=w-r,k=C-i,O=y*T-v*k;if(O*O/_>t||abs$1((v*T+y*k)/_-.5)>.3||o*d+s*p+u*h<cosMinDistance){n(r,i,a,o,s,u,w,C,A,b/=S,x/=S,E,g,m);m.point(w,C);n(w,C,A,b,x,E,l,f,c,d,p,h,g,m)}}}return function(t){var r,i,a,o,s,u,l,f,c,d,p,h;var g={point:m,lineStart:v,lineEnd:_,polygonStart:function(){t.polygonStart();g.lineStart=b},polygonEnd:function(){t.polygonEnd();g.lineStart=v}};function m(n,r){n=e(n,r);t.point(n[0],n[1])}function v(){f=NaN;g.point=y;t.lineStart()}function y(r,i){var a=cartesian([r,i]),o=e(r,i);n(f,c,l,d,p,h,f=o[0],c=o[1],l=r,d=a[0],p=a[1],h=a[2],maxDepth,t);t.point(f,c)}function _(){g.point=m;t.lineEnd()}function b(){v();g.point=x;g.lineEnd=E}function x(e,t){y(r=e,t),i=f,a=c,o=d,s=p,u=h;g.point=y}function E(){n(f,c,l,d,p,h,i,a,r,o,s,u,maxDepth,t);g.lineEnd=_;_()}return g}}var transformRadians=transformer({point:function(e,t){this.stream.point(e*radians,t*radians)}});function transformRotate(e){return transformer({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function scaleTranslate(e,t,n,r,i){function a(a,o){a*=r;o*=i;return[t+e*a,n-e*o]}a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]};return a}function scaleTranslateRotate(e,t,n,r,i,a){if(!a)return scaleTranslate(e,t,n,r,i);var o=cos$1(a),s=sin$1(a),u=o*e,l=s*e,f=o/e,c=s/e,d=(s*n-o*t)/e,p=(s*t+o*n)/e;function h(e,a){e*=r;a*=i;return[u*e-l*a+t,n-l*e-u*a]}h.invert=function(e,t){return[r*(f*e-c*t+d),i*(p-c*e-f*t)]};return h}function projection$1(e){return projectionMutator((function(){return e}))()}function projectionMutator(e){var t,n=150,r=480,i=250,a=0,o=0,s=0,u=0,l=0,f,c=0,d=1,p=1,h=null,g=clipAntimeridian,m=null,v,y,_,b=identity,x=.5,E,S,$,A,D;function w(e){return $(e[0]*radians,e[1]*radians)}function C(e){e=$.invert(e[0],e[1]);return e&&[e[0]*degrees,e[1]*degrees]}w.stream=function(e){return A&&D===e?A:A=transformRadians(transformRotate(f)(g(E(b(D=e)))))};w.preclip=function(e){return arguments.length?(g=e,h=undefined,k()):g};w.postclip=function(e){return arguments.length?(b=e,m=v=y=_=null,k()):b};w.clipAngle=function(e){return arguments.length?(g=+e?clipCircle(h=e*radians):(h=null,clipAntimeridian),k()):h*degrees};w.clipExtent=function(e){return arguments.length?(b=e==null?(m=v=y=_=null,identity):clipRectangle(m=+e[0][0],v=+e[0][1],y=+e[1][0],_=+e[1][1]),k()):m==null?null:[[m,v],[y,_]]};w.scale=function(e){return arguments.length?(n=+e,T()):n};w.translate=function(e){return arguments.length?(r=+e[0],i=+e[1],T()):[r,i]};w.center=function(e){return arguments.length?(a=e[0]%360*radians,o=e[1]%360*radians,T()):[a*degrees,o*degrees]};w.rotate=function(e){return arguments.length?(s=e[0]%360*radians,u=e[1]%360*radians,l=e.length>2?e[2]%360*radians:0,T()):[s*degrees,u*degrees,l*degrees]};w.angle=function(e){return arguments.length?(c=e%360*radians,T()):c*degrees};w.reflectX=function(e){return arguments.length?(d=e?-1:1,T()):d<0};w.reflectY=function(e){return arguments.length?(p=e?-1:1,T()):p<0};w.precision=function(e){return arguments.length?(E=resample(S,x=e*e),k()):sqrt$1(x)};w.fitExtent=function(e,t){return fitExtent(w,e,t)};w.fitSize=function(e,t){return fitSize(w,e,t)};w.fitWidth=function(e,t){return fitWidth(w,e,t)};w.fitHeight=function(e,t){return fitHeight(w,e,t)};function T(){var e=scaleTranslateRotate(n,0,0,d,p,c).apply(null,t(a,o)),h=scaleTranslateRotate(n,r-e[0],i-e[1],d,p,c);f=rotateRadians(s,u,l);S=compose(t,h);$=compose(f,S);E=resample(S,x);return k()}function k(){A=D=null;return w}return function(){t=e.apply(this,arguments);w.invert=t.invert&&C;return T()}}function conicProjection(e){var t=0,n=pi$1/3,r=projectionMutator(e),i=r(t,n);i.parallels=function(e){return arguments.length?r(t=e[0]*radians,n=e[1]*radians):[t*degrees,n*degrees]};return i}function cylindricalEqualAreaRaw(e){var t=cos$1(e);function n(e,n){return[e*t,sin$1(n)/t]}n.invert=function(e,n){return[e/t,asin$1(n*t)]};return n}function conicEqualAreaRaw(e,t){var n=sin$1(e),r=(n+sin$1(t))/2;if(abs$1(r)<epsilon$2)return cylindricalEqualAreaRaw(e);var i=1+n*(2*r-n),a=sqrt$1(i)/r;function o(e,t){var n=sqrt$1(i-2*r*sin$1(t))/r;return[n*sin$1(e*=r),a-n*cos$1(e)]}o.invert=function(e,t){var n=a-t,o=atan2(e,abs$1(n))*sign(n);if(n*r<0)o-=pi$1*sign(e)*sign(n);return[o/r,asin$1((i-(e*e+n*n)*r*r)/(2*r))]};return o}function geoConicEqualArea(){return conicProjection(conicEqualAreaRaw).scale(155.424).center([0,33.6442])}function geoAlbers(){return geoConicEqualArea().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function multiplex(e){var t=e.length;return{point:function(n,r){var i=-1;while(++i<t)e[i].point(n,r)},sphere:function(){var n=-1;while(++n<t)e[n].sphere()},lineStart:function(){var n=-1;while(++n<t)e[n].lineStart()},lineEnd:function(){var n=-1;while(++n<t)e[n].lineEnd()},polygonStart:function(){var n=-1;while(++n<t)e[n].polygonStart()},polygonEnd:function(){var n=-1;while(++n<t)e[n].polygonEnd()}}}function geoAlbersUsa(){var e,t,n=geoAlbers(),r,i=geoConicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a,o=geoConicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s,u,l={point:function(e,t){u=[e,t]}};function f(e){var t=e[0],n=e[1];return u=null,(r.point(t,n),u)||(a.point(t,n),u)||(s.point(t,n),u)}f.invert=function(e){var t=n.scale(),r=n.translate(),a=(e[0]-r[0])/t,s=(e[1]-r[1])/t;return(s>=.12&&s<.234&&a>=-.425&&a<-.214?i:s>=.166&&s<.234&&a>=-.214&&a<-.115?o:n).invert(e)};f.stream=function(r){return e&&t===r?e:e=multiplex([n.stream(t=r),i.stream(r),o.stream(r)])};f.precision=function(e){if(!arguments.length)return n.precision();n.precision(e),i.precision(e),o.precision(e);return c()};f.scale=function(e){if(!arguments.length)return n.scale();n.scale(e),i.scale(e*.35),o.scale(e);return f.translate(n.translate())};f.translate=function(e){if(!arguments.length)return n.translate();var t=n.scale(),u=+e[0],f=+e[1];r=n.translate(e).clipExtent([[u-.455*t,f-.238*t],[u+.455*t,f+.238*t]]).stream(l);a=i.translate([u-.307*t,f+.201*t]).clipExtent([[u-.425*t+epsilon$2,f+.12*t+epsilon$2],[u-.214*t-epsilon$2,f+.234*t-epsilon$2]]).stream(l);s=o.translate([u-.205*t,f+.212*t]).clipExtent([[u-.214*t+epsilon$2,f+.166*t+epsilon$2],[u-.115*t-epsilon$2,f+.234*t-epsilon$2]]).stream(l);return c()};f.fitExtent=function(e,t){return fitExtent(f,e,t)};f.fitSize=function(e,t){return fitSize(f,e,t)};f.fitWidth=function(e,t){return fitWidth(f,e,t)};f.fitHeight=function(e,t){return fitHeight(f,e,t)};function c(){e=t=null;return f}return f.scale(1070)}function azimuthalRaw(e){return function(t,n){var r=cos$1(t),i=cos$1(n),a=e(r*i);if(a===Infinity)return[2,0];return[a*i*sin$1(t),a*sin$1(n)]}}function azimuthalInvert(e){return function(t,n){var r=sqrt$1(t*t+n*n),i=e(r),a=sin$1(i),o=cos$1(i);return[atan2(t*a,r*o),asin$1(r&&n*a/r)]}}var azimuthalEqualAreaRaw=azimuthalRaw((function(e){return sqrt$1(2/(1+e))}));azimuthalEqualAreaRaw.invert=azimuthalInvert((function(e){return 2*asin$1(e/2)}));function geoAzimuthalEqualArea(){return projection$1(azimuthalEqualAreaRaw).scale(124.75).clipAngle(180-.001)}var azimuthalEquidistantRaw=azimuthalRaw((function(e){return(e=acos(e))&&e/sin$1(e)}));azimuthalEquidistantRaw.invert=azimuthalInvert((function(e){return e}));function geoAzimuthalEquidistant(){return projection$1(azimuthalEquidistantRaw).scale(79.4188).clipAngle(180-.001)}function mercatorRaw(e,t){return[e,log$1(tan((halfPi$1+t)/2))]}mercatorRaw.invert=function(e,t){return[e,2*atan(exp(t))-halfPi$1]};function geoMercator(){return mercatorProjection(mercatorRaw).scale(961/tau$1)}function mercatorProjection(e){var t=projection$1(e),n=t.center,r=t.scale,i=t.translate,a=t.clipExtent,o=null,s,u,l;t.scale=function(e){return arguments.length?(r(e),f()):r()};t.translate=function(e){return arguments.length?(i(e),f()):i()};t.center=function(e){return arguments.length?(n(e),f()):n()};t.clipExtent=function(e){return arguments.length?(e==null?o=s=u=l=null:(o=+e[0][0],s=+e[0][1],u=+e[1][0],l=+e[1][1]),f()):o==null?null:[[o,s],[u,l]]};function f(){var n=pi$1*r(),i=t(rotation(t.rotate()).invert([0,0]));return a(o==null?[[i[0]-n,i[1]-n],[i[0]+n,i[1]+n]]:e===mercatorRaw?[[Math.max(i[0]-n,o),s],[Math.min(i[0]+n,u),l]]:[[o,Math.max(i[1]-n,s)],[u,Math.min(i[1]+n,l)]])}return f()}function tany(e){return tan((halfPi$1+e)/2)}function conicConformalRaw(e,t){var n=cos$1(e),r=e===t?sin$1(e):log$1(n/cos$1(t))/log$1(tany(t)/tany(e)),i=n*pow$1(tany(e),r)/r;if(!r)return mercatorRaw;function a(e,t){if(i>0){if(t<-halfPi$1+epsilon$2)t=-halfPi$1+epsilon$2}else{if(t>halfPi$1-epsilon$2)t=halfPi$1-epsilon$2}var n=i/pow$1(tany(t),r);return[n*sin$1(r*e),i-n*cos$1(r*e)]}a.invert=function(e,t){var n=i-t,a=sign(r)*sqrt$1(e*e+n*n),o=atan2(e,abs$1(n))*sign(n);if(n*r<0)o-=pi$1*sign(e)*sign(n);return[o/r,2*atan(pow$1(i/a,1/r))-halfPi$1]};return a}function geoConicConformal(){return conicProjection(conicConformalRaw).scale(109.5).parallels([30,30])}function equirectangularRaw(e,t){return[e,t]}equirectangularRaw.invert=equirectangularRaw;function geoEquirectangular(){return projection$1(equirectangularRaw).scale(152.63)}function conicEquidistantRaw(e,t){var n=cos$1(e),r=e===t?sin$1(e):(n-cos$1(t))/(t-e),i=n/r+e;if(abs$1(r)<epsilon$2)return equirectangularRaw;function a(e,t){var n=i-t,a=r*e;return[n*sin$1(a),i-n*cos$1(a)]}a.invert=function(e,t){var n=i-t,a=atan2(e,abs$1(n))*sign(n);if(n*r<0)a-=pi$1*sign(e)*sign(n);return[a/r,i-sign(r)*sqrt$1(e*e+n*n)]};return a}function geoConicEquidistant(){return conicProjection(conicEquidistantRaw).scale(131.154).center([0,13.9389])}var A1=1.340264,A2=-.081106,A3=893e-6,A4=.003796,M=sqrt$1(3)/2,iterations=12;function equalEarthRaw(e,t){var n=asin$1(M*sin$1(t)),r=n*n,i=r*r*r;return[e*cos$1(n)/(M*(A1+3*A2*r+i*(7*A3+9*A4*r))),n*(A1+A2*r+i*(A3+A4*r))]}equalEarthRaw.invert=function(e,t){var n=t,r=n*n,i=r*r*r;for(var a=0,o,s,u;a<iterations;++a){s=n*(A1+A2*r+i*(A3+A4*r))-t;u=A1+3*A2*r+i*(7*A3+9*A4*r);n-=o=s/u,r=n*n,i=r*r*r;if(abs$1(o)<epsilon2)break}return[M*e*(A1+3*A2*r+i*(7*A3+9*A4*r))/cos$1(n),asin$1(sin$1(n)/M)]};function geoEqualEarth(){return projection$1(equalEarthRaw).scale(177.158)}function gnomonicRaw(e,t){var n=cos$1(t),r=cos$1(e)*n;return[n*sin$1(e)/r,sin$1(t)/r]}gnomonicRaw.invert=azimuthalInvert(atan);function geoGnomonic(){return projection$1(gnomonicRaw).scale(144.049).clipAngle(60)}function geoIdentity(){var e=1,t=0,n=0,r=1,i=1,a=0,o,s,u=null,l,f,c,d=1,p=1,h=transformer({point:function(e,t){var n=_([e,t]);this.stream.point(n[0],n[1])}}),g=identity,m,v;function y(){d=e*r;p=e*i;m=v=null;return _}function _(e){var r=e[0]*d,i=e[1]*p;if(a){var u=i*o-r*s;r=r*o+i*s;i=u}return[r+t,i+n]}_.invert=function(e){var r=e[0]-t,i=e[1]-n;if(a){var u=i*o+r*s;r=r*o-i*s;i=u}return[r/d,i/p]};_.stream=function(e){return m&&v===e?m:m=h(g(v=e))};_.postclip=function(e){return arguments.length?(g=e,u=l=f=c=null,y()):g};_.clipExtent=function(e){return arguments.length?(g=e==null?(u=l=f=c=null,identity):clipRectangle(u=+e[0][0],l=+e[0][1],f=+e[1][0],c=+e[1][1]),y()):u==null?null:[[u,l],[f,c]]};_.scale=function(t){return arguments.length?(e=+t,y()):e};_.translate=function(e){return arguments.length?(t=+e[0],n=+e[1],y()):[t,n]};_.angle=function(e){return arguments.length?(a=e%360*radians,s=sin$1(a),o=cos$1(a),y()):a*degrees};_.reflectX=function(e){return arguments.length?(r=e?-1:1,y()):r<0};_.reflectY=function(e){return arguments.length?(i=e?-1:1,y()):i<0};_.fitExtent=function(e,t){return fitExtent(_,e,t)};_.fitSize=function(e,t){return fitSize(_,e,t)};_.fitWidth=function(e,t){return fitWidth(_,e,t)};_.fitHeight=function(e,t){return fitHeight(_,e,t)};return _}function naturalEarth1Raw(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(-.013791+r*(.003971*n-.001529*r))),t*(1.007226+n*(.015085+r*(-.044475+.028874*n-.005916*r)))]}naturalEarth1Raw.invert=function(e,t){var n=t,r=25,i;do{var a=n*n,o=a*a;n-=i=(n*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-t)/(1.007226+a*(.015085*3+o*(-.044475*7+.028874*9*a-.005916*11*o)))}while(abs$1(i)>epsilon$2&&--r>0);return[e/(.8707+(a=n*n)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),n]};function geoNaturalEarth1(){return projection$1(naturalEarth1Raw).scale(175.295)}function orthographicRaw(e,t){return[cos$1(t)*sin$1(e),sin$1(t)]}orthographicRaw.invert=azimuthalInvert(asin$1);function geoOrthographic(){return projection$1(orthographicRaw).scale(249.5).clipAngle(90+epsilon$2)}function stereographicRaw(e,t){var n=cos$1(t),r=1+cos$1(e)*n;return[n*sin$1(e)/r,sin$1(t)/r]}stereographicRaw.invert=azimuthalInvert((function(e){return 2*atan(e)}));function geoStereographic(){return projection$1(stereographicRaw).scale(250).clipAngle(142)}function transverseMercatorRaw(e,t){return[log$1(tan((halfPi$1+t)/2)),-e]}transverseMercatorRaw.invert=function(e,t){return[-t,2*atan(exp(e))-halfPi$1]};function geoTransverseMercator(){var e=mercatorProjection(transverseMercatorRaw),t=e.center,n=e.rotate;e.center=function(e){return arguments.length?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]])};e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])};return n([0,0,90]).scale(159.155)}var abs=Math.abs;var cos=Math.cos;var sin=Math.sin;var epsilon$1=1e-6;var pi=Math.PI;var halfPi=pi/2;var sqrt2=sqrt(2);function asin(e){return e>1?halfPi:e<-1?-halfPi:Math.asin(e)}function sqrt(e){return e>0?Math.sqrt(e):0}function mollweideBromleyTheta(e,t){var n=e*sin(t),r=30,i;do{t-=i=(t+sin(t)-n)/(1+cos(t))}while(abs(i)>epsilon$1&&--r>0);return t/2}function mollweideBromleyRaw(e,t,n){function r(r,i){return[e*r*cos(i=mollweideBromleyTheta(n,i)),t*sin(i)]}r.invert=function(r,i){return i=asin(i/t),[r/(e*cos(i)),asin((2*i+sin(2*i))/n)]};return r}var mollweideRaw=mollweideBromleyRaw(sqrt2/halfPi,sqrt2,pi);function geoMollweide(){return projection$1(mollweideRaw).scale(169.529)}var defaultPath=geoPath();var projectionProperties=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function create$1(e,t){return function n(){var r=t();r.type=e;r.path=geoPath().projection(r);r.copy=r.copy||function(){var e=n();projectionProperties.forEach((function(t){if(r[t])e[t](r[t]())}));e.path.pointRadius(r.path.pointRadius());return e};return r}}function projection(e,t){if(!e||typeof e!=="string"){throw new Error("Projection type must be a name string.")}e=e.toLowerCase();if(arguments.length>1){projections[e]=create$1(e,t);return this}else{return projections[e]||null}}function getProjectionPath(e){return e&&e.path||defaultPath}var projections={albers:geoAlbers,albersusa:geoAlbersUsa,azimuthalequalarea:geoAzimuthalEqualArea,azimuthalequidistant:geoAzimuthalEquidistant,conicconformal:geoConicConformal,conicequalarea:geoConicEqualArea,conicequidistant:geoConicEquidistant,equalEarth:geoEqualEarth,equirectangular:geoEquirectangular,gnomonic:geoGnomonic,identity:geoIdentity,mercator:geoMercator,mollweide:geoMollweide,naturalEarth1:geoNaturalEarth1,orthographic:geoOrthographic,stereographic:geoStereographic,transversemercator:geoTransverseMercator};for(var key_12 in projections){projection(key_12,projections[key_12])}function noop$1(){}var cases=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function contours(){var e=1,t=1,n=s;function r(e,t){return t.map((function(t){return i(e,t)}))}function i(e,t){var r=[],i=[];a(e,t,(function(a){n(a,e,t);if(area$1(a)>0)r.push([a]);else i.push(a)}));i.forEach((function(e){for(var t=0,n=r.length,i;t<n;++t){if(contains$1((i=r[t])[0],e)!==-1){i.push(e);return}}}));return{type:"MultiPolygon",value:t,coordinates:r}}function a(n,r,i){var a=new Array,s=new Array,u,l,f,c,d,p;u=l=-1;c=n[0]>=r;cases[c<<1].forEach(h);while(++u<e-1){f=c,c=n[u+1]>=r;cases[f|c<<1].forEach(h)}cases[c<<0].forEach(h);while(++l<t-1){u=-1;c=n[l*e+e]>=r;d=n[l*e]>=r;cases[c<<1|d<<2].forEach(h);while(++u<e-1){f=c,c=n[l*e+e+u+1]>=r;p=d,d=n[l*e+u+1]>=r;cases[f|c<<1|d<<2|p<<3].forEach(h)}cases[c|d<<3].forEach(h)}u=-1;d=n[l*e]>=r;cases[d<<2].forEach(h);while(++u<e-1){p=d,d=n[l*e+u+1]>=r;cases[d<<2|p<<3].forEach(h)}cases[d<<3].forEach(h);function h(e){var t=[e[0][0]+u,e[0][1]+l],n=[e[1][0]+u,e[1][1]+l],r=o(t),f=o(n),c,d;if(c=s[r]){if(d=a[f]){delete s[c.end];delete a[d.start];if(c===d){c.ring.push(n);i(c.ring)}else{a[c.start]=s[d.end]={start:c.start,end:d.end,ring:c.ring.concat(d.ring)}}}else{delete s[c.end];c.ring.push(n);s[c.end=f]=c}}else if(c=a[f]){if(d=s[r]){delete a[c.start];delete s[d.end];if(c===d){c.ring.push(n);i(c.ring)}else{a[d.start]=s[c.end]={start:d.start,end:c.end,ring:d.ring.concat(c.ring)}}}else{delete a[c.start];c.ring.unshift(t);a[c.start=r]=c}}else{a[r]=s[f]={start:r,end:f,ring:[t,n]}}}}function o(t){return t[0]*2+t[1]*(e+1)*4}function s(n,r,i){n.forEach((function(n){var a=n[0],o=n[1],s=a|0,u=o|0,l,f=r[u*e+s];if(a>0&&a<e&&s===a){l=r[u*e+s-1];n[0]=a+(i-l)/(f-l)-.5}if(o>0&&o<t&&u===o){l=r[(u-1)*e+s];n[1]=o+(i-l)/(f-l)-.5}}))}r.contour=i;r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);if(!(i>=0&&a>=0))error("invalid size");return e=i,t=a,r};r.smooth=function(e){return arguments.length?(n=e?s:noop$1,r):n===s};return r}function area$1(e){var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];while(++t<n)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}function contains$1(e,t){var n=-1,r=t.length,i;while(++n<r)if(i=ringContains(e,t[n]))return i;return 0}function ringContains(e,t){var n=t[0],r=t[1],i=-1;for(var a=0,o=e.length,s=o-1;a<o;s=a++){var u=e[a],l=u[0],f=u[1],c=e[s],d=c[0],p=c[1];if(segmentContains(u,c,t))return 0;if(f>r!==p>r&&n<(d-l)*(r-f)/(p-f)+l)i=-i}return i}function segmentContains(e,t,n){var r;return collinear$1(e,t,n)&&within(e[r=+(e[0]===t[0])],n[r],t[r])}function collinear$1(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function within(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function quantize(e,t,n){return function(r){var i=extent(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,u=t?tickStep(a,o,e):s/(e+1);return range$1$1(a+u,o,u)}}function Isocontour(e){Transform.call(this,null,e)}Isocontour.Definition={type:"Isocontour",metadata:{generates:true},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:true},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:false},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:true},{name:"smooth",type:"boolean",default:true},{name:"scale",type:"number",expr:true},{name:"translate",type:"number",array:true,expr:true},{name:"as",type:"string",null:true,default:"contour"}]};inherits(Isocontour,Transform,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified()){return t.StopPropagation}var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||identity$6,a=contours().smooth(e.smooth!==false),o=e.thresholds||levels(r,i,e),s=e.as===null?null:e.as||"contour",u=[];r.forEach((function(t){var n=i(t);var r=a.size([n.width,n.height])(n.values,isArray(o)?o:o(n.values));transformPaths(r,n,t,e);r.forEach((function(e){var n;u.push(rederive(t,ingest$1(s!=null?(n={},n[s]=e,n):e)))}))}));if(this.value)n.rem=this.value;this.value=n.source=n.add=u;return n}});function levels(e,t,n){var r=quantize(n.levels||10,n.nice,n.zero!==false);return n.resolve!=="shared"?r:r(e.map((function(e){return max$2(t(e).values)})))}function transformPaths(e,t,n,r){var i=r.scale||t.scale,a=r.translate||t.translate;if(isFunction(i))i=i(n,r);if(isFunction(a))a=a(n,r);if((i===1||i==null)&&!a)return;var o=(isNumber$1(i)?i:i[0])||1,s=(isNumber$1(i)?i:i[1])||1,u=a&&a[0]||0,l=a&&a[1]||0;e.forEach(transform$1(t,o,s,u,l))}function transform$1(e,t,n,r,i){var a=e.x1||0,o=e.y1||0,s=t*n<0;function u(e){e.forEach(l)}function l(e){if(s)e.reverse();e.forEach(f)}function f(e){e[0]=(e[0]-a)*t+r;e[1]=(e[1]-o)*n+i}return function(e){e.coordinates.forEach(u);return e}}function radius(e,t,n){var r=e>=0?e:estimateBandwidth(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function number$2(e){return isFunction(e)?e:constant$4(+e)}function density2D(){var e=function(e){return e[0]},t=function(e){return e[1]},n=one$2,r=[-1,-1],i=960,a=500,o=2;function s(s,u){var l=radius(r[0],s,e)>>o,f=radius(r[1],s,t)>>o,c=l?l+2:0,d=f?f+2:0,p=2*c+(i>>o),h=2*d+(a>>o),g=new Float32Array(p*h),m=new Float32Array(p*h);var v=g;s.forEach((function(r){var i=c+(+e(r)>>o),a=d+(+t(r)>>o);if(i>=0&&i<p&&a>=0&&a<h){g[i+a*p]+=+n(r)}}));if(l>0&&f>0){blurX(p,h,g,m,l);blurY(p,h,m,g,f);blurX(p,h,g,m,l);blurY(p,h,m,g,f);blurX(p,h,g,m,l);blurY(p,h,m,g,f)}else if(l>0){blurX(p,h,g,m,l);blurX(p,h,m,g,l);blurX(p,h,g,m,l);v=m}else if(f>0){blurY(p,h,g,m,f);blurY(p,h,m,g,f);blurY(p,h,g,m,f);v=m}var y=u?Math.pow(2,-2*o):1/sum(v);for(var _=0,b=p*h;_<b;++_)v[_]*=y;return{values:v,scale:1<<o,width:p,height:h,x1:c,y1:d,x2:c+(i>>o),y2:d+(a>>o)}}s.x=function(t){return arguments.length?(e=number$2(t),s):e};s.y=function(e){return arguments.length?(t=number$2(e),s):t};s.weight=function(e){return arguments.length?(n=number$2(e),s):n};s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];if(!(t>=0&&n>=0))error("invalid size");return i=t,a=n,s};s.cellSize=function(e){if(!arguments.length)return 1<<o;if(!((e=+e)>=1))error("invalid cell size");o=Math.floor(Math.log(e)/Math.LN2);return s};s.bandwidth=function(e){if(!arguments.length)return r;e=array$5(e);if(e.length===1)e=[+e[0],+e[0]];if(e.length!==2)error("invalid bandwidth");return r=e,s};return s}function blurX(e,t,n,r,i){var a=(i<<1)+1;for(var o=0;o<t;++o){for(var s=0,u=0;s<e+i;++s){if(s<e){u+=n[s+o*e]}if(s>=i){if(s>=a){u-=n[s-a+o*e]}r[s-i+o*e]=u/Math.min(s+1,e-1+a-s,a)}}}}function blurY(e,t,n,r,i){var a=(i<<1)+1;for(var o=0;o<e;++o){for(var s=0,u=0;s<t+i;++s){if(s<t){u+=n[o+s*e]}if(s>=i){if(s>=a){u-=n[o+(s-a)*e]}r[o+(s-i)*e]=u/Math.min(s+1,t-1+a-s,a)}}}}function KDE2D(e){Transform.call(this,null,e)}KDE2D.Definition={type:"KDE2D",metadata:{generates:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"weight",type:"field"},{name:"groupby",type:"field",array:true},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:true,length:2},{name:"counts",type:"boolean",default:false},{name:"as",type:"string",default:"grid"}]};var PARAMS=["x","y","weight","size","cellSize","bandwidth"];function params(e,t){PARAMS.forEach((function(n){return t[n]!=null?e[n](t[n]):0}));return e}inherits(KDE2D,Transform,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=partition$2(r,e.groupby),a=(e.groupby||[]).map(accessorName),o=params(density2D(),e),s=e.as||"grid",u=[];function l(e,t){for(var n=0;n<a.length;++n)e[a[n]]=t[n];return e}u=i.map((function(t){var n;return ingest$1(l((n={},n[s]=o(t,e.counts),n),t.dims))}));if(this.value)n.rem=this.value;this.value=n.source=n.add=u;return n}});function partition$2(e,t){var n=[],r=function(e){return e(s)},i,a,o,s,u,l;if(t==null){n.push(e)}else{for(i={},a=0,o=e.length;a<o;++a){s=e[a];u=t.map(r);l=i[u];if(!l){i[u]=l=[];l.dims=u;n.push(l)}l.push(s)}}return n}function Contour(e){Transform.call(this,null,e)}Contour.Definition={type:"Contour",metadata:{generates:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"values",type:"number",array:true},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:false},{name:"thresholds",type:"number",array:true},{name:"smooth",type:"boolean",default:true}]};inherits(Contour,Transform,{transform:function(e,t){if(this.value&&!t.changed()&&!e.modified()){return t.StopPropagation}var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=contours().smooth(e.smooth!==false),i=e.values,a=e.thresholds||quantize(e.count||10,e.nice,!!i),o=e.size,s,u;if(!i){i=t.materialize(t.SOURCE).source;s=params(density2D(),e)(i,true);u=transform$1(s,s.scale||1,s.scale||1,0,0);o=[s.width,s.height];i=s.values}a=isArray(a)?a:a(i);i=r.size(o)(i,a);if(u)i.forEach(u);if(this.value)n.rem=this.value;this.value=n.source=n.add=(i||[]).map(ingest$1);return n}});var Feature="Feature";var FeatureCollection="FeatureCollection";var MultiPoint="MultiPoint";function GeoJSON(e){Transform.call(this,null,e)}GeoJSON.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:true,length:2},{name:"geojson",type:"field"}]};inherits(GeoJSON,Transform,{transform:function(e,t){var n=this._features,r=this._points,i=e.fields,a=i&&i[0],o=i&&i[1],s=e.geojson||!i&&identity$6,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(accessorFields(s))||a&&t.modified(accessorFields(a))||o&&t.modified(accessorFields(o));if(!this.value||l){u=t.SOURCE;this._features=n=[];this._points=r=[]}if(s){t.visit(u,(function(e){return n.push(s(e))}))}if(a&&o){t.visit(u,(function(e){var t=a(e),n=o(e);if(t!=null&&n!=null&&(t=+t)===t&&(n=+n)===n){r.push([t,n])}}));n=n.concat({type:Feature,geometry:{type:MultiPoint,coordinates:r}})}this.value={type:FeatureCollection,features:n}}});function GeoPath(e){Transform.call(this,null,e)}GeoPath.Definition={type:"GeoPath",metadata:{modifies:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"path"}]};inherits(GeoPath,Transform,{transform:function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||identity$6,a=e.as||"path",o=n.SOURCE;if(!r||e.modified()){this.value=r=getProjectionPath(e.projection);n.materialize().reflow()}else{o=i===identity$6||t.modified(i.fields)?n.ADD_MOD:n.ADD}var s=initPath(r,e.pointRadius);n.visit(o,(function(e){return e[a]=r(i(e))}));r.pointRadius(s);return n.modifies(a)}});function initPath(e,t){var n=e.pointRadius();e.context(null);if(t!=null){e.pointRadius(t)}return n}function GeoPoint(e){Transform.call(this,null,e)}GeoPoint.Definition={type:"GeoPoint",metadata:{modifies:true},params:[{name:"projection",type:"projection",required:true},{name:"fields",type:"field",array:true,required:true,length:2},{name:"as",type:"string",array:true,length:2,default:["x","y"]}]};inherits(GeoPoint,Transform,{transform:function(e,t){var n=e.projection,r=e.fields[0],i=e.fields[1],a=e.as||["x","y"],o=a[0],s=a[1],u;function l(e){var t=n([r(e),i(e)]);if(t){e[o]=t[0];e[s]=t[1]}else{e[o]=undefined;e[s]=undefined}}if(e.modified()){t=t.materialize().reflow(true).visit(t.SOURCE,l)}else{u=t.modified(r.fields)||t.modified(i.fields);t.visit(u?t.ADD_MOD:t.ADD,l)}return t.modifies(a)}});function GeoShape(e){Transform.call(this,null,e)}GeoShape.Definition={type:"GeoShape",metadata:{modifies:true,nomod:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"shape"}]};inherits(GeoShape,Transform,{transform:function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;if(!r||e.modified()){this.value=r=shapeGenerator(getProjectionPath(e.projection),e.field||field$1("datum"),e.pointRadius);n.materialize().reflow();a=n.SOURCE}n.visit(a,(function(e){return e[i]=r}));return n.modifies(i)}});function shapeGenerator(e,t,n){var r=n==null?function(n){return e(t(n))}:function(r){var i=e.pointRadius(),a=e.pointRadius(n)(t(r));e.pointRadius(i);return a};r.context=function(t){e.context(t);return r};return r}function Graticule(e){Transform.call(this,[],e);this.generator=graticule()}Graticule.Definition={type:"Graticule",metadata:{changes:true,generates:true},params:[{name:"extent",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMajor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMinor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"step",type:"number",array:true,length:2},{name:"stepMajor",type:"number",array:true,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:true,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};inherits(Graticule,Transform,{transform:function(e,t){var n=this.value,r=this.generator,i;if(!n.length||e.modified()){for(var a in e){if(isFunction(r[a])){r[a](e[a])}}}i=r();if(n.length){t.mod.push(replace$1(n[0],i))}else{t.add.push(ingest$1(i))}n[0]=i;return t}});function Heatmap(e){Transform.call(this,null,e)}Heatmap.Definition={type:"heatmap",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:true},{name:"opacity",type:"number",expr:true},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};inherits(Heatmap,Transform,{transform:function(e,t){if(!t.changed()&&!e.modified()){return t.StopPropagation}var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||identity$6,a=opacity_(e.opacity,e),o=color_(e.color,e),s=e.as||"image",u={$x:0,$y:0,$value:0,$max:r?max$2(n.map((function(e){return max$2(i(e).values)}))):0};n.forEach((function(e){var t=i(e);var n=extend$1({},e,u);if(!r)n.$max=max$2(t.values||[]);e[s]=toCanvas(t,n,o.dep?o:constant$4(o(n)),a.dep?a:constant$4(a(n)))}));return t.reflow(true).modifies(s)}});function color_(e,t){var n;if(isFunction(e)){n=function(n){return rgb$1(e(n,t))};n.dep=dependency(e)}else{n=constant$4(rgb$1(e||"#888"))}return n}function opacity_(e,t){var n;if(isFunction(e)){n=function(n){return e(n,t)};n.dep=dependency(e)}else if(e){n=constant$4(e)}else{n=function(e){return e.$value/e.$max||0};n.dep=true}return n}function dependency(e){if(!isFunction(e))return false;var t=toSet(accessorFields(e));return t.$x||t.$y||t.$value||t.$max}function toCanvas(e,t,n,r){var i=e.width,a=e.height,o=e.x1||0,s=e.y1||0,u=e.x2||i,l=e.y2||a,f=e.values,c=f?function(e){return f[e]}:zero$3,d=domCanvas(u-o,l-s),p=d.getContext("2d"),h=p.getImageData(0,0,u-o,l-s),g=h.data;for(var m=s,v=0;m<l;++m){t.$y=m-s;for(var y=o,_=m*i;y<u;++y,v+=4){t.$x=y-o;t.$value=c(y+_);var b=n(t);g[v+0]=b.r;g[v+1]=b.g;g[v+2]=b.b;g[v+3]=~~(255*r(t))}}p.putImageData(h,0,0);return d}function Projection$1(e){Transform.call(this,null,e);this.modified(true)}inherits(Projection$1,Transform,{transform:function(e,t){var n=this.value;if(!n||e.modified("type")){this.value=n=create(e.type);projectionProperties.forEach((function(t){if(e[t]!=null)set$2(n,t,e[t])}))}else{projectionProperties.forEach((function(t){if(e.modified(t))set$2(n,t,e[t])}))}if(e.pointRadius!=null)n.path.pointRadius(e.pointRadius);if(e.fit)fit(n,e);return t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function fit(e,t){var n=collectGeoJSON(t.fit);t.extent?e.fitExtent(t.extent,n):t.size?e.fitSize(t.size,n):0}function create(e){var t=projection((e||"mercator").toLowerCase());if(!t)error("Unrecognized projection type: "+e);return t()}function set$2(e,t,n){if(isFunction(e[t]))e[t](n)}function collectGeoJSON(e){e=array$5(e);return e.length===1?e[0]:{type:FeatureCollection,features:e.reduce((function(e,t){return e.concat(featurize(t))}),[])}}function featurize(e){return e.type===FeatureCollection?e.features:array$5(e).filter((function(e){return e!=null})).map((function(e){return e.type===Feature?e:{type:Feature,geometry:e}}))}var geo=Object.freeze({__proto__:null,contour:Contour,geojson:GeoJSON,geopath:GeoPath,geopoint:GeoPoint,geoshape:GeoShape,graticule:Graticule,heatmap:Heatmap,isocontour:Isocontour,kde2d:KDE2D,projection:Projection$1});function forceCenter(e,t){var n,r=1;if(e==null)e=0;if(t==null)t=0;function i(){var i,a=n.length,o,s=0,u=0;for(i=0;i<a;++i){o=n[i],s+=o.x,u+=o.y}for(s=(s/a-e)*r,u=(u/a-t)*r,i=0;i<a;++i){o=n[i],o.x-=s,o.y-=u}}i.initialize=function(e){n=e};i.x=function(t){return arguments.length?(e=+t,i):e};i.y=function(e){return arguments.length?(t=+e,i):t};i.strength=function(e){return arguments.length?(r=+e,i):r};return i}function tree_add(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return add$1(this.cover(t,n),t,n,e)}function add$1(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a=e._root,o={data:r},s=e._x0,u=e._y0,l=e._x1,f=e._y1,c,d,p,h,g,m,v,y;if(!a)return e._root=o,e;while(a.length){if(g=t>=(c=(s+l)/2))s=c;else l=c;if(m=n>=(d=(u+f)/2))u=d;else f=d;if(i=a,!(a=a[v=m<<1|g]))return i[v]=o,e}p=+e._x.call(null,a.data);h=+e._y.call(null,a.data);if(t===p&&n===h)return o.next=a,i?i[v]=o:e._root=o,e;do{i=i?i[v]=new Array(4):e._root=new Array(4);if(g=t>=(c=(s+l)/2))s=c;else l=c;if(m=n>=(d=(u+f)/2))u=d;else f=d}while((v=m<<1|g)===(y=(h>=d)<<1|p>=c));return i[y]=a,i[v]=o,e}function addAll(e){var t,n,r=e.length,i,a,o=new Array(r),s=new Array(r),u=Infinity,l=Infinity,f=-Infinity,c=-Infinity;for(n=0;n<r;++n){if(isNaN(i=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t)))continue;o[n]=i;s[n]=a;if(i<u)u=i;if(i>f)f=i;if(a<l)l=a;if(a>c)c=a}if(u>f||l>c)return this;this.cover(u,l).cover(f,c);for(n=0;n<r;++n){add$1(this,o[n],s[n],e[n])}return this}function tree_cover(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n)){i=(n=Math.floor(e))+1;a=(r=Math.floor(t))+1}else{var o=i-n||1,s=this._root,u,l;while(n>e||e>=i||r>t||t>=a){l=(t<r)<<1|e<n;u=new Array(4),u[l]=s,s=u,o*=2;switch(l){case 0:i=n+o,a=r+o;break;case 1:n=i-o,a=r+o;break;case 2:i=n+o,r=a-o;break;case 3:n=i-o,r=a-o;break}}if(this._root&&this._root.length)this._root=s}this._x0=n;this._y0=r;this._x1=i;this._y1=a;return this}function tree_data(){var e=[];this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}));return e}function tree_extent(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?undefined:[[this._x0,this._y0],[this._x1,this._y1]]}function Quad(e,t,n,r,i){this.node=e;this.x0=t;this.y0=n;this.x1=r;this.y1=i}function tree_find(e,t,n){var r,i=this._x0,a=this._y0,o,s,u,l,f=this._x1,c=this._y1,d=[],p=this._root,h,g;if(p)d.push(new Quad(p,i,a,f,c));if(n==null)n=Infinity;else{i=e-n,a=t-n;f=e+n,c=t+n;n*=n}while(h=d.pop()){if(!(p=h.node)||(o=h.x0)>f||(s=h.y0)>c||(u=h.x1)<i||(l=h.y1)<a)continue;if(p.length){var m=(o+u)/2,v=(s+l)/2;d.push(new Quad(p[3],m,v,u,l),new Quad(p[2],o,v,m,l),new Quad(p[1],m,s,u,v),new Quad(p[0],o,s,m,v));if(g=(t>=v)<<1|e>=m){h=d[d.length-1];d[d.length-1]=d[d.length-1-g];d[d.length-1-g]=h}}else{var y=e-+this._x.call(null,p.data),_=t-+this._y.call(null,p.data),b=y*y+_*_;if(b<n){var x=Math.sqrt(n=b);i=e-x,a=t-x;f=e+x,c=t+x;r=p.data}}}return r}function tree_remove(e){if(isNaN(f=+this._x.call(null,e))||isNaN(c=+this._y.call(null,e)))return this;var t,n=this._root,r,i,a,o=this._x0,s=this._y0,u=this._x1,l=this._y1,f,c,d,p,h,g,m,v;if(!n)return this;if(n.length)while(true){if(h=f>=(d=(o+u)/2))o=d;else u=d;if(g=c>=(p=(s+l)/2))s=p;else l=p;if(!(t=n,n=n[m=g<<1|h]))return this;if(!n.length)break;if(t[m+1&3]||t[m+2&3]||t[m+3&3])r=t,v=m}while(n.data!==e)if(!(i=n,n=n.next))return this;if(a=n.next)delete n.next;if(i)return a?i.next=a:delete i.next,this;if(!t)return this._root=a,this;a?t[m]=a:delete t[m];if((n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length){if(r)r[v]=n;else this._root=n}return this}function removeAll(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function tree_root(){return this._root}function tree_size(){var e=0;this.visit((function(t){if(!t.length)do{++e}while(t=t.next)}));return e}function tree_visit(e){var t=[],n,r=this._root,i,a,o,s,u;if(r)t.push(new Quad(r,this._x0,this._y0,this._x1,this._y1));while(n=t.pop()){if(!e(r=n.node,a=n.x0,o=n.y0,s=n.x1,u=n.y1)&&r.length){var l=(a+s)/2,f=(o+u)/2;if(i=r[3])t.push(new Quad(i,l,f,s,u));if(i=r[2])t.push(new Quad(i,a,f,l,u));if(i=r[1])t.push(new Quad(i,l,o,s,f));if(i=r[0])t.push(new Quad(i,a,o,l,f))}}return this}function tree_visitAfter(e){var t=[],n=[],r;if(this._root)t.push(new Quad(this._root,this._x0,this._y0,this._x1,this._y1));while(r=t.pop()){var i=r.node;if(i.length){var a,o=r.x0,s=r.y0,u=r.x1,l=r.y1,f=(o+u)/2,c=(s+l)/2;if(a=i[0])t.push(new Quad(a,o,s,f,c));if(a=i[1])t.push(new Quad(a,f,s,u,c));if(a=i[2])t.push(new Quad(a,o,c,f,l));if(a=i[3])t.push(new Quad(a,f,c,u,l))}n.push(r)}while(r=n.pop()){e(r.node,r.x0,r.y0,r.x1,r.y1)}return this}function defaultX(e){return e[0]}function tree_x(e){return arguments.length?(this._x=e,this):this._x}function defaultY(e){return e[1]}function tree_y(e){return arguments.length?(this._y=e,this):this._y}function quadtree(e,t,n){var r=new Quadtree(t==null?defaultX:t,n==null?defaultY:n,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function Quadtree(e,t,n,r,i,a){this._x=e;this._y=t;this._x0=n;this._y0=r;this._x1=i;this._y1=a;this._root=undefined}function leaf_copy(e){var t={data:e.data},n=t;while(e=e.next)n=n.next={data:e.data};return t}var treeProto=quadtree.prototype=Quadtree.prototype;treeProto.copy=function(){var e=new Quadtree(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,r;if(!t)return e;if(!t.length)return e._root=leaf_copy(t),e;n=[{source:t,target:e._root=new Array(4)}];while(t=n.pop()){for(var i=0;i<4;++i){if(r=t.source[i]){if(r.length)n.push({source:r,target:t.target[i]=new Array(4)});else t.target[i]=leaf_copy(r)}}}return e};treeProto.add=tree_add;treeProto.addAll=addAll;treeProto.cover=tree_cover;treeProto.data=tree_data;treeProto.extent=tree_extent;treeProto.find=tree_find;treeProto.remove=tree_remove;treeProto.removeAll=removeAll;treeProto.root=tree_root;treeProto.size=tree_size;treeProto.visit=tree_visit;treeProto.visitAfter=tree_visitAfter;treeProto.x=tree_x;treeProto.y=tree_y;function constant$1(e){return function(){return e}}function jiggle(e){return(e()-.5)*1e-6}function x$1(e){return e.x+e.vx}function y$1(e){return e.y+e.vy}function forceCollide(e){var t,n,r,i=1,a=1;if(typeof e!=="function")e=constant$1(e==null?1:+e);function o(){var e,o=t.length,u,l,f,c,d,p;for(var h=0;h<a;++h){u=quadtree(t,x$1,y$1).visitAfter(s);for(e=0;e<o;++e){l=t[e];d=n[l.index],p=d*d;f=l.x+l.vx;c=l.y+l.vy;u.visit(g)}}function g(e,t,n,a,o){var s=e.data,u=e.r,h=d+u;if(s){if(s.index>l.index){var g=f-s.x-s.vx,m=c-s.y-s.vy,v=g*g+m*m;if(v<h*h){if(g===0)g=jiggle(r),v+=g*g;if(m===0)m=jiggle(r),v+=m*m;v=(h-(v=Math.sqrt(v)))/v*i;l.vx+=(g*=v)*(h=(u*=u)/(p+u));l.vy+=(m*=v)*h;s.vx-=g*(h=1-h);s.vy-=m*h}}return}return t>f+h||a<f-h||n>c+h||o<c-h}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t){if(e[t]&&e[t].r>e.r){e.r=e[t].r}}}function u(){if(!t)return;var r,i=t.length,a;n=new Array(i);for(r=0;r<i;++r)a=t[r],n[a.index]=+e(a,r,t)}o.initialize=function(e,n){t=e;r=n;u()};o.iterations=function(e){return arguments.length?(a=+e,o):a};o.strength=function(e){return arguments.length?(i=+e,o):i};o.radius=function(t){return arguments.length?(e=typeof t==="function"?t:constant$1(+t),u(),o):e};return o}function index$1(e){return e.index}function find$1(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function forceLink(e){var t=index$1,n=c,r,i=constant$1(30),a,o,s,u,l,f=1;if(e==null)e=[];function c(e){return 1/Math.min(s[e.source.index],s[e.target.index])}function d(t){for(var n=0,i=e.length;n<f;++n){for(var o=0,s,c,d,p,h,g,m;o<i;++o){s=e[o],c=s.source,d=s.target;p=d.x+d.vx-c.x-c.vx||jiggle(l);h=d.y+d.vy-c.y-c.vy||jiggle(l);g=Math.sqrt(p*p+h*h);g=(g-a[o])/g*t*r[o];p*=g,h*=g;d.vx-=p*(m=u[o]);d.vy-=h*m;c.vx+=p*(m=1-m);c.vy+=h*m}}}function p(){if(!o)return;var n,i=o.length,l=e.length,f=new Map(o.map((function(e,n){return[t(e,n,o),e]}))),c;for(n=0,s=new Array(i);n<l;++n){c=e[n],c.index=n;if(typeof c.source!=="object")c.source=find$1(f,c.source);if(typeof c.target!=="object")c.target=find$1(f,c.target);s[c.source.index]=(s[c.source.index]||0)+1;s[c.target.index]=(s[c.target.index]||0)+1}for(n=0,u=new Array(l);n<l;++n){c=e[n],u[n]=s[c.source.index]/(s[c.source.index]+s[c.target.index])}r=new Array(l),h();a=new Array(l),g()}function h(){if(!o)return;for(var t=0,i=e.length;t<i;++t){r[t]=+n(e[t],t,e)}}function g(){if(!o)return;for(var t=0,n=e.length;t<n;++t){a[t]=+i(e[t],t,e)}}d.initialize=function(e,t){o=e;l=t;p()};d.links=function(t){return arguments.length?(e=t,p(),d):e};d.id=function(e){return arguments.length?(t=e,d):t};d.iterations=function(e){return arguments.length?(f=+e,d):f};d.strength=function(e){return arguments.length?(n=typeof e==="function"?e:constant$1(+e),h(),d):n};d.distance=function(e){return arguments.length?(i=typeof e==="function"?e:constant$1(+e),g(),d):i};return d}var noop={value:function(){}};function dispatch(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Dispatch(n)}function Dispatch(e){this._=e}function parseTypenames(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0)n=e.slice(r+1),e=e.slice(0,r);if(e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(e,t){var n=this._,r=parseTypenames(e+"",n),i,a=-1,o=r.length;if(arguments.length<2){while(++a<o)if((i=(e=r[a]).type)&&(i=get(n[i],e.name)))return i;return}if(t!=null&&typeof t!=="function")throw new Error("invalid callback: "+t);while(++a<o){if(i=(e=r[a]).type)n[i]=set$1(n[i],e.name,t);else if(t==null)for(i in n)n[i]=set$1(n[i],e.name,null)}return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Dispatch(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],r=0,i=a.length;r<i;++r)a[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};function get(e,t){for(var n=0,r=e.length,i;n<r;++n){if((i=e[n]).name===t){return i.value}}}function set$1(e,t,n){for(var r=0,i=e.length;r<i;++r){if(e[r].name===t){e[r]=noop,e=e.slice(0,r).concat(e.slice(r+1));break}}if(n!=null)e.push({name:t,value:n});return e}var frame=0,timeout=0,interval$2=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=typeof performance==="object"&&performance.now?performance:Date,setFrame=typeof window==="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer$1(){this._call=this._time=this._next=null}Timer$1.prototype=timer$1.prototype={constructor:Timer$1,restart:function(e,t,n){if(typeof e!=="function")throw new TypeError("callback is not a function");n=(n==null?now():+n)+(t==null?0:+t);if(!this._next&&taskTail!==this){if(taskTail)taskTail._next=this;else taskHead=this;taskTail=this}this._call=e;this._time=n;sleep()},stop:function(){if(this._call){this._call=null;this._time=Infinity;sleep()}}};function timer$1(e,t,n){var r=new Timer$1;r.restart(e,t,n);return r}function timerFlush(){now();++frame;var e=taskHead,t;while(e){if((t=clockNow-e._time)>=0)e._call.call(null,t);e=e._next}--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew;frame=timeout=0;try{timerFlush()}finally{frame=0;nap();clockNow=0}}function poke(){var e=clock.now(),t=e-clockLast;if(t>pokeDelay)clockSkew-=t,clockLast=e}function nap(){var e,t=taskHead,n,r=Infinity;while(t){if(t._call){if(r>t._time)r=t._time;e=t,t=t._next}else{n=t._next,t._next=null;t=e?e._next=n:taskHead=n}}taskTail=e;sleep(r)}function sleep(e){if(frame)return;if(timeout)timeout=clearTimeout(timeout);var t=e-clockNow;if(t>24){if(e<Infinity)timeout=setTimeout(wake,e-clock.now()-clockSkew);if(interval$2)interval$2=clearInterval(interval$2)}else{if(!interval$2)clockLast=clock.now(),interval$2=setInterval(poke,pokeDelay);frame=1,setFrame(wake)}}function interval$1(e,t,n){var r=new Timer$1,i=t;if(t==null)return r.restart(e,t,n),r;r._restart=r.restart;r.restart=function(e,t,n){t=+t,n=n==null?now():+n;r._restart((function a(o){o+=i;r._restart(a,i+=t,n);e(o)}),t,n)};r.restart(e,t,n);return r}var a=1664525;var c=1013904223;var m=4294967296;function lcg(){var e=1;return function(){return(e=(a*e+c)%m)/m}}function x(e){return e.x}function y(e){return e.y}var initialRadius=10,initialAngle=Math.PI*(3-Math.sqrt(5));function forceSimulation(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,u=timer$1(c),l=dispatch("tick","end"),f=lcg();if(e==null)e=[];function c(){d();l.call("tick",t);if(n<r){u.stop();l.call("end",t)}}function d(r){var u,l=e.length,f;if(r===undefined)r=1;for(var c=0;c<r;++c){n+=(a-n)*i;s.forEach((function(e){e(n)}));for(u=0;u<l;++u){f=e[u];if(f.fx==null)f.x+=f.vx*=o;else f.x=f.fx,f.vx=0;if(f.fy==null)f.y+=f.vy*=o;else f.y=f.fy,f.vy=0}}return t}function p(){for(var t=0,n=e.length,r;t<n;++t){r=e[t],r.index=t;if(r.fx!=null)r.x=r.fx;if(r.fy!=null)r.y=r.fy;if(isNaN(r.x)||isNaN(r.y)){var i=initialRadius*Math.sqrt(.5+t),a=t*initialAngle;r.x=i*Math.cos(a);r.y=i*Math.sin(a)}if(isNaN(r.vx)||isNaN(r.vy)){r.vx=r.vy=0}}}function h(t){if(t.initialize)t.initialize(e,f);return t}p();return t={tick:d,restart:function(){return u.restart(c),t},stop:function(){return u.stop(),t},nodes:function(n){return arguments.length?(e=n,p(),s.forEach(h),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(f=e,s.forEach(h),t):f},force:function(e,n){return arguments.length>1?(n==null?s.delete(e):s.set(e,h(n)),t):s.get(e)},find:function(t,n,r){var i=0,a=e.length,o,s,u,l,f;if(r==null)r=Infinity;else r*=r;for(i=0;i<a;++i){l=e[i];o=t-l.x;s=n-l.y;u=o*o+s*s;if(u<r)f=l,r=u}return f},on:function(e,n){return arguments.length>1?(l.on(e,n),t):l.on(e)}}}function forceManyBody(){var e,t,n,r,i=constant$1(-30),a,o=1,s=Infinity,u=.81;function l(n){var i,a=e.length,o=quadtree(e,x,y).visitAfter(c);for(r=n,i=0;i<a;++i)t=e[i],o.visit(d)}function f(){if(!e)return;var t,n=e.length,r;a=new Array(n);for(t=0;t<n;++t)r=e[t],a[r.index]=+i(r,t,e)}function c(e){var t=0,n,r,i=0,o,s,u;if(e.length){for(o=s=u=0;u<4;++u){if((n=e[u])&&(r=Math.abs(n.value))){t+=n.value,i+=r,o+=r*n.x,s+=r*n.y}}e.x=o/i;e.y=s/i}else{n=e;n.x=n.data.x;n.y=n.data.y;do{t+=a[n.data.index]}while(n=n.next)}e.value=t}function d(e,i,l,f){if(!e.value)return true;var c=e.x-t.x,d=e.y-t.y,p=f-i,h=c*c+d*d;if(p*p/u<h){if(h<s){if(c===0)c=jiggle(n),h+=c*c;if(d===0)d=jiggle(n),h+=d*d;if(h<o)h=Math.sqrt(o*h);t.vx+=c*e.value*r/h;t.vy+=d*e.value*r/h}return true}else if(e.length||h>=s)return;if(e.data!==t||e.next){if(c===0)c=jiggle(n),h+=c*c;if(d===0)d=jiggle(n),h+=d*d;if(h<o)h=Math.sqrt(o*h)}do{if(e.data!==t){p=a[e.data.index]*r/h;t.vx+=c*p;t.vy+=d*p}}while(e=e.next)}l.initialize=function(t,r){e=t;n=r;f()};l.strength=function(e){return arguments.length?(i=typeof e==="function"?e:constant$1(+e),f(),l):i};l.distanceMin=function(e){return arguments.length?(o=e*e,l):Math.sqrt(o)};l.distanceMax=function(e){return arguments.length?(s=e*e,l):Math.sqrt(s)};l.theta=function(e){return arguments.length?(u=e*e,l):Math.sqrt(u)};return l}function forceX(e){var t=constant$1(.1),n,r,i;if(typeof e!=="function")e=constant$1(e==null?0:+e);function a(e){for(var t=0,a=n.length,o;t<a;++t){o=n[t],o.vx+=(i[t]-o.x)*r[t]*e}}function o(){if(!n)return;var a,o=n.length;r=new Array(o);i=new Array(o);for(a=0;a<o;++a){r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}a.initialize=function(e){n=e;o()};a.strength=function(e){return arguments.length?(t=typeof e==="function"?e:constant$1(+e),o(),a):t};a.x=function(t){return arguments.length?(e=typeof t==="function"?t:constant$1(+t),o(),a):e};return a}function forceY(e){var t=constant$1(.1),n,r,i;if(typeof e!=="function")e=constant$1(e==null?0:+e);function a(e){for(var t=0,a=n.length,o;t<a;++t){o=n[t],o.vy+=(i[t]-o.y)*r[t]*e}}function o(){if(!n)return;var a,o=n.length;r=new Array(o);i=new Array(o);for(a=0;a<o;++a){r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}a.initialize=function(e){n=e;o()};a.strength=function(e){return arguments.length?(t=typeof e==="function"?e:constant$1(+e),o(),a):t};a.y=function(t){return arguments.length?(e=typeof t==="function"?t:constant$1(+t),o(),a):e};return a}var ForceMap={center:forceCenter,collide:forceCollide,nbody:forceManyBody,link:forceLink,x:forceX,y:forceY};var Forces="forces",ForceParams=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],ForceConfig=["static","iterations"],ForceOutput=["x","y","vx","vy"];function Force(e){Transform.call(this,null,e)}Force.Definition={type:"Force",metadata:{modifies:true},params:[{name:"static",type:"boolean",default:false},{name:"restart",type:"boolean",default:false},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:true,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:true},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:true},{name:"strength",type:"number",expr:true},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:true,modify:false,default:ForceOutput}]};inherits(Force,Transform,{transform:function(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(ForceParams),a=e.iterations||300;if(!n){this.value=n=simulation(t.source,e);n.on("tick",rerun(t.dataflow,this));if(!e.static){r=true;n.tick()}t.modifies("index")}else{if(r){t.modifies("index");n.nodes(t.source)}if(i||t.changed(t.MOD)){setup(n,e,0,t)}}if(i||r||e.modified(ForceConfig)||t.changed()&&e.restart){n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a));if(e.static){for(n.stop();--a>=0;)n.tick()}else{if(n.stopped())n.restart();if(!r)return t.StopPropagation}}return this.finish(e,t)},finish:function(e,t){var n=t.dataflow;for(var r=this._argops,i=0,a=r.length,o=void 0;i<a;++i){o=r[i];if(o.name!==Forces||o.op._argval.force!=="link"){continue}for(var s=o.op._argops,u=0,l=s.length,f;u<l;++u){if(s[u].name==="links"&&(f=s[u].op.source)){n.pulse(f,n.changeset().reflow());break}}}return t.reflow(e.modified()).modifies(ForceOutput)}});function rerun(e,t){return function(){return e.touch(t).run()}}function simulation(e,t){var n=forceSimulation(e),r=n.stop,i=n.restart;var a=false;n.stopped=function(){return a};n.restart=function(){return a=false,i()};n.stop=function(){return a=true,r()};return setup(n,t,true).on("end",(function(){return a=true}))}function setup(e,t,n,r){var i=array$5(t.forces),a,o,s,u;for(a=0,o=ForceParams.length;a<o;++a){s=ForceParams[a];if(s!==Forces&&t.modified(s))e[s](t[s])}for(a=0,o=i.length;a<o;++a){u=Forces+a;s=n||t.modified(Forces,a)?getForce(i[a]):r&&modified(i[a],r)?e.force(u):null;if(s)e.force(u,s)}for(o=e.numForces||0;a<o;++a){e.force(Forces+a,null)}e.numForces=i.length;return e}function modified(e,t){var n,r;for(n in e){if(isFunction(r=e[n])&&t.modified(accessorFields(r)))return 1}return 0}function getForce(e){var t,n;if(!has$1(ForceMap,e.force)){error("Unrecognized force: "+e.force)}t=ForceMap[e.force]();for(n in e){if(isFunction(t[n]))setForceParam(t[n],e[n],e)}return t}function setForceParam(e,t,n){e(isFunction(t)?function(e){return t(e,n)}:t)}var force=Object.freeze({__proto__:null,force:Force});function defaultSeparation$2(e,t){return e.parent===t.parent?1:2}function meanX(e){return e.reduce(meanXReduce,0)/e.length}function meanXReduce(e,t){return e+t.x}function maxY(e){return 1+e.reduce(maxYReduce,0)}function maxYReduce(e,t){return Math.max(e,t.y)}function leafLeft(e){var t;while(t=e.children)e=t[0];return e}function leafRight(e){var t;while(t=e.children)e=t[t.length-1];return e}function cluster(){var e=defaultSeparation$2,t=1,n=1,r=false;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;if(n){t.x=meanX(n);t.y=maxY(n)}else{t.x=a?o+=e(t,a):0;t.y=0;a=t}}));var s=leafLeft(i),u=leafRight(i),l=s.x-e(s,u)/2,f=u.x+e(u,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t;e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-l)/(f-l)*t;e.y=(1-(i.y?e.y/i.y:1))*n})}i.separation=function(t){return arguments.length?(e=t,i):e};i.size=function(e){return arguments.length?(r=false,t=+e[0],n=+e[1],i):r?null:[t,n]};i.nodeSize=function(e){return arguments.length?(r=true,t=+e[0],n=+e[1],i):r?[t,n]:null};return i}function count(e){var t=0,n=e.children,r=n&&n.length;if(!r)t=1;else while(--r>=0)t+=n[r].value;e.value=t}function node_count(){return this.eachAfter(count)}function node_each(e,t){var n=-1;for(var r=0,i=this;r<i.length;r++){var a=i[r];e.call(t,a,++n,this)}return this}function node_eachBefore(e,t){var n=this,r=[n],i,a,o=-1;while(n=r.pop()){e.call(t,n,++o,this);if(i=n.children){for(a=i.length-1;a>=0;--a){r.push(i[a])}}}return this}function node_eachAfter(e,t){var n=this,r=[n],i=[],a,o,s,u=-1;while(n=r.pop()){i.push(n);if(a=n.children){for(o=0,s=a.length;o<s;++o){r.push(a[o])}}}while(n=i.pop()){e.call(t,n,++u,this)}return this}function node_find(e,t){var n=-1;for(var r=0,i=this;r<i.length;r++){var a=i[r];if(e.call(t,a,++n,this)){return a}}}function node_sum(e){return this.eachAfter((function(t){var n=+e(t.data)||0,r=t.children,i=r&&r.length;while(--i>=0)n+=r[i].value;t.value=n}))}function node_sort(e){return this.eachBefore((function(t){if(t.children){t.children.sort(e)}}))}function node_path(e){var t=this,n=leastCommonAncestor(t,e),r=[t];while(t!==n){t=t.parent;r.push(t)}var i=r.length;while(e!==n){r.splice(i,0,e);e=e.parent}return r}function leastCommonAncestor(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;e=n.pop();t=r.pop();while(e===t){i=e;e=n.pop();t=r.pop()}return i}function node_ancestors(){var e=this,t=[e];while(e=e.parent){t.push(e)}return t}function node_descendants(){return Array.from(this)}function node_leaves(){var e=[];this.eachBefore((function(t){if(!t.children){e.push(t)}}));return e}function node_links(){var e=this,t=[];e.each((function(n){if(n!==e){t.push({source:n.parent,target:n})}}));return t}function node_iterator(){var e,t,n,r,i,a;return __generator(this,(function(o){switch(o.label){case 0:e=this,n=[e];o.label=1;case 1:t=n.reverse(),n=[];o.label=2;case 2:if(!(e=t.pop()))return[3,4];return[4,e];case 3:o.sent();if(r=e.children){for(i=0,a=r.length;i<a;++i){n.push(r[i])}}return[3,2];case 4:if(n.length)return[3,1];o.label=5;case 5:return[2]}}))}function hierarchy(e,t){if(e instanceof Map){e=[undefined,e];if(t===undefined)t=mapChildren}else if(t===undefined){t=objectChildren}var n=new Node$1(e),r,i=[n],a,o,s,u;while(r=i.pop()){if((o=t(r.data))&&(u=(o=Array.from(o)).length)){r.children=o;for(s=u-1;s>=0;--s){i.push(a=o[s]=new Node$1(o[s]));a.parent=r;a.depth=r.depth+1}}}return n.eachBefore(computeHeight)}function node_copy(){return hierarchy(this).eachBefore(copyData)}function objectChildren(e){return e.children}function mapChildren(e){return Array.isArray(e)?e[1]:null}function copyData(e){if(e.data.value!==undefined)e.value=e.data.value;e.data=e.data.data}function computeHeight(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function Node$1(e){this.data=e;this.depth=this.height=0;this.parent=null}Node$1.prototype=hierarchy.prototype=(_5={constructor:Node$1,count:node_count,each:node_each,eachAfter:node_eachAfter,eachBefore:node_eachBefore,find:node_find,sum:node_sum,sort:node_sort,path:node_path,ancestors:node_ancestors,descendants:node_descendants,leaves:node_leaves,links:node_links,copy:node_copy},_5[Symbol.iterator]=node_iterator,_5);function array$2(e){return typeof e==="object"&&"length"in e?e:Array.from(e)}function shuffle(e){var t=e.length,n,r;while(t){r=Math.random()*t--|0;n=e[t];e[t]=e[r];e[r]=n}return e}function enclose(e){var t=0,n=(e=shuffle(Array.from(e))).length,r=[],i,a;while(t<n){i=e[t];if(a&&enclosesWeak(a,i))++t;else a=encloseBasis(r=extendBasis(r,i)),t=0}return a}function extendBasis(e,t){var n,r;if(enclosesWeakAll(t,e))return[t];for(n=0;n<e.length;++n){if(enclosesNot(t,e[n])&&enclosesWeakAll(encloseBasis2(e[n],t),e)){return[e[n],t]}}for(n=0;n<e.length-1;++n){for(r=n+1;r<e.length;++r){if(enclosesNot(encloseBasis2(e[n],e[r]),t)&&enclosesNot(encloseBasis2(e[n],t),e[r])&&enclosesNot(encloseBasis2(e[r],t),e[n])&&enclosesWeakAll(encloseBasis3(e[n],e[r],t),e)){return[e[n],e[r],t]}}}throw new Error}function enclosesNot(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function enclosesWeak(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function enclosesWeakAll(e,t){for(var n=0;n<t.length;++n){if(!enclosesWeak(e,t[n])){return false}}return true}function encloseBasis(e){switch(e.length){case 1:return encloseBasis1(e[0]);case 2:return encloseBasis2(e[0],e[1]);case 3:return encloseBasis3(e[0],e[1],e[2])}}function encloseBasis1(e){return{x:e.x,y:e.y,r:e.r}}function encloseBasis2(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,u=a-n,l=o-r,f=s-i,c=Math.sqrt(u*u+l*l);return{x:(n+a+u/c*f)/2,y:(r+o+l/c*f)/2,r:(c+i+s)/2}}function encloseBasis3(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,u=t.r,l=n.x,f=n.y,c=n.r,d=r-o,p=r-l,h=i-s,g=i-f,m=u-a,v=c-a,y=r*r+i*i-a*a,_=y-o*o-s*s+u*u,b=y-l*l-f*f+c*c,x=p*h-d*g,E=(h*b-g*_)/(x*2)-r,S=(g*m-h*v)/x,$=(p*_-d*b)/(x*2)-i,A=(d*v-p*m)/x,D=S*S+A*A-1,w=2*(a+E*S+$*A),C=E*E+$*$-a*a,T=-(D?(w+Math.sqrt(w*w-4*D*C))/(2*D):C/w);return{x:r+E+S*T,y:i+$+A*T,r:T}}function place(e,t,n){var r=e.x-t.x,i,a,o=e.y-t.y,s,u,l=r*r+o*o;if(l){a=t.r+n.r,a*=a;u=e.r+n.r,u*=u;if(a>u){i=(l+u-a)/(2*l);s=Math.sqrt(Math.max(0,u/l-i*i));n.x=e.x-i*r-s*o;n.y=e.y-i*o+s*r}else{i=(l+a-u)/(2*l);s=Math.sqrt(Math.max(0,a/l-i*i));n.x=t.x+i*r-s*o;n.y=t.y+i*o+s*r}}else{n.x=t.x+n.r;n.y=t.y}}function intersects(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function score(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function Node(e){this._=e;this.next=null;this.previous=null}function packEnclose(e){if(!(i=(e=array$2(e)).length))return 0;var t,n,r,i,a,o,s,u,l,f,c;t=e[0],t.x=0,t.y=0;if(!(i>1))return t.r;n=e[1],t.x=-n.r,n.x=t.r,n.y=0;if(!(i>2))return t.r+n.r;place(n,t,r=e[2]);t=new Node(t),n=new Node(n),r=new Node(r);t.next=r.previous=n;n.next=t.previous=r;r.next=n.previous=t;e:for(s=3;s<i;++s){place(t._,n._,r=e[s]),r=new Node(r);u=n.next,l=t.previous,f=n._.r,c=t._.r;do{if(f<=c){if(intersects(u._,r._)){n=u,t.next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.next}else{if(intersects(l._,r._)){t=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.previous}}while(u!==l.next);r.previous=t,r.next=n,t.next=n.previous=n=r;a=score(t);while((r=r.next)!==n){if((o=score(r))<a){t=r,a=o}}n=t.next}t=[n._],r=n;while((r=r.next)!==n)t.push(r._);r=enclose(t);for(s=0;s<i;++s)t=e[s],t.x-=r.x,t.y-=r.y;return r.r}function optional(e){return e==null?null:required(e)}function required(e){if(typeof e!=="function")throw new Error;return e}function constantZero(){return 0}function constant(e){return function(){return e}}function defaultRadius(e){return Math.sqrt(e.value)}function pack(){var e=null,t=1,n=1,r=constantZero;function i(i){i.x=t/2,i.y=n/2;if(e){i.eachBefore(radiusLeaf(e)).eachAfter(packChildren(r,.5)).eachBefore(translateChild(1))}else{i.eachBefore(radiusLeaf(defaultRadius)).eachAfter(packChildren(constantZero,1)).eachAfter(packChildren(r,i.r/Math.min(t,n))).eachBefore(translateChild(Math.min(t,n)/(2*i.r)))}return i}i.radius=function(t){return arguments.length?(e=optional(t),i):e};i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]};i.padding=function(e){return arguments.length?(r=typeof e==="function"?e:constant(+e),i):r};return i}function radiusLeaf(e){return function(t){if(!t.children){t.r=Math.max(0,+e(t)||0)}}}function packChildren(e,t){return function(n){if(r=n.children){var r,i,a=r.length,o=e(n)*t||0,s;if(o)for(i=0;i<a;++i)r[i].r+=o;s=packEnclose(r);if(o)for(i=0;i<a;++i)r[i].r-=o;n.r=s+o}}}function translateChild(e){return function(t){var n=t.parent;t.r*=e;if(n){t.x=n.x+e*t.x;t.y=n.y+e*t.y}}}function roundNode(e){e.x0=Math.round(e.x0);e.y0=Math.round(e.y0);e.x1=Math.round(e.x1);e.y1=Math.round(e.y1)}function treemapDice(e,t,n,r,i){var a=e.children,o,s=-1,u=a.length,l=e.value&&(r-t)/e.value;while(++s<u){o=a[s],o.y0=n,o.y1=i;o.x0=t,o.x1=t+=o.value*l}}function partition$1(){var e=1,t=1,n=0,r=false;function i(i){var o=i.height+1;i.x0=i.y0=n;i.x1=e;i.y1=t/o;i.eachBefore(a(t,o));if(r)i.eachBefore(roundNode);return i}function a(e,t){return function(r){if(r.children){treemapDice(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t)}var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;if(o<i)i=o=(i+o)/2;if(s<a)a=s=(a+s)/2;r.x0=i;r.y0=a;r.x1=o;r.y1=s}}i.round=function(e){return arguments.length?(r=!!e,i):r};i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]};i.padding=function(e){return arguments.length?(n=+e,i):n};return i}var preroot={depth:-1},ambiguous={};function defaultId(e){return e.id}function defaultParentId(e){return e.parentId}function stratify(){var e=defaultId,t=defaultParentId;function n(n){var r=Array.from(n),i=r.length,a,o,s,u,l,f,c,d=new Map;for(o=0;o<i;++o){a=r[o],l=r[o]=new Node$1(a);if((f=e(a,o,n))!=null&&(f+="")){c=l.id=f;d.set(c,d.has(c)?ambiguous:l)}if((f=t(a,o,n))!=null&&(f+="")){l.parent=f}}for(o=0;o<i;++o){l=r[o];if(f=l.parent){u=d.get(f);if(!u)throw new Error("missing: "+f);if(u===ambiguous)throw new Error("ambiguous: "+f);if(u.children)u.children.push(l);else u.children=[l];l.parent=u}else{if(s)throw new Error("multiple roots");s=l}}if(!s)throw new Error("no root");s.parent=preroot;s.eachBefore((function(e){e.depth=e.parent.depth+1;--i})).eachBefore(computeHeight);s.parent=null;if(i>0)throw new Error("cycle");return s}n.id=function(t){return arguments.length?(e=required(t),n):e};n.parentId=function(e){return arguments.length?(t=required(e),n):t};return n}function defaultSeparation$1(e,t){return e.parent===t.parent?1:2}function nextLeft(e){var t=e.children;return t?t[0]:e.t}function nextRight(e){var t=e.children;return t?t[t.length-1]:e.t}function moveSubtree(e,t,n){var r=n/(t.i-e.i);t.c-=r;t.s+=n;e.c+=r;t.z+=n;t.m+=n}function executeShifts(e){var t=0,n=0,r=e.children,i=r.length,a;while(--i>=0){a=r[i];a.z+=t;a.m+=t;t+=a.s+(n+=a.c)}}function nextAncestor(e,t,n){return e.a.parent===t.parent?e.a:n}function TreeNode(e,t){this._=e;this.parent=null;this.children=null;this.A=null;this.a=this;this.z=0;this.m=0;this.c=0;this.s=0;this.t=null;this.i=t}TreeNode.prototype=Object.create(Node$1.prototype);function treeRoot(e){var t=new TreeNode(e,0),n,r=[t],i,a,o,s;while(n=r.pop()){if(a=n._.children){n.children=new Array(s=a.length);for(o=s-1;o>=0;--o){r.push(i=n.children[o]=new TreeNode(a[o],o));i.parent=n}}}(t.parent=new TreeNode(null,0)).children=[t];return t}function tree$1(){var e=defaultSeparation$1,t=1,n=1,r=null;function i(i){var s=treeRoot(i);s.eachAfter(a),s.parent.m=-s.z;s.eachBefore(o);if(r)i.eachBefore(u);else{var l=i,f=i,c=i;i.eachBefore((function(e){if(e.x<l.x)l=e;if(e.x>f.x)f=e;if(e.depth>c.depth)c=e}));var d=l===f?1:e(l,f)/2,p=d-l.x,h=t/(f.x+d+p),g=n/(c.depth||1);i.eachBefore((function(e){e.x=(e.x+p)*h;e.y=e.depth*g}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){executeShifts(t);var a=(n[0].z+n[n.length-1].z)/2;if(i){t.z=i.z+e(t._,i._);t.m=t.z-a}else{t.z=a}}else if(i){t.z=i.z+e(t._,i._)}t.parent.A=s(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m;e.m+=e.parent.m}function s(t,n,r){if(n){var i=t,a=t,o=n,s=i.parent.children[0],u=i.m,l=a.m,f=o.m,c=s.m,d;while(o=nextRight(o),i=nextLeft(i),o&&i){s=nextLeft(s);a=nextRight(a);a.a=t;d=o.z+f-i.z-u+e(o._,i._);if(d>0){moveSubtree(nextAncestor(o,t,r),t,d);u+=d;l+=d}f+=o.m;u+=i.m;c+=s.m;l+=a.m}if(o&&!nextRight(a)){a.t=o;a.m+=f-l}if(i&&!nextLeft(s)){s.t=i;s.m+=u-c;r=t}}return r}function u(e){e.x*=t;e.y=e.depth*n}i.separation=function(t){return arguments.length?(e=t,i):e};i.size=function(e){return arguments.length?(r=false,t=+e[0],n=+e[1],i):r?null:[t,n]};i.nodeSize=function(e){return arguments.length?(r=true,t=+e[0],n=+e[1],i):r?[t,n]:null};return i}function treemapSlice(e,t,n,r,i){var a=e.children,o,s=-1,u=a.length,l=e.value&&(i-n)/e.value;while(++s<u){o=a[s],o.x0=t,o.x1=r;o.y0=n,o.y1=n+=o.value*l}}var phi=(1+Math.sqrt(5))/2;function squarifyRatio(e,t,n,r,i,a){var o=[],s=t.children,u,l,f=0,c=0,d=s.length,p,h,g=t.value,m,v,y,_,b,x,E;while(f<d){p=i-n,h=a-r;do{m=s[c++].value}while(!m&&c<d);v=y=m;x=Math.max(h/p,p/h)/(g*e);E=m*m*x;b=Math.max(y/E,E/v);for(;c<d;++c){m+=l=s[c].value;if(l<v)v=l;if(l>y)y=l;E=m*m*x;_=Math.max(y/E,E/v);if(_>b){m-=l;break}b=_}o.push(u={value:m,dice:p<h,children:s.slice(f,c)});if(u.dice)treemapDice(u,n,r,i,g?r+=h*m/g:a);else treemapSlice(u,n,r,g?n+=p*m/g:i,a);g-=m,f=c}return o}var treemapSquarify=function e(t){function n(e,n,r,i,a){squarifyRatio(t,e,n,r,i,a)}n.ratio=function(t){return e((t=+t)>1?t:1)};return n}(phi);function treemap(){var e=treemapSquarify,t=false,n=1,r=1,i=[0],a=constantZero,o=constantZero,s=constantZero,u=constantZero,l=constantZero;function f(e){e.x0=e.y0=0;e.x1=n;e.y1=r;e.eachBefore(c);i=[0];if(t)e.eachBefore(roundNode);return e}function c(t){var n=i[t.depth],r=t.x0+n,f=t.y0+n,c=t.x1-n,d=t.y1-n;if(c<r)r=c=(r+c)/2;if(d<f)f=d=(f+d)/2;t.x0=r;t.y0=f;t.x1=c;t.y1=d;if(t.children){n=i[t.depth+1]=a(t)/2;r+=l(t)-n;f+=o(t)-n;c-=s(t)-n;d-=u(t)-n;if(c<r)r=c=(r+c)/2;if(d<f)f=d=(f+d)/2;e(t,r,f,c,d)}}f.round=function(e){return arguments.length?(t=!!e,f):t};f.size=function(e){return arguments.length?(n=+e[0],r=+e[1],f):[n,r]};f.tile=function(t){return arguments.length?(e=required(t),f):e};f.padding=function(e){return arguments.length?f.paddingInner(e).paddingOuter(e):f.paddingInner()};f.paddingInner=function(e){return arguments.length?(a=typeof e==="function"?e:constant(+e),f):a};f.paddingOuter=function(e){return arguments.length?f.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):f.paddingTop()};f.paddingTop=function(e){return arguments.length?(o=typeof e==="function"?e:constant(+e),f):o};f.paddingRight=function(e){return arguments.length?(s=typeof e==="function"?e:constant(+e),f):s};f.paddingBottom=function(e){return arguments.length?(u=typeof e==="function"?e:constant(+e),f):u};f.paddingLeft=function(e){return arguments.length?(l=typeof e==="function"?e:constant(+e),f):l};return f}function treemapBinary(e,t,n,r,i){var a=e.children,o,s=a.length,u,l=new Array(s+1);for(l[0]=u=o=0;o<s;++o){l[o+1]=u+=a[o].value}f(0,s,e.value,t,n,r,i);function f(e,t,n,r,i,o,s){if(e>=t-1){var u=a[e];u.x0=r,u.y0=i;u.x1=o,u.y1=s;return}var c=l[e],d=n/2+c,p=e+1,h=t-1;while(p<h){var g=p+h>>>1;if(l[g]<d)p=g+1;else h=g}if(d-l[p-1]<l[p]-d&&e+1<p)--p;var m=l[p]-c,v=n-m;if(o-r>s-i){var y=n?(r*v+o*m)/n:o;f(e,p,m,r,i,y,s);f(p,t,v,y,i,o,s)}else{var _=n?(i*v+s*m)/n:s;f(e,p,m,r,i,o,_);f(p,t,v,r,_,o,s)}}}function treemapSliceDice(e,t,n,r,i){(e.depth&1?treemapSlice:treemapDice)(e,t,n,r,i)}var treemapResquarify=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t){var o,s,u,l,f=-1,c,d=o.length,p=e.value;while(++f<d){s=o[f],u=s.children;for(l=s.value=0,c=u.length;l<c;++l)s.value+=u[l].value;if(s.dice)treemapDice(s,n,r,i,p?r+=(a-r)*s.value/p:a);else treemapSlice(s,n,r,p?n+=(i-n)*s.value/p:i,a);p-=s.value}}else{e._squarify=o=squarifyRatio(t,e,n,r,i,a);o.ratio=t}}n.ratio=function(t){return e((t=+t)>1?t:1)};return n}(phi);function lookup$2(e,t,n){var r={};e.each((function(e){var i=e.data;if(n(i))r[t(i)]=e}));e.lookup=r;return e}function Nest(e){Transform.call(this,null,e)}Nest.Definition={type:"Nest",metadata:{treesource:true,changes:true},params:[{name:"keys",type:"field",array:true},{name:"generate",type:"boolean"}]};var children$1=function(e){return e.values};inherits(Nest,Transform,{transform:function(e,t){if(!t.source){error("Nest transform requires an upstream data source.")}var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;if(!a||r||t.changed()){if(a){a.each((function(e){if(e.children&&isTuple(e.data)){i.rem.push(e.data)}}))}this.value=a=hierarchy({values:array$5(e.keys).reduce((function(e,t){e.key(t);return e}),nest()).entries(i.source)},children$1);if(n){a.each((function(e){if(e.children){e=ingest$1(e.data);i.add.push(e);i.source.push(e)}}))}lookup$2(a,tupleid,tupleid)}i.source.root=a;return i}});function nest(){var e=[],t={entries:function(e){return r(n(e,0),0)},key:function(n){return e.push(n),t}};function n(t,r){if(r>=e.length){return t}var i=t.length,a=e[r++],o={},s={};var u=-1,l,f,c;while(++u<i){l=a(f=t[u])+"";if(c=o[l]){c.push(f)}else{o[l]=[f]}}for(l in o){s[l]=n(o[l],r)}return s}function r(t,n){if(++n>e.length)return t;var i=[];for(var a in t){i.push({key:a,values:r(t[a],n)})}return i}return t}function HierarchyLayout(e){Transform.call(this,null,e)}var defaultSeparation=function(e,t){return e.parent===t.parent?1:2};inherits(HierarchyLayout,Transform,{transform:function(e,t){if(!t.source||!t.source.root){error(this.constructor.name+" transform requires a backing tree data source.")}var n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;if(e.field)i.sum(e.field);else i.count();if(e.sort)i.sort(stableCompare(e.sort,(function(e){return e.data})));setParams(n,this.params,e);if(n.separation){n.separation(e.separation!==false?defaultSeparation:one$2)}try{this.value=n(i)}catch(o){error(o)}i.each((function(e){return setFields(e,r,a)}));return t.reflow(e.modified()).modifies(a).modifies("leaf")}});function setParams(e,t,n){for(var r=void 0,i=0,a=t.length;i<a;++i){r=t[i];if(r in n)e[r](n[r])}}function setFields(e,t,n){var r=e.data,i=t.length-1;for(var a=0;a<i;++a){r[n[a]]=e[t[a]]}r[n[i]]=e.children?e.children.length:0}var Output$2=["x","y","r","depth","children"];function Pack(e){HierarchyLayout.call(this,e)}Pack.Definition={type:"Pack",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Output$2.length,default:Output$2}]};inherits(Pack,HierarchyLayout,{layout:pack,params:["radius","size","padding"],fields:Output$2});var Output$1$1=["x0","y0","x1","y1","depth","children"];function Partition(e){HierarchyLayout.call(this,e)}Partition.Definition={type:"Partition",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Output$1$1.length,default:Output$1$1}]};inherits(Partition,HierarchyLayout,{layout:partition$1,params:["size","round","padding"],fields:Output$1$1});function Stratify(e){Transform.call(this,null,e)}Stratify.Definition={type:"Stratify",metadata:{treesource:true},params:[{name:"key",type:"field",required:true},{name:"parentKey",type:"field",required:true}]};inherits(Stratify,Transform,{transform:function(e,t){if(!t.source){error("Stratify transform requires an upstream data source.")}var n=this.value;var r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);i.source=i.source.slice();if(a){n=i.source.length?lookup$2(stratify().id(e.key).parentId(e.parentKey)(i.source),e.key,truthy):lookup$2(stratify()([{}]),e.key,e.key)}i.source.root=this.value=n;return i}});var Layouts={tidy:tree$1,cluster:cluster};var Output$2$1=["x","y","depth","children"];function Tree(e){HierarchyLayout.call(this,e)}Tree.Definition={type:"Tree",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:true,length:2},{name:"nodeSize",type:"number",array:true,length:2},{name:"separation",type:"boolean",default:true},{name:"as",type:"string",array:true,length:Output$2$1.length,default:Output$2$1}]};inherits(Tree,HierarchyLayout,{layout:function(e){var t=e||"tidy";if(has$1(Layouts,t))return Layouts[t]();else error("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:Output$2$1});function TreeLinks(e){Transform.call(this,[],e)}TreeLinks.Definition={type:"TreeLinks",metadata:{tree:true,generates:true,changes:true},params:[]};inherits(TreeLinks,Transform,{transform:function(e,t){var n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};if(!r)error("TreeLinks transform requires a tree data source.");if(t.changed(t.ADD_REM)){i.rem=n;t.visit(t.SOURCE,(function(e){return a[tupleid(e)]=1}));r.each((function(e){var t=e.data,n=e.parent&&e.parent.data;if(n&&a[tupleid(t)]&&a[tupleid(n)]){i.add.push(ingest$1({source:n,target:t}))}}));this.value=i.add}else if(t.changed(t.MOD)){t.visit(t.MOD,(function(e){return a[tupleid(e)]=1}));n.forEach((function(e){if(a[tupleid(e.source)]||a[tupleid(e.target)]){i.mod.push(e)}}))}return i}});var Tiles={binary:treemapBinary,dice:treemapDice,slice:treemapSlice,slicedice:treemapSliceDice,squarify:treemapSquarify,resquarify:treemapResquarify};var Output$3=["x0","y0","x1","y1","depth","children"];function Treemap(e){HierarchyLayout.call(this,e)}Treemap.Definition={type:"Treemap",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Output$3.length,default:Output$3}]};inherits(Treemap,HierarchyLayout,{layout:function(){var e=treemap();e.ratio=function(t){var n=e.tile();if(n.ratio)e.tile(n.ratio(t))};e.method=function(t){if(has$1(Tiles,t))e.tile(Tiles[t]);else error("Unrecognized Treemap layout method: "+t)};return e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:Output$3});var tree=Object.freeze({__proto__:null,nest:Nest,pack:Pack,partition:Partition,stratify:Stratify,tree:Tree,treelinks:TreeLinks,treemap:Treemap});var ALPHA_MASK=4278190080;var INSIDE_OPACITY_IN_ALPHA=268435456;var INSIDE_OPACITY=.0625;function baseBitmaps(e,t){var n=e.bitmap();(t||[]).forEach((function(t){return n.set(e(t.boundary[0]),e(t.boundary[3]))}));return[n,undefined]}function markBitmaps(e,t,n,r){var i=e.width,a=e.height,o=n||r,s=domCanvas(i,a).getContext("2d");t.forEach((function(e){return draw(s,e,o)}));var u=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),l=e.bitmap(),f=o&&e.bitmap();var c,d,p,h,g;for(d=0;d<a;++d){for(c=0;c<i;++c){g=u[d*i+c]&ALPHA_MASK;if(g){p=e(c);h=e(d);if(!r)l.set(p,h);if(o&&g^INSIDE_OPACITY_IN_ALPHA)f.set(p,h)}}}return[l,f]}function draw(e,t,n){if(!t.length)return;var r=t[0].mark.marktype;if(r==="group"){t.forEach((function(t){t.items.forEach((function(t){return draw(e,t.items,n)}))}))}else{Marks[r].draw(e,{items:n?t.map(prepare):t})}}function prepare(e){var t=rederive(e,{});if(t.stroke){t.strokeOpacity=1}if(t.fill){t.fillOpacity=INSIDE_OPACITY;t.stroke="#000";t.strokeOpacity=1;t.strokeWidth=2}return t}var DIV=5,MOD=31,SIZE$1=32,RIGHT0=new Uint32Array(SIZE$1+1),RIGHT1=new Uint32Array(SIZE$1+1);RIGHT1[0]=0;RIGHT0[0]=~RIGHT1[0];for(var i=1;i<=SIZE$1;++i){RIGHT1[i]=RIGHT1[i-1]<<1|1;RIGHT0[i]=~RIGHT1[i]}function Bitmap(e,t){var n=new Uint32Array(~~((e*t+SIZE$1)/SIZE$1));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:function(t,r){var i=r*e+t;return n[i>>>DIV]&1<<(i&MOD)},set:function(t,n){var i=n*e+t;r(i>>>DIV,1<<(i&MOD))},clear:function(t,n){var r=n*e+t;i(r>>>DIV,~(1<<(r&MOD)))},getRange:function(t,r,i,a){var o=a,s,u,l,f;for(;o>=r;--o){s=o*e+t;u=o*e+i;l=s>>>DIV;f=u>>>DIV;if(l===f){if(n[l]&RIGHT0[s&MOD]&RIGHT1[(u&MOD)+1]){return true}}else{if(n[l]&RIGHT0[s&MOD])return true;if(n[f]&RIGHT1[(u&MOD)+1])return true;for(var c=l+1;c<f;++c){if(n[c])return true}}}return false},setRange:function(t,n,i,a){var o,s,u,l,f;for(;n<=a;++n){o=n*e+t;s=n*e+i;u=o>>>DIV;l=s>>>DIV;if(u===l){r(u,RIGHT0[o&MOD]&RIGHT1[(s&MOD)+1])}else{r(u,RIGHT0[o&MOD]);r(l,RIGHT1[(s&MOD)+1]);for(f=u+1;f<l;++f)r(f,4294967295)}}},clearRange:function(t,n,r,a){var o,s,u,l,f;for(;n<=a;++n){o=n*e+t;s=n*e+r;u=o>>>DIV;l=s>>>DIV;if(u===l){i(u,RIGHT1[o&MOD]|RIGHT0[(s&MOD)+1])}else{i(u,RIGHT1[o&MOD]);i(l,RIGHT0[(s&MOD)+1]);for(f=u+1;f<l;++f)i(f,0)}}},outOfBounds:function(n,r,i,a){return n<0||r<0||a>=t||i>=e}}}function scaler(e,t,n){var r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=function(e){return~~((e+n)/r)};o.invert=function(e){return e*r-n};o.bitmap=function(){return Bitmap(i,a)};o.ratio=r;o.padding=n;o.width=e;o.height=t;return o}function placeAreaLabelNaive(e,t,n,r){var i=e.width,a=e.height;return function(e){var t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,s=textMetrics.width(e.datum,e.datum.text);var u=0,l,f,c,d,p,h,g;for(var m=0;m<n;++m){l=t[m].x;c=t[m].y;f=t[m].x2===undefined?l:t[m].x2;d=t[m].y2===undefined?c:t[m].y2;p=(l+f)/2;h=(c+d)/2;g=Math.abs(f-l+d-c);if(g>=u){u=g;e.x=p;e.y=h}}p=s/2;h=o/2;l=e.x-p;f=e.x+p;c=e.y-h;d=e.y+h;e.align="center";if(l<0&&f<=i){e.align="left"}else if(0<=l&&i<f){e.align="right"}e.baseline="middle";if(c<0&&d<=a){e.baseline="top"}else if(0<=c&&a<d){e.baseline="bottom"}return true}}function outOfBounds(e,t,n,r,i,a){var o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function collision(e,t,n,r,i,a,o,s){var u=i*a/(r*2),l=e(t-u),f=e(t+u),c=e(n-(a=a/2)),d=e(n+a);return o.outOfBounds(l,c,f,d)||o.getRange(l,c,f,d)||s&&s.getRange(l,c,f,d)}function placeAreaLabelReducedSearch(e,t,n,r){var i=e.width,a=e.height,o=t[0],s=t[1];function u(t,n,r,u,l){var f=e.invert(t),c=e.invert(n);var d=r,p=a,h;if(!outOfBounds(f,c,u,l,i,a)&&!collision(e,f,c,l,u,d,o,s)&&!collision(e,f,c,l,u,l,o,null)){while(p-d>=1){h=(d+p)/2;if(collision(e,f,c,l,u,h,o,s)){p=h}else{d=h}}if(d>r){return[f,c,d,true]}}}return function(t){var s=t.datum.datum.items[r].items,l=s.length,f=t.datum.fontSize,c=textMetrics.width(t.datum,t.datum.text);var d=n?f:0,p=false,h=false,g=0,m,v,y,_,b,x,E,S,$,A,D,w,C,T,k,O,N;for(var R=0;R<l;++R){m=s[R].x;y=s[R].y;v=s[R].x2===undefined?m:s[R].x2;_=s[R].y2===undefined?y:s[R].y2;if(m>v){N=m;m=v;v=N}if(y>_){N=y;y=_;_=N}$=e(m);D=e(v);A=~~(($+D)/2);w=e(y);T=e(_);C=~~((w+T)/2);for(E=A;E>=$;--E){for(S=C;S>=w;--S){O=u(E,S,d,c,f);if(O){t.x=O[0],t.y=O[1],d=O[2],p=O[3]}}}for(E=A;E<=D;++E){for(S=C;S<=T;++S){O=u(E,S,d,c,f);if(O){t.x=O[0],t.y=O[1],d=O[2],p=O[3]}}}if(!p&&!n){k=Math.abs(v-m+_-y);b=(m+v)/2;x=(y+_)/2;if(k>=g&&!outOfBounds(b,x,c,f,i,a)&&!collision(e,b,x,f,c,f,o,null)){g=k;t.x=b;t.y=x;h=true}}}if(p||h){b=c/2;x=f/2;o.setRange(e(t.x-b),e(t.y-x),e(t.x+b),e(t.y+x));t.align="center";t.baseline="middle";return true}else{return false}}}var X_DIR=[-1,-1,1,1];var Y_DIR=[-1,1,-1,1];function placeAreaLabelFloodFill(e,t,n,r){var i=e.width,a=e.height,o=t[0],s=t[1],u=e.bitmap();return function(t){var l;var f=t.datum.datum.items[r].items,c=f.length,d=t.datum.fontSize,p=textMetrics.width(t.datum,t.datum.text),h=[];var g=n?d:0,m=false,v=false,y=0,_,b,x,E,S,$,A,D,w,C,T,k;for(var O=0;O<c;++O){_=f[O].x;x=f[O].y;b=f[O].x2===undefined?_:f[O].x2;E=f[O].y2===undefined?x:f[O].y2;h.push([e((_+b)/2),e((x+E)/2)]);while(h.length){l=h.pop(),A=l[0],D=l[1];if(o.get(A,D)||s.get(A,D)||u.get(A,D))continue;u.set(A,D);for(var N=0;N<4;++N){S=A+X_DIR[N];$=D+Y_DIR[N];if(!u.outOfBounds(S,$,S,$))h.push([S,$])}S=e.invert(A);$=e.invert(D);w=g;C=a;if(!outOfBounds(S,$,p,d,i,a)&&!collision(e,S,$,d,p,w,o,s)&&!collision(e,S,$,d,p,d,o,null)){while(C-w>=1){T=(w+C)/2;if(collision(e,S,$,d,p,T,o,s)){C=T}else{w=T}}if(w>g){t.x=S;t.y=$;g=w;m=true}}}if(!m&&!n){k=Math.abs(b-_+E-x);S=(_+b)/2;$=(x+E)/2;if(k>=y&&!outOfBounds(S,$,p,d,i,a)&&!collision(e,S,$,d,p,d,o,null)){y=k;t.x=S;t.y=$;v=true}}}if(m||v){S=p/2;$=d/2;o.setRange(e(t.x-S),e(t.y-$),e(t.x+S),e(t.y+$));t.align="center";t.baseline="middle";return true}else{return false}}}var Aligns=["right","center","left"],Baselines=["bottom","middle","top"];function placeMarkLabel(e,t,n,r){var i=e.width,a=e.height,o=t[0],s=t[1],u=r.length;return function(t){var l=t.boundary,f=t.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>i||l[3]>a){return false}var c=0,d,p,h,g,m,v,y,_,b,x,E,S,$,A,D;for(var w=0;w<u;++w){d=(n[w]&3)-1;p=(n[w]>>>2&3)-1;h=d===0&&p===0||r[w]<0;g=d&&p?Math.SQRT1_2:1;m=r[w]<0?-1:1;v=l[1+d]+r[w]*d*g;E=l[4+p]+m*f*p/2+r[w]*p*g;_=E-f/2;b=E+f/2;S=e(v);A=e(_);D=e(b);if(!c){if(!test(S,S,A,D,o,s,v,v,_,b,l,h)){continue}else{c=textMetrics.width(t.datum,t.datum.text)}}x=v+m*c*d/2;v=x-c/2;y=x+c/2;S=e(v);$=e(y);if(test(S,$,A,D,o,s,v,y,_,b,l,h)){t.x=!d?x:d*m<0?y:v;t.y=!p?E:p*m<0?b:_;t.align=Aligns[d*m+1];t.baseline=Baselines[p*m+1];o.setRange(S,A,$,D);return true}}return false}}function test(e,t,n,r,i,a,o,s,u,l,f,c){return!(i.outOfBounds(e,n,t,r)||(c&&a?a.getRange(e,n,t,r)||!isInMarkBound(o,u,s,l,f):i.getRange(e,n,t,r)))}function isInMarkBound(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}var TOP=0,MIDDLE=4,BOTTOM=8,LEFT=0,CENTER=1,RIGHT=2;var anchorCode={"top-left":TOP+LEFT,top:TOP+CENTER,"top-right":TOP+RIGHT,left:MIDDLE+LEFT,middle:MIDDLE+CENTER,right:MIDDLE+RIGHT,"bottom-left":BOTTOM+LEFT,bottom:BOTTOM+CENTER,"bottom-right":BOTTOM+RIGHT};var placeAreaLabel={naive:placeAreaLabelNaive,"reduced-search":placeAreaLabelReducedSearch,floodfill:placeAreaLabelFloodFill};function labelLayout(e,t,n,r,i,a,o,s,u,l,f){if(!e.length)return e;var c=Math.max(r.length,i.length),d=getOffsets(r,c),p=getAnchors(i,c),h=markType(e[0].datum),g=h==="group"&&e[0].datum.items[u].marktype,m=g==="area",v=markBoundary(h,g,s,u),y=scaler(t[0],t[1],l),_=m&&f==="naive";var b=e.map((function(e){return{datum:e,opacity:0,x:undefined,y:undefined,align:undefined,baseline:undefined,boundary:v(e)}}));var x;if(!_){if(n){b.sort((function(e,t){return n(e.datum,t.datum)}))}var E=false;for(var S=0;S<p.length&&!E;++S){E=p[S]===5||d[S]<0}if(h&&(o||m)){a=[e.map((function(e){return e.datum}))].concat(a)}x=a.length?markBitmaps(y,a,E,m):baseBitmaps(y,o&&b)}var $=m?placeAreaLabel[f](y,x,o,u):placeMarkLabel(y,x,p,d);b.forEach((function(e){return e.opacity=+$(e)}));return b}function getOffsets(e,t){var n=new Float64Array(t),r=e.length;for(var i=0;i<r;++i)n[i]=e[i]||0;for(var i=r;i<t;++i)n[i]=n[r-1];return n}function getAnchors(e,t){var n=new Int8Array(t),r=e.length;for(var i=0;i<r;++i)n[i]|=anchorCode[e[i]];for(var i=r;i<t;++i)n[i]=n[r-1];return n}function markType(e){return e&&e.mark&&e.mark.marktype}function markBoundary(e,t,n,r){var i=function(e){return[e.x,e.x,e.x,e.y,e.y,e.y]};if(!e){return i}else if(e==="line"||e==="area"){return function(e){return i(e.datum)}}else if(t==="line"){return function(e){var t=e.datum.items[r].items;return i(t.length?t[n==="start"?0:t.length-1]:{x:NaN,y:NaN})}}else{return function(e){var t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}}}var Output$1=["x","y","opacity","align","baseline"];var Anchors=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function Label$1(e){Transform.call(this,null,e)}Label$1.Definition={type:"Label",metadata:{modifies:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:true,default:Anchors},{name:"offset",type:"number",array:true,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:true},{name:"avoidMarks",type:"data",array:true},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:true,length:Output$1.length,default:Output$1}]};inherits(Label$1,Transform,{transform:function(e,t){function n(n){var r=e[n];return isFunction(r)&&t.modified(r.fields)}var r=e.modified();if(!(r||t.changed(t.ADD_REM)||n("sort")))return;if(!e.size||e.size.length!==2){error("Size parameter should be specified as a [width, height] array.")}var i=e.as||Output$1;labelLayout(t.materialize(t.SOURCE).source,e.size,e.sort,array$5(e.offset||1),array$5(e.anchor||Anchors),e.avoidMarks||[],e.avoidBaseMark===false?false:true,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((function(e){var t=e.datum;t[i[0]]=e.x;t[i[1]]=e.y;t[i[2]]=e.opacity;t[i[3]]=e.align;t[i[4]]=e.baseline}));return t.reflow(r).modifies(i)}});var label=Object.freeze({__proto__:null,label:Label$1});function partition(e,t){var n=[],r=function(e){return e(s)},i,a,o,s,u,l;if(t==null){n.push(e)}else{for(i={},a=0,o=e.length;a<o;++a){s=e[a];u=t.map(r);l=i[u];if(!l){i[u]=l=[];l.dims=u;n.push(l)}l.push(s)}}return n}function Loess(e){Transform.call(this,null,e)}Loess.Definition={type:"Loess",metadata:{generates:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:true}]};inherits(Loess,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=t.materialize(t.SOURCE).source,i=partition(r,e.groupby),a=(e.groupby||[]).map(accessorName),o=a.length,s=e.as||[accessorName(e.x),accessorName(e.y)],u=[];i.forEach((function(t){loess(t,e.x,e.y,e.bandwidth||.3).forEach((function(e){var n={};for(var r=0;r<o;++r){n[a[r]]=t.dims[r]}n[s[0]]=e[0];n[s[1]]=e[1];u.push(ingest$1(n))}))}));if(this.value)n.rem=this.value;this.value=n.add=n.source=u}return n}});var Methods={linear:linear$2,log:log$3,exp:exp$1,pow:pow$3,quad:quad,poly:poly};var degreesOfFreedom=function(e,t){return e==="poly"?t:e==="quad"?2:1};function Regression(e){Transform.call(this,null,e)}Regression.Definition={type:"Regression",metadata:{generates:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"method",type:"string",default:"linear",values:Object.keys(Methods)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:true,length:2},{name:"params",type:"boolean",default:false},{name:"as",type:"string",array:true}]};inherits(Regression,Transform,{transform:function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var r=t.materialize(t.SOURCE).source,i=partition(r,e.groupby),a=(e.groupby||[]).map(accessorName),o=e.method||"linear",s=e.order||3,u=degreesOfFreedom(o,s),l=e.as||[accessorName(e.x),accessorName(e.y)],f=Methods[o],c=[];var d=e.extent;if(!has$1(Methods,o)){error("Invalid regression method: "+o)}if(d!=null){if(o==="log"&&d[0]<=0){t.dataflow.warn("Ignoring extent with values <= 0 for log regression.");d=null}}i.forEach((function(n){var r=n.length;if(r<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}var i=f(n,e.x,e.y,s);if(e.params){c.push(ingest$1({keys:n.dims,coef:i.coef,rSquared:i.rSquared}));return}var p=d||extent(n,e.x),h=function(e){var t={};for(var r=0;r<a.length;++r){t[a[r]]=n.dims[r]}t[l[0]]=e[0];t[l[1]]=e[1];c.push(ingest$1(t))};if(o==="linear"){p.forEach((function(e){return h([e,i.predict(e)])}))}else{sampleCurve(i.predict,p,25,200).forEach(h)}}));if(this.value)n.rem=this.value;this.value=n.add=n.source=c}return n}});var reg=Object.freeze({__proto__:null,loess:Loess,regression:Regression});var EPSILON=Math.pow(2,-52);var EDGE_STACK=new Uint32Array(512);var Delaunator=function(){function e(e){var t=e.length>>1;if(t>0&&typeof e[0]!=="number")throw new Error("Expected coords to contain numbers.");this.coords=e;var n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3);this._halfedges=new Int32Array(n*3);this._hashSize=Math.ceil(Math.sqrt(t));this._hullPrev=new Uint32Array(t);this._hullNext=new Uint32Array(t);this._hullTri=new Uint32Array(t);this._hullHash=new Int32Array(this._hashSize).fill(-1);this._ids=new Uint32Array(t);this._dists=new Float64Array(t);this.update()}e.from=function(t,n,r){if(n===void 0){n=defaultGetX}if(r===void 0){r=defaultGetY}var i=t.length;var a=new Float64Array(i*2);for(var o=0;o<i;o++){var s=t[o];a[2*o]=n(s);a[2*o+1]=r(s)}return new e(a)};e.prototype.update=function(){var e=this,t=e.coords,n=e._hullPrev,r=e._hullNext,i=e._hullTri,a=e._hullHash;var o=t.length>>1;var s=Infinity;var u=Infinity;var l=-Infinity;var f=-Infinity;for(var c=0;c<o;c++){var d=t[2*c];var p=t[2*c+1];if(d<s)s=d;if(p<u)u=p;if(d>l)l=d;if(p>f)f=p;this._ids[c]=c}var h=(s+l)/2;var g=(u+f)/2;var m=Infinity;var v,y,_;for(var c=0;c<o;c++){var b=dist(h,g,t[2*c],t[2*c+1]);if(b<m){v=c;m=b}}var x=t[2*v];var E=t[2*v+1];m=Infinity;for(var c=0;c<o;c++){if(c===v)continue;var b=dist(x,E,t[2*c],t[2*c+1]);if(b<m&&b>0){y=c;m=b}}var S=t[2*y];var $=t[2*y+1];var A=Infinity;for(var c=0;c<o;c++){if(c===v||c===y)continue;var D=circumradius(x,E,S,$,t[2*c],t[2*c+1]);if(D<A){_=c;A=D}}var w=t[2*_];var C=t[2*_+1];if(A===Infinity){for(var c=0;c<o;c++){this._dists[c]=t[2*c]-t[0]||t[2*c+1]-t[1]}quicksort(this._ids,this._dists,0,o-1);var T=new Uint32Array(o);var k=0;for(var c=0,O=-Infinity;c<o;c++){var N=this._ids[c];if(this._dists[N]>O){T[k++]=N;O=this._dists[N]}}this.hull=T.subarray(0,k);this.triangles=new Uint32Array(0);this.halfedges=new Uint32Array(0);return}if(orient$1(x,E,S,$,w,C)){var c=y;var R=S;var F=$;y=_;S=w;$=C;_=c;w=R;C=F}var L=circumcenter(x,E,S,$,w,C);this._cx=L.x;this._cy=L.y;for(var c=0;c<o;c++){this._dists[c]=dist(t[2*c],t[2*c+1],L.x,L.y)}quicksort(this._ids,this._dists,0,o-1);this._hullStart=v;var P=3;r[v]=n[_]=y;r[y]=n[v]=_;r[_]=n[y]=v;i[v]=0;i[y]=1;i[_]=2;a.fill(-1);a[this._hashKey(x,E)]=v;a[this._hashKey(S,$)]=y;a[this._hashKey(w,C)]=_;this.trianglesLen=0;this._addTriangle(v,y,_,-1,-1,-1);for(var I=0,M=void 0,z=void 0;I<this._ids.length;I++){var c=this._ids[I];var B=t[2*c];var U=t[2*c+1];if(I>0&&Math.abs(B-M)<=EPSILON&&Math.abs(U-z)<=EPSILON)continue;M=B;z=U;if(c===v||c===y||c===_)continue;var j=0;for(var k=0,H=this._hashKey(B,U);k<this._hashSize;k++){j=a[(H+k)%this._hashSize];if(j!==-1&&j!==r[j])break}j=n[j];var q=j,G=void 0;while(G=r[q],!orient$1(B,U,t[2*q],t[2*q+1],t[2*G],t[2*G+1])){q=G;if(q===j){q=-1;break}}if(q===-1)continue;var W=this._addTriangle(q,c,r[q],-1,-1,i[q]);i[c]=this._legalize(W+2);i[q]=W;P++;var V=r[q];while(G=r[V],orient$1(B,U,t[2*V],t[2*V+1],t[2*G],t[2*G+1])){W=this._addTriangle(V,c,G,i[c],-1,i[V]);i[c]=this._legalize(W+2);r[V]=V;P--;V=G}if(q===j){while(G=n[q],orient$1(B,U,t[2*G],t[2*G+1],t[2*q],t[2*q+1])){W=this._addTriangle(G,c,q,-1,i[q],i[G]);this._legalize(W+2);i[G]=W;r[q]=q;P--;q=G}}this._hullStart=n[c]=q;r[q]=n[V]=c;r[c]=V;a[this._hashKey(B,U)]=c;a[this._hashKey(t[2*q],t[2*q+1])]=q}this.hull=new Uint32Array(P);for(var c=0,Y=this._hullStart;c<P;c++){this.hull[c]=Y;Y=r[Y]}this.triangles=this._triangles.subarray(0,this.trianglesLen);this.halfedges=this._halfedges.subarray(0,this.trianglesLen)};e.prototype._hashKey=function(e,t){return Math.floor(pseudoAngle(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize};e.prototype._legalize=function(e){var t=this,n=t._triangles,r=t._halfedges,i=t.coords;var a=0;var o=0;while(true){var s=r[e];var u=e-e%3;o=u+(e+2)%3;if(s===-1){if(a===0)break;e=EDGE_STACK[--a];continue}var l=s-s%3;var f=u+(e+1)%3;var c=l+(s+2)%3;var d=n[o];var p=n[e];var h=n[f];var g=n[c];var m=inCircle(i[2*d],i[2*d+1],i[2*p],i[2*p+1],i[2*h],i[2*h+1],i[2*g],i[2*g+1]);if(m){n[e]=g;n[s]=d;var v=r[c];if(v===-1){var y=this._hullStart;do{if(this._hullTri[y]===c){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,v);this._link(s,r[o]);this._link(o,c);var _=l+(s+1)%3;if(a<EDGE_STACK.length){EDGE_STACK[a++]=_}}else{if(a===0)break;e=EDGE_STACK[--a]}}return o};e.prototype._link=function(e,t){this._halfedges[e]=t;if(t!==-1)this._halfedges[t]=e};e.prototype._addTriangle=function(e,t,n,r,i,a){var o=this.trianglesLen;this._triangles[o]=e;this._triangles[o+1]=t;this._triangles[o+2]=n;this._link(o,r);this._link(o+1,i);this._link(o+2,a);this.trianglesLen+=3;return o};return e}();function pseudoAngle(e,t){var n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function dist(e,t,n,r){var i=e-n;var a=t-r;return i*i+a*a}function orientIfSure(e,t,n,r,i,a){var o=(r-t)*(i-e);var s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function orient$1(e,t,n,r,i,a){var o=orientIfSure(i,a,e,t,n,r)||orientIfSure(e,t,n,r,i,a)||orientIfSure(n,r,i,a,e,t);return o<0}function inCircle(e,t,n,r,i,a,o,s){var u=e-o;var l=t-s;var f=n-o;var c=r-s;var d=i-o;var p=a-s;var h=u*u+l*l;var g=f*f+c*c;var m=d*d+p*p;return u*(c*m-g*p)-l*(f*m-g*d)+h*(f*p-c*d)<0}function circumradius(e,t,n,r,i,a){var o=n-e;var s=r-t;var u=i-e;var l=a-t;var f=o*o+s*s;var c=u*u+l*l;var d=.5/(o*l-s*u);var p=(l*f-s*c)*d;var h=(o*c-u*f)*d;return p*p+h*h}function circumcenter(e,t,n,r,i,a){var o=n-e;var s=r-t;var u=i-e;var l=a-t;var f=o*o+s*s;var c=u*u+l*l;var d=.5/(o*l-s*u);var p=e+(l*f-s*c)*d;var h=t+(o*c-u*f)*d;return{x:p,y:h}}function quicksort(e,t,n,r){if(r-n<=20){for(var i=n+1;i<=r;i++){var a=e[i];var o=t[a];var s=i-1;while(s>=n&&t[e[s]]>o)e[s+1]=e[s--];e[s+1]=a}}else{var u=n+r>>1;var i=n+1;var s=r;swap(e,u,i);if(t[e[n]]>t[e[r]])swap(e,n,r);if(t[e[i]]>t[e[r]])swap(e,i,r);if(t[e[n]]>t[e[i]])swap(e,n,i);var l=e[i];var o=t[l];while(true){do{i++}while(t[e[i]]<o);do{s--}while(t[e[s]]>o);if(s<i)break;swap(e,i,s)}e[n+1]=e[s];e[s]=l;if(r-i+1>=s-n){quicksort(e,t,i,r);quicksort(e,t,n,s-1)}else{quicksort(e,t,n,s-1);quicksort(e,t,i,r)}}}function swap(e,t,n){var r=e[t];e[t]=e[n];e[n]=r}function defaultGetX(e){return e[0]}function defaultGetY(e){return e[1]}var epsilon=1e-6;var Path=function(){function e(){this._x0=this._y0=this._x1=this._y1=null;this._=""}e.prototype.moveTo=function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)};e.prototype.closePath=function(){if(this._x1!==null){this._x1=this._x0,this._y1=this._y0;this._+="Z"}};e.prototype.lineTo=function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)};e.prototype.arc=function(e,t,n){e=+e,t=+t,n=+n;var r=e+n;var i=t;if(n<0)throw new Error("negative radius");if(this._x1===null)this._+="M"+r+","+i;else if(Math.abs(this._x1-r)>epsilon||Math.abs(this._y1-i)>epsilon)this._+="L"+r+","+i;if(!n)return;this._+="A"+n+","+n+",0,1,1,"+(e-n)+","+t+"A"+n+","+n+",0,1,1,"+(this._x1=r)+","+(this._y1=i)};e.prototype.rect=function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"};e.prototype.value=function(){return this._||null};return e}();var Polygon=function(){function e(){this._=[]}e.prototype.moveTo=function(e,t){this._.push([e,t])};e.prototype.closePath=function(){this._.push(this._[0].slice())};e.prototype.lineTo=function(e,t){this._.push([e,t])};e.prototype.value=function(){return this._.length?this._:null};return e}();var Voronoi$1=function(){function e(e,t){var n=t===void 0?[0,0,960,500]:t,r=n[0],i=n[1],a=n[2],o=n[3];if(!((a=+a)>=(r=+r))||!((o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e;this._circumcenters=new Float64Array(e.points.length*2);this.vectors=new Float64Array(e.points.length*2);this.xmax=a,this.xmin=r;this.ymax=o,this.ymin=i;this._init()}e.prototype.update=function(){this.delaunay.update();this._init();return this};e.prototype._init=function(){var e=this,t=e.delaunay,n=t.points,r=t.hull,i=t.triangles,a=e.vectors;var o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(var s=0,u=0,l=i.length,f,c;s<l;s+=3,u+=2){var d=i[s]*2;var p=i[s+1]*2;var h=i[s+2]*2;var g=n[d];var m=n[d+1];var v=n[p];var y=n[p+1];var _=n[h];var b=n[h+1];var x=v-g;var E=y-m;var S=_-g;var $=b-m;var A=x*x+E*E;var D=S*S+$*$;var w=(x*$-E*S)*2;if(!w){f=(g+_)/2-1e8*$;c=(m+b)/2+1e8*S}else if(Math.abs(w)<1e-8){f=(g+_)/2;c=(m+b)/2}else{var C=1/w;f=g+($*A-E*D)*C;c=m+(x*D-S*A)*C}o[u]=f;o[u+1]=c}var T=r[r.length-1];var k,O=T*4;var N,R=n[2*T];var F,L=n[2*T+1];a.fill(0);for(var s=0;s<r.length;++s){T=r[s];k=O,N=R,F=L;O=T*4,R=n[2*T],L=n[2*T+1];a[k+2]=a[O]=F-L;a[k+3]=a[O+1]=R-N}};e.prototype.render=function(e){var t=e==null?e=new Path:undefined;var n=this,r=n.delaunay,i=r.halfedges,a=r.inedges,o=r.hull,s=n.circumcenters,u=n.vectors;if(o.length<=1)return null;for(var l=0,f=i.length;l<f;++l){var c=i[l];if(c<l)continue;var d=Math.floor(l/3)*2;var p=Math.floor(c/3)*2;var h=s[d];var g=s[d+1];var m=s[p];var v=s[p+1];this._renderSegment(h,g,m,v,e)}var y,_=o[o.length-1];for(var l=0;l<o.length;++l){y=_,_=o[l];var b=Math.floor(a[_]/3)*2;var x=s[b];var E=s[b+1];var S=y*4;var $=this._project(x,E,u[S+2],u[S+3]);if($)this._renderSegment(x,E,$[0],$[1],e)}return t&&t.value()};e.prototype.renderBounds=function(e){var t=e==null?e=new Path:undefined;e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin);return t&&t.value()};e.prototype.renderCell=function(e,t){var n=t==null?t=new Path:undefined;var r=this._clip(e);if(r===null||!r.length)return;t.moveTo(r[0],r[1]);var i=r.length;while(r[0]===r[i-2]&&r[1]===r[i-1]&&i>1)i-=2;for(var a=2;a<i;a+=2){if(r[a]!==r[a-2]||r[a+1]!==r[a-1])t.lineTo(r[a],r[a+1])}t.closePath();return n&&n.value()};e.prototype.cellPolygons=function(){var e,t,n,r;return __generator(this,(function(i){switch(i.label){case 0:e=this.delaunay.points;t=0,n=e.length/2;i.label=1;case 1:if(!(t<n))return[3,4];r=this.cellPolygon(t);if(!r)return[3,3];r.index=t;return[4,r];case 2:i.sent();i.label=3;case 3:++t;return[3,1];case 4:return[2]}}))};e.prototype.cellPolygon=function(e){var t=new Polygon;this.renderCell(e,t);return t.value()};e.prototype._renderSegment=function(e,t,n,r,i){var a;var o=this._regioncode(e,t);var s=this._regioncode(n,r);if(o===0&&s===0){i.moveTo(e,t);i.lineTo(n,r)}else if(a=this._clipSegment(e,t,n,r,o,s)){i.moveTo(a[0],a[1]);i.lineTo(a[2],a[3])}};e.prototype.contains=function(e,t,n){if((t=+t,t!==t)||(n=+n,n!==n))return false;return this.delaunay._step(e,t,n)===e};e.prototype.neighbors=function(e){var t,n,r,i,a,o,s,u,l;return __generator(this,(function(f){switch(f.label){case 0:t=this._clip(e);if(!t)return[3,8];n=0,r=this.delaunay.neighbors(e);f.label=1;case 1:if(!(n<r.length))return[3,8];i=r[n];a=this._clip(i);if(!a)return[3,7];o=0,s=t.length;f.label=2;case 2:if(!(o<s))return[3,7];u=0,l=a.length;f.label=3;case 3:if(!(u<l))return[3,6];if(!(t[o]==a[u]&&t[o+1]==a[u+1]&&t[(o+2)%s]==a[(u+l-2)%l]&&t[(o+3)%s]==a[(u+l-1)%l]))return[3,5];return[4,i];case 4:f.sent();return[3,7];case 5:u+=2;return[3,3];case 6:o+=2;return[3,2];case 7:n++;return[3,1];case 8:return[2]}}))};e.prototype._cell=function(e){var t=this,n=t.circumcenters,r=t.delaunay,i=r.inedges,a=r.halfedges,o=r.triangles;var s=i[e];if(s===-1)return null;var u=[];var l=s;do{var f=Math.floor(l/3);u.push(n[f*2],n[f*2+1]);l=l%3===2?l-2:l+1;if(o[l]!==e)break;l=a[l]}while(l!==s&&l!==-1);return u};e.prototype._clip=function(e){if(e===0&&this.delaunay.hull.length===1){return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin]}var t=this._cell(e);if(t===null)return null;var n=this.vectors;var r=e*4;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)};e.prototype._clipFinite=function(e,t){var n=t.length;var r=null;var i,a,o=t[n-2],s=t[n-1];var u,l=this._regioncode(o,s);var f,c;for(var d=0;d<n;d+=2){i=o,a=s,o=t[d],s=t[d+1];u=l,l=this._regioncode(o,s);if(u===0&&l===0){f=c,c=0;if(r)r.push(o,s);else r=[o,s]}else{var p=void 0,h=void 0,g=void 0,m=void 0,v=void 0;if(u===0){if((p=this._clipSegment(i,a,o,s,u,l))===null)continue;h=p[0],g=p[1],m=p[2],v=p[3]}else{if((p=this._clipSegment(o,s,i,a,l,u))===null)continue;m=p[0],v=p[1],h=p[2],g=p[3];f=c,c=this._edgecode(h,g);if(f&&c)this._edge(e,f,c,r,r.length);if(r)r.push(h,g);else r=[h,g]}f=c,c=this._edgecode(m,v);if(f&&c)this._edge(e,f,c,r,r.length);if(r)r.push(m,v);else r=[m,v]}}if(r){f=c,c=this._edgecode(r[0],r[1]);if(f&&c)this._edge(e,f,c,r,r.length)}else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)){return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin]}return r};e.prototype._clipSegment=function(e,t,n,r,i,a){while(true){if(i===0&&a===0)return[e,t,n,r];if(i&a)return null;var o=void 0,s=void 0,u=i||a;if(u&8)o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax;else if(u&4)o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin;else if(u&2)s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax;else s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin;if(i)e=o,t=s,i=this._regioncode(e,t);else n=o,r=s,a=this._regioncode(n,r)}};e.prototype._clipInfinite=function(e,t,n,r,i,a){var o=Array.from(t),s;if(s=this._project(o[0],o[1],n,r))o.unshift(s[0],s[1]);if(s=this._project(o[o.length-2],o[o.length-1],i,a))o.push(s[0],s[1]);if(o=this._clipFinite(e,o)){for(var u=0,l=o.length,f=void 0,c=this._edgecode(o[l-2],o[l-1]);u<l;u+=2){f=c,c=this._edgecode(o[u],o[u+1]);if(f&&c)u=this._edge(e,f,c,o,u),l=o.length}}else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)){o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]}return o};e.prototype._edge=function(e,t,n,r,i){while(t!==n){var a=void 0,o=void 0;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin;break}if((r[i]!==a||r[i+1]!==o)&&this.contains(e,a,o)){r.splice(i,0,a,o),i+=2}}if(r.length>4){for(var s=0;s<r.length;s+=2){var u=(s+2)%r.length,l=(s+4)%r.length;if(r[s]===r[u]&&r[u]===r[l]||r[s+1]===r[u+1]&&r[u+1]===r[l+1])r.splice(u,2),s-=2}}return i};e.prototype._project=function(e,t,n,r){var i=Infinity,a,o,s;if(r<0){if(t<=this.ymin)return null;if((a=(this.ymin-t)/r)<i)s=this.ymin,o=e+(i=a)*n}else if(r>0){if(t>=this.ymax)return null;if((a=(this.ymax-t)/r)<i)s=this.ymax,o=e+(i=a)*n}if(n>0){if(e>=this.xmax)return null;if((a=(this.xmax-e)/n)<i)o=this.xmax,s=t+(i=a)*r}else if(n<0){if(e<=this.xmin)return null;if((a=(this.xmin-e)/n)<i)o=this.xmin,s=t+(i=a)*r}return[o,s]};e.prototype._edgecode=function(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)};e.prototype._regioncode=function(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)};return e}();var tau=2*Math.PI,pow=Math.pow;function pointX(e){return e[0]}function pointY(e){return e[1]}function collinear(e){var t=e.triangles,n=e.coords;for(var r=0;r<t.length;r+=3){var i=2*t[r],a=2*t[r+1],o=2*t[r+2],s=(n[o]-n[i])*(n[a+1]-n[i+1])-(n[a]-n[i])*(n[o+1]-n[i+1]);if(s>1e-10)return false}return true}function jitter(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}var Delaunay=function(){function e(e){this._delaunator=new Delaunator(e);this.inedges=new Int32Array(e.length/2);this._hullIndex=new Int32Array(e.length/2);this.points=this._delaunator.coords;this._init()}e.from=function(t,n,r,i){if(n===void 0){n=pointX}if(r===void 0){r=pointY}return new e("length"in t?flatArray(t,n,r,i):Float64Array.from(flatIterable(t,n,r,i)))};e.prototype.update=function(){this._delaunator.update();this._init();return this};e.prototype._init=function(){var e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&collinear(e)){this.collinear=Int32Array.from({length:t.length/2},(function(e,t){return t})).sort((function(e,n){return t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]}));var n=this.collinear[0],r=this.collinear[this.collinear.length-1],i=[t[2*n],t[2*n+1],t[2*r],t[2*r+1]],a=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(var o=0,s=t.length/2;o<s;++o){var u=jitter(t[2*o],t[2*o+1],a);t[2*o]=u[0];t[2*o+1]=u[1]}this._delaunator=new Delaunator(t)}else{delete this.collinear}var l=this.halfedges=this._delaunator.halfedges;var f=this.hull=this._delaunator.hull;var c=this.triangles=this._delaunator.triangles;var d=this.inedges.fill(-1);var p=this._hullIndex.fill(-1);for(var h=0,s=l.length;h<s;++h){var u=c[h%3===2?h-2:h+1];if(l[h]===-1||d[u]===-1)d[u]=h}for(var o=0,s=f.length;o<s;++o){p[f[o]]=o}if(f.length<=2&&f.length>0){this.triangles=new Int32Array(3).fill(-1);this.halfedges=new Int32Array(3).fill(-1);this.triangles[0]=f[0];this.triangles[1]=f[1];this.triangles[2]=f[1];d[f[0]]=1;if(f.length===2)d[f[1]]=0}};e.prototype.voronoi=function(e){return new Voronoi$1(this,e)};e.prototype.neighbors=function(e){var t,n,r,i,a,o,s,u,l,f,c,d;return __generator(this,(function(p){switch(p.label){case 0:t=this,n=t.inedges,r=t.hull,i=t._hullIndex,a=t.halfedges,o=t.triangles,s=t.collinear;if(!s)return[3,5];u=s.indexOf(e);if(!(u>0))return[3,2];return[4,s[u-1]];case 1:p.sent();p.label=2;case 2:if(!(u<s.length-1))return[3,4];return[4,s[u+1]];case 3:p.sent();p.label=4;case 4:return[2];case 5:l=n[e];if(l===-1)return[2];f=l,c=-1;p.label=6;case 6:return[4,c=o[f]];case 7:p.sent();f=f%3===2?f-2:f+1;if(o[f]!==e)return[2];f=a[f];if(!(f===-1))return[3,10];d=r[(i[e]+1)%r.length];if(!(d!==c))return[3,9];return[4,d];case 8:p.sent();p.label=9;case 9:return[2];case 10:if(f!==l)return[3,6];p.label=11;case 11:return[2]}}))};e.prototype.find=function(e,t,n){if(n===void 0){n=0}if((e=+e,e!==e)||(t=+t,t!==t))return-1;var r=n;var i;while((i=this._step(n,e,t))>=0&&i!==n&&i!==r)n=i;return i};e.prototype._step=function(e,t,n){var r=this,i=r.inedges,a=r.hull,o=r._hullIndex,s=r.halfedges,u=r.triangles,l=r.points;if(i[e]===-1||!l.length)return(e+1)%(l.length>>1);var f=e;var c=pow(t-l[e*2],2)+pow(n-l[e*2+1],2);var d=i[e];var p=d;do{var h=u[p];var g=pow(t-l[h*2],2)+pow(n-l[h*2+1],2);if(g<c)c=g,f=h;p=p%3===2?p-2:p+1;if(u[p]!==e)break;p=s[p];if(p===-1){p=a[(o[e]+1)%a.length];if(p!==h){if(pow(t-l[p*2],2)+pow(n-l[p*2+1],2)<c)return p}break}}while(p!==d);return f};e.prototype.render=function(e){var t=e==null?e=new Path:undefined;var n=this,r=n.points,i=n.halfedges,a=n.triangles;for(var o=0,s=i.length;o<s;++o){var u=i[o];if(u<o)continue;var l=a[o]*2;var f=a[u]*2;e.moveTo(r[l],r[l+1]);e.lineTo(r[f],r[f+1])}this.renderHull(e);return t&&t.value()};e.prototype.renderPoints=function(e,t){if(t===void 0){t=2}var n=e==null?e=new Path:undefined;var r=this.points;for(var i=0,a=r.length;i<a;i+=2){var o=r[i],s=r[i+1];e.moveTo(o+t,s);e.arc(o,s,t,0,tau)}return n&&n.value()};e.prototype.renderHull=function(e){var t=e==null?e=new Path:undefined;var n=this,r=n.hull,i=n.points;var a=r[0]*2,o=r.length;e.moveTo(i[a],i[a+1]);for(var s=1;s<o;++s){var u=2*r[s];e.lineTo(i[u],i[u+1])}e.closePath();return t&&t.value()};e.prototype.hullPolygon=function(){var e=new Polygon;this.renderHull(e);return e.value()};e.prototype.renderTriangle=function(e,t){var n=t==null?t=new Path:undefined;var r=this,i=r.points,a=r.triangles;var o=a[e*=3]*2;var s=a[e+1]*2;var u=a[e+2]*2;t.moveTo(i[o],i[o+1]);t.lineTo(i[s],i[s+1]);t.lineTo(i[u],i[u+1]);t.closePath();return n&&n.value()};e.prototype.trianglePolygons=function(){var e,t,n;return __generator(this,(function(r){switch(r.label){case 0:e=this.triangles;t=0,n=e.length/3;r.label=1;case 1:if(!(t<n))return[3,4];return[4,this.trianglePolygon(t)];case 2:r.sent();r.label=3;case 3:++t;return[3,1];case 4:return[2]}}))};e.prototype.trianglePolygon=function(e){var t=new Polygon;this.renderTriangle(e,t);return t.value()};return e}();function flatArray(e,t,n,r){var i=e.length;var a=new Float64Array(i*2);for(var o=0;o<i;++o){var s=e[o];a[o*2]=t.call(r,s,o,e);a[o*2+1]=n.call(r,s,o,e)}return a}function flatIterable(e,t,n,r){var i,a,o,s;return __generator(this,(function(u){switch(u.label){case 0:i=0;a=0,o=e;u.label=1;case 1:if(!(a<o.length))return[3,5];s=o[a];return[4,t.call(r,s,i,e)];case 2:u.sent();return[4,n.call(r,s,i,e)];case 3:u.sent();++i;u.label=4;case 4:a++;return[3,1];case 5:return[2]}}))}function Voronoi(e){Transform.call(this,null,e)}Voronoi.Definition={type:"Voronoi",metadata:{modifies:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"size",type:"number",array:true,length:2},{name:"extent",type:"array",array:true,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:true,length:2}},{name:"as",type:"string",default:"path"}]};var defaultExtent=[-1e5,-1e5,1e5,1e5];inherits(Voronoi,Transform,{transform:function(e,t){var n=e.as||"path",r=t.source;if(!r||!r.length)return t;var i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:defaultExtent;var a=this.value=Delaunay.from(r,e.x,e.y).voronoi(i);for(var o=0,s=r.length;o<s;++o){var u=a.cellPolygon(o);r[o][n]=u?toPathString(u):null}return t.reflow(e.modified()).modifies(n)}});function toPathString(e){var t=e[0][0],n=e[0][1];var r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}var voronoi=Object.freeze({__proto__:null,voronoi:Voronoi});var cloudRadians=Math.PI/180,cw=1<<11>>5,ch=1<<11;function cloud(){var e=[256,256],t,n,r,i,a,o,s,u=archimedeanSpiral,l=[],f=Math.random,c={};c.layout=function(){var u=d(domCanvas()),c=zeroArray((e[0]>>5)*e[1]),h=null,g=l.length,m=-1,v=[],y=l.map((function(e){return{text:t(e),font:n(e),style:i(e),weight:a(e),rotate:o(e),size:~~(r(e)+1e-14),padding:s(e),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:false,sprite:null,datum:e}})).sort((function(e,t){return t.size-e.size}));while(++m<g){var _=y[m];_.x=e[0]*(f()+.5)>>1;_.y=e[1]*(f()+.5)>>1;cloudSprite(u,_,y,m);if(_.hasText&&p(c,_,h)){v.push(_);if(h)cloudBounds(h,_);else h=[{x:_.x+_.x0,y:_.y+_.y0},{x:_.x+_.x1,y:_.y+_.y1}];_.x-=e[0]>>1;_.y-=e[1]>>1}}return v};function d(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=(cw<<5)/t;e.height=ch/t;var n=e.getContext("2d");n.fillStyle=n.strokeStyle="red";n.textAlign="center";return{context:n,ratio:t}}function p(t,n,r){var i=n.x,a=n.y,o=Math.sqrt(e[0]*e[0]+e[1]*e[1]),s=u(e),l=f()<.5?1:-1,c=-l,d,p,h;while(d=s(c+=l)){p=~~d[0];h=~~d[1];if(Math.min(Math.abs(p),Math.abs(h))>=o)break;n.x=i+p;n.y=a+h;if(n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>e[0]||n.y+n.y1>e[1])continue;if(!r||!cloudCollide(n,t,e[0])){if(!r||collideRects(n,r)){var g=n.sprite,m=n.width>>5,v=e[0]>>5,y=n.x-(m<<4),_=y&127,b=32-_,x=n.y1-n.y0,E=(n.y+n.y0)*v+(y>>5),S;for(var $=0;$<x;$++){S=0;for(var A=0;A<=m;A++){t[E+A]|=S<<b|(A<m?(S=g[$*m+A])>>>_:0)}E+=v}n.sprite=null;return true}}}return false}c.words=function(e){if(arguments.length){l=e;return c}else{return l}};c.size=function(t){if(arguments.length){e=[+t[0],+t[1]];return c}else{return e}};c.font=function(e){if(arguments.length){n=functor(e);return c}else{return n}};c.fontStyle=function(e){if(arguments.length){i=functor(e);return c}else{return i}};c.fontWeight=function(e){if(arguments.length){a=functor(e);return c}else{return a}};c.rotate=function(e){if(arguments.length){o=functor(e);return c}else{return o}};c.text=function(e){if(arguments.length){t=functor(e);return c}else{return t}};c.spiral=function(e){if(arguments.length){u=spirals[e]||e;return c}else{return u}};c.fontSize=function(e){if(arguments.length){r=functor(e);return c}else{return r}};c.padding=function(e){if(arguments.length){s=functor(e);return c}else{return s}};c.random=function(e){if(arguments.length){f=e;return c}else{return f}};return c}function cloudSprite(e,t,n,r){if(t.sprite)return;var i=e.context,a=e.ratio;i.clearRect(0,0,(cw<<5)/a,ch/a);var o=0,s=0,u=0,l=n.length,f,c,d,p,h;--r;while(++r<l){t=n[r];i.save();i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font;f=i.measureText(t.text+"m").width*a;d=t.size<<1;if(t.rotate){var g=Math.sin(t.rotate*cloudRadians),m=Math.cos(t.rotate*cloudRadians),v=f*m,y=f*g,_=d*m,b=d*g;f=Math.max(Math.abs(v+b),Math.abs(v-b))+31>>5<<5;d=~~Math.max(Math.abs(y+_),Math.abs(y-_))}else{f=f+31>>5<<5}if(d>u)u=d;if(o+f>=cw<<5){o=0;s+=u;u=0}if(s+d>=ch)break;i.translate((o+(f>>1))/a,(s+(d>>1))/a);if(t.rotate)i.rotate(t.rotate*cloudRadians);i.fillText(t.text,0,0);if(t.padding){i.lineWidth=2*t.padding;i.strokeText(t.text,0,0)}i.restore();t.width=f;t.height=d;t.xoff=o;t.yoff=s;t.x1=f>>1;t.y1=d>>1;t.x0=-t.x1;t.y0=-t.y1;t.hasText=true;o+=f}var x=i.getImageData(0,0,(cw<<5)/a,ch/a).data,E=[];while(--r>=0){t=n[r];if(!t.hasText)continue;f=t.width;c=f>>5;d=t.y1-t.y0;for(p=0;p<d*c;p++)E[p]=0;o=t.xoff;if(o==null)return;s=t.yoff;var S=0,$=-1;for(h=0;h<d;h++){for(p=0;p<f;p++){var A=c*h+(p>>5),D=x[(s+h)*(cw<<5)+(o+p)<<2]?1<<31-p%32:0;E[A]|=D;S|=D}if(S)$=h;else{t.y0++;d--;h--;s++}}t.y1=t.y0+$;t.sprite=E.slice(0,(t.y1-t.y0)*c)}}function cloudCollide(e,t,n){n>>=5;var r=e.sprite,i=e.width>>5,a=e.x-(i<<4),o=a&127,s=32-o,u=e.y1-e.y0,l=(e.y+e.y0)*n+(a>>5),f;for(var c=0;c<u;c++){f=0;for(var d=0;d<=i;d++){if((f<<s|(d<i?(f=r[c*i+d])>>>o:0))&t[l+d])return true}l+=n}return false}function cloudBounds(e,t){var n=e[0],r=e[1];if(t.x+t.x0<n.x)n.x=t.x+t.x0;if(t.y+t.y0<n.y)n.y=t.y+t.y0;if(t.x+t.x1>r.x)r.x=t.x+t.x1;if(t.y+t.y1>r.y)r.y=t.y+t.y1}function collideRects(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function archimedeanSpiral(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function rectangularSpiral(e){var t=4,n=t*e[0]/e[1],r=0,i=0;return function(e){var a=e<0?-1:1;switch(Math.sqrt(1+4*a*e)-a&3){case 0:r+=n;break;case 1:i+=t;break;case 2:r-=n;break;default:i-=t;break}return[r,i]}}function zeroArray(e){var t=[],n=-1;while(++n<e)t[n]=0;return t}function functor(e){return typeof e==="function"?e:function(){return e}}var spirals={archimedean:archimedeanSpiral,rectangular:rectangularSpiral};var Output=["x","y","font","fontSize","fontStyle","fontWeight","angle"];var Params$1=["text","font","rotate","fontSize","fontStyle","fontWeight"];function Wordcloud(e){Transform.call(this,cloud(),e)}Wordcloud.Definition={type:"Wordcloud",metadata:{modifies:true},params:[{name:"size",type:"number",array:true,length:2},{name:"font",type:"string",expr:true,default:"sans-serif"},{name:"fontStyle",type:"string",expr:true,default:"normal"},{name:"fontWeight",type:"string",expr:true,default:"normal"},{name:"fontSize",type:"number",expr:true,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:true,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:true},{name:"as",type:"string",array:true,length:7,default:Output}]};inherits(Wordcloud,Transform,{transform:function(e,t){if(e.size&&!(e.size[0]&&e.size[1])){error("Wordcloud size dimensions must be non-zero.")}function n(n){var r=e[n];return isFunction(r)&&t.modified(r.fields)}var r=e.modified();if(!(r||t.changed(t.ADD_REM)||Params$1.some(n)))return;var i=t.materialize(t.SOURCE).source,a=this.value,o=e.as||Output;var s=e.fontSize||14,u;isFunction(s)?u=e.fontSizeRange:s=constant$4(s);if(u){var l=s,f=scale$4("sqrt")().domain(extent(i,l)).range(u);s=function(e){return f(l(e))}}i.forEach((function(e){e[o[0]]=NaN;e[o[1]]=NaN;e[o[3]]=0}));var c=a.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(random).layout();var d=a.size(),p=d[0]>>1,h=d[1]>>1,g=c.length;for(var m=0,v,y;m<g;++m){v=c[m];y=v.datum;y[o[0]]=v.x+p;y[o[1]]=v.y+h;y[o[2]]=v.font;y[o[3]]=v.size;y[o[4]]=v.style;y[o[5]]=v.weight;y[o[6]]=v.rotate}return t.reflow(r).modifies(o)}});var wordcloud=Object.freeze({__proto__:null,wordcloud:Wordcloud});var array8=function(e){return new Uint8Array(e)};var array16=function(e){return new Uint16Array(e)};var array32=function(e){return new Uint32Array(e)};function Bitmaps(){var e=8,t=[],n=array32(0),r=array$1(0,e),i=array$1(0,e);return{data:function(){return t},seen:function(){return n=lengthen(n,t.length)},add:function(e){for(var n=0,r=t.length,i=e.length,a;n<i;++n){a=e[n];a._index=r++;t.push(a)}},remove:function(e,n){var a=t.length,o=Array(a-e),s=t;var u,l,f;for(l=0;!n[l]&&l<a;++l){o[l]=t[l];s[l]=l}for(f=l;l<a;++l){u=t[l];if(!n[l]){s[l]=f;r[f]=r[l];i[f]=i[l];o[f]=u;u._index=f++}else{s[l]=-1}r[l]=0}t=o;return s},size:function(){return t.length},curr:function(){return r},prev:function(){return i},reset:function(e){return i[e]=r[e]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(e,t){r[e]|=t},clear:function(e,t){r[e]&=~t},resize:function(t,n){var a=r.length;if(t>a||n>e){e=Math.max(n,e);r=array$1(t,e,r);i=array$1(t,e)}}}}function lengthen(e,t,n){if(e.length>=t)return e;n=n||new e.constructor(t);n.set(e);return n}function array$1(e,t,n){var r=(t<257?array8:t<65537?array16:array32)(e);if(n)r.set(n);return r}function Dimension(e,t,n){var r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(e,t){var n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],s=i[1],u=a.length;var l;for(l=0;l<o;++l)t[a[l]]|=r;for(l=s;l<u;++l)t[a[l]]|=r;return n}}}function SortedIndex(){var e=array32(0),t=[],n=0;function r(r,i,a){if(!i.length)return[];var o=n,s=i.length,u=array32(s);var l=Array(s),f,c,d;for(d=0;d<s;++d){l[d]=r(i[d]);u[d]=d}l=sort(l,u);if(o){f=t;c=e;t=Array(o+s);e=array32(o+s);merge$1(a,f,c,o,l,u,s,t,e)}else{if(a>0)for(d=0;d<s;++d){u[d]+=a}t=l;e=u}n=o+s;return{index:u,value:l}}function i(r,i){var a=n;var o,s,u;for(s=0;!i[e[s]]&&s<a;++s);for(u=s;s<a;++s){if(!i[o=e[s]]){e[u]=o;t[u]=t[s];++u}}n=a-r}function a(t){for(var r=0,i=n;r<i;++r){e[r]=t[e[r]]}}function o(e,r){var i;if(r){i=r.length}else{r=t;i=n}return[bisectLeft$1(r,e[0],0,i),bisectRight$1(r,e[1],0,i)]}return{insert:r,remove:i,bisect:o,reindex:a,index:function(){return e},size:function(){return n}}}function sort(e,t){e.sort.call(t,(function(t,n){var r=e[t],i=e[n];return r<i?-1:r>i?1:0}));return permute(e,t)}function merge$1(e,t,n,r,i,a,o,s,u){var l=0,f=0,c;for(c=0;l<r&&f<o;++c){if(t[l]<i[f]){s[c]=t[l];u[c]=n[l++]}else{s[c]=i[f];u[c]=a[f++]+e}}for(;l<r;++l,++c){s[c]=t[l];u[c]=n[l]}for(;f<o;++f,++c){s[c]=i[f];u[c]=a[f]+e}}function CrossFilter(e){Transform.call(this,Bitmaps(),e);this._indices=null;this._dims=null}CrossFilter.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:true,required:true},{name:"query",type:"array",array:true,required:true,content:{type:"number",array:true,length:2}}]};inherits(CrossFilter,Transform,{transform:function(e,t){if(!this._dims){return this.init(e,t)}else{var n=e.modified("fields")||e.fields.some((function(e){return t.modified(e.fields)}));return n?this.reinit(e,t):this.eval(e,t)}},init:function(e,t){var n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;var s=0,u,l;for(;s<o;++s){u=n[s].fname;l=i[u]||(i[u]=SortedIndex());a.push(Dimension(l,s,r[s]))}return this.eval(e,t)},reinit:function(e,t){var n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,u=s.curr(),l=s.prev(),f=s.all(),c=n.rem=n.add,d=n.mod,p=i.length,h={};var g,m,v,y,_,b,x,E,S;l.set(u);if(t.rem.length){_=this.remove(e,t,n)}if(t.add.length){s.add(t.add)}if(t.mod.length){b={};for(y=t.mod,x=0,E=y.length;x<E;++x){b[y[x]._index]=1}}for(x=0;x<p;++x){S=r[x];if(!o[x]||e.modified("fields",x)||t.modified(S.fields)){v=S.fname;if(!(g=h[v])){a[v]=m=SortedIndex();h[v]=g=m.insert(S,t.source,0)}o[x]=Dimension(m,x,i[x]).onAdd(g,u)}}for(x=0,E=s.data().length;x<E;++x){if(_[x]){continue}else if(l[x]!==u[x]){c.push(x)}else if(b[x]&&u[x]!==f){d.push(x)}}s.mask=(1<<p)-1;return n},eval:function(e,t){var n=t.materialize().fork(),r=this._dims.length;var i=0;if(t.rem.length){this.remove(e,t,n);i|=(1<<r)-1}if(e.modified("query")&&!e.modified("fields")){i|=this.update(e,t,n)}if(t.add.length){this.insert(e,t,n);i|=(1<<r)-1}if(t.mod.length){this.modify(t,n);i|=(1<<r)-1}this.value.mask=i;return n},insert:function(e,t,n){var r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,u={},l=n.add,f=i.size()+r.length,c=a.length;var d=i.size(),p,h,g;i.resize(f,c);i.add(r);var m=i.curr(),v=i.prev(),y=i.all();for(p=0;p<c;++p){h=s[p].fname;g=u[h]||(u[h]=o[h].insert(s[p],r,d));a[p].onAdd(g,m)}for(;d<f;++d){v[d]=y;if(m[d]!==y)l.push(d)}},modify:function(e,t){var n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;var s,u,l;for(s=0,u=o.length;s<u;++s){l=o[s]._index;if(i[l]!==a)n.push(l)}},remove:function(e,t,n){var r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),u={},l=n.rem,f=t.rem;var c,d,p,h;for(c=0,d=f.length;c<d;++c){p=f[c]._index;u[p]=1;o[p]=h=a[p];a[p]=s;if(h!==s)l.push(p)}for(p in r){r[p].remove(d,u)}this.reindex(t,d,u);return u},reindex:function(e,t,n){var r=this._indices,i=this.value;e.runAfter((function(){var e=i.remove(t,n);for(var a in r)r[a].reindex(e)}))},update:function(e,t,n){var r=this._dims,i=e.query,a=t.stamp,o=r.length;var s=0,u,l;n.filters=0;for(l=0;l<o;++l){if(e.modified("query",l)){u=l;++s}}if(s===1){s=r[u].one;this.incrementOne(r[u],i[u],n.add,n.rem)}else{for(l=0,s=0;l<o;++l){if(!e.modified("query",l))continue;s|=r[l].one;this.incrementAll(r[l],i[l],a,n.add);n.rem=n.add}}return s},incrementAll:function(e,t,n,r){var i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),u=e.index(),l=e.bisect(e.range),f=e.bisect(t),c=f[0],d=f[1],p=l[0],h=l[1],g=e.one;var m,v,y;if(c<p){for(m=c,v=Math.min(p,d);m<v;++m){y=u[m];if(a[y]!==n){s[y]=o[y];a[y]=n;r.push(y)}o[y]^=g}}else if(c>p){for(m=p,v=Math.min(c,h);m<v;++m){y=u[m];if(a[y]!==n){s[y]=o[y];a[y]=n;r.push(y)}o[y]^=g}}if(d>h){for(m=Math.max(c,h),v=d;m<v;++m){y=u[m];if(a[y]!==n){s[y]=o[y];a[y]=n;r.push(y)}o[y]^=g}}else if(d<h){for(m=Math.max(p,d),v=h;m<v;++m){y=u[m];if(a[y]!==n){s[y]=o[y];a[y]=n;r.push(y)}o[y]^=g}}e.range=t.slice()},incrementOne:function(e,t,n,r){var i=this.value,a=i.curr(),o=e.index(),s=e.bisect(e.range),u=e.bisect(t),l=u[0],f=u[1],c=s[0],d=s[1],p=e.one;var h,g,m;if(l<c){for(h=l,g=Math.min(c,f);h<g;++h){m=o[h];a[m]^=p;n.push(m)}}else if(l>c){for(h=c,g=Math.min(l,d);h<g;++h){m=o[h];a[m]^=p;r.push(m)}}if(f>d){for(h=Math.max(l,d),g=f;h<g;++h){m=o[h];a[m]^=p;n.push(m)}}else if(f<d){for(h=Math.max(c,f),g=d;h<g;++h){m=o[h];a[m]^=p;r.push(m)}}e.range=t.slice()}});function ResolveFilter(e){Transform.call(this,null,e)}ResolveFilter.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:true,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:true,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};inherits(ResolveFilter,Transform,{transform:function(e,t){var n=~(e.ignore||0),r=e.filter,i=r.mask;if((i&n)===0)return t.StopPropagation;var a=t.fork(t.ALL),o=r.data(),s=r.curr(),u=r.prev(),l=function(e){return!(s[e]&n)?o[e]:null};a.filter(a.MOD,l);if(!(i&i-1)){a.filter(a.ADD,l);a.filter(a.REM,(function(e){return(s[e]&n)===i?o[e]:null}))}else{a.filter(a.ADD,(function(e){var t=s[e]&n,r=!t&&t^u[e]&n;return r?o[e]:null}));a.filter(a.REM,(function(e){var t=s[e]&n,r=t&&!(t^(t^u[e]&n));return r?o[e]:null}))}return a.filter(a.SOURCE,(function(e){return l(e._index)}))}});var xf=Object.freeze({__proto__:null,crossfilter:CrossFilter,resolvefilter:ResolveFilter});var RawCode="RawCode";var Literal="Literal";var Property="Property";var Identifier="Identifier";var ArrayExpression="ArrayExpression";var BinaryExpression="BinaryExpression";var CallExpression="CallExpression";var ConditionalExpression="ConditionalExpression";var LogicalExpression="LogicalExpression";var MemberExpression="MemberExpression";var ObjectExpression="ObjectExpression";var UnaryExpression="UnaryExpression";function ASTNode(e){this.type=e}ASTNode.prototype.visit=function(e){var t,n,r;if(e(this))return 1;for(t=children(this),n=0,r=t.length;n<r;++n){if(t[n].visit(e))return 1}};function children(e){switch(e.type){case ArrayExpression:return e.elements;case BinaryExpression:case LogicalExpression:return[e.left,e.right];case CallExpression:return[e.callee].concat(e.arguments);case ConditionalExpression:return[e.test,e.consequent,e.alternate];case MemberExpression:return[e.object,e.property];case ObjectExpression:return e.properties;case Property:return[e.key,e.value];case UnaryExpression:return[e.argument];case Identifier:case Literal:case RawCode:default:return[]}}var TokenName,source,index,length,lookahead;var TokenBooleanLiteral=1,TokenEOF=2,TokenIdentifier=3,TokenKeyword=4,TokenNullLiteral=5,TokenNumericLiteral=6,TokenPunctuator=7,TokenStringLiteral=8,TokenRegularExpression=9;TokenName={};TokenName[TokenBooleanLiteral]="Boolean";TokenName[TokenEOF]="<end>";TokenName[TokenIdentifier]="Identifier";TokenName[TokenKeyword]="Keyword";TokenName[TokenNullLiteral]="Null";TokenName[TokenNumericLiteral]="Numeric";TokenName[TokenPunctuator]="Punctuator";TokenName[TokenStringLiteral]="String";TokenName[TokenRegularExpression]="RegularExpression";var SyntaxArrayExpression="ArrayExpression",SyntaxBinaryExpression="BinaryExpression",SyntaxCallExpression="CallExpression",SyntaxConditionalExpression="ConditionalExpression",SyntaxIdentifier="Identifier",SyntaxLiteral="Literal",SyntaxLogicalExpression="LogicalExpression",SyntaxMemberExpression="MemberExpression",SyntaxObjectExpression="ObjectExpression",SyntaxProperty="Property",SyntaxUnaryExpression="UnaryExpression";var MessageUnexpectedToken="Unexpected token %0",MessageUnexpectedNumber="Unexpected number",MessageUnexpectedString="Unexpected string",MessageUnexpectedIdentifier="Unexpected identifier",MessageUnexpectedReserved="Unexpected reserved word",MessageUnexpectedEOS="Unexpected end of input",MessageInvalidRegExp="Invalid regular expression",MessageUnterminatedRegExp="Invalid regular expression: missing /",MessageStrictOctalLiteral="Octal literals are not allowed in strict mode.",MessageStrictDuplicateProperty="Duplicate data property in object literal not allowed in strict mode";var ILLEGAL$1="ILLEGAL",DISABLED="Disabled.";var RegexNonAsciiIdentifierStart=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),RegexNonAsciiIdentifierPart=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function assert(e,t){if(!e){throw new Error("ASSERT: "+t)}}function isDecimalDigit(e){return e>=48&&e<=57}function isHexDigit(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function isOctalDigit(e){return"01234567".indexOf(e)>=0}function isWhiteSpace(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function isLineTerminator(e){return e===10||e===13||e===8232||e===8233}function isIdentifierStart(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&RegexNonAsciiIdentifierStart.test(String.fromCharCode(e))}function isIdentifierPart(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&RegexNonAsciiIdentifierPart.test(String.fromCharCode(e))}var keywords$2={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function skipComment(){while(index<length){var e=source.charCodeAt(index);if(isWhiteSpace(e)||isLineTerminator(e)){++index}else{break}}}function scanHexEscape(e){var t,n,r,i=0;n=e==="u"?4:2;for(t=0;t<n;++t){if(index<length&&isHexDigit(source[index])){r=source[index++];i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())}else{throwError({},MessageUnexpectedToken,ILLEGAL$1)}}return String.fromCharCode(i)}function scanUnicodeCodePointEscape(){var e,t,n,r;e=source[index];t=0;if(e==="}"){throwError({},MessageUnexpectedToken,ILLEGAL$1)}while(index<length){e=source[index++];if(!isHexDigit(e)){break}t=t*16+"0123456789abcdef".indexOf(e.toLowerCase())}if(t>1114111||e!=="}"){throwError({},MessageUnexpectedToken,ILLEGAL$1)}if(t<=65535){return String.fromCharCode(t)}n=(t-65536>>10)+55296;r=(t-65536&1023)+56320;return String.fromCharCode(n,r)}function getEscapedIdentifier(){var e,t;e=source.charCodeAt(index++);t=String.fromCharCode(e);if(e===92){if(source.charCodeAt(index)!==117){throwError({},MessageUnexpectedToken,ILLEGAL$1)}++index;e=scanHexEscape("u");if(!e||e==="\\"||!isIdentifierStart(e.charCodeAt(0))){throwError({},MessageUnexpectedToken,ILLEGAL$1)}t=e}while(index<length){e=source.charCodeAt(index);if(!isIdentifierPart(e)){break}++index;t+=String.fromCharCode(e);if(e===92){t=t.substr(0,t.length-1);if(source.charCodeAt(index)!==117){throwError({},MessageUnexpectedToken,ILLEGAL$1)}++index;e=scanHexEscape("u");if(!e||e==="\\"||!isIdentifierPart(e.charCodeAt(0))){throwError({},MessageUnexpectedToken,ILLEGAL$1)}t+=e}}return t}function getIdentifier(){var e,t;e=index++;while(index<length){t=source.charCodeAt(index);if(t===92){index=e;return getEscapedIdentifier()}if(isIdentifierPart(t)){++index}else{break}}return source.slice(e,index)}function scanIdentifier(){var e,t,n;e=index;t=source.charCodeAt(index)===92?getEscapedIdentifier():getIdentifier();if(t.length===1){n=TokenIdentifier}else if(keywords$2.hasOwnProperty(t)){n=TokenKeyword}else if(t==="null"){n=TokenNullLiteral}else if(t==="true"||t==="false"){n=TokenBooleanLiteral}else{n=TokenIdentifier}return{type:n,value:t,start:e,end:index}}function scanPunctuator(){var e=index,t=source.charCodeAt(index),n,r=source[index],i,a,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++index;return{type:TokenPunctuator,value:String.fromCharCode(t),start:e,end:index};default:n=source.charCodeAt(index+1);if(n===61){switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:index+=2;return{type:TokenPunctuator,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:index};case 33:case 61:index+=2;if(source.charCodeAt(index)===61){++index}return{type:TokenPunctuator,value:source.slice(e,index),start:e,end:index}}}}o=source.substr(index,4);if(o===">>>="){index+=4;return{type:TokenPunctuator,value:o,start:e,end:index}}a=o.substr(0,3);if(a===">>>"||a==="<<="||a===">>="){index+=3;return{type:TokenPunctuator,value:a,start:e,end:index}}i=a.substr(0,2);if(r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>"){index+=2;return{type:TokenPunctuator,value:i,start:e,end:index}}if(i==="//"){throwError({},MessageUnexpectedToken,ILLEGAL$1)}if("<>=!+-*%&|^/".indexOf(r)>=0){++index;return{type:TokenPunctuator,value:r,start:e,end:index}}throwError({},MessageUnexpectedToken,ILLEGAL$1)}function scanHexLiteral(e){var t="";while(index<length){if(!isHexDigit(source[index])){break}t+=source[index++]}if(t.length===0){throwError({},MessageUnexpectedToken,ILLEGAL$1)}if(isIdentifierStart(source.charCodeAt(index))){throwError({},MessageUnexpectedToken,ILLEGAL$1)}return{type:TokenNumericLiteral,value:parseInt("0x"+t,16),start:e,end:index}}function scanOctalLiteral(e){var t="0"+source[index++];while(index<length){if(!isOctalDigit(source[index])){break}t+=source[index++]}if(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index))){throwError({},MessageUnexpectedToken,ILLEGAL$1)}return{type:TokenNumericLiteral,value:parseInt(t,8),octal:true,start:e,end:index}}function scanNumericLiteral(){var e,t,n;n=source[index];assert(isDecimalDigit(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point");t=index;e="";if(n!=="."){e=source[index++];n=source[index];if(e==="0"){if(n==="x"||n==="X"){++index;return scanHexLiteral(t)}if(isOctalDigit(n)){return scanOctalLiteral(t)}if(n&&isDecimalDigit(n.charCodeAt(0))){throwError({},MessageUnexpectedToken,ILLEGAL$1)}}while(isDecimalDigit(source.charCodeAt(index))){e+=source[index++]}n=source[index]}if(n==="."){e+=source[index++];while(isDecimalDigit(source.charCodeAt(index))){e+=source[index++]}n=source[index]}if(n==="e"||n==="E"){e+=source[index++];n=source[index];if(n==="+"||n==="-"){e+=source[index++]}if(isDecimalDigit(source.charCodeAt(index))){while(isDecimalDigit(source.charCodeAt(index))){e+=source[index++]}}else{throwError({},MessageUnexpectedToken,ILLEGAL$1)}}if(isIdentifierStart(source.charCodeAt(index))){throwError({},MessageUnexpectedToken,ILLEGAL$1)}return{type:TokenNumericLiteral,value:parseFloat(e),start:t,end:index}}function scanStringLiteral(){var e="",t,n,r,i,a=false;t=source[index];assert(t==="'"||t==='"',"String literal must starts with a quote");n=index;++index;while(index<length){r=source[index++];if(r===t){t="";break}else if(r==="\\"){r=source[index++];if(!r||!isLineTerminator(r.charCodeAt(0))){switch(r){case"u":case"x":if(source[index]==="{"){++index;e+=scanUnicodeCodePointEscape()}else{e+=scanHexEscape(r)}break;case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:if(isOctalDigit(r)){i="01234567".indexOf(r);if(i!==0){a=true}if(index<length&&isOctalDigit(source[index])){a=true;i=i*8+"01234567".indexOf(source[index++]);if("0123".indexOf(r)>=0&&index<length&&isOctalDigit(source[index])){i=i*8+"01234567".indexOf(source[index++])}}e+=String.fromCharCode(i)}else{e+=r}break}}else{if(r==="\r"&&source[index]==="\n"){++index}}}else if(isLineTerminator(r.charCodeAt(0))){break}else{e+=r}}if(t!==""){throwError({},MessageUnexpectedToken,ILLEGAL$1)}return{type:TokenStringLiteral,value:e,octal:a,start:n,end:index}}function testRegExp(e,t){var n=e;if(t.indexOf("u")>=0){n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111){return"x"}throwError({},MessageInvalidRegExp)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x")}try{return new RegExp(e,t)}catch(r){return null}}function scanRegExpBody(){var e,t,n,r,i;e=source[index];assert(e==="/","Regular expression literal must start with a slash");t=source[index++];n=false;r=false;while(index<length){e=source[index++];t+=e;if(e==="\\"){e=source[index++];if(isLineTerminator(e.charCodeAt(0))){throwError({},MessageUnterminatedRegExp)}t+=e}else if(isLineTerminator(e.charCodeAt(0))){throwError({},MessageUnterminatedRegExp)}else if(n){if(e==="]"){n=false}}else{if(e==="/"){r=true;break}else if(e==="["){n=true}}}if(!r){throwError({},MessageUnterminatedRegExp)}i=t.substr(1,t.length-2);return{value:i,literal:t}}function scanRegExpFlags(){var e,t,n;t="";n="";while(index<length){e=source[index];if(!isIdentifierPart(e.charCodeAt(0))){break}++index;if(e==="\\"&&index<length){throwError({},MessageUnexpectedToken,ILLEGAL$1)}else{n+=e;t+=e}}if(n.search(/[^gimuy]/g)>=0){throwError({},MessageInvalidRegExp,n)}return{value:n,literal:t}}function scanRegExp(){var e,t,n,r;lookahead=null;skipComment();e=index;t=scanRegExpBody();n=scanRegExpFlags();r=testRegExp(t.value,n.value);return{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:index}}function isIdentifierName(e){return e.type===TokenIdentifier||e.type===TokenKeyword||e.type===TokenBooleanLiteral||e.type===TokenNullLiteral}function advance(){skipComment();if(index>=length){return{type:TokenEOF,start:index,end:index}}var e=source.charCodeAt(index);if(isIdentifierStart(e)){return scanIdentifier()}if(e===40||e===41||e===59){return scanPunctuator()}if(e===39||e===34){return scanStringLiteral()}if(e===46){if(isDecimalDigit(source.charCodeAt(index+1))){return scanNumericLiteral()}return scanPunctuator()}if(isDecimalDigit(e)){return scanNumericLiteral()}return scanPunctuator()}function lex(){var e=lookahead;index=e.end;lookahead=advance();index=e.end;return e}function peek(){var e=index;lookahead=advance();index=e}function finishArrayExpression(e){var t=new ASTNode(SyntaxArrayExpression);t.elements=e;return t}function finishBinaryExpression(e,t,n){var r=new ASTNode(e==="||"||e==="&&"?SyntaxLogicalExpression:SyntaxBinaryExpression);r.operator=e;r.left=t;r.right=n;return r}function finishCallExpression(e,t){var n=new ASTNode(SyntaxCallExpression);n.callee=e;n.arguments=t;return n}function finishConditionalExpression(e,t,n){var r=new ASTNode(SyntaxConditionalExpression);r.test=e;r.consequent=t;r.alternate=n;return r}function finishIdentifier(e){var t=new ASTNode(SyntaxIdentifier);t.name=e;return t}function finishLiteral(e){var t=new ASTNode(SyntaxLiteral);t.value=e.value;t.raw=source.slice(e.start,e.end);if(e.regex){if(t.raw==="//"){t.raw="/(?:)/"}t.regex=e.regex}return t}function finishMemberExpression(e,t,n){var r=new ASTNode(SyntaxMemberExpression);r.computed=e==="[";r.object=t;r.property=n;if(!r.computed)n.member=true;return r}function finishObjectExpression(e){var t=new ASTNode(SyntaxObjectExpression);t.properties=e;return t}function finishProperty(e,t,n){var r=new ASTNode(SyntaxProperty);r.key=t;r.value=n;r.kind=e;return r}function finishUnaryExpression(e,t){var n=new ASTNode(SyntaxUnaryExpression);n.operator=e;n.argument=t;n.prefix=true;return n}function throwError(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){assert(t<r.length,"Message reference must be in range");return r[t]}));n=new Error(i);n.index=index;n.description=i;throw n}function throwUnexpected(e){if(e.type===TokenEOF){throwError(e,MessageUnexpectedEOS)}if(e.type===TokenNumericLiteral){throwError(e,MessageUnexpectedNumber)}if(e.type===TokenStringLiteral){throwError(e,MessageUnexpectedString)}if(e.type===TokenIdentifier){throwError(e,MessageUnexpectedIdentifier)}if(e.type===TokenKeyword){throwError(e,MessageUnexpectedReserved)}throwError(e,MessageUnexpectedToken,e.value)}function expect(e){var t=lex();if(t.type!==TokenPunctuator||t.value!==e){throwUnexpected(t)}}function match(e){return lookahead.type===TokenPunctuator&&lookahead.value===e}function matchKeyword(e){return lookahead.type===TokenKeyword&&lookahead.value===e}function parseArrayInitialiser(){var e=[];index=lookahead.start;expect("[");while(!match("]")){if(match(",")){lex();e.push(null)}else{e.push(parseConditionalExpression());if(!match("]")){expect(",")}}}lex();return finishArrayExpression(e)}function parseObjectPropertyKey(){index=lookahead.start;var e=lex();if(e.type===TokenStringLiteral||e.type===TokenNumericLiteral){if(e.octal){throwError(e,MessageStrictOctalLiteral)}return finishLiteral(e)}return finishIdentifier(e.value)}function parseObjectProperty(){var e,t,n,r;index=lookahead.start;e=lookahead;if(e.type===TokenIdentifier){n=parseObjectPropertyKey();expect(":");r=parseConditionalExpression();return finishProperty("init",n,r)}if(e.type===TokenEOF||e.type===TokenPunctuator){throwUnexpected(e)}else{t=parseObjectPropertyKey();expect(":");r=parseConditionalExpression();return finishProperty("init",t,r)}}function parseObjectInitialiser(){var e=[],t,n,r,i={},a=String;index=lookahead.start;expect("{");while(!match("}")){t=parseObjectProperty();if(t.key.type===SyntaxIdentifier){n=t.key.name}else{n=a(t.key.value)}r="$"+n;if(Object.prototype.hasOwnProperty.call(i,r)){throwError({},MessageStrictDuplicateProperty)}else{i[r]=true}e.push(t);if(!match("}")){expect(",")}}expect("}");return finishObjectExpression(e)}function parseGroupExpression(){expect("(");var e=parseExpression$1();expect(")");return e}var legalKeywords={if:1};function parsePrimaryExpression(){var e,t,n;if(match("(")){return parseGroupExpression()}if(match("[")){return parseArrayInitialiser()}if(match("{")){return parseObjectInitialiser()}e=lookahead.type;index=lookahead.start;if(e===TokenIdentifier||legalKeywords[lookahead.value]){n=finishIdentifier(lex().value)}else if(e===TokenStringLiteral||e===TokenNumericLiteral){if(lookahead.octal){throwError(lookahead,MessageStrictOctalLiteral)}n=finishLiteral(lex())}else if(e===TokenKeyword){throw new Error(DISABLED)}else if(e===TokenBooleanLiteral){t=lex();t.value=t.value==="true";n=finishLiteral(t)}else if(e===TokenNullLiteral){t=lex();t.value=null;n=finishLiteral(t)}else if(match("/")||match("/=")){n=finishLiteral(scanRegExp());peek()}else{throwUnexpected(lex())}return n}function parseArguments(){var e=[];expect("(");if(!match(")")){while(index<length){e.push(parseConditionalExpression());if(match(")")){break}expect(",")}}expect(")");return e}function parseNonComputedProperty(){index=lookahead.start;var e=lex();if(!isIdentifierName(e)){throwUnexpected(e)}return finishIdentifier(e.value)}function parseNonComputedMember(){expect(".");return parseNonComputedProperty()}function parseComputedMember(){expect("[");var e=parseExpression$1();expect("]");return e}function parseLeftHandSideExpressionAllowCall(){var e,t,n;e=parsePrimaryExpression();for(;;){if(match(".")){n=parseNonComputedMember();e=finishMemberExpression(".",e,n)}else if(match("(")){t=parseArguments();e=finishCallExpression(e,t)}else if(match("[")){n=parseComputedMember();e=finishMemberExpression("[",e,n)}else{break}}return e}function parsePostfixExpression(){var e=parseLeftHandSideExpressionAllowCall();if(lookahead.type===TokenPunctuator){if(match("++")||match("--")){throw new Error(DISABLED)}}return e}function parseUnaryExpression(){var e,t;if(lookahead.type!==TokenPunctuator&&lookahead.type!==TokenKeyword){t=parsePostfixExpression()}else if(match("++")||match("--")){throw new Error(DISABLED)}else if(match("+")||match("-")||match("~")||match("!")){e=lex();t=parseUnaryExpression();t=finishUnaryExpression(e.value,t)}else if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")){throw new Error(DISABLED)}else{t=parsePostfixExpression()}return t}function binaryPrecedence(e){var t=0;if(e.type!==TokenPunctuator&&e.type!==TokenKeyword){return 0}switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function parseBinaryExpression(){var e,t,n,r,i,a,o,s,u,l;e=lookahead;u=parseUnaryExpression();r=lookahead;i=binaryPrecedence(r);if(i===0){return u}r.prec=i;lex();t=[e,lookahead];o=parseUnaryExpression();a=[u,r,o];while((i=binaryPrecedence(lookahead))>0){while(a.length>2&&i<=a[a.length-2].prec){o=a.pop();s=a.pop().value;u=a.pop();t.pop();n=finishBinaryExpression(s,u,o);a.push(n)}r=lex();r.prec=i;a.push(r);t.push(lookahead);n=parseUnaryExpression();a.push(n)}l=a.length-1;n=a[l];t.pop();while(l>1){t.pop();n=finishBinaryExpression(a[l-1].value,a[l-2],n);l-=2}return n}function parseConditionalExpression(){var e,t,n;e=parseBinaryExpression();if(match("?")){lex();t=parseConditionalExpression();expect(":");n=parseConditionalExpression();e=finishConditionalExpression(e,t,n)}return e}function parseExpression$1(){var e=parseConditionalExpression();if(match(",")){throw new Error(DISABLED)}return e}function parser$1(e){source=e;index=0;length=source.length;lookahead=null;peek();var t=parseExpression$1();if(lookahead.type!==TokenEOF){throw new Error("Unexpect token after expression.")}return t}var Constants={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Functions(e){function t(t,n,r,i){var a=e(n[0]);if(r){a=r+"("+a+")";if(r.lastIndexOf("new ",0)===0)a="("+a+")"}return a+"."+t+(i<0?"":i===0?"()":"("+n.slice(1).map(e).join(",")+")")}function n(e,n,r){return function(i){return t(e,i,n,r)}}var r="new Date",i="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){if(t.length<3)error("Missing arguments to clamp function.");if(t.length>3)error("Too many arguments to clamp function.");var n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:a,test:n("test",a),if:function(t){if(t.length<3)error("Missing arguments to if function.");if(t.length>3)error("Too many arguments to if function.");var n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function stripQuotes(e){var t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function codegen(e){e=e||{};var t=e.allowed?toSet(e.allowed):{},n=e.forbidden?toSet(e.forbidden):{},r=e.constants||Constants,i=(e.functions||Functions)(c),a=e.globalvar,o=e.fieldvar,s=isFunction(a)?a:function(e){return"".concat(a,'["').concat(e,'"]')};var u={},l={},f=0;function c(e){if(isString(e))return e;var t=d[e.type];if(t==null)error("Unsupported type: "+e.type);return t(e)}var d={Literal:function(e){return e.raw},Identifier:function(e){var i=e.name;if(f>0){return i}else if(has$1(n,i)){return error("Illegal identifier: "+i)}else if(has$1(r,i)){return r[i]}else if(has$1(t,i)){return i}else{u[i]=1;return s(i)}},MemberExpression:function(e){var t=!e.computed,n=c(e.object);if(t)f+=1;var r=c(e.property);if(n===o){l[stripQuotes(r)]=1}if(t)f-=1;return n+(t?"."+r:"["+r+"]")},CallExpression:function(e){if(e.callee.type!=="Identifier"){error("Illegal callee type: "+e.callee.type)}var t=e.callee.name,n=e.arguments,r=has$1(i,t)&&i[t];if(!r)error("Unrecognized function: "+t);return isFunction(r)?r(n):r+"("+n.map(c).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(c).join(",")+"]"},BinaryExpression:function(e){return"("+c(e.left)+" "+e.operator+" "+c(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+c(e.argument)+")"},ConditionalExpression:function(e){return"("+c(e.test)+"?"+c(e.consequent)+":"+c(e.alternate)+")"},LogicalExpression:function(e){return"("+c(e.left)+e.operator+c(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(c).join(",")+"}"},Property:function(e){f+=1;var t=c(e.key);f-=1;return t+":"+c(e.value)}};function p(e){var t={code:c(e),globals:Object.keys(u),fields:Object.keys(l)};u={};l={};return t}p.functions=i;p.constants=r;return p}function ascending(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function bisector(e){var t=e;var n=e;if(e.length===1){t=function(t,n){return e(t)-n};n=ascendingComparator(e)}function r(e,t,r,i){if(r==null)r=0;if(i==null)i=e.length;while(r<i){var a=r+i>>>1;if(n(e[a],t)<0)r=a+1;else i=a}return r}function i(e,t,r,i){if(r==null)r=0;if(i==null)i=e.length;while(r<i){var a=r+i>>>1;if(n(e[a],t)>0)i=a;else r=a+1}return r}function a(e,n,i,a){if(i==null)i=0;if(a==null)a=e.length;var o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o}return{left:r,center:a,right:i}}function ascendingComparator(e){return function(t,n){return ascending(e(t),n)}}var Intersect="intersect";var Union="union";var VlMulti="vlMulti";var VlPoint="vlPoint";var Or="or";var And="and";var SELECTION_ID$1="_vgsid_",TYPE_ENUM="E",TYPE_RANGE_INC="R",TYPE_RANGE_EXC="R-E",TYPE_RANGE_LE="R-LE",TYPE_RANGE_RE="R-RE",UNIT_INDEX="index:unit";function testPoint(e,t){var n=t.fields,r=t.values,i=n.length,a=0,o,s;for(;a<i;++a){s=n[a];s.getter=field$1.getter||field$1(s.field);o=s.getter(e);if(isDate$1(o))o=toNumber(o);if(isDate$1(r[a]))r[a]=toNumber(r[a]);if(isDate$1(r[a][0]))r[a]=r[a].map(toNumber);if(s.type===TYPE_ENUM){if(isArray(r[a])?r[a].indexOf(o)<0:o!==r[a]){return false}}else{if(s.type===TYPE_RANGE_INC){if(!inrange(o,r[a]))return false}else if(s.type===TYPE_RANGE_RE){if(!inrange(o,r[a],true,false))return false}else if(s.type===TYPE_RANGE_EXC){if(!inrange(o,r[a],false,false))return false}else if(s.type===TYPE_RANGE_LE){if(!inrange(o,r[a],false,true))return false}}}return true}function selectionTest(e,t,n){var r=this.context.data[e],i=r?r.values.value:[],a=r?r[UNIT_INDEX]&&r[UNIT_INDEX].value:undefined,o=n===Intersect,s=i.length,u=0,l,f,c,d,p;for(;u<s;++u){l=i[u];if(a&&o){f=f||{};c=f[d=l.unit]||0;if(c===-1)continue;p=testPoint(t,l);f[d]=p?-1:++c;if(p&&a.size===1)return true;if(!p&&c===a.get(d).count)return false}else{p=testPoint(t,l);if(o^p)return p}}return s&&o}var selectionId=field$1(SELECTION_ID$1),bisect=bisector(selectionId),bisectLeft=bisect.left,bisectRight=bisect.right;function selectionIdTest(e,t,n){var r=this.context.data[e],i=r?r.values.value:[],a=r?r[UNIT_INDEX]&&r[UNIT_INDEX].value:undefined,o=n===Intersect,s=selectionId(t),u=bisectLeft(i,s);if(u===i.length)return false;if(selectionId(i[u])!==s)return false;if(a&&o){if(a.size===1)return true;if(bisectRight(i,s)-u<a.size)return false}return true}function selectionTuples(e,t){return e.map((function(e){return extend$1({values:t.fields.map((function(t){return(t.getter||(t.getter=field$1(t.field)))(e.datum)}))},t)}))}function selectionResolve(e,t,n,r){var i,a;var o=this.context.data[e],s=o?o.values.value:[],u={},l={},f={},c,d,p,h,g,m,v,y,_,b=s.length,x=0,E,S;for(;x<b;++x){c=s[x];h=c.unit;d=c.fields;p=c.values;for(E=0,S=d.length;E<S;++E){g=d[E];m=u[g.field]||(u[g.field]={});v=m[h]||(m[h]=[]);f[g.field]=y=g.type.charAt(0);_=ops[y+"_union"];m[h]=_(v,array$5(p[E]))}if(n){v=l[h]||(l[h]=[]);v.push(array$5(p).reduce((function(e,t,n){return e[d[n].field]=t,e}),{}))}}t=t||Union;Object.keys(u).forEach((function(e){u[e]=Object.keys(u[e]).map((function(t){return u[e][t]})).reduce((function(n,r){return n===undefined?r:ops[f[e]+"_"+t](n,r)}))}));s=Object.keys(l);if(n&&s.length){var $=r?VlPoint:VlMulti;u[$]=t===Union?(i={},i[Or]=s.reduce((function(e,t){return e.push.apply(e,l[t]),e}),[]),i):(a={},a[And]=s.map((function(e){var t;return t={},t[Or]=l[e],t})),a)}return u}var ops={E_union:function(e,t){if(!e.length)return t;var n=0,r=t.length;for(;n<r;++n)if(e.indexOf(t[n])<0)e.push(t[n]);return e},E_intersect:function(e,t){return!e.length?t:e.filter((function(e){return t.indexOf(e)>=0}))},R_union:function(e,t){var n=toNumber(t[0]),r=toNumber(t[1]);if(n>r){n=t[1];r=t[0]}if(!e.length)return[n,r];if(e[0]>n)e[0]=n;if(e[1]<r)e[1]=r;return e},R_intersect:function(e,t){var n=toNumber(t[0]),r=toNumber(t[1]);if(n>r){n=t[1];r=t[0]}if(!e.length)return[n,r];if(r<e[0]||e[1]<n){return[]}else{if(e[0]<n)e[0]=n;if(e[1]>r)e[1]=r}return e}};var DataPrefix$1=":",IndexPrefix$1="@";function selectionVisitor(e,t,n,r){if(t[0].type!==Literal)error("First argument to selection functions must be a string literal.");var i=t[0].value,a=t.length>=2&&peek$1(t).value,o="unit",s=IndexPrefix$1+o,u=DataPrefix$1+i;if(a===Intersect&&!has$1(r,s)){r[s]=n.getData(i).indataRef(n,o)}if(!has$1(r,u)){r[u]=n.getData(i).tuplesRef()}}function data$1(e){var t=this.context.data[e];return t?t.values.value:[]}function indata(e,t,n){var r=this.context.data[e]["index:"+t],i=r?r.value.get(n):undefined;return i?i.count:i}function setdata(e,t){var n=this.context.dataflow,r=this.context.data[e],i=r.input;n.pulse(i,n.changeset().remove(truthy).insert(t));return 1}function encode(e,t,n){if(e){var r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==undefined?n:e}var wrap$1=function(e){return function(t,n){var r=this.context.dataflow.locale();return r[e](n)(t)}};var format=wrap$1("format");var timeFormat$1=wrap$1("timeFormat");var utcFormat=wrap$1("utcFormat");var timeParse=wrap$1("timeParse");var utcParse=wrap$1("utcParse");var dateObj=new Date(2e3,0,1);function time(e,t,n){if(!Number.isInteger(e)||!Number.isInteger(t))return"";dateObj.setYear(2e3);dateObj.setMonth(e);dateObj.setDate(t);return timeFormat$1.call(this,dateObj,n)}function monthFormat(e){return time.call(this,e,1,"%B")}function monthAbbrevFormat(e){return time.call(this,e,1,"%b")}function dayFormat(e){return time.call(this,0,2+e,"%A")}function dayAbbrevFormat(e){return time.call(this,0,2+e,"%a")}var DataPrefix=":";var IndexPrefix="@";var ScalePrefix="%";var SignalPrefix="$";function dataVisitor(e,t,n,r){if(t[0].type!==Literal){error("First argument to data functions must be a string literal.")}var i=t[0].value,a=DataPrefix+i;if(!has$1(a,r)){try{r[a]=n.getData(i).tuplesRef()}catch(o){}}}function indataVisitor(e,t,n,r){if(t[0].type!==Literal)error("First argument to indata must be a string literal.");if(t[1].type!==Literal)error("Second argument to indata must be a string literal.");var i=t[0].value,a=t[1].value,o=IndexPrefix+a;if(!has$1(o,r)){r[o]=n.getData(i).indataRef(n,a)}}function scaleVisitor(e,t,n,r){if(t[0].type===Literal){addScaleDependency(n,r,t[0].value)}else{for(e in n.scales){addScaleDependency(n,r,e)}}}function addScaleDependency(e,t,n){var r=ScalePrefix+n;if(!has$1(t,r)){try{t[r]=e.scaleRef(n)}catch(i){}}}function getScale(e,t){var n;return isFunction(e)?e:isString(e)?(n=t.scales[e])&&n.value:undefined}function internalScaleFunctions(e,t,n){t.__bandwidth=function(e){return e&&e.bandwidth?e.bandwidth():0};n._bandwidth=scaleVisitor;n._range=scaleVisitor;n._scale=scaleVisitor;var r=function(t){return"_["+(t.type===Literal?$$1(ScalePrefix+t.value):$$1(ScalePrefix)+"+"+e(t))+"]"};return{_bandwidth:function(e){return"this.__bandwidth(".concat(r(e[0]),")")},_range:function(e){return"".concat(r(e[0]),".range()")},_scale:function(t){return"".concat(r(t[0]),"(").concat(e(t[1]),")")}}}function geoMethod(e,t){return function(n,r,i){if(n){var a=getScale(n,(i||this).context);return a&&a.path[e](r)}else{return t(r)}}}var geoArea=geoMethod("area",geoArea$1);var geoBounds=geoMethod("bounds",geoBounds$1);var geoCentroid=geoMethod("centroid",geoCentroid$1);function inScope(e){var t=this.context.group;var n=false;if(t)while(e){if(e===t){n=true;break}e=e.mark.group}return n}function log(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function warn$1(){return log(this.context.dataflow,"warn",arguments)}function info(){return log(this.context.dataflow,"info",arguments)}function debug$1(){return log(this.context.dataflow,"debug",arguments)}function channel_luminance_value(e){var t=e/255;if(t<=.03928){return t/12.92}return Math.pow((t+.055)/1.055,2.4)}function luminance(e){var t=rgb$1(e),n=channel_luminance_value(t.r),r=channel_luminance_value(t.g),i=channel_luminance_value(t.b);return.2126*n+.7152*r+.0722*i}function contrast(e,t){var n=luminance(e),r=luminance(t),i=Math.max(n,r),a=Math.min(n,r);return(i+.05)/(a+.05)}function merge(){var e=[].slice.call(arguments);e.unshift({});return extend$1.apply(void 0,e)}function equal(e,t){return e===t||e!==e&&t!==t?true:isArray(e)?isArray(t)&&e.length===t.length?equalArray(e,t):false:isObject(e)&&isObject(t)?equalObject(e,t):false}function equalArray(e,t){for(var n=0,r=e.length;n<r;++n){if(!equal(e[n],t[n]))return false}return true}function equalObject(e,t){for(var n in e){if(!equal(e[n],t[n]))return false}return true}function removePredicate(e){return function(t){return equalObject(e,t)}}function modify(e,t,n,r,i,a){var o=this.context.dataflow,s=this.context.data[e],u=s.input,l=o.stamp();var f=s.changes,c,d;if(o._trigger===false||!(u.value.length||t||r)){return 0}if(!f||f.stamp<l){s.changes=f=o.changeset();f.stamp=l;o.runAfter((function(){s.modified=true;o.pulse(u,f).run()}),true,1)}if(n){c=n===true?truthy:isArray(n)||isTuple(n)?n:removePredicate(n);f.remove(c)}if(t){f.insert(t)}if(r){c=removePredicate(r);if(u.value.some(c)){f.remove(c)}else{f.insert(r)}}if(i){for(d in a){f.modify(i,d,a[d])}}return 1}function pinchDistance(e){var t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)}function pinchAngle(e){var t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}var accessors={};function pluck(e,t){var n=accessors[t]||(accessors[t]=field$1(t));return isArray(e)?e.map(n):n(e)}function array(e){return isArray(e)||ArrayBuffer.isView(e)?e:null}function sequence(e){return array(e)||(isString(e)?e:null)}function join(e){var t;var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}return(t=array(e)).join.apply(t,n)}function indexof(e){var t;var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}return(t=sequence(e)).indexOf.apply(t,n)}function lastindexof(e){var t;var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}return(t=sequence(e)).lastIndexOf.apply(t,n)}function slice(e){var t;var n=[];for(var r=1;r<arguments.length;r++){n[r-1]=arguments[r]}return(t=sequence(e)).slice.apply(t,n)}function replace(e,t,n){if(isFunction(n))error("Function argument passed to replace.");return String(e).replace(t,n)}function reverse$1(e){return array(e).slice().reverse()}function bandspace(e,t,n){return bandSpace(e||0,t||0,n||0)}function bandwidth(e,t){var n=getScale(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function copy(e,t){var n=getScale(e,(t||this).context);return n?n.copy():undefined}function domain$2(e,t){var n=getScale(e,(t||this).context);return n?n.domain():[]}function invert(e,t,n){var r=getScale(e,(n||this).context);return!r?undefined:isArray(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t)}function range$2(e,t){var n=getScale(e,(t||this).context);return n&&n.range?n.range():[]}function scale$2(e,t,n){var r=getScale(e,(n||this).context);return r?r(t):undefined}function scaleGradient(e,t,n,r,i){e=getScale(e,(i||this).context);var a=Gradient$1(t,n);var o=e.domain(),s=o[0],u=peek$1(o),l=identity$6;if(!(u-s)){e=(e.interpolator?scale$4("sequential")().interpolator(e.interpolator()):scale$4("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,u=1])}else{l=scaleFraction(e,s,u)}if(e.ticks){o=e.ticks(+r||15);if(s!==o[0])o.unshift(s);if(u!==peek$1(o))o.push(u)}o.forEach((function(t){return a.stop(l(t),e(t))}));return a}function geoShape(e,t,n){var r=getScale(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}function pathShape(e){var t=null;return function(n){return n?pathRender(n,t=t||pathParse(e)):e}}var datum=function(e){return e.data};function treeNodes(e,t){var n=data$1.call(t,e);return n.root&&n.root.lookup||{}}function treePath(e,t,n){var r=treeNodes(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(datum):undefined}function treeAncestors(e,t){var n=treeNodes(e,this)[t];return n?n.ancestors().map(datum):undefined}var _window=function(){return typeof window!=="undefined"&&window||null};function screen(){var e=_window();return e?e.screen:{}}function windowSize(){var e=_window();return e?[e.innerWidth,e.innerHeight]:[undefined,undefined]}function containerSize(){var e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[undefined,undefined]}function intersect(e,t,n){if(!e)return[];var r=e[0],i=e[1],a=(new Bounds).set(r[0],r[1],i[0],i[1]),o=n||this.context.dataflow.scenegraph().root;return intersect$2(o,a,filter(t))}function filter(e){var t=null;if(e){var n=array$5(e.marktype),r=array$5(e.markname);t=function(e){return(!n.length||n.some((function(t){return e.marktype===t})))&&(!r.length||r.some((function(t){return e.name===t})))}}return t}var functionContext={random:function(){return random()},cumulativeNormal:cumulativeNormal,cumulativeLogNormal:cumulativeLogNormal,cumulativeUniform:cumulativeUniform,densityNormal:densityNormal,densityLogNormal:densityLogNormal,densityUniform:densityUniform,quantileNormal:quantileNormal,quantileLogNormal:quantileLogNormal,quantileUniform:quantileUniform,sampleNormal:sampleNormal,sampleLogNormal:sampleLogNormal,sampleUniform:sampleUniform,isArray:isArray,isBoolean:isBoolean$2,isDate:isDate$1,isDefined:function(e){return e!==undefined},isNumber:isNumber$1,isObject:isObject,isRegExp:isRegExp,isString:isString,isTuple:isTuple,isValid:function(e){return e!=null&&e===e},toBoolean:toBoolean,toDate:toDate,toNumber:toNumber,toString:toString,indexof:indexof,join:join,lastindexof:lastindexof,replace:replace,reverse:reverse$1,slice:slice,flush:flush,lerp:lerp,merge:merge,pad:pad$2,peek:peek$1,pluck:pluck,span:span,inrange:inrange,truncate:truncate$1,rgb:rgb$1,lab:lab$1,hcl:hcl$2,hsl:hsl$2,luminance:luminance,contrast:contrast,sequence:range$1$1,format:format,utcFormat:utcFormat,utcParse:utcParse,utcOffset:utcOffset,utcSequence:utcSequence,timeFormat:timeFormat$1,timeParse:timeParse,timeOffset:timeOffset,timeSequence:timeSequence,timeUnitSpecifier:timeUnitSpecifier,monthFormat:monthFormat,monthAbbrevFormat:monthAbbrevFormat,dayFormat:dayFormat,dayAbbrevFormat:dayAbbrevFormat,quarter:quarter,utcquarter:utcquarter,week:week,utcweek:utcweek,dayofyear:dayofyear,utcdayofyear:utcdayofyear,warn:warn$1,info:info,debug:debug$1,extent:extent,inScope:inScope,intersect:intersect,clampRange:clampRange,pinchDistance:pinchDistance,pinchAngle:pinchAngle,screen:screen,containerSize:containerSize,windowSize:windowSize,bandspace:bandspace,setdata:setdata,pathShape:pathShape,panLinear:panLinear,panLog:panLog,panPow:panPow,panSymlog:panSymlog,zoomLinear:zoomLinear,zoomLog:zoomLog,zoomPow:zoomPow,zoomSymlog:zoomSymlog,encode:encode,modify:modify};var eventFunctions=["view","item","group","xy","x","y"],eventPrefix="event.vega.",thisPrefix="this.",astVisitors={};var codegenParams={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_[".concat($$1(SignalPrefix+e),"]")},functions:buildFunctions,constants:Constants,visitors:astVisitors};var codeGenerator=codegen(codegenParams);function buildFunctions(e){var t=Functions(e);eventFunctions.forEach((function(e){return t[e]=eventPrefix+e}));for(var n in functionContext){t[n]=thisPrefix+n}extend$1(t,internalScaleFunctions(e,functionContext,astVisitors));return t}function expressionFunction(e,t,n){if(arguments.length===1){return functionContext[e]}functionContext[e]=t;if(n)astVisitors[e]=n;if(codeGenerator)codeGenerator.functions[e]=thisPrefix+e;return this}expressionFunction("bandwidth",bandwidth,scaleVisitor);expressionFunction("copy",copy,scaleVisitor);expressionFunction("domain",domain$2,scaleVisitor);expressionFunction("range",range$2,scaleVisitor);expressionFunction("invert",invert,scaleVisitor);expressionFunction("scale",scale$2,scaleVisitor);expressionFunction("gradient",scaleGradient,scaleVisitor);expressionFunction("geoArea",geoArea,scaleVisitor);expressionFunction("geoBounds",geoBounds,scaleVisitor);expressionFunction("geoCentroid",geoCentroid,scaleVisitor);expressionFunction("geoShape",geoShape,scaleVisitor);expressionFunction("indata",indata,indataVisitor);expressionFunction("data",data$1,dataVisitor);expressionFunction("treePath",treePath,dataVisitor);expressionFunction("treeAncestors",treeAncestors,dataVisitor);expressionFunction("vlSelectionTest",selectionTest,selectionVisitor);expressionFunction("vlSelectionIdTest",selectionIdTest,selectionVisitor);expressionFunction("vlSelectionResolve",selectionResolve,selectionVisitor);expressionFunction("vlSelectionTuples",selectionTuples);function parser(e,t){var n={};var r;try{e=isString(e)?e:$$1(e)+"";r=parser$1(e)}catch(a){error("Expression parse error: "+e)}r.visit((function(e){if(e.type!==CallExpression)return;var r=e.callee.name,i=codegenParams.visitors[r];if(i)i(r,e.arguments,t,n)}));var i=codeGenerator(r);i.globals.forEach((function(e){var r=SignalPrefix+e;if(!has$1(n,r)&&t.getSignal(e)){n[r]=t.signalRef(e)}}));return{$expr:extend$1({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}function parse$2(e){var t=this,n=e.operators||[];if(e.background){t.background=e.background}if(e.eventConfig){t.eventConfig=e.eventConfig}if(e.locale){t.locale=e.locale}n.forEach((function(e){return t.parseOperator(e)}));n.forEach((function(e){return t.parseOperatorParameters(e)}));(e.streams||[]).forEach((function(e){return t.parseStream(e)}));(e.updates||[]).forEach((function(e){return t.parseUpdate(e)}));return t.resolve()}var Skip$2=toSet(["rule"]),Swap=toSet(["group","image","rect"]);function adjustSpatial(e,t){var n="";if(Skip$2[t])return n;if(e.x2){if(e.x){if(Swap[t]){n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"}n+="o.width=o.x2-o.x;"}else{n+="o.x=o.x2-(o.width||0);"}}if(e.xc){n+="o.x=o.xc-(o.width||0)/2;"}if(e.y2){if(e.y){if(Swap[t]){n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"}n+="o.height=o.y2-o.y;"}else{n+="o.y=o.y2-(o.height||0);"}}if(e.yc){n+="o.y=o.yc-(o.height||0)/2;"}return n}function canonicalType(e){return(e+"").toLowerCase()}function isOperator(e){return canonicalType(e)==="operator"}function isCollect(e){return canonicalType(e)==="collect"}function expression$1(e,t,n){if(n[n.length-1]!==";"){n="return("+n+");"}var r=Function.apply(void 0,t.concat(n));return e&&e.functions?r.bind(e.functions):r}function _compare(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}var expressionCodegen={operator:function(e,t){return expression$1(e,["_"],t.code)},parameter:function(e,t){return expression$1(e,["datum","_"],t.code)},event:function(e,t){return expression$1(e,["event"],t.code)},handler:function(e,t){var n="var datum=event.item&&event.item.datum;return ".concat(t.code,";");return expression$1(e,["_","event"],n)},encode:function(e,t){var n=t.marktype,r=t.channels;var i="var o=item,datum=o.datum,m=0,$;";for(var a in r){var o="o["+$$1(a)+"]";i+="$=".concat(r[a].code,";if(").concat(o,"!==$)").concat(o,"=$,m=1;")}i+=adjustSpatial(r,n);i+="return m;";return expression$1(e,["item","_"],i)},codegen:{get:function(e){var t="[".concat(e.map($$1).join("]["),"]");var n=Function("_","return _".concat(t,";"));n.path=t;return n},comparator:function(e,t){var n;var r=function(e,r){var i=t[r];var a,o;if(e.path){a="a".concat(e.path);o="b".concat(e.path)}else{(n=n||{})["f"+r]=e;a="this.f".concat(r,"(a)");o="this.f".concat(r,"(b)")}return _compare(a,o,-i,i)};var i=Function("a","b","var u, v; return "+e.map(r).join("")+"0;");return n?i.bind(n):i}}};function parseOperator(e){var t=this;if(isOperator(e.type)||!e.type){t.operator(e,e.update?t.operatorExpression(e.update):null)}else{t.transform(e,e.type)}}function parseOperatorParameters(e){var t=this;if(e.params){var n=t.get(e.id);if(!n)error("Invalid operator id: "+e.id);t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function parseParameters$1(e,t){t=t||{};var n=this;for(var r in e){var i=e[r];t[r]=isArray(i)?i.map((function(e){return parseParameter$2(e,n,t)})):parseParameter$2(i,n,t)}return t}function parseParameter$2(e,t,n){if(!e||!isObject(e))return e;for(var r=0,i=PARSERS.length,a=void 0;r<i;++r){a=PARSERS[r];if(has$1(e,a.key)){return a.parse(e,t,n)}}return e}var PARSERS=[{key:"$ref",parse:getOperator},{key:"$key",parse:getKey},{key:"$expr",parse:getExpression},{key:"$field",parse:getField},{key:"$encode",parse:getEncode},{key:"$compare",parse:getCompare},{key:"$context",parse:getContext},{key:"$subflow",parse:getSubflow},{key:"$tupleid",parse:getTupleId}];function getOperator(e,t){return t.get(e.$ref)||error("Operator not defined: "+e.$ref)}function getExpression(e,t,n){if(e.$params){t.parseParameters(e.$params,n)}var r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=accessor(t.parameterExpression(e.$expr),e.$fields,e.$name))}function getKey(e,t){var n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=key(e.$key,e.$flat,t.expr.codegen))}function getField(e,t){if(!e.$field)return null;var n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=field$1(e.$field,e.$name,t.expr.codegen))}function getCompare(e,t){var n="c:"+e.$compare+"_"+e.$order,r=array$5(e.$compare).map((function(e){return e&&e.$tupleid?tupleid:e}));return t.fn[n]||(t.fn[n]=compare$1(r,e.$order,t.expr.codegen))}function getEncode(e,t){var n=e.$encode,r={};for(var i in n){var a=n[i];r[i]=accessor(t.encodeExpression(a.$expr),a.$fields);r[i].output=a.$output}return r}function getContext(e,t){return t}function getSubflow(e,t){var n=e.$subflow;return function(e,r,i){var a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;if(s)s.set(i);o.detachSubflow=function(){return t.detach(a)};return o}}function getTupleId(){return tupleid}function parseStream$2(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):undefined,r=e.stream!=null?t.get(e.stream):undefined,i;if(e.source){r=t.events(e.source,e.type,n)}else if(e.merge){i=e.merge.map((function(e){return t.get(e)}));r=i[0].merge.apply(i[0],i.slice(1))}if(e.between){i=e.between.map((function(e){return t.get(e)}));r=r.between(i[0],i[1])}if(e.filter){r=r.filter(n)}if(e.throttle!=null){r=r.throttle(+e.throttle)}if(e.debounce!=null){r=r.debounce(+e.debounce)}if(r==null){error("Invalid stream definition: "+JSON.stringify(e))}if(e.consume)r.consume(true);t.stream(e,r)}function parseUpdate$1(e){var t=this,n=isObject(n=e.source)?n.$ref:n,r=t.get(n),i=null,a=e.update,o=undefined;if(!r)error("Source not defined: "+e.source);i=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target);if(a&&a.$expr){if(a.$params){o=t.parseParameters(a.$params)}a=t.handlerExpression(a.$expr)}t.update(e,r,i,a,o)}var SKIP={skip:true};function getState$1(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((function(n){var i=t.signals[n];if(e.signals(n,i)){r[n]=i.value}}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((function(n){var r=t.data[n];if(e.data(n,r)){i[n]=r.input.value}}))}if(t.subcontext&&e.recurse!==false){n.subcontext=t.subcontext.map((function(t){return t.getState(e)}))}return n}function setState$1(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((function(e){n.update(t.signals[e],i[e],SKIP)}));Object.keys(r||{}).forEach((function(e){n.pulse(t.data[e].input,n.changeset().remove(truthy).insert(r[e]))}));(e.subcontext||[]).forEach((function(e,n){var r=t.subcontext[n];if(r)r.setState(e)}))}function context(e,t,n,r){return new Context$1(e,t,n,r)}function Context$1(e,t,n,r){this.dataflow=e;this.transforms=t;this.events=e.events.bind(e);this.expr=r||expressionCodegen,this.signals={};this.scales={};this.nodes={};this.data={};this.fn={};if(n){this.functions=Object.create(n);this.functions.context=this}}function Subcontext(e){this.dataflow=e.dataflow;this.transforms=e.transforms;this.events=e.events;this.expr=e.expr;this.signals=Object.create(e.signals);this.scales=Object.create(e.scales);this.nodes=Object.create(e.nodes);this.data=Object.create(e.data);this.fn=Object.create(e.fn);if(e.functions){this.functions=Object.create(e.functions);this.functions.context=this}}Context$1.prototype=Subcontext.prototype={fork:function(){var e=new Subcontext(this);(this.subcontext||(this.subcontext=[])).push(e);return e},detach:function(e){this.subcontext=this.subcontext.filter((function(t){return t!==e}));var t=Object.keys(e.nodes);for(var n=0,r=t;n<r.length;n++){var i=r[n];e.nodes[i]._targets=null}for(var a=0,o=t;a<o.length;a++){var s=o[a];e.nodes[s].detach()}e.nodes=null},get:function(e){return this.nodes[e]},set:function(e,t){return this.nodes[e]=t},add:function(e,t){var n=this,r=n.dataflow,i=e.value;n.set(e.id,t);if(isCollect(e.type)&&i){if(i.$ingest){r.ingest(t,i.$ingest,i.$format)}else if(i.$request){r.preload(t,i.$request,i.$format)}else{r.pulse(t,r.changeset().insert(i))}}if(e.root){n.root=t}if(e.parent){var a=n.get(e.parent.$ref);if(a){r.connect(a,[t]);t.targets().add(a)}else{(n.unresolved=n.unresolved||[]).push((function(){a=n.get(e.parent.$ref);r.connect(a,[t]);t.targets().add(a)}))}}if(e.signal){n.signals[e.signal]=t}if(e.scale){n.scales[e.scale]=t}if(e.data){var o=function(r){var i=n.data[r]||(n.data[r]={});e.data[r].forEach((function(e){return i[e]=t}))};for(var s in e.data){o(s)}}},resolve:function(){(this.unresolved||[]).forEach((function(e){return e()}));delete this.unresolved;return this},operator:function(e,t){this.add(e,this.dataflow.add(e.value,t))},transform:function(e,t){this.add(e,this.dataflow.add(this.transforms[canonicalType(t)]))},stream:function(e,t){this.set(e.id,t)},update:function(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression:function(e){return this.expr.operator(this,e)},parameterExpression:function(e){return this.expr.parameter(this,e)},eventExpression:function(e){return this.expr.event(this,e)},handlerExpression:function(e){return this.expr.handler(this,e)},encodeExpression:function(e){return this.expr.encode(this,e)},parse:parse$2,parseOperator:parseOperator,parseOperatorParameters:parseOperatorParameters,parseParameters:parseParameters$1,parseStream:parseStream$2,parseUpdate:parseUpdate$1,getState:getState$1,setState:setState$1};function initializeAria(e){var t=e.container();if(t){t.setAttribute("role","graphics-document");t.setAttribute("aria-roleDescription","visualization");ariaLabel(t,e.description())}}function ariaLabel(e,t){if(e)t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t)}function background(e){e.add(null,(function(t){e._background=t.bg;e._resize=1;return t.bg}),{bg:e._signals.background})}var Default="default";function cursor$1(e){var t=e._signals.cursor||(e._signals.cursor=e.add({user:Default,item:null}));e.on(e.events("view","mousemove"),t,(function(e,n){var r=t.value,i=r?isString(r)?r:r.user:Default,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}}));e.add(null,(function(t){var n=t.cursor,r=this.value;if(!isString(n)){r=n.item;n=n.user}setCursor(e,n&&n!==Default?n:r||n);return r}),{cursor:t})}function setCursor(e,t){var n=e.globalCursor()?typeof document!=="undefined"&&document.body:e.container();if(n){return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}}function dataref(e,t){var n=e._runtime.data;if(!has$1(n,t)){error("Unrecognized data set: "+t)}return n[t]}function data(e,t){return arguments.length<2?dataref(this,e).values.value:change.call(this,e,changeset().remove(truthy).insert(t))}function change(e,t){if(!isChangeSet(t)){error("Second argument to changes must be a changeset.")}var n=dataref(this,e);n.modified=true;return this.pulse(n.input,t)}function insert(e,t){return change.call(this,e,changeset().insert(t))}function remove(e,t){return change.call(this,e,changeset().remove(t))}function width(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function height(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function offset(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function resizeRenderer(e){var t=offset(e),n=width(e),r=height(e);e._renderer.background(e.background());e._renderer.resize(n,r,t);e._handler.origin(t);e._resizeListeners.forEach((function(t){try{t(n,r)}catch(error){e.error(error)}}))}function eventExtend(e,t,n){var r=e._renderer,i=r&&r.canvas(),a,o,s;if(i){s=offset(e);o=t.changedTouches?t.changedTouches[0]:t;a=point$2(o,i);a[0]-=s[0];a[1]-=s[1]}t.dataflow=e;t.item=n;t.vega=extension(e,n,a);return t}function extension(e,t,n){var r=t?t.mark.marktype==="group"?t:t.mark.group:null;function i(e){var n=r,i;if(e)for(i=t;i;i=i.mark.group){if(i.mark.name===e){n=i;break}}return n&&n.mark&&n.mark.interactive?n:{}}function a(e){if(!e)return n;if(isString(e))e=i(e);var t=n.slice();while(e){t[0]-=e.x||0;t[1]-=e.y||0;e=e.mark&&e.mark.group}return t}return{view:constant$4(e),item:constant$4(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}var VIEW$1="view",TIMER="timer",WINDOW="window",NO_TRAP={trap:false};function initializeEventConfig(e){var t=extend$1({defaults:{}},e);var n=function(e,t){t.forEach((function(t){if(isArray(e[t]))e[t]=toSet(e[t])}))};n(t.defaults,["prevent","allow"]);n(t,["view","window","selector"]);return t}function trackEventListener(e,t,n,r){e._eventListeners.push({type:n,sources:array$5(t),handler:r})}function prevent(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return r===false||i===true?false:r===true||i===false?true:r?r[t]:i?!i[t]:e.preventDefault()}function permit(e,t,n){var r=e._eventConfig&&e._eventConfig[t];if(r===false||isObject(r)&&!r[n]){e.warn("Blocked "+t+" "+n+" event listener.");return false}return true}function events$1(e,t,n){var r=this,i=new EventStream(n),a=function(n,a){r.runAsync(null,(function(){if(e===VIEW$1&&prevent(r,t)){n.preventDefault()}i.receive(eventExtend(r,n,a))}))},o;if(e===TIMER){if(permit(r,"timer",t)){r.timer(a,t)}}else if(e===VIEW$1){if(permit(r,"view",t)){r.addEventListener(t,a,NO_TRAP)}}else{if(e===WINDOW){if(permit(r,"window",t)&&typeof window!=="undefined"){o=[window]}}else if(typeof document!=="undefined"){if(permit(r,"selector",t)){o=document.querySelectorAll(e)}}if(!o){r.warn("Can not resolve event source: "+e)}else{for(var s=0,u=o.length;s<u;++s){o[s].addEventListener(t,a)}trackEventListener(r,o,t,a)}}return i}function itemFilter(e){return e.item}function markTarget(e){return e.item.mark.source}function invoke(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function hover(e,t){e=[e||"hover"];t=[t||"update",e[0]];this.on(this.events("view","mouseover",itemFilter),markTarget,invoke(e));this.on(this.events("view","mouseout",itemFilter),markTarget,invoke(t));return this}function finalize(){var e=this._tooltip,t=this._timers,n=this._eventListeners,r,i,a;r=t.length;while(--r>=0){t[r].stop()}r=n.length;while(--r>=0){a=n[r];i=a.sources.length;while(--i>=0){a.sources[i].removeEventListener(a.type,a.handler)}}if(e){e.call(this,this._handler,null,null,null)}return this}function element(e,t,n){var r=document.createElement(e);for(var i in t)r.setAttribute(i,t[i]);if(n!=null)r.textContent=n;return r}var BindClass="vega-bind",NameClass="vega-bind-name",RadioClass="vega-bind-radio";function bind(e,t,n){if(!t)return;var r=n.param;var i=n.state;if(!i){i=n.state={elements:null,active:false,set:null,update:function(t){if(t!=e.signal(r.signal)){e.runAsync(null,(function(){i.source=true;e.signal(r.signal,t)}))}}};if(r.debounce){i.update=debounce(r.debounce,i.update)}}var a=r.input==null&&r.element?target:generate;a(i,t,r,e);if(!i.active){e.on(e._signals[r.signal],null,(function(){i.source?i.source=false:i.set(e.signal(r.signal))}));i.active=true}return i}function target(e,t,n,r){var i=n.event||"input";var a=function(){return e.update(t.value)};r.signal(n.signal,t.value);t.addEventListener(i,a);trackEventListener(r,t,i,a);e.set=function(e){t.value=e;t.dispatchEvent(event(i))}}function event(e){return typeof Event!=="undefined"?new Event(e):{type:e}}function generate(e,t,n,r){var i=r.signal(n.signal);var a=element("div",{class:BindClass});var o=n.input==="radio"?a:a.appendChild(element("label"));o.appendChild(element("span",{class:NameClass},n.name||n.signal));t.appendChild(a);var s=form;switch(n.input){case"checkbox":s=checkbox;break;case"select":s=select;break;case"radio":s=radio;break;case"range":s=range$1;break}s(e,o,n,i)}function form(e,t,n,r){var i=element("input");for(var a in n){if(a!=="signal"&&a!=="element"){i.setAttribute(a==="input"?"type":a,n[a])}}i.setAttribute("name",n.signal);i.value=r;t.appendChild(i);i.addEventListener("input",(function(){return e.update(i.value)}));e.elements=[i];e.set=function(e){return i.value=e}}function checkbox(e,t,n,r){var i={type:"checkbox",name:n.signal};if(r)i.checked=true;var a=element("input",i);t.appendChild(a);a.addEventListener("change",(function(){return e.update(a.checked)}));e.elements=[a];e.set=function(e){return a.checked=!!e||null}}function select(e,t,n,r){var i=element("select",{name:n.signal}),a=n.labels||[];n.options.forEach((function(e,t){var n={value:e};if(valuesEqual(e,r))n.selected=true;i.appendChild(element("option",n,(a[t]||e)+""))}));t.appendChild(i);i.addEventListener("change",(function(){e.update(n.options[i.selectedIndex])}));e.elements=[i];e.set=function(e){for(var t=0,r=n.options.length;t<r;++t){if(valuesEqual(n.options[t],e)){i.selectedIndex=t;return}}}}function radio(e,t,n,r){var i=element("span",{class:RadioClass}),a=n.labels||[];t.appendChild(i);e.elements=n.options.map((function(t,o){var s={type:"radio",name:n.signal,value:t};if(valuesEqual(t,r))s.checked=true;var u=element("input",s);u.addEventListener("change",(function(){return e.update(t)}));var l=element("label",{},(a[o]||t)+"");l.prepend(u);i.appendChild(l);return u}));e.set=function(t){var n=e.elements,r=n.length;for(var i=0;i<r;++i){if(valuesEqual(n[i].value,t))n[i].checked=true}}}function range$1(e,t,n,r){r=r!==undefined?r:(+n.max+ +n.min)/2;var i=n.max!=null?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||tickStep(a,i,100);var s=element("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;var u=element("span",{},+r);t.appendChild(s);t.appendChild(u);var l=function(){u.textContent=s.value;e.update(+s.value)};s.addEventListener("input",l);s.addEventListener("change",l);e.elements=[s];e.set=function(e){s.value=e;u.textContent=e}}function valuesEqual(e,t){return e===t||e+""===t+""}function initializeRenderer(e,t,n,r,i,a){t=t||new r(e.loader());return t.initialize(n,width(e),height(e),offset(e),i,a).background(e.background())}function trap(e,t){return!t?null:function(){try{t.apply(this,arguments)}catch(error){e.error(error)}}}function initializeHandler(e,t,n,r){var i=new r(e.loader(),trap(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,offset(e),e);if(t){t.handlers().forEach((function(e){i.on(e.type,e.handler)}))}return i}function initialize(e,t){var n=this,r=n._renderType,i=n._eventConfig.bind,a=renderModule(r);e=n._el=e?lookup$1(n,e,true):null;initializeAria(n);if(!a)n.error("Unrecognized renderer type: "+r);var o=a.handler||CanvasHandler,s=e?a.renderer:a.headless;n._renderer=!s?null:initializeRenderer(n,n._renderer,e,s);n._handler=initializeHandler(n,n._handler,e,o);n._redraw=true;if(e&&i!=="none"){t=t?n._elBind=lookup$1(n,t,true):e.appendChild(element("form",{class:"vega-bindings"}));n._bind.forEach((function(e){if(e.param.element&&i!=="container"){e.element=lookup$1(n,e.param.element,!!e.param.input)}}));n._bind.forEach((function(e){bind(n,e.element||t,e)}))}return n}function lookup$1(t,n,r){if(typeof n==="string"){if(typeof document!=="undefined"){n=document.querySelector(n);if(!n){t.error("Signal bind element not found: "+n);return null}}else{t.error("DOM document instance not found.");return null}}if(n&&r){try{n.innerHTML=""}catch(e){n=null;t.error(e)}}return n}var number$1=function(e){return+e||0};var paddingObject$1=function(e){return{top:e,bottom:e,left:e,right:e}};function padding$1(e){return isObject(e)?{top:number$1(e.top),bottom:number$1(e.bottom),left:number$1(e.left),right:number$1(e.right)}:paddingObject$1(number$1(e))}function renderHeadless(e,t,n,r){return __awaiter(this,void 0,void 0,(function(){var i,a;return __generator(this,(function(o){switch(o.label){case 0:i=renderModule(t),a=i&&i.headless;if(!a)error("Unrecognized renderer type: "+t);return[4,e.runAsync()];case 1:o.sent();return[2,initializeRenderer(e,null,null,a,n,r).renderAsync(e._scenegraph.root)]}}))}))}function renderToImageURL(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:if(e!==RenderType.Canvas&&e!==RenderType.SVG&&e!==RenderType.PNG){error("Unrecognized image type: "+e)}return[4,renderHeadless(this,e,t)];case 1:n=r.sent();return[2,e===RenderType.SVG?toBlobURL(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")]}}))}))}function toBlobURL(e,t){var n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}function renderToCanvas(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return[4,renderHeadless(this,RenderType.Canvas,e,t)];case 1:n=r.sent();return[2,n.canvas()]}}))}))}function renderToSVG(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,renderHeadless(this,RenderType.SVG,e)];case 1:t=n.sent();return[2,t.svg()]}}))}))}function runtime(e,t,n){return context(e,transforms,functionContext,n).parse(t)}function scale$1(e){var t=this._runtime.scales;if(!has$1(t,e)){error("Unrecognized scale or projection: "+e)}return t[e].value}var Width="width",Height="height",Padding="padding",Skip$1={skip:true};function viewWidth(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===Padding?r.left+r.right:0)}function viewHeight(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===Padding?r.top+r.bottom:0)}function initializeResize(e){var t=e._signals,n=t[Width],r=t[Height],i=t[Padding];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(function(t){e._width=t.size;e._viewWidth=viewWidth(e,t.size);a()}),{size:n});e._resizeHeight=e.add(null,(function(t){e._height=t.size;e._viewHeight=viewHeight(e,t.size);a()}),{size:r});var o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1;e._resizeHeight.rank=r.rank+1;o.rank=i.rank+1}function resizeView(e,t,n,r,i,a){this.runAfter((function(o){var s=0;o._autosize=0;if(o.width()!==n){s=1;o.signal(Width,n,Skip$1);o._resizeWidth.skip(true)}if(o.height()!==r){s=1;o.signal(Height,r,Skip$1);o._resizeHeight.skip(true)}if(o._viewWidth!==e){o._resize=1;o._viewWidth=e}if(o._viewHeight!==t){o._resize=1;o._viewHeight=t}if(o._origin[0]!==i[0]||o._origin[1]!==i[1]){o._resize=1;o._origin=i}if(s)o.run("enter");if(a)o.runAfter((function(e){return e.resize()}))}),false,1)}function getState(e){return this._runtime.getState(e||{data:dataTest,signals:signalTest,recurse:true})}function dataTest(e,t){return t.modified&&isArray(t.input.value)&&e.indexOf("_:vega:_")}function signalTest(e,t){return!(e==="parent"||t instanceof transforms.proxy)}function setState(e){this.runAsync(null,(function(t){t._trigger=false;t._runtime.setState(e)}),(function(e){e._trigger=true}));return this}function timer(e,t){function n(t){e({timestamp:Date.now(),elapsed:t})}this._timers.push(interval$1(n,t))}function defaultTooltip(e,t,n,r){var i=e.element();if(i)i.setAttribute("title",formatTooltip(r))}function formatTooltip(e){return e==null?"":isArray(e)?formatArray(e):isObject(e)&&!isDate$1(e)?formatObject(e):e+""}function formatObject(e){return Object.keys(e).map((function(t){var n=e[t];return t+": "+(isArray(n)?formatArray(n):formatValue$1(n))})).join("\n")}function formatArray(e){return"["+e.map(formatValue$1).join(", ")+"]"}function formatValue$1(e){return isArray(e)?"[…]":isObject(e)&&!isDate$1(e)?"{…}":e}function View$1(e,t){var n=this;t=t||{};Dataflow.call(n);if(t.loader)n.loader(t.loader);if(t.logger)n.logger(t.logger);if(t.logLevel!=null)n.logLevel(t.logLevel);if(t.locale||e.locale){var r=extend$1({},e.locale,t.locale);n.locale(locale(r.number,r.time))}n._el=null;n._elBind=null;n._renderType=t.renderer||RenderType.Canvas;n._scenegraph=new Scenegraph;var i=n._scenegraph.root;n._renderer=null;n._tooltip=t.tooltip||defaultTooltip,n._redraw=true;n._handler=(new CanvasHandler).scene(i);n._globalCursor=false;n._preventDefault=false;n._timers=[];n._eventListeners=[];n._resizeListeners=[];n._eventConfig=initializeEventConfig(e.eventConfig);n.globalCursor(n._eventConfig.globalCursor);var a=runtime(n,e,t.expr);n._runtime=a;n._signals=a.signals;n._bind=(e.bindings||[]).map((function(e){return{state:null,param:extend$1({},e)}}));if(a.root)a.root.set(i);i.source=a.data.root.input;n.pulse(a.data.root.input,n.changeset().insert(i.items));n._width=n.width();n._height=n.height();n._viewWidth=viewWidth(n,n._width);n._viewHeight=viewHeight(n,n._height);n._origin=[0,0];n._resize=0;n._autosize=1;initializeResize(n);background(n);cursor$1(n);n.description(e.description);if(t.hover)n.hover();if(t.container)n.initialize(t.container,t.bind)}function lookupSignal(e,t){return has$1(e._signals,t)?e._signals[t]:error("Unrecognized signal name: "+$$1(t))}function findOperatorHandler(e,t){var n=(e._targets||[]).filter((function(e){return e._update&&e._update.handler===t}));return n.length?n[0]:null}function addOperatorListener(e,t,n,r){var i=findOperatorHandler(n,r);if(!i){i=trap(e,(function(){return r(t,n.value)}));i.handler=r;e.on(n,null,i)}return e}function removeOperatorListener(e,t,n){var r=findOperatorHandler(t,n);if(r)t._targets.remove(r);return e}inherits(View$1,Dataflow,{evaluate:function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(i){switch(i.label){case 0:return[4,Dataflow.prototype.evaluate.call(this,e,t)];case 1:i.sent();if(!(this._redraw||this._resize))return[3,6];i.label=2;case 2:i.trys.push([2,5,,6]);if(!this._renderer)return[3,4];if(this._resize){this._resize=0;resizeRenderer(this)}return[4,this._renderer.renderAsync(this._scenegraph.root)];case 3:i.sent();i.label=4;case 4:this._redraw=false;return[3,6];case 5:r=i.sent();this.error(r);return[3,6];case 6:if(n)asyncCallback(this,n);return[2,this]}}))}))},dirty:function(e){this._redraw=true;this._renderer&&this._renderer.dirty(e)},description:function(e){if(arguments.length){var t=e!=null?e+"":null;if(t!==this._desc)ariaLabel(this._el,this._desc=t);return this}return this._desc},container:function(){return this._el},scenegraph:function(){return this._scenegraph},origin:function(){return this._origin.slice()},signal:function(e,t,n){var r=lookupSignal(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width:function(e){return arguments.length?this.signal("width",e):this.signal("width")},height:function(e){return arguments.length?this.signal("height",e):this.signal("height")},padding:function(e){return arguments.length?this.signal("padding",padding$1(e)):padding$1(this.signal("padding"))},autosize:function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background:function(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer:function(e){if(!arguments.length)return this._renderType;if(!renderModule(e))error("Unrecognized renderer type: "+e);if(e!==this._renderType){this._renderType=e;this._resetRenderer()}return this},tooltip:function(e){if(!arguments.length)return this._tooltip;if(e!==this._tooltip){this._tooltip=e;this._resetRenderer()}return this},loader:function(e){if(!arguments.length)return this._loader;if(e!==this._loader){Dataflow.prototype.loader.call(this,e);this._resetRenderer()}return this},resize:function(){this._autosize=1;return this.touch(lookupSignal(this,"autosize"))},_resetRenderer:function(){if(this._renderer){this._renderer=null;this.initialize(this._el,this._elBind)}},_resizeView:resizeView,addEventListener:function(e,t,n){var r=t;if(!(n&&n.trap===false)){r=trap(this,t);r.raw=t}this._handler.on(e,r);return this},removeEventListener:function(e,t){var n=this._handler.handlers(e),r=n.length,i,a;while(--r>=0){a=n[r].type;i=n[r].handler;if(e===a&&(t===i||t===i.raw)){this._handler.off(a,i);break}}return this},addResizeListener:function(e){var t=this._resizeListeners;if(t.indexOf(e)<0){t.push(e)}return this},removeResizeListener:function(e){var t=this._resizeListeners,n=t.indexOf(e);if(n>=0){t.splice(n,1)}return this},addSignalListener:function(e,t){return addOperatorListener(this,e,lookupSignal(this,e),t)},removeSignalListener:function(e,t){return removeOperatorListener(this,lookupSignal(this,e),t)},addDataListener:function(e,t){return addOperatorListener(this,e,dataref(this,e).values,t)},removeDataListener:function(e,t){return removeOperatorListener(this,dataref(this,e).values,t)},globalCursor:function(e){if(arguments.length){if(this._globalCursor!==!!e){var t=setCursor(this,null);this._globalCursor=!!e;if(t)setCursor(this,t)}return this}else{return this._globalCursor}},preventDefault:function(e){if(arguments.length){this._preventDefault=e;return this}else{return this._preventDefault}},timer:timer,events:events$1,finalize:finalize,hover:hover,data:data,change:change,insert:insert,remove:remove,scale:scale$1,initialize:initialize,toImageURL:renderToImageURL,toCanvas:renderToCanvas,toSVG:renderToSVG,getState:getState,setState:setState});var VIEW="view",LBRACK="[",RBRACK="]",LBRACE="{",RBRACE="}",COLON=":",COMMA=",",NAME="@",GT=">",ILLEGAL=/[[\]{}]/,DEFAULT_MARKS={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};var DEFAULT_SOURCE,MARKS;function eventSelector(e,t,n){DEFAULT_SOURCE=t||VIEW;MARKS=n||DEFAULT_MARKS;return parseMerge(e.trim()).map(parseSelector)}function isMarkType(e){return MARKS[e]}function find(e,t,n,r,i){var a=e.length;var o=0,s;for(;t<a;++t){s=e[t];if(!o&&s===n)return t;else if(i&&i.indexOf(s)>=0)--o;else if(r&&r.indexOf(s)>=0)++o}return t}function parseMerge(e){var t=[],n=e.length;var r=0,i=0;while(i<n){i=find(e,i,COMMA,LBRACK+LBRACE,RBRACK+RBRACE);t.push(e.substring(r,i).trim());r=++i}if(t.length===0){throw"Empty event selector: "+e}return t}function parseSelector(e){return e[0]==="["?parseBetween(e):parseStream$1(e)}function parseBetween(e){var t=e.length;var n=1,r;n=find(e,n,RBRACK,LBRACK,RBRACK);if(n===t){throw"Empty between selector: "+e}r=parseMerge(e.substring(1,n));if(r.length!==2){throw"Between selector must have two elements: "+e}e=e.slice(n+1).trim();if(e[0]!==GT){throw"Expected '>' after between selector: "+e}r=r.map(parseSelector);var i=parseSelector(e.slice(1).trim());if(i.between){return{between:r,stream:i}}else{i.between=r}return i}function parseStream$1(t){var n={source:DEFAULT_SOURCE},r=[];var i=[0,0],a=0,o=0,s=t.length,u=0,l,f;if(t[s-1]===RBRACE){u=t.lastIndexOf(LBRACE);if(u>=0){try{i=parseThrottle(t.substring(u+1,s-1))}catch(e){throw"Invalid throttle specification: "+t}t=t.slice(0,u).trim();s=t.length}else throw"Unmatched right brace: "+t;u=0}if(!s)throw t;if(t[0]===NAME)a=++u;l=find(t,u,COLON);if(l<s){r.push(t.substring(o,l).trim());o=u=++l}u=find(t,u,LBRACK);if(u===s){r.push(t.substring(o,s).trim())}else{r.push(t.substring(o,u).trim());f=[];o=++u;if(o===s)throw"Unmatched left bracket: "+t}while(u<s){u=find(t,u,RBRACK);if(u===s)throw"Unmatched left bracket: "+t;f.push(t.substring(o,u).trim());if(u<s-1&&t[++u]!==LBRACK)throw"Expected left bracket: "+t;o=++u}if(!(s=r.length)||ILLEGAL.test(r[s-1])){throw"Invalid event selector: "+t}if(s>1){n.type=r[1];if(a){n.markname=r[0].slice(1)}else if(isMarkType(r[0])){n.marktype=r[0]}else{n.source=r[0]}}else{n.type=r[0]}if(n.type.slice(-1)==="!"){n.consume=true;n.type=n.type.slice(0,-1)}if(f!=null)n.filter=f;if(i[0])n.throttle=i[0];if(i[1])n.debounce=i[1];return n}function parseThrottle(e){var t=e.split(COMMA);if(!e.length||t.length>2)throw e;return t.map((function(t){var n=+t;if(n!==n)throw e;return n}))}function parseAutosize(e){return isObject(e)?e:{type:e||"pad"}}var number=function(e){return+e||0};var paddingObject=function(e){return{top:e,bottom:e,left:e,right:e}};function parsePadding(e){return!isObject(e)?paddingObject(number(e)):e.signal?e:{top:number(e.top),bottom:number(e.bottom),left:number(e.left),right:number(e.right)}}var encoder=function(e){return isObject(e)&&!isArray(e)?extend$1({},e):{value:e}};function addEncode(e,t,n,r){if(n!=null){var i=isObject(n)&&!isArray(n)||isArray(n)&&n.length&&isObject(n[0]);if(i){e.update[t]=n}else{e[r||"enter"][t]={value:n}}return 1}else{return 0}}function addEncoders(e,t,n){for(var r in t){addEncode(e,r,t[r])}for(var i in n){addEncode(e,i,n[i],"update")}}function extendEncode(e,t,n){for(var r in t){if(n&&has$1(n,r))continue;e[r]=extend$1(e[r]||{},t[r])}return e}function has(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var MarkRole="mark";var FrameRole="frame";var ScopeRole="scope";var AxisRole="axis";var AxisDomainRole="axis-domain";var AxisGridRole="axis-grid";var AxisLabelRole="axis-label";var AxisTickRole="axis-tick";var AxisTitleRole="axis-title";var LegendRole="legend";var LegendBandRole="legend-band";var LegendEntryRole="legend-entry";var LegendGradientRole="legend-gradient";var LegendLabelRole="legend-label";var LegendSymbolRole="legend-symbol";var LegendTitleRole="legend-title";var TitleRole="title";var TitleTextRole="title-text";var TitleSubtitleRole="title-subtitle";function applyDefaults(e,t,n,r,i){var a={},o={};var s,u,l,f;u="lineBreak";if(t==="text"&&i[u]!=null&&!has(u,e)){applyDefault(a,u,i[u])}if(n=="legend"||String(n).startsWith("axis")){n=null}f=n===FrameRole?i.group:n===MarkRole?extend$1({},i.mark,i[t]):null;for(u in f){l=has(u,e)||(u==="fill"||u==="stroke")&&(has("fill",e)||has("stroke",e));if(!l)applyDefault(a,u,f[u])}array$5(r).forEach((function(t){var n=i.style&&i.style[t];for(var r in n){if(!has(r,e)){applyDefault(a,r,n[r])}}}));e=extend$1({},e);for(u in a){f=a[u];if(f.signal){(s=s||{})[u]=f}else{o[u]=f}}e.enter=extend$1(o,e.enter);if(s)e.update=extend$1(s,e.update);return e}function applyDefault(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}var scaleRef=function(e){return isString(e)?$$1(e):e.signal?"(".concat(e.signal,")"):field(e)};function entry(e){if(e.gradient!=null){return gradient$1(e)}var t=e.signal?"(".concat(e.signal,")"):e.color?color$1(e.color):e.field!=null?field(e.field):e.value!==undefined?$$1(e.value):undefined;if(e.scale!=null){t=scale(e,t)}if(t===undefined){t=null}if(e.exponent!=null){t="pow(".concat(t,",").concat(property(e.exponent),")")}if(e.mult!=null){t+="*".concat(property(e.mult))}if(e.offset!=null){t+="+".concat(property(e.offset))}if(e.round){t="round(".concat(t,")")}return t}var _color=function(e,t,n,r){return"(".concat(e,"(").concat([t,n,r].map(entry).join(","),")+'')")};function color$1(e){return e.c?_color("hcl",e.h,e.c,e.l):e.h||e.s?_color("hsl",e.h,e.s,e.l):e.l||e.a?_color("lab",e.l,e.a,e.b):e.r||e.g||e.b?_color("rgb",e.r,e.g,e.b):null}function gradient$1(e){var t=[e.start,e.stop,e.count].map((function(e){return e==null?null:$$1(e)}));while(t.length&&peek$1(t)==null)t.pop();t.unshift(scaleRef(e.gradient));return"gradient(".concat(t.join(","),")")}function property(e){return isObject(e)?"("+entry(e)+")":e}function field(e){return resolveField(isObject(e)?e:{datum:e})}function resolveField(e){var t,n,r;if(e.signal){t="datum";r=e.signal}else if(e.group||e.parent){n=Math.max(1,e.level||1);t="item";while(n-- >0){t+=".mark.group"}if(e.parent){r=e.parent;t+=".datum"}else{r=e.group}}else if(e.datum){t="datum";r=e.datum}else{error("Invalid field reference: "+$$1(e))}if(!e.signal){r=isString(r)?splitAccessPath(r).map($$1).join("]["):resolveField(r)}return t+"["+r+"]"}function scale(e,t){var n=scaleRef(e.scale);if(e.range!=null){t="lerp(_range(".concat(n,"), ").concat(+e.range,")")}else{if(t!==undefined)t="_scale(".concat(n,", ").concat(t,")");if(e.band){t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(+e.band===1?"":"*"+property(e.band));if(e.extra){t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")")}}if(t==null)t="0"}return t}function rule$1(e){var t="";e.forEach((function(e){var n=entry(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n}));if(peek$1(t)===":"){t+="null"}return t}function parseEncode(e,t,n,r,i,a){var o={};a=a||{};a.encoders={$encode:o};e=applyDefaults(e,t,n,r,i.config);for(var s in e){o[s]=parseBlock(e[s],t,a,i)}return a}function parseBlock(e,t,n,r){var i={},a={};for(var o in e){if(e[o]!=null){i[o]=parse(expr(e[o]),r,n,a)}}return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function expr(e){return isArray(e)?rule$1(e):entry(e)}function parse(e,t,n,r){var i=parser(e,t);i.$fields.forEach((function(e){return r[e]=1}));extend$1(n,i.$params);return i.$expr}var OUTER="outer",OUTER_INVALID=["value","update","init","react","bind"];function outerError(e,t){error(e+' for "outer" push: '+$$1(t))}function parseSignal(e,t){var n=e.name;if(e.push===OUTER){if(!t.signals[n])outerError("No prior signal definition",n);OUTER_INVALID.forEach((function(t){if(e[t]!==undefined)outerError("Invalid property ",t)}))}else{var r=t.addSignal(n,e.value);if(e.react===false)r.react=false;if(e.bind)t.addBinding(n,e.bind)}}function Entry(e,t,n,r){this.id=-1;this.type=e;this.value=t;this.params=n;if(r)this.parent=r}function entry$1(e,t,n,r){return new Entry(e,t,n,r)}function operator(e,t){return entry$1("operator",e,t)}function ref(e){var t={$ref:e.id};if(e.id<0)(e.refs=e.refs||[]).push(t);return t}function fieldRef(e,t){return t?{$field:e,$name:t}:{$field:e}}var keyFieldRef=fieldRef("key");function compareRef(e,t){return{$compare:e,$order:t}}function keyRef(e,t){var n={$key:e};if(t)n.$flat=true;return n}var Ascending="ascending";var Descending="descending";function sortKey(e){return!isObject(e)?"":(e.order===Descending?"-":"+")+aggrField(e.op,e.field)}function aggrField(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var Scope="scope";var View="view";function isSignal(e){return e&&e.signal}function isExpr(e){return e&&e.expr}function hasSignal(e){if(isSignal(e))return true;if(isObject(e))for(var t in e){if(hasSignal(e[t]))return true}return false}function value(e,t){return e!=null?e:t}function deref(e){return e&&e.signal||e}var Timer="timer";function parseStream(e,t){var n=e.merge?mergeStream:e.stream?nestedStream:e.type?eventStream:error("Invalid stream specification: "+$$1(e));return n(e,t)}function eventSource(e){return e===Scope?View:e||View}function mergeStream(e,t){var n=e.merge.map((function(e){return parseStream(e,t)})),r=streamParameters({merge:n},e,t);return t.addStream(r).id}function nestedStream(e,t){var n=parseStream(e.stream,t),r=streamParameters({stream:n},e,t);return t.addStream(r).id}function eventStream(e,t){var n;if(e.type===Timer){n=t.event(Timer,e.throttle);e={between:e.between,filter:e.filter}}else{n=t.event(eventSource(e.source),e.type)}var r=streamParameters({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function streamParameters(e,t,n){var r=t.between;if(r){if(r.length!==2){error('Stream "between" parameter must have 2 entries: '+$$1(t))}e.between=[parseStream(r[0],n),parseStream(r[1],n)]}r=t.filter?[].concat(t.filter):[];if(t.marktype||t.markname||t.markrole){r.push(filterMark(t.marktype,t.markname,t.markrole))}if(t.source===Scope){r.push("inScope(event.item)")}if(r.length){e.filter=parser("("+r.join(")&&(")+")",n).$expr}if((r=t.throttle)!=null){e.throttle=+r}if((r=t.debounce)!=null){e.debounce=+r}if(t.consume){e.consume=true}return e}function filterMark(e,t,n){var r="event.item";return r+(e&&e!=="*"?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}var OP_VALUE_EXPR={code:"_.$value",ast:{type:"Identifier",value:"value"}};function parseUpdate(e,t,n){var r=e.encode,i={target:n};var a=e.events,o=e.update,s=[];if(!a){error("Signal update missing events specification.")}if(isString(a)){a=eventSelector(a,t.isSubscope()?Scope:View)}a=array$5(a).filter((function(e){return e.signal||e.scale?(s.push(e),0):1}));if(s.length>1){s=[mergeSources(s)]}if(a.length){s.push(a.length>1?{merge:a}:a[0])}if(r!=null){if(o)error("Signal encode and update are mutually exclusive.");o="encode(item(),"+$$1(r)+")"}i.update=isString(o)?parser(o,t):o.expr!=null?parser(o.expr,t):o.value!=null?o.value:o.signal!=null?{$expr:OP_VALUE_EXPR,$params:{$value:t.signalRef(o.signal)}}:error("Invalid signal update specification.");if(e.force){i.options={force:true}}s.forEach((function(e){return t.addUpdate(extend$1(streamSource(e,t),i))}))}function streamSource(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):parseStream(e,t)}}function mergeSources(e){return{signal:"["+e.map((function(e){return e.scale?'scale("'+e.scale+'")':e.signal}))+"]"}}function parseSignalUpdates(e,t){var n=t.getSignal(e.name);var r=e.update;if(e.init){if(r){error("Signals can not include both init and update expressions.")}else{r=e.init;n.initonly=true}}if(r){r=parser(r,t);n.update=r.$expr;n.params=r.$params}if(e.on){e.on.forEach((function(e){return parseUpdate(e,t,n.id)}))}}var transform=function(e){return function(t,n,r){return entry$1(e,n,t||undefined,r)}};var Aggregate=transform("aggregate");var AxisTicks=transform("axisticks");var Bound=transform("bound");var Collect=transform("collect");var Compare=transform("compare");var DataJoin=transform("datajoin");var Encode=transform("encode");var Expression=transform("expression");var Facet=transform("facet");var Field=transform("field");var Key=transform("key");var LegendEntries=transform("legendentries");var Load=transform("load");var Mark$1=transform("mark");var MultiExtent=transform("multiextent");var MultiValues=transform("multivalues");var Overlap=transform("overlap");var Params=transform("params");var PreFacet=transform("prefacet");var Projection=transform("projection");var Proxy=transform("proxy");var Relay=transform("relay");var Render=transform("render");var Scale=transform("scale");var Sieve=transform("sieve");var SortItems=transform("sortitems");var ViewLayout=transform("viewlayout");var Values=transform("values");var FIELD_REF_ID=0;var MULTIDOMAIN_SORT_OPS={min:"min",max:"max",count:"sum"};function initScale(e,t){var n=e.type||"linear";if(!isValidScaleType(n)){error("Unrecognized scale type: "+$$1(n))}t.addScale(e.name,{type:n,domain:undefined})}function parseScale(e,t){var n=t.getScale(e.name).params;var r;n.domain=parseScaleDomain$1(e.domain,e,t);if(e.range!=null){n.range=parseScaleRange$1(e,t,n)}if(e.interpolate!=null){parseScaleInterpolate(e.interpolate,n)}if(e.nice!=null){n.nice=parseScaleNice(e.nice)}if(e.bins!=null){n.bins=parseScaleBins(e.bins,t)}for(r in e){if(has$1(n,r)||r==="name")continue;n[r]=parseLiteral(e[r],t)}}function parseLiteral(e,t){return!isObject(e)?e:e.signal?t.signalRef(e.signal):error("Unsupported object: "+$$1(e))}function parseArray(e,t){return e.signal?t.signalRef(e.signal):e.map((function(e){return parseLiteral(e,t)}))}function dataLookupError(e){error("Can not find data set: "+$$1(e))}function parseScaleDomain$1(e,t,n){if(!e){if(t.domainMin!=null||t.domainMax!=null){error("No scale domain defined for domainMin/domainMax to override.")}return}return e.signal?n.signalRef(e.signal):(isArray(e)?explicitDomain:e.fields?multipleDomain:singularDomain)(e,t,n)}function explicitDomain(e,t,n){return e.map((function(e){return parseLiteral(e,n)}))}function singularDomain(e,t,n){var r=n.getData(e.data);if(!r)dataLookupError(e.data);return isDiscrete$1(t.type)?r.valuesRef(n,e.field,parseSort(e.sort,false)):isQuantile$1(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function multipleDomain(e,t,n){var r=e.data,i=e.fields.reduce((function(e,t){t=isString(t)?{data:r,field:t}:isArray(t)||t.signal?fieldRef$1(t,n):t;e.push(t);return e}),[]);return(isDiscrete$1(t.type)?ordinalMultipleDomain:isQuantile$1(t.type)?quantileMultipleDomain:numericMultipleDomain)(e,n,i)}function fieldRef$1(e,t){var n="_:vega:_"+FIELD_REF_ID++,r=Collect({});if(isArray(e)){r.value={$ingest:e}}else if(e.signal){var i="setdata("+$$1(n)+","+e.signal+")";r.params.input=t.signalRef(i)}t.addDataPipeline(n,[r,Sieve({})]);return{data:n,field:"data"}}function ordinalMultipleDomain(e,t,n){var r=parseSort(e.sort,true);var i,a;var o=n.map((function(e){var n=t.getData(e.data);if(!n)dataLookupError(e.data);return n.countsRef(t,e.field,r)}));var s={groupby:keyFieldRef,pulse:o};if(r){i=r.op||"count";a=r.field?aggrField(i,r.field):"count";s.ops=[MULTIDOMAIN_SORT_OPS[i]];s.fields=[t.fieldRef(a)];s.as=[a]}i=t.add(Aggregate(s));var u=t.add(Collect({pulse:ref(i)}));a=t.add(Values({field:keyFieldRef,sort:t.sortRef(r),pulse:ref(u)}));return ref(a)}function parseSort(e,t){if(e){if(!e.field&&!e.op){if(isObject(e))e.field="key";else e={field:"key"}}else if(!e.field&&e.op!=="count"){error("No field provided for sort aggregate op: "+e.op)}else if(t&&e.field){if(e.op&&!MULTIDOMAIN_SORT_OPS[e.op]){error("Multiple domain scales can not be sorted using "+e.op)}}}return e}function quantileMultipleDomain(e,t,n){var r=n.map((function(e){var n=t.getData(e.data);if(!n)dataLookupError(e.data);return n.domainRef(t,e.field)}));return ref(t.add(MultiValues({values:r})))}function numericMultipleDomain(e,t,n){var r=n.map((function(e){var n=t.getData(e.data);if(!n)dataLookupError(e.data);return n.extentRef(t,e.field)}));return ref(t.add(MultiExtent({extents:r})))}function parseScaleBins(e,t){return e.signal||isArray(e)?parseArray(e,t):t.objectProperty(e)}function parseScaleNice(e){return isObject(e)?{interval:parseLiteral(e.interval),step:parseLiteral(e.step)}:parseLiteral(e)}function parseScaleInterpolate(e,t){t.interpolate=parseLiteral(e.type||e);if(e.gamma!=null){t.interpolateGamma=parseLiteral(e.gamma)}}function parseScaleRange$1(e,t,n){var r=t.config.range;var i=e.range;if(i.signal){return t.signalRef(i.signal)}else if(isString(i)){if(r&&has$1(r,i)){e=extend$1({},e,{range:r[i]});return parseScaleRange$1(e,t,n)}else if(i==="width"){i=[0,{signal:"width"}]}else if(i==="height"){i=isDiscrete$1(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]}else{error("Unrecognized scale range value: "+$$1(i))}}else if(i.scheme){n.scheme=isArray(i.scheme)?parseArray(i.scheme,t):parseLiteral(i.scheme,t);if(i.extent)n.schemeExtent=parseArray(i.extent,t);if(i.count)n.schemeCount=parseLiteral(i.count,t);return}else if(i.step){n.rangeStep=parseLiteral(i.step,t);return}else if(isDiscrete$1(e.type)&&!isArray(i)){return parseScaleDomain$1(i,e,t)}else if(!isArray(i)){error("Unsupported range type: "+$$1(i))}return i.map((function(e){return(isArray(e)?parseArray:parseLiteral)(e,t)}))}function parseProjection$1(e,t){var n=t.config.projection||{},r={};for(var i in e){if(i==="name")continue;r[i]=parseParameter(e[i],i,t)}for(var a in n){if(r[a]==null){r[a]=parseParameter(n[a],a,t)}}t.addProjection(e.name,r)}function parseParameter(e,t,n){return isArray(e)?e.map((function(e){return parseParameter(e,t,n)})):!isObject(e)?e:e.signal?n.signalRef(e.signal):t==="fit"?e:error("Unsupported parameter object: "+$$1(e))}var Top="top";var Left="left";var Right="right";var Bottom="bottom";var Center="center";var Vertical="vertical";var Start="start";var Middle="middle";var End="end";var Index="index";var Label="label";var Offset="offset";var Perc="perc";var Perc2="perc2";var Value="value";var GuideLabelStyle="guide-label";var GuideTitleStyle="guide-title";var GroupTitleStyle="group-title";var GroupSubtitleStyle="group-subtitle";var Symbols="symbol";var Gradient="gradient";var Discrete="discrete";var Size="size";var Shape="shape";var Fill="fill";var Stroke="stroke";var StrokeWidth="strokeWidth";var StrokeDash="strokeDash";var Opacity="opacity";var LegendScales=[Size,Shape,Fill,Stroke,StrokeWidth,StrokeDash,Opacity];var Skip={name:1,style:1,interactive:1};var zero$1={value:0};var one={value:1};var GroupMark="group";var RectMark="rect";var RuleMark="rule";var SymbolMark="symbol";var TextMark="text";function guideGroup(e){e.type=GroupMark;e.interactive=e.interactive||false;return e}function lookup(e,t){var n=function(n,r){return value(e[n],value(t[n],r))};n.isVertical=function(n){return Vertical===value(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection))};n.gradientLength=function(){return value(e.gradientLength,t.gradientLength||t.gradientWidth)};n.gradientThickness=function(){return value(e.gradientThickness,t.gradientThickness||t.gradientHeight)};n.entryColumns=function(){return value(e.columns,value(t.columns,+n.isVertical(true)))};return n}function getEncoding(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function getStyle(e,t,n){var r=t.config.style[n];return r&&r[e]}function anchorExpr(e,t,n){return"item.anchor === '".concat(Start,"' ? ").concat(e," : item.anchor === '").concat(End,"' ? ").concat(t," : ").concat(n)}var alignExpr=anchorExpr($$1(Left),$$1(Right),$$1(Center));function tickBand(e){var t=e("tickBand");var n=e("tickOffset"),r,i;if(!t){r=e("bandPosition");i=e("tickExtra")}else if(t.signal){r={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")};i={signal:"(".concat(t.signal,") === 'extent'")};if(!isObject(n)){n={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(n)}}}else if(t==="extent"){r=1;i=true;n=0}else{r=.5;i=false}return{extra:i,band:r,offset:n}}function extendOffset(e,t){return!t?e:!e?t:!isObject(e)?{value:e,offset:t}:Object.assign({},e,{offset:extendOffset(e.offset,t)})}function guideMark(e,t){if(t){e.name=t.name;e.style=t.style||e.style;e.interactive=!!t.interactive;e.encode=extendEncode(e.encode,t,Skip)}else{e.interactive=false}return e}function legendGradient(e,t,n,r){var i=lookup(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();var u,l,f,c,d;if(a){l=[0,1];f=[0,0];c=o;d=s}else{l=[0,0];f=[1,0];c=s;d=o}var p={enter:u={opacity:zero$1,x:zero$1,y:zero$1,width:encoder(c),height:encoder(d)},update:extend$1({},u,{opacity:one,fill:{gradient:t,start:l,stop:f}}),exit:{opacity:zero$1}};addEncoders(p,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")});return guideMark({type:RectMark,role:LegendGradientRole,encode:p},r)}function legendGradientDiscrete(e,t,n,r,i){var a=lookup(e,n),o=a.isVertical(),s=a.gradientThickness(),u=a.gradientLength();var l,f,c,d,p="";o?(l="y",c="y2",f="x",d="width",p="1-"):(l="x",c="x2",f="y",d="height");var h={opacity:zero$1,fill:{scale:t,field:Value}};h[l]={signal:p+"datum."+Perc,mult:u};h[f]=zero$1;h[c]={signal:p+"datum."+Perc2,mult:u};h[d]=encoder(s);var g={enter:h,update:extend$1({},h,{opacity:one}),exit:{opacity:zero$1}};addEncoders(g,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")});return guideMark({type:RectMark,role:LegendBandRole,key:Value,from:i,encode:g},r)}var alignExpr$1="datum.".concat(Perc,'<=0?"').concat(Left,'":datum.').concat(Perc,'>=1?"').concat(Right,'":"').concat(Center,'"'),baselineExpr="datum.".concat(Perc,'<=0?"').concat(Bottom,'":datum.').concat(Perc,'>=1?"').concat(Top,'":"').concat(Middle,'"');function legendGradientLabels(e,t,n,r){var i=lookup(e,t),a=i.isVertical(),o=encoder(i.gradientThickness()),s=i.gradientLength();var u=i("labelOverlap"),l,f,c,d,p="";var h={enter:l={opacity:zero$1},update:f={opacity:one,text:{field:Label}},exit:{opacity:zero$1}};addEncoders(h,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:value(e.labelLimit,t.gradientLabelLimit)});if(a){l.align={value:"left"};l.baseline=f.baseline={signal:baselineExpr};c="y";d="x";p="1-"}else{l.align=f.align={signal:alignExpr$1};l.baseline={value:"top"};c="x";d="y"}l[c]=f[c]={signal:p+"datum."+Perc,mult:s};l[d]=f[d]=o;o.offset=value(e.labelOffset,t.gradientLabelOffset)||0;u=u?{separation:i("labelSeparation"),method:u,order:"datum."+Index}:undefined;return guideMark({type:TextMark,role:LegendLabelRole,style:GuideLabelStyle,key:Value,from:r,encode:h,overlap:u},n)}function legendSymbolGroups(e,t,n,r,i){var a=lookup(e,t),o=n.entries,s=!!(o&&o.interactive),u=o?o.name:undefined,l=a("clipHeight"),f=a("symbolOffset"),c={data:"value"},d="(".concat(i,") ? datum.").concat(Offset," : datum.").concat(Size),p=l?encoder(l):{field:Size},h="datum.".concat(Index),g="max(1, ".concat(i,")");var m,v,y,_,b;p.mult=.5;m={enter:v={opacity:zero$1,x:{signal:d,mult:.5,offset:f},y:p},update:y={opacity:one,x:v.x,y:v.y},exit:{opacity:zero$1}};var x=null,E=null;if(!e.fill){x=t.symbolBaseFillColor;E=t.symbolBaseStrokeColor}addEncoders(m,{fill:a("symbolFillColor",x),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",E),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")});LegendScales.forEach((function(t){if(e[t]){y[t]=v[t]={scale:e[t],field:Value}}}));var S=guideMark({type:SymbolMark,role:LegendSymbolRole,key:Value,from:c,clip:l?true:undefined,encode:m},n.symbols);var $=encoder(f);$.offset=a("labelOffset");m={enter:v={opacity:zero$1,x:{signal:d,offset:$},y:p},update:y={opacity:one,text:{field:Label},x:v.x,y:v.y},exit:{opacity:zero$1}};addEncoders(m,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});var A=guideMark({type:TextMark,role:LegendLabelRole,style:GuideLabelStyle,key:Value,from:c,encode:m},n.labels);m={enter:{noBound:{value:!l},width:zero$1,height:l?encoder(l):zero$1,opacity:zero$1},exit:{opacity:zero$1},update:y={opacity:one,row:{signal:null},column:{signal:null}}};if(a.isVertical(true)){_="ceil(item.mark.items.length / ".concat(g,")");y.row.signal="".concat(h,"%").concat(_);y.column.signal="floor(".concat(h," / ").concat(_,")");b={field:["row",h]}}else{y.row.signal="floor(".concat(h," / ").concat(g,")");y.column.signal="".concat(h," % ").concat(g);b={field:h}}y.column.signal="(".concat(i,")?").concat(y.column.signal,":").concat(h);r={facet:{data:r,name:"value",groupby:Index}};return guideGroup({role:ScopeRole,from:r,encode:extendEncode(m,o,Skip),marks:[S,A],name:u,interactive:s,sort:b})}function legendSymbolLayout(e,t){var n=lookup(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:true,column:false},padding:{row:n("rowPadding"),column:n("columnPadding")}}}var isL='item.orient === "left"',isR='item.orient === "right"',isLR="(".concat(isL," || ").concat(isR,")"),isVG="datum.vgrad && ".concat(isLR),baseline$1=anchorExpr('"top"','"bottom"','"middle"'),alignFlip=anchorExpr('"right"','"left"','"center"'),exprAlign="datum.vgrad && ".concat(isR," ? (").concat(alignFlip,") : (").concat(isLR," && !(datum.vgrad && ").concat(isL,')) ? "left" : ').concat(alignExpr),exprAnchor="item._anchor || (".concat(isLR,' ? "middle" : "start")'),exprAngle="".concat(isVG," ? (").concat(isL," ? -90 : 90) : 0"),exprBaseline="".concat(isLR," ? (datum.vgrad ? (").concat(isR,' ? "bottom" : "top") : ').concat(baseline$1,') : "top"');function legendTitle(e,t,n,r){var i=lookup(e,t);var a={enter:{opacity:zero$1},update:{opacity:one,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:zero$1}};addEncoders(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:exprAnchor},angle:{signal:exprAngle},align:{signal:exprAlign},baseline:{signal:exprBaseline},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")});return guideMark({type:TextMark,role:LegendTitleRole,style:GuideTitleStyle,from:r,encode:a},n)}function clip(e,t){var n;if(isObject(e)){if(e.signal){n=e.signal}else if(e.path){n="pathShape("+param(e.path)+")"}else if(e.sphere){n="geoShape("+param(e.sphere)+', {type: "Sphere"})'}}return n?t.signalRef(n):!!e}function param(e){return isObject(e)&&e.signal?e.signal:$$1(e)}function getRole(e){var t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===GroupMark?ScopeRole:t||MarkRole}function definition(e){return{marktype:e.type,name:e.name||undefined,role:e.role||getRole(e),zindex:+e.zindex||undefined,aria:e.aria,description:e.description}}function interactive(e,t){return e&&e.signal?t.signalRef(e.signal):e===false?false:true}function parseTransform(e,t){var n=definition$1(e.type);if(!n)error("Unrecognized transform type: "+$$1(e.type));var r=entry$1(n.type.toLowerCase(),null,parseParameters(n,e,t));if(e.signal)t.addSignal(e.signal,t.proxy(r));r.metadata=n.metadata||{};return r}function parseParameters(e,t,n){var r={},i=e.params.length;for(var a=0;a<i;++a){var o=e.params[a];r[o.name]=parseParameter$1(o,t,n)}return r}function parseParameter$1(e,t,n){var r=e.type,i=t[e.name];if(r==="index"){return parseIndexParameter(e,t,n)}else if(i===undefined){if(e.required){error("Missing required "+$$1(t.type)+" parameter: "+$$1(e.name))}return}else if(r==="param"){return parseSubParameters(e,t,n)}else if(r==="projection"){return n.projectionRef(t[e.name])}return e.array&&!isSignal(i)?i.map((function(t){return parameterValue(e,t,n)})):parameterValue(e,i,n)}function parameterValue(e,t,n){var r=e.type;if(isSignal(t)){return isExpr$1(r)?error("Expression references can not be signals."):isField(r)?n.fieldRef(t):isCompare(r)?n.compareRef(t):n.signalRef(t.signal)}else{var i=e.expr||isField(r);return i&&outerExpr(t)?n.exprRef(t.expr,t.as):i&&outerField(t)?fieldRef(t.field,t.as):isExpr$1(r)?parser(t,n):isData(r)?ref(n.getData(t).values):isField(r)?fieldRef(t):isCompare(r)?n.compareRef(t):t}}function parseIndexParameter(e,t,n){if(!isString(t.from)){error('Lookup "from" parameter must be a string literal.')}return n.getData(t.from).lookupRef(n,t.key)}function parseSubParameters(e,t,n){var r=t[e.name];if(e.array){if(!isArray(r)){error("Expected an array of sub-parameters. Instead: "+$$1(r))}return r.map((function(t){return parseSubParameter(e,t,n)}))}else{return parseSubParameter(e,r,n)}}function parseSubParameter(e,t,n){var r=e.params.length;var i;for(var a=0;a<r;++a){i=e.params[a];for(var o in i.key){if(i.key[o]!==t[o]){i=null;break}}if(i)break}if(!i)error("Unsupported parameter: "+$$1(t));var s=extend$1(parseParameters(i,t,n),i.key);return ref(n.add(Params(s)))}var outerExpr=function(e){return e&&e.expr};var outerField=function(e){return e&&e.field};var isData=function(e){return e==="data"};var isExpr$1=function(e){return e==="expr"};var isField=function(e){return e==="field"};var isCompare=function(e){return e==="compare"};function parseData$1(e,t,n){var r,i,a,o,s;if(!e){o=ref(n.add(Collect(null,[{}])))}else if(r=e.facet){if(!t)error("Only group marks can be faceted.");if(r.field!=null){o=s=getDataRef(r,n)}else{if(!e.data){a=parseTransform(extend$1({type:"aggregate",groupby:array$5(r.groupby)},r.aggregate),n);a.params.key=n.keyRef(r.groupby);a.params.pulse=getDataRef(r,n);o=s=ref(n.add(a))}else{s=ref(n.getData(e.data).aggregate)}i=n.keyRef(r.groupby,true)}}if(!o){o=getDataRef(e,n)}return{key:i,pulse:o,parent:s}}function getDataRef(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:ref(t.getData(e.data).output)}function DataScope(e,t,n,r,i){this.scope=e;this.input=t;this.output=n;this.values=r;this.aggregate=i;this.index={}}DataScope.fromEntries=function(e,t){var n=t.length,r=t[n-1],i=t[n-2];var a=t[0],o=null,s=1;if(a&&a.type==="load"){a=t[1]}e.add(t[0]);for(;s<n;++s){t[s].params.pulse=ref(t[s-1]);e.add(t[s]);if(t[s].type==="aggregate")o=t[s]}return new DataScope(e,a,i,r,o)};function fieldKey(e){return isString(e)?e:null}function addSortField(e,t,n){var r=aggrField(n.op,n.field);var i;if(t.ops){for(var a=0,o=t.as.length;a<o;++a){if(t.as[a]===r)return}}else{t.ops=["count"];t.fields=[null];t.as=["count"]}if(n.op){t.ops.push((i=n.op.signal)?e.signalRef(i):n.op);t.fields.push(e.fieldRef(n.field));t.as.push(r)}}function cache(e,t,n,r,i,a,o){var s=t[n]||(t[n]={}),u=sortKey(a);var l=fieldKey(i),f,c;if(l!=null){e=t.scope;l=l+(u?"|"+u:"");f=s[l]}if(!f){var d=a?{field:keyFieldRef,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:ref(t.output)};if(u)d.sort=e.sortRef(a);c=e.add(entry$1(r,undefined,d));if(o)t.index[i]=c;f=ref(c);if(l!=null)s[l]=f}return f}DataScope.prototype={countsRef:function(e,t,n){var r=this,i=r.counts||(r.counts={}),a=fieldKey(t);var o,s,u;if(a!=null){e=r.scope;o=i[a]}if(!o){u={groupby:e.fieldRef(t,"key"),pulse:ref(r.output)};if(n&&n.field)addSortField(e,u,n);s=e.add(Aggregate(u));o=e.add(Collect({pulse:ref(s)}));o={agg:s,ref:ref(o)};if(a!=null)i[a]=o}else if(n&&n.field){addSortField(e,o.agg.params,n)}return o.ref},tuplesRef:function(){return ref(this.values)},extentRef:function(e,t){return cache(e,this,"extent","extent",t,false)},domainRef:function(e,t){return cache(e,this,"domain","values",t,false)},valuesRef:function(e,t,n){return cache(e,this,"vals","values",t,n||true)},lookupRef:function(e,t){return cache(e,this,"lookup","tupleindex",t,false)},indataRef:function(e,t){return cache(e,this,"indata","tupleindex",t,true,true)}};function parseFacet(e,t,n){var r=e.from.facet,i=r.name,a=getDataRef(r,t);var o;if(!r.name){error("Facet must have a name: "+$$1(r))}if(!r.data){error("Facet must reference a data set: "+$$1(r))}if(r.field){o=t.add(PreFacet({field:t.fieldRef(r.field),pulse:a}))}else if(r.groupby){o=t.add(Facet({key:t.keyRef(r.groupby),group:ref(t.proxy(n.parent)),pulse:a}))}else{error("Facet must specify groupby or field: "+$$1(r))}var s=t.fork(),u=s.add(Collect()),l=s.add(Sieve({pulse:ref(u)}));s.addData(i,new DataScope(s,u,u,l));s.addSignal("parent",null);o.params.subflow={$subflow:s.parse(e).toRuntime()}}function parseSubflow(e,t,n){var r=t.add(PreFacet({pulse:n.pulse})),i=t.fork();i.add(Sieve());i.addSignal("parent",null);r.params.subflow={$subflow:i.parse(e).toRuntime()}}function parseTrigger(e,t,n){var r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,u=t.add(operator());var l="if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map((function(e){return e==null?"null":e})).join(",")+"),0)";var f=parser(l,t);u.update=f.$expr;u.params=f.$params}function parseMark(e,t){var n=getRole(e),r=e.type===GroupMark,i=e.from&&e.from.facet,a=e.overlap;var o=e.layout||n===ScopeRole||n===FrameRole,s,u,l,f,c,d,p;var h=n===MarkRole||o||i;var g=parseData$1(e.from,r,t);u=t.add(DataJoin({key:g.key||(e.key?fieldRef(e.key):undefined),pulse:g.pulse,clean:!r}));var m=ref(u);u=l=t.add(Collect({pulse:m}));u=t.add(Mark$1({markdef:definition(e),interactive:interactive(e.interactive,t),clip:clip(e.clip,t),context:{$context:true},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:ref(u)}));var v=ref(u);u=f=t.add(Encode(parseEncode(e.encode,e.type,n,e.style,t,{mod:false,pulse:v})));u.params.parent=t.encode();if(e.transform){e.transform.forEach((function(e){var n=parseTransform(e,t),r=n.metadata;if(r.generates||r.changes){error("Mark transforms should not generate new data.")}if(!r.nomod)f.params.mod=true;n.params.pulse=ref(u);t.add(u=n)}))}if(e.sort){u=t.add(SortItems({sort:t.compareRef(e.sort),pulse:ref(u)}))}var y=ref(u);if(i||o){o=t.add(ViewLayout({layout:t.objectProperty(e.layout),legends:t.legends,mark:v,pulse:y}));d=ref(o)}var _=t.add(Bound({mark:v,pulse:d||y}));p=ref(_);if(r){if(h){s=t.operators;s.pop();if(o)s.pop()}t.pushState(y,d||p,m);i?parseFacet(e,t,g):h?parseSubflow(e,t,g):t.parse(e);t.popState();if(h){if(o)s.push(o);s.push(_)}}if(a){p=parseOverlap(a,p,t)}var b=t.add(Render({pulse:p})),x=t.add(Sieve({pulse:ref(b)},undefined,t.parent()));if(e.name!=null){c=e.name;t.addData(c,new DataScope(t,l,b,x));if(e.on)e.on.forEach((function(e){if(e.insert||e.remove||e.toggle){error("Marks only support modify triggers.")}parseTrigger(e,t,c)}))}}function parseOverlap(e,t,n){var r=e.method,i=e.bound,a=e.separation;var o={separation:isSignal(a)?n.signalRef(a.signal):a,method:isSignal(r)?n.signalRef(r.signal):r,pulse:t};if(e.order){o.sort=n.compareRef({field:e.order})}if(i){var s=i.tolerance;o.boundTolerance=isSignal(s)?n.signalRef(s.signal):+s;o.boundScale=n.scaleRef(i.scale);o.boundOrient=i.orient}return ref(n.add(Overlap(o)))}function parseLegend$1(e,t){var n=t.config.legend,r=e.encode||{},i=lookup(e,n),a=r.legend||{},o=a.name||undefined,s=a.interactive,u=a.style,l={};var f=0,c,d,p;LegendScales.forEach((function(t){return e[t]?(l[t]=e[t],f=f||e[t]):0}));if(!f)error("Missing valid scale for legend.");var h=legendType(e,t.scaleType(f));var g={title:e.title!=null,scales:l,type:h,vgrad:h!=="symbol"&&i.isVertical()};var m=ref(t.add(Collect(null,[g])));var v={enter:{x:{value:0},y:{value:0}}};var y=ref(t.add(LegendEntries(d={type:h,scale:t.scaleRef(f),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));if(h===Gradient){p=[legendGradient(e,f,n,r.gradient),legendGradientLabels(e,n,r.labels,y)];d.count=d.count||t.signalRef("max(2,2*floor((".concat(deref(i.gradientLength()),")/100))"))}else if(h===Discrete){p=[legendGradientDiscrete(e,f,n,r.gradient,y),legendGradientLabels(e,n,r.labels,y)]}else{c=legendSymbolLayout(e,n);p=[legendSymbolGroups(e,n,r,y,deref(c.columns))];d.size=sizeExpression(e,t,p[0].marks)}p=[guideGroup({role:LegendEntryRole,from:m,encode:v,marks:p,layout:c,interactive:s})];if(g.title){p.push(legendTitle(e,n,r.title,m))}return parseMark(guideGroup({role:LegendRole,from:m,encode:extendEncode(buildLegendEncode(i,e,n),a,Skip),marks:p,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:u}),t)}function legendType(e,t){var n=e.type||Symbols;if(!e.type&&scaleCount(e)===1&&(e.fill||e.stroke)){n=isContinuous(t)?Gradient:isDiscretizing$1(t)?Discrete:Symbols}return n!==Gradient?n:isDiscretizing$1(t)?Discrete:Gradient}function scaleCount(e){return LegendScales.reduce((function(t,n){return t+(e[n]?1:0)}),0)}function buildLegendEncode(e,t,n){var r={enter:{},update:{}};addEncoders(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType});return r}function sizeExpression(e,t,n){var r=deref(getChannel("size",e,n)),i=deref(getChannel("strokeWidth",e,n)),a=deref(getFontSize(n[1].encode,t,GuideLabelStyle));return parser("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}function getChannel(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):getEncoding(e,n[0].encode)}function getFontSize(e,t,n){return getEncoding("fontSize",e)||getStyle("fontSize",t,n)}var angleExpr='item.orient==="'.concat(Left,'"?-90:item.orient==="').concat(Right,'"?90:0');function parseTitle(e,t){e=isString(e)?{text:e}:e;var n=lookup(e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||undefined,o=i.interactive,s=i.style,u=[];var l={},f=ref(t.add(Collect(null,[l])));u.push(buildTitle(e,n,titleEncode(e),f));if(e.subtitle){u.push(buildSubTitle(e,n,r.subtitle,f))}return parseMark(guideGroup({role:TitleRole,from:f,encode:groupEncode(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function titleEncode(e){var t=e.encode;return t&&t.title||extend$1({name:e.name,interactive:e.interactive,style:e.style},t)}function groupEncode(e,t){var n={enter:{},update:{}};addEncoders(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:alignExpr},angle:{signal:angleExpr},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")});return extendEncode(n,t,Skip)}function buildTitle(e,t,n,r){var i={value:0},a=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};addEncoders(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")});return guideMark({type:TextMark,role:TitleTextRole,style:GroupTitleStyle,from:r,encode:o},n)}function buildSubTitle(e,t,n,r){var i={value:0},a=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};addEncoders(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")});return guideMark({type:TextMark,role:TitleSubtitleRole,style:GroupSubtitleStyle,from:r,encode:o},n)}function parseData$1$1(e,t){var n=[];if(e.transform){e.transform.forEach((function(e){n.push(parseTransform(e,t))}))}if(e.on){e.on.forEach((function(n){parseTrigger(n,t,e.name)}))}t.addDataPipeline(e.name,analyze(e,t,n))}function analyze(e,t,n){var r=[];var i=null,a=false,o=false,s,u,l,f,c;if(e.values){if(isSignal(e.values)||hasSignal(e.format)){r.push(load(t,e));r.push(i=collect())}else{r.push(i=collect({$ingest:e.values,$format:e.format}))}}else if(e.url){if(hasSignal(e.url)||hasSignal(e.format)){r.push(load(t,e));r.push(i=collect())}else{r.push(i=collect({$request:e.url,$format:e.format}))}}else if(e.source){i=s=array$5(e.source).map((function(e){return ref(t.getData(e).output)}));r.push(null)}for(u=0,l=n.length;u<l;++u){f=n[u];c=f.metadata;if(!i&&!c.source){r.push(i=collect())}r.push(f);if(c.generates)o=true;if(c.modifies&&!o)a=true;if(c.source)i=f;else if(c.changes)i=null}if(s){l=s.length-1;r[0]=Relay({derive:a,pulse:l?s:s[0]});if(a||l){r.splice(1,0,collect())}}if(!i)r.push(collect());r.push(Sieve({}));return r}function collect(e){var t=Collect({},e);t.metadata={source:true};return t}function load(e,t){return Load({url:t.url?e.property(t.url):undefined,async:t.async?e.property(t.async):undefined,values:t.values?e.property(t.values):undefined,format:e.objectProperty(t.format)})}var isX=function(e){return e===Bottom||e===Top};var getSign=function(e,t,n){return isSignal(e)?ifLeftTopExpr(e.signal,t,n):e===Left||e===Top?t:n};var ifX=function(e,t,n){return isSignal(e)?ifXEnc(e.signal,t,n):isX(e)?t:n};var ifY=function(e,t,n){return isSignal(e)?ifYEnc(e.signal,t,n):isX(e)?n:t};var ifTop=function(e,t,n){return isSignal(e)?ifTopExpr(e.signal,t,n):e===Top?{value:t}:{value:n}};var ifRight=function(e,t,n){return isSignal(e)?ifRightExpr(e.signal,t,n):e===Right?{value:t}:{value:n}};var ifXEnc=function(e,t,n){return ifEnc("".concat(e," === '").concat(Top,"' || ").concat(e," === '").concat(Bottom,"'"),t,n)};var ifYEnc=function(e,t,n){return ifEnc("".concat(e," !== '").concat(Top,"' && ").concat(e," !== '").concat(Bottom,"'"),t,n)};var ifLeftTopExpr=function(e,t,n){return ifExpr("".concat(e," === '").concat(Left,"' || ").concat(e," === '").concat(Top,"'"),t,n)};var ifTopExpr=function(e,t,n){return ifExpr("".concat(e," === '").concat(Top,"'"),t,n)};var ifRightExpr=function(e,t,n){return ifExpr("".concat(e," === '").concat(Right,"'"),t,n)};var ifEnc=function(e,t,n){t=t!=null?encoder(t):t;n=n!=null?encoder(n):n;if(isSimple(t)&&isSimple(n)){t=t?t.signal||$$1(t.value):null;n=n?n.signal||$$1(n.value):null;return{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}}else{return[extend$1({test:e},t)].concat(n||[])}};var isSimple=function(e){return e==null||Object.keys(e).length===1};var ifExpr=function(e,t,n){return{signal:"".concat(e," ? (").concat(toExpr(t),") : (").concat(toExpr(n),")")}};var ifOrient=function(e,t,n,r,i){return{signal:(r!=null?"".concat(e," === '").concat(Left,"' ? (").concat(toExpr(r),") : "):"")+(n!=null?"".concat(e," === '").concat(Bottom,"' ? (").concat(toExpr(n),") : "):"")+(i!=null?"".concat(e," === '").concat(Right,"' ? (").concat(toExpr(i),") : "):"")+(t!=null?"".concat(e," === '").concat(Top,"' ? (").concat(toExpr(t),") : "):"")+"(null)"}};var toExpr=function(e){return isSignal(e)?e.signal:e==null?null:$$1(e)};var mult=function(e,t){return t===0?0:isSignal(e)?{signal:"(".concat(e.signal,") * ").concat(t)}:{value:e*t}};var patch=function(e,t){var n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function fallback(e,t,n,r){var i;if(t&&has$1(t,e)){return t[e]}else if(has$1(n,e)){return n[e]}else if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[GuideTitleStyle][i]}else if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[GuideLabelStyle][i]}return null}function keys$2(e){var t={};for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!i)continue;for(var a in i)t[a]=1}return Object.keys(t)}function axisConfig(e,t){var n=t.config,r=n.style,i=n.axis,a=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,s,u,l;if(isSignal(o)){var f=keys$2([n.axisX,n.axisY]),c=keys$2([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);s={};for(var d=0,p=f;d<p.length;d++){l=p[d];s[l]=ifX(o,fallback(l,n.axisX,i,r),fallback(l,n.axisY,i,r))}u={};for(var h=0,g=c;h<g.length;h++){l=g[h];u[l]=ifOrient(o.signal,fallback(l,n.axisTop,i,r),fallback(l,n.axisBottom,i,r),fallback(l,n.axisLeft,i,r),fallback(l,n.axisRight,i,r))}}else{s=o===Top||o===Bottom?n.axisX:n.axisY;u=n["axis"+o[0].toUpperCase()+o.slice(1)]}var m=s||u||a?extend$1({},i,s,u,a):i;return m}function axisDomain(e,t,n,r){var i=lookup(e,t),a=e.orient;var o,s;var u={enter:o={opacity:zero$1},update:s={opacity:one},exit:{opacity:zero$1}};addEncoders(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});var l=position(e,0);var f=position(e,1);o.x=s.x=ifX(a,l,zero$1);o.x2=s.x2=ifX(a,f);o.y=s.y=ifY(a,l,zero$1);o.y2=s.y2=ifY(a,f);return guideMark({type:RuleMark,role:AxisDomainRole,from:r,encode:u},n)}function position(e,t){return{scale:e.scale,range:t}}function axisGrid(e,t,n,r,i){var a=lookup(e,t),o=e.orient,s=e.gridScale,u=getSign(o,1,-1),l=offsetValue(e.offset,u);var f,c,d;var p={enter:f={opacity:zero$1},update:d={opacity:one},exit:c={opacity:zero$1}};addEncoders(p,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});var h={scale:e.scale,field:Value,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")};var g=ifX(o,{signal:"height"},{signal:"width"});var m=s?{scale:s,range:0,mult:u,offset:l}:{value:0,offset:l};var v=s?{scale:s,range:1,mult:u,offset:l}:extend$1(g,{mult:u,offset:l});f.x=d.x=ifX(o,h,m);f.y=d.y=ifY(o,h,m);f.x2=d.x2=ifY(o,v);f.y2=d.y2=ifX(o,v);c.x=ifX(o,h);c.y=ifY(o,h);return guideMark({type:RuleMark,role:AxisGridRole,key:Value,from:r,encode:p},n)}function offsetValue(e,t){if(t===1);else if(!isObject(e)){e=isSignal(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0)}else{var n=e=extend$1({},e);while(n.mult!=null){if(!isObject(n.mult)){n.mult=isSignal(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t;return e}else{n=n.mult=extend$1({},n.mult)}}n.mult=t}return e}function axisTicks(e,t,n,r,i,a){var o=lookup(e,t),s=e.orient,u=getSign(s,-1,1);var l,f,c;var d={enter:l={opacity:zero$1},update:c={opacity:one},exit:f={opacity:zero$1}};addEncoders(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});var p=encoder(i);p.mult=u;var h={scale:e.scale,field:Value,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};c.y=l.y=ifX(s,zero$1,h);c.y2=l.y2=ifX(s,p);f.x=ifX(s,h);c.x=l.x=ifY(s,zero$1,h);c.x2=l.x2=ifY(s,p);f.y=ifY(s,h);return guideMark({type:RuleMark,role:AxisTickRole,key:Value,from:r,encode:d},n)}function flushExpr(e,t,n,r,i){return{signal:'flush(range("'+e+'"), '+'scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function axisLabels(e,t,n,r,i,a){var o=lookup(e,t),s=e.orient,u=e.scale,l=getSign(s,-1,1),f=deref(o("labelFlush")),c=deref(o("labelFlushOffset")),d=o("labelAlign"),p=o("labelBaseline");var h=f===0||!!f,g;var m=encoder(i);m.mult=l;m.offset=encoder(o("labelPadding")||0);m.offset.mult=l;var v={scale:u,field:Value,band:.5,offset:extendOffset(a.offset,o("labelOffset"))};var y=ifX(s,h?flushExpr(u,f,'"left"','"right"','"center"'):{value:"center"},ifRight(s,"left","right"));var _=ifX(s,ifTop(s,"bottom","top"),h?flushExpr(u,f,'"top"','"bottom"','"middle"'):{value:"middle"});var b=flushExpr(u,f,"-(".concat(c,")"),c,0);h=h&&c;var x={opacity:zero$1,x:ifX(s,v,m),y:ifY(s,v,m)};var E={enter:x,update:g={opacity:one,text:{field:Label},x:x.x,y:x.y,align:y,baseline:_},exit:{opacity:zero$1,x:x.x,y:x.y}};addEncoders(E,{dx:!d&&h?ifX(s,b):null,dy:!p&&h?ifY(s,b):null});addEncoders(E,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:p});var S=o("labelBound");var $=o("labelOverlap");$=$||S?{separation:o("labelSeparation"),method:$,order:"datum.index",bound:S?{scale:u,orient:s,tolerance:S}:null}:undefined;if(g.align!==y){g.align=patch(g.align,y)}if(g.baseline!==_){g.baseline=patch(g.baseline,_)}return guideMark({type:TextMark,role:AxisLabelRole,style:GuideLabelStyle,key:Value,from:r,encode:E,overlap:$},n)}function axisTitle(e,t,n,r){var i=lookup(e,t),a=e.orient,o=getSign(a,-1,1);var s,u;var l={enter:s={opacity:zero$1,anchor:encoder(i("titleAnchor",null)),align:{signal:alignExpr}},update:u=extend$1({},s,{opacity:one,text:encoder(e.title)}),exit:{opacity:zero$1}};var f={signal:'lerp(range("'.concat(e.scale,'"), ').concat(anchorExpr(0,1,.5),")")};u.x=ifX(a,f);u.y=ifY(a,f);s.angle=ifX(a,zero$1,mult(o,90));s.baseline=ifX(a,ifTop(a,Bottom,Top),{value:Bottom});u.angle=s.angle;u.baseline=s.baseline;addEncoders(l,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")});autoLayout(i,a,l,n);l.update.align=patch(l.update.align,s.align);l.update.angle=patch(l.update.angle,s.angle);l.update.baseline=patch(l.update.baseline,s.baseline);return guideMark({type:TextMark,role:AxisTitleRole,style:GuideTitleStyle,from:r,encode:l},n)}function autoLayout(e,t,n,r){var i=function(e,t){return e!=null?(n.update[t]=patch(encoder(e),n.update[t]),false):!has(t,r)?true:false};var a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?encoder(o):ifX(t,encoder(o),encoder(a))}function parseAxis$1(e,t){var n=axisConfig(e,t),r=e.encode||{},i=r.axis||{},a=i.name||undefined,o=i.interactive,s=i.style,u=lookup(e,n),l=tickBand(u);var f={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null};var c=ref(t.add(Collect({},[f])));var d=ref(t.add(AxisTicks({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));var p=[];var h;if(f.grid){p.push(axisGrid(e,n,r.grid,d,l))}if(f.ticks){h=u("tickSize");p.push(axisTicks(e,n,r.ticks,d,h,l))}if(f.labels){h=f.ticks?h:0;p.push(axisLabels(e,n,r.labels,d,h,l))}if(f.domain){p.push(axisDomain(e,n,r.domain,c))}if(f.title){p.push(axisTitle(e,n,r.title,c))}return parseMark(guideGroup({role:AxisRole,from:c,encode:extendEncode(buildAxisEncode(u,e),i,Skip),marks:p,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:a,interactive:o,style:s}),t)}function buildAxisEncode(e,t){var n={enter:{},update:{}};addEncoders(n,{orient:e("orient"),offset:e("offset")||0,position:value(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType});return n}function parseScope(e,t,n){var r=array$5(e.signals),i=array$5(e.scales);if(!n)r.forEach((function(e){return parseSignal(e,t)}));array$5(e.projections).forEach((function(e){return parseProjection$1(e,t)}));i.forEach((function(e){return initScale(e,t)}));array$5(e.data).forEach((function(e){return parseData$1$1(e,t)}));i.forEach((function(e){return parseScale(e,t)}));(n||r).forEach((function(e){return parseSignalUpdates(e,t)}));array$5(e.axes).forEach((function(e){return parseAxis$1(e,t)}));array$5(e.marks).forEach((function(e){return parseMark(e,t)}));array$5(e.legends).forEach((function(e){return parseLegend$1(e,t)}));if(e.title)parseTitle(e.title,t);t.parseLambdas();return t}var rootEncode=function(e){return extendEncode({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e)};function parseView(e,t){var n=t.config;var r=ref(t.root=t.add(operator()));var i=collectSignals(e,n);i.forEach((function(e){return parseSignal(e,t)}));t.description=e.description||n.description;t.eventConfig=n.events;t.legends=t.objectProperty(n.legend&&n.legend.layout);t.locale=n.locale;var a=t.add(Collect());var o=t.add(Encode(parseEncode(rootEncode(e.encode),GroupMark,FrameRole,e.style,t,{pulse:ref(a)})));var s=t.add(ViewLayout({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:ref(o)}));t.operators.pop();t.pushState(ref(o),ref(s),null);parseScope(e,t,i);t.operators.push(s);var u=t.add(Bound({mark:r,pulse:ref(s)}));u=t.add(Render({pulse:ref(u)}));u=t.add(Sieve({pulse:ref(u)}));t.addData("root",new DataScope(t,a,a,u));return t}function signalObject(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function collectSignals(e,t){var n=function(n){return value(e[n],t[n])},r=[signalObject("background",n("background")),signalObject("autosize",parseAutosize(n("autosize"))),signalObject("padding",parsePadding(n("padding"))),signalObject("width",n("width")||0),signalObject("height",n("height")||0)],i=r.reduce((function(e,t){return e[t.name]=t,e}),{}),a={};array$5(e.signals).forEach((function(e){if(has$1(i,e.name)){e=extend$1(i[e.name],e)}else{r.push(e)}a[e.name]=e}));array$5(t.signals).forEach((function(e){if(!has$1(a,e.name)&&!has$1(i,e.name)){r.push(e)}}));return r}function Scope$1(e,t){this.config=e||{};this.options=t||{};this.bindings=[];this.field={};this.signals={};this.lambdas={};this.scales={};this.events={};this.data={};this.streams=[];this.updates=[];this.operators=[];this.eventConfig=null;this.locale=null;this._id=0;this._subid=0;this._nextsub=[0];this._parent=[];this._encode=[];this._lookup=[];this._markpath=[]}function Subscope(e){this.config=e.config;this.options=e.options;this.legends=e.legends;this.field=Object.create(e.field);this.signals=Object.create(e.signals);this.lambdas=Object.create(e.lambdas);this.scales=Object.create(e.scales);this.events=Object.create(e.events);this.data=Object.create(e.data);this.streams=[];this.updates=[];this.operators=[];this._id=0;this._subid=++e._nextsub[0];this._nextsub=e._nextsub;this._parent=e._parent.slice();this._encode=e._encode.slice();this._lookup=e._lookup.slice();this._markpath=e._markpath}Scope$1.prototype=Subscope.prototype={parse:function(e){return parseScope(e,this)},fork:function(){return new Subscope(this)},isSubscope:function(){return this._subid>0},toRuntime:function(){this.finish();return{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id:function(){return(this._subid?this._subid+":":0)+this._id++},add:function(e){this.operators.push(e);e.id=this.id();if(e.refs){e.refs.forEach((function(t){t.$ref=e.id}));e.refs=null}return e},proxy:function(e){var t=e instanceof Entry?ref(e):e;return this.add(Proxy({value:t}))},addStream:function(e){this.streams.push(e);e.id=this.id();return e},addUpdate:function(e){this.updates.push(e);return e},finish:function(){var e,t;if(this.root)this.root.root=true;for(e in this.signals){this.signals[e].signal=e}for(e in this.scales){this.scales[e].scale=e}function n(e,t,n){var r,i;if(e){r=e.data||(e.data={});i=r[t]||(r[t]=[]);i.push(n)}}for(e in this.data){t=this.data[e];n(t.input,e,"input");n(t.output,e,"output");n(t.values,e,"values");for(var r in t.index){n(t.index[r],e,"index:"+r)}}return this},pushState:function(e,t,n){this._encode.push(ref(this.add(Sieve({pulse:e}))));this._parent.push(t);this._lookup.push(n?ref(this.proxy(n)):null);this._markpath.push(-1)},popState:function(){this._encode.pop();this._parent.pop();this._lookup.pop();this._markpath.pop()},parent:function(){return peek$1(this._parent)},encode:function(){return peek$1(this._encode)},lookup:function(){return peek$1(this._lookup)},markpath:function(){var e=this._markpath;return++e[e.length-1]},fieldRef:function(e,t){if(isString(e))return fieldRef(e,t);if(!e.signal){error("Unsupported field reference: "+$$1(e))}var n=e.signal;var r=this.field[n];if(!r){var i={name:this.signalRef(n)};if(t)i.as=t;this.field[n]=r=ref(this.add(Field(i)))}return r},compareRef:function(e){var t=this;var n=false;var r=function(e){return isSignal(e)?(n=true,t.signalRef(e.signal)):isExpr(e)?(n=true,t.exprRef(e.expr)):e};var i=array$5(e.field).map(r),a=array$5(e.order).map(r);return n?ref(this.add(Compare({fields:i,orders:a}))):compareRef(i,a)},keyRef:function(e,t){var n=false;var r=function(e){return isSignal(e)?(n=true,ref(i[e.signal])):e};var i=this.signals;e=array$5(e).map(r);return n?ref(this.add(Key({fields:e,flat:t}))):keyRef(e,t)},sortRef:function(e){if(!e)return e;var t=aggrField(e.op,e.field),n=e.order||Ascending;return n.signal?ref(this.add(Compare({fields:t,orders:this.signalRef(n.signal)}))):compareRef(t,n)},event:function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t});this.events[n]=r}return this.events[n]},hasOwnSignal:function(e){return has$1(this.signals,e)},addSignal:function(e,t){if(this.hasOwnSignal(e)){error("Duplicate signal name: "+$$1(e))}var n=t instanceof Entry?t:this.add(operator(t));return this.signals[e]=n},getSignal:function(e){if(!this.signals[e]){error("Unrecognized signal name: "+$$1(e))}return this.signals[e]},signalRef:function(e){if(this.signals[e]){return ref(this.signals[e])}else if(!has$1(this.lambdas,e)){this.lambdas[e]=this.add(operator(null))}return ref(this.lambdas[e])},parseLambdas:function(){var e=Object.keys(this.lambdas);for(var t=0,n=e.length;t<n;++t){var r=e[t],i=parser(r,this),a=this.lambdas[r];a.params=i.$params;a.update=i.$expr}},property:function(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty:function(e){return!e||!isObject(e)?e:this.signalRef(e.signal||propertyLambda(e))},exprRef:function(e,t){var n={expr:parser(e,this)};if(t)n.expr.$name=t;return ref(this.add(Expression(n)))},addBinding:function(e,t){if(!this.bindings){error("Nested signals do not support binding: "+$$1(e))}this.bindings.push(extend$1({signal:e},t))},addScaleProj:function(e,t){if(has$1(this.scales,e)){error("Duplicate scale or projection name: "+$$1(e))}this.scales[e]=this.add(t)},addScale:function(e,t){this.addScaleProj(e,Scale(t))},addProjection:function(e,t){this.addScaleProj(e,Projection(t))},getScale:function(e){if(!this.scales[e]){error("Unrecognized scale name: "+$$1(e))}return this.scales[e]},scaleRef:function(e){return ref(this.getScale(e))},scaleType:function(e){return this.getScale(e).params.type},projectionRef:function(e){return this.scaleRef(e)},projectionType:function(e){return this.scaleType(e)},addData:function(e,t){if(has$1(this.data,e)){error("Duplicate data set name: "+$$1(e))}return this.data[e]=t},getData:function(e){if(!this.data[e]){error("Undefined data set name: "+$$1(e))}return this.data[e]},addDataPipeline:function(e,t){if(has$1(this.data,e)){error("Duplicate data set name: "+$$1(e))}return this.addData(e,DataScope.fromEntries(this,t))}};function propertyLambda(e){return(isArray(e)?arrayLambda:objectLambda)(e)}function arrayLambda(e){var t=e.length;var n="[";for(var r=0;r<t;++r){var i=e[r];n+=(r>0?",":"")+(isObject(i)?i.signal||propertyLambda(i):$$1(i))}return n+"]"}function objectLambda(e){var t="{",n=0,r,i;for(r in e){i=e[r];t+=(++n>1?",":"")+$$1(r)+":"+(isObject(i)?i.signal||propertyLambda(i):$$1(i))}return t+"}"}function defaults(){var e="sans-serif",t=30,n=2,r="#4c78a8",i="#000",a="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:r},area:{fill:r},image:null,line:{stroke:r,strokeWidth:n},path:{stroke:r},rect:{fill:r},rule:{stroke:i},shape:{stroke:r},symbol:{fill:r,size:64},text:{fill:i,font:e,fontSize:11},trail:{fill:r,size:n},style:{"guide-label":{fill:i,font:e,fontSize:10},"guide-title":{fill:i,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:i,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:i,font:e,fontSize:12},point:{size:t,strokeWidth:n,shape:"circle"},circle:{size:t,strokeWidth:n},square:{size:t,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:true,domainWidth:1,domainColor:a,grid:false,gridWidth:1,gridColor:o,labels:true,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:true,tickColor:a,tickOffset:0,tickRound:true,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:true,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:a,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function parse$1(e,t,n){if(!isObject(e)){error("Input Vega specification must be an object.")}t=mergeConfig(defaults(),t,e.config);return parseView(e,new Scope$1(t,n)).toRuntime()}var name$2="vega";var version$1$1="5.20.2";var description$3="The Vega visualization grammar.";var keywords$1=["vega","visualization","interaction","dataflow","library","data","d3"];var license$2="BSD-3-Clause";var author$2="UW Interactive Data Lab (http://idl.cs.washington.edu)";var main$3="build/vega-node.js";var module$2="build/vega.module.js";var unpkg$2="build/vega.min.js";var jsdelivr$2="build/vega.min.js";var types$2="index.d.ts";var repository$2="vega/vega";var scripts$2={bundle:"rollup -c --config-bundle",prebuild:"rimraf build && rimraf build-es5",build:"rollup -c --config-core --config-bundle --config-ie",postbuild:"node schema-copy",pretest:"yarn build --config-test",test:"TZ=America/Los_Angeles tape 'test/**/*-test.js'",prepublishOnly:"yarn test && yarn build",postpublish:"./schema-deploy.sh"};var dependencies$1={"vega-crossfilter":"~4.0.5","vega-dataflow":"~5.7.4","vega-encode":"~4.8.3","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-force":"~4.0.7","vega-format":"~1.0.4","vega-functions":"~5.12.0","vega-geo":"~4.3.8","vega-hierarchy":"~4.0.9","vega-label":"~1.0.0","vega-loader":"~4.4.0","vega-parser":"~6.1.3","vega-projection":"~1.4.5","vega-regression":"~1.0.9","vega-runtime":"~6.1.3","vega-scale":"~7.1.1","vega-scenegraph":"~4.9.4","vega-statistics":"~1.7.9","vega-time":"~2.0.4","vega-transforms":"~4.9.4","vega-typings":"~0.21.0","vega-util":"~1.16.1","vega-view":"~5.10.1","vega-view-transforms":"~4.5.8","vega-voronoi":"~4.1.5","vega-wordcloud":"~4.1.3"};var devDependencies$2={"vega-schema":"*"};var gitHead="e251dbc61ab6645689d9f349e7dd9d15ddb85bce";var pkg$2={name:name$2,version:version$1$1,description:description$3,keywords:keywords$1,license:license$2,author:author$2,main:main$3,module:module$2,unpkg:unpkg$2,jsdelivr:jsdelivr$2,types:types$2,repository:repository$2,scripts:scripts$2,dependencies:dependencies$1,devDependencies:devDependencies$2,gitHead:gitHead};extend$1(transforms,tx,vtx,encode$1,geo,force,label,tree,reg,voronoi,wordcloud,xf);var version$4=pkg$2.version;var vegaImport=Object.freeze({__proto__:null,version:version$4,Dataflow:Dataflow,EventStream:EventStream,MultiPulse:MultiPulse,Operator:Operator,Parameters:Parameters,Pulse:Pulse,Transform:Transform,changeset:changeset,definition:definition$1,ingest:ingest$1,isTuple:isTuple,transform:transform$2,transforms:transforms,tupleid:tupleid,interpolate:interpolate$1,interpolateColors:interpolateColors,interpolateRange:interpolateRange$1,quantizeInterpolator:quantizeInterpolator,scale:scale$4,scheme:scheme$1,projection:projection,View:View$1,defaultLocale:defaultLocale,formatLocale:numberFormatDefaultLocale,locale:locale,resetDefaultLocale:resetDefaultLocale,timeFormatLocale:timeFormatDefaultLocale,expressionFunction:expressionFunction,parse:parse$1,runtimeContext:context,codegenExpression:codegen,parseExpression:parser$1,parseSelector:eventSelector,Debug:Debug,Error:Error$1,Info:Info,None:None$2,Warn:Warn,accessor:accessor,accessorFields:accessorFields,accessorName:accessorName,array:array$5,ascending:ascending$3,clampRange:clampRange,compare:compare$1,constant:constant$4,debounce:debounce,error:error,extend:extend$1,extent:extent,extentIndex:extentIndex,falsy:falsy,fastmap:fastmap,field:field$1,flush:flush,hasOwnProperty:has$1,id:id,identity:identity$6,inherits:inherits,inrange:inrange,isArray:isArray,isBoolean:isBoolean$2,isDate:isDate$1,isFunction:isFunction,isIterable:isIterable,isNumber:isNumber$1,isObject:isObject,isRegExp:isRegExp,isString:isString,key:key,lerp:lerp,logger:logger,lruCache:lruCache,merge:merge$3,mergeConfig:mergeConfig,one:one$2,pad:pad$2,panLinear:panLinear,panLog:panLog,panPow:panPow,panSymlog:panSymlog,peek:peek$1,quarter:quarter,repeat:repeat,span:span,splitAccessPath:splitAccessPath,stringValue:$$1,toBoolean:toBoolean,toDate:toDate,toNumber:toNumber,toSet:toSet,toString:toString,truncate:truncate$1,truthy:truthy,utcquarter:utcquarter,visitArray:visitArray,writeConfig:writeConfig,zero:zero$3,zoomLinear:zoomLinear,zoomLog:zoomLog,zoomPow:zoomPow,zoomSymlog:zoomSymlog,bandwidthNRD:estimateBandwidth,bin:bin$1,bootstrapCI:bootstrapCI,cumulativeLogNormal:cumulativeLogNormal,cumulativeNormal:cumulativeNormal,cumulativeUniform:cumulativeUniform,densityLogNormal:densityLogNormal,densityNormal:densityNormal,densityUniform:densityUniform,dotbin:dotbin,quantileLogNormal:quantileLogNormal,quantileNormal:quantileNormal,quantileUniform:quantileUniform,quantiles:quantiles,quartiles:quartiles,get random(){return random},randomInteger:integer,randomKDE:kde,randomLCG:lcg$1,randomLogNormal:lognormal,randomMixture:mixture$1,randomNormal:gaussian,randomUniform:uniform,regressionExp:exp$1,regressionLinear:linear$2,regressionLoess:loess,regressionLog:log$3,regressionPoly:poly,regressionPow:pow$3,regressionQuad:quad,sampleCurve:sampleCurve,sampleLogNormal:sampleLogNormal,sampleNormal:sampleNormal,sampleUniform:sampleUniform,setRandom:setRandom,DATE:DATE,DAY:DAY,DAYOFYEAR:DAYOFYEAR,HOURS:HOURS,MILLISECONDS:MILLISECONDS,MINUTES:MINUTES,MONTH:MONTH,QUARTER:QUARTER,SECONDS:SECONDS,TIME_UNITS:TIME_UNITS,WEEK:WEEK,YEAR:YEAR,dayofyear:dayofyear,timeBin:bin$2,timeFloor:timeFloor,timeInterval:timeInterval,timeOffset:timeOffset,timeSequence:timeSequence,timeUnitSpecifier:timeUnitSpecifier,timeUnits:timeUnits,utcFloor:utcFloor,utcInterval:utcInterval,utcOffset:utcOffset,utcSequence:utcSequence,utcdayofyear:utcdayofyear,utcweek:utcweek,week:week,read:read,inferType:inferType,inferTypes:inferTypes,typeParsers:typeParsers,format:format$3,formats:formats$1,responseType:responseType,loader:loader,Bounds:Bounds,CanvasHandler:CanvasHandler,CanvasRenderer:CanvasRenderer,Gradient:Gradient$1,GroupItem:GroupItem,Handler:Handler$1,Item:Item,Marks:Marks,RenderType:RenderType,Renderer:Renderer,ResourceLoader:ResourceLoader,SVGHandler:SVGHandler,SVGRenderer:SVGRenderer,SVGStringRenderer:SVGStringRenderer,Scenegraph:Scenegraph,boundClip:boundClip,boundContext:boundContext,boundItem:boundItem$1,boundMark:boundMark,boundStroke:boundStroke,domChild:domChild,domClear:domClear,domCreate:domCreate,domFind:domFind,font:font$1,fontFamily:fontFamily,fontSize:fontSize,intersect:intersect$2,intersectBoxLine:intersectBoxLine,intersectPath:intersectPath,intersectPoint:intersectPoint,intersectRule:intersectRule,lineHeight:lineHeight,markup:markup,multiLineOffset:multiLineOffset,pathCurves:curves,pathEqual:pathEqual,pathParse:pathParse,pathRectangle:vg_rect,pathRender:pathRender,pathSymbols:symbols$1,pathTrail:vg_trail,point:point$2,renderModule:renderModule,resetSVGClipId:resetSVGClipId,resetSVGDefIds:resetSVGDefIds,sceneEqual:sceneEqual,sceneFromJSON:sceneFromJSON,scenePickVisit:pickVisit,sceneToJSON:sceneToJSON,sceneVisit:visit,sceneZOrder:zorder,serializeXML:serializeXML,textMetrics:textMetrics});var name$1="vega-lite";var author$1='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer';var version$3="5.1.0";var collaborators=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"];var homepage="https://vega.github.io/vega-lite/";var description$2="Vega-Lite is a concise high-level language for interactive visualization.";var main$2="build/vega-lite.js";var unpkg$1="build/vega-lite.min.js";var jsdelivr$1="build/vega-lite.min.js";var module$1="build/src/index";var types$1="build/src/index.d.ts";var bin={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"};var directories={test:"test"};var files$1=["bin","build","src","vega-lite*","tsconfig.json"];var scripts$1={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:cover":"jest --collectCoverage test/","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"jest --watch test/"};var repository$1={type:"git",url:"https://github.com/vega/vega-lite.git"};var license$1="BSD-3-Clause";var bugs={url:"https://github.com/vega/vega-lite/issues"};var devDependencies$1={"@babel/core":"^7.13.15","@babel/preset-env":"^7.13.15","@babel/preset-typescript":"^7.13.0","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^18.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.1","@types/chai":"^4.2.16","@types/d3":"^6.3.0","@types/jest":"^26.0.22","@types/mkdirp":"^1.0.1","@types/pako":"^1.0.1","@typescript-eslint/eslint-plugin":"^4.22.0","@typescript-eslint/parser":"^4.22.0",ajv:"^8.1.0","ajv-formats":"^2.0.2",chai:"^4.3.4",cheerio:"^1.0.0-rc.6","conventional-changelog-cli":"^2.1.1",d3:"^6.7.0","del-cli":"^3.0.1",eslint:"^7.24.0","eslint-config-prettier":"^8.2.0","eslint-plugin-jest":"^24.3.5","eslint-plugin-prettier":"^3.4.0","gh-pages":"^3.1.0","highlight.js":"^10.7.2",jest:"^26.6.3","jest-dev-server":"^5.0.0",mkdirp:"^1.0.4",pako:"^2.0.3",prettier:"^2.2.1",puppeteer:"^8.0.0",rollup:"^2.45.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^11.3.2",terser:"^5.6.1","ts-json-schema-generator":"^0.90.0",typescript:"~4.2.4","vega-cli":"^5.20.2","vega-datasets":"~2.2.0","vega-embed":"^6.17.0","vega-tooltip":"^0.25.1","yaml-front-matter":"^4.1.1"};var dependencies={"@types/clone":"~2.1.0","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.2.0","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-util":"~1.16.1",yargs:"~16.2.0"};var peerDependencies$1={vega:"^5.20.0"};var jest={testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:false,setupFiles:["./test/jest.overrides.ts"]};var pkg$1={name:name$1,author:author$1,version:version$3,collaborators:collaborators,homepage:homepage,description:description$2,main:main$2,unpkg:unpkg$1,jsdelivr:jsdelivr$1,module:module$1,types:types$1,bin:bin,directories:directories,files:files$1,scripts:scripts$1,repository:repository$1,license:license$1,bugs:bugs,devDependencies:devDependencies$1,dependencies:dependencies,peerDependencies:peerDependencies$1,jest:jest};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var clone_1=createCommonjsModule((function(e){var t=function(){function e(e,t){return t!=null&&e instanceof t}var t;try{t=Map}catch(f){t=function(){}}var n;try{n=Set}catch(f){n=function(){}}var r;try{r=Promise}catch(f){r=function(){}}function i(a,o,s,u,f){if(typeof o==="object"){s=o.depth;u=o.prototype;f=o.includeNonEnumerable;o=o.circular}var c=[];var d=[];var p=typeof Buffer!="undefined";if(typeof o=="undefined")o=true;if(typeof s=="undefined")s=Infinity;function h(a,s){if(a===null)return null;if(s===0)return a;var g;var m;if(typeof a!="object"){return a}if(e(a,t)){g=new t}else if(e(a,n)){g=new n}else if(e(a,r)){g=new r((function(e,t){a.then((function(t){e(h(t,s-1))}),(function(e){t(h(e,s-1))}))}))}else if(i.__isArray(a)){g=[]}else if(i.__isRegExp(a)){g=new RegExp(a.source,l(a));if(a.lastIndex)g.lastIndex=a.lastIndex}else if(i.__isDate(a)){g=new Date(a.getTime())}else if(p&&Buffer.isBuffer(a)){if(Buffer.allocUnsafe){g=Buffer.allocUnsafe(a.length)}else{g=new Buffer(a.length)}a.copy(g);return g}else if(e(a,Error)){g=Object.create(a)}else{if(typeof u=="undefined"){m=Object.getPrototypeOf(a);g=Object.create(m)}else{g=Object.create(u);m=u}}if(o){var v=c.indexOf(a);if(v!=-1){return d[v]}c.push(a);d.push(g)}if(e(a,t)){a.forEach((function(e,t){var n=h(t,s-1);var r=h(e,s-1);g.set(n,r)}))}if(e(a,n)){a.forEach((function(e){var t=h(e,s-1);g.add(t)}))}for(var y in a){var _;if(m){_=Object.getOwnPropertyDescriptor(m,y)}if(_&&_.set==null){continue}g[y]=h(a[y],s-1)}if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(a);for(var y=0;y<b.length;y++){var x=b[y];var E=Object.getOwnPropertyDescriptor(a,x);if(E&&!E.enumerable&&!f){continue}g[x]=h(a[x],s-1);if(!E.enumerable){Object.defineProperty(g,x,{enumerable:false})}}}if(f){var S=Object.getOwnPropertyNames(a);for(var y=0;y<S.length;y++){var $=S[y];var E=Object.getOwnPropertyDescriptor(a,$);if(E&&E.enumerable){continue}g[$]=h(a[$],s-1);Object.defineProperty(g,$,{enumerable:false})}}return g}return h(a,s)}i.clonePrototype=function e(t){if(t===null)return null;var n=function(){};n.prototype=t;return new n};function a(e){return Object.prototype.toString.call(e)}i.__objToStr=a;function o(e){return typeof e==="object"&&a(e)==="[object Date]"}i.__isDate=o;function s(e){return typeof e==="object"&&a(e)==="[object Array]"}i.__isArray=s;function u(e){return typeof e==="object"&&a(e)==="[object RegExp]"}i.__isRegExp=u;function l(e){var t="";if(e.global)t+="g";if(e.ignoreCase)t+="i";if(e.multiline)t+="m";return t}i.__getRegExpFlags=l;return i}();if(e.exports){e.exports=t}}));var fastDeepEqual=function e(t,n){if(t===n)return true;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return false;var r,i,a;if(Array.isArray(t)){r=t.length;if(r!=n.length)return false;for(i=r;i--!==0;)if(!e(t[i],n[i]))return false;return true}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();a=Object.keys(t);r=a.length;if(r!==Object.keys(n).length)return false;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return false;for(i=r;i--!==0;){var o=a[i];if(!e(t[o],n[o]))return false}return true}return t!==t&&n!==n};var fastJsonStableStringify=function(e,t){if(!t)t={};if(typeof t==="function")t={cmp:t};var n=typeof t.cycles==="boolean"?t.cycles:false;var r=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]};var a={key:r,value:t[r]};return e(i,a)}}}(t.cmp);var i=[];return function e(t){if(t&&t.toJSON&&typeof t.toJSON==="function"){t=t.toJSON()}if(t===undefined)return;if(typeof t=="number")return isFinite(t)?""+t:"null";if(typeof t!=="object")return JSON.stringify(t);var a,o;if(Array.isArray(t)){o="[";for(a=0;a<t.length;a++){if(a)o+=",";o+=e(t[a])||"null"}return o+"]"}if(t===null)return"null";if(i.indexOf(t)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=i.push(t)-1;var u=Object.keys(t).sort(r&&r(t));o="";for(a=0;a<u.length;a++){var l=u[a];var f=e(t[l]);if(!f)continue;if(o)o+=",";o+=JSON.stringify(l)+":"+f}i.splice(s,1);return"{"+o+"}"}(e)};function isLogicalOr(e){return!!e.or}function isLogicalAnd(e){return!!e.and}function isLogicalNot(e){return!!e.not}function forEachLeaf(e,t){if(isLogicalNot(e)){forEachLeaf(e.not,t)}else if(isLogicalAnd(e)){for(var n=0,r=e.and;n<r.length;n++){var i=r[n];forEachLeaf(i,t)}}else if(isLogicalOr(e)){for(var a=0,o=e.or;a<o.length;a++){var i=o[a];forEachLeaf(i,t)}}else{t(e)}}function normalizeLogicalComposition(e,t){if(isLogicalNot(e)){return{not:normalizeLogicalComposition(e.not,t)}}else if(isLogicalAnd(e)){return{and:e.and.map((function(e){return normalizeLogicalComposition(e,t)}))}}else if(isLogicalOr(e)){return{or:e.or.map((function(e){return normalizeLogicalComposition(e,t)}))}}else{return t(e)}}var deepEqual=fastDeepEqual;var duplicate=clone_1;function pick(e,t){var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];if(has$1(e,a)){n[a]=e[a]}}return n}function omit(e,t){var n=__assign({},e);for(var r=0,i=t;r<i.length;r++){var a=i[r];delete n[a]}return n}Set.prototype["toJSON"]=function(){return"Set("+__spreadArray([],this).map((function(e){return fastJsonStableStringify(e)})).join(",")+")"};var stringify$1=fastJsonStableStringify;function hash(e){if(isNumber$1(e)){return e}var t=isString(e)?e:fastJsonStableStringify(e);if(t.length<250){return t}var n=0;for(var r=0;r<t.length;r++){var i=t.charCodeAt(r);n=(n<<5)-n+i;n=n&n}return n}function isNullOrFalse(e){return e===false||e===null}function contains(e,t){return e.includes(t)}function some(e,t){var n=0;for(var r=0,i=e.entries();r<i.length;r++){var a=i[r],o=a[0],s=a[1];if(t(s,o,n++)){return true}}return false}function every(e,t){var n=0;for(var r=0,i=e.entries();r<i.length;r++){var a=i[r],o=a[0],s=a[1];if(!t(s,o,n++)){return false}}return true}function mergeDeep$1(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}for(var r=0,i=t;r<i.length;r++){var a=i[r];deepMerge_$1(e,a!==null&&a!==void 0?a:{})}return e}function deepMerge_$1(e,t){for(var n=0,r=keys$1(t);n<r.length;n++){var i=r[n];writeConfig(e,i,t[i],true)}}function unique(e,t){var n=[];var r={};var i;for(var a=0,o=e;a<o.length;a++){var s=o[a];i=t(s);if(i in r){continue}r[i]=1;n.push(s)}return n}function isEqual(e,t){var n=keys$1(e);var r=keys$1(t);if(n.length!==r.length){return false}for(var i=0,a=n;i<a.length;i++){var o=a[i];if(e[o]!==t[o]){return false}}return true}function setEqual(e,t){if(e.size!==t.size){return false}for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!t.has(i)){return false}}return true}function hasIntersection(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(t.has(i)){return true}}return false}function prefixGenerator(e){var t=new Set;var n=function(e){var n=splitAccessPath(e);var r=n.map((function(e,t){return t===0?e:"["+e+"]"}));var i=r.map((function(e,t){return r.slice(0,t+1).join("")}));for(var a=0,o=i;a<o.length;a++){var s=o[a];t.add(s)}};for(var r=0,i=e;r<i.length;r++){var a=i[r];n(a)}return t}function fieldIntersection(e,t){if(e===undefined||t===undefined){return true}return hasIntersection(prefixGenerator(e),prefixGenerator(t))}function isEmpty(e){return keys$1(e).length===0}var keys$1=Object.keys;var vals=Object.values;var entries$1=Object.entries;function isBoolean(e){return e===true||e===false}function varName(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function logicalExpr(e,t){if(isLogicalNot(e)){return"!("+logicalExpr(e.not,t)+")"}else if(isLogicalAnd(e)){return"("+e.and.map((function(e){return logicalExpr(e,t)})).join(") && (")+")"}else if(isLogicalOr(e)){return"("+e.or.map((function(e){return logicalExpr(e,t)})).join(") || (")+")"}else{return t(e)}}function deleteNestedProperty(e,t){if(t.length===0){return true}var n=t.shift();if(n in e&&deleteNestedProperty(e[n],t)){delete e[n]}return isEmpty(e)}function titleCase(e){return e.charAt(0).toUpperCase()+e.substr(1)}function accessPathWithDatum(e,t){if(t===void 0){t="datum"}var n=splitAccessPath(e);var r=[];for(var i=1;i<=n.length;i++){var a="["+n.slice(0,i).map($$1).join("][")+"]";r.push(""+t+a)}return r.join(" && ")}function flatAccessWithDatum(e,t){if(t===void 0){t="datum"}return t+"["+$$1(splitAccessPath(e).join("."))+"]"}function escapePathAccess(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function replacePathInField(e){return""+splitAccessPath(e).map(escapePathAccess).join("\\.")}function replaceAll(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function removePathFromField(e){return""+splitAccessPath(e).join(".")}function accessPathDepth(e){if(!e){return 0}return splitAccessPath(e).length}function getFirstDefined(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i!==undefined){return i}}return undefined}var idCounter=42;function uniqueId(e){var t=++idCounter;return e?String(e)+t:t}function resetIdCounter(){idCounter=42}function internalField(e){return isInternalField(e)?e:"__"+e}function isInternalField(e){return e.startsWith("__")}function normalizeAngle(e){if(e===undefined){return undefined}return(e%360+360)%360}function isNumeric(e){if(isNumber$1(e)){return true}return!isNaN(e)&&!isNaN(parseFloat(e))}var ROW="row";var COLUMN="column";var FACET="facet";var X="x";var Y="y";var X2="x2";var Y2="y2";var RADIUS="radius";var RADIUS2="radius2";var THETA="theta";var THETA2="theta2";var LATITUDE="latitude";var LONGITUDE="longitude";var LATITUDE2="latitude2";var LONGITUDE2="longitude2";var COLOR="color";var FILL="fill";var STROKE="stroke";var SHAPE="shape";var SIZE="size";var ANGLE="angle";var OPACITY="opacity";var FILLOPACITY="fillOpacity";var STROKEOPACITY="strokeOpacity";var STROKEWIDTH="strokeWidth";var STROKEDASH="strokeDash";var TEXT$1="text";var ORDER="order";var DETAIL="detail";var KEY="key";var TOOLTIP="tooltip";var HREF="href";var URL$1="url";var DESCRIPTION="description";var POSITION_CHANNEL_INDEX={x:1,y:1,x2:1,y2:1};var POLAR_POSITION_CHANNEL_INDEX={theta:1,theta2:1,radius:1,radius2:1};function isPolarPositionChannel(e){return e in POLAR_POSITION_CHANNEL_INDEX}var GEO_POSIITON_CHANNEL_INDEX={longitude:1,longitude2:1,latitude:1,latitude2:1};function getPositionChannelFromLatLong(e){switch(e){case LATITUDE:return"y";case LATITUDE2:return"y2";case LONGITUDE:return"x";case LONGITUDE2:return"x2"}}function isGeoPositionChannel(e){return e in GEO_POSIITON_CHANNEL_INDEX}var GEOPOSITION_CHANNELS=keys$1(GEO_POSIITON_CHANNEL_INDEX);var UNIT_CHANNEL_INDEX=__assign(__assign(__assign(__assign({},POSITION_CHANNEL_INDEX),POLAR_POSITION_CHANNEL_INDEX),GEO_POSIITON_CHANNEL_INDEX),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function isColorChannel(e){return e===COLOR||e===FILL||e===STROKE}var FACET_CHANNEL_INDEX={row:1,column:1,facet:1};var FACET_CHANNELS=keys$1(FACET_CHANNEL_INDEX);var CHANNEL_INDEX=__assign(__assign({},UNIT_CHANNEL_INDEX),FACET_CHANNEL_INDEX);var CHANNELS=keys$1(CHANNEL_INDEX);var _o=CHANNEL_INDEX.order,_d=CHANNEL_INDEX.detail,_tt1=CHANNEL_INDEX.tooltip,SINGLE_DEF_CHANNEL_INDEX=__rest(CHANNEL_INDEX,["order","detail","tooltip"]);var _r=SINGLE_DEF_CHANNEL_INDEX.row,_c=SINGLE_DEF_CHANNEL_INDEX.column,_f=SINGLE_DEF_CHANNEL_INDEX.facet,SINGLE_DEF_UNIT_CHANNEL_INDEX=__rest(SINGLE_DEF_CHANNEL_INDEX,["row","column","facet"]);function isSingleDefUnitChannel(e){return!!SINGLE_DEF_UNIT_CHANNEL_INDEX[e]}function isChannel(e){return!!CHANNEL_INDEX[e]}var SECONDARY_RANGE_CHANNEL=[X2,Y2,LATITUDE2,LONGITUDE2,THETA2,RADIUS2];function isSecondaryRangeChannel(e){var t=getMainRangeChannel(e);return t!==e}function getMainRangeChannel(e){switch(e){case X2:return X;case Y2:return Y;case LATITUDE2:return LATITUDE;case LONGITUDE2:return LONGITUDE;case THETA2:return THETA;case RADIUS2:return RADIUS}return e}function getVgPositionChannel(e){if(isPolarPositionChannel(e)){switch(e){case THETA:return"startAngle";case THETA2:return"endAngle";case RADIUS:return"outerRadius";case RADIUS2:return"innerRadius"}}return e}function getSecondaryRangeChannel(e){switch(e){case X:return X2;case Y:return Y2;case LATITUDE:return LATITUDE2;case LONGITUDE:return LONGITUDE2;case THETA:return THETA2;case RADIUS:return RADIUS2}return undefined}function getSizeChannel$1(e){switch(e){case X:case X2:return"width";case Y:case Y2:return"height"}return undefined}function getOffsetChannel(e){switch(e){case X:return"xOffset";case Y:return"yOffset";case X2:return"x2Offset";case Y2:return"y2Offset";case THETA:return"thetaOffset";case RADIUS:return"radiusOffset";case THETA2:return"theta2Offset";case RADIUS2:return"radius2Offset"}return undefined}var _x=UNIT_CHANNEL_INDEX.x,_y=UNIT_CHANNEL_INDEX.y,_x2=UNIT_CHANNEL_INDEX.x2,_y2=UNIT_CHANNEL_INDEX.y2,_latitude=UNIT_CHANNEL_INDEX.latitude,_longitude=UNIT_CHANNEL_INDEX.longitude,_latitude2=UNIT_CHANNEL_INDEX.latitude2,_longitude2=UNIT_CHANNEL_INDEX.longitude2,_theta=UNIT_CHANNEL_INDEX.theta,_theta2=UNIT_CHANNEL_INDEX.theta2,_radius=UNIT_CHANNEL_INDEX.radius,_radius2=UNIT_CHANNEL_INDEX.radius2,NONPOSITION_CHANNEL_INDEX=__rest(UNIT_CHANNEL_INDEX,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]);var NONPOSITION_CHANNELS=keys$1(NONPOSITION_CHANNEL_INDEX);var POSITION_SCALE_CHANNEL_INDEX={x:1,y:1};var POSITION_SCALE_CHANNELS=keys$1(POSITION_SCALE_CHANNEL_INDEX);function isXorY(e){return e in POSITION_SCALE_CHANNEL_INDEX}var POLAR_POSITION_SCALE_CHANNEL_INDEX={theta:1,radius:1};var POLAR_POSITION_SCALE_CHANNELS=keys$1(POLAR_POSITION_SCALE_CHANNEL_INDEX);function getPositionScaleChannel(e){return e==="width"?X:Y}var _t=NONPOSITION_CHANNEL_INDEX.text,_tt=NONPOSITION_CHANNEL_INDEX.tooltip,_hr=NONPOSITION_CHANNEL_INDEX.href,_u=NONPOSITION_CHANNEL_INDEX.url,_al=NONPOSITION_CHANNEL_INDEX.description,_dd=NONPOSITION_CHANNEL_INDEX.detail,_k=NONPOSITION_CHANNEL_INDEX.key,_oo=NONPOSITION_CHANNEL_INDEX.order,NONPOSITION_SCALE_CHANNEL_INDEX=__rest(NONPOSITION_CHANNEL_INDEX,["text","tooltip","href","url","description","detail","key","order"]);var NONPOSITION_SCALE_CHANNELS=keys$1(NONPOSITION_SCALE_CHANNEL_INDEX);function isNonPositionScaleChannel(e){return!!NONPOSITION_CHANNEL_INDEX[e]}function supportLegend(e){switch(e){case COLOR:case FILL:case STROKE:case SIZE:case SHAPE:case OPACITY:case STROKEWIDTH:case STROKEDASH:return true;case FILLOPACITY:case STROKEOPACITY:case ANGLE:return false}}var SCALE_CHANNEL_INDEX=__assign(__assign(__assign({},POSITION_SCALE_CHANNEL_INDEX),POLAR_POSITION_SCALE_CHANNEL_INDEX),NONPOSITION_SCALE_CHANNEL_INDEX);var SCALE_CHANNELS=keys$1(SCALE_CHANNEL_INDEX);function isScaleChannel(e){return!!SCALE_CHANNEL_INDEX[e]}function supportMark(e,t){return getSupportedMark(e)[t]}var ALL_MARKS={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"};var _g=ALL_MARKS.geoshape,ALL_MARKS_EXCEPT_GEOSHAPE=__rest(ALL_MARKS,["geoshape"]);function getSupportedMark(e){switch(e){case COLOR:case FILL:case STROKE:case DESCRIPTION:case DETAIL:case KEY:case TOOLTIP:case HREF:case ORDER:case OPACITY:case FILLOPACITY:case STROKEOPACITY:case STROKEWIDTH:case FACET:case ROW:case COLUMN:return ALL_MARKS;case X:case Y:case LATITUDE:case LONGITUDE:return ALL_MARKS_EXCEPT_GEOSHAPE;case X2:case Y2:case LATITUDE2:case LONGITUDE2:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case SIZE:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case STROKEDASH:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case SHAPE:return{point:"always",geoshape:"always"};case TEXT$1:return{text:"always"};case ANGLE:return{point:"always",square:"always",text:"always"};case URL$1:return{image:"always"};case THETA:return{text:"always",arc:"always"};case RADIUS:return{text:"always",arc:"always"};case THETA2:case RADIUS2:return{arc:"always"}}}function rangeType(e){switch(e){case X:case Y:case THETA:case RADIUS:case SIZE:case ANGLE:case STROKEWIDTH:case OPACITY:case FILLOPACITY:case STROKEOPACITY:case X2:case Y2:case THETA2:case RADIUS2:return undefined;case FACET:case ROW:case COLUMN:case SHAPE:case STROKEDASH:case TEXT$1:case TOOLTIP:case HREF:case URL$1:case DESCRIPTION:return"discrete";case COLOR:case FILL:case STROKE:return"flexible";case LATITUDE:case LONGITUDE:case LATITUDE2:case LONGITUDE2:case DETAIL:case KEY:case ORDER:return undefined}}var AGGREGATE_OP_INDEX={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};var MULTIDOMAIN_SORT_OP_INDEX={count:1,min:1,max:1};function isArgminDef(e){return!!e&&!!e["argmin"]}function isArgmaxDef(e){return!!e&&!!e["argmax"]}function isAggregateOp(e){return isString(e)&&!!AGGREGATE_OP_INDEX[e]}var COUNTING_OPS=["count","valid","missing","distinct"];function isCountingAggregateOp(e){return isString(e)&&contains(COUNTING_OPS,e)}function isMinMaxOp(e){return isString(e)&&contains(["min","max"],e)}var SUM_OPS=["count","sum","distinct","valid","missing"];var SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"];var SHARED_DOMAIN_OP_INDEX=toSet(SHARED_DOMAIN_OPS);function binToString(e){if(isBoolean$2(e)){e=normalizeBin(e,undefined)}return"bin"+keys$1(e).map((function(t){return isParameterExtent(e[t])?varName("_"+t+"_"+entries$1(e[t])):varName("_"+t+"_"+e[t])})).join("")}function isBinning(e){return e===true||isBinParams(e)&&!e.binned}function isBinned(e){return e==="binned"||isBinParams(e)&&e.binned===true}function isBinParams(e){return isObject(e)}function isParameterExtent(e){return e===null||e===void 0?void 0:e["param"]}function autoMaxBins(e){switch(e){case ROW:case COLUMN:case SIZE:case COLOR:case FILL:case STROKE:case STROKEWIDTH:case OPACITY:case FILLOPACITY:case STROKEOPACITY:case SHAPE:return 6;case STROKEDASH:return 4;default:return 10}}function isExprRef(e){return e&&!!e["expr"]}function replaceExprRef(e){var t=keys$1(e||{});var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];n[a]=signalRefOrValue(e[a])}return n}function extractTitleConfig(e){var t=e.anchor,n=e.frame,r=e.offset,i=e.orient,a=e.color,o=e.subtitleColor,s=e.subtitleFont,u=e.subtitleFontSize,l=e.subtitleFontStyle,f=e.subtitleFontWeight,c=e.subtitleLineHeight,d=e.subtitlePadding,p=__rest(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]);var h=__assign(__assign({},p),a?{fill:a}:{});var g=__assign(__assign(__assign(__assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{});var m=__assign(__assign(__assign(__assign(__assign(__assign(__assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),f?{subtitleFontWeight:f}:{}),c?{subtitleLineHeight:c}:{}),d?{subtitlePadding:d}:{});var v=pick(h,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:h,subtitleMarkConfig:v,nonMark:g,subtitle:m}}function isText(e){return isString(e)||isArray(e)&&isString(e[0])}function isSignalRef(e){return e&&!!e["signal"]}function isVgRangeStep(e){return!!e["step"]}function isDataRefUnionedDomain(e){if(!isArray(e)){return"fields"in e&&!("data"in e)}return false}function isFieldRefUnionDomain(e){if(!isArray(e)){return"fields"in e&&"data"in e}return false}function isDataRefDomain(e){if(!isArray(e)){return"field"in e&&"data"in e}return false}var VG_MARK_CONFIG_INDEX={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1};var VG_MARK_CONFIGS=keys$1(VG_MARK_CONFIG_INDEX);var VG_MARK_INDEX={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};var VG_CORNERRADIUS_CHANNELS=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function signalOrValueRefWithCondition(e){var t=isArray(e.condition)?e.condition.map(conditionalSignalRefOrValue):conditionalSignalRefOrValue(e.condition);return __assign(__assign({},signalRefOrValue(e)),{condition:t})}function signalRefOrValue(e){if(isExprRef(e)){var t=e.expr,n=__rest(e,["expr"]);return __assign({signal:t},n)}return e}function conditionalSignalRefOrValue(e){if(isExprRef(e)){var t=e.expr,n=__rest(e,["expr"]);return __assign({signal:t},n)}return e}function signalOrValueRef(e){if(isExprRef(e)){var t=e.expr,n=__rest(e,["expr"]);return __assign({signal:t},n)}if(isSignalRef(e)){return e}return e!==undefined?{value:e}:undefined}function exprFromValueOrSignalRef(e){if(isSignalRef(e)){return e.signal}return $$1(e.value)}function signalOrStringValue(e){if(isSignalRef(e)){return e.signal}return e==null?null:$$1(e)}function applyMarkConfig(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r];var o=getMarkConfig(a,t.markDef,t.config);if(o!==undefined){e[a]=signalOrValueRef(o)}}return e}function getStyles(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function getMarkPropOrConfig(e,t,n,r){if(r===void 0){r={}}var i=r.vgChannel,a=r.ignoreVgConfig;if(i&&t[i]!==undefined){return t[i]}else if(t[e]!==undefined){return t[e]}else if(a&&(!i||i===e)){return undefined}return getMarkConfig(e,t,n,r)}function getMarkConfig(e,t,n,r){var i=r===void 0?{}:r,a=i.vgChannel;return getFirstDefined(a?getMarkStyleConfig(e,t,n.style):undefined,getMarkStyleConfig(e,t,n.style),a?n[t.type][a]:undefined,n[t.type][e],a?n.mark[a]:n.mark[e])}function getMarkStyleConfig(e,t,n){return getStyleConfig(e,getStyles(t),n)}function getStyleConfig(e,t,n){t=array$5(t);var r;for(var i=0,a=t;i<a.length;i++){var o=a[i];var s=n[o];if(s&&s[e]!==undefined){r=s[e]}}return r}function sortParams(e,t){return array$5(e).reduce((function(e,n){var r;e.field.push(vgField(n,t));e.order.push((r=n.sort)!==null&&r!==void 0?r:"ascending");return e}),{field:[],order:[]})}function mergeTitleFieldDefs(e,t){var n=__spreadArray([],e);t.forEach((function(e){for(var t=0,r=n;t<r.length;t++){var i=r[t];if(deepEqual(i,e)){return}}n.push(e)}));return n}function mergeTitle(e,t){if(deepEqual(e,t)||!t){return e}else if(!e){return t}else{return __spreadArray(__spreadArray([],array$5(e)),array$5(t)).join(", ")}}function mergeTitleComponent(e,t){var n=e.value;var r=t.value;if(n==null||r===null){return{explicit:e.explicit,value:null}}else if((isText(n)||isSignalRef(n))&&(isText(r)||isSignalRef(r))){return{explicit:e.explicit,value:mergeTitle(n,r)}}else if(isText(n)||isSignalRef(n)){return{explicit:e.explicit,value:n}}else if(isText(r)||isSignalRef(r)){return{explicit:e.explicit,value:r}}else if(!isText(n)&&!isSignalRef(n)&&!isText(r)&&!isSignalRef(r)){return{explicit:e.explicit,value:mergeTitleFieldDefs(n,r)}}throw new Error("It should never reach here")}function invalidSpec(e){return"Invalid specification "+stringify$1(e)+'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".'}var FIT_NON_SINGLE='Autosize "fit" only works for single views and layered views.';function containerSizeNonSingle(e){var t=e=="width"?"Width":"Height";return t+' "container" only works for single views and layered views.'}function containerSizeNotCompatibleWithAutosize(e){var t=e=="width"?"Width":"Height";var n=e=="width"?"x":"y";return t+' "container" only works well with autosize "fit" or "fit-'+n+'".'}function droppingFit(e){return e?'Dropping "fit-'+e+'" because spec has discrete '+getSizeChannel$1(e)+".":'Dropping "fit" because spec has discrete size.'}function unknownField(e){return"Unknown field for "+e+". Cannot calculate view size."}function cannotProjectOnChannelWithoutField(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'}function cannotProjectAggregate(e,t){return'Cannot project a selection on encoding channel "'+e+'" as it uses an aggregate function ("'+t+'").'}function nearestNotSupportForContinuous(e){return'The "nearest" transform is not supported for '+e+" marks."}function selectionNotSupported(e){return"Selection not supported for "+e+" yet."}function selectionNotFound(e){return'Cannot find a selection named "'+e+'".'}var SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.";var LEGEND_BINDINGS_MUST_HAVE_PROJECTION="Legend bindings are only supported for selections over an individual field or encoding channel.";function cannotLookupVariableParameter(e){return'Lookups can only be performed on selection parameters. "'+e+'" is a variable parameter.'}function noSameUnitLookup(e){return'Cannot define and lookup the "'+e+'" selection in the same view. '+"Try moving the lookup into a second, layered view?"}var NEEDS_SAME_SELECTION="The same selection must be used to override scale domains in a layered view.";var INTERVAL_INITIALIZED_WITH_X_Y='Interval selections should be initialized using "x" and/or "y" keys.';function noSuchRepeatedValue(e){return'Unknown repeated value "'+e+'".'}function columnsNotSupportByRowCol(e){return'The "columns" property cannot be used when "'+e+'" has nested row/column.'}var CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function unrecognizedParse(e){return'Unrecognized parse "'+e+'".'}function differentParse(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."}var ADD_SAME_CHILD_TWICE="Attempt to add the same child twice.";function invalidTransformIgnored(e){return"Ignoring an invalid transform: "+stringify$1(e)+"."}var NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function customFormatTypeNotAllowed(e){return"Config.customFormatTypes is not true, thus custom format type and format for channel "+e+" are dropped."}function projectionOverridden(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection "+stringify$1(t)+" is overridden by a child projection "+stringify$1(n)+"."}var REPLACE_ANGLE_WITH_THETA="Arc marks uses theta channel rather than angle, replacing angle with theta.";function primitiveChannelDef(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+stringify$1(n)+"}."}function invalidFieldType(e){return'Invalid field type "'+e+'".'}function invalidFieldTypeForCountAggregate(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'}function invalidAggregate(e){return'Invalid aggregation operator "'+e+'".'}function droppingColor(e,t){var n=t.fill,r=t.stroke;return"Dropping color "+e+" as the plot also has "+(n&&r?"fill and stroke":n?"fill":"stroke")+"."}function relativeBandSizeNotSupported(e){return"Position range does not support relative band size for "+e+"."}function emptyFieldDef(e,t){return"Dropping "+stringify$1(e)+' from channel "'+t+'" since it does not contain any data field, datum, value, or signal.'}var LINE_WITH_VARYING_SIZE="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function incompatibleChannel(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."}function invalidEncodingChannel(e){return e+"-encoding is dropped as "+e+" is not a valid encoding channel."}function channelShouldBeDiscrete(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function channelShouldBeDiscreteOrDiscretizing(e){return e+" encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold)."}function facetChannelDropped(e){return"Facet encoding dropped as "+e.join(" and ")+" "+(e.length>1?"are":"is")+" also specified."}function discreteChannelCannotEncode(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+(t==="ordinal"?"order":"magnitude")+"."}function rangeMarkAlignmentCannotBeExpression(e){return"The "+e+" for range marks cannot be an expression"}function lineWithRange(e,t){var n=e&&t?"x2 and y2":e?"x2":"y2";return"Line mark is for continuous lines and thus cannot be used with "+n+". We will use the rule mark (line segments) instead."}function orientOverridden(e,t){return'Specified orient "'+e+'" overridden with "'+t+'".'}function cannotUseScalePropertyWithNonColor(e){return'Cannot use the scale property "'+e+'" with non-color channel.'}function cannotUseRelativeBandSizeWithNonBandScale(e){return"Cannot use the relative band size with "+e+" scale."}function unaggregateDomainHasNoEffectForRawField(e){return"Using unaggregated domain with raw field has no effect ("+stringify$1(e)+")."}function unaggregateDomainWithNonSharedDomainOp(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'}function unaggregatedDomainWithLogScale(e){return"Unaggregated domain is currently unsupported for log scale ("+stringify$1(e)+")."}function cannotApplySizeToNonOrientedMark(e){return'Cannot apply size to non-oriented mark "'+e+'".'}function scaleTypeNotWorkWithChannel(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'}function scaleTypeNotWorkWithFieldDef(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'}function scalePropertyNotWorkWithScaleType(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function stepDropped(e){return'The step for "'+e+'" is dropped because the '+(e==="width"?"x":"y")+" is continuous."}function mergeConflictingProperty(e,t,n,r){return"Conflicting "+t.toString()+' property "'+e.toString()+'" ('+stringify$1(n)+" and "+stringify$1(r)+"). Using "+stringify$1(n)+"."}function mergeConflictingDomainProperty(e,t,n,r){return"Conflicting "+t.toString()+' property "'+e.toString()+'" ('+stringify$1(n)+" and "+stringify$1(r)+"). Using the union of the two domains."}function independentScaleMeansIndependentGuide(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'}function domainSortDropped(e){return"Dropping sort property "+stringify$1(e)+' as unioned domains only support boolean or op "count", "min", and "max".'}var MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";var FACETED_INDEPENDENT_DIFFERENT_SOURCES="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.";var FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.";var FACETED_INDEPENDENT_SAME_SOURCE="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function cannotStackRangedMark(e){return'Cannot stack "'+e+'" if there is already "'+e+'2".'}function cannotStackNonLinearScale(e){return"Cannot stack non-linear scale ("+e+")."}function stackNonSummativeAggregate(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'").'}function invalidTimeUnit(e,t){return"Invalid "+e+": "+stringify$1(t)+"."}function droppedDay(e){return"Dropping day from datetime "+stringify$1(e)+" as day cannot be combined with other units."}function errorBarCenterAndExtentAreNotNeeded(e,t){return""+(t?"extent ":"")+(t&&e?"and ":"")+(e?"center ":"")+(t&&e?"are ":"is ")+"not needed when data are aggregated."}function errorBarCenterIsUsedWithWrongExtent(e,t,n){return e+" is not usually used with "+t+" for "+n+"."}function errorBarContinuousAxisHasCustomizedAggregate(e,t){return"Continuous axis should not have customized aggregation function "+e+"; "+t+" already agregates the axis."}function errorBand1DNotSupport(e){return"1D error band does not support "+e+"."}function channelRequiredForBinned(e){return"Channel "+e+' is required for "binned" bin.'}function channelShouldNotBeUsedForBinned(e){return"Channel "+e+' should not be used with "binned" bin.'}function domainRequiredForThresholdScale(e){return"Domain for "+e+" is required for threshold scale."}var main$1=logger(Warn);var current=main$1;function set(e){current=e;return current}function reset(){current=main$1;return current}function warn(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}current.warn.apply(current,e)}function debug(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}current.debug.apply(current,e)}function isDateTime(e){if(e&&isObject(e)){for(var t=0,n=TIMEUNIT_PARTS;t<n.length;t++){var r=n[t];if(r in e){return true}}}return false}var MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"];var SHORT_MONTHS=MONTHS.map((function(e){return e.substr(0,3)}));var DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];var SHORT_DAYS=DAYS.map((function(e){return e.substr(0,3)}));function normalizeQuarter(e){if(isNumeric(e)){e=+e}if(isNumber$1(e)){if(e>4){warn(invalidTimeUnit("quarter",e))}return e-1}else{throw new Error(invalidTimeUnit("quarter",e))}}function normalizeMonth(e){if(isNumeric(e)){e=+e}if(isNumber$1(e)){return e-1}else{var t=e.toLowerCase();var n=MONTHS.indexOf(t);if(n!==-1){return n}var r=t.substr(0,3);var i=SHORT_MONTHS.indexOf(r);if(i!==-1){return i}throw new Error(invalidTimeUnit("month",e))}}function normalizeDay(e){if(isNumeric(e)){e=+e}if(isNumber$1(e)){return e%7}else{var t=e.toLowerCase();var n=DAYS.indexOf(t);if(n!==-1){return n}var r=t.substr(0,3);var i=SHORT_DAYS.indexOf(r);if(i!==-1){return i}throw new Error(invalidTimeUnit("day",e))}}function dateTimeParts(e,t){var n=[];if(t&&e.day!==undefined){if(keys$1(e).length>1){warn(droppedDay(e));e=duplicate(e);delete e.day}}if(e.year!==undefined){n.push(e.year)}else{n.push(2012)}if(e.month!==undefined){var r=t?normalizeMonth(e.month):e.month;n.push(r)}else if(e.quarter!==undefined){var i=t?normalizeQuarter(e.quarter):e.quarter;n.push(isNumber$1(i)?i*3:i+"*3")}else{n.push(0)}if(e.date!==undefined){n.push(e.date)}else if(e.day!==undefined){var a=t?normalizeDay(e.day):e.day;n.push(isNumber$1(a)?a+1:a+"+1")}else{n.push(1)}for(var o=0,s=["hours","minutes","seconds","milliseconds"];o<s.length;o++){var u=s[o];var l=e[u];n.push(typeof l==="undefined"?0:l)}return n}function dateTimeToExpr(e){var t=dateTimeParts(e,true);var n=t.join(", ");if(e.utc){return"utc("+n+")"}else{return"datetime("+n+")"}}function dateTimeExprToExpr(e){var t=dateTimeParts(e,false);var n=t.join(", ");if(e.utc){return"utc("+n+")"}else{return"datetime("+n+")"}}function dateTimeToTimestamp(e){var t=dateTimeParts(e,true);if(e.utc){return+new Date(Date.UTC.apply(Date,t))}else{return+new(Date.bind.apply(Date,__spreadArray([void 0],t)))}}var LOCAL_SINGLE_TIMEUNIT_INDEX={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};var TIMEUNIT_PARTS=keys$1(LOCAL_SINGLE_TIMEUNIT_INDEX);function isLocalSingleTimeUnit(e){return!!LOCAL_SINGLE_TIMEUNIT_INDEX[e]}function isUTCTimeUnit(e){return e.startsWith("utc")}function getLocalTimeUnit(e){return e.substr(3)}var VEGALITE_TIMEFORMAT={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function getTimeUnitParts(e){return TIMEUNIT_PARTS.filter((function(t){return containsTimeUnit(e,t)}))}function containsTimeUnit(e,t){var n=e.indexOf(t);if(n<0){return false}if(n>0&&t==="seconds"&&e.charAt(n-1)==="i"){return false}if(e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"){return false}if(n>0&&t==="year"&&e.charAt(n-1)==="f"){return false}return true}function fieldExpr(e,t,n){var r=n===void 0?{end:false}:n,i=r.end;var a=accessPathWithDatum(t);var o=isUTCTimeUnit(e)?"utc":"";function s(e){if(e==="quarter"){return"("+o+"quarter("+a+")-1)"}else{return""+o+e+"("+a+")"}}var u;var l={};for(var f=0,c=TIMEUNIT_PARTS;f<c.length;f++){var d=c[f];if(containsTimeUnit(e,d)){l[d]=s(d);u=d}}if(i){l[u]+="+1"}return dateTimeExprToExpr(l)}function timeUnitSpecifierExpression(e){if(!e){return undefined}var t=getTimeUnitParts(e);return"timeUnitSpecifier("+stringify$1(t)+", "+stringify$1(VEGALITE_TIMEFORMAT)+")"}function formatExpression(e,t,n){if(!e){return undefined}var r=timeUnitSpecifierExpression(e);var i=n||isUTCTimeUnit(e);return(i?"utc":"time")+"Format("+t+", "+r+")"}function normalizeTimeUnit(e){if(!e){return undefined}var t;if(isString(e)){t={unit:e}}else if(isObject(e)){t=__assign(__assign({},e),e.unit?{unit:e.unit}:{})}if(isUTCTimeUnit(t.unit)){t.utc=true;t.unit=getLocalTimeUnit(t.unit)}return t}function timeUnitToString(e){var t=normalizeTimeUnit(e),n=t.utc,r=__rest(t,["utc"]);if(r.unit){return(n?"utc":"")+keys$1(r).map((function(e){return varName(""+(e==="unit"?"":"_"+e+"_")+r[e])})).join("")}else{return(n?"utc":"")+"timeunit"+keys$1(r).map((function(e){return varName("_"+e+"_"+r[e])})).join("")}}function isSelectionPredicate(e){return e===null||e===void 0?void 0:e["param"]}function isFieldEqualPredicate(e){return e&&!!e.field&&e.equal!==undefined}function isFieldLTPredicate(e){return e&&!!e.field&&e.lt!==undefined}function isFieldLTEPredicate(e){return e&&!!e.field&&e.lte!==undefined}function isFieldGTPredicate(e){return e&&!!e.field&&e.gt!==undefined}function isFieldGTEPredicate(e){return e&&!!e.field&&e.gte!==undefined}function isFieldRangePredicate(e){if(e&&e.field){if(isArray(e.range)&&e.range.length===2){return true}else if(isSignalRef(e.range)){return true}}return false}function isFieldOneOfPredicate(e){return e&&!!e.field&&(isArray(e.oneOf)||isArray(e.in))}function isFieldValidPredicate(e){return e&&!!e.field&&e.valid!==undefined}function isFieldPredicate(e){return isFieldOneOfPredicate(e)||isFieldEqualPredicate(e)||isFieldRangePredicate(e)||isFieldLTPredicate(e)||isFieldGTPredicate(e)||isFieldLTEPredicate(e)||isFieldGTEPredicate(e)}function predicateValueExpr(e,t){return valueExpr(e,{timeUnit:t,wrapTime:true})}function predicateValuesExpr(e,t){return e.map((function(e){return predicateValueExpr(e,t)}))}function fieldFilterExpression(e,t){var n;if(t===void 0){t=true}var r=e.field;var i=(n=normalizeTimeUnit(e.timeUnit))===null||n===void 0?void 0:n.unit;var a=i?"time("+fieldExpr(i,r)+")":vgField(e,{expr:"datum"});if(isFieldEqualPredicate(e)){return a+"==="+predicateValueExpr(e.equal,i)}else if(isFieldLTPredicate(e)){var o=e.lt;return a+"<"+predicateValueExpr(o,i)}else if(isFieldGTPredicate(e)){var s=e.gt;return a+">"+predicateValueExpr(s,i)}else if(isFieldLTEPredicate(e)){var o=e.lte;return a+"<="+predicateValueExpr(o,i)}else if(isFieldGTEPredicate(e)){var s=e.gte;return a+">="+predicateValueExpr(s,i)}else if(isFieldOneOfPredicate(e)){return"indexof(["+predicateValuesExpr(e.oneOf,i).join(",")+"], "+a+") !== -1"}else if(isFieldValidPredicate(e)){return fieldValidPredicate(a,e.valid)}else if(isFieldRangePredicate(e)){var u=e.range;var s=isSignalRef(u)?{signal:u.signal+"[0]"}:u[0];var o=isSignalRef(u)?{signal:u.signal+"[1]"}:u[1];if(s!==null&&o!==null&&t){return"inrange("+a+", ["+predicateValueExpr(s,i)+", "+predicateValueExpr(o,i)+"])"}var l=[];if(s!==null){l.push(a+" >= "+predicateValueExpr(s,i))}if(o!==null){l.push(a+" <= "+predicateValueExpr(o,i))}return l.length>0?l.join(" && "):"true"}throw new Error("Invalid field predicate: "+stringify$1(e))}function fieldValidPredicate(e,t){if(t===void 0){t=true}if(t){return"isValid("+e+") && isFinite(+"+e+")"}else{return"!isValid("+e+") || !isFinite(+"+e+")"}}function normalizePredicate$1(e){var t;if(isFieldPredicate(e)&&e.timeUnit){return __assign(__assign({},e),{timeUnit:(t=normalizeTimeUnit(e.timeUnit))===null||t===void 0?void 0:t.unit})}return e}var Type={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};var QUANTITATIVE=Type.quantitative;var ORDINAL=Type.ordinal;var TEMPORAL=Type.temporal;var NOMINAL=Type.nominal;var GEOJSON=Type.geojson;function getFullName(e){if(e){e=e.toLowerCase();switch(e){case"q":case QUANTITATIVE:return"quantitative";case"t":case TEMPORAL:return"temporal";case"o":case ORDINAL:return"ordinal";case"n":case NOMINAL:return"nominal";case GEOJSON:return"geojson"}}return undefined}var ScaleType={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"};var SCALE_CATEGORY_INDEX={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function scaleCompatible(e,t){var n=SCALE_CATEGORY_INDEX[e];var r=SCALE_CATEGORY_INDEX[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}var SCALE_PRECEDENCE_INDEX={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function scaleTypePrecedence(e){return SCALE_PRECEDENCE_INDEX[e]}var CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","log","pow","sqrt","symlog","time","utc"];var CONTINUOUS_TO_CONTINUOUS_INDEX=toSet(CONTINUOUS_TO_CONTINUOUS_SCALES);var QUANTITATIVE_SCALES=["linear","log","pow","sqrt","symlog"];var QUANTITATIVE_SCALES_INDEX=toSet(QUANTITATIVE_SCALES);function isQuantitative(e){return e in QUANTITATIVE_SCALES_INDEX}var CONTINUOUS_TO_DISCRETE_SCALES=["quantile","quantize","threshold"];var CONTINUOUS_TO_DISCRETE_INDEX=toSet(CONTINUOUS_TO_DISCRETE_SCALES);var CONTINUOUS_DOMAIN_SCALES=CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["quantile","quantize","threshold","sequential","identity"]);var CONTINUOUS_DOMAIN_INDEX=toSet(CONTINUOUS_DOMAIN_SCALES);var DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var DISCRETE_DOMAIN_INDEX=toSet(DISCRETE_DOMAIN_SCALES);function hasDiscreteDomain(e){return e in DISCRETE_DOMAIN_INDEX}function hasContinuousDomain(e){return e in CONTINUOUS_DOMAIN_INDEX}function isContinuousToContinuous(e){return e in CONTINUOUS_TO_CONTINUOUS_INDEX}function isContinuousToDiscrete(e){return e in CONTINUOUS_TO_DISCRETE_INDEX}var defaultScaleConfig={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function isExtendedScheme(e){return!isString(e)&&!!e["name"]}function isParameterDomain(e){return e===null||e===void 0?void 0:e["param"]}function isDomainUnionWith(e){return e&&e["unionWith"]}var SCALE_PROPERTY_INDEX={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};var type=SCALE_PROPERTY_INDEX.type,domain$1=SCALE_PROPERTY_INDEX.domain,range=SCALE_PROPERTY_INDEX.range,rangeMax=SCALE_PROPERTY_INDEX.rangeMax,rangeMin=SCALE_PROPERTY_INDEX.rangeMin,scheme=SCALE_PROPERTY_INDEX.scheme,NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTY_INDEX=__rest(SCALE_PROPERTY_INDEX,["type","domain","range","rangeMax","rangeMin","scheme"]);var NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=keys$1(NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTY_INDEX);function scaleTypeSupportProperty(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return true;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return isContinuousToContinuous(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return isContinuousToContinuous(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return isContinuousToContinuous(e);case"nice":return isContinuousToContinuous(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return hasContinuousDomain(e)&&!contains(["log","time","utc","threshold","quantile"],e)}}function channelScalePropertyIncompatability(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":if(!isColorChannel(e)){return cannotUseScalePropertyWithNonColor(e)}return undefined;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return undefined}}function scaleTypeSupportDataType(e,t){if(contains([ORDINAL,NOMINAL],t)){return e===undefined||hasDiscreteDomain(e)}else if(t===TEMPORAL){return contains([ScaleType.TIME,ScaleType.UTC,undefined],e)}else if(t===QUANTITATIVE){return contains([ScaleType.LOG,ScaleType.POW,ScaleType.SQRT,ScaleType.SYMLOG,ScaleType.QUANTILE,ScaleType.QUANTIZE,ScaleType.THRESHOLD,ScaleType.LINEAR,undefined],e)}return true}function channelSupportScaleType(e,t){if(!isScaleChannel(e)){return false}switch(e){case X:case Y:case THETA:case RADIUS:return isContinuousToContinuous(t)||contains(["band","point"],t);case SIZE:case STROKEWIDTH:case OPACITY:case FILLOPACITY:case STROKEOPACITY:case ANGLE:return isContinuousToContinuous(t)||isContinuousToDiscrete(t)||contains(["band","point","ordinal"],t);case COLOR:case FILL:case STROKE:return t!=="band";case STROKEDASH:case SHAPE:return t==="ordinal"||isContinuousToDiscrete(t)}}var Mark={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"};var ARC=Mark.arc;var AREA=Mark.area;var BAR=Mark.bar;var IMAGE=Mark.image;var LINE=Mark.line;var POINT=Mark.point;var RECT=Mark.rect;var RULE=Mark.rule;var TEXT=Mark.text;var TICK=Mark.tick;var TRAIL=Mark.trail;var CIRCLE=Mark.circle;var SQUARE=Mark.square;var GEOSHAPE=Mark.geoshape;function isPathMark(e){return["line","area","trail"].includes(e)}function isRectBasedMark(e){return["rect","bar","image","arc"].includes(e)}var PRIMITIVE_MARKS=keys$1(Mark);function isMarkDef(e){return e["type"]}toSet(PRIMITIVE_MARKS);var STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"];var FILL_CONFIG=["fill","fillOpacity"];var FILL_STROKE_CONFIG=__spreadArray(__spreadArray([],STROKE_CONFIG),FILL_CONFIG);var VL_ONLY_MARK_CONFIG_INDEX={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1};var VL_ONLY_MARK_CONFIG_PROPERTIES=keys$1(VL_ONLY_MARK_CONFIG_INDEX);var VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]};var defaultMarkConfig={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1};var MARK_CONFIG_INDEX={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1};var MARK_CONFIGS=keys$1(MARK_CONFIG_INDEX);function isRelativeBandSize(e){return e&&e["band"]!=undefined}var BAR_CORNER_RADIUS_INDEX={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};var DEFAULT_RECT_BAND_SIZE=5;var defaultBarConfig={binSpacing:1,continuousBandSize:DEFAULT_RECT_BAND_SIZE,timeUnitBandPosition:.5};var defaultRectConfig={binSpacing:0,continuousBandSize:DEFAULT_RECT_BAND_SIZE,timeUnitBandPosition:.5};var defaultTickConfig={thickness:1};function getMarkType(e){return isMarkDef(e)?e.type:e}function midPointRefWithPositionInvalidTest(e){var t=e.channel,n=e.channelDef,r=e.markDef,i=e.scale,a=e.config;var o=midPoint(e);if(isFieldDef(n)&&!isCountingAggregateOp(n.aggregate)&&i&&isContinuousToContinuous(i.get("type"))&&i.get("zero")===false){return wrapPositionInvalidTest({fieldDef:n,channel:t,markDef:r,ref:o,config:a})}return o}function wrapPositionInvalidTest(e){var t=e.fieldDef,n=e.channel,r=e.markDef,i=e.ref,a=e.config;if(isPathMark(r.type)){return i}var o=getMarkPropOrConfig("invalid",r,a);if(o===null){return i}return[fieldInvalidTestValueRef(t,n),i]}function fieldInvalidTestValueRef(e,t){var n=fieldInvalidPredicate(e,true);var r=getMainRangeChannel(t);var i=r==="y"?{field:{group:"height"}}:{value:0};return __assign({test:n},i)}function fieldInvalidPredicate(e,t){if(t===void 0){t=true}return fieldValidPredicate(isString(e)?e:vgField(e,{expr:"datum"}),!t)}function datumDefToExpr(e){var t=e.datum;if(isDateTime(t)){return dateTimeToExpr(t)}return""+stringify$1(t)}function valueRefForFieldOrDatumDef(e,t,n,r){var i={};if(t){i.scale=t}if(isDatumDef(e)){var a=e.datum;if(isDateTime(a)){i.signal=dateTimeToExpr(a)}else if(isSignalRef(a)){i.signal=a.signal}else if(isExprRef(a)){i.signal=a.expr}else{i.value=a}}else{i.field=vgField(e,n)}if(r){var o=r.offset,s=r.band;if(o){i.offset=o}if(s){i.band=s}}return i}function interpolatedSignalRef(e){var t=e.scaleName,n=e.fieldOrDatumDef,r=e.fieldOrDatumDef2,i=e.offset,a=e.startSuffix,o=e.bandPosition,s=o===void 0?.5:o;var u=0<s&&s<1?"datum":undefined;var l=vgField(n,{expr:u,suffix:a});var f=r!==undefined?vgField(r,{expr:u}):vgField(n,{suffix:"end",expr:u});var c={};if(s===0||s===1){c.scale=t;var d=s===0?l:f;c.field=d}else{var p=isSignalRef(s)?s.signal+" * "+l+" + (1-"+s.signal+") * "+f:s+" * "+l+" + "+(1-s)+" * "+f;c.signal='scale("'+t+'", '+p+")"}if(i){c.offset=i}return c}function midPoint(e){var t;var n=e.channel,r=e.channelDef,i=e.channel2Def,a=e.markDef,o=e.config,s=e.scaleName,u=e.scale,l=e.stack,f=e.offset,c=e.defaultRef,d=e.bandPosition;if(r){if(isFieldOrDatumDef(r)){if(isTypedFieldDef(r)){d!==null&&d!==void 0?d:d=getBandPosition({fieldDef:r,fieldDef2:i,markDef:a,config:o});var p=r.bin,h=r.timeUnit,g=r.type;if(isBinning(p)||d&&h&&g===TEMPORAL){if(l&&l.impute){return valueRefForFieldOrDatumDef(r,s,{binSuffix:"mid"},{offset:f})}if(d){return interpolatedSignalRef({scaleName:s,fieldOrDatumDef:r,bandPosition:d,offset:f})}return valueRefForFieldOrDatumDef(r,s,binRequiresRange(r,n)?{binSuffix:"range"}:{},{offset:f})}else if(isBinned(p)){if(isFieldDef(i)){return interpolatedSignalRef({scaleName:s,fieldOrDatumDef:r,fieldOrDatumDef2:i,bandPosition:d,offset:f})}else{var m=n===X?X2:Y2;warn(channelRequiredForBinned(m))}}}var v=u===null||u===void 0?void 0:u.get("type");return valueRefForFieldOrDatumDef(r,s,hasDiscreteDomain(v)?{binSuffix:"range"}:{},{offset:f,band:v==="band"?(t=d!==null&&d!==void 0?d:r.bandPosition)!==null&&t!==void 0?t:.5:undefined})}else if(isValueDef(r)){var y=r.value;var _=f?{offset:f}:{};return __assign(__assign({},widthHeightValueOrSignalRef(n,y)),_)}}if(isFunction(c)){c=c()}if(c){return __assign(__assign({},c),f?{offset:f}:{})}return c}function widthHeightValueOrSignalRef(e,t){if(contains(["x","x2"],e)&&t==="width"){return{field:{group:"width"}}}else if(contains(["y","y2"],e)&&t==="height"){return{field:{group:"height"}}}return signalOrValueRef(t)}function isCustomFormatType(e){return e&&e!=="number"&&e!=="time"}function customFormatExpr(e,t,n){return e+"("+t+(n?", "+stringify$1(n):"")+")"}var BIN_RANGE_DELIMITER=" – ";function formatSignalRef(e){var t,n;var r=e.fieldOrDatumDef,i=e.format,a=e.formatType,o=e.expr,s=e.normalizeStack,u=e.config;if(isCustomFormatType(a)){return formatCustomType({fieldOrDatumDef:r,format:i,formatType:a,expr:o,config:u})}var l=fieldToFormat(r,o,s);if(isFieldOrDatumDefForTimeFormat(r)){var f=timeFormatExpression(l,isFieldDef(r)?(t=normalizeTimeUnit(r.timeUnit))===null||t===void 0?void 0:t.unit:undefined,i,u.timeFormat,isScaleFieldDef(r)&&((n=r.scale)===null||n===void 0?void 0:n.type)===ScaleType.UTC);return f?{signal:f}:undefined}i=numberFormat(channelDefType(r),i,u);if(isFieldDef(r)&&isBinning(r.bin)){var c=vgField(r,{expr:o,binSuffix:"end"});return{signal:binFormatExpression(l,c,i,a,u)}}else if(i||channelDefType(r)==="quantitative"){return{signal:""+formatExpr(l,i)}}else{return{signal:"isValid("+l+") ? "+l+' : ""+'+l}}}function fieldToFormat(e,t,n){if(isFieldDef(e)){if(n){return vgField(e,{expr:t,suffix:"end"})+"-"+vgField(e,{expr:t,suffix:"start"})}else{return vgField(e,{expr:t})}}else{return datumDefToExpr(e)}}function formatCustomType(e){var t=e.fieldOrDatumDef,n=e.format,r=e.formatType,i=e.expr,a=e.normalizeStack,o=e.config,s=e.field;s!==null&&s!==void 0?s:s=fieldToFormat(t,i,a);if(isFieldDef(t)&&isBinning(t.bin)){var u=vgField(t,{expr:i,binSuffix:"end"});return{signal:binFormatExpression(s,u,n,r,o)}}return{signal:customFormatExpr(r,s,n)}}function guideFormat(e,t,n,r,i,a){var o;if(isCustomFormatType(r)){return undefined}if(isFieldOrDatumDefForTimeFormat(e)){var s=isFieldDef(e)?(o=normalizeTimeUnit(e.timeUnit))===null||o===void 0?void 0:o.unit:undefined;return timeFormat(n,s,i,a)}return numberFormat(t,n,i)}function guideFormatType(e,t,n){if(e&&(isSignalRef(e)||e==="number"||e==="time")){return e}if(isFieldOrDatumDefForTimeFormat(t)&&n!=="time"&&n!=="utc"){return"time"}return undefined}function numberFormat(e,t,n){if(isString(t)){return t}if(e===QUANTITATIVE){return n.numberFormat}return undefined}function timeFormat(e,t,n,r){if(e){return e}if(t){return{signal:timeUnitSpecifierExpression(t)}}return r?undefined:n.timeFormat}function formatExpr(e,t){return"format("+e+', "'+(t||"")+'")'}function binNumberFormatExpr(e,t,n,r){var i;if(isCustomFormatType(n)){return customFormatExpr(n,e,t)}return formatExpr(e,(i=isString(t)?t:undefined)!==null&&i!==void 0?i:r.numberFormat)}function binFormatExpression(e,t,n,r,i){var a=binNumberFormatExpr(e,n,r,i);var o=binNumberFormatExpr(t,n,r,i);return fieldValidPredicate(e,false)+' ? "null" : '+a+' + "'+BIN_RANGE_DELIMITER+'" + '+o}function timeFormatExpression(e,t,n,r,i){if(!t||n){n=isString(n)?n:r;return(i?"utc":"time")+"Format("+e+", '"+n+"')"}else{return formatExpression(t,e,i)}}var DEFAULT_SORT_OP="min";var SORT_BY_CHANNEL_INDEX={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function isSortByChannel(e){return e in SORT_BY_CHANNEL_INDEX}function isSortByEncoding(e){return!!e&&!!e["encoding"]}function isSortField(e){return!!e&&(e["op"]==="count"||!!e["field"])}function isSortArray(e){return!!e&&isArray(e)}function isFacetMapping(e){return"row"in e||"column"in e}function isFacetFieldDef(e){return!!e&&"header"in e}function isFacetSpec(e){return"facet"in e}function isConditionalParameter(e){return e["param"]}function isRepeatRef(e){return e&&!isString(e)&&"repeat"in e}function toFieldDefBase(e){var t=e.field,n=e.timeUnit,r=e.bin,i=e.aggregate;return __assign(__assign(__assign(__assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function isSortableFieldDef(e){return"sort"in e}function getBandPosition(e){var t=e.fieldDef,n=e.fieldDef2,r=e.markDef,i=e.config;if(isFieldOrDatumDef(t)&&t.bandPosition!==undefined){return t.bandPosition}if(isFieldDef(t)){var a=t.timeUnit,o=t.bin;if(a&&!n){return isRectBasedMark(r.type)?0:getMarkConfig("timeUnitBandPosition",r,i)}else if(isBinning(o)){return.5}}return undefined}function getBandSize(e){var t,n,r;var i=e.channel,a=e.fieldDef,o=e.fieldDef2,s=e.markDef,u=e.config,l=e.scaleType,f=e.useVlSizeChannel;var c=getSizeChannel$1(i);var d=getMarkPropOrConfig(f?"size":c,s,u,{vgChannel:c});if(d!==undefined){return d}if(isFieldDef(a)){var p=a.timeUnit,h=a.bin;if(p&&!o){return{band:getMarkConfig("timeUnitBandSize",s,u)}}else if(isBinning(h)&&!hasDiscreteDomain(l)){return{band:1}}}if(isRectBasedMark(s.type)){if(l){if(hasDiscreteDomain(l)){return((t=u[s.type])===null||t===void 0?void 0:t.discreteBandSize)||{band:1}}else{return(n=u[s.type])===null||n===void 0?void 0:n.continuousBandSize}}return(r=u[s.type])===null||r===void 0?void 0:r.discreteBandSize}return undefined}function hasBandEnd(e,t,n,r){if(isBinning(e.bin)||e.timeUnit&&isTypedFieldDef(e)&&e.type==="temporal"){return getBandPosition({fieldDef:e,fieldDef2:t,markDef:n,config:r})!==undefined}return false}function isConditionalDef(e){return!!e&&"condition"in e}function hasConditionalFieldDef(e){var t=e&&e["condition"];return!!t&&!isArray(t)&&isFieldDef(t)}function hasConditionalFieldOrDatumDef(e){var t=e&&e["condition"];return!!t&&!isArray(t)&&isFieldOrDatumDef(t)}function hasConditionalValueDef(e){var t=e&&e["condition"];return!!t&&(isArray(t)||isValueDef(t))}function isFieldDef(e){return!!e&&(!!e["field"]||e["aggregate"]==="count")}function channelDefType(e){return e&&e["type"]}function isDatumDef(e){return!!e&&"datum"in e}function isContinuousFieldOrDatumDef(e){return isTypedFieldDef(e)&&!isDiscrete(e)||isNumericDataDef(e)}function isNumericDataDef(e){return isDatumDef(e)&&isNumber$1(e.datum)}function isFieldOrDatumDef(e){return isFieldDef(e)||isDatumDef(e)}function isTypedFieldDef(e){return!!e&&("field"in e||e["aggregate"]==="count")&&"type"in e}function isValueDef(e){return e&&"value"in e&&"value"in e}function isScaleFieldDef(e){return!!e&&("scale"in e||"sort"in e)}function isPositionFieldOrDatumDef(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function isMarkPropFieldOrDatumDef(e){return!!e&&"legend"in e}function isStringFieldOrDatumDef(e){return!!e&&("format"in e||"formatType"in e)}function toStringFieldDef(e){return omit(e,["legend","axis","header","scale"])}function isOpFieldDef(e){return"op"in e}function vgField(e,t){var n,r,i;if(t===void 0){t={}}var a=e.field;var o=t.prefix;var s=t.suffix;var u="";if(isCount(e)){a=internalField("count")}else{var l=void 0;if(!t.nofn){if(isOpFieldDef(e)){l=e.op}else{var f=e.bin,c=e.aggregate,d=e.timeUnit;if(isBinning(f)){l=binToString(f);s=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((r=t.suffix)!==null&&r!==void 0?r:"")}else if(c){if(isArgmaxDef(c)){u='["'+a+'"]';a="argmax_"+c.argmax}else if(isArgminDef(c)){u='["'+a+'"]';a="argmin_"+c.argmin}else{l=String(c)}}else if(d){l=timeUnitToString(d);s=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((i=t.suffix)!==null&&i!==void 0?i:"")}}}if(l){a=a?l+"_"+a:l}}if(s){a=a+"_"+s}if(o){a=o+"_"+a}if(t.forAs){return removePathFromField(a)}else if(t.expr){return flatAccessWithDatum(a,t.expr)+u}else{return replacePathInField(a)+u}}function isDiscrete(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return true;case"quantitative":return isFieldDef(e)&&!!e.bin;case"temporal":return false}throw new Error(invalidFieldType(e.type))}function isDiscretizing(e){var t;return isScaleFieldDef(e)&&isContinuousToDiscrete((t=e.scale)===null||t===void 0?void 0:t.type)}function isCount(e){return e.aggregate==="count"}function verbalTitleFormatter(e,t){var n;var r=e.field,i=e.bin,a=e.timeUnit,o=e.aggregate;if(o==="count"){return t.countTitle}else if(isBinning(i)){return r+" (binned)"}else if(a){var s=(n=normalizeTimeUnit(a))===null||n===void 0?void 0:n.unit;if(s){return r+" ("+getTimeUnitParts(s).join("-")+")"}}else if(o){if(isArgmaxDef(o)){return r+" for max "+o.argmax}else if(isArgminDef(o)){return r+" for min "+o.argmin}else{return titleCase(o)+" of "+r}}return r}function functionalTitleFormatter(e){var t=e.aggregate,n=e.bin,r=e.timeUnit,i=e.field;if(isArgmaxDef(t)){return i+" for argmax("+t.argmax+")"}else if(isArgminDef(t)){return i+" for argmin("+t.argmin+")"}var a=normalizeTimeUnit(r);var o=t||(a===null||a===void 0?void 0:a.unit)||(a===null||a===void 0?void 0:a.maxbins)&&"timeunit"||isBinning(n)&&"bin";if(o){return o.toUpperCase()+"("+i+")"}else{return i}}var defaultTitleFormatter=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return functionalTitleFormatter(e);default:return verbalTitleFormatter(e,t)}};var titleFormatter=defaultTitleFormatter;function setTitleFormatter(e){titleFormatter=e}function resetTitleFormatter(){setTitleFormatter(defaultTitleFormatter)}function title(e,t,n){var r,i;var a=n.allowDisabling,o=n.includeDefault,s=o===void 0?true:o;var u=(r=getGuide(e))===null||r===void 0?void 0:r.title;if(!isFieldDef(e)){return u}var l=e;var f=s?defaultTitle(l,t):undefined;if(a){return getFirstDefined(u,l.title,f)}else{return(i=u!==null&&u!==void 0?u:l.title)!==null&&i!==void 0?i:f}}function getGuide(e){if(isPositionFieldOrDatumDef(e)&&e.axis){return e.axis}else if(isMarkPropFieldOrDatumDef(e)&&e.legend){return e.legend}else if(isFacetFieldDef(e)&&e.header){return e.header}return undefined}function defaultTitle(e,t){return titleFormatter(e,t)}function getFormatMixins(e){var t;if(isStringFieldOrDatumDef(e)){var n=e.format,r=e.formatType;return{format:n,formatType:r}}else{var i=(t=getGuide(e))!==null&&t!==void 0?t:{};var a=i.format,r=i.formatType;return{format:a,formatType:r}}}function defaultType$2(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(isSortableFieldDef(e)&&isArray(e.sort)){return"ordinal"}var r=e.aggregate,i=e.bin,a=e.timeUnit;if(a){return"temporal"}if(i||r&&!isArgmaxDef(r)&&!isArgminDef(r)){return"quantitative"}if(isScaleFieldDef(e)&&((n=e.scale)===null||n===void 0?void 0:n.type)){switch(SCALE_CATEGORY_INDEX[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}}return"nominal"}function getFieldDef(e){if(isFieldDef(e)){return e}else if(hasConditionalFieldDef(e)){return e.condition}return undefined}function getFieldOrDatumDef(e){if(isFieldOrDatumDef(e)){return e}else if(hasConditionalFieldOrDatumDef(e)){return e.condition}return undefined}function initChannelDef(e,t,n,r){if(r===void 0){r={}}if(isString(e)||isNumber$1(e)||isBoolean$2(e)){var i=isString(e)?"string":isNumber$1(e)?"number":"boolean";warn(primitiveChannelDef(t,i,e));return{value:e}}if(isFieldOrDatumDef(e)){return initFieldOrDatumDef(e,t,n,r)}else if(hasConditionalFieldOrDatumDef(e)){return __assign(__assign({},e),{condition:initFieldOrDatumDef(e.condition,t,n,r)})}return e}function initFieldOrDatumDef(e,t,n,r){var i;if(isStringFieldOrDatumDef(e)){var a=e.format,o=e.formatType,s=__rest(e,["format","formatType"]);if(isCustomFormatType(o)&&!n.customFormatTypes){warn(customFormatTypeNotAllowed(t));return initFieldOrDatumDef(s,t,n,r)}}else{var u=isPositionFieldOrDatumDef(e)?"axis":isMarkPropFieldOrDatumDef(e)?"legend":isFacetFieldDef(e)?"header":null;if(u&&e[u]){var l=e[u],f=l.format,o=l.formatType,c=__rest(l,["format","formatType"]);if(isCustomFormatType(o)&&!n.customFormatTypes){warn(customFormatTypeNotAllowed(t));return initFieldOrDatumDef(__assign(__assign({},e),(i={},i[u]=c,i)),t,n,r)}}}if(isFieldDef(e)){return initFieldDef(e,t,r)}return initDatumDef(e)}function initDatumDef(e){var t=e["type"];if(t){return e}var n=e.datum;t=isNumber$1(n)?"quantitative":isString(n)?"nominal":isDateTime(n)?"temporal":undefined;return __assign(__assign({},e),{type:t})}function initFieldDef(e,t,n){var r=n===void 0?{}:n,i=r.compositeMark,a=i===void 0?false:i;var o=e.aggregate,s=e.timeUnit,u=e.bin,l=e.field;var f=__assign({},e);if(!a&&o&&!isAggregateOp(o)&&!isArgmaxDef(o)&&!isArgminDef(o)){warn(invalidAggregate(o));delete f.aggregate}if(s){f.timeUnit=normalizeTimeUnit(s)}if(l){f.field=""+l}if(isBinning(u)){f.bin=normalizeBin(u,t)}if(isBinned(u)&&!isXorY(t)){warn(channelShouldNotBeUsedForBinned(t))}if(isTypedFieldDef(f)){var c=f.type;var d=getFullName(c);if(c!==d){f.type=d}if(c!=="quantitative"){if(isCountingAggregateOp(o)){warn(invalidFieldTypeForCountAggregate(c,o));f.type="quantitative"}}}else if(!isSecondaryRangeChannel(t)){var p=defaultType$2(f,t);f["type"]=p}if(isTypedFieldDef(f)){var h=channelCompatibility(f,t)||{},g=h.compatible,m=h.warning;if(g===false){warn(m)}}if(isSortableFieldDef(f)&&isString(f.sort)){var v=f.sort;if(isSortByChannel(v)){return __assign(__assign({},f),{sort:{encoding:v}})}var y=v.substr(1);if(v.charAt(0)==="-"&&isSortByChannel(y)){return __assign(__assign({},f),{sort:{encoding:y,order:"descending"}})}}if(isFacetFieldDef(f)){var _=f.header;if(_){var b=_.orient,x=__rest(_,["orient"]);if(b){return __assign(__assign({},f),{header:__assign(__assign({},x),{labelOrient:_.labelOrient||b,titleOrient:_.titleOrient||b})})}}}return f}function normalizeBin(e,t){if(isBoolean$2(e)){return{maxbins:autoMaxBins(t)}}else if(e==="binned"){return{binned:true}}else if(!e.maxbins&&!e.step){return __assign(__assign({},e),{maxbins:autoMaxBins(t)})}else{return e}}var COMPATIBLE={compatible:true};function channelCompatibility(e,t){var n=e.type;if(n==="geojson"&&t!=="shape"){return{compatible:false,warning:"Channel "+t+" should not be used with a geojson data."}}switch(t){case ROW:case COLUMN:case FACET:if(!isDiscrete(e)){return{compatible:false,warning:channelShouldBeDiscrete(t)}}return COMPATIBLE;case X:case Y:case COLOR:case FILL:case STROKE:case TEXT$1:case DETAIL:case KEY:case TOOLTIP:case HREF:case URL$1:case ANGLE:case THETA:case RADIUS:case DESCRIPTION:return COMPATIBLE;case LONGITUDE:case LONGITUDE2:case LATITUDE:case LATITUDE2:if(n!==QUANTITATIVE){return{compatible:false,warning:"Channel "+t+" should be used with a quantitative field only, not "+e.type+" field."}}return COMPATIBLE;case OPACITY:case FILLOPACITY:case STROKEOPACITY:case STROKEWIDTH:case SIZE:case THETA2:case RADIUS2:case X2:case Y2:if(n==="nominal"&&!e["sort"]){return{compatible:false,warning:"Channel "+t+" should not be used with an unsorted discrete field."}}return COMPATIBLE;case SHAPE:case STROKEDASH:if(!isDiscrete(e)&&!isDiscretizing(e)){return{compatible:false,warning:channelShouldBeDiscreteOrDiscretizing(t)}}return COMPATIBLE;case ORDER:if(e.type==="nominal"&&!("sort"in e)){return{compatible:false,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}return COMPATIBLE}}function isFieldOrDatumDefForTimeFormat(e){var t=getFormatMixins(e).formatType;return t==="time"||!t&&isTimeFieldDef(e)}function isTimeFieldDef(e){return e&&(e["type"]==="temporal"||isFieldDef(e)&&!!e.timeUnit)}function valueExpr(e,t){var n;var r;var i=t.timeUnit,a=t.type,o=t.wrapTime,s=t.undefinedIfExprNotRequired;var u=i&&((r=normalizeTimeUnit(i))===null||r===void 0?void 0:r.unit);var l=u||a==="temporal";var f;if(isExprRef(e)){f=e.expr}else if(isSignalRef(e)){f=e.signal}else if(isDateTime(e)){l=true;f=dateTimeToExpr(e)}else if(isString(e)||isNumber$1(e)){if(l){f="datetime("+stringify$1(e)+")";if(isLocalSingleTimeUnit(u)){if(isNumber$1(e)&&e<1e4||isString(e)&&isNaN(Date.parse(e))){f=dateTimeToExpr((n={},n[u]=e,n))}}}}if(f){return o&&l?"time("+f+")":f}return s?undefined:stringify$1(e)}function valueArray(e,t){var n=e.type;return t.map((function(t){var r=valueExpr(t,{timeUnit:isFieldDef(e)?e.timeUnit:undefined,type:n,undefinedIfExprNotRequired:true});if(r!==undefined){return{signal:r}}return t}))}function binRequiresRange(e,t){if(!isBinning(e.bin)){console.warn("Only call this method for binned field defs.");return false}return isScaleChannel(t)&&["ordinal","nominal"].includes(e.type)}var CONDITIONAL_AXIS_PROP_INDEX={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function isConditionalAxisValue(e){return e&&e["condition"]}var AXIS_PARTS=["domain","grid","labels","ticks","title"];var AXIS_PROPERTY_TYPE={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"};var COMMON_AXIS_PROPERTIES_INDEX={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1};var AXIS_PROPERTIES_INDEX=__assign(__assign({},COMMON_AXIS_PROPERTIES_INDEX),{style:1,labelExpr:1,encoding:1});function isAxisProperty(e){return!!AXIS_PROPERTIES_INDEX[e]}var AXIS_CONFIGS_INDEX={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1};var AXIS_CONFIGS=keys$1(AXIS_CONFIGS_INDEX);function isUnitSpec(e){return"mark"in e}var CompositeMarkNormalizer=function(){function e(e,t){this.name=e;this.run=t}e.prototype.hasMatchingType=function(e){if(isUnitSpec(e)){return getMarkType(e.mark)===this.name}return false};return e}();function channelHasField(e,t){var n=e&&e[t];if(n){if(isArray(n)){return some(n,(function(e){return!!e.field}))}else{return isFieldDef(n)||hasConditionalFieldDef(n)}}return false}function isAggregate$1(e){return some(CHANNELS,(function(t){if(channelHasField(e,t)){var n=e[t];if(isArray(n)){return some(n,(function(e){return!!e.aggregate}))}else{var r=getFieldDef(n);return r&&!!r.aggregate}}return false}))}function extractTransformsFromEncoding(e,t){var n=[];var r=[];var i=[];var a=[];var o={};forEach(e,(function(s,u){if(isFieldDef(s)){var l=s.field,f=s.aggregate,c=s.bin,d=s.timeUnit,p=__rest(s,["field","aggregate","bin","timeUnit"]);if(f||d||c){var h=getGuide(s);var g=h&&h.title;var m=vgField(s,{forAs:true});var v=__assign(__assign(__assign({},g?[]:{title:title(s,t,{allowDisabling:true})}),p),{field:m});if(f){var y=void 0;if(isArgmaxDef(f)){y="argmax";m=vgField({op:"argmax",field:f.argmax},{forAs:true});v.field=m+"."+l}else if(isArgminDef(f)){y="argmin";m=vgField({op:"argmin",field:f.argmin},{forAs:true});v.field=m+"."+l}else if(f!=="boxplot"&&f!=="errorbar"&&f!=="errorband"){y=f}if(y){var _={op:y,as:m};if(l){_.field=l}a.push(_)}}else{n.push(m);if(isTypedFieldDef(s)&&isBinning(c)){r.push({bin:c,field:l,as:m});n.push(vgField(s,{binSuffix:"end"}));if(binRequiresRange(s,u)){n.push(vgField(s,{binSuffix:"range"}))}if(isXorY(u)){var b={field:m+"_end"};o[u+"2"]=b}v.bin="binned";if(!isSecondaryRangeChannel(u)){v["type"]=QUANTITATIVE}}else if(d){i.push({timeUnit:d,field:l,as:m});var x=isTypedFieldDef(s)&&s.type!==TEMPORAL&&"time";if(x){if(u===TEXT$1||u===TOOLTIP){v["formatType"]=x}else if(isNonPositionScaleChannel(u)){v["legend"]=__assign({formatType:x},v["legend"])}else if(isXorY(u)){v["axis"]=__assign({formatType:x},v["axis"])}}}}o[u]=v}else{n.push(l);o[u]=e[u]}}else{o[u]=e[u]}}));return{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function markChannelCompatible(e,t,n){var r=supportMark(t,n);if(!r){return false}else if(r==="binned"){var i=e[t===X2?X:Y];if(isFieldDef(i)&&isFieldDef(e[t])&&isBinned(i.bin)){return true}else{return false}}return true}function initEncoding(e,t,n,r){return keys$1(e).reduce((function(i,a){if(!isChannel(a)){warn(invalidEncodingChannel(a));return i}var o=e[a];if(a==="angle"&&t==="arc"&&!e.theta){warn(REPLACE_ANGLE_WITH_THETA);a=THETA}if(!markChannelCompatible(e,a,t)){warn(incompatibleChannel(a,t));return i}if(a===SIZE&&t==="line"){var s=getFieldDef(e[a]);if(s===null||s===void 0?void 0:s.aggregate){warn(LINE_WITH_VARYING_SIZE);return i}}if(a===COLOR&&(n?"fill"in e:"stroke"in e)){warn(droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e}));return i}if(a===DETAIL||a===ORDER&&!isArray(o)&&!isValueDef(o)||a===TOOLTIP&&isArray(o)){if(o){i[a]=array$5(o).reduce((function(e,t){if(!isFieldDef(t)){warn(emptyFieldDef(t,a))}else{e.push(initFieldDef(t,a))}return e}),[])}}else{if(a===TOOLTIP&&o===null){i[a]=null}else if(!isFieldDef(o)&&!isDatumDef(o)&&!isValueDef(o)&&!isConditionalDef(o)&&!isSignalRef(o)){warn(emptyFieldDef(o,a));return i}i[a]=initChannelDef(o,a,r)}return i}),{})}function normalizeEncoding(e,t){var n={};for(var r=0,i=keys$1(e);r<i.length;r++){var a=i[r];var o=initChannelDef(e[a],a,t,{compositeMark:true});n[a]=o}return n}function fieldDefs(e){var t=[];for(var n=0,r=keys$1(e);n<r.length;n++){var i=r[n];if(channelHasField(e,i)){var a=e[i];var o=array$5(a);for(var s=0,u=o;s<u.length;s++){var l=u[s];if(isFieldDef(l)){t.push(l)}else if(hasConditionalFieldDef(l)){t.push(l.condition)}}}}return t}function forEach(e,t,n){if(!e){return}for(var r=0,i=keys$1(e);r<i.length;r++){var a=i[r];var o=e[a];if(isArray(o)){for(var s=0,u=o;s<u.length;s++){var l=u[s];t.call(n,l,a)}}else{t.call(n,o,a)}}}function reduce(e,t,n,r){if(!e){return n}return keys$1(e).reduce((function(n,i){var a=e[i];if(isArray(a)){return a.reduce((function(e,n){return t.call(r,e,n,i)}),n)}else{return t.call(r,n,a,i)}}),n)}function pathGroupingFields(e,t){return keys$1(t).reduce((function(n,r){switch(r){case X:case Y:case HREF:case DESCRIPTION:case URL$1:case X2:case Y2:case THETA:case THETA2:case RADIUS:case RADIUS2:case LATITUDE:case LONGITUDE:case LATITUDE2:case LONGITUDE2:case TEXT$1:case SHAPE:case ANGLE:case TOOLTIP:return n;case ORDER:if(e==="line"||e==="trail"){return n}case DETAIL:case KEY:{var i=t[r];if(isArray(i)||isFieldDef(i)){for(var a=0,o=array$5(i);a<o.length;a++){var s=o[a];if(!s.aggregate){n.push(vgField(s,{}))}}}return n}case SIZE:if(e==="trail"){return n}case COLOR:case FILL:case STROKE:case OPACITY:case FILLOPACITY:case STROKEOPACITY:case STROKEDASH:case STROKEWIDTH:{var s=getFieldDef(t[r]);if(s&&!s.aggregate){n.push(vgField(s,{}))}return n}}}),[])}function filterTooltipWithAggregatedField(e){var t=e.tooltip,n=__rest(e,["tooltip"]);if(!t){return{filteredEncoding:n}}var r;var i;if(isArray(t)){for(var a=0,o=t;a<o.length;a++){var s=o[a];if(s.aggregate){if(!r){r=[]}r.push(s)}else{if(!i){i=[]}i.push(s)}}if(r){n.tooltip=r}}else{if(t["aggregate"]){n.tooltip=t}else{i=t}}if(isArray(i)&&i.length===1){i=i[0]}return{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}function getCompositeMarkTooltip(e,t,n,r){if(r===void 0){r=true}if("tooltip"in n){return{tooltip:n.tooltip}}var i=e.map((function(e){var n=e.fieldPrefix,i=e.titlePrefix;var a=r?" of "+getTitle(t):"";return{field:n+t.field,type:t.type,title:isSignalRef(i)?{signal:i+'"'+escape(a)+'"'}:i+a}}));var a=fieldDefs(n).map(toStringFieldDef);return{tooltip:__spreadArray(__spreadArray([],i),unique(a,hash))}}function getTitle(e){var t=e.title,n=e.field;return getFirstDefined(t,n)}function makeCompositeAggregatePartFactory(e,t,n,r,i){var a=n.scale,o=n.axis;return function(s){var u,l;var f=s.partName,c=s.mark,d=s.positionPrefix,p=s.endPositionPrefix,h=p===void 0?undefined:p,g=s.extraEncoding,m=g===void 0?{}:g;var v=getTitle(n);return partLayerMixins(e,f,i,{mark:c,encoding:__assign(__assign(__assign((u={},u[t]=__assign(__assign(__assign({field:d+"_"+n.field,type:n.type},v!==undefined?{title:v}:{}),a!==undefined?{scale:a}:{}),o!==undefined?{axis:o}:{}),u),isString(h)?(l={},l[t+"2"]={field:h+"_"+n.field},l):{}),r),m)})}}function partLayerMixins(e,t,n,r){var i=e.clip,a=e.color,o=e.opacity;var s=e.type;if(e[t]||e[t]===undefined&&n[t]){return[__assign(__assign({},r),{mark:__assign(__assign(__assign(__assign(__assign(__assign(__assign({},n[t]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),isMarkDef(r.mark)?r.mark:{type:r.mark}),{style:s+"-"+t}),isBoolean$2(e[t])?{}:e[t])})]}return[]}function compositeMarkContinuousAxis(e,t,n){var r=e.encoding;var i=t==="vertical"?"y":"x";var a=r[i];var o=r[i+"2"];var s=r[i+"Error"];var u=r[i+"Error2"];return{continuousAxisChannelDef:filterAggregateFromChannelDef(a,n),continuousAxisChannelDef2:filterAggregateFromChannelDef(o,n),continuousAxisChannelDefError:filterAggregateFromChannelDef(s,n),continuousAxisChannelDefError2:filterAggregateFromChannelDef(u,n),continuousAxis:i}}function filterAggregateFromChannelDef(e,t){if(e&&e.aggregate){var n=e.aggregate,r=__rest(e,["aggregate"]);if(n!==t){warn(errorBarContinuousAxisHasCustomizedAggregate(n,t))}return r}else{return e}}function compositeMarkOrient(e,t){var n=e.mark,r=e.encoding;var i=r.x,a=r.y;if(isMarkDef(n)&&n.orient){return n.orient}if(isContinuousFieldOrDatumDef(i)){if(isContinuousFieldOrDatumDef(a)){var o=isFieldDef(i)&&i.aggregate;var s=isFieldDef(a)&&a.aggregate;if(!o&&s===t){return"vertical"}else if(!s&&o===t){return"horizontal"}else if(o===t&&s===t){throw new Error("Both x and y cannot have aggregate")}else{if(isFieldOrDatumDefForTimeFormat(a)&&!isFieldOrDatumDefForTimeFormat(i)){return"horizontal"}return"vertical"}}return"horizontal"}else if(isContinuousFieldOrDatumDef(a)){return"vertical"}else{throw new Error("Need a valid continuous axis for "+t+"s")}}var BOXPLOT="boxplot";var BOXPLOT_PARTS=["box","median","outliers","rule","ticks"];var boxPlotNormalizer=new CompositeMarkNormalizer(BOXPLOT,normalizeBoxPlot);function getBoxPlotType(e){if(isNumber$1(e)){return"tukey"}return e}function normalizeBoxPlot(e,t){var n,r;var i,a;var o=t.config;e=__assign(__assign({},e),{encoding:normalizeEncoding(e.encoding,o)});var s=e.mark,u=e.encoding,l=e.params,f=e.projection,c=__rest(e,["mark","encoding","params","projection"]);var d=isMarkDef(s)?s:{type:s};if(l){warn(selectionNotSupported("boxplot"))}var p=(i=d.extent)!==null&&i!==void 0?i:o.boxplot.extent;var h=getMarkPropOrConfig("size",d,o);var g=getBoxPlotType(p);var m=boxParams(e,p,o),v=m.bins,y=m.timeUnits,_=m.transform,b=m.continuousAxisChannelDef,x=m.continuousAxis,E=m.groupby,S=m.aggregate,$=m.encodingWithoutContinuousAxis,A=m.ticksOrient,D=m.boxOrient,w=m.customTooltipWithoutAggregatedField;var C=$.color,T=$.size,k=__rest($,["color","size"]);var O=function(e){return makeCompositeAggregatePartFactory(d,x,b,e,o.boxplot)};var N=O(k);var R=O($);var F=O(__assign(__assign({},k),T?{size:T}:{}));var L=getCompositeMarkTooltip([{fieldPrefix:g==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:g==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],b,$);var P={type:"tick",color:"black",opacity:1,orient:A,invalid:null,aria:false};var I=g==="min-max"?L:getCompositeMarkTooltip([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],b,$);var M=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],N({partName:"rule",mark:{type:"rule",invalid:null,aria:false},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:I})),N({partName:"rule",mark:{type:"rule",invalid:null,aria:false},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:I})),N({partName:"ticks",mark:P,positionPrefix:"lower_whisker",extraEncoding:I})),N({partName:"ticks",mark:P,positionPrefix:"upper_whisker",extraEncoding:I}));var z=__spreadArray(__spreadArray(__spreadArray([],g!=="tukey"?M:[]),R({partName:"box",mark:__assign(__assign({type:"bar"},h?{size:h}:{}),{orient:D,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:L})),F({partName:"median",mark:__assign(__assign(__assign({type:"tick",invalid:null},isObject(o.boxplot.median)&&o.boxplot.median.color?{color:o.boxplot.median.color}:{}),h?{size:h}:{}),{orient:A,aria:false}),positionPrefix:"mid_box",extraEncoding:L}));if(g==="min-max"){return __assign(__assign({},c),{transform:((a=c.transform)!==null&&a!==void 0?a:[]).concat(_),layer:z})}var B='datum["lower_box_'+b.field+'"]';var U='datum["upper_box_'+b.field+'"]';var j="("+U+" - "+B+")";var H=B+" - "+p+" * "+j;var q=U+" + "+p+" * "+j;var G='datum["'+b.field+'"]';var W={joinaggregate:boxParamsQuartiles(b.field),groupby:E};var V={transform:[{filter:"("+H+" <= "+G+") && ("+G+" <= "+q+")"},{aggregate:__spreadArray([{op:"min",field:b.field,as:"lower_whisker_"+b.field},{op:"max",field:b.field,as:"upper_whisker_"+b.field},{op:"min",field:"lower_box_"+b.field,as:"lower_box_"+b.field},{op:"max",field:"upper_box_"+b.field,as:"upper_box_"+b.field}],S),groupby:E}],layer:M};var Y=k.tooltip,X=__rest(k,["tooltip"]);var K=b.scale,J=b.axis;var Q=getTitle(b);var Z=omit(J,["title"]);var ee=partLayerMixins(d,"outliers",o.boxplot,{transform:[{filter:"("+G+" < "+H+") || ("+G+" > "+q+")"}],mark:"point",encoding:__assign(__assign(__assign((n={},n[x]=__assign(__assign(__assign({field:b.field,type:b.type},Q!==undefined?{title:Q}:{}),K!==undefined?{scale:K}:{}),isEmpty(Z)?{}:{axis:Z}),n),X),C?{color:C}:{}),w?{tooltip:w}:{})})[0];var te;var ne=__spreadArray(__spreadArray(__spreadArray([],v),y),[W]);if(ee){te={transform:ne,layer:[ee,V]}}else{te=V;(r=te.transform).unshift.apply(r,ne)}return __assign(__assign({},c),{layer:[te,{transform:_,layer:z}]})}function boxParamsQuartiles(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function boxParams(e,t,n){var r=compositeMarkOrient(e,BOXPLOT);var i=compositeMarkContinuousAxis(e,r,BOXPLOT),a=i.continuousAxisChannelDef,o=i.continuousAxis;var s=a.field;var u=getBoxPlotType(t);var l=__spreadArray(__spreadArray([],boxParamsQuartiles(s)),[{op:"median",field:s,as:"mid_box_"+s},{op:"min",field:s,as:(u==="min-max"?"lower_whisker_":"min_")+s},{op:"max",field:s,as:(u==="min-max"?"upper_whisker_":"max_")+s}]);var f=u==="min-max"||u==="tukey"?[]:[{calculate:'datum["upper_box_'+s+'"] - datum["lower_box_'+s+'"]',as:"iqr_"+s},{calculate:'min(datum["upper_box_'+s+'"] + datum["iqr_'+s+'"] * '+t+', datum["max_'+s+'"])',as:"upper_whisker_"+s},{calculate:'max(datum["lower_box_'+s+'"] - datum["iqr_'+s+'"] * '+t+', datum["min_'+s+'"])',as:"lower_whisker_"+s}];var c=e.encoding,d=o,p=c[d],h=__rest(c,[typeof d==="symbol"?d:d+""]);var g=filterTooltipWithAggregatedField(h),m=g.customTooltipWithoutAggregatedField,v=g.filteredEncoding;var y=extractTransformsFromEncoding(v,n),_=y.bins,b=y.timeUnits,x=y.aggregate,E=y.groupby,S=y.encoding;var $=r==="vertical"?"horizontal":"vertical";var A=r;var D=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],_),b),[{aggregate:__spreadArray(__spreadArray([],x),l),groupby:E}]),f);return{bins:_,timeUnits:b,transform:D,groupby:E,aggregate:x,continuousAxisChannelDef:a,continuousAxis:o,encodingWithoutContinuousAxis:S,ticksOrient:$,boxOrient:A,customTooltipWithoutAggregatedField:m}}var ERRORBAR="errorbar";var ERRORBAR_PARTS=["ticks","rule"];var errorBarNormalizer=new CompositeMarkNormalizer(ERRORBAR,normalizeErrorBar);function normalizeErrorBar(e,t){var n=t.config;e=__assign(__assign({},e),{encoding:normalizeEncoding(e.encoding,n)});var r=errorBarParams(e,ERRORBAR,n),i=r.transform,a=r.continuousAxisChannelDef,o=r.continuousAxis,s=r.encodingWithoutContinuousAxis,u=r.ticksOrient,l=r.markDef,f=r.outerSpec,c=r.tooltipEncoding;delete s["size"];var d=makeCompositeAggregatePartFactory(l,o,a,s,n.errorbar);var p=l.thickness;var h=l.size;var g=__assign(__assign({type:"tick",orient:u,aria:false},p!==undefined?{thickness:p}:{}),h!==undefined?{size:h}:{});var m=__spreadArray(__spreadArray(__spreadArray([],d({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:c})),d({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:c})),d({partName:"rule",mark:__assign({type:"rule",ariaRoleDescription:"errorbar"},p!==undefined?{size:p}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}));return __assign(__assign(__assign({},f),{transform:i}),m.length>1?{layer:m}:__assign({},m[0]))}function errorBarOrientAndInputType(e,t){var n=e.encoding;if(errorBarIsInputTypeRaw(n)){return{orient:compositeMarkOrient(e,t),inputType:"raw"}}var r=errorBarIsInputTypeAggregatedUpperLower(n);var i=errorBarIsInputTypeAggregatedError(n);var a=n.x;var o=n.y;if(r){if(i){throw new Error(t+" cannot be both type aggregated-upper-lower and aggregated-error")}var s=n.x2;var u=n.y2;if(isFieldOrDatumDef(s)&&isFieldOrDatumDef(u)){throw new Error(t+" cannot have both x2 and y2")}else if(isFieldOrDatumDef(s)){if(isContinuousFieldOrDatumDef(a)){return{orient:"horizontal",inputType:"aggregated-upper-lower"}}else{throw new Error("Both x and x2 have to be quantitative in "+t)}}else if(isFieldOrDatumDef(u)){if(isContinuousFieldOrDatumDef(o)){return{orient:"vertical",inputType:"aggregated-upper-lower"}}else{throw new Error("Both y and y2 have to be quantitative in "+t)}}throw new Error("No ranged axis")}else{var l=n.xError;var f=n.xError2;var c=n.yError;var d=n.yError2;if(isFieldOrDatumDef(f)&&!isFieldOrDatumDef(l)){throw new Error(t+" cannot have xError2 without xError")}if(isFieldOrDatumDef(d)&&!isFieldOrDatumDef(c)){throw new Error(t+" cannot have yError2 without yError")}if(isFieldOrDatumDef(l)&&isFieldOrDatumDef(c)){throw new Error(t+" cannot have both xError and yError with both are quantiative")}else if(isFieldOrDatumDef(l)){if(isContinuousFieldOrDatumDef(a)){return{orient:"horizontal",inputType:"aggregated-error"}}else{throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}}else if(isFieldOrDatumDef(c)){if(isContinuousFieldOrDatumDef(o)){return{orient:"vertical",inputType:"aggregated-error"}}else{throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}}throw new Error("No ranged axis")}}function errorBarIsInputTypeRaw(e){return(isFieldOrDatumDef(e.x)||isFieldOrDatumDef(e.y))&&!isFieldOrDatumDef(e.x2)&&!isFieldOrDatumDef(e.y2)&&!isFieldOrDatumDef(e.xError)&&!isFieldOrDatumDef(e.xError2)&&!isFieldOrDatumDef(e.yError)&&!isFieldOrDatumDef(e.yError2)}function errorBarIsInputTypeAggregatedUpperLower(e){return isFieldOrDatumDef(e.x2)||isFieldOrDatumDef(e.y2)}function errorBarIsInputTypeAggregatedError(e){return isFieldOrDatumDef(e.xError)||isFieldOrDatumDef(e.xError2)||isFieldOrDatumDef(e.yError)||isFieldOrDatumDef(e.yError2)}function errorBarParams(e,t,n){var r;var i=e.mark,a=e.encoding,o=e.params,s=e.projection,u=__rest(e,["mark","encoding","params","projection"]);var l=isMarkDef(i)?i:{type:i};if(o){warn(selectionNotSupported(t))}var f=errorBarOrientAndInputType(e,t),c=f.orient,d=f.inputType;var p=compositeMarkContinuousAxis(e,c,t),h=p.continuousAxisChannelDef,g=p.continuousAxisChannelDef2,m=p.continuousAxisChannelDefError,v=p.continuousAxisChannelDefError2,y=p.continuousAxis;var _=errorBarAggregationAndCalculation(l,h,g,m,v,d,t,n),b=_.errorBarSpecificAggregate,x=_.postAggregateCalculates,E=_.tooltipSummary,S=_.tooltipTitleWithFieldName;var $=a,A=y,D=$[A],w=y==="x"?"x2":"y2",C=$[w],T=y==="x"?"xError":"yError",k=$[T],O=y==="x"?"xError2":"yError2",N=$[O],R=__rest($,[typeof A==="symbol"?A:A+"",typeof w==="symbol"?w:w+"",typeof T==="symbol"?T:T+"",typeof O==="symbol"?O:O+""]);var F=extractTransformsFromEncoding(R,n),L=F.bins,P=F.timeUnits,I=F.aggregate,M=F.groupby,z=F.encoding;var B=__spreadArray(__spreadArray([],I),b);var U=d!=="raw"?[]:M;var j=getCompositeMarkTooltip(E,h,z,S);return{transform:__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],(r=u.transform)!==null&&r!==void 0?r:[]),L),P),B.length===0?[]:[{aggregate:B,groupby:U}]),x),groupby:U,continuousAxisChannelDef:h,continuousAxis:y,encodingWithoutContinuousAxis:z,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:j}}function errorBarAggregationAndCalculation(e,t,n,r,i,a,o,s){var u=[];var l=[];var f=t.field;var c;var d=false;if(a==="raw"){var p=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":s.errorbar.center;var h=e.extent?e.extent:p==="mean"?"stderr":"iqr";if(p==="median"!==(h==="iqr")){warn(errorBarCenterIsUsedWithWrongExtent(p,h,o))}if(h==="stderr"||h==="stdev"){u=[{op:h,field:f,as:"extent_"+f},{op:p,field:f,as:"center_"+f}];l=[{calculate:'datum["center_'+f+'"] + datum["extent_'+f+'"]',as:"upper_"+f},{calculate:'datum["center_'+f+'"] - datum["extent_'+f+'"]',as:"lower_"+f}];c=[{fieldPrefix:"center_",titlePrefix:titleCase(p)},{fieldPrefix:"upper_",titlePrefix:getTitlePrefix(p,h,"+")},{fieldPrefix:"lower_",titlePrefix:getTitlePrefix(p,h,"-")}];d=true}else{var g=void 0;var m=void 0;var v=void 0;if(h==="ci"){g="mean";m="ci0";v="ci1"}else{g="median";m="q1";v="q3"}u=[{op:m,field:f,as:"lower_"+f},{op:v,field:f,as:"upper_"+f},{op:g,field:f,as:"center_"+f}];c=[{fieldPrefix:"upper_",titlePrefix:title({field:f,aggregate:v,type:"quantitative"},s,{allowDisabling:false})},{fieldPrefix:"lower_",titlePrefix:title({field:f,aggregate:m,type:"quantitative"},s,{allowDisabling:false})},{fieldPrefix:"center_",titlePrefix:title({field:f,aggregate:g,type:"quantitative"},s,{allowDisabling:false})}]}}else{if(e.center||e.extent){warn(errorBarCenterAndExtentAreNotNeeded(e.center,e.extent))}if(a==="aggregated-upper-lower"){c=[];l=[{calculate:'datum["'+n.field+'"]',as:"upper_"+f},{calculate:'datum["'+f+'"]',as:"lower_"+f}]}else if(a==="aggregated-error"){c=[{fieldPrefix:"",titlePrefix:f}];l=[{calculate:'datum["'+f+'"] + datum["'+r.field+'"]',as:"upper_"+f}];if(i){l.push({calculate:'datum["'+f+'"] + datum["'+i.field+'"]',as:"lower_"+f})}else{l.push({calculate:'datum["'+f+'"] - datum["'+r.field+'"]',as:"lower_"+f})}}for(var y=0,_=l;y<_.length;y++){var b=_[y];c.push({fieldPrefix:b.as.substring(0,6),titlePrefix:replaceAll(replaceAll(b.calculate,'datum["',""),'"]',"")})}}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:c,tooltipTitleWithFieldName:d}}function getTitlePrefix(e,t,n){return titleCase(e)+" "+n+" "+t}var ERRORBAND="errorband";var ERRORBAND_PARTS=["band","borders"];var errorBandNormalizer=new CompositeMarkNormalizer(ERRORBAND,normalizeErrorBand);function normalizeErrorBand(e,t){var n=t.config;e=__assign(__assign({},e),{encoding:normalizeEncoding(e.encoding,n)});var r=errorBarParams(e,ERRORBAND,n),i=r.transform,a=r.continuousAxisChannelDef,o=r.continuousAxis,s=r.encodingWithoutContinuousAxis,u=r.markDef,l=r.outerSpec,f=r.tooltipEncoding;var c=u;var d=makeCompositeAggregatePartFactory(c,o,a,s,n.errorband);var p=e.encoding.x!==undefined&&e.encoding.y!==undefined;var h={type:p?"area":"rect"};var g={type:p?"line":"rule"};var m=__assign(__assign({},c.interpolate?{interpolate:c.interpolate}:{}),c.tension&&c.interpolate?{tension:c.tension}:{});if(p){h=__assign(__assign(__assign({},h),m),{ariaRoleDescription:"errorband"});g=__assign(__assign(__assign({},g),m),{aria:false})}else if(c.interpolate){warn(errorBand1DNotSupport("interpolate"))}else if(c.tension){warn(errorBand1DNotSupport("tension"))}return __assign(__assign({},l),{transform:i,layer:__spreadArray(__spreadArray(__spreadArray([],d({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:f})),d({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:f})),d({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:f}))})}var compositeMarkRegistry={};function add(e,t,n){var r=new CompositeMarkNormalizer(e,t);compositeMarkRegistry[e]={normalizer:r,parts:n}}function getAllCompositeMarks(){return keys$1(compositeMarkRegistry)}add(BOXPLOT,normalizeBoxPlot,BOXPLOT_PARTS);add(ERRORBAR,normalizeErrorBar,ERRORBAR_PARTS);add(ERRORBAND,normalizeErrorBand,ERRORBAND_PARTS);var VL_ONLY_LEGEND_CONFIG=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"];var HEADER_TITLE_PROPERTIES_MAP={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"};var HEADER_LABEL_PROPERTIES_MAP={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"};var HEADER_TITLE_PROPERTIES=keys$1(HEADER_TITLE_PROPERTIES_MAP);var HEADER_LABEL_PROPERTIES=keys$1(HEADER_LABEL_PROPERTIES_MAP);var HEADER_CONFIGS_INDEX={header:1,headerRow:1,headerColumn:1,headerFacet:1};var HEADER_CONFIGS=keys$1(HEADER_CONFIGS_INDEX);var LEGEND_SCALE_CHANNELS=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"];var defaultLegendConfig={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35};var COMMON_LEGEND_PROPERTY_INDEX={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};var SELECTION_ID="_vgsid_";var defaultConfig$1={point:{on:"click",fields:[SELECTION_ID],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function isLegendBinding(e){return!!e&&(e==="legend"||!!e.legend)}function isLegendStreamBinding(e){return isLegendBinding(e)&&isObject(e)}function isSelectionParameter(e){return!!e["select"]}function assembleParameterSignals(e){var t=[];for(var n=0,r=e||[];n<r.length;n++){var i=r[n];if(isSelectionParameter(i))continue;var a=i.expr,o=i.bind,s=__rest(i,["expr","bind"]);if(o&&a){var u=__assign(__assign({},s),{bind:o,init:a});t.push(u)}else{var u=__assign(__assign(__assign({},s),a?{update:a}:{}),o?{bind:o}:{});t.push(u)}}return t}function isAnyConcatSpec(e){return isVConcatSpec(e)||isHConcatSpec(e)||isConcatSpec(e)}function isConcatSpec(e){return"concat"in e}function isVConcatSpec(e){return"vconcat"in e}function isHConcatSpec(e){return"hconcat"in e}function isStep(e){return isObject(e)&&e["step"]!==undefined}function isFrameMixins(e){return e["view"]||e["width"]||e["height"]}var DEFAULT_SPACING=20;var COMPOSITION_LAYOUT_INDEX={align:1,bounds:1,center:1,columns:1,spacing:1};var COMPOSITION_LAYOUT_PROPERTIES=keys$1(COMPOSITION_LAYOUT_INDEX);function extractCompositionLayout(e,t,n){var r,i;var a=n[t];var o={};var s=a.spacing,u=a.columns;if(s!==undefined){o.spacing=s}if(u!==undefined){if(isFacetSpec(e)&&!isFacetMapping(e.facet)||isConcatSpec(e)){o.columns=u}}if(isVConcatSpec(e)){o.columns=1}for(var l=0,f=COMPOSITION_LAYOUT_PROPERTIES;l<f.length;l++){var c=f[l];if(e[c]!==undefined){if(c==="spacing"){var d=e[c];o[c]=isNumber$1(d)?d:{row:(r=d.row)!==null&&r!==void 0?r:s,column:(i=d.column)!==null&&i!==void 0?i:s}}else{o[c]=e[c]}}}return o}function getViewConfigContinuousSize(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function getViewConfigDiscreteStep(e,t){var n=getViewConfigDiscreteSize(e,t);return isStep(n)?n.step:DEFAULT_STEP}function getViewConfigDiscreteSize(e,t){var n;var r=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return getFirstDefined(r,{step:e.step})}var DEFAULT_STEP=20;var defaultViewConfig={continuousWidth:200,continuousHeight:200,step:DEFAULT_STEP};var defaultConfig={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:defaultViewConfig,mark:defaultMarkConfig,arc:{},area:{},bar:defaultBarConfig,circle:{},geoshape:{},image:{},line:{},point:{},rect:defaultRectConfig,rule:{color:"black"},square:{},text:{color:"black"},tick:defaultTickConfig,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:true,ticks:false},errorband:{band:{opacity:.3},borders:false},scale:defaultScaleConfig,projection:{},legend:defaultLegendConfig,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:defaultConfig$1,style:{},title:{},facet:{spacing:DEFAULT_SPACING},concat:{spacing:DEFAULT_SPACING}};var tab10=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"];var DEFAULT_FONT_SIZE={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12};var DEFAULT_COLOR={blue:tab10[0],orange:tab10[1],red:tab10[2],teal:tab10[3],green:tab10[4],yellow:tab10[5],purple:tab10[6],pink:tab10[7],brown:tab10[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function colorSignalConfig(e){if(e===void 0){e={}}return{signals:[{name:"color",value:isObject(e)?__assign(__assign({},DEFAULT_COLOR),e):DEFAULT_COLOR}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function fontSizeSignalConfig(e){return{signals:[{name:"fontSize",value:isObject(e)?__assign(__assign({},DEFAULT_FONT_SIZE),e):DEFAULT_FONT_SIZE}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function fontConfig(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function getAxisConfigInternal(e){var t=keys$1(e||{});var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];var o=e[a];n[a]=isConditionalAxisValue(o)?signalOrValueRefWithCondition(o):signalRefOrValue(o)}return n}function getStyleConfigInternal(e){var t=keys$1(e);var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];n[a]=getAxisConfigInternal(e[a])}return n}var configPropsWithExpr=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],MARK_CONFIGS),AXIS_CONFIGS),HEADER_CONFIGS),["background","padding","legend","lineBreak","scale","style","title","view"]);function initConfig(e){if(e===void 0){e={}}var t=e.color,n=e.font,r=e.fontSize,i=__rest(e,["color","font","fontSize"]);var a=mergeConfig({},defaultConfig,n?fontConfig(n):{},t?colorSignalConfig(t):{},r?fontSizeSignalConfig(r):{},i||{});var o=omit(a,configPropsWithExpr);for(var s=0,u=["background","lineBreak","padding"];s<u.length;s++){var l=u[s];if(a[l]){o[l]=signalRefOrValue(a[l])}}for(var f=0,c=MARK_CONFIGS;f<c.length;f++){var d=c[f];if(a[d]){o[d]=replaceExprRef(a[d])}}for(var p=0,h=AXIS_CONFIGS;p<h.length;p++){var g=h[p];if(a[g]){o[g]=getAxisConfigInternal(a[g])}}for(var m=0,v=HEADER_CONFIGS;m<v.length;m++){var y=v[m];if(a[y]){o[y]=replaceExprRef(a[y])}}if(a.legend){o.legend=replaceExprRef(a.legend)}if(a.scale){o.scale=replaceExprRef(a.scale)}if(a.style){o.style=getStyleConfigInternal(a.style)}if(a.title){o.title=replaceExprRef(a.title)}if(a.view){o.view=replaceExprRef(a.view)}return o}var MARK_STYLES=__spreadArray(["view"],PRIMITIVE_MARKS);var VL_ONLY_CONFIG_PROPERTIES=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"];var VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=__assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);function stripAndRedirectConfig(e){e=duplicate(e);for(var t=0,n=VL_ONLY_CONFIG_PROPERTIES;t<n.length;t++){var r=n[t];delete e[r]}if(e.axis){for(var r in e.axis){if(isConditionalAxisValue(e.axis[r])){delete e.axis[r]}}}if(e.legend){for(var i=0,a=VL_ONLY_LEGEND_CONFIG;i<a.length;i++){var r=a[i];delete e.legend[r]}}if(e.mark){for(var o=0,s=VL_ONLY_MARK_CONFIG_PROPERTIES;o<s.length;o++){var r=s[o];delete e.mark[r]}if(e.mark.tooltip&&isObject(e.mark.tooltip)){delete e.mark.tooltip}}if(e.params){e.signals=(e.signals||[]).concat(assembleParameterSignals(e.params));delete e.params}for(var u=0,l=MARK_STYLES;u<l.length;u++){var f=l[u];for(var c=0,d=VL_ONLY_MARK_CONFIG_PROPERTIES;c<d.length;c++){var r=d[c];delete e[f][r]}var p=VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX[f];if(p){for(var h=0,g=p;h<g.length;h++){var r=g[h];delete e[f][r]}}redirectConfigToStyleConfig(e,f)}for(var m=0,v=getAllCompositeMarks();m<v.length;m++){var y=v[m];delete e[y]}redirectTitleConfig(e);for(var r in e){if(isObject(e[r])&&isEmpty(e[r])){delete e[r]}}return isEmpty(e)?undefined:e}function redirectTitleConfig(e){var t=extractTitleConfig(e.title),n=t.titleMarkConfig,r=t.subtitleMarkConfig,i=t.subtitle;if(!isEmpty(n)){e.style["group-title"]=__assign(__assign({},e.style["group-title"]),n)}if(!isEmpty(r)){e.style["group-subtitle"]=__assign(__assign({},e.style["group-subtitle"]),r)}if(!isEmpty(i)){e.title=i}else{delete e.title}}function redirectConfigToStyleConfig(e,t,n,r){var i=r?e[t][r]:e[t];if(t==="view"){n="cell"}var a=__assign(__assign({},i),e.style[n!==null&&n!==void 0?n:t]);if(!isEmpty(a)){e.style[n!==null&&n!==void 0?n:t]=a}if(!r){delete e[t]}}function isLayerSpec(e){return"layer"in e}function isRepeatSpec(e){return"repeat"in e}function isLayerRepeatSpec(e){return!isArray(e.repeat)&&e.repeat["layer"]}var SpecMapper=function(){function e(){}e.prototype.map=function(e,t){if(isFacetSpec(e)){return this.mapFacet(e,t)}else if(isRepeatSpec(e)){return this.mapRepeat(e,t)}else if(isHConcatSpec(e)){return this.mapHConcat(e,t)}else if(isVConcatSpec(e)){return this.mapVConcat(e,t)}else if(isConcatSpec(e)){return this.mapConcat(e,t)}else{return this.mapLayerOrUnit(e,t)}};e.prototype.mapLayerOrUnit=function(e,t){if(isLayerSpec(e)){return this.mapLayer(e,t)}else if(isUnitSpec(e)){return this.mapUnit(e,t)}throw new Error(invalidSpec(e))};e.prototype.mapLayer=function(e,t){var n=this;return __assign(__assign({},e),{layer:e.layer.map((function(e){return n.mapLayerOrUnit(e,t)}))})};e.prototype.mapHConcat=function(e,t){var n=this;return __assign(__assign({},e),{hconcat:e.hconcat.map((function(e){return n.map(e,t)}))})};e.prototype.mapVConcat=function(e,t){var n=this;return __assign(__assign({},e),{vconcat:e.vconcat.map((function(e){return n.map(e,t)}))})};e.prototype.mapConcat=function(e,t){var n=this;var r=e.concat,i=__rest(e,["concat"]);return __assign(__assign({},i),{concat:r.map((function(e){return n.map(e,t)}))})};e.prototype.mapFacet=function(e,t){return __assign(__assign({},e),{spec:this.map(e.spec,t)})};e.prototype.mapRepeat=function(e,t){return __assign(__assign({},e),{spec:this.map(e.spec,t)})};return e}();var STACK_OFFSET_INDEX={zero:1,center:1,normalize:1};function isStackOffset(e){return e in STACK_OFFSET_INDEX}var STACKABLE_MARKS=new Set([ARC,BAR,AREA,RULE,POINT,CIRCLE,SQUARE,LINE,TEXT,TICK]);var STACK_BY_DEFAULT_MARKS=new Set([BAR,AREA,ARC]);function potentialStackedChannel(e,t){var n,r;var i=t==="x"?"y":"radius";var a=e[t];var o=e[i];if(isFieldDef(a)&&isFieldDef(o)){if(channelDefType(a)==="quantitative"&&channelDefType(o)==="quantitative"){if(a.stack){return t}else if(o.stack){return i}var s=isFieldDef(a)&&!!a.aggregate;var u=isFieldDef(o)&&!!o.aggregate;if(s!==u){return s?t:i}else{var l=(n=a.scale)===null||n===void 0?void 0:n.type;var f=(r=o.scale)===null||r===void 0?void 0:r.type;if(l&&l!=="linear"){return i}else if(f&&f!=="linear"){return t}}}else if(channelDefType(a)==="quantitative"){return t}else if(channelDefType(o)==="quantitative"){return i}}else if(channelDefType(a)==="quantitative"){return t}else if(channelDefType(o)==="quantitative"){return i}return undefined}function getDimensionChannel(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function stack(e,t,n){var r,i;if(n===void 0){n={}}var a=isMarkDef(e)?e.type:e;if(!STACKABLE_MARKS.has(a)){return null}var o=potentialStackedChannel(t,"x")||potentialStackedChannel(t,"theta");if(!o){return null}var s=t[o];var u=isFieldDef(s)?vgField(s,{}):undefined;var l=getDimensionChannel(o);var f=t[l];var c=isFieldDef(f)?vgField(f,{}):undefined;if(c===u){c=undefined;f=undefined;l=undefined}var d=NONPOSITION_CHANNELS.reduce((function(e,n){if(n!=="tooltip"&&channelHasField(t,n)){var r=t[n];for(var i=0,a=array$5(r);i<a.length;i++){var o=a[i];var s=getFieldDef(o);if(s.aggregate){continue}var u=vgField(s,{});if(!u||u!==c){e.push({channel:n,fieldDef:s})}}}return e}),[]);var p;if(s.stack!==undefined){if(isBoolean$2(s.stack)){p=s.stack?"zero":null}else{p=s.stack}}else if(STACK_BY_DEFAULT_MARKS.has(a)){p="zero"}if(!p||!isStackOffset(p)){return null}if(isAggregate$1(t)&&d.length===0){return null}if(((r=s===null||s===void 0?void 0:s.scale)===null||r===void 0?void 0:r.type)&&((i=s===null||s===void 0?void 0:s.scale)===null||i===void 0?void 0:i.type)!==ScaleType.LINEAR){if(n.disallowNonLinearStack){return null}else{warn(cannotStackNonLinearScale(s.scale.type))}}if(isFieldOrDatumDef(t[getSecondaryRangeChannel(o)])){if(s.stack!==undefined){warn(cannotStackRangedMark(o))}return null}if(isFieldDef(s)&&s.aggregate&&!contains(SUM_OPS,s.aggregate)){warn(stackNonSummativeAggregate(s.aggregate))}return{groupbyChannel:f?l:undefined,groupbyField:c,fieldChannel:o,impute:s.impute===null?false:isPathMark(a),stackBy:d,offset:p}}function dropLineAndPoint(e){var t=e.point,n=e.line,r=__rest(e,["point","line"]);return keys$1(r).length>1?r:r.type}function dropLineAndPointFromConfig(e){var t;for(var n=0,r=["line","area","rule","trail"];n<r.length;n++){var i=r[n];if(e[i]){e=__assign(__assign({},e),(t={},t[i]=omit(e[i],["point","line"]),t))}}return e}function getPointOverlay(e,t,n){if(t===void 0){t={}}if(e.point==="transparent"){return{opacity:0}}else if(e.point){return isObject(e.point)?e.point:{}}else if(e.point!==undefined){return null}else{if(t.point||n.shape){return isObject(t.point)?t.point:{}}return undefined}}function getLineOverlay(e,t){if(t===void 0){t={}}if(e.line){return e.line===true?{}:e.line}else if(e.line!==undefined){return null}else{if(t.line){return t.line===true?{}:t.line}return undefined}}var PathOverlayNormalizer=function(){function e(){this.name="path-overlay"}e.prototype.hasMatchingType=function(e,t){if(isUnitSpec(e)){var n=e.mark,r=e.encoding;var i=isMarkDef(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!getPointOverlay(i,t[i.type],r);case"area":return!!getPointOverlay(i,t[i.type],r)||!!getLineOverlay(i,t[i.type])}}return false};e.prototype.run=function(e,t,n){var r;var i=t.config;var a=e.params,o=e.projection,s=e.mark,u=e.encoding,l=__rest(e,["params","projection","mark","encoding"]);var f=normalizeEncoding(u,i);var c=isMarkDef(s)?s:{type:s};var d=getPointOverlay(c,i[c.type],f);var p=c.type==="area"&&getLineOverlay(c,i[c.type]);var h=[__assign(__assign({},a?{params:a}:{}),{mark:dropLineAndPoint(__assign(__assign({},c.type==="area"&&c.opacity===undefined&&c.fillOpacity===undefined?{opacity:.7}:{}),c)),encoding:omit(f,["shape"])})];var g=stack(c,f);var m=f;if(g){var v=g.fieldChannel,y=g.offset;m=__assign(__assign({},f),(r={},r[v]=__assign(__assign({},f[v]),y?{stack:y}:{}),r))}if(p){h.push(__assign(__assign({},o?{projection:o}:{}),{mark:__assign(__assign({type:"line"},pick(c,["clip","interpolate","tension","tooltip"])),p),encoding:m}))}if(d){h.push(__assign(__assign({},o?{projection:o}:{}),{mark:__assign(__assign({type:"point",opacity:1,filled:true},pick(c,["clip","tooltip"])),d),encoding:m}))}return n(__assign(__assign({},l),{layer:h}),__assign(__assign({},t),{config:dropLineAndPointFromConfig(i)}))};return e}();function replaceRepeaterInFacet(e,t){if(!t){return e}if(isFacetMapping(e)){return replaceRepeaterInMapping(e,t)}return replaceRepeaterInFieldDef(e,t)}function replaceRepeaterInEncoding(e,t){if(!t){return e}return replaceRepeaterInMapping(e,t)}function replaceRepeatInProp(e,t,n){var r;var i=t[e];if(isRepeatRef(i)){if(i.repeat in n){return __assign(__assign({},t),(r={},r[e]=n[i.repeat],r))}else{warn(noSuchRepeatedValue(i.repeat));return undefined}}return t}function replaceRepeaterInFieldDef(e,t){e=replaceRepeatInProp("field",e,t);if(e===undefined){return undefined}else if(e===null){return null}if(isSortableFieldDef(e)&&isSortField(e.sort)){var n=replaceRepeatInProp("field",e.sort,t);e=__assign(__assign({},e),n?{sort:n}:{})}return e}function replaceRepeaterInFieldOrDatumDef(e,t){if(isFieldDef(e)){return replaceRepeaterInFieldDef(e,t)}else{var n=replaceRepeatInProp("datum",e,t);if(n!==e&&!n.type){n.type="nominal"}return n}}function replaceRepeaterInChannelDef(e,t){if(isFieldOrDatumDef(e)){var n=replaceRepeaterInFieldOrDatumDef(e,t);if(n){return n}else if(isConditionalDef(e)){return{condition:e.condition}}}else{if(hasConditionalFieldOrDatumDef(e)){var n=replaceRepeaterInFieldOrDatumDef(e.condition,t);if(n){return __assign(__assign({},e),{condition:n})}else{var r=e.condition,i=__rest(e,["condition"]);return i}}return e}return undefined}function replaceRepeaterInMapping(e,t){var n={};for(var r in e){if(has$1(e,r)){var i=e[r];if(isArray(i)){n[r]=i.map((function(e){return replaceRepeaterInChannelDef(e,t)})).filter((function(e){return e}))}else{var a=replaceRepeaterInChannelDef(i,t);if(a!==undefined){n[r]=a}}}}return n}var RuleForRangedLineNormalizer=function(){function e(){this.name="RuleForRangedLine"}e.prototype.hasMatchingType=function(e){if(isUnitSpec(e)){var t=e.encoding,n=e.mark;if(n==="line"||isMarkDef(n)&&n.type==="line"){for(var r=0,i=SECONDARY_RANGE_CHANNEL;r<i.length;r++){var a=i[r];var o=getMainRangeChannel(a);var s=t[o];if(t[a]){if(isFieldDef(s)&&!isBinned(s.bin)||isDatumDef(s)){return true}}}}}return false};e.prototype.run=function(e,t,n){var r=e.encoding,i=e.mark;warn(lineWithRange(!!r.x2,!!r.y2));console.log(i);return n(__assign(__assign({},e),{mark:isObject(i)?__assign(__assign({},i),{type:"rule"}):"rule"}),t)};return e}();var CoreNormalizer=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.nonFacetUnitNormalizers=[boxPlotNormalizer,errorBarNormalizer,errorBandNormalizer,new PathOverlayNormalizer,new RuleForRangedLineNormalizer];return t}t.prototype.map=function(t,n){if(isUnitSpec(t)){var r=channelHasField(t.encoding,ROW);var i=channelHasField(t.encoding,COLUMN);var a=channelHasField(t.encoding,FACET);if(r||i||a){return this.mapFacetedUnit(t,n)}}return e.prototype.map.call(this,t,n)};t.prototype.mapUnit=function(e,t){var n=t.parentEncoding,r=t.parentProjection;var i=replaceRepeaterInEncoding(e.encoding,t.repeater);var a=__assign(__assign({},e),i?{encoding:i}:{});if(n||r){return this.mapUnitWithParentEncodingOrProjection(a,t)}var o=this.mapLayerOrUnit.bind(this);for(var s=0,u=this.nonFacetUnitNormalizers;s<u.length;s++){var l=u[s];if(l.hasMatchingType(a,t.config)){return l.run(a,t,o)}}return a};t.prototype.mapRepeat=function(e,t){if(isLayerRepeatSpec(e)){return this.mapLayerRepeat(e,t)}else{return this.mapNonLayerRepeat(e,t)}};t.prototype.mapLayerRepeat=function(e,t){var n=this;var r=e.repeat,i=e.spec,a=__rest(e,["repeat","spec"]);var o=r.row,s=r.column,u=r.layer;var l=t.repeater,f=l===void 0?{}:l,c=t.repeaterPrefix,d=c===void 0?"":c;if(o||s){return this.mapRepeat(__assign(__assign({},e),{repeat:__assign(__assign({},o?{row:o}:{}),s?{column:s}:{}),spec:{repeat:{layer:u},spec:i}}),t)}else{return __assign(__assign({},a),{layer:u.map((function(e){var r=__assign(__assign({},f),{layer:e});var a=(i.name||"")+d+"child__layer_"+varName(e);var o=n.mapLayerOrUnit(i,__assign(__assign({},t),{repeater:r,repeaterPrefix:a}));o.name=a;return o}))})}};t.prototype.mapNonLayerRepeat=function(e,t){var n;var r=e.repeat,i=e.spec,a=e.data,o=__rest(e,["repeat","spec","data"]);if(!isArray(r)&&e.columns){e=omit(e,["columns"]);warn(columnsNotSupportByRowCol("repeat"))}var s=[];var u=t.repeater,l=u===void 0?{}:u,f=t.repeaterPrefix,c=f===void 0?"":f;var d=!isArray(r)&&r.row||[l?l.row:null];var p=!isArray(r)&&r.column||[l?l.column:null];var h=isArray(r)&&r||[l?l.repeat:null];for(var g=0,m=h;g<m.length;g++){var v=m[g];for(var y=0,_=d;y<_.length;y++){var b=_[y];for(var x=0,E=p;x<E.length;x++){var S=E[x];var $={repeat:v,row:b,column:S,layer:l.layer};var A=(i.name||"")+c+"child__"+(isArray(r)?""+varName(v):(r.row?"row_"+varName(b):"")+(r.column?"column_"+varName(S):""));var D=this.map(i,__assign(__assign({},t),{repeater:$,repeaterPrefix:A}));D.name=A;s.push(omit(D,["data"]))}}}var w=isArray(r)?e.columns:r.column?r.column.length:1;return __assign(__assign({data:(n=i.data)!==null&&n!==void 0?n:a,align:"all"},o),{columns:w,concat:s})};t.prototype.mapFacet=function(t,n){var r=t.facet;if(isFacetMapping(r)&&t.columns){t=omit(t,["columns"]);warn(columnsNotSupportByRowCol("facet"))}return e.prototype.mapFacet.call(this,t,n)};t.prototype.mapUnitWithParentEncodingOrProjection=function(e,t){var n=e.encoding,r=e.projection;var i=t.parentEncoding,a=t.parentProjection,o=t.config;var s=mergeProjection({parentProjection:a,projection:r});var u=mergeEncoding({parentEncoding:i,encoding:replaceRepeaterInEncoding(n,t.repeater)});return this.mapUnit(__assign(__assign(__assign({},e),s?{projection:s}:{}),u?{encoding:u}:{}),{config:o})};t.prototype.mapFacetedUnit=function(e,t){var n=e.encoding,r=n.row,i=n.column,a=n.facet,o=__rest(n,["row","column","facet"]);var s=e.mark,u=e.width,l=e.projection,f=e.height,c=e.view,d=e.params,p=e.encoding,h=__rest(e,["mark","width","projection","height","view","params","encoding"]);var g=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),m=g.facetMapping,v=g.layout;var y=replaceRepeaterInEncoding(o,t.repeater);return this.mapFacet(__assign(__assign(__assign({},h),v),{facet:m,spec:__assign(__assign(__assign(__assign(__assign(__assign({},u?{width:u}:{}),f?{height:f}:{}),c?{view:c}:{}),l?{projection:l}:{}),{mark:s,encoding:y}),d?{params:d}:{})}),t)};t.prototype.getFacetMappingAndLayout=function(e,t){var n;var r=e.row,i=e.column,a=e.facet;if(r||i){if(a){warn(facetChannelDropped(__spreadArray(__spreadArray([],r?[ROW]:[]),i?[COLUMN]:[])))}var o={};var s={};for(var u=0,l=[ROW,COLUMN];u<l.length;u++){var f=l[u];var c=e[f];if(c){var d=c.align,p=c.center,h=c.spacing,g=c.columns,m=__rest(c,["align","center","spacing","columns"]);o[f]=m;for(var v=0,y=["align","center","spacing"];v<y.length;v++){var _=y[v];if(c[_]!==undefined){(n=s[_])!==null&&n!==void 0?n:s[_]={};s[_][f]=c[_]}}}}return{facetMapping:o,layout:s}}else{var b=a.align,p=a.center,h=a.spacing,g=a.columns,o=__rest(a,["align","center","spacing","columns"]);return{facetMapping:replaceRepeaterInFacet(o,t.repeater),layout:__assign(__assign(__assign(__assign({},b?{align:b}:{}),p?{center:p}:{}),h?{spacing:h}:{}),g?{columns:g}:{})}}};t.prototype.mapLayer=function(t,n){var r=n.parentEncoding,i=n.parentProjection,a=__rest(n,["parentEncoding","parentProjection"]);var o=t.encoding,s=t.projection,u=__rest(t,["encoding","projection"]);var l=__assign(__assign({},a),{parentEncoding:mergeEncoding({parentEncoding:r,encoding:o,layer:true}),parentProjection:mergeProjection({parentProjection:i,projection:s})});return e.prototype.mapLayer.call(this,u,l)};return t}(SpecMapper);function mergeEncoding(e){var t=e.parentEncoding,n=e.encoding,r=n===void 0?{}:n,i=e.layer;var a={};if(t){var o=new Set(__spreadArray(__spreadArray([],keys$1(t)),keys$1(r)));for(var s=0,u=o;s<u.length;s++){var l=u[s];var f=r[l];var c=t[l];if(isFieldOrDatumDef(f)){var d=__assign(__assign({},c),f);a[l]=d}else if(hasConditionalFieldOrDatumDef(f)){a[l]=__assign(__assign({},f),{condition:__assign(__assign({},c),f.condition)})}else if(f||f===null){a[l]=f}else if(i||isValueDef(c)||isSignalRef(c)||isFieldOrDatumDef(c)||isArray(c)){a[l]=c}}}else{a=r}return!a||isEmpty(a)?undefined:a}function mergeProjection(e){var t=e.parentProjection,n=e.projection;if(t&&n){warn(projectionOverridden({parentProjection:t,projection:n}))}return n!==null&&n!==void 0?n:t}function isFilter(e){return"filter"in e}function isImputeSequence(e){return(e===null||e===void 0?void 0:e["stop"])!==undefined}function isLookup(e){return"lookup"in e}function isLookupData(e){return"data"in e}function isLookupSelection(e){return"param"in e}function isPivot(e){return"pivot"in e}function isDensity(e){return"density"in e}function isQuantile(e){return"quantile"in e}function isRegression(e){return"regression"in e}function isLoess(e){return"loess"in e}function isSample(e){return"sample"in e}function isWindow(e){return"window"in e}function isJoinAggregate(e){return"joinaggregate"in e}function isFlatten(e){return"flatten"in e}function isCalculate(e){return"calculate"in e}function isBin(e){return"bin"in e}function isImpute(e){return"impute"in e}function isTimeUnit(e){return"timeUnit"in e}function isAggregate(e){return"aggregate"in e}function isStack(e){return"stack"in e}function isFold(e){return"fold"in e}function normalizeTransform(e){return e.map((function(e){if(isFilter(e)){return{filter:normalizeLogicalComposition(e.filter,normalizePredicate$1)}}return e}))}var SelectionCompatibilityNormalizer=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.map=function(t,n){var r,i;(r=n.emptySelections)!==null&&r!==void 0?r:n.emptySelections={};(i=n.selectionPredicates)!==null&&i!==void 0?i:n.selectionPredicates={};t=normalizeTransforms(t,n);return e.prototype.map.call(this,t,n)};t.prototype.mapLayerOrUnit=function(t,n){t=normalizeTransforms(t,n);if(t.encoding){var r={};for(var i=0,a=entries$1(t.encoding);i<a.length;i++){var o=a[i],s=o[0],u=o[1];r[s]=normalizeChannelDef(u,n)}t=__assign(__assign({},t),{encoding:r})}return e.prototype.mapLayerOrUnit.call(this,t,n)};t.prototype.mapUnit=function(e,t){var n=e.selection,r=__rest(e,["selection"]);if(n){return __assign(__assign({},r),{params:entries$1(n).map((function(e){var n;var r=e[0],i=e[1];var a=i.init,o=i.bind,s=i.empty,u=__rest(i,["init","bind","empty"]);if(u.type==="single"){u.type="point";u.toggle=false}else if(u.type==="multi"){u.type="point"}t.emptySelections[r]=s!=="none";for(var l=0,f=vals((n=t.selectionPredicates[r])!==null&&n!==void 0?n:{});l<f.length;l++){var c=f[l];c.empty=s!=="none"}return{name:r,value:a,select:u,bind:o}}))})}return e};return t}(SpecMapper);function normalizeTransforms(e,t){var n=e.transform,r=__rest(e,["transform"]);if(n){var i=n.map((function(e){if(isFilter(e)){return{filter:normalizePredicate(e,t)}}else if(isBin(e)&&isBinParams(e.bin)){return __assign(__assign({},e),{bin:normalizeBinExtent(e.bin)})}else if(isLookup(e)){var n=e.from,r=n.selection,i=__rest(n,["selection"]);return r?__assign(__assign({},e),{from:__assign({param:r},i)}):e}return e}));return __assign(__assign({},r),{transform:i})}return e}function normalizeChannelDef(e,t){var n,r;var i=duplicate(e);if(isFieldDef(i)&&isBinParams(i.bin)){i.bin=normalizeBinExtent(i.bin)}if(isScaleFieldDef(i)&&((r=(n=i.scale)===null||n===void 0?void 0:n.domain)===null||r===void 0?void 0:r.selection)){var a=i.scale.domain,o=a.selection,s=__rest(a,["selection"]);i.scale.domain=__assign(__assign({},s),o?{param:o}:{})}if(isConditionalDef(i)){if(isArray(i.condition)){i.condition=i.condition.map((function(e){var n=e.selection,r=e.param,i=e.test,a=__rest(e,["selection","param","test"]);return r?e:__assign(__assign({},a),{test:normalizePredicate(e,t)})}))}else{var u=normalizeChannelDef(i.condition,t),l=u.selection,f=u.param,c=u.test,d=__rest(u,["selection","param","test"]);i.condition=f?i.condition:__assign(__assign({},d),{test:normalizePredicate(i.condition,t)})}}return i}function normalizeBinExtent(e){var t=e.extent;if(t===null||t===void 0?void 0:t.selection){var n=t.selection,r=__rest(t,["selection"]);return __assign(__assign({},e),{extent:__assign(__assign({},r),{param:n})})}return e}function normalizePredicate(e,t){var n=function(e){return normalizeLogicalComposition(e,(function(e){var n,r;var i;var a=(n=t.emptySelections[e])!==null&&n!==void 0?n:true;var o={param:e,empty:a};(r=(i=t.selectionPredicates)[e])!==null&&r!==void 0?r:i[e]=[];t.selectionPredicates[e].push(o);return o}))};return e.selection?n(e.selection):normalizeLogicalComposition(e.test||e.filter,(function(e){return e.selection?n(e.selection):e}))}var TopLevelSelectionsNormalizer=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.map=function(t,n){var r;var i=(r=n.selections)!==null&&r!==void 0?r:[];if(t.params&&!isUnitSpec(t)){var a=[];for(var o=0,s=t.params;o<s.length;o++){var u=s[o];if(isSelectionParameter(u)){i.push(u)}else{a.push(u)}}t.params=a}n.selections=i;return e.prototype.map.call(this,t,addSpecNameToParams(t,n))};t.prototype.mapUnit=function(e,t){var n;var r=t.selections;if(!r||!r.length)return e;var i=((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name);var a=[];for(var o=0,s=r;o<s.length;o++){var u=s[o];if(!u.views||!u.views.length){a.push(u)}else{for(var l=0,f=u.views;l<f.length;l++){var c=f[l];if(isString(c)&&(c===e.name||i.indexOf(c)>=0)||isArray(c)&&c.map((function(e){return i.indexOf(e)})).every((function(e,t,n){return e!==-1&&(t===0||e>n[t-1])}))){a.push(u)}}}}if(a.length)e.params=a;return e};return t}(SpecMapper);var _loop_1=function(e){var t=TopLevelSelectionsNormalizer.prototype[e];TopLevelSelectionsNormalizer.prototype[e]=function(e,n){return t.call(this,e,addSpecNameToParams(e,n))}};for(var _8=0,_9=["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"];_8<_9.length;_8++){var method_4=_9[_8];_loop_1(method_4)}function addSpecNameToParams(e,t){var n;return e.name?__assign(__assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function normalize(e,t){if(t===undefined){t=initConfig(e.config)}var n=normalizeGenericSpec(e,t);var r=e.width,i=e.height;var a=normalizeAutoSize(n,{width:r,height:i,autosize:e.autosize},t);return __assign(__assign({},n),a?{autosize:a}:{})}var coreNormalizer=new CoreNormalizer;var selectionCompatNormalizer=new SelectionCompatibilityNormalizer;var topLevelSelectionNormalizer=new TopLevelSelectionsNormalizer;function normalizeGenericSpec(e,t){if(t===void 0){t={}}var n={config:t};return topLevelSelectionNormalizer.map(coreNormalizer.map(selectionCompatNormalizer.map(e,n),n),n)}function _normalizeAutoSize(e){return isString(e)?{type:e}:e!==null&&e!==void 0?e:{}}function normalizeAutoSize(e,t,n){var r=t.width,i=t.height;var a=isUnitSpec(e)||isLayerSpec(e);var o={};if(!a){if(r=="container"){warn(containerSizeNonSingle("width"));r=undefined}if(i=="container"){warn(containerSizeNonSingle("height"));i=undefined}}else{if(r=="container"&&i=="container"){o.type="fit";o.contains="padding"}else if(r=="container"){o.type="fit-x";o.contains="padding"}else if(i=="container"){o.type="fit-y";o.contains="padding"}}var s=__assign(__assign(__assign({type:"pad"},o),n?_normalizeAutoSize(n.autosize):{}),_normalizeAutoSize(e.autosize));if(s.type==="fit"&&!a){warn(FIT_NON_SINGLE);s.type="pad"}if(r=="container"&&!(s.type=="fit"||s.type=="fit-x")){warn(containerSizeNotCompatibleWithAutosize("width"))}if(i=="container"&&!(s.type=="fit"||s.type=="fit-y")){warn(containerSizeNotCompatibleWithAutosize("height"))}if(deepEqual(s,{type:"pad"})){return undefined}return s}function isFitType(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function getFitType(e){return e?"fit-"+getPositionScaleChannel(e):"fit"}var TOP_LEVEL_PROPERTIES=["background","padding"];function extractTopLevelProperties(e,t){var n={};for(var r=0,i=TOP_LEVEL_PROPERTIES;r<i.length;r++){var a=i[r];if(e&&e[a]!==undefined){n[a]=signalRefOrValue(e[a])}}if(t){n.params=e.params}return n}var Split=function(){function e(e,t){if(e===void 0){e={}}if(t===void 0){t={}}this.explicit=e;this.implicit=t}e.prototype.clone=function(){return new e(duplicate(this.explicit),duplicate(this.implicit))};e.prototype.combine=function(){return __assign(__assign({},this.explicit),this.implicit)};e.prototype.get=function(e){return getFirstDefined(this.explicit[e],this.implicit[e])};e.prototype.getWithExplicit=function(e){if(this.explicit[e]!==undefined){return{explicit:true,value:this.explicit[e]}}else if(this.implicit[e]!==undefined){return{explicit:false,value:this.implicit[e]}}return{explicit:false,value:undefined}};e.prototype.setWithExplicit=function(e,t){var n=t.value,r=t.explicit;if(n!==undefined){this.set(e,n,r)}};e.prototype.set=function(e,t,n){delete this[n?"implicit":"explicit"][e];this[n?"explicit":"implicit"][e]=t;return this};e.prototype.copyKeyFromSplit=function(e,t){var n=t.explicit,r=t.implicit;if(n[e]!==undefined){this.set(e,n[e],true)}else if(r[e]!==undefined){this.set(e,r[e],false)}};e.prototype.copyKeyFromObject=function(e,t){if(t[e]!==undefined){this.set(e,t[e],true)}};e.prototype.copyAll=function(e){for(var t=0,n=keys$1(e.combine());t<n.length;t++){var r=n[t];var i=e.getWithExplicit(r);this.setWithExplicit(r,i)}};return e}();function makeExplicit(e){return{explicit:true,value:e}}function makeImplicit(e){return{explicit:false,value:e}}function tieBreakByComparing(e){return function(t,n,r,i){var a=e(t.value,n.value);if(a>0){return t}else if(a<0){return n}return defaultTieBreaker(t,n,r,i)}}function defaultTieBreaker(e,t,n,r){if(e.explicit&&t.explicit){warn(mergeConflictingProperty(n,r,e.value,t.value))}return e}function mergeValuesWithExplicit(e,t,n,r,i){if(i===void 0){i=defaultTieBreaker}if(e===undefined||e.value===undefined){return t}if(e.explicit&&!t.explicit){return e}else if(t.explicit&&!e.explicit){return t}else if(deepEqual(e.value,t.value)){return e}else{return i(e,t,n,r)}}var AncestorParse=function(e){__extends(t,e);function t(t,n,r){if(t===void 0){t={}}if(n===void 0){n={}}if(r===void 0){r=false}var i=e.call(this,t,n)||this;i.explicit=t;i.implicit=n;i.parseNothing=r;return i}t.prototype.clone=function(){var t=e.prototype.clone.call(this);t.parseNothing=this.parseNothing;return t};return t}(Split);function isUrlData(e){return"url"in e}function isInlineData(e){return"values"in e}function isNamedData(e){return"name"in e&&!isUrlData(e)&&!isInlineData(e)&&!isGenerator(e)}function isGenerator(e){return e&&(isSequenceGenerator(e)||isSphereGenerator(e)||isGraticuleGenerator(e))}function isSequenceGenerator(e){return"sequence"in e}function isSphereGenerator(e){return"sphere"in e}function isGraticuleGenerator(e){return"graticule"in e}var DataSourceType;(function(e){e[e["Raw"]=0]="Raw";e[e["Main"]=1]="Main";e[e["Row"]=2]="Row";e[e["Column"]=3]="Column";e[e["Lookup"]=4]="Lookup"})(DataSourceType||(DataSourceType={}));function assembleInit(e,t,n){if(t===void 0){t=true}if(n===void 0){n=identity$6}if(isArray(e)){var r=e.map((function(e){return assembleInit(e,t,n)}));return t?"["+r.join(", ")+"]":r}else if(isDateTime(e)){if(t){return n(dateTimeToExpr(e))}else{return n(dateTimeToTimestamp(e))}}return t?n(stringify$1(e)):e}function assembleUnitSelectionSignals(e,t){var n;for(var r=0,i=vals((n=e.component.selection)!==null&&n!==void 0?n:{});r<i.length;r++){var a=i[r];var o=a.name;var s=""+o+TUPLE+", "+(a.resolve==="global"?"true":"{unit: "+unitName(e)+"}");for(var u=0,l=selectionCompilers;u<l.length;u++){var f=l[u];if(!f.defined(a))continue;if(f.signals)t=f.signals(e,a,t);if(f.modifyExpr)s=f.modifyExpr(e,a,s)}t.push({name:o+MODIFY,on:[{events:{signal:a.name+TUPLE},update:"modify("+$$1(a.name+STORE)+", "+s+")"}]})}return cleanupEmptyOnArray(t)}function assembleFacetSignals(e,t){if(e.component.selection&&keys$1(e.component.selection).length){var n=$$1(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:eventSelector("mousemove","scope"),update:"isTuple(facet) ? facet : group("+n+").datum"}]})}return cleanupEmptyOnArray(t)}function assembleTopLevelSignals(e,t){var n;var r=false;var i=function(n){var i=n.name;var a=$$1(i+STORE);var o=t.filter((function(e){return e.name===i}));if(o.length===0){var s=n.resolve==="global"?"union":n.resolve;var u=n.type==="point"?", true, true)":")";t.push({name:n.name,update:VL_SELECTION_RESOLVE+"("+a+", "+$$1(s)+u})}r=true;for(var l=0,f=selectionCompilers;l<f.length;l++){var c=f[l];if(c.defined(n)&&c.topLevelSignals){t=c.topLevelSignals(e,n,t)}}};for(var a=0,o=vals((n=e.component.selection)!==null&&n!==void 0?n:{});a<o.length;a++){var s=o[a];i(s)}if(r){var u=t.filter((function(e){return e.name==="unit"}));if(u.length===0){t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}}return cleanupEmptyOnArray(t)}function assembleUnitSelectionData(e,t){var n;var r=__spreadArray([],t);var i=function(t){var n={name:t.name+STORE};if(t.init){var i=t.project.items.map((function(e){var t=e.signals,n=__rest(e,["signals"]);return n}));n.values=t.init.map((function(t){return{unit:unitName(e,{escape:false}),fields:i,values:assembleInit(t,false)}}))}var a=r.filter((function(e){return e.name===t.name+STORE}));if(!a.length){r.push(n)}};for(var a=0,o=vals((n=e.component.selection)!==null&&n!==void 0?n:{});a<o.length;a++){var s=o[a];i(s)}return r}function assembleUnitSelectionMarks(e,t){var n;for(var r=0,i=vals((n=e.component.selection)!==null&&n!==void 0?n:{});r<i.length;r++){var a=i[r];for(var o=0,s=selectionCompilers;o<s.length;o++){var u=s[o];if(u.defined(a)&&u.marks){t=u.marks(e,a,t)}}}return t}function assembleLayerSelectionMarks(e,t){for(var n=0,r=e.children;n<r.length;n++){var i=r[n];if(isUnitModel(i)){t=assembleUnitSelectionMarks(i,t)}}return t}function assembleSelectionScaleDomain(e,t,n,r){var i=parseSelectionExtent(e,t.param,t);return{signal:hasContinuousDomain(n.get("type"))&&isArray(r)&&r[0]>r[1]?"isValid("+i+") && reverse("+i+")":i}}function cleanupEmptyOnArray(e){return e.map((function(e){if(e.on&&!e.on.length)delete e.on;return e}))}var DataFlowNode=function(){function e(e,t){this.debugName=t;this._children=[];this._parent=null;if(e){this.parent=e}}e.prototype.clone=function(){throw new Error("Cannot clone node")};Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e;if(e){e.addChild(this)}},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:false,configurable:true});e.prototype.numChildren=function(){return this._children.length};e.prototype.addChild=function(e,t){if(this._children.includes(e)){warn(ADD_SAME_CHILD_TWICE);return}if(t!==undefined){this._children.splice(t,0,e)}else{this._children.push(e)}};e.prototype.removeChild=function(e){var t=this._children.indexOf(e);this._children.splice(t,1);return t};e.prototype.remove=function(){var e=this._parent.removeChild(this);for(var t=0,n=this._children;t<n.length;t++){var r=n[t];r._parent=this._parent;this._parent.addChild(r,e++)}};e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this);this.parent=t;e.parent=this};e.prototype.swapWithParent=function(){var e=this._parent;var t=e.parent;for(var n=0,r=this._children;n<r.length;n++){var i=r[n];i.parent=e}this._children=[];e.removeChild(this);e.parent.removeChild(e);this.parent=t;e.parent=this};return e}();var OutputNode=function(e){__extends(t,e);function t(t,n,r,i){var a=e.call(this,t,n)||this;a.type=r;a.refCounts=i;a._source=a._name=n;if(a.refCounts&&!(a._name in a.refCounts)){a.refCounts[a._name]=0}return a}t.prototype.clone=function(){var e=new this.constructor;e.debugName="clone_"+this.debugName;e._source=this._source;e._name="clone_"+this._name;e.type=this.type;e.refCounts=this.refCounts;e.refCounts[e._name]=0;return e};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return new Set};t.prototype.hash=function(){if(this._hash===undefined){this._hash="Output "+uniqueId()}return this._hash};t.prototype.getSource=function(){this.refCounts[this._name]++;return this._source};t.prototype.isRequired=function(){return!!this.refCounts[this._name]};t.prototype.setSource=function(e){this._source=e};return t}(DataFlowNode);var TimeUnitNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.formula=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this.formula))};t.makeFromEncoding=function(e,n){var r=n.reduceFieldDef((function(e,t){var n=t.field,r=t.timeUnit;if(r){var i=vgField(t,{forAs:true});e[hash({as:i,field:n,timeUnit:r})]={as:i,field:n,timeUnit:r}}return e}),{});if(isEmpty(r)){return null}return new t(e,r)};t.makeFromTransform=function(e,n){var r;var i=__assign({},n),a=i.timeUnit,o=__rest(i,["timeUnit"]);var s=normalizeTimeUnit(a);var u=__assign(__assign({},o),{timeUnit:s});return new t(e,(r={},r[hash(u)]=u,r))};t.prototype.merge=function(e){this.formula=__assign({},this.formula);for(var t in e.formula){if(!this.formula[t]){this.formula[t]=e.formula[t]}}for(var n=0,r=e.children;n<r.length;n++){var i=r[n];e.removeChild(i);i.parent=this}e.remove()};t.prototype.removeFormulas=function(e){var t={};for(var n=0,r=entries$1(this.formula);n<r.length;n++){var i=r[n],a=i[0],o=i[1];if(!e.has(o.as)){t[a]=o}}this.formula=t};t.prototype.producedFields=function(){return new Set(vals(this.formula).map((function(e){return e.as})))};t.prototype.dependentFields=function(){return new Set(vals(this.formula).map((function(e){return e.field})))};t.prototype.hash=function(){return"TimeUnit "+hash(this.formula)};t.prototype.assemble=function(){var e=[];for(var t=0,n=vals(this.formula);t<n.length;t++){var r=n[t];var i=r.field,a=r.as,o=r.timeUnit;var s=normalizeTimeUnit(o),u=s.unit,l=s.utc,f=__rest(s,["unit","utc"]);e.push(__assign(__assign(__assign(__assign({field:replacePathInField(i),type:"timeunit"},u?{units:getTimeUnitParts(u)}:{}),l?{timezone:"utc"}:{}),f),{as:[a,a+"_end"]}))}return e};return t}(DataFlowNode);var TUPLE_FIELDS="_tuple_fields";var SelectionProjectionComponent=function(){function e(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this.items=e;this.hasChannel={};this.hasField={}}return e}();var project={defined:function(){return true},parse:function(e,t,n){var r;var i=t.name;var a=(r=t.project)!==null&&r!==void 0?r:t.project=new SelectionProjectionComponent;var o={};var s={};var u=new Set;var l=function(e,t){var n;var r=t==="visual"?e.channel:e.field;var a=varName(i+"_"+r);for(var o=1;u.has(a);o++){a=varName(i+"_"+r+"_"+o)}u.add(a);return n={},n[t]=a,n};var f=t.type;var c=e.config.selection[f];var d=n.value!==undefined?array$5(n.value):null;var p=isObject(n.select)?n.select:{},h=p.fields,g=p.encodings;if(!h&&!g&&d){for(var m=0,v=d;m<v.length;m++){var y=v[m];if(!isObject(y)){continue}for(var _=0,b=keys$1(y);_<b.length;_++){var x=b[_];if(isSingleDefUnitChannel(x)){(g||(g=[])).push(x)}else{if(f==="interval"){warn(INTERVAL_INITIALIZED_WITH_X_Y);g=c.encodings}else{(h||(h=[])).push(x)}}}}}if(!h&&!g){g=c.encodings;h=c.fields}for(var E=0,S=g!==null&&g!==void 0?g:[];E<S.length;E++){var $=S[E];var A=e.fieldDef($);if(A){var D=A.field;if(A.aggregate){warn(cannotProjectAggregate($,A.aggregate));continue}else if(!D){warn(cannotProjectOnChannelWithoutField($));continue}if(A.timeUnit){D=e.vgField($);var w={timeUnit:A.timeUnit,as:D,field:A.field};s[hash(w)]=w}if(!o[D]){var C="E";if(f==="interval"){var T=e.getScaleComponent($).get("type");if(hasContinuousDomain(T)){C="R"}}else if(A.bin){C="R-RE"}var k={field:D,channel:$,type:C};k.signals=__assign(__assign({},l(k,"data")),l(k,"visual"));a.items.push(o[D]=k);a.hasField[D]=a.hasChannel[$]=o[D]}}else{warn(cannotProjectOnChannelWithoutField($))}}for(var O=0,N=h!==null&&h!==void 0?h:[];O<N.length;O++){var R=N[O];if(a.hasField[R])continue;var k={type:"E",field:R};k.signals=__assign({},l(k,"data"));a.items.push(k);a.hasField[R]=k}if(d){t.init=d.map((function(e){return a.items.map((function(t){return isObject(e)?e[t.channel]!==undefined?e[t.channel]:e[t.field]:e}))}))}if(!isEmpty(s)){a.timeUnit=new TimeUnitNode(null,s)}},signals:function(e,t,n){var r=t.name+TUPLE_FIELDS;var i=n.filter((function(e){return e.name===r}));return i.length>0?n:n.concat({name:r,value:t.project.items.map((function(e){var t=e.signals,n=e.hasLegend,r=__rest(e,["signals","hasLegend"]);r.field=replacePathInField(r.field);return r}))})}};var scaleBindings={defined:function(e){return e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales"},parse:function(e,t){var n=t.scales=[];for(var r=0,i=t.project.items;r<i.length;r++){var a=i[r];var o=a.channel;if(!isScaleChannel(o)){continue}var s=e.getScaleComponent(o);var u=s?s.get("type"):undefined;if(!s||!hasContinuousDomain(u)){warn(SCALE_BINDINGS_CONTINUOUS);continue}s.set("selectionExtent",{param:t.name,field:a.field},true);n.push(a)}},topLevelSignals:function(e,t,n){var r=t.scales.filter((function(e){return n.filter((function(t){return t.name===e.signals.data})).length===0}));if(!e.parent||isTopLevelLayer(e)||r.length===0){return n}var i=n.filter((function(e){return e.name===t.name}))[0];var a=i.update;if(a.indexOf(VL_SELECTION_RESOLVE)>=0){i.update="{"+r.map((function(e){return $$1(replacePathInField(e.field))+": "+e.signals.data})).join(", ")+"}"}else{for(var o=0,s=r;o<s.length;o++){var u=s[o];var l=$$1(replacePathInField(u.field))+": "+u.signals.data;if(!a.includes(l)){a=a.substring(0,a.length-1)+", "+l+"}"}}i.update=a}return n.concat(r.map((function(e){return{name:e.signals.data}})))},signals:function(e,t,n){if(e.parent&&!isTopLevelLayer(e)){var r=function(e){var t=n.filter((function(t){return t.name===e.signals.data}))[0];t.push="outer";delete t.value;delete t.update};for(var i=0,a=t.scales;i<a.length;i++){var o=a[i];r(o)}}return n}};function domain(e,t){var n=$$1(e.scaleName(t));return"domain("+n+")"}function isTopLevelLayer(e){var t;return e.parent&&isLayerModel(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:isTopLevelLayer(e.parent.parent))}var BRUSH="_brush";var SCALE_TRIGGER="_scale_trigger";var interval={defined:function(e){return e.type==="interval"},signals:function(e,t,n){var r=t.name;var i=r+TUPLE_FIELDS;var a=scaleBindings.defined(t);var o=t.init?t.init[0]:null;var s=[];var u=[];if(t.translate&&!a){var l="!event.item || event.item.mark.name !== "+$$1(r+BRUSH);events(t,(function(e,t){var n;var r;var i=array$5((n=(r=t.between[0]).filter)!==null&&n!==void 0?n:r.filter=[]);if(!i.includes(l)){i.push(l)}return e}))}t.project.items.forEach((function(r,i){var a=r.channel;if(a!==X&&a!==Y){warn("Interval selections only support x and y encoding channels.");return}var l=o?o[i]:null;var f=channelSignals(e,t,r,l);var c=r.signals.data;var d=r.signals.visual;var p=$$1(e.scaleName(a));var h=e.getScaleComponent(a).get("type");var g=hasContinuousDomain(h)?"+":"";n.push.apply(n,f);s.push(c);u.push({scaleName:e.scaleName(a),expr:"(!isArray("+c+") || "+("("+g+"invert("+p+", "+d+")[0] === "+g+c+"[0] && ")+(g+"invert("+p+", "+d+")[1] === "+g+c+"[1]))")})}));if(!a){n.push({name:r+SCALE_TRIGGER,value:{},on:[{events:u.map((function(e){return{scale:e.scaleName}})),update:u.map((function(e){return e.expr})).join(" && ")+" ? "+(r+SCALE_TRIGGER)+" : {}"}]})}var f="unit: "+unitName(e)+", fields: "+i+", values";return n.concat(__assign(__assign({name:r+TUPLE},o?{init:"{"+f+": "+assembleInit(o)+"}"}:{}),{on:[{events:[{signal:s.join(" || ")}],update:s.join(" && ")+" ? {"+f+": ["+s+"]} : null"}]}))},marks:function(e,t,n){var r=t.name;var i=t.project.hasChannel,a=i.x,o=i.y;var s=a&&a.signals.visual;var u=o&&o.signals.visual;var l="data("+$$1(t.name+STORE)+")";if(scaleBindings.defined(t)){return n}var f={x:a!==undefined?{signal:s+"[0]"}:{value:0},y:o!==undefined?{signal:u+"[0]"}:{value:0},x2:a!==undefined?{signal:s+"[1]"}:{field:{group:"width"}},y2:o!==undefined?{signal:u+"[1]"}:{field:{group:"height"}}};if(t.resolve==="global"){for(var c=0,d=keys$1(f);c<d.length;c++){var p=d[c];f[p]=[__assign({test:l+".length && "+l+"[0].unit === "+unitName(e)},f[p]),{value:0}]}}var h=t.mark,g=h.fill,m=h.fillOpacity,v=h.cursor,y=__rest(h,["fill","fillOpacity","cursor"]);var _=keys$1(y).reduce((function(e,t){e[t]=[{test:[a!==undefined&&s+"[0] !== "+s+"[1]",o!==undefined&&u+"[0] !== "+u+"[1]"].filter((function(e){return e})).join(" && "),value:y[t]},{value:null}];return e}),{});return __spreadArray(__spreadArray([{name:r+BRUSH+"_bg",type:"rect",clip:true,encode:{enter:{fill:{value:g},fillOpacity:{value:m}},update:f}}],n),[{name:r+BRUSH,type:"rect",clip:true,encode:{enter:__assign(__assign({},v?{cursor:{value:v}}:{}),{fill:{value:"transparent"}}),update:__assign(__assign({},f),_)}}])}};function channelSignals(e,t,n,r){var i=n.channel;var a=n.signals.visual;var o=n.signals.data;var s=scaleBindings.defined(t);var u=$$1(e.scaleName(i));var l=e.getScaleComponent(i);var f=l?l.get("type"):undefined;var c=function(e){return"scale("+u+", "+e+")"};var d=e.getSizeSignalRef(i===X?"width":"height").signal;var p=i+"(unit)";var h=events(t,(function(e,t){return __spreadArray(__spreadArray([],e),[{events:t.between[0],update:"["+p+", "+p+"]"},{events:t,update:"["+a+"[0], clamp("+p+", 0, "+d+")]"}])}));h.push({events:{signal:t.name+SCALE_TRIGGER},update:hasContinuousDomain(f)?"["+c(o+"[0]")+", "+c(o+"[1]")+"]":"[0, 0]"});return s?[{name:o,on:[]}]:[__assign(__assign({name:a},r?{init:assembleInit(r,true,c)}:{value:[]}),{on:h}),__assign(__assign({name:o},r?{init:assembleInit(r)}:{}),{on:[{events:{signal:a},update:a+"[0] === "+a+"[1] ? null : invert("+u+", "+a+")"}]})]}function events(e,t){return e.events.reduce((function(e,n){if(!n.between){warn(n+" is not an ordered event stream for interval selections.");return e}return t(e,n)}),[])}var point$1={defined:function(e){return e.type==="point"},signals:function(e,t,n){var r=t.name;var i=r+TUPLE_FIELDS;var a=t.project;var o="(item().isVoronoi ? datum.datum : datum)";var s=a.items.map((function(t){var n=e.fieldDef(t.channel);return n&&n.bin?"["+o+"["+$$1(e.vgField(t.channel,{}))+"], "+(o+"["+$$1(e.vgField(t.channel,{binSuffix:"end"}))+"]]"):o+"["+$$1(t.field)+"]"})).join(", ");var u="unit: "+unitName(e)+", fields: "+i+", values";var l=t.events;return n.concat([{name:r+TUPLE,on:l?[{events:l,update:"datum && item().mark.marktype !== 'group' ? {"+u+": ["+s+"]} : null",force:true}]:[]}])}};function wrapCondition(e,t,n,r){var i,a;var o=isConditionalDef(t)&&t.condition;var s=r(t);if(o){var u=array$5(o);var l=u.map((function(t){var n=r(t);if(isConditionalParameter(t)){var i=t.param,a=t.empty;var o=parseSelectionPredicate(e,{param:i,empty:a});return __assign({test:o},n)}else{var s=expression(e,t.test);return __assign({test:s},n)}}));return i={},i[n]=__spreadArray(__spreadArray([],l),s!==undefined?[s]:[]),i}else{return s!==undefined?(a={},a[n]=s,a):{}}}function text$1(e,t){if(t===void 0){t="text"}var n=e.encoding[t];return wrapCondition(e,n,t,(function(t){return textRef(t,e.config)}))}function textRef(e,t,n){if(n===void 0){n="datum"}if(e){if(isValueDef(e)){return signalOrValueRef(e.value)}if(isFieldOrDatumDef(e)){var r=getFormatMixins(e),i=r.format,a=r.formatType;return formatSignalRef({fieldOrDatumDef:e,format:i,formatType:a,expr:n,config:t})}}return undefined}function tooltip(e,t){if(t===void 0){t={}}var n=e.encoding,r=e.markDef,i=e.config,a=e.stack;var o=n.tooltip;if(isArray(o)){return{tooltip:tooltipRefForEncoding({tooltip:o},a,i,t)}}else{var s=t.reactiveGeom?"datum.datum":"datum";return wrapCondition(e,o,"tooltip",(function(e){var o=textRef(e,i,s);if(o){return o}if(e===null){return undefined}var u=getMarkPropOrConfig("tooltip",r,i);if(u===true){u={content:"encoding"}}if(isString(u)){return{value:u}}else if(isObject(u)){if(isSignalRef(u)){return u}else if(u.content==="encoding"){return tooltipRefForEncoding(n,a,i,t)}else{return{signal:s}}}return undefined}))}}function tooltipData(e,t,n,r){var i=r===void 0?{}:r,a=i.reactiveGeom;var o={};var s=a?"datum.datum":"datum";var u=[];function l(r,i){var a=getMainRangeChannel(i);var l=isTypedFieldDef(r)?r:__assign(__assign({},r),{type:e[a].type});var f=l.title||defaultTitle(l,n);var c=array$5(f).join(", ");var d;if(isXorY(i)){var p=i==="x"?"x2":"y2";var h=getFieldDef(e[p]);if(isBinned(l.bin)&&h){var g=vgField(l,{expr:s});var m=vgField(h,{expr:s});var v=getFormatMixins(l),y=v.format,_=v.formatType;d=binFormatExpression(g,m,y,_,n);o[p]=true}else if(t&&t.fieldChannel===i&&t.offset==="normalize"){var b=getFormatMixins(l),x=b.format,_=b.formatType;d=formatSignalRef({fieldOrDatumDef:l,format:x,formatType:_,expr:s,config:n,normalizeStack:true}).signal}}d!==null&&d!==void 0?d:d=textRef(l,n,s).signal;u.push({channel:i,key:c,value:d})}forEach(e,(function(e,t){if(isFieldDef(e)){l(e,t)}else if(hasConditionalFieldDef(e)){l(e.condition,t)}}));var f={};for(var c=0,d=u;c<d.length;c++){var p=d[c],h=p.channel,g=p.key,m=p.value;if(!o[h]&&!f[g]){f[g]=m}}return f}function tooltipRefForEncoding(e,t,n,r){var i=r===void 0?{}:r,a=i.reactiveGeom;var o=tooltipData(e,t,n,{reactiveGeom:a});var s=entries$1(o).map((function(e){var t=e[0],n=e[1];return'"'+t+'": '+n}));return s.length>0?{signal:"{"+s.join(", ")+"}"}:undefined}function aria(e){var t=e.markDef,n=e.config;var r=getMarkPropOrConfig("aria",t,n);if(r===false){return{}}return __assign(__assign(__assign({},r?{aria:r}:{}),ariaRoleDescription(e)),description$1(e))}function ariaRoleDescription(e){var t=e.mark,n=e.markDef,r=e.config;if(r.aria===false){return{}}var i=getMarkPropOrConfig("ariaRoleDescription",n,r);if(i!=null){return{ariaRoleDescription:{value:i}}}return t in VG_MARK_INDEX?{}:{ariaRoleDescription:{value:t}}}function description$1(e){var t=e.encoding,n=e.markDef,r=e.config,i=e.stack;var a=t.description;if(a){return wrapCondition(e,a,"description",(function(t){return textRef(t,e.config)}))}var o=getMarkPropOrConfig("description",n,r);if(o!=null){return{description:signalOrValueRef(o)}}if(r.aria===false){return{}}var s=tooltipData(t,i,r);if(isEmpty(s)){return undefined}return{description:{signal:entries$1(s).map((function(e,t){var n=e[0],r=e[1];return'"'+(t>0?"; ":"")+n+': " + ('+r+")"})).join(" + ")}}}function nonPosition(e,t,n){if(n===void 0){n={}}var r=t.markDef,i=t.encoding,a=t.config;var o=n.vgChannel;var s=n.defaultRef,u=n.defaultValue;if(s===undefined){u!==null&&u!==void 0?u:u=getMarkPropOrConfig(e,r,a,{vgChannel:o,ignoreVgConfig:true});if(u!==undefined){s=signalOrValueRef(u)}}var l=i[e];return wrapCondition(t,l,o!==null&&o!==void 0?o:e,(function(n){return midPoint({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s})}))}function color(e,t){var n,r,i,a;if(t===void 0){t={filled:undefined}}var o=e.markDef,s=e.encoding,u=e.config;var l=o.type;var f=(n=t.filled)!==null&&n!==void 0?n:getMarkPropOrConfig("filled",o,u);var c=contains(["bar","point","circle","square","geoshape"],l)?"transparent":undefined;var d=(i=(r=getMarkPropOrConfig(f===true?"color":undefined,o,u,{vgChannel:"fill"}))!==null&&r!==void 0?r:u.mark[f===true&&"color"])!==null&&i!==void 0?i:c;var p=(a=getMarkPropOrConfig(f===false?"color":undefined,o,u,{vgChannel:"stroke"}))!==null&&a!==void 0?a:u.mark[f===false&&"color"];var h=f?"fill":"stroke";var g=__assign(__assign({},d?{fill:signalOrValueRef(d)}:{}),p?{stroke:signalOrValueRef(p)}:{});if(o.color&&(f?o.fill:o.stroke)){warn(droppingColor("property",{fill:"fill"in o,stroke:"stroke"in o}))}return __assign(__assign(__assign(__assign({},g),nonPosition("color",e,{vgChannel:h,defaultValue:f?d:p})),nonPosition("fill",e,{defaultValue:s.fill?d:undefined})),nonPosition("stroke",e,{defaultValue:s.stroke?p:undefined}))}function zindex(e){var t=e.encoding,n=e.mark;var r=t.order;if(!isPathMark(n)&&isValueDef(r)){return wrapCondition(e,r,"zindex",(function(e){return signalOrValueRef(e.value)}))}return{}}function getOffset(e,t){var n=getOffsetChannel(e);var r=t[n];if(r){return r}return undefined}function pointPosition(e,t,n){var r;var i=n.defaultPos,a=n.vgChannel;var o=t.encoding,s=t.markDef,u=t.config,l=t.stack;var f=o[e];var c=o[getSecondaryRangeChannel(e)];var d=t.scaleName(e);var p=t.getScaleComponent(e);var h=getOffset(e,s);var g=pointPositionDefaultRef({model:t,defaultPos:i,channel:e,scaleName:d,scale:p});var m=!f&&isXorY(e)&&(o.latitude||o.longitude)?{field:t.getName(e)}:positionRef({channel:e,channelDef:f,channel2Def:c,markDef:s,config:u,scaleName:d,scale:p,stack:l,offset:h,defaultRef:g});return m?(r={},r[a||e]=m,r):undefined}function positionRef(e){var t=e.channel,n=e.channelDef,r=e.scaleName,i=e.stack,a=e.offset,o=e.markDef;if(isFieldOrDatumDef(n)&&i&&t===i.fieldChannel){if(isFieldDef(n)){var s=n.bandPosition;if(s===undefined&&o.type==="text"&&(t==="radius"||t==="theta")){s=.5}if(s!==undefined){return interpolatedSignalRef({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",bandPosition:s,offset:a})}}return valueRefForFieldOrDatumDef(n,r,{suffix:"end"},{offset:a})}return midPointRefWithPositionInvalidTest(e)}function pointPositionDefaultRef(e){var t=e.model,n=e.defaultPos,r=e.channel,i=e.scaleName,a=e.scale;var o=t.markDef,s=t.config;return function(){var e=getMainRangeChannel(r);var u=getVgPositionChannel(r);var l=getMarkPropOrConfig(r,o,s,{vgChannel:u});if(l!==undefined){return widthHeightValueOrSignalRef(r,l)}switch(n){case"zeroOrMin":case"zeroOrMax":if(i){var f=a.get("type");if(contains([ScaleType.LOG,ScaleType.TIME,ScaleType.UTC],f));else{if(a.domainDefinitelyIncludesZero()){return{scale:i,value:0}}}}if(n==="zeroOrMin"){return e==="y"?{field:{group:"height"}}:{value:0}}else{switch(e){case"radius":return{signal:"min("+t.width.signal+","+t.height.signal+")/2"};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}}break;case"mid":{var c=t[getSizeChannel$1(r)];return __assign(__assign({},c),{mult:.5})}}return undefined}}var ALIGNED_X_CHANNEL={left:"x",center:"xc",right:"x2"};var BASELINED_Y_CHANNEL={top:"y",middle:"yc",bottom:"y2"};function vgAlignedPositionChannel(e,t,n,r){if(r===void 0){r="middle"}if(e==="radius"||e==="theta"){return getVgPositionChannel(e)}var i=e==="x"?"align":"baseline";var a=getMarkPropOrConfig(i,t,n);var o;if(isSignalRef(a)){warn(rangeMarkAlignmentCannotBeExpression(i));o=undefined}else{o=a}if(e==="x"){return ALIGNED_X_CHANNEL[o||(r==="top"?"left":"center")]}else{return BASELINED_Y_CHANNEL[o||r]}}function pointOrRangePosition(e,t,n){var r=n.defaultPos,i=n.defaultPos2,a=n.range;if(a){return rangePosition(e,t,{defaultPos:r,defaultPos2:i})}return pointPosition(e,t,{defaultPos:r})}function rangePosition(e,t,n){var r=n.defaultPos,i=n.defaultPos2;var a=t.markDef,o=t.config;var s=getSecondaryRangeChannel(e);var u=getSizeChannel$1(e);var l=pointPosition2OrSize(t,i,s);var f=l[u]?vgAlignedPositionChannel(e,a,o):getVgPositionChannel(e);return __assign(__assign({},pointPosition(e,t,{defaultPos:r,vgChannel:f})),l)}function pointPosition2OrSize(e,t,n){var r,i,a,o,s;var u=e.encoding,l=e.mark,f=e.markDef,c=e.stack,d=e.config;var p=getMainRangeChannel(n);var h=getSizeChannel$1(n);var g=getVgPositionChannel(n);var m=u[p];var v=e.scaleName(p);var y=e.getScaleComponent(p);var _=n in u||n in f?getOffset(n,e.markDef):getOffset(p,e.markDef);if(!m&&(n==="x2"||n==="y2")&&(u.latitude||u.longitude)){var b=getSizeChannel$1(n);var x=e.markDef[b];if(x!=null){return r={},r[b]={value:x},r}else{return i={},i[g]={field:e.getName(n)},i}}var E=position2Ref({channel:n,channelDef:m,channel2Def:u[n],markDef:f,config:d,scaleName:v,scale:y,stack:c,offset:_,defaultRef:undefined});if(E!==undefined){return a={},a[g]=E,a}return position2orSize(n,f)||position2orSize(n,(o={},o[n]=getMarkStyleConfig(n,f,d.style),o[h]=getMarkStyleConfig(h,f,d.style),o))||position2orSize(n,d[l])||position2orSize(n,d.mark)||(s={},s[g]=pointPositionDefaultRef({model:e,defaultPos:t,channel:n,scaleName:v,scale:y})(),s)}function position2Ref(e){var t=e.channel,n=e.channelDef,r=e.channel2Def,i=e.markDef,a=e.config,o=e.scaleName,s=e.scale,u=e.stack,l=e.offset,f=e.defaultRef;if(isFieldOrDatumDef(n)&&u&&t.charAt(0)===u.fieldChannel.charAt(0)){return valueRefForFieldOrDatumDef(n,o,{suffix:"start"},{offset:l})}return midPointRefWithPositionInvalidTest({channel:t,channelDef:r,scaleName:o,scale:s,stack:u,markDef:i,config:a,offset:l,defaultRef:f})}function position2orSize(e,t){var n,r,i;var a=getSizeChannel$1(e);var o=getVgPositionChannel(e);if(t[o]!==undefined){return n={},n[o]=widthHeightValueOrSignalRef(e,t[o]),n}else if(t[e]!==undefined){return r={},r[o]=widthHeightValueOrSignalRef(e,t[e]),r}else if(t[a]){var s=t[a];if(isRelativeBandSize(s)){warn(relativeBandSizeNotSupported(a))}else{return i={},i[a]=widthHeightValueOrSignalRef(e,s),i}}return undefined}function rectPosition(e,t,n){var r,i,a,o;var s=e.config,u=e.encoding,l=e.markDef;var f=getSecondaryRangeChannel(t);var c=getSizeChannel$1(t);var d=u[t];var p=u[f];var h=e.getScaleComponent(t);var g=h?h.get("type"):undefined;var m=e.scaleName(t);var v=l.orient;var y=(i=(r=u[c])!==null&&r!==void 0?r:u.size)!==null&&i!==void 0?i:getMarkPropOrConfig("size",l,s,{vgChannel:c});var _=n==="bar"&&(t==="x"?v==="vertical":v==="horizontal");if(isFieldDef(d)&&(isBinning(d.bin)||isBinned(d.bin)||d.timeUnit&&!p)&&!(y&&!isRelativeBandSize(y))&&!hasDiscreteDomain(g)){var b=getBandSize({channel:t,fieldDef:d,markDef:l,config:s,scaleType:g});var x=(a=e.component.axes[t])===null||a===void 0?void 0:a[0];var E=(o=x===null||x===void 0?void 0:x.get("translate"))!==null&&o!==void 0?o:.5;return rectBinPosition({fieldDef:d,fieldDef2:p,channel:t,markDef:l,scaleName:m,bandSize:b,axisTranslate:E,spacing:isXorY(t)?getMarkPropOrConfig("binSpacing",l,s):undefined,reverse:h.get("reverse"),config:s})}else if((isFieldOrDatumDef(d)&&hasDiscreteDomain(g)||_)&&!p){return positionAndSize(d,t,e)}else{return rangePosition(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}}function defaultSizeRef(e,t,n,r,i){if(isRelativeBandSize(i)){if(n){var a=n.get("type");if(a==="band"){return{scale:t,band:i.band}}else if(i.band!==1){warn(cannotUseRelativeBandSizeWithNonBandScale(a));i=undefined}}else{return{mult:i.band,field:{group:e}}}}else if(isSignalRef(i)){return i}else if(i){return{value:i}}if(n){var o=n.get("range");if(isVgRangeStep(o)&&isNumber$1(o.step)){return{value:o.step-2}}}var s=getViewConfigDiscreteStep(r.view,e);return{value:s-2}}function positionAndSize(e,t,n){var r,i,a;var o=n.markDef,s=n.encoding,u=n.config,l=n.stack;var f=o.orient;var c=n.scaleName(t);var d=n.getScaleComponent(t);var p=getSizeChannel$1(t);var h=getSecondaryRangeChannel(t);var g=f==="horizontal"&&t==="y"||f==="vertical"&&t==="x";var m;if(s.size||o.size){if(g){m=nonPosition("size",n,{vgChannel:p,defaultRef:signalOrValueRef(o.size)})}else{warn(cannotApplySizeToNonOrientedMark(o.type))}}var v=getBandSize({channel:t,fieldDef:e,markDef:o,config:u,scaleType:d===null||d===void 0?void 0:d.get("type"),useVlSizeChannel:g});m=m||(r={},r[p]=defaultSizeRef(p,c,d,u,v),r);var y=(d===null||d===void 0?void 0:d.get("type"))!=="band"||!("band"in m[p])?"middle":"top";var _=vgAlignedPositionChannel(t,o,u,y);var b=_==="xc"||_==="yc";var x=getOffset(t,o);var E=midPointRefWithPositionInvalidTest({channel:t,channelDef:e,markDef:o,config:u,scaleName:c,scale:d,stack:l,offset:x,defaultRef:pointPositionDefaultRef({model:n,defaultPos:"mid",channel:t,scaleName:c,scale:d}),bandPosition:b?.5:isSignalRef(v)?{signal:"(1-"+v+")/2"}:isRelativeBandSize(v)?(1-v.band)/2:0});if(p){return __assign((i={},i[_]=E,i),m)}else{var S=getVgPositionChannel(h);var $=m[p];var A=x?__assign(__assign({},$),{offset:x}):$;return a={},a[_]=E,a[S]=isArray(E)?[E[0],__assign(__assign({},E[1]),{offset:A})]:__assign(__assign({},E),{offset:A}),a}}function getBinSpacing(e,t,n,r,i){if(isPolarPositionChannel(e)){return 0}var a=e==="x"||e==="y2"?-t/2:t/2;if(isSignalRef(n)||isSignalRef(i)||isSignalRef(r)){var o=signalOrStringValue(n);var s=signalOrStringValue(i);var u=signalOrStringValue(r);var l=u?u+" + ":"";var f=o?"("+o+" ? -1 : 1) * ":"";var c=s?"("+s+" + "+a+")":a;return{signal:l+f+c}}else{i=i||0;return r+(n?-i-a:+i+a)}}function rectBinPosition(e){var t,n,r;var i=e.fieldDef,a=e.fieldDef2,o=e.channel,s=e.bandSize,u=e.scaleName,l=e.markDef,f=e.spacing,c=f===void 0?0:f,d=e.axisTranslate,p=e.reverse,h=e.config;var g=getSecondaryRangeChannel(o);var m=getVgPositionChannel(o);var v=getVgPositionChannel(g);var y=getOffset(o,l);var _=isSignalRef(s)?{signal:"(1-"+s.signal+")/2"}:isRelativeBandSize(s)?(1-s.band)/2:.5;if(isBinning(i.bin)||i.timeUnit){return t={},t[v]=rectBinRef({channel:o,fieldDef:i,scaleName:u,markDef:l,bandPosition:_,offset:getBinSpacing(g,c,p,d,y),config:h}),t[m]=rectBinRef({channel:o,fieldDef:i,scaleName:u,markDef:l,bandPosition:isSignalRef(_)?{signal:"1-"+_.signal}:1-_,offset:getBinSpacing(o,c,p,d,y),config:h}),t}else if(isBinned(i.bin)){var b=valueRefForFieldOrDatumDef(i,u,{},{offset:getBinSpacing(g,c,p,d,y)});if(isFieldDef(a)){return n={},n[v]=b,n[m]=valueRefForFieldOrDatumDef(a,u,{},{offset:getBinSpacing(o,c,p,d,y)}),n}else if(isBinParams(i.bin)&&i.bin.step){return r={},r[v]=b,r[m]={signal:'scale("'+u+'", '+vgField(i,{expr:"datum"})+" + "+i.bin.step+")",offset:getBinSpacing(o,c,p,d,y)},r}}warn(channelRequiredForBinned(g));return undefined}function rectBinRef(e){var t=e.channel,n=e.fieldDef,r=e.scaleName,i=e.markDef,a=e.bandPosition,o=e.offset,s=e.config;var u=interpolatedSignalRef({scaleName:r,fieldOrDatumDef:n,bandPosition:a,offset:o});return wrapPositionInvalidTest({fieldDef:n,channel:t,markDef:i,ref:u,config:s})}var ALWAYS_IGNORE=new Set(["aria","width","height"]);function baseEncodeEntry(e,t){var n=t.color==="include"?color(e):{},r=n.fill,i=r===void 0?undefined:r,a=n.stroke,o=a===void 0?undefined:a;return __assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign({},markDefProperties(e.markDef,t)),wrapAllFieldsInvalid(e,"fill",i)),wrapAllFieldsInvalid(e,"stroke",o)),nonPosition("opacity",e)),nonPosition("fillOpacity",e)),nonPosition("strokeOpacity",e)),nonPosition("strokeWidth",e)),nonPosition("strokeDash",e)),zindex(e)),tooltip(e)),text$1(e,"href")),aria(e))}function wrapAllFieldsInvalid(e,t,n){var r,i;var a=e.config,o=e.mark,s=e.markDef;var u=getMarkPropOrConfig("invalid",s,a);if(u==="hide"&&n&&!isPathMark(o)){var l=allFieldsInvalidPredicate$1(e,{invalid:true,channels:SCALE_CHANNELS});if(l){return r={},r[t]=__spreadArray([{test:l,value:null}],array$5(n)),r}}return n?(i={},i[t]=n,i):{}}function markDefProperties(e,t){return VG_MARK_CONFIGS.reduce((function(n,r){if(!ALWAYS_IGNORE.has(r)&&e[r]!==undefined&&t[r]!=="ignore"){n[r]=signalOrValueRef(e[r])}return n}),{})}function allFieldsInvalidPredicate$1(e,t){var n=t.invalid,r=n===void 0?false:n,i=t.channels;var a=i.reduce((function(t,n){var r=e.getScaleComponent(n);if(r){var i=r.get("type");var a=e.vgField(n,{expr:"datum"});if(a&&hasContinuousDomain(i)){t[a]=true}}return t}),{});var o=keys$1(a);if(o.length>0){var s=r?"||":"&&";return o.map((function(e){return fieldInvalidPredicate(e,r)})).join(" "+s+" ")}return undefined}function defined(e){var t=e.config,n=e.markDef;var r=getMarkPropOrConfig("invalid",n,t);if(r){var i=allFieldsInvalidPredicate(e,{channels:POSITION_SCALE_CHANNELS});if(i){return{defined:{signal:i}}}}return{}}function allFieldsInvalidPredicate(e,t){var n=t.invalid,r=n===void 0?false:n,i=t.channels;var a=i.reduce((function(t,n){var r=e.getScaleComponent(n);if(r){var i=r.get("type");var a=e.vgField(n,{expr:"datum"});if(a&&hasContinuousDomain(i)){t[a]=true}}return t}),{});var o=keys$1(a);if(o.length>0){var s=r?"||":"&&";return o.map((function(e){return fieldInvalidPredicate(e,r)})).join(" "+s+" ")}return undefined}function valueIfDefined(e,t){var n;if(t!==undefined){return n={},n[e]=signalOrValueRef(t),n}return undefined}var VORONOI="voronoi";var nearest={defined:function(e){return e.type==="point"&&e.nearest},parse:function(e,t){if(t.events){for(var n=0,r=t.events;n<r.length;n++){var i=r[n];i.markname=e.getName(VORONOI)}}},marks:function(e,t,n){var r=t.project.hasChannel,i=r.x,a=r.y;var o=e.mark;if(isPathMark(o)){warn(nearestNotSupportForContinuous(o));return n}var s={name:e.getName(VORONOI),type:"path",interactive:true,from:{data:e.getName("marks")},encode:{update:__assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:true}},tooltip(e,{reactiveGeom:true}))},transform:[{type:"voronoi",x:{expr:i||!a?"datum.datum.x || 0":"0"},y:{expr:a||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};var u=0;var l=false;n.forEach((function(t,n){var r;var i=(r=t.name)!==null&&r!==void 0?r:"";if(i===e.component.mark[0].name){u=n}else if(i.indexOf(VORONOI)>=0){l=true}}));if(!l){n.splice(u+1,0,s)}return n}};var inputBindings={defined:function(e){return e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!isLegendBinding(e.bind)},parse:function(e,t,n){return disableDirectManipulation(t,n)},topLevelSignals:function(e,t,n){var r=t.name;var i=t.project;var a=t.bind;var o=t.init&&t.init[0];var s=nearest.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";i.items.forEach((function(e,i){var u,l;var f=varName(r+"_"+e.field);var c=n.filter((function(e){return e.name===f}));if(!c.length){n.unshift(__assign(__assign({name:f},o?{init:assembleInit(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? "+s+"["+$$1(e.field)+"] : null"}]:[],bind:(l=(u=a[e.field])!==null&&u!==void 0?u:a[e.channel])!==null&&l!==void 0?l:a}))}}));return n},signals:function(e,t,n){var r=t.name;var i=t.project;var a=n.filter((function(e){return e.name===r+TUPLE}))[0];var o=r+TUPLE_FIELDS;var s=i.items.map((function(e){return varName(r+"_"+e.field)}));var u=s.map((function(e){return e+" !== null"})).join(" && ");if(s.length){a.update=u+" ? {fields: "+o+", values: ["+s.join(", ")+"]} : null"}delete a.value;delete a.on;return n}};var TOGGLE="_toggle";var toggle={defined:function(e){return e.type==="point"&&!!e.toggle},signals:function(e,t,n){return n.concat({name:t.name+TOGGLE,value:false,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t){var n=t.name+TUPLE;var r=t.name+TOGGLE;return r+" ? null : "+n+", "+(t.resolve==="global"?r+" ? null : true, ":r+" ? null : {unit: "+unitName(e)+"}, ")+(r+" ? "+n+" : null")}};var clear={defined:function(e){return e.clear!==undefined&&e.clear!==false},parse:function(e,t){if(t.clear){t.clear=isString(t.clear)?eventSelector(t.clear,"view"):t.clear}},topLevelSignals:function(e,t,n){if(inputBindings.defined(t)){var r=function(e){var r=n.findIndex((function(n){return n.name===varName(t.name+"_"+e.field)}));if(r!==-1){n[r].on.push({events:t.clear,update:"null"})}};for(var i=0,a=t.project.items;i<a.length;i++){var o=a[i];r(o)}}return n},signals:function(e,t,n){function r(e,r){if(e!==-1&&n[e].on){n[e].on.push({events:t.clear,update:r})}}if(t.type==="interval"){var i=function(e){var t=n.findIndex((function(t){return t.name===e.signals.visual}));r(t,"[0, 0]");if(t===-1){var i=n.findIndex((function(t){return t.name===e.signals.data}));r(i,"null")}};for(var a=0,o=t.project.items;a<o.length;a++){var s=o[a];i(s)}}else{var u=n.findIndex((function(e){return e.name===t.name+TUPLE}));r(u,"null");if(toggle.defined(t)){u=n.findIndex((function(e){return e.name===t.name+TOGGLE}));r(u,"false")}}return n}};var legendBindings={defined:function(e){var t=e.resolve==="global"&&e.bind&&isLegendBinding(e.bind);var n=e.project.items.length===1&&e.project.items[0].field!==SELECTION_ID;if(t&&!n){warn(LEGEND_BINDINGS_MUST_HAVE_PROJECTION)}return t&&n},parse:function(e,t,n){var r;var i=duplicate(n);i.select=isString(i.select)?{type:i.select,toggle:t.toggle}:__assign(__assign({},i.select),{toggle:t.toggle});disableDirectManipulation(t,i);if(isObject(n.select)&&(n.select.on||n.select.clear)){var a='event.item && indexof(event.item.mark.role, "legend") < 0';for(var o=0,s=t.events;o<s.length;o++){var u=s[o];u.filter=array$5((r=u.filter)!==null&&r!==void 0?r:[]);if(!u.filter.includes(a)){u.filter.push(a)}}}var l=isLegendStreamBinding(t.bind)?t.bind.legend:"click";var f=isString(l)?eventSelector(l,"view"):array$5(l);t.bind={legend:{merge:f}}},topLevelSignals:function(e,t,n){var r=t.name;var i=isLegendStreamBinding(t.bind)&&t.bind.legend;var a=function(e){return function(t){var n=duplicate(t);n.markname=e;return n}};var o=function(e){if(!e.hasLegend)return"continue";var o=varName(e.field)+"_legend";var s=r+"_"+o;var u=n.filter((function(e){return e.name===s}));if(u.length===0){var l=i.merge.map(a(o+"_symbols")).concat(i.merge.map(a(o+"_labels"))).concat(i.merge.map(a(o+"_entries")));n.unshift(__assign(__assign({name:s},!t.init?{value:null}:{}),{on:[{events:l,update:"datum.value || item().items[0].items[0].datum.value",force:true},{events:i.merge,update:"!event.item || !datum ? null : "+s,force:true}]}))}};for(var s=0,u=t.project.items;s<u.length;s++){var l=u[s];o(l)}return n},signals:function(e,t,n){var r=t.name;var i=t.project;var a=n.find((function(e){return e.name===r+TUPLE}));var o=r+TUPLE_FIELDS;var s=i.items.filter((function(e){return e.hasLegend})).map((function(e){return varName(r+"_"+varName(e.field)+"_legend")}));var u=s.map((function(e){return e+" !== null"})).join(" && ");var l=u+" ? {fields: "+o+", values: ["+s.join(", ")+"]} : null";if(t.events&&s.length>0){a.on.push({events:s.map((function(e){return{signal:e}})),update:l})}else if(s.length>0){a.update=l;delete a.value;delete a.on}var f=n.find((function(e){return e.name===r+TOGGLE}));var c=isLegendStreamBinding(t.bind)&&t.bind.legend;if(f){if(!t.events)f.on[0].events=c;else f.on.push(__assign(__assign({},f.on[0]),{events:c}))}return n}};function parseInteractiveLegend(e,t,n){var r,i,a,o;var s=(r=e.fieldDef(t))===null||r===void 0?void 0:r.field;for(var u=0,l=vals((i=e.component.selection)!==null&&i!==void 0?i:{});u<l.length;u++){var f=l[u];var c=(a=f.project.hasField[s])!==null&&a!==void 0?a:f.project.hasChannel[t];if(c&&legendBindings.defined(f)){var d=(o=n.get("selections"))!==null&&o!==void 0?o:[];d.push(f.name);n.set("selections",d,false);c.hasLegend=true}}}var ANCHOR$1="_translate_anchor";var DELTA$1="_translate_delta";var translate={defined:function(e){return e.type==="interval"&&e.translate},signals:function(e,t,n){var r=t.name;var i=scaleBindings.defined(t);var a=r+ANCHOR$1;var o=t.project.hasChannel,s=o.x,u=o.y;var l=eventSelector(t.translate,"scope");if(!i){l=l.map((function(e){return e.between[0].markname=r+BRUSH,e}))}n.push({name:a,value:{},on:[{events:l.map((function(e){return e.between[0]})),update:"{x: x(unit), y: y(unit)"+(s!==undefined?", extent_x: "+(i?domain(e,X):"slice("+s.signals.visual+")"):"")+(u!==undefined?", extent_y: "+(i?domain(e,Y):"slice("+u.signals.visual+")"):"")+"}"}]},{name:r+DELTA$1,value:{},on:[{events:l,update:"{x: "+a+".x - x(unit), y: "+a+".y - y(unit)}"}]});if(s!==undefined){onDelta$1(e,t,s,"width",n)}if(u!==undefined){onDelta$1(e,t,u,"height",n)}return n}};function onDelta$1(e,t,n,r,i){var a,o;var s=t.name;var u=s+ANCHOR$1;var l=s+DELTA$1;var f=n.channel;var c=scaleBindings.defined(t);var d=i.filter((function(e){return e.name===n.signals[c?"data":"visual"]}))[0];var p=e.getSizeSignalRef(r).signal;var h=e.getScaleComponent(f);var g=h.get("type");var m=h.get("reverse");var v=!c?"":f===X?m?"":"-":m?"-":"";var y=u+".extent_"+f;var _=""+v+l+"."+f+" / "+(c?""+p:"span("+y+")");var b=!c?"panLinear":g==="log"?"panLog":g==="symlog"?"panSymlog":g==="pow"?"panPow":"panLinear";var x=!c?"":g==="pow"?", "+((a=h.get("exponent"))!==null&&a!==void 0?a:1):g==="symlog"?", "+((o=h.get("constant"))!==null&&o!==void 0?o:1):"";var E=b+"("+y+", "+_+x+")";d.on.push({events:{signal:l},update:c?E:"clampRange("+E+", 0, "+p+")"})}var ANCHOR="_zoom_anchor";var DELTA="_zoom_delta";var zoom={defined:function(e){return e.type==="interval"&&e.zoom},signals:function(e,t,n){var r=t.name;var i=scaleBindings.defined(t);var a=r+DELTA;var o=t.project.hasChannel,s=o.x,u=o.y;var l=$$1(e.scaleName(X));var f=$$1(e.scaleName(Y));var c=eventSelector(t.zoom,"scope");if(!i){c=c.map((function(e){return e.markname=r+BRUSH,e}))}n.push({name:r+ANCHOR,on:[{events:c,update:!i?"{x: x(unit), y: y(unit)}":"{"+[l?"x: invert("+l+", x(unit))":"",f?"y: invert("+f+", y(unit))":""].filter((function(e){return!!e})).join(", ")+"}"}]},{name:a,on:[{events:c,force:true,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]});if(s!==undefined){onDelta(e,t,s,"width",n)}if(u!==undefined){onDelta(e,t,u,"height",n)}return n}};function onDelta(e,t,n,r,i){var a,o;var s=t.name;var u=n.channel;var l=scaleBindings.defined(t);var f=i.filter((function(e){return e.name===n.signals[l?"data":"visual"]}))[0];var c=e.getSizeSignalRef(r).signal;var d=e.getScaleComponent(u);var p=d.get("type");var h=l?domain(e,u):f.name;var g=s+DELTA;var m=""+s+ANCHOR+"."+u;var v=!l?"zoomLinear":p==="log"?"zoomLog":p==="symlog"?"zoomSymlog":p==="pow"?"zoomPow":"zoomLinear";var y=!l?"":p==="pow"?", "+((a=d.get("exponent"))!==null&&a!==void 0?a:1):p==="symlog"?", "+((o=d.get("constant"))!==null&&o!==void 0?o:1):"";var _=v+"("+h+", "+m+", "+g+y+")";f.on.push({events:{signal:g},update:l?_:"clampRange("+_+", 0, "+c+")"})}var STORE="_store";var TUPLE="_tuple";var MODIFY="_modify";var VL_SELECTION_RESOLVE="vlSelectionResolve";var selectionCompilers=[point$1,interval,project,toggle,inputBindings,scaleBindings,legendBindings,clear,translate,zoom,nearest];function getFacetModel(e){var t=e.parent;while(t){if(isFacetModel(t))break;t=t.parent}return t}function unitName(e,t){var n=t===void 0?{escape:true}:t,r=n.escape;var i=r?$$1(e.name):e.name;var a=getFacetModel(e);if(a){var o=a.facet;for(var s=0,u=FACET_CHANNELS;s<u.length;s++){var l=u[s];if(o[l]){i+=" + '__facet_"+l+"_' + (facet["+$$1(a.vgField(l))+"])"}}}return i}function requiresSelectionId(e){var t;return vals((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((function(e,t){return e||t.project.items.some((function(e){return e.field===SELECTION_ID}))}),false)}function disableDirectManipulation(e,t){if(isString(t.select)||!t.select.on)delete e.events;if(isString(t.select)||!t.select.clear)delete e.clear;if(isString(t.select)||!t.select.toggle)delete e.toggle}function getName(e){var t=[];if(e.type==="Identifier"){return[e.name]}if(e.type==="Literal"){return[e.value]}if(e.type==="MemberExpression"){t.push.apply(t,getName(e.object));t.push.apply(t,getName(e.property))}return t}function startsWithDatum(e){if(e.object.type==="MemberExpression"){return startsWithDatum(e.object)}return e.object.name==="datum"}function getDependentFields(e){var t=parser$1(e);var n=new Set;t.visit((function(e){if(e.type==="MemberExpression"&&startsWithDatum(e)){n.add(getName(e).slice(1).join("."))}}));return n}var FilterNode=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this,t)||this;i.model=n;i.filter=r;i.expr=expression(i.model,i.filter,i);i._dependentFields=getDependentFields(i.expr);return i}t.prototype.clone=function(){return new t(null,this.model,duplicate(this.filter))};t.prototype.dependentFields=function(){return this._dependentFields};t.prototype.producedFields=function(){return new Set};t.prototype.assemble=function(){return{type:"filter",expr:this.expr}};t.prototype.hash=function(){return"Filter "+this.expr};return t}(DataFlowNode);function parseUnitSelection(e,t){var n;var r={};var i=e.config.selection;if(!t||!t.length)return r;for(var a=0,o=t;a<o.length;a++){var s=o[a];var u=varName(s.name);var l=s.select;var f=isString(l)?l:l.type;var c=isObject(l)?duplicate(l):{type:f};var d=i[f],p=d.fields,h=d.encodings,g=__rest(d,["fields","encodings"]);for(var m in g){if(m==="mark"){c[m]=__assign(__assign({},g[m]),c[m])}if(c[m]===undefined||c[m]===true){c[m]=(n=g[m])!==null&&n!==void 0?n:c[m]}}var v=r[u]=__assign(__assign({},c),{name:u,type:f,init:s.value,bind:s.bind,events:isString(c.on)?eventSelector(c.on,"scope"):array$5(duplicate(c.on))});for(var y=0,_=selectionCompilers;y<_.length;y++){var b=_[y];if(b.defined(v)&&b.parse){b.parse(e,v,s)}}}return r}function parseSelectionPredicate(t,n,r,i){if(i===void 0){i="datum"}var a=isString(n)?n:n.param;var o=varName(a);var s=$$1(o+STORE);var u;try{u=t.getSelectionComponent(o,a)}catch(e){return"!!"+o}if(u.project.timeUnit){var l=r!==null&&r!==void 0?r:t.component.data.raw;var f=u.project.timeUnit.clone();if(l.parent){f.insertAsParentOf(l)}else{l.parent=f}}var c="vlSelectionTest("+s+", "+i+(u.resolve==="global"?")":", "+$$1(u.resolve)+")");var d="length(data("+s+"))";return n.empty===false?d+" && "+c:"!"+d+" || "+c}function parseSelectionExtent(t,n,r){var i=varName(n);var a=r["encoding"];var o=r["field"];var s;try{s=t.getSelectionComponent(i,n)}catch(e){return i}if(!a&&!o){o=s.project.items[0].field;if(s.project.items.length>1){warn('A "field" or "encoding" must be specified when using a selection as a scale domain. '+('Using "field": '+$$1(o)+"."))}}else if(a&&!o){var u=s.project.items.filter((function(e){return e.channel===a}));if(!u.length||u.length>1){o=s.project.items[0].field;warn((!u.length?"No ":"Multiple ")+("matching "+$$1(a)+" encoding found for selection "+$$1(r.param)+". ")+('Using "field": '+$$1(o)+"."))}else{o=u[0].field}}return s.name+"["+$$1(replacePathInField(o))+"]"}function materializeSelections(e,t){var n;for(var r=0,i=entries$1((n=e.component.selection)!==null&&n!==void 0?n:{});r<i.length;r++){var a=i[r],o=a[0],s=a[1];var u=e.getName("lookup_"+o);e.component.data.outputNodes[u]=s.materialized=new OutputNode(new FilterNode(t,e,{param:o}),u,DataSourceType.Lookup,e.component.data.outputNodeRefCounts)}}function expression(e,t,n){return logicalExpr(t,(function(t){if(isString(t)){return t}else if(isSelectionPredicate(t)){return parseSelectionPredicate(e,t,n)}else{return fieldFilterExpression(t)}}))}function assembleTitle(e,t){if(!e){return undefined}if(isArray(e)&&!isText(e)){return e.map((function(e){return defaultTitle(e,t)})).join(", ")}return e}function setAxisEncode(e,t,n,r){var i,a,o;var s,u;(i=e.encode)!==null&&i!==void 0?i:e.encode={};(a=(s=e.encode)[t])!==null&&a!==void 0?a:s[t]={};(o=(u=e.encode[t]).update)!==null&&o!==void 0?o:u.update={};e.encode[t].update[n]=r}function assembleAxis(e,t,n,r){var i,a;if(r===void 0){r={header:false}}var o=e.combine(),s=o.disable,u=o.orient,l=o.scale,f=o.labelExpr,c=o.title,d=o.zindex,p=__rest(o,["disable","orient","scale","labelExpr","title","zindex"]);if(s){return undefined}for(var h in p){var g=AXIS_PROPERTY_TYPE[h];var m=p[h];if(g&&g!==t&&g!=="both"){delete p[h]}else if(isConditionalAxisValue(m)){var v=m.condition,y=__rest(m,["condition"]);var _=array$5(v);var b=CONDITIONAL_AXIS_PROP_INDEX[h];if(b){var x=b.vgProp,E=b.part;var S=__spreadArray(__spreadArray([],_.map((function(e){var t=e.test,n=__rest(e,["test"]);return __assign({test:expression(null,t)},n)}))),[y]);setAxisEncode(p,E,x,S);delete p[h]}else if(b===null){var $={signal:_.map((function(e){var t=e.test,n=__rest(e,["test"]);return expression(null,t)+" ? "+exprFromValueOrSignalRef(n)+" : "})).join("")+exprFromValueOrSignalRef(y)};p[h]=$}}else if(isSignalRef(m)){var b=CONDITIONAL_AXIS_PROP_INDEX[h];if(b){var x=b.vgProp,E=b.part;setAxisEncode(p,E,x,m);delete p[h]}}if(contains(["labelAlign","labelBaseline"],h)&&p[h]===null){delete p[h]}}if(t==="grid"){if(!p.grid){return undefined}if(p.encode){var A=p.encode.grid;p.encode=__assign({},A?{grid:A}:{});if(isEmpty(p.encode)){delete p.encode}}return __assign(__assign({scale:l,orient:u},p),{domain:false,labels:false,aria:false,maxExtent:0,minExtent:0,ticks:false,zindex:getFirstDefined(d,0)})}else{if(!r.header&&e.mainExtracted){return undefined}if(f!==undefined){var D=f;if(((a=(i=p.encode)===null||i===void 0?void 0:i.labels)===null||a===void 0?void 0:a.update)&&isSignalRef(p.encode.labels.update.text)){D=replaceAll(f,"datum.label",p.encode.labels.update.text.signal)}setAxisEncode(p,"labels","text",{signal:D})}if(p.labelAlign===null){delete p.labelAlign}if(p.encode){for(var w=0,C=AXIS_PARTS;w<C.length;w++){var E=C[w];if(!e.hasAxisPart(E)){delete p.encode[E]}}if(isEmpty(p.encode)){delete p.encode}}var T=assembleTitle(c,n);return __assign(__assign(__assign(__assign({scale:l,orient:u,grid:false},T?{title:T}:{}),p),n.aria===false?{aria:false}:{}),{zindex:getFirstDefined(d,0)})}}function assembleAxisSignals(e){var t=e.component.axes;var n=[];for(var r=0,i=POSITION_SCALE_CHANNELS;r<i.length;r++){var a=i[r];if(t[a]){for(var o=0,s=t[a];o<s.length;o++){var u=s[o];if(!u.get("disable")&&!u.get("gridScale")){var l=a==="x"?"height":"width";var f=e.getSizeSignalRef(l).signal;if(l!==f){n.push({name:l,update:f})}}}}}return n}function assembleAxes(e,t){var n=e.x,r=n===void 0?[]:n,i=e.y,a=i===void 0?[]:i;return __spreadArray(__spreadArray(__spreadArray(__spreadArray([],r.map((function(e){return assembleAxis(e,"grid",t)}))),a.map((function(e){return assembleAxis(e,"grid",t)}))),r.map((function(e){return assembleAxis(e,"main",t)}))),a.map((function(e){return assembleAxis(e,"main",t)}))).filter((function(e){return e}))}function getAxisConfigFromConfigTypes(e,t,n,r){return Object.assign.apply(null,__spreadArray([{}],e.map((function(e){if(e==="axisOrient"){var i=n==="x"?"bottom":"left";var a=t[n==="x"?"axisBottom":"axisLeft"]||{};var o=t[n==="x"?"axisTop":"axisRight"]||{};var s=new Set(__spreadArray(__spreadArray([],keys$1(a)),keys$1(o)));var u={};for(var l=0,f=s.values();l<f.length;l++){var c=f[l];u[c]={signal:r["signal"]+' === "'+i+'" ? '+signalOrStringValue(a[c])+" : "+signalOrStringValue(o[c])}}return u}return t[e]}))))}function getAxisConfigs(e,t,n,r){var i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:isQuantitative(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[];var a=e==="x"?"axisX":"axisY";var o=isSignalRef(n)?"axisOrient":"axis"+titleCase(n);var s=__spreadArray(__spreadArray([],i),i.map((function(e){return a+e.substr(4)})));var u=["axis",o,a];return{vlOnlyAxisConfig:getAxisConfigFromConfigTypes(s,r,e,n),vgAxisConfig:getAxisConfigFromConfigTypes(u,r,e,n),axisConfigStyle:getAxisConfigStyle(__spreadArray(__spreadArray([],u),s),r)}}function getAxisConfigStyle(e,t){var n;var r=[{}];for(var i=0,a=e;i<a.length;i++){var o=a[i];var s=(n=t[o])===null||n===void 0?void 0:n.style;if(s){s=array$5(s);for(var u=0,l=s;u<l.length;u++){var f=l[u];r.push(t.style[f])}}}return Object.assign.apply(null,r)}function getAxisConfig(e,t,n,r){var i;if(r===void 0){r={}}var a=getStyleConfig(e,n,t);if(a!==undefined){return{configFrom:"style",configValue:a}}for(var o=0,s=["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"];o<s.length;o++){var u=s[o];if(((i=r[u])===null||i===void 0?void 0:i[e])!==undefined){return{configFrom:u,configValue:r[u][e]}}}return{}}var axisRules={scale:function(e){var t=e.model,n=e.channel;return t.scaleName(n)},format:function(e){var t=e.fieldOrDatumDef,n=e.config,r=e.axis;var i=r.format,a=r.formatType;return guideFormat(t,t.type,i,a,n,true)},formatType:function(e){var t=e.axis,n=e.fieldOrDatumDef,r=e.scaleType;var i=t.formatType;return guideFormatType(i,n,r)},grid:function(e){var t;var n=e.fieldOrDatumDef,r=e.axis,i=e.scaleType;return(t=r.grid)!==null&&t!==void 0?t:defaultGrid(i,n)},gridScale:function(e){var t=e.model,n=e.channel;return gridScale(t,n)},labelAlign:function(e){var t=e.axis,n=e.labelAngle,r=e.orient,i=e.channel;return t.labelAlign||defaultLabelAlign(n,r,i)},labelAngle:function(e){var t=e.labelAngle;return t},labelBaseline:function(e){var t=e.axis,n=e.labelAngle,r=e.orient,i=e.channel;return t.labelBaseline||defaultLabelBaseline(n,r,i)},labelFlush:function(e){var t;var n=e.axis,r=e.fieldOrDatumDef,i=e.channel;return(t=n.labelFlush)!==null&&t!==void 0?t:defaultLabelFlush(r.type,i)},labelOverlap:function(e){var t;var n=e.axis,r=e.fieldOrDatumDef,i=e.scaleType;return(t=n.labelOverlap)!==null&&t!==void 0?t:defaultLabelOverlap$1(r.type,i,isFieldDef(r)&&!!r.timeUnit,isFieldDef(r)?r.sort:undefined)},orient:function(e){var t=e.orient;return t},tickCount:function(e){var t;var n=e.channel,r=e.model,i=e.axis,a=e.fieldOrDatumDef,o=e.scaleType;var s=n==="x"?"width":n==="y"?"height":undefined;var u=s?r.getSizeSignalRef(s):undefined;return(t=i.tickCount)!==null&&t!==void 0?t:defaultTickCount({fieldOrDatumDef:a,scaleType:o,size:u,values:i.values})},title:function(e){var t=e.axis,n=e.model,r=e.channel;if(t.title!==undefined){return t.title}var i=getFieldDefTitle(n,r);if(i!==undefined){return i}var a=n.typedFieldDef(r);var o=r==="x"?"x2":"y2";var s=n.fieldDef(o);return mergeTitleFieldDefs(a?[toFieldDefBase(a)]:[],isFieldDef(s)?[toFieldDefBase(s)]:[])},values:function(e){var t=e.axis,n=e.fieldOrDatumDef;return values$2(t,n)},zindex:function(e){var t;var n=e.axis,r=e.fieldOrDatumDef,i=e.mark;return(t=n.zindex)!==null&&t!==void 0?t:defaultZindex(i,r)}};function defaultGrid(e,t){return!hasDiscreteDomain(e)&&isFieldDef(t)&&!isBinning(t===null||t===void 0?void 0:t.bin)&&!isBinned(t===null||t===void 0?void 0:t.bin)}function gridScale(e,t){var n=t==="x"?"y":"x";if(e.getScaleComponent(n)){return e.scaleName(n)}return undefined}function getLabelAngle(e,t,n,r,i){var a=t===null||t===void 0?void 0:t.labelAngle;if(a!==undefined){return isSignalRef(a)?a:normalizeAngle(a)}else{var o=getAxisConfig("labelAngle",r,t===null||t===void 0?void 0:t.style,i).configValue;if(o!==undefined){return normalizeAngle(o)}else{if(n===X&&contains([NOMINAL,ORDINAL],e.type)&&!(isFieldDef(e)&&e.timeUnit)){return 270}return undefined}}}function normalizeAngleExpr(e){return"((("+e.signal+" % 360) + 360) % 360)"}function defaultLabelBaseline(e,t,n,r){if(e!==undefined){if(n==="x"){if(isSignalRef(e)){var i=normalizeAngleExpr(e);var a=isSignalRef(t)?"("+t.signal+' === "top")':t==="top";return{signal:"(45 < "+i+" && "+i+" < 135) || (225 < "+i+" && "+i+' < 315) ? "middle" :'+("("+i+" <= 45 || 315 <= "+i+") === "+a+' ? "bottom" : "top"')}}if(45<e&&e<135||225<e&&e<315){return"middle"}if(isSignalRef(t)){var o=e<=45||315<=e?"===":"!==";return{signal:t.signal+" "+o+' "top" ? "bottom" : "top"'}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(isSignalRef(e)){var s=normalizeAngleExpr(e);var u=isSignalRef(t)?"("+t.signal+' === "left")':t==="left";var l=r?'"middle"':"null";return{signal:s+" <= 45 || 315 <= "+s+" || (135 <= "+s+" && "+s+" <= 225) ? "+l+" : (45 <= "+s+" && "+s+" <= 135) === "+u+' ? "top" : "bottom"'}}if(e<=45||315<=e||135<=e&&e<=225){return r?"middle":null}if(isSignalRef(t)){var o=45<=e&&e<=135?"===":"!==";return{signal:t.signal+" "+o+' "left" ? "top" : "bottom"'}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}}return undefined}function defaultLabelAlign(e,t,n){if(e===undefined){return undefined}var r=n==="x";var i=r?0:90;var a=r?"bottom":"left";if(isSignalRef(e)){var o=normalizeAngleExpr(e);var s=isSignalRef(t)?"("+t.signal+' === "'+a+'")':t===a;return{signal:"("+(i?"("+o+" + 90)":o)+" % 180 === 0) ? "+(r?null:'"center"')+" :"+("("+i+" < "+o+" && "+o+" < "+(180+i)+") === "+s+' ? "left" : "right"')}}if((e+i)%180===0){return r?null:"center"}if(isSignalRef(t)){var u=i<e&&e<180+i?"===":"!==";var s=t.signal+" "+u+' "'+a+'"';return{signal:s+' ? "left" : "right"'}}if((i<e&&e<180+i)===(t===a)){return"left"}return"right"}function defaultLabelFlush(e,t){if(t==="x"&&contains(["quantitative","temporal"],e)){return true}return undefined}function defaultLabelOverlap$1(e,t,n,r){if(n&&!isObject(r)||e!=="nominal"&&e!=="ordinal"){if(t==="log"||t==="symlog"){return"greedy"}return true}return undefined}function defaultOrient(e){return e==="x"?"bottom":"left"}function defaultTickCount(e){var t;var n=e.fieldOrDatumDef,r=e.scaleType,i=e.size,a=e.values;if(!a&&!hasDiscreteDomain(r)&&r!=="log"){if(isFieldDef(n)){if(isBinning(n.bin)){return{signal:"ceil("+i.signal+"/10)"}}if(n.timeUnit&&contains(["month","hours","day","quarter"],(t=normalizeTimeUnit(n.timeUnit))===null||t===void 0?void 0:t.unit)){return undefined}}return{signal:"ceil("+i.signal+"/40)"}}return undefined}function getFieldDefTitle(e,t){var n=t==="x"?"x2":"y2";var r=e.fieldDef(t);var i=e.fieldDef(n);var a=r?r.title:undefined;var o=i?i.title:undefined;if(a&&o){return mergeTitle(a,o)}else if(a){return a}else if(o){return o}else if(a!==undefined){return a}else if(o!==undefined){return o}return undefined}function values$2(e,t){var n=e.values;if(isArray(n)){return valueArray(t,n)}else if(isSignalRef(n)){return n}return undefined}function defaultZindex(e,t){if(e==="rect"&&isDiscrete(t)){return 1}return 0}var CalculateNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;r._dependentFields=getDependentFields(r.transform.calculate);return r}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.parseAllForSortIndex=function(e,n){n.forEachFieldDef((function(n,r){if(!isScaleFieldDef(n)){return}if(isSortArray(n.sort)){var i=n.field,a=n.timeUnit;var o=n.sort;var s=o.map((function(e,t){return fieldFilterExpression({field:i,timeUnit:a,equal:e})+" ? "+t+" : "})).join("")+o.length;e=new t(e,{calculate:s,as:sortArrayIndexField(n,r,{forAs:true})})}}));return e};t.prototype.producedFields=function(){return new Set([this.transform.as])};t.prototype.dependentFields=function(){return this._dependentFields};t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}};t.prototype.hash=function(){return"Calculate "+hash(this.transform)};return t}(DataFlowNode);function sortArrayIndexField(e,t,n){return vgField(e,__assign({prefix:t,suffix:"sort_index"},n!==null&&n!==void 0?n:{}))}function getHeaderChannel(e,t){if(contains(["top","bottom"],t)){return"column"}else if(contains(["left","right"],t)){return"row"}return e==="row"?"row":"column"}function getHeaderProperty(e,t,n,r){var i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return getFirstDefined((t||{})[e],i[e],n.header[e])}function getHeaderProperties(e,t,n,r){var i={};for(var a=0,o=e;a<o.length;a++){var s=o[a];var u=getHeaderProperty(s,t||{},n,r);if(u!==undefined){i[s]=u}}return i}var HEADER_CHANNELS=["row","column"];var HEADER_TYPES=["header","footer"];function assembleTitleGroup(e,t){var n=e.component.layoutHeaders[t].title;var r=e.config?e.config:undefined;var i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:undefined;var a=getHeaderProperties(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),o=a.titleAnchor,s=a.titleAngle,u=a.titleOrient;var l=getHeaderChannel(t,u);var f=normalizeAngle(s);return{name:t+"-title",type:"group",role:l+"-title",title:__assign(__assign(__assign(__assign(__assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),defaultHeaderGuideBaseline(f,l)),defaultHeaderGuideAlign(l,f,o)),assembleHeaderProperties(r,i,t,HEADER_TITLE_PROPERTIES,HEADER_TITLE_PROPERTIES_MAP))}}function defaultHeaderGuideAlign(e,t,n){if(n===void 0){n="middle"}switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}var r=defaultLabelAlign(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function defaultHeaderGuideBaseline(e,t){var n=defaultLabelBaseline(e,t==="row"?"left":"top",t==="row"?"y":"x",true);return n?{baseline:n}:{}}function assembleHeaderGroups(e,t){var n=e.component.layoutHeaders[t];var r=[];for(var i=0,a=HEADER_TYPES;i<a.length;i++){var o=a[i];if(n[o]){for(var s=0,u=n[o];s<u.length;s++){var l=u[s];var f=assembleHeaderGroup(e,t,o,n,l);if(f!=null){r.push(f)}}}}return r}function getSort$1(e,t){var n;var r=e.sort;if(isSortField(r)){return{field:vgField(r,{expr:"datum"}),order:(n=r.order)!==null&&n!==void 0?n:"ascending"}}else if(isArray(r)){return{field:sortArrayIndexField(e,t,{expr:"datum"}),order:"ascending"}}else{return{field:vgField(e,{expr:"datum"}),order:r!==null&&r!==void 0?r:"ascending"}}}function assembleLabelTitle(e,t,n){var r=getHeaderProperties(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),i=r.format,a=r.formatType,o=r.labelAngle,s=r.labelAnchor,u=r.labelOrient,l=r.labelExpr;var f=formatSignalRef({fieldOrDatumDef:e,format:i,formatType:a,expr:"parent",config:n}).signal;var c=getHeaderChannel(t,u);return __assign(__assign(__assign(__assign(__assign({text:{signal:l?replaceAll(replaceAll(l,"datum.label",f),"datum.value",vgField(e,{expr:"parent"})):f}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),defaultHeaderGuideBaseline(o,c)),defaultHeaderGuideAlign(c,o,s)),assembleHeaderProperties(n,e,t,HEADER_LABEL_PROPERTIES,HEADER_LABEL_PROPERTIES_MAP))}function assembleHeaderGroup(e,t,n,r,i){var a;if(i){var o=null;var s=r.facetFieldDef;var u=e.config?e.config:undefined;if(s&&i.labels){var l=getHeaderProperties(["labelOrient"],s.header,u,t).labelOrient;if(t==="row"&&!contains(["top","bottom"],l)||t==="column"&&!contains(["left","right"],l)){o=assembleLabelTitle(s,t,u)}}var f=isFacetModel(e)&&!isFacetMapping(e.facet);var c=i.axes;var d=(c===null||c===void 0?void 0:c.length)>0;if(o||d){var p=t==="row"?"height":"width";return __assign(__assign(__assign(__assign(__assign({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:getSort$1(s,t)}:{}),d&&f?{from:{data:e.getName("facet_domain_"+t)}}:{}),o?{title:o}:{}),i.sizeSignal?{encode:{update:(a={},a[p]=i.sizeSignal,a)}}:{}),d?{axes:c}:{})}}return null}var LAYOUT_TITLE_BAND={column:{start:0,end:1},row:{start:1,end:0}};function getLayoutTitleBand(e,t){return LAYOUT_TITLE_BAND[t][e]}function assembleLayoutTitleBand(e,t){var n={};for(var r=0,i=FACET_CHANNELS;r<i.length;r++){var a=i[r];var o=e[a];if(o===null||o===void 0?void 0:o.facetFieldDef){var s=getHeaderProperties(["titleAnchor","titleOrient"],o.facetFieldDef.header,t,a),u=s.titleAnchor,l=s.titleOrient;var f=getHeaderChannel(a,l);var c=getLayoutTitleBand(u,f);if(c!==undefined){n[f]=c}}}return isEmpty(n)?undefined:n}function assembleHeaderProperties(e,t,n,r,i){var a={};for(var o=0,s=r;o<s.length;o++){var u=s[o];if(!i[u]){continue}var l=getHeaderProperty(u,t===null||t===void 0?void 0:t.header,e,n);if(l!==undefined){a[i[u]]=l}}return a}function assembleLayoutSignals(e){return __spreadArray(__spreadArray(__spreadArray(__spreadArray([],sizeSignals(e,"width")),sizeSignals(e,"height")),sizeSignals(e,"childWidth")),sizeSignals(e,"childHeight"))}function sizeSignals(e,t){var n=t==="width"?"x":"y";var r=e.component.layoutSize.get(t);if(!r||r==="merged"){return[]}var i=e.getSizeSignalRef(t).signal;if(r==="step"){var a=e.getScaleComponent(n);if(a){var o=a.get("type");var s=a.get("range");if(hasDiscreteDomain(o)&&isVgRangeStep(s)){var u=e.scaleName(n);if(isFacetModel(e.parent)){var l=e.parent.component.resolve;if(l.scale[n]==="independent"){return[stepSignal(u,s)]}}return[stepSignal(u,s),{name:i,update:sizeExpr(u,a,"domain('"+u+"').length")}]}}throw new Error("layout size is step although width/height is not step.")}else if(r=="container"){var f=i.endsWith("width");var c=f?"containerSize()[0]":"containerSize()[1]";var d=getViewConfigContinuousSize(e.config.view,f?"width":"height");var p="isFinite("+c+") ? "+c+" : "+d;return[{name:i,init:p,on:[{update:p,events:"window:resize"}]}]}else{return[{name:i,value:r}]}}function stepSignal(e,t){return{name:e+"_step",value:t.step}}function sizeExpr(e,t,n){var r=t.get("type");var i=t.get("padding");var a=getFirstDefined(t.get("paddingOuter"),i);var o=t.get("paddingInner");o=r==="band"?o!==undefined?o:i:1;return"bandspace("+n+", "+signalOrStringValue(o)+", "+signalOrStringValue(a)+") * "+e+"_step"}function getSizeTypeFromLayoutSizeType(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function guideEncodeEntry(e,t){return keys$1(e).reduce((function(n,r){var i=e[r];return __assign(__assign({},n),wrapCondition(t,i,r,(function(e){return signalOrValueRef(e.value)})))}),{})}function defaultScaleResolve(e,t){if(isLayerModel(t)||isFacetModel(t)){return"shared"}else if(isConcatModel(t)){return isXorY(e)?"independent":"shared"}throw new Error("invalid model type for resolve")}function parseGuideResolve(e,t){var n=e.scale[t];var r=isXorY(t)?"axis":"legend";if(n==="independent"){if(e[r][t]==="shared"){warn(independentScaleMeansIndependentGuide(t))}return"independent"}return e[r][t]||"shared"}var LEGEND_COMPONENT_PROPERTY_INDEX=__assign(__assign({},COMMON_LEGEND_PROPERTY_INDEX),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1});var LEGEND_COMPONENT_PROPERTIES=keys$1(LEGEND_COMPONENT_PROPERTY_INDEX);var LegendComponent=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Split);var legendEncodeRules={symbols:symbols,gradient:gradient,labels:labels$1,entries:entries};function symbols(e,t){var n,r,i,a,o,s,u,l;var f=t.fieldOrDatumDef,c=t.model,d=t.channel,p=t.legendCmpt,h=t.legendType;if(h!=="symbol"){return undefined}var g=c.markDef,m=c.encoding,v=c.config,y=c.mark;var _=g.filled&&y!=="trail";var b=__assign(__assign({},applyMarkConfig({},c,FILL_STROKE_CONFIG)),color(c,{filled:_}));var x=(n=p.get("symbolOpacity"))!==null&&n!==void 0?n:v.legend.symbolOpacity;var E=(r=p.get("symbolFillColor"))!==null&&r!==void 0?r:v.legend.symbolFillColor;var S=(i=p.get("symbolStrokeColor"))!==null&&i!==void 0?i:v.legend.symbolStrokeColor;var $=x===undefined?(a=getMaxValue(m.opacity))!==null&&a!==void 0?a:g.opacity:undefined;if(b.fill){if(d==="fill"||_&&d===COLOR){delete b.fill}else{if(b.fill["field"]){if(E){delete b.fill}else{b.fill=signalOrValueRef((o=v.legend.symbolBaseFillColor)!==null&&o!==void 0?o:"black");b.fillOpacity=signalOrValueRef($!==null&&$!==void 0?$:1)}}else if(isArray(b.fill)){var A=(l=(u=getFirstConditionValue((s=m.fill)!==null&&s!==void 0?s:m.color))!==null&&u!==void 0?u:g.fill)!==null&&l!==void 0?l:_&&g.color;if(A){b.fill=signalOrValueRef(A)}}}}if(b.stroke){if(d==="stroke"||!_&&d===COLOR){delete b.stroke}else{if(b.stroke["field"]||S){delete b.stroke}else if(isArray(b.stroke)){var D=getFirstDefined(getFirstConditionValue(m.stroke||m.color),g.stroke,_?g.color:undefined);if(D){b.stroke={value:D}}}}}if(d!==OPACITY){var w=isFieldDef(f)&&selectedCondition(c,p,f);if(w){b.opacity=[__assign({test:w},signalOrValueRef($!==null&&$!==void 0?$:1)),signalOrValueRef(v.legend.unselectedOpacity)]}else if($){b.opacity=signalOrValueRef($)}}b=__assign(__assign({},b),e);return isEmpty(b)?undefined:b}function gradient(e,t){var n;var r=t.model,i=t.legendType,a=t.legendCmpt;if(i!=="gradient"){return undefined}var o=r.config,s=r.markDef,u=r.encoding;var l={};var f=(n=a.get("gradientOpacity"))!==null&&n!==void 0?n:o.legend.gradientOpacity;var c=f===undefined?getMaxValue(u.opacity)||s.opacity:undefined;if(c){l.opacity=signalOrValueRef(c)}l=__assign(__assign({},l),e);return isEmpty(l)?undefined:l}function labels$1(e,t){var n=t.fieldOrDatumDef,r=t.model,i=t.channel,a=t.legendCmpt;var o=r.legend(i)||{};var s=r.config;var u=isFieldDef(n)?selectedCondition(r,a,n):undefined;var l=u?[{test:u,value:1},{value:s.legend.unselectedOpacity}]:undefined;var f=o.format,c=o.formatType;var d=isCustomFormatType(c)?formatCustomType({fieldOrDatumDef:n,field:"datum.value",format:f,formatType:c,config:s}):undefined;var p=__assign(__assign(__assign({},l?{opacity:l}:{}),d?{text:d}:{}),e);return isEmpty(p)?undefined:p}function entries(e,t){var n=t.legendCmpt;var r=n.get("selections");return(r===null||r===void 0?void 0:r.length)?__assign(__assign({},e),{fill:{value:"transparent"}}):e}function getMaxValue(e){return getConditionValue(e,(function(e,t){return Math.max(e,t.value)}))}function getFirstConditionValue(e){return getConditionValue(e,(function(e,t){return getFirstDefined(e,t.value)}))}function getConditionValue(e,t){if(hasConditionalValueDef(e)){return array$5(e.condition).reduce(t,e.value)}else if(isValueDef(e)){return e.value}return undefined}function selectedCondition(e,t,n){var r=t.get("selections");if(!(r===null||r===void 0?void 0:r.length))return undefined;var i=$$1(n.field);return r.map((function(e){var t=$$1(varName(e)+STORE);return"(!length(data("+t+")) || ("+e+"["+i+"] && indexof("+e+"["+i+"], datum.value) >= 0))"})).join(" || ")}var legendRules={direction:function(e){var t=e.direction;return t},format:function(e){var t=e.fieldOrDatumDef,n=e.legend,r=e.config;var i=n.format,a=n.formatType;return guideFormat(t,t.type,i,a,r,false)},formatType:function(e){var t=e.legend,n=e.fieldOrDatumDef,r=e.scaleType;var i=t.formatType;return guideFormatType(i,n,r)},gradientLength:function(e){var t,n;var r=e.legend,i=e.legendConfig;return(n=(t=r.gradientLength)!==null&&t!==void 0?t:i.gradientLength)!==null&&n!==void 0?n:defaultGradientLength(e)},labelOverlap:function(e){var t,n;var r=e.legend,i=e.legendConfig,a=e.scaleType;return(n=(t=r.labelOverlap)!==null&&t!==void 0?t:i.labelOverlap)!==null&&n!==void 0?n:defaultLabelOverlap(a)},symbolType:function(e){var t;var n=e.legend,r=e.markDef,i=e.channel,a=e.encoding;return(t=n.symbolType)!==null&&t!==void 0?t:defaultSymbolType(r.type,i,a.shape,r.shape)},title:function(e){var t=e.fieldOrDatumDef,n=e.config;return title(t,n,{allowDisabling:true})},type:function(e){var t=e.legendType,n=e.scaleType,r=e.channel;if(isColorChannel(r)&&isContinuousToContinuous(n)){if(t==="gradient"){return undefined}}else if(t==="symbol"){return undefined}return t},values:function(e){var t=e.fieldOrDatumDef,n=e.legend;return values$1(n,t)}};function values$1(e,t){var n=e.values;if(isArray(n)){return valueArray(t,n)}else if(isSignalRef(n)){return n}return undefined}function defaultSymbolType(e,t,n,r){var i;if(t!=="shape"){var a=(i=getFirstConditionValue(n))!==null&&i!==void 0?i:r;if(a){return a}}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function getLegendType(e){var t=e.legend;return getFirstDefined(t.type,defaultType$1(e))}function defaultType$1(e){var t=e.channel,n=e.timeUnit,r=e.scaleType;if(isColorChannel(t)){if(contains(["quarter","month","day"],n)){return"symbol"}if(isContinuousToContinuous(r)){return"gradient"}}return"symbol"}function getDirection(e){var t,n;var r=e.legendConfig,i=e.legendType,a=e.orient,o=e.legend;return(n=(t=o.direction)!==null&&t!==void 0?t:r[i?"gradientDirection":"symbolDirection"])!==null&&n!==void 0?n:defaultDirection(a,i)}function defaultDirection(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case undefined:return undefined;default:return t==="gradient"?"horizontal":undefined}}function defaultGradientLength(e){var t=e.legendConfig,n=e.model,r=e.direction,i=e.orient,a=e.scaleType;var o=t.gradientHorizontalMaxLength,s=t.gradientHorizontalMinLength,u=t.gradientVerticalMaxLength,l=t.gradientVerticalMinLength;if(isContinuousToContinuous(a)){if(r==="horizontal"){if(i==="top"||i==="bottom"){return gradientLengthSignal(n,"width",s,o)}else{return s}}else{return gradientLengthSignal(n,"height",l,u)}}return undefined}function gradientLengthSignal(e,t,n,r){var i=e.getSizeSignalRef(t).signal;return{signal:"clamp("+i+", "+n+", "+r+")"}}function defaultLabelOverlap(e){if(contains(["quantile","threshold","log","symlog"],e)){return"greedy"}return undefined}function parseLegend(e){var t=isUnitModel(e)?parseUnitLegend(e):parseNonUnitLegend(e);e.component.legends=t;return t}function parseUnitLegend(e){var t=e.encoding;var n={};for(var r=0,i=__spreadArray([COLOR],LEGEND_SCALE_CHANNELS);r<i.length;r++){var a=i[r];var o=getFieldOrDatumDef(t[a]);if(!o||!e.getScaleComponent(a)){continue}if(a===SHAPE&&isFieldDef(o)&&o.type===GEOJSON){continue}n[a]=parseLegendForChannel(e,a)}return n}function getLegendDefWithScale(e,t){var n;var r=e.scaleName(t);if(e.mark==="trail"){if(t==="color"){return{stroke:r}}else if(t==="size"){return{strokeWidth:r}}}if(t==="color"){return e.markDef.filled?{fill:r}:{stroke:r}}return n={},n[t]=r,n}function isExplicit$1(e,t,n,r){switch(t){case"disable":return n!==undefined;case"values":return!!(n===null||n===void 0?void 0:n.values);case"title":if(t==="title"&&e===(r===null||r===void 0?void 0:r.title)){return true}}return e===(n||{})[t]}function parseLegendForChannel(e,t){var n,r,i;var a=e.legend(t);var o=e.markDef,s=e.encoding,u=e.config;var l=u.legend;var f=new LegendComponent({},getLegendDefWithScale(e,t));parseInteractiveLegend(e,t,f);var c=a!==undefined?!a:l.disable;f.set("disable",c,a!==undefined);if(c){return f}a=a||{};var d=e.getScaleComponent(t).get("type");var p=getFieldOrDatumDef(s[t]);var h=isFieldDef(p)?(n=normalizeTimeUnit(p.timeUnit))===null||n===void 0?void 0:n.unit:undefined;var g=a.orient||u.legend.orient||"right";var m=getLegendType({legend:a,channel:t,timeUnit:h,scaleType:d});var v=getDirection({legend:a,legendType:m,orient:g,legendConfig:l});var y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:p,legendConfig:l,config:u,scaleType:d,orient:g,legendType:m,direction:v};for(var _=0,b=LEGEND_COMPONENT_PROPERTIES;_<b.length;_++){var x=b[_];if(m==="gradient"&&x.startsWith("symbol")||m==="symbol"&&x.startsWith("gradient")){continue}var E=x in legendRules?legendRules[x](y):a[x];if(E!==undefined){var S=isExplicit$1(E,x,a,e.fieldDef(t));if(S||u.legend[x]===undefined){f.set(x,E,S)}}}var $=(r=a===null||a===void 0?void 0:a.encoding)!==null&&r!==void 0?r:{};var A=f.get("selections");var D={};var w={fieldOrDatumDef:p,model:e,channel:t,legendCmpt:f,legendType:m};for(var C=0,T=["labels","legend","title","symbols","gradient","entries"];C<T.length;C++){var k=T[C];var O=guideEncodeEntry((i=$[k])!==null&&i!==void 0?i:{},e);var N=k in legendEncodeRules?legendEncodeRules[k](O,w):O;if(N!==undefined&&!isEmpty(N)){D[k]=__assign(__assign(__assign({},(A===null||A===void 0?void 0:A.length)&&isFieldDef(p)?{name:varName(p.field)+"_legend_"+k}:{}),(A===null||A===void 0?void 0:A.length)?{interactive:!!A}:{}),{update:N})}}if(!isEmpty(D)){f.set("encode",D,!!(a===null||a===void 0?void 0:a.encoding))}return f}function parseNonUnitLegend(e){var t=e.component,n=t.legends,r=t.resolve;for(var i=0,a=e.children;i<a.length;i++){var o=a[i];parseLegend(o);for(var s=0,u=keys$1(o.component.legends);s<u.length;s++){var l=u[s];r.legend[l]=parseGuideResolve(e.component.resolve,l);if(r.legend[l]==="shared"){n[l]=mergeLegendComponent(n[l],o.component.legends[l]);if(!n[l]){r.legend[l]="independent";delete n[l]}}}}for(var f=0,c=keys$1(n);f<c.length;f++){var l=c[f];for(var d=0,p=e.children;d<p.length;d++){var o=p[d];if(!o.component.legends[l]){continue}if(r.legend[l]==="shared"){delete o.component.legends[l]}}}return n}function mergeLegendComponent(e,t){var n,r,i,a;if(!e){return t.clone()}var o=e.getWithExplicit("orient");var s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value){return undefined}var u=false;var l=function(n){var r=mergeValuesWithExplicit(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",(function(e,t){switch(n){case"symbolType":return mergeSymbolType(e,t);case"title":return mergeTitleComponent(e,t);case"type":u=true;return makeImplicit("symbol")}return defaultTieBreaker(e,t,n,"legend")}));e.setWithExplicit(n,r)};for(var f=0,c=LEGEND_COMPONENT_PROPERTIES;f<c.length;f++){var d=c[f];l(d)}if(u){if((r=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||r===void 0?void 0:r.gradient){deleteNestedProperty(e.implicit,["encode","gradient"])}if((a=(i=e.explicit)===null||i===void 0?void 0:i.encode)===null||a===void 0?void 0:a.gradient){deleteNestedProperty(e.explicit,["encode","gradient"])}}return e}function mergeSymbolType(e,t){if(t.value==="circle"){return t}return e}function setLegendEncode(e,t,n,r){var i,a,o;var s,u;(i=e.encode)!==null&&i!==void 0?i:e.encode={};(a=(s=e.encode)[t])!==null&&a!==void 0?a:s[t]={};(o=(u=e.encode[t]).update)!==null&&o!==void 0?o:u.update={};e.encode[t].update[n]=r}function assembleLegends(e){var t=e.component.legends;var n={};for(var r=0,i=keys$1(t);r<i.length;r++){var a=i[r];var o=e.getScaleComponent(a);var s=stringify$1(o.get("domains"));if(n[s]){for(var u=0,l=n[s];u<l.length;u++){var f=l[u];var c=mergeLegendComponent(f,t[a]);if(!c){n[s].push(t[a])}}}else{n[s]=[t[a].clone()]}}var d=vals(n).flat().map((function(t){return assembleLegend(t,e.config)})).filter((function(e){return e!==undefined}));return d}function assembleLegend(e,t){var n,r,i;var a=e.combine(),o=a.disable,s=a.labelExpr,u=a.selections,l=__rest(a,["disable","labelExpr","selections"]);if(o){return undefined}if(t.aria===false&&l.aria==undefined){l.aria=false}if((n=l.encode)===null||n===void 0?void 0:n.symbols){var f=l.encode.symbols.update;if(f.fill&&f.fill["value"]!=="transparent"&&!f.stroke&&!l.stroke){f.stroke={value:"transparent"}}for(var c=0,d=LEGEND_SCALE_CHANNELS;c<d.length;c++){var p=d[c];if(l[p]){delete f[p]}}}if(!l.title){delete l.title}if(s!==undefined){var h=s;if(((i=(r=l.encode)===null||r===void 0?void 0:r.labels)===null||i===void 0?void 0:i.update)&&isSignalRef(l.encode.labels.update.text)){h=replaceAll(s,"datum.label",l.encode.labels.update.text.signal)}setLegendEncode(l,"labels","text",{signal:h})}return l}function assembleProjections(e){if(isLayerModel(e)||isConcatModel(e)){return assembleProjectionsForModelAndChildren(e)}else{return assembleProjectionForModel(e)}}function assembleProjectionsForModelAndChildren(e){return e.children.reduce((function(e,t){return e.concat(t.assembleProjections())}),assembleProjectionForModel(e))}function assembleProjectionForModel(e){var t=e.component.projection;if(!t||t.merged){return[]}var n=t.combine();var r=n.name;if(!t.data){return[__assign(__assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}else{var i={signal:"["+t.size.map((function(e){return e.signal})).join(", ")+"]"};var a=t.data.reduce((function(t,n){var r=isSignalRef(n)?n.signal:"data('"+e.lookupDataSource(n)+"')";if(!contains(t,r)){t.push(r)}return t}),[]);if(a.length<=0){throw new Error("Projection's fit didn't find any data sources")}return[__assign({name:r,size:i,fit:{signal:a.length>1?"["+a.join(", ")+"]":a[0]}},n)]}}var PROJECTION_PROPERTIES=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];var ProjectionComponent=function(e){__extends(t,e);function t(t,n,r,i){var a=e.call(this,__assign({},n),{name:t})||this;a.specifiedProjection=n;a.size=r;a.data=i;a.merged=false;return a}Object.defineProperty(t.prototype,"isFit",{get:function(){return!!this.data},enumerable:false,configurable:true});return t}(Split);function parseProjection(e){e.component.projection=isUnitModel(e)?parseUnitProjection(e):parseNonUnitProjections(e)}function parseUnitProjection(e){var t;if(e.hasProjection){var n=replaceExprRef(e.specifiedProjection);var r=!(n&&(n.scale!=null||n.translate!=null));var i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:undefined;var a=r?gatherFitData(e):undefined;var o=new ProjectionComponent(e.projectionName(true),__assign(__assign({},(t=replaceExprRef(e.config.projection))!==null&&t!==void 0?t:{}),n!==null&&n!==void 0?n:{}),i,a);if(!o.get("type")){o.set("type","equalEarth",false)}return o}return undefined}function gatherFitData(e){var t=[];var n=e.encoding;for(var r=0,i=[[LONGITUDE,LATITUDE],[LONGITUDE2,LATITUDE2]];r<i.length;r++){var a=i[r];if(getFieldOrDatumDef(n[a[0]])||getFieldOrDatumDef(n[a[1]])){t.push({signal:e.getName("geojson_"+t.length)})}}if(e.channelHasField(SHAPE)&&e.typedFieldDef(SHAPE).type===GEOJSON){t.push({signal:e.getName("geojson_"+t.length)})}if(t.length===0){t.push(e.requestDataName(DataSourceType.Main))}return t}function mergeIfNoConflict(e,t){var n=every(PROJECTION_PROPERTIES,(function(n){if(!has$1(e.explicit,n)&&!has$1(t.explicit,n)){return true}if(has$1(e.explicit,n)&&has$1(t.explicit,n)&&deepEqual(e.get(n),t.get(n))){return true}return false}));var r=deepEqual(e.size,t.size);if(r){if(n){return e}else if(deepEqual(e.explicit,{})){return t}else if(deepEqual(t.explicit,{})){return e}}return null}function parseNonUnitProjections(e){var t;if(e.children.length===0){return undefined}var n;for(var r=0,i=e.children;r<i.length;r++){var a=i[r];parseProjection(a)}var o=every(e.children,(function(e){var t=e.component.projection;if(!t){return true}else if(!n){n=t;return true}else{var r=mergeIfNoConflict(n,t);if(r){n=r}return!!r}}));if(n&&o){var s=e.projectionName(true);var u=new ProjectionComponent(s,n.specifiedProjection,n.size,duplicate(n.data));for(var l=0,f=e.children;l<f.length;l++){var a=f[l];var c=a.component.projection;if(c){if(c.isFit){(t=u.data).push.apply(t,a.component.projection.data)}a.renameProjection(c.get("name"),s);c.merged=true}}return u}return undefined}function rangeFormula(e,t,n,r){var i,a;if(binRequiresRange(t,n)){var o=isUnitModel(e)?(a=(i=e.axis(n))!==null&&i!==void 0?i:e.legend(n))!==null&&a!==void 0?a:{}:{};var s=vgField(t,{expr:"datum"});var u=vgField(t,{expr:"datum",binSuffix:"end"});return{formulaAs:vgField(t,{binSuffix:"range",forAs:true}),formula:binFormatExpression(s,u,o.format,o.formatType,r)}}return{}}function binKey(e,t){return binToString(e)+"_"+t}function getSignalsFromModel(e,t){return{signal:e.getName(t+"_bins"),extentSignal:e.getName(t+"_extent")}}function getBinSignalName(e,t,n){var r;var i=(r=normalizeBin(n,undefined))!==null&&r!==void 0?r:{};var a=binKey(i,t);return e.getName(a+"_bins")}function isBinTransform(e){return"as"in e}function createBinComponent(e,t,n){var r;var i;if(isBinTransform(e)){r=isString(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]}else{r=[vgField(e,{forAs:true}),vgField(e,{binSuffix:"end",forAs:true})]}var a=__assign({},normalizeBin(t,undefined));var o=binKey(a,e.field);var s=getSignalsFromModel(n,o),u=s.signal,l=s.extentSignal;if(isParameterExtent(a.extent)){var f=a.extent;i=parseSelectionExtent(n,f.param,f);delete a.extent}var c=__assign(__assign(__assign({bin:a,field:e.field,as:[r]},u?{signal:u}:{}),l?{extentSignal:l}:{}),i?{span:i}:{});return{key:o,binComponent:c}}var BinNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.bins=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this.bins))};t.makeFromEncoding=function(e,n){var r=n.reduceFieldDef((function(e,t,r){if(isTypedFieldDef(t)&&isBinning(t.bin)){var i=createBinComponent(t,t.bin,n),a=i.key,o=i.binComponent;e[a]=__assign(__assign(__assign({},o),e[a]),rangeFormula(n,t,r,n.config))}return e}),{});if(isEmpty(r)){return null}return new t(e,r)};t.makeFromTransform=function(e,n,r){var i;var a=createBinComponent(n,n.bin,r),o=a.key,s=a.binComponent;return new t(e,(i={},i[o]=s,i))};t.prototype.merge=function(e,t){for(var n=0,r=keys$1(e.bins);n<r.length;n++){var i=r[n];if(i in this.bins){t(e.bins[i].signal,this.bins[i].signal);this.bins[i].as=unique(__spreadArray(__spreadArray([],this.bins[i].as),e.bins[i].as),hash)}else{this.bins[i]=e.bins[i]}}for(var a=0,o=e.children;a<o.length;a++){var s=o[a];e.removeChild(s);s.parent=this}e.remove()};t.prototype.producedFields=function(){return new Set(vals(this.bins).map((function(e){return e.as})).flat(2))};t.prototype.dependentFields=function(){return new Set(vals(this.bins).map((function(e){return e.field})))};t.prototype.hash=function(){return"Bin "+hash(this.bins)};t.prototype.assemble=function(){return vals(this.bins).flatMap((function(e){var t=[];var n=e.as,r=n[0],i=n.slice(1);var a=e.bin,o=a.extent,s=__rest(a,["extent"]);var u=__assign(__assign(__assign({type:"bin",field:replacePathInField(e.field),as:r,signal:e.signal},!isParameterExtent(o)?{extent:o}:{extent:null}),e.span?{span:{signal:"span("+e.span+")"}}:{}),s);if(!o&&e.extentSignal){t.push({type:"extent",field:replacePathInField(e.field),signal:e.extentSignal});u.extent={signal:e.extentSignal}}t.push(u);for(var l=0,f=i;l<f.length;l++){var c=f[l];for(var d=0;d<2;d++){t.push({type:"formula",expr:vgField({field:r[d]},{expr:"datum"}),as:c[d]})}}if(e.formula){t.push({type:"formula",expr:e.formula,as:e.formulaAs})}return t}))};return t}(DataFlowNode);function addDimension(e,t,n,r){var i=isUnitModel(r)?r.encoding[getSecondaryRangeChannel(t)]:undefined;if(isTypedFieldDef(n)&&isUnitModel(r)&&hasBandEnd(n,i,r.markDef,r.config)){e.add(vgField(n,{}));e.add(vgField(n,{suffix:"end"}));if(n.bin&&binRequiresRange(n,t)){e.add(vgField(n,{binSuffix:"range"}))}}else if(isGeoPositionChannel(t)){var a=getPositionChannelFromLatLong(t);e.add(r.getName(a))}else{e.add(vgField(n))}return e}function mergeMeasures(e,t){var n;var r;for(var i=0,a=keys$1(t);i<a.length;i++){var o=a[i];var s=t[o];for(var u=0,l=keys$1(s);u<l.length;u++){var f=l[u];if(o in e){e[o][f]=new Set(__spreadArray(__spreadArray([],(r=e[o][f])!==null&&r!==void 0?r:[]),s[f]))}else{e[o]=(n={},n[f]=s[f],n)}}}}var AggregateNode=function(e){__extends(t,e);function t(t,n,r){var i=e.call(this,t)||this;i.dimensions=n;i.measures=r;return i}t.prototype.clone=function(){return new t(null,new Set(this.dimensions),duplicate(this.measures))};Object.defineProperty(t.prototype,"groupBy",{get:function(){return this.dimensions},enumerable:false,configurable:true});t.makeFromEncoding=function(e,n){var r=false;n.forEachFieldDef((function(e){if(e.aggregate){r=true}}));var i={};var a=new Set;if(!r){return null}n.forEachFieldDef((function(e,t){var r,o,s,u;var l=e.aggregate,f=e.field;if(l){if(l==="count"){(r=i["*"])!==null&&r!==void 0?r:i["*"]={};i["*"]["count"]=new Set([vgField(e,{forAs:true})])}else{if(isArgminDef(l)||isArgmaxDef(l)){var c=isArgminDef(l)?"argmin":"argmax";var d=l[c];(o=i[d])!==null&&o!==void 0?o:i[d]={};i[d][c]=new Set([vgField({op:c,field:d},{forAs:true})])}else{(s=i[f])!==null&&s!==void 0?s:i[f]={};i[f][l]=new Set([vgField(e,{forAs:true})])}if(isScaleChannel(t)&&n.scaleDomain(t)==="unaggregated"){(u=i[f])!==null&&u!==void 0?u:i[f]={};i[f]["min"]=new Set([vgField({field:f,aggregate:"min"},{forAs:true})]);i[f]["max"]=new Set([vgField({field:f,aggregate:"max"},{forAs:true})])}}}else{addDimension(a,t,e,n)}}));if(a.size+keys$1(i).length===0){return null}return new t(e,a,i)};t.makeFromTransform=function(e,n){var r,i,a;var o=new Set;var s={};for(var u=0,l=n.aggregate;u<l.length;u++){var f=l[u];var c=f.op,d=f.field,p=f.as;if(c){if(c==="count"){(r=s["*"])!==null&&r!==void 0?r:s["*"]={};s["*"]["count"]=new Set([p?p:vgField(f,{forAs:true})])}else{(i=s[d])!==null&&i!==void 0?i:s[d]={};s[d][c]=new Set([p?p:vgField(f,{forAs:true})])}}}for(var h=0,g=(a=n.groupby)!==null&&a!==void 0?a:[];h<g.length;h++){var f=g[h];o.add(f)}if(o.size+keys$1(s).length===0){return null}return new t(e,o,s)};t.prototype.merge=function(e){if(setEqual(this.dimensions,e.dimensions)){mergeMeasures(this.measures,e.measures);return true}else{debug("different dimensions, cannot merge");return false}};t.prototype.addDimensions=function(e){e.forEach(this.dimensions.add,this.dimensions)};t.prototype.dependentFields=function(){return new Set(__spreadArray(__spreadArray([],this.dimensions),keys$1(this.measures)))};t.prototype.producedFields=function(){var e=new Set;for(var t=0,n=keys$1(this.measures);t<n.length;t++){var r=n[t];for(var i=0,a=keys$1(this.measures[r]);i<a.length;i++){var o=a[i];var s=this.measures[r][o];if(s.size===0){e.add(o+"_"+r)}else{s.forEach(e.add,e)}}}return e};t.prototype.hash=function(){return"Aggregate "+hash({dimensions:this.dimensions,measures:this.measures})};t.prototype.assemble=function(){var e=[];var t=[];var n=[];for(var r=0,i=keys$1(this.measures);r<i.length;r++){var a=i[r];for(var o=0,s=keys$1(this.measures[a]);o<s.length;o++){var u=s[o];for(var l=0,f=this.measures[a][u];l<f.length;l++){var c=f[l];n.push(c);e.push(u);t.push(a==="*"?null:replacePathInField(a))}}}var d={type:"aggregate",groupby:__spreadArray([],this.dimensions).map(replacePathInField),ops:e,fields:t,as:n};return d};return t}(DataFlowNode);var FacetNode=function(e){__extends(t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.model=n;a.name=r;a.data=i;for(var o=0,s=FACET_CHANNELS;o<s.length;o++){var u=s[o];var l=n.facet[u];if(l){var f=l.bin,c=l.sort;a[u]=__assign({name:n.getName(u+"_domain"),fields:__spreadArray([vgField(l)],isBinning(f)?[vgField(l,{binSuffix:"end"})]:[])},isSortField(c)?{sortField:c}:isArray(c)?{sortIndexField:sortArrayIndexField(l,u)}:{})}}a.childModel=n.child;return a}t.prototype.hash=function(){var e="Facet";for(var t=0,n=FACET_CHANNELS;t<n.length;t++){var r=n[t];if(this[r]){e+=" "+r.charAt(0)+":"+hash(this[r])}}return e};Object.defineProperty(t.prototype,"fields",{get:function(){var e;var t=[];for(var n=0,r=FACET_CHANNELS;n<r.length;n++){var i=r[n];if((e=this[i])===null||e===void 0?void 0:e.fields){t.push.apply(t,this[i].fields)}}return t},enumerable:false,configurable:true});t.prototype.dependentFields=function(){var e=new Set(this.fields);for(var t=0,n=FACET_CHANNELS;t<n.length;t++){var r=n[t];if(this[r]){if(this[r].sortField){e.add(this[r].sortField.field)}if(this[r].sortIndexField){e.add(this[r].sortIndexField)}}}return e};t.prototype.producedFields=function(){return new Set};t.prototype.getSource=function(){return this.name};t.prototype.getChildIndependentFieldsWithStep=function(){var e={};for(var t=0,n=POSITION_SCALE_CHANNELS;t<n.length;t++){var r=n[t];var i=this.childModel.component.scales[r];if(i&&!i.merged){var a=i.get("type");var o=i.get("range");if(hasDiscreteDomain(a)&&isVgRangeStep(o)){var s=assembleDomain(this.childModel,r);var u=getFieldFromDomain(s);if(u){e[r]=u}else{warn(unknownField(r))}}}}return e};t.prototype.assembleRowColumnHeaderData=function(e,t,n){var r={row:"y",column:"x",facet:undefined}[e];var i=[];var a=[];var o=[];if(r&&n&&n[r]){if(t){i.push("distinct_"+n[r]);a.push("max")}else{i.push(n[r]);a.push("distinct")}o.push("distinct_"+n[r])}var s=this[e],u=s.sortField,l=s.sortIndexField;if(u){var f=u.op,c=f===void 0?DEFAULT_SORT_OP:f,d=u.field;i.push(d);a.push(c);o.push(vgField(u,{forAs:true}))}else if(l){i.push(l);a.push("max");o.push(l)}return{name:this[e].name,source:t!==null&&t!==void 0?t:this.data,transform:[__assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}};t.prototype.assembleFacetHeaderData=function(e){var t,n;var r=this.model.layout.columns;var i=this.model.component.layoutHeaders;var a=[];var o={};for(var s=0,u=HEADER_CHANNELS;s<u.length;s++){var l=u[s];for(var f=0,c=HEADER_TYPES;f<c.length;f++){var d=c[f];var p=(t=i[l]&&i[l][d])!==null&&t!==void 0?t:[];for(var h=0,g=p;h<g.length;h++){var m=g[h];if(((n=m.axes)===null||n===void 0?void 0:n.length)>0){o[l]=true;break}}}if(o[l]){var v='length(data("'+this.facet.name+'"))';var y=l==="row"?r?{signal:"ceil("+v+" / "+r+")"}:1:r?{signal:"min("+v+", "+r+")"}:{signal:v};a.push({name:this.facet.name+"_"+l,transform:[{type:"sequence",start:0,stop:y}]})}}var _=o.row,b=o.column;if(_||b){a.unshift(this.assembleRowColumnHeaderData("facet",null,e))}return a};t.prototype.assemble=function(){var e,t;var n=[];var r=null;var i=this.getChildIndependentFieldsWithStep();var a=this,o=a.column,s=a.row,u=a.facet;if(o&&s&&(i.x||i.y)){r="cross_"+this.column.name+"_"+this.row.name;var l=[].concat((e=i.x)!==null&&e!==void 0?e:[],(t=i.y)!==null&&t!==void 0?t:[]);var f=l.map((function(){return"distinct"}));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:f}]})}for(var c=0,d=[COLUMN,ROW];c<d.length;c++){var p=d[c];if(this[p]){n.push(this.assembleRowColumnHeaderData(p,r,i))}}if(u){var h=this.assembleFacetHeaderData(i);if(h){n.push.apply(n,h)}}return n};return t}(DataFlowNode);function unquote(e){if(e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'){return e.slice(1,-1)}return e}function parseExpression(e,t){var n=accessPathWithDatum(e);if(t==="number"){return"toNumber("+n+")"}else if(t==="boolean"){return"toBoolean("+n+")"}else if(t==="string"){return"toString("+n+")"}else if(t==="date"){return"toDate("+n+")"}else if(t==="flatten"){return n}else if(t.startsWith("date:")){var r=unquote(t.slice(5,t.length));return"timeParse("+n+",'"+r+"')"}else if(t.startsWith("utc:")){var r=unquote(t.slice(4,t.length));return"utcParse("+n+",'"+r+"')"}else{warn(unrecognizedParse(t));return null}}function getImplicitFromFilterTransform(e){var t={};forEachLeaf(e.filter,(function(e){var n;if(isFieldPredicate(e)){var r=null;if(isFieldEqualPredicate(e)){r=signalRefOrValue(e.equal)}else if(isFieldLTEPredicate(e)){r=signalRefOrValue(e.lte)}else if(isFieldLTPredicate(e)){r=signalRefOrValue(e.lt)}else if(isFieldGTPredicate(e)){r=signalRefOrValue(e.gt)}else if(isFieldGTEPredicate(e)){r=signalRefOrValue(e.gte)}else if(isFieldRangePredicate(e)){r=e.range[0]}else if(isFieldOneOfPredicate(e)){r=((n=e.oneOf)!==null&&n!==void 0?n:e["in"])[0]}if(r){if(isDateTime(r)){t[e.field]="date"}else if(isNumber$1(r)){t[e.field]="number"}else if(isString(r)){t[e.field]="string"}}if(e.timeUnit){t[e.field]="date"}}}));return t}function getImplicitFromEncoding(e){var t={};function n(e){if(isFieldOrDatumDefForTimeFormat(e)){t[e.field]="date"}else if(e.type==="quantitative"&&isMinMaxOp(e.aggregate)){t[e.field]="number"}else if(accessPathDepth(e.field)>1){if(!(e.field in t)){t[e.field]="flatten"}}else if(isScaleFieldDef(e)&&isSortField(e.sort)&&accessPathDepth(e.sort.field)>1){if(!(e.sort.field in t)){t[e.sort.field]="flatten"}}}if(isUnitModel(e)||isFacetModel(e)){e.forEachFieldDef((function(t,r){if(isTypedFieldDef(t)){n(t)}else{var i=getMainRangeChannel(r);var a=e.fieldDef(i);n(__assign(__assign({},t),{type:a.type}))}}))}if(isUnitModel(e)){var r=e.mark,i=e.markDef,a=e.encoding;if(isPathMark(r)&&!e.encoding.order){var o=i.orient==="horizontal"?"y":"x";var s=a[o];if(isFieldDef(s)&&s.type==="quantitative"&&!(s.field in t)){t[s.field]="number"}}}return t}function getImplicitFromSelection(e){var t={};if(isUnitModel(e)&&e.component.selection){for(var n=0,r=keys$1(e.component.selection);n<r.length;n++){var i=r[n];var a=e.component.selection[i];for(var o=0,s=a.project.items;o<s.length;o++){var u=s[o];if(!u.channel&&accessPathDepth(u.field)>1){t[u.field]="flatten"}}}}return t}var ParseNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r._parse=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this._parse))};t.prototype.hash=function(){return"Parse "+hash(this._parse)};t.makeExplicit=function(e,t,n){var r={};var i=t.data;if(!isGenerator(i)&&i&&i.format&&i.format.parse){r=i.format.parse}return this.makeWithAncestors(e,r,{},n)};t.makeWithAncestors=function(e,n,r,i){for(var a=0,o=keys$1(r);a<o.length;a++){var s=o[a];var u=i.getWithExplicit(s);if(u.value!==undefined){if(u.explicit||u.value===r[s]||u.value==="derived"||r[s]==="flatten"){delete r[s]}else{warn(differentParse(s,r[s],u.value))}}}for(var l=0,f=keys$1(n);l<f.length;l++){var c=f[l];var u=i.get(c);if(u!==undefined){if(u===n[c]){delete n[c]}else{warn(differentParse(c,n[c],u))}}}var d=new Split(n,r);i.copyAll(d);var p={};for(var h=0,g=keys$1(d.combine());h<g.length;h++){var m=g[h];var v=d.get(m);if(v!==null){p[m]=v}}if(keys$1(p).length===0||i.parseNothing){return null}return new t(e,p)};Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:false,configurable:true});t.prototype.merge=function(e){this._parse=__assign(__assign({},this._parse),e.parse);e.remove()};t.prototype.assembleFormatParse=function(){var e={};for(var t=0,n=keys$1(this._parse);t<n.length;t++){var r=n[t];var i=this._parse[r];if(accessPathDepth(r)===1){e[r]=i}}return e};t.prototype.producedFields=function(){return new Set(keys$1(this._parse))};t.prototype.dependentFields=function(){return new Set(keys$1(this._parse))};t.prototype.assembleTransforms=function(e){var t=this;if(e===void 0){e=false}return keys$1(this._parse).filter((function(t){return e?accessPathDepth(t)>1:true})).map((function(e){var n=parseExpression(e,t._parse[e]);if(!n){return null}var r={type:"formula",expr:n,as:removePathFromField(e)};return r})).filter((function(e){return e!==null}))};return t}(DataFlowNode);var IdentifierNode=function(e){__extends(t,e);function t(t){return e.call(this,t)||this}t.prototype.clone=function(){return new t(null)};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return new Set([SELECTION_ID])};t.prototype.hash=function(){return"Identifier"};t.prototype.assemble=function(){return{type:"identifier",as:SELECTION_ID}};return t}(DataFlowNode);var GraticuleNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.params=n;return r}t.prototype.clone=function(){return new t(null,this.params)};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return undefined};t.prototype.hash=function(){return"Graticule "+hash(this.params)};t.prototype.assemble=function(){return __assign({type:"graticule"},this.params===true?{}:this.params)};return t}(DataFlowNode);var SequenceNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.params=n;return r}t.prototype.clone=function(){return new t(null,this.params)};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){var e;return new Set([(e=this.params.as)!==null&&e!==void 0?e:"data"])};t.prototype.hash=function(){return"Hash "+hash(this.params)};t.prototype.assemble=function(){return __assign({type:"sequence"},this.params)};return t}(DataFlowNode);var SourceNode=function(e){__extends(t,e);function t(t){var n=e.call(this,null)||this;t!==null&&t!==void 0?t:t={name:"source"};var r;if(!isGenerator(t)){r=t.format?__assign({},omit(t.format,["parse"])):{}}if(isInlineData(t)){n._data={values:t.values}}else if(isUrlData(t)){n._data={url:t.url};if(!r.type){var i=/(?:\.([^.]+))?$/.exec(t.url)[1];if(!contains(["json","csv","tsv","dsv","topojson"],i)){i="json"}r.type=i}}else if(isSphereGenerator(t)){n._data={values:[{type:"Sphere"}]}}else if(isNamedData(t)||isGenerator(t)){n._data={}}n._generator=isGenerator(t);if(t.name){n._name=t.name}if(r&&!isEmpty(r)){n._data.format=r}return n}t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return undefined};Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:false,configurable:true});t.prototype.hasName=function(){return!!this._name};Object.defineProperty(t.prototype,"isGenerator",{get:function(){return this._generator},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:false,configurable:true});t.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")};t.prototype.hash=function(){throw new Error("Cannot hash sources")};t.prototype.assemble=function(){return __assign(__assign({name:this._name},this._data),{transform:[]})};return t}(DataFlowNode);var __classPrivateFieldSet=undefined&&undefined.__classPrivateFieldSet||function(e,t,n){if(!t.has(e)){throw new TypeError("attempted to set private field on non-instance")}t.set(e,n);return n};var __classPrivateFieldGet=undefined&&undefined.__classPrivateFieldGet||function(e,t){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return t.get(e)};var _modified;function isDataSourceNode(e){return e instanceof SourceNode||e instanceof GraticuleNode||e instanceof SequenceNode}var Optimizer=function(){function e(){_modified.set(this,void 0);__classPrivateFieldSet(this,_modified,false)}e.prototype.setModified=function(){__classPrivateFieldSet(this,_modified,true)};Object.defineProperty(e.prototype,"modifiedFlag",{get:function(){return __classPrivateFieldGet(this,_modified)},enumerable:false,configurable:true});return e}();_modified=new WeakMap;var BottomUpOptimizer=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getNodeDepths=function(e,t,n){n.set(e,t);for(var r=0,i=e.children;r<i.length;r++){var a=i[r];this.getNodeDepths(a,t+1,n)}return n};t.prototype.optimize=function(e){var t=this.getNodeDepths(e,0,new Map);var n=__spreadArray([],t.entries()).sort((function(e,t){return t[1]-e[1]}));for(var r=0,i=n;r<i.length;r++){var a=i[r];this.run(a[0])}return this.modifiedFlag};return t}(Optimizer);var TopDownOptimizer=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.optimize=function(e){this.run(e);for(var t=0,n=e.children;t<n.length;t++){var r=n[t];this.optimize(r)}return this.modifiedFlag};return t}(Optimizer);var MergeIdenticalNodes=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.mergeNodes=function(e,t){var n=t.shift();for(var r=0,i=t;r<i.length;r++){var a=i[r];e.removeChild(a);a.parent=n;a.remove()}};t.prototype.run=function(e){var t=e.children.map((function(e){return e.hash()}));var n={};for(var r=0;r<t.length;r++){if(n[t[r]]===undefined){n[t[r]]=[e.children[r]]}else{n[t[r]].push(e.children[r])}}for(var i=0,a=keys$1(n);i<a.length;i++){var o=a[i];if(n[o].length>1){this.setModified();this.mergeNodes(e,n[o])}}};return t}(TopDownOptimizer);var RemoveUnnecessaryIdentifierNodes=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.requiresSelectionId=t&&requiresSelectionId(t);return n}t.prototype.run=function(e){if(e instanceof IdentifierNode){if(!(this.requiresSelectionId&&(isDataSourceNode(e.parent)||e.parent instanceof AggregateNode||e.parent instanceof ParseNode))){this.setModified();e.remove()}}};return t}(TopDownOptimizer);var RemoveDuplicateTimeUnits=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.optimize=function(e){this.run(e,new Set);return this.modifiedFlag};t.prototype.run=function(e,t){var n=new Set;if(e instanceof TimeUnitNode){n=e.producedFields();if(hasIntersection(n,t)){this.setModified();e.removeFormulas(t);if(e.producedFields.length===0){e.remove()}}}for(var r=0,i=e.children;r<i.length;r++){var a=i[r];this.run(a,new Set(__spreadArray(__spreadArray([],t),n)))}};return t}(Optimizer);var RemoveUnnecessaryOutputNodes=function(e){__extends(t,e);function t(){return e.call(this)||this}t.prototype.run=function(e){if(e instanceof OutputNode&&!e.isRequired()){this.setModified();e.remove()}};return t}(TopDownOptimizer);var MoveParseUp=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){if(isDataSourceNode(e)){return}if(e.numChildren()>1){return}for(var t=0,n=e.children;t<n.length;t++){var r=n[t];if(r instanceof ParseNode){if(e instanceof ParseNode){this.setModified();e.merge(r)}else{if(fieldIntersection(e.producedFields(),r.dependentFields())){continue}this.setModified();r.swapWithParent()}}}return};return t}(BottomUpOptimizer);var MergeParse=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){var t=__spreadArray([],e.children);var n=e.children.filter((function(e){return e instanceof ParseNode}));if(e.numChildren()>1&&n.length>=1){var r={};var i=new Set;for(var a=0,o=n;a<o.length;a++){var s=o[a];var u=s.parse;for(var l=0,f=keys$1(u);l<f.length;l++){var c=f[l];if(!(c in r)){r[c]=u[c]}else if(r[c]!==u[c]){i.add(c)}}}for(var d=0,p=i;d<p.length;d++){var h=p[d];delete r[h]}if(!isEmpty(r)){this.setModified();var g=new ParseNode(e,r);for(var m=0,v=t;m<v.length;m++){var y=v[m];if(y instanceof ParseNode){for(var _=0,b=keys$1(r);_<b.length;_++){var x=b[_];delete y.parse[x]}}e.removeChild(y);y.parent=g;if(y instanceof ParseNode&&keys$1(y.parse).length===0){y.remove()}}}}};return t}(BottomUpOptimizer);var RemoveUnusedSubtrees=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){if(e instanceof OutputNode||e.numChildren()>0||e instanceof FacetNode);else if(e instanceof SourceNode);else{this.setModified();e.remove()}};return t}(BottomUpOptimizer);var MergeTimeUnits=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){var t=e.children.filter((function(e){return e instanceof TimeUnitNode}));var n=t.pop();for(var r=0,i=t;r<i.length;r++){var a=i[r];this.setModified();n.merge(a)}};return t}(BottomUpOptimizer);var MergeAggregates=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){var t=e.children.filter((function(e){return e instanceof AggregateNode}));var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];var o=hash(a.groupBy);if(!(o in n)){n[o]=[]}n[o].push(a)}for(var s=0,u=keys$1(n);s<u.length;s++){var l=u[s];var f=n[l];if(f.length>1){var c=f.pop();for(var d=0,p=f;d<p.length;d++){var a=p[d];if(c.merge(a)){e.removeChild(a);a.parent=c;a.remove();this.setModified()}}}}};return t}(BottomUpOptimizer);var MergeBins=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.model=t;return n}t.prototype.run=function(e){var t=!(isDataSourceNode(e)||e instanceof FilterNode||e instanceof ParseNode||e instanceof IdentifierNode);var n=[];var r=[];for(var i=0,a=e.children;i<a.length;i++){var o=a[i];if(o instanceof BinNode){if(t&&!fieldIntersection(e.producedFields(),o.dependentFields())){n.push(o)}else{r.push(o)}}}if(n.length>0){var s=n.pop();for(var u=0,l=n;u<l.length;u++){var f=l[u];s.merge(f,this.model.renameSignal.bind(this.model))}this.setModified();if(e instanceof BinNode){e.merge(s,this.model.renameSignal.bind(this.model))}else{s.swapWithParent()}}if(r.length>1){var c=r.pop();for(var d=0,p=r;d<p.length;d++){var h=p[d];c.merge(h,this.model.renameSignal.bind(this.model))}this.setModified()}};return t}(BottomUpOptimizer);var MergeOutputs=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(e){var t=__spreadArray([],e.children);var n=some(t,(function(e){return e instanceof OutputNode}));if(!n||e.numChildren()<=1){return}var r=[];var i;for(var a=0,o=t;a<o.length;a++){var s=o[a];if(s instanceof OutputNode){var u=s;while(u.numChildren()===1){var l=u.children[0];if(l instanceof OutputNode){u=l}else{break}}r.push.apply(r,u.children);if(i){e.removeChild(s);s.parent=i.parent;i.parent.removeChild(i);i.parent=u;this.setModified()}else{i=u}}else{r.push(s)}}if(r.length){this.setModified();for(var f=0,c=r;f<c.length;f++){var s=c[f];s.parent.removeChild(s);s.parent=i}}};return t}(BottomUpOptimizer);var JoinAggregateTransformNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.addDimensions=function(e){this.transform.groupby=unique(this.transform.groupby.concat(e),(function(e){return e}))};t.prototype.dependentFields=function(){var e=new Set;if(this.transform.groupby){this.transform.groupby.forEach(e.add,e)}this.transform.joinaggregate.map((function(e){return e.field})).filter((function(e){return e!==undefined})).forEach(e.add,e);return e};t.prototype.producedFields=function(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))};t.prototype.getDefaultName=function(e){var t;return(t=e.as)!==null&&t!==void 0?t:vgField(e)};t.prototype.hash=function(){return"JoinAggregateTransform "+hash(this.transform)};t.prototype.assemble=function(){var e=[];var t=[];var n=[];for(var r=0,i=this.transform.joinaggregate;r<i.length;r++){var a=i[r];t.push(a.op);n.push(this.getDefaultName(a));e.push(a.field===undefined?null:a.field)}var o=this.transform.groupby;return __assign({type:"joinaggregate",as:n,ops:t,fields:e},o!==undefined?{groupby:o}:{})};return t}(DataFlowNode);function getStackByFields(e){return e.stack.stackBy.reduce((function(e,t){var n=t.fieldDef;var r=vgField(n);if(r){e.push(r)}return e}),[])}function isValidAsArray(e){return isArray(e)&&e.every((function(e){return isString(e)}))&&e.length>1}var StackNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r._stack=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this._stack))};t.makeFromTransform=function(e,n){var r=n.stack,i=n.groupby,a=n.as,o=n.offset,s=o===void 0?"zero":o;var u=[];var l=[];if(n.sort!==undefined){for(var f=0,c=n.sort;f<c.length;f++){var d=c[f];u.push(d.field);l.push(getFirstDefined(d.order,"ascending"))}}var p={field:u,order:l};var h;if(isValidAsArray(a)){h=a}else if(isString(a)){h=[a,a+"_end"]}else{h=[n.stack+"_start",n.stack+"_end"]}return new t(e,{stackField:r,groupby:i,offset:s,sort:p,facetby:[],as:h})};t.makeFromEncoding=function(e,n){var r=n.stack;var i=n.encoding;if(!r){return null}var a=r.groupbyChannel,o=r.fieldChannel,s=r.offset,u=r.impute;var l;if(a){var f=i[a];l=getFieldDef(f)}var c=getStackByFields(n);var d=n.encoding.order;var p;if(isArray(d)||isFieldDef(d)){p=sortParams(d)}else{p=c.reduce((function(e,t){e.field.push(t);e.order.push(o==="y"?"descending":"ascending");return e}),{field:[],order:[]})}return new t(e,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:c,sort:p,offset:s,impute:u,as:[n.vgField(o,{suffix:"start",forAs:true}),n.vgField(o,{suffix:"end",forAs:true})]})};Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:false,configurable:true});t.prototype.addDimensions=function(e){var t;(t=this._stack.facetby).push.apply(t,e)};t.prototype.dependentFields=function(){var e=new Set;e.add(this._stack.stackField);this.getGroupbyFields().forEach(e.add,e);this._stack.facetby.forEach(e.add,e);this._stack.sort.field.forEach(e.add,e);return e};t.prototype.producedFields=function(){return new Set(this._stack.as)};t.prototype.hash=function(){return"Stack "+hash(this._stack)};t.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute,r=e.groupby;if(t){if(t.bin){if(n){return[vgField(t,{binSuffix:"mid"})]}return[vgField(t,{}),vgField(t,{binSuffix:"end"})]}return[vgField(t)]}return r!==null&&r!==void 0?r:[]};t.prototype.assemble=function(){var e=[];var t=this._stack,n=t.facetby,r=t.dimensionFieldDef,i=t.stackField,a=t.stackby,o=t.sort,s=t.offset,u=t.impute,l=t.as;if(u&&r){var f=r.bandPosition,c=f===void 0?.5:f,d=r.bin;if(d){e.push({type:"formula",expr:c+"*"+vgField(r,{expr:"datum"})+("+"+(1-c)+"*")+vgField(r,{expr:"datum",binSuffix:"end"}),as:vgField(r,{binSuffix:"mid",forAs:true})})}e.push({type:"impute",field:i,groupby:__spreadArray(__spreadArray([],a),n),key:vgField(r,{binSuffix:"mid"}),method:"value",value:0})}e.push({type:"stack",groupby:__spreadArray(__spreadArray([],this.getGroupbyFields()),n),field:i,sort:o,as:l,offset:s});return e};return t}(DataFlowNode);var WindowTransformNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.addDimensions=function(e){this.transform.groupby=unique(this.transform.groupby.concat(e),(function(e){return e}))};t.prototype.dependentFields=function(){var e,t;var n=new Set;((e=this.transform.groupby)!==null&&e!==void 0?e:[]).forEach(n.add,n);((t=this.transform.sort)!==null&&t!==void 0?t:[]).forEach((function(e){return n.add(e.field)}));this.transform.window.map((function(e){return e.field})).filter((function(e){return e!==undefined})).forEach(n.add,n);return n};t.prototype.producedFields=function(){return new Set(this.transform.window.map(this.getDefaultName))};t.prototype.getDefaultName=function(e){var t;return(t=e.as)!==null&&t!==void 0?t:vgField(e)};t.prototype.hash=function(){return"WindowTransform "+hash(this.transform)};t.prototype.assemble=function(){var e;var t=[];var n=[];var r=[];var i=[];for(var a=0,o=this.transform.window;a<o.length;a++){var s=o[a];n.push(s.op);r.push(this.getDefaultName(s));i.push(s.param===undefined?null:s.param);t.push(s.field===undefined?null:s.field)}var u=this.transform.frame;var l=this.transform.groupby;if(u&&u[0]===null&&u[1]===null&&n.every((function(e){return isAggregateOp(e)}))){return __assign({type:"joinaggregate",as:r,ops:n,fields:t},l!==undefined?{groupby:l}:{})}var f=[];var c=[];if(this.transform.sort!==undefined){for(var d=0,p=this.transform.sort;d<p.length;d++){var h=p[d];f.push(h.field);c.push((e=h.order)!==null&&e!==void 0?e:"ascending")}}var g={field:f,order:c};var m=this.transform.ignorePeers;return __assign(__assign(__assign({type:"window",params:i,as:r,ops:n,fields:t,sort:g},m!==undefined?{ignorePeers:m}:{}),l!==undefined?{groupby:l}:{}),u!==undefined?{frame:u}:{})};return t}(DataFlowNode);function cloneSubtree(e){function t(n){if(!(n instanceof FacetNode)){var r=n.clone();if(r instanceof OutputNode){var i=FACET_SCALE_PREFIX+r.getSource();r.setSource(i);e.model.component.data.outputNodes[i]=r}else if(r instanceof AggregateNode||r instanceof StackNode||r instanceof WindowTransformNode||r instanceof JoinAggregateTransformNode){r.addDimensions(e.fields)}for(var a=0,o=n.children.flatMap(t);a<o.length;a++){var s=o[a];s.parent=r}return[r]}return n.children.flatMap(t)}return t}function moveFacetDown(e){if(e instanceof FacetNode){if(e.numChildren()===1&&!(e.children[0]instanceof OutputNode)){var t=e.children[0];if(t instanceof AggregateNode||t instanceof StackNode||t instanceof WindowTransformNode||t instanceof JoinAggregateTransformNode){t.addDimensions(e.fields)}t.swapWithParent();moveFacetDown(e)}else{var n=e.model.component.data.main;moveMainDownToFacet(n);var r=cloneSubtree(e);var i=e.children.map(r).flat();for(var a=0,o=i;a<o.length;a++){var s=o[a];s.parent=n}}}else{e.children.map(moveFacetDown)}}function moveMainDownToFacet(e){if(e instanceof OutputNode&&e.type===DataSourceType.Main){if(e.numChildren()===1){var t=e.children[0];if(!(t instanceof FacetNode)){t.swapWithParent();moveMainDownToFacet(e)}}}}var FACET_SCALE_PREFIX="scale_";var MAX_OPTIMIZATION_RUNS=5;function checkLinks(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];for(var i=0,a=r.children;i<a.length;i++){var o=a[i];if(o.parent!==r){return false}}if(!checkLinks(r.children)){return false}}return true}function runOptimizer(e,t){var n=false;for(var r=0,i=t;r<i.length;r++){var a=i[r];n=e.optimize(a)||n}return n}function optimizationDataflowHelper(e,t,n){var r=e.sources;var i=false;i=runOptimizer(new RemoveUnnecessaryOutputNodes,r)||i;i=runOptimizer(new RemoveUnnecessaryIdentifierNodes(t),r)||i;r=r.filter((function(e){return e.numChildren()>0}));i=runOptimizer(new RemoveUnusedSubtrees,r)||i;r=r.filter((function(e){return e.numChildren()>0}));if(!n){i=runOptimizer(new MoveParseUp,r)||i;i=runOptimizer(new MergeBins(t),r)||i;i=runOptimizer(new RemoveDuplicateTimeUnits,r)||i;i=runOptimizer(new MergeParse,r)||i;i=runOptimizer(new MergeAggregates,r)||i;i=runOptimizer(new MergeTimeUnits,r)||i;i=runOptimizer(new MergeIdenticalNodes,r)||i;i=runOptimizer(new MergeOutputs,r)||i}e.sources=r;return i}function optimizeDataflow(e,t){checkLinks(e.sources);var n=0;var r=0;for(var i=0;i<MAX_OPTIMIZATION_RUNS;i++){if(!optimizationDataflowHelper(e,t,true)){break}n++}e.sources.map(moveFacetDown);for(var i=0;i<MAX_OPTIMIZATION_RUNS;i++){if(!optimizationDataflowHelper(e,t,false)){break}r++}checkLinks(e.sources);if(Math.max(n,r)===MAX_OPTIMIZATION_RUNS){warn("Maximum optimization runs("+MAX_OPTIMIZATION_RUNS+") reached.")}}var SignalRefWrapper=function(){function e(e){Object.defineProperty(this,"signal",{enumerable:true,get:e})}e.fromName=function(t,n){return new e((function(){return t(n)}))};return e}();function parseScaleDomain(e){if(isUnitModel(e)){parseUnitScaleDomain(e)}else{parseNonUnitScaleDomain(e)}}function parseUnitScaleDomain(e){var t=e.component.scales;for(var n=0,r=keys$1(t);n<r.length;n++){var i=r[n];var a=parseDomainForChannel(e,i);var o=t[i];o.setWithExplicit("domains",a);parseSelectionDomain(e,i);if(e.component.data.isFaceted){var s=e;while(!isFacetModel(s)&&s.parent){s=s.parent}var u=s.component.resolve.scale[i];if(u==="shared"){for(var l=0,f=a.value;l<f.length;l++){var c=f[l];if(isDataRefDomain(c)){c.data=FACET_SCALE_PREFIX+c.data.replace(FACET_SCALE_PREFIX,"")}}}}}}function parseNonUnitScaleDomain(e){for(var t=0,n=e.children;t<n.length;t++){var r=n[t];parseScaleDomain(r)}var i=e.component.scales;for(var a=0,o=keys$1(i);a<o.length;a++){var s=o[a];var u=void 0;var l=null;for(var f=0,c=e.children;f<c.length;f++){var r=c[f];var d=r.component.scales[s];if(d){if(u===undefined){u=d.getWithExplicit("domains")}else{u=mergeValuesWithExplicit(u,d.getWithExplicit("domains"),"domains","scale",domainsTieBreaker)}var p=d.get("selectionExtent");if(l&&p&&l.param!==p.param){warn(NEEDS_SAME_SELECTION)}l=p}}i[s].setWithExplicit("domains",u);if(l){i[s].set("selectionExtent",l,true)}}}function normalizeUnaggregatedDomain(e,t,n,r){if(e==="unaggregated"){var i=canUseUnaggregatedDomain(t,n),a=i.valid,o=i.reason;if(!a){warn(o);return undefined}}else if(e===undefined&&r.useUnaggregatedDomain){var s=canUseUnaggregatedDomain(t,n).valid;if(s){return"unaggregated"}}return e}function parseDomainForChannel(e,t){var n=e.getScaleComponent(t).get("type");var r=e.encoding;var i=normalizeUnaggregatedDomain(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);if(i!==e.scaleDomain(t)){e.specifiedScales[t]=__assign(__assign({},e.specifiedScales[t]),{domain:i})}if(t==="x"&&getFieldOrDatumDef(r.x2)){if(getFieldOrDatumDef(r.x)){return mergeValuesWithExplicit(parseSingleChannelDomain(n,i,e,"x"),parseSingleChannelDomain(n,i,e,"x2"),"domain","scale",domainsTieBreaker)}else{return parseSingleChannelDomain(n,i,e,"x2")}}else if(t==="y"&&getFieldOrDatumDef(r.y2)){if(getFieldOrDatumDef(r.y)){return mergeValuesWithExplicit(parseSingleChannelDomain(n,i,e,"y"),parseSingleChannelDomain(n,i,e,"y2"),"domain","scale",domainsTieBreaker)}else{return parseSingleChannelDomain(n,i,e,"y2")}}return parseSingleChannelDomain(n,i,e,t)}function mapDomainToDataSignal(e,t,n){return e.map((function(e){var r=valueExpr(e,{timeUnit:n,type:t});return{signal:"{data: "+r+"}"}}))}function convertDomainIfItIsDateTime(e,t,n){var r;var i=(r=normalizeTimeUnit(n))===null||r===void 0?void 0:r.unit;if(t==="temporal"||i){return mapDomainToDataSignal(e,t,i)}return[e]}function parseSingleChannelDomain(e,t,n,r){var i=n.encoding;var a=getFieldOrDatumDef(i[r]);var o=a.type;var s=a["timeUnit"];if(isDomainUnionWith(t)){var u=parseSingleChannelDomain(e,undefined,n,r);var l=convertDomainIfItIsDateTime(t.unionWith,o,s);return makeExplicit(__spreadArray(__spreadArray([],u.value),l))}else if(isSignalRef(t)){return makeExplicit([t])}else if(t&&t!=="unaggregated"&&!isParameterDomain(t)){return makeExplicit(convertDomainIfItIsDateTime(t,o,s))}var f=n.stack;if(f&&r===f.fieldChannel){if(f.offset==="normalize"){return makeImplicit([[0,1]])}var c=n.requestDataName(DataSourceType.Main);return makeImplicit([{data:c,field:n.vgField(r,{suffix:"start"})},{data:c,field:n.vgField(r,{suffix:"end"})}])}var d=isScaleChannel(r)&&isFieldDef(a)?domainSort(n,r,e):undefined;if(isDatumDef(a)){var p=convertDomainIfItIsDateTime([a.datum],o,s);return makeImplicit(p)}var h=a;if(t==="unaggregated"){var g=n.requestDataName(DataSourceType.Main);var m=a.field;return makeImplicit([{data:g,field:vgField({field:m,aggregate:"min"})},{data:g,field:vgField({field:m,aggregate:"max"})}])}else if(isBinning(h.bin)){if(hasDiscreteDomain(e)){if(e==="bin-ordinal"){return makeImplicit([])}return makeImplicit([{data:isBoolean(d)?n.requestDataName(DataSourceType.Main):n.requestDataName(DataSourceType.Raw),field:n.vgField(r,binRequiresRange(h,r)?{binSuffix:"range"}:{}),sort:d===true||!isObject(d)?{field:n.vgField(r,{}),op:"min"}:d}])}else{var v=h.bin;if(isBinning(v)){var y=getBinSignalName(n,h.field,v);return makeImplicit([new SignalRefWrapper((function(){var e=n.getSignalName(y);return"["+e+".start, "+e+".stop]"}))])}else{return makeImplicit([{data:n.requestDataName(DataSourceType.Main),field:n.vgField(r,{})}])}}}else if(h.timeUnit&&contains(["time","utc"],e)&&hasBandEnd(h,isUnitModel(n)?n.encoding[getSecondaryRangeChannel(r)]:undefined,n.markDef,n.config)){var _=n.requestDataName(DataSourceType.Main);return makeImplicit([{data:_,field:n.vgField(r)},{data:_,field:n.vgField(r,{suffix:"end"})}])}else if(d){return makeImplicit([{data:isBoolean(d)?n.requestDataName(DataSourceType.Main):n.requestDataName(DataSourceType.Raw),field:n.vgField(r),sort:d}])}else{return makeImplicit([{data:n.requestDataName(DataSourceType.Main),field:n.vgField(r)}])}}function normalizeSortField(e,t){var n=e.op,r=e.field,i=e.order;return __assign(__assign({op:n!==null&&n!==void 0?n:t?"sum":DEFAULT_SORT_OP},r?{field:replacePathInField(r)}:{}),i?{order:i}:{})}function parseSelectionDomain(e,t){var n;var r=e.component.scales[t];var i=e.specifiedScales[t].domain;var a=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin;var o=isParameterDomain(i)&&i;var s=isBinParams(a)&&isParameterExtent(a.extent)&&a.extent;if(o||s){r.set("selectionExtent",o!==null&&o!==void 0?o:s,true)}}function domainSort(e,t,n){if(!hasDiscreteDomain(n)){return undefined}var r=e.fieldDef(t);var i=r.sort;if(isSortArray(i)){return{op:"min",field:sortArrayIndexField(r,t),order:"ascending"}}var a=e.stack;var o=a?__spreadArray(__spreadArray([],a.groupbyField?[a.groupbyField]:[]),a.stackBy.map((function(e){return e.fieldDef.field}))):undefined;if(isSortField(i)){var s=a&&!contains(o,i.field);return normalizeSortField(i,s)}else if(isSortByEncoding(i)){var u=i.encoding,l=i.order;var f=e.fieldDef(u);var c=f.aggregate,d=f.field;var s=a&&!contains(o,d);if(isArgminDef(c)||isArgmaxDef(c)){return normalizeSortField({field:vgField(f),order:l},s)}else if(isAggregateOp(c)||!c){return normalizeSortField({op:c,field:d,order:l},s)}}else if(i==="descending"){return{op:"min",field:e.vgField(t),order:"descending"}}else if(contains(["ascending",undefined],i)){return true}return undefined}function canUseUnaggregatedDomain(e,t){var n=e.aggregate,r=e.type;if(!n){return{valid:false,reason:unaggregateDomainHasNoEffectForRawField(e)}}if(isString(n)&&!SHARED_DOMAIN_OP_INDEX[n]){return{valid:false,reason:unaggregateDomainWithNonSharedDomainOp(n)}}if(r==="quantitative"){if(t==="log"){return{valid:false,reason:unaggregatedDomainWithLogScale(e)}}}return{valid:true}}function domainsTieBreaker(e,t,n,r){if(e.explicit&&t.explicit){warn(mergeConflictingDomainProperty(n,r,e.value,t.value))}return{explicit:e.explicit,value:__spreadArray(__spreadArray([],e.value),t.value)}}function mergeDomains(e){var t=unique(e.map((function(e){if(isDataRefDomain(e)){var t=e.sort,n=__rest(e,["sort"]);return n}return e})),hash);var n=unique(e.map((function(e){if(isDataRefDomain(e)){var t=e.sort;if(t!==undefined&&!isBoolean(t)){if("op"in t&&t.op==="count"){delete t.field}if(t.order==="ascending"){delete t.order}}return t}return undefined})).filter((function(e){return e!==undefined})),hash);if(t.length===0){return undefined}else if(t.length===1){var r=e[0];if(isDataRefDomain(r)&&n.length>0){var i=n[0];if(n.length>1){warn(MORE_THAN_ONE_SORT);i=true}else{if(isObject(i)&&"field"in i){var a=i.field;if(r.field===a){i=i.order?{order:i.order}:true}}}return __assign(__assign({},r),{sort:i})}return r}var o=unique(n.map((function(e){if(isBoolean(e)||!("op"in e)||isString(e.op)&&e.op in MULTIDOMAIN_SORT_OP_INDEX){return e}warn(domainSortDropped(e));return true})),hash);var s;if(o.length===1){s=o[0]}else if(o.length>1){warn(MORE_THAN_ONE_SORT);s=true}var u=unique(e.map((function(e){if(isDataRefDomain(e)){return e.data}return null})),(function(e){return e}));if(u.length===1&&u[0]!==null){var l=__assign({data:u[0],fields:t.map((function(e){return e.field}))},s?{sort:s}:{});return l}return __assign({fields:t},s?{sort:s}:{})}function getFieldFromDomain(e){if(isDataRefDomain(e)&&isString(e.field)){return e.field}else if(isDataRefUnionedDomain(e)){var t;for(var n=0,r=e.fields;n<r.length;n++){var i=r[n];if(isDataRefDomain(i)&&isString(i.field)){if(!t){t=i.field}else if(t!==i.field){warn(FACETED_INDEPENDENT_DIFFERENT_SOURCES);return t}}}warn(FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES);return t}else if(isFieldRefUnionDomain(e)){warn(FACETED_INDEPENDENT_SAME_SOURCE);var a=e.fields[0];return isString(a)?a:undefined}return undefined}function assembleDomain(e,t){var n=e.component.scales[t];var r=n.get("domains").map((function(t){if(isDataRefDomain(t)){t.data=e.lookupDataSource(t.data)}return t}));return mergeDomains(r)}function assembleScales(e){if(isLayerModel(e)||isConcatModel(e)){return e.children.reduce((function(e,t){return e.concat(assembleScales(t))}),assembleScalesForModel(e))}else{return assembleScalesForModel(e)}}function assembleScalesForModel(e){return keys$1(e.component.scales).reduce((function(t,n){var r=e.component.scales[n];if(r.merged){return t}var i=r.combine();var a=i.name,o=i.type,s=i.selectionExtent,u=i.domains,l=i.range,f=i.reverse,c=__rest(i,["name","type","selectionExtent","domains","range","reverse"]);var d=assembleScaleRange(i.range,a,n,e);var p=assembleDomain(e,n);var h=s?assembleSelectionScaleDomain(e,s,r,p):null;t.push(__assign(__assign(__assign(__assign(__assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),f!==undefined?{reverse:f}:{}),c));return t}),[])}function assembleScaleRange(e,t,n,r){if(isXorY(n)){if(isVgRangeStep(e)){return{step:{signal:t+"_step"}}}}else if(isObject(e)&&isDataRefDomain(e)){return __assign(__assign({},e),{data:r.lookupDataSource(e.data)})}return e}var ScaleComponent=function(e){__extends(t,e);function t(t,n){var r=e.call(this,{},{name:t})||this;r.merged=false;r.setWithExplicit("type",n);return r}t.prototype.domainDefinitelyIncludesZero=function(){if(this.get("zero")!==false){return true}return some(this.get("domains"),(function(e){return isArray(e)&&e.length===2&&e[0]<=0&&e[1]>=0}))};return t}(Split);var RANGE_PROPERTIES=["range","scheme"];function getSizeChannel(e){return e==="x"?"width":e==="y"?"height":undefined}function parseUnitScaleRange(e){var t=e.component.scales;for(var n=0,r=SCALE_CHANNELS;n<r.length;n++){var i=r[n];var a=t[i];if(!a){continue}var o=parseRangeForChannel(i,e);a.setWithExplicit("range",o)}}function getBinStepSignal(e,t){var n=e.fieldDef(t);if(n===null||n===void 0?void 0:n.bin){var r=n.bin,i=n.field;var a=getSizeChannel(t);var o=e.getName(a);if(isObject(r)&&r.binned&&r.step!==undefined){return new SignalRefWrapper((function(){var n=e.scaleName(t);var i='(domain("'+n+'")[1] - domain("'+n+'")[0]) / '+r.step;return e.getSignalName(o)+" / ("+i+")"}))}else if(isBinning(r)){var s=getBinSignalName(e,i,r);return new SignalRefWrapper((function(){var t=e.getSignalName(s);var n="("+t+".stop - "+t+".start) / "+t+".step";return e.getSignalName(o)+" / ("+n+")"}))}}return undefined}function parseRangeForChannel(e,t){var n=t.specifiedScales[e];var r=t.size;var i=t.getScaleComponent(e);var a=i.get("type");for(var o=0,s=RANGE_PROPERTIES;o<s.length;o++){var u=s[o];if(n[u]!==undefined){var l=scaleTypeSupportProperty(a,u);var f=channelScalePropertyIncompatability(e,u);if(!l){warn(scalePropertyNotWorkWithScaleType(a,u,e))}else if(f){warn(f)}else{switch(u){case"range":{var c=n.range;if(isArray(c)){if(isXorY(e)){return makeExplicit(c.map((function(e){if(e==="width"||e==="height"){var n=t.getName(e);var r=t.getSignalName.bind(t);return SignalRefWrapper.fromName(r,n)}return e})))}}else if(isObject(c)){return makeExplicit({data:t.requestDataName(DataSourceType.Main),field:c.field,sort:{op:"min",field:t.vgField(e)}})}return makeExplicit(c)}case"scheme":return makeExplicit(parseScheme(n[u]))}}}}if(e===X||e===Y){var d=e===X?"width":"height";var p=r[d];if(isStep(p)){if(hasDiscreteDomain(a)){return makeExplicit({step:p.step})}else{warn(stepDropped(d))}}}var h=n.rangeMin,g=n.rangeMax;var m=defaultRange(e,t);if((h!==undefined||g!==undefined)&&scaleTypeSupportProperty(a,"rangeMin")&&isArray(m)&&m.length===2){return makeExplicit([h!==null&&h!==void 0?h:m[0],g!==null&&g!==void 0?g:m[1]])}return makeImplicit(m)}function parseScheme(e){if(isExtendedScheme(e)){return __assign({scheme:e.name},omit(e,["name"]))}return{scheme:e}}function defaultRange(e,t){var n=t.size,r=t.config,i=t.mark,a=t.encoding;var o=t.getSignalName.bind(t);var s=getFieldOrDatumDef(a[e]).type;var u=t.getScaleComponent(e);var l=u.get("type");var f=t.specifiedScales[e],c=f.domain,d=f.domainMid;switch(e){case X:case Y:{if(contains(["point","band"],l)){if(e===X&&!n.width){var p=getViewConfigDiscreteSize(r.view,"width");if(isStep(p)){return p}}else if(e===Y&&!n.height){var h=getViewConfigDiscreteSize(r.view,"height");if(isStep(h)){return h}}}var g=getSizeChannel(e);var m=t.getName(g);if(e===Y&&hasContinuousDomain(l)){return[SignalRefWrapper.fromName(o,m),0]}else{return[0,SignalRefWrapper.fromName(o,m)]}}case SIZE:{var v=t.component.scales[e].get("zero");var y=sizeRangeMin(i,v,r);var _=sizeRangeMax(i,n,t,r);if(isContinuousToDiscrete(l)){return interpolateRange(y,_,defaultContinuousToDiscreteCount(l,r,c,e))}else{return[y,_]}}case THETA:return[0,Math.PI*2];case ANGLE:return[0,360];case RADIUS:{return[0,new SignalRefWrapper((function(){var e=t.getSignalName("width");var n=t.getSignalName("height");return"min("+e+","+n+")/2"}))]}case STROKEWIDTH:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case STROKEDASH:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case SHAPE:return"symbol";case COLOR:case FILL:case STROKE:if(l==="ordinal"){return s==="nominal"?"category":"ordinal"}else{if(d!==undefined){return"diverging"}else{return i==="rect"||i==="geoshape"?"heatmap":"ramp"}}case OPACITY:case FILLOPACITY:case STROKEOPACITY:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}function defaultContinuousToDiscreteCount(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":if(n!==undefined&&isArray(n)){return n.length+1}else{warn(domainRequiredForThresholdScale(r));return 3}}}function interpolateRange(e,t,n){var r=function(){var r=signalOrStringValue(t);var i=signalOrStringValue(e);var a="("+r+" - "+i+") / ("+n+" - 1)";return"sequence("+i+", "+r+" + "+a+", "+a+")"};if(isSignalRef(t)){return new SignalRefWrapper(r)}else{return{signal:r()}}}function sizeRangeMin(e,t,n){if(t){if(isSignalRef(t)){return{signal:t.signal+" ? 0 : "+sizeRangeMin(e,false,n)}}else{return 0}}switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(incompatibleChannel("size",e))}var MAX_SIZE_RANGE_STEP_RATIO=.95;function sizeRangeMax(e,t,n,r){var i={x:getBinStepSignal(n,"x"),y:getBinStepSignal(n,"y")};switch(e){case"bar":case"tick":{if(r.scale.maxBandSize!==undefined){return r.scale.maxBandSize}var a=minXYStep(t,i,r.view);if(isNumber$1(a)){return a-1}else{return new SignalRefWrapper((function(){return a.signal+" - 1"}))}}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize){return r.scale.maxSize}var o=minXYStep(t,i,r.view);if(isNumber$1(o)){return Math.pow(MAX_SIZE_RANGE_STEP_RATIO*o,2)}else{return new SignalRefWrapper((function(){return"pow("+MAX_SIZE_RANGE_STEP_RATIO+" * "+o.signal+", 2)"}))}}}throw new Error(incompatibleChannel("size",e))}function minXYStep(e,t,n){var r=isStep(e.width)?e.width.step:getViewConfigDiscreteStep(n,"width");var i=isStep(e.height)?e.height.step:getViewConfigDiscreteStep(n,"height");if(t.x||t.y){return new SignalRefWrapper((function(){var e=[t.x?t.x.signal:r,t.y?t.y.signal:i];return"min("+e.join(", ")+")"}))}return Math.min(r,i)}function parseScaleProperty(e,t){if(isUnitModel(e)){parseUnitScaleProperty(e,t)}else{parseNonUnitScaleProperty(e,t)}}function parseUnitScaleProperty(e,t){var n=e.component.scales;var r=e.config,i=e.encoding,a=e.markDef,o=e.specifiedScales;for(var s=0,u=keys$1(n);s<u.length;s++){var l=u[s];var f=o[l];var c=n[l];var d=e.getScaleComponent(l);var p=getFieldOrDatumDef(i[l]);var h=f[t];var g=d.get("type");var m=d.get("padding");var v=d.get("paddingInner");var y=scaleTypeSupportProperty(g,t);var _=channelScalePropertyIncompatability(l,t);if(h!==undefined){if(!y){warn(scalePropertyNotWorkWithScaleType(g,t,l))}else if(_){warn(_)}}if(y&&_===undefined){if(h!==undefined){var b=p["timeUnit"];var x=p.type;switch(t){case"domainMax":case"domainMin":if(isDateTime(f[t])||x==="temporal"||b){c.set(t,{signal:valueExpr(f[t],{type:x,timeUnit:b})},true)}else{c.set(t,f[t],true)}break;default:c.copyKeyFromObject(t,f)}}else{var E=t in scaleRules?scaleRules[t]({model:e,channel:l,fieldOrDatumDef:p,scaleType:g,scalePadding:m,scalePaddingInner:v,domain:f.domain,markDef:a,config:r}):r.scale[t];if(E!==undefined){c.set(t,E,false)}}}}}var scaleRules={bins:function(e){var t=e.model,n=e.fieldOrDatumDef;return isFieldDef(n)?bins(t,n):undefined},interpolate:function(e){var t=e.channel,n=e.fieldOrDatumDef;return interpolate(t,n.type)},nice:function(e){var t=e.scaleType,n=e.channel,r=e.domain,i=e.fieldOrDatumDef;return nice(t,n,r,i)},padding:function(e){var t=e.channel,n=e.scaleType,r=e.fieldOrDatumDef,i=e.markDef,a=e.config;return padding(t,n,a.scale,r,i,a.bar)},paddingInner:function(e){var t=e.scalePadding,n=e.channel,r=e.markDef,i=e.config;return paddingInner(t,n,r.type,i.scale)},paddingOuter:function(e){var t=e.scalePadding,n=e.channel,r=e.scaleType,i=e.markDef,a=e.scalePaddingInner,o=e.config;return paddingOuter(t,n,r,i.type,a,o.scale)},reverse:function(e){var t=e.fieldOrDatumDef,n=e.scaleType,r=e.channel,i=e.config;var a=isFieldDef(t)?t.sort:undefined;return reverse(n,a,r,i.scale)},zero:function(e){var t=e.channel,n=e.fieldOrDatumDef,r=e.domain,i=e.markDef,a=e.scaleType;return zero(t,n,r,i,a)}};function parseScaleRange(e){if(isUnitModel(e)){parseUnitScaleRange(e)}else{parseNonUnitScaleProperty(e,"range")}}function parseNonUnitScaleProperty(e,t){var n=e.component.scales;for(var r=0,i=e.children;r<i.length;r++){var a=i[r];if(t==="range"){parseScaleRange(a)}else{parseScaleProperty(a,t)}}for(var o=0,s=keys$1(n);o<s.length;o++){var u=s[o];var l=void 0;for(var f=0,c=e.children;f<c.length;f++){var a=c[f];var d=a.component.scales[u];if(d){var p=d.getWithExplicit(t);l=mergeValuesWithExplicit(l,p,t,"scale",tieBreakByComparing((function(e,n){switch(t){case"range":if(e.step&&n.step){return e.step-n.step}return 0}return 0})))}}n[u].setWithExplicit(t,l)}}function bins(e,t){var n=t.bin;if(isBinning(n)){var r=getBinSignalName(e,t.field,n);return new SignalRefWrapper((function(){return e.getSignalName(r)}))}else if(isBinned(n)&&isBinParams(n)&&n.step!==undefined){return{step:n.step}}return undefined}function interpolate(e,t){if(contains([COLOR,FILL,STROKE],e)&&t!=="nominal"){return"hcl"}return undefined}function nice(e,t,n,r){var i;if(((i=getFieldDef(r))===null||i===void 0?void 0:i.bin)||isArray(n)||contains([ScaleType.TIME,ScaleType.UTC],e)){return undefined}return t in POSITION_SCALE_CHANNEL_INDEX?true:undefined}function padding(e,t,n,r,i,a){if(e in POSITION_SCALE_CHANNEL_INDEX){if(isContinuousToContinuous(t)){if(n.continuousPadding!==undefined){return n.continuousPadding}var o=i.type,s=i.orient;if(o==="bar"&&!(isFieldDef(r)&&(r.bin||r.timeUnit))){if(s==="vertical"&&e==="x"||s==="horizontal"&&e==="y"){return a.continuousBandSize}}}if(t===ScaleType.POINT){return n.pointPadding}}return undefined}function paddingInner(e,t,n,r){if(e!==undefined){return undefined}if(t in POSITION_SCALE_CHANNEL_INDEX){var i=r.bandPaddingInner,a=r.barBandPaddingInner,o=r.rectBandPaddingInner;return getFirstDefined(i,n==="bar"?a:o)}return undefined}function paddingOuter(e,t,n,r,i,a){if(e!==undefined){return undefined}if(t in POSITION_SCALE_CHANNEL_INDEX){if(n===ScaleType.BAND){var o=a.bandPaddingOuter;return getFirstDefined(o,isSignalRef(i)?{signal:i.signal+"/2"}:i/2)}}return undefined}function reverse(e,t,n,r){if(n==="x"&&r.xReverse!==undefined){if(hasContinuousDomain(e)&&t==="descending"){if(isSignalRef(r.xReverse)){return{signal:"!"+r.xReverse.signal}}else{return!r.xReverse}}return r.xReverse}if(hasContinuousDomain(e)&&t==="descending"){return true}return undefined}function zero(e,t,n,r,i){var a=!!n&&n!=="unaggregated";if(a){if(hasContinuousDomain(i)){if(isArray(n)){var o=n[0];var s=n[n.length-1];if(o<=0&&s>=0){return true}}return false}}if(e==="size"&&t.type==="quantitative"&&!isContinuousToDiscrete(i)){return true}if(!(isFieldDef(t)&&t.bin)&&contains(__spreadArray(__spreadArray([],POSITION_SCALE_CHANNELS),POLAR_POSITION_SCALE_CHANNELS),e)){var u=r.orient,l=r.type;if(contains(["bar","area","line","trail"],l)){if(u==="horizontal"&&e==="y"||u==="vertical"&&e==="x"){return false}}return true}return false}function scaleType(e,t,n,r){var i=defaultType(t,n,r);var a=e.type;if(!isScaleChannel(t)){return null}if(a!==undefined){if(!channelSupportScaleType(t,a)){warn(scaleTypeNotWorkWithChannel(t,a,i));return i}if(isFieldDef(n)&&!scaleTypeSupportDataType(a,n.type)){warn(scaleTypeNotWorkWithFieldDef(a,i));return i}return a}return i}function defaultType(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":{if(isColorChannel(e)||rangeType(e)==="discrete"){if(e==="shape"&&t.type==="ordinal"){warn(discreteChannelCannotEncode(e,"ordinal"))}return"ordinal"}if(e in POSITION_SCALE_CHANNEL_INDEX){if(contains(["rect","bar","image","rule"],n.type)){return"band"}}else if(n.type==="arc"&&e in POLAR_POSITION_SCALE_CHANNEL_INDEX){return"band"}var i=n[getSizeChannel$1(e)];if(isRelativeBandSize(i)){return"band"}if(isPositionFieldOrDatumDef(t)&&((r=t.axis)===null||r===void 0?void 0:r.tickBand)){return"band"}return"point"}case"temporal":if(isColorChannel(e)){return"time"}else if(rangeType(e)==="discrete"){warn(discreteChannelCannotEncode(e,"temporal"));return"ordinal"}else if(isFieldDef(t)&&t.timeUnit&&normalizeTimeUnit(t.timeUnit).utc){return"utc"}return"time";case"quantitative":if(isColorChannel(e)){if(isFieldDef(t)&&isBinning(t.bin)){return"bin-ordinal"}return"linear"}else if(rangeType(e)==="discrete"){warn(discreteChannelCannotEncode(e,"quantitative"));return"ordinal"}return"linear";case"geojson":return undefined}throw new Error(invalidFieldType(t.type))}function parseScales(e,t){var n=t===void 0?{}:t,r=n.ignoreRange;parseScaleCore(e);parseScaleDomain(e);for(var i=0,a=NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES;i<a.length;i++){var o=a[i];parseScaleProperty(e,o)}if(!r){parseScaleRange(e)}}function parseScaleCore(e){if(isUnitModel(e)){e.component.scales=parseUnitScaleCore(e)}else{e.component.scales=parseNonUnitScaleCore(e)}}function parseUnitScaleCore(e){var t=e.encoding,n=e.mark,r=e.markDef;return SCALE_CHANNELS.reduce((function(i,a){var o=getFieldOrDatumDef(t[a]);if(o&&n===GEOSHAPE&&a===SHAPE&&o.type===GEOJSON){return i}var s=o&&o["scale"];if(o&&s!==null&&s!==false){s!==null&&s!==void 0?s:s={};var u=scaleType(s,a,o,r);i[a]=new ScaleComponent(e.scaleName(""+a,true),{value:u,explicit:s.type===u})}return i}),{})}var scaleTypeTieBreaker=tieBreakByComparing((function(e,t){return scaleTypePrecedence(e)-scaleTypePrecedence(t)}));function parseNonUnitScaleCore(e){var t;var n;var r=e.component.scales={};var i={};var a=e.component.resolve;for(var o=0,s=e.children;o<s.length;o++){var u=s[o];parseScaleCore(u);for(var l=0,f=keys$1(u.component.scales);l<f.length;l++){var c=f[l];(t=(n=a.scale)[c])!==null&&t!==void 0?t:n[c]=defaultScaleResolve(c,e);if(a.scale[c]==="shared"){var d=i[c];var p=u.component.scales[c].getWithExplicit("type");if(d){if(scaleCompatible(d.value,p.value)){i[c]=mergeValuesWithExplicit(d,p,"type","scale",scaleTypeTieBreaker)}else{a.scale[c]="independent";delete i[c]}}else{i[c]=p}}}}for(var h=0,g=keys$1(i);h<g.length;h++){var c=g[h];var m=e.scaleName(c,true);var v=i[c];r[c]=new ScaleComponent(m,v);for(var y=0,_=e.children;y<_.length;y++){var u=_[y];var b=u.component.scales[c];if(b){u.renameScale(b.get("name"),m);b.merged=true}}}return r}var NameMap=function(){function e(){this.nameMap={}}e.prototype.rename=function(e,t){this.nameMap[e]=t};e.prototype.has=function(e){return this.nameMap[e]!==undefined};e.prototype.get=function(e){while(this.nameMap[e]&&e!==this.nameMap[e]){e=this.nameMap[e]}return e};return e}();function isUnitModel(e){return(e===null||e===void 0?void 0:e.type)==="unit"}function isFacetModel(e){return(e===null||e===void 0?void 0:e.type)==="facet"}function isConcatModel(e){return(e===null||e===void 0?void 0:e.type)==="concat"}function isLayerModel(e){return(e===null||e===void 0?void 0:e.type)==="layer"}var Model=function(){function e(e,t,n,r,i,a,o){var s=this;var u,l;this.type=t;this.parent=n;this.config=i;this.correctDataNames=function(e){if(e.from&&e.from.data){e.from.data=s.lookupDataSource(e.from.data)}if(e.from&&e.from.facet&&e.from.facet.data){e.from.facet.data=s.lookupDataSource(e.from.facet.data)}return e};this.parent=n;this.config=i;this.view=replaceExprRef(o);this.name=(u=e.name)!==null&&u!==void 0?u:r;this.title=isText(e.title)?{text:e.title}:e.title?replaceExprRef(e.title):undefined;this.scaleNameMap=n?n.scaleNameMap:new NameMap;this.projectionNameMap=n?n.projectionNameMap:new NameMap;this.signalNameMap=n?n.signalNameMap:new NameMap;this.data=e.data;this.description=e.description;this.transforms=normalizeTransform((l=e.transform)!==null&&l!==void 0?l:[]);this.layout=t==="layer"||t==="unit"?{}:extractCompositionLayout(e,t,i);this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:isFacetSpec(e)||n&&n.component.data.isFaceted&&e.data===undefined},layoutSize:new Split,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:__assign({scale:{},axis:{},legend:{}},a?duplicate(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:false,configurable:true});e.prototype.parse=function(){this.parseScale();this.parseLayoutSize();this.renameTopLevelLayoutSizeSignal();this.parseSelections();this.parseProjection();this.parseData();this.parseAxesAndHeaders();this.parseLegends();this.parseMarkGroup()};e.prototype.parseScale=function(){parseScales(this)};e.prototype.parseProjection=function(){parseProjection(this)};e.prototype.renameTopLevelLayoutSizeSignal=function(){if(this.getName("width")!=="width"){this.renameSignal(this.getName("width"),"width")}if(this.getName("height")!=="height"){this.renameSignal(this.getName("height"),"height")}};e.prototype.parseLegends=function(){parseLegend(this)};e.prototype.assembleGroupStyle=function(){var e,t;if(this.type==="unit"||this.type==="layer"){return(t=(e=this.view)===null||e===void 0?void 0:e.style)!==null&&t!==void 0?t:"cell"}return undefined};e.prototype.assembleEncodeFromView=function(e){var t=e.style,n=__rest(e,["style"]);var r={};for(var i=0,a=keys$1(n);i<a.length;i++){var o=a[i];var s=n[o];if(s!==undefined){r[o]=signalOrValueRef(s)}}return r};e.prototype.assembleGroupEncodeEntry=function(e){var t={};if(this.view){t=this.assembleEncodeFromView(this.view)}if(!e){if(this.description){t["description"]=signalOrValueRef(this.description)}if(this.type==="unit"||this.type==="layer"){return __assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},t!==null&&t!==void 0?t:{})}}return isEmpty(t)?undefined:t};e.prototype.assembleLayout=function(){if(!this.layout){return undefined}var e=this.layout,t=e.spacing,n=__rest(e,["spacing"]);var r=this,i=r.component,a=r.config;var o=assembleLayoutTitleBand(i.layoutHeaders,a);return __assign(__assign(__assign({padding:t},this.assembleDefaultLayout()),n),o?{titleBand:o}:{})};e.prototype.assembleDefaultLayout=function(){return{}};e.prototype.assembleHeaderMarks=function(){var e=this.component.layoutHeaders;var t=[];for(var n=0,r=FACET_CHANNELS;n<r.length;n++){var i=r[n];if(e[i].title){t.push(assembleTitleGroup(this,i))}}for(var a=0,o=HEADER_CHANNELS;a<o.length;a++){var i=o[a];t=t.concat(assembleHeaderGroups(this,i))}return t};e.prototype.assembleAxes=function(){return assembleAxes(this.component.axes,this.config)};e.prototype.assembleLegends=function(){return assembleLegends(this)};e.prototype.assembleProjections=function(){return assembleProjections(this)};e.prototype.assembleTitle=function(){var e,t,n;var r=(e=this.title)!==null&&e!==void 0?e:{},i=r.encoding,a=__rest(r,["encoding"]);var o=__assign(__assign(__assign({},extractTitleConfig(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text){if(contains(["unit","layer"],this.type)){if(contains(["middle",undefined],o.anchor)){(t=o.frame)!==null&&t!==void 0?t:o.frame="group"}}else{(n=o.anchor)!==null&&n!==void 0?n:o.anchor="start"}return isEmpty(o)?undefined:o}return undefined};e.prototype.assembleGroup=function(e){if(e===void 0){e=[]}var t={};e=e.concat(this.assembleSignals());if(e.length>0){t.signals=e}var n=this.assembleLayout();if(n){t.layout=n}t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||isFacetModel(this.parent)?assembleScales(this):[];if(r.length>0){t.scales=r}var i=this.assembleAxes();if(i.length>0){t.axes=i}var a=this.assembleLegends();if(a.length>0){t.legends=a}return t};e.prototype.getName=function(e){return varName((this.name?this.name+"_":"")+e)};e.prototype.getDataName=function(e){return this.getName(DataSourceType[e].toLowerCase())};e.prototype.requestDataName=function(e){var t=this.getDataName(e);var n=this.component.data.outputNodeRefCounts;n[t]=(n[t]||0)+1;return t};e.prototype.getSizeSignalRef=function(e){if(isFacetModel(this.parent)){var t=getSizeTypeFromLayoutSizeType(e);var n=getPositionScaleChannel(t);var r=this.component.scales[n];if(r&&!r.merged){var i=r.get("type");var a=r.get("range");if(hasDiscreteDomain(i)&&isVgRangeStep(a)){var o=r.get("name");var s=assembleDomain(this,n);var u=getFieldFromDomain(s);if(u){var l=vgField({aggregate:"distinct",field:u},{expr:"datum"});return{signal:sizeExpr(o,r,l)}}else{warn(unknownField(n));return null}}}}return{signal:this.signalNameMap.get(this.getName(e))}};e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];if(!t){return e}return t.getSource()};e.prototype.getSignalName=function(e){return this.signalNameMap.get(e)};e.prototype.renameSignal=function(e,t){this.signalNameMap.rename(e,t)};e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)};e.prototype.renameProjection=function(e,t){this.projectionNameMap.rename(e,t)};e.prototype.scaleName=function(e,t){if(t){return this.getName(e)}if(isChannel(e)&&isScaleChannel(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))){return this.scaleNameMap.get(this.getName(e))}return undefined};e.prototype.projectionName=function(e){if(e){return this.getName("projection")}if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))){return this.projectionNameMap.get(this.getName("projection"))}return undefined};e.prototype.getScaleComponent=function(e){if(!this.component.scales){throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().")}var t=this.component.scales[e];if(t&&!t.merged){return t}return this.parent?this.parent.getScaleComponent(e):undefined};e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent){n=this.parent.getSelectionComponent(e,t)}if(!n){throw new Error(selectionNotFound(t))}return n};e.prototype.hasAxisOrientSignalRef=function(){var e,t;return((e=this.component.axes.x)===null||e===void 0?void 0:e.some((function(e){return e.hasOrientSignalRef()})))||((t=this.component.axes.y)===null||t===void 0?void 0:t.some((function(e){return e.hasOrientSignalRef()})))};return e}();var ModelWithField=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.vgField=function(e,t){if(t===void 0){t={}}var n=this.fieldDef(e);if(!n){return undefined}return vgField(n,t)};t.prototype.reduceFieldDef=function(e,t){return reduce(this.getMapping(),(function(t,n,r){var i=getFieldDef(n);if(i){return e(t,i,r)}return t}),t)};t.prototype.forEachFieldDef=function(e,t){forEach(this.getMapping(),(function(t,n){var r=getFieldDef(t);if(r){e(r,n)}}),t)};return t}(Model);var DensityTransformNode=function(e){__extends(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=duplicate(n);var s=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=s[0])!==null&&i!==void 0?i:"value",(a=s[1])!==null&&a!==void 0?a:"density"];return o}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.density],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"DensityTransform "+hash(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.density,n=__rest(e,["density"]);var r=__assign({type:"kde",field:t},n);return r};return t}(DataFlowNode);var FilterInvalidNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.filter=n;return r}t.prototype.clone=function(){return new t(null,__assign({},this.filter))};t.make=function(e,n){var r=n.config,i=n.mark,a=n.markDef;var o=getMarkPropOrConfig("invalid",a,r);if(o!=="filter"){return null}var s=n.reduceFieldDef((function(e,t,r){var a=isScaleChannel(r)&&n.getScaleComponent(r);if(a){var o=a.get("type");if(hasContinuousDomain(o)&&t.aggregate!=="count"&&!isPathMark(i)){e[t.field]=t}}return e}),{});if(!keys$1(s).length){return null}return new t(e,s)};t.prototype.dependentFields=function(){return new Set(keys$1(this.filter))};t.prototype.producedFields=function(){return new Set};t.prototype.hash=function(){return"FilterInvalid "+hash(this.filter)};t.prototype.assemble=function(){var e=this;var t=keys$1(this.filter).reduce((function(t,n){var r=e.filter[n];var i=vgField(r,{expr:"datum"});if(r!==null){if(r.type==="temporal"){t.push("(isDate("+i+") || (isValid("+i+") && isFinite(+"+i+")))")}else if(r.type==="quantitative"){t.push("isValid("+i+")");t.push("isFinite(+"+i+")")}else;}return t}),[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null};return t}(DataFlowNode);var FlattenTransformNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;r.transform=duplicate(n);var i=r.transform,a=i.flatten,o=i.as,s=o===void 0?[]:o;r.transform.as=a.map((function(e,t){var n;return(n=s[t])!==null&&n!==void 0?n:e}));return r}t.prototype.clone=function(){return new t(this.parent,duplicate(this.transform))};t.prototype.dependentFields=function(){return new Set(this.transform.flatten)};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"FlattenTransform "+hash(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.flatten,n=e.as;var r={type:"flatten",fields:t,as:n};return r};return t}(DataFlowNode);var FoldTransformNode=function(e){__extends(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=duplicate(n);var s=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=s[0])!==null&&i!==void 0?i:"key",(a=s[1])!==null&&a!==void 0?a:"value"];return o}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.dependentFields=function(){return new Set(this.transform.fold)};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"FoldTransform "+hash(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.fold,n=e.as;var r={type:"fold",fields:t,as:n};return r};return t}(DataFlowNode);var GeoJSONNode=function(e){__extends(t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.fields=n;a.geojson=r;a.signal=i;return a}t.prototype.clone=function(){return new t(null,duplicate(this.fields),this.geojson,this.signal)};t.parseAll=function(e,n){if(n.component.projection&&!n.component.projection.isFit){return e}var r=0;for(var i=0,a=[[LONGITUDE,LATITUDE],[LONGITUDE2,LATITUDE2]];i<a.length;i++){var o=a[i];var s=o.map((function(e){var t=getFieldOrDatumDef(n.encoding[e]);return isFieldDef(t)?t.field:isDatumDef(t)?{expr:""+t.datum}:isValueDef(t)?{expr:""+t["value"]}:undefined}));if(s[0]||s[1]){e=new t(e,s,null,n.getName("geojson_"+r++))}}if(n.channelHasField(SHAPE)){var u=n.typedFieldDef(SHAPE);if(u.type===GEOJSON){e=new t(e,null,u.field,n.getName("geojson_"+r++))}}return e};t.prototype.dependentFields=function(){var e;var t=((e=this.fields)!==null&&e!==void 0?e:[]).filter(isString);return new Set(__spreadArray(__spreadArray([],this.geojson?[this.geojson]:[]),t))};t.prototype.producedFields=function(){return new Set};t.prototype.hash=function(){return"GeoJSON "+this.geojson+" "+this.signal+" "+hash(this.fields)};t.prototype.assemble=function(){return __spreadArray(__spreadArray([],this.geojson?[{type:"filter",expr:'isValid(datum["'+this.geojson+'"])'}]:[]),[__assign(__assign(__assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})])};return t}(DataFlowNode);var GeoPointNode=function(e){__extends(t,e);function t(t,n,r,i){var a=e.call(this,t)||this;a.projection=n;a.fields=r;a.as=i;return a}t.prototype.clone=function(){return new t(null,this.projection,duplicate(this.fields),duplicate(this.as))};t.parseAll=function(e,n){if(!n.projectionName()){return e}for(var r=0,i=[[LONGITUDE,LATITUDE],[LONGITUDE2,LATITUDE2]];r<i.length;r++){var a=i[r];var o=a.map((function(e){var t=getFieldOrDatumDef(n.encoding[e]);return isFieldDef(t)?t.field:isDatumDef(t)?{expr:""+t.datum}:isValueDef(t)?{expr:""+t["value"]}:undefined}));var s=a[0]===LONGITUDE2?"2":"";if(o[0]||o[1]){e=new t(e,n.projectionName(),o,[n.getName("x"+s),n.getName("y"+s)])}}return e};t.prototype.dependentFields=function(){return new Set(this.fields.filter(isString))};t.prototype.producedFields=function(){return new Set(this.as)};t.prototype.hash=function(){return"Geopoint "+this.projection+" "+hash(this.fields)+" "+hash(this.as)};t.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}};return t}(DataFlowNode);var ImputeNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.impute,this.transform.key],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set([this.transform.impute])};t.prototype.processSequence=function(e){var t=e.start,n=t===void 0?0:t,r=e.stop,i=e.step;var a=__spreadArray([n,r],i?[i]:[]).join(",");return{signal:"sequence("+a+")"}};t.makeFromTransform=function(e,n){return new t(e,n)};t.makeFromEncoding=function(e,n){var r=n.encoding;var i=r.x;var a=r.y;if(isFieldDef(i)&&isFieldDef(a)){var o=i.impute?i:a.impute?a:undefined;if(o===undefined){return undefined}var s=i.impute?a:a.impute?i:undefined;var u=o.impute,l=u.method,f=u.value,c=u.frame,d=u.keyvals;var p=pathGroupingFields(n.mark,r);return new t(e,__assign(__assign(__assign(__assign(__assign({impute:o.field,key:s.field},l?{method:l}:{}),f!==undefined?{value:f}:{}),c?{frame:c}:{}),d!==undefined?{keyvals:d}:{}),p.length?{groupby:p}:{}))}return null};t.prototype.hash=function(){return"Impute "+hash(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.impute,n=e.key,r=e.keyvals,i=e.method,a=e.groupby,o=e.value,s=e.frame,u=s===void 0?[null,null]:s;var l=__assign(__assign(__assign(__assign({type:"impute",field:t,key:n},r?{keyvals:isImputeSequence(r)?this.processSequence(r):r}:{}),{method:"value"}),a?{groupby:a}:{}),{value:!i||i==="value"?o:null});if(i&&i!=="value"){var f=__assign({type:"window",as:["imputed_"+t+"_value"],ops:[i],fields:[t],frame:u,ignorePeers:false},a?{groupby:a}:{});var c={type:"formula",expr:"datum."+t+" === null ? datum.imputed_"+t+"_value : datum."+t,as:t};return[l,f,c]}else{return[l]}};return t}(DataFlowNode);var LoessTransformNode=function(e){__extends(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=duplicate(n);var s=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=s[0])!==null&&i!==void 0?i:n.on,(a=s[1])!==null&&a!==void 0?a:n.loess];return o}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.loess,this.transform.on],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"LoessTransform "+hash(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.loess,n=e.on,r=__rest(e,["loess","on"]);var i=__assign({type:"loess",x:n,y:t},r);return i};return t}(DataFlowNode);var LookupNode=function(t){__extends(n,t);function n(e,n,r){var i=t.call(this,e)||this;i.transform=n;i.secondary=r;return i}n.prototype.clone=function(){return new n(null,duplicate(this.transform),this.secondary)};n.make=function(t,r,i,a){var o=r.component.data.sources;var s=i.from;var u=null;if(isLookupData(s)){var l=findSource(s.data,o);if(!l){l=new SourceNode(s.data);o.push(l)}var f=r.getName("lookup_"+a);u=new OutputNode(l,f,DataSourceType.Lookup,r.component.data.outputNodeRefCounts);r.component.data.outputNodes[f]=u}else if(isLookupSelection(s)){var c=s.param;i=__assign({as:c},i);var d=void 0;try{d=r.getSelectionComponent(varName(c),c)}catch(e){throw new Error(cannotLookupVariableParameter(c))}u=d.materialized;if(!u){throw new Error(noSameUnitLookup(c))}}return new n(t,i,u.getSource())};n.prototype.dependentFields=function(){return new Set([this.transform.lookup])};n.prototype.producedFields=function(){return new Set(this.transform.as?array$5(this.transform.as):this.transform.from.fields)};n.prototype.hash=function(){return"Lookup "+hash({transform:this.transform,secondary:this.secondary})};n.prototype.assemble=function(){var e;if(this.transform.from.fields){e=__assign({values:this.transform.from.fields},this.transform.as?{as:array$5(this.transform.as)}:{})}else{var t=this.transform.as;if(!isString(t)){warn(NO_FIELDS_NEEDS_AS);t="_lookup"}e={as:[t]}}return __assign(__assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})};return n}(DataFlowNode);var QuantileTransformNode=function(e){__extends(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=duplicate(n);var s=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=s[0])!==null&&i!==void 0?i:"prob",(a=s[1])!==null&&a!==void 0?a:"value"];return o}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.quantile],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"QuantileTransform "+hash(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.quantile,n=__rest(e,["quantile"]);var r=__assign({type:"quantile",field:t},n);return r};return t}(DataFlowNode);var RegressionTransformNode=function(e){__extends(t,e);function t(t,n){var r,i,a;var o=e.call(this,t)||this;o.transform=n;o.transform=duplicate(n);var s=(r=o.transform.as)!==null&&r!==void 0?r:[undefined,undefined];o.transform.as=[(i=s[0])!==null&&i!==void 0?i:n.on,(a=s[1])!==null&&a!==void 0?a:n.regression];return o}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.regression,this.transform.on],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.producedFields=function(){return new Set(this.transform.as)};t.prototype.hash=function(){return"RegressionTransform "+hash(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.regression,n=e.on,r=__rest(e,["regression","on"]);var i=__assign({type:"regression",x:n,y:t},r);return i};return t}(DataFlowNode);var PivotTransformNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.addDimensions=function(e){var t;this.transform.groupby=unique(((t=this.transform.groupby)!==null&&t!==void 0?t:[]).concat(e),(function(e){return e}))};t.prototype.producedFields=function(){return undefined};t.prototype.dependentFields=function(){var e;return new Set(__spreadArray([this.transform.pivot,this.transform.value],(e=this.transform.groupby)!==null&&e!==void 0?e:[]))};t.prototype.hash=function(){return"PivotTransform "+hash(this.transform)};t.prototype.assemble=function(){var e=this.transform,t=e.pivot,n=e.value,r=e.groupby,i=e.limit,a=e.op;return __assign(__assign(__assign({type:"pivot",field:t,value:n},i!==undefined?{limit:i}:{}),a!==undefined?{op:a}:{}),r!==undefined?{groupby:r}:{})};return t}(DataFlowNode);var SampleTransformNode=function(e){__extends(t,e);function t(t,n){var r=e.call(this,t)||this;r.transform=n;return r}t.prototype.clone=function(){return new t(null,duplicate(this.transform))};t.prototype.dependentFields=function(){return new Set};t.prototype.producedFields=function(){return new Set};t.prototype.hash=function(){return"SampleTransform "+hash(this.transform)};t.prototype.assemble=function(){return{type:"sample",size:this.transform.sample}};return t}(DataFlowNode);function makeWalkTree(e){var t=0;function n(r,i){var a,o,s;var u;if(r instanceof SourceNode){if(!r.isGenerator&&!isUrlData(r.data)){e.push(i);var l={name:null,source:i.name,transform:[]};i=l}}if(r instanceof ParseNode){if(r.parent instanceof SourceNode&&!i.source){i.format=__assign(__assign({},(u=i.format)!==null&&u!==void 0?u:{}),{parse:r.assembleFormatParse()});(a=i.transform).push.apply(a,r.assembleTransforms(true))}else{(o=i.transform).push.apply(o,r.assembleTransforms())}}if(r instanceof FacetNode){if(!i.name){i.name="data_"+t++}if(!i.source||i.transform.length>0){e.push(i);r.data=i.name}else{r.data=i.source}e.push.apply(e,r.assemble());return}if(r instanceof GraticuleNode||r instanceof SequenceNode||r instanceof FilterInvalidNode||r instanceof FilterNode||r instanceof CalculateNode||r instanceof GeoPointNode||r instanceof AggregateNode||r instanceof LookupNode||r instanceof WindowTransformNode||r instanceof JoinAggregateTransformNode||r instanceof FoldTransformNode||r instanceof FlattenTransformNode||r instanceof DensityTransformNode||r instanceof LoessTransformNode||r instanceof QuantileTransformNode||r instanceof RegressionTransformNode||r instanceof IdentifierNode||r instanceof SampleTransformNode||r instanceof PivotTransformNode){i.transform.push(r.assemble())}if(r instanceof BinNode||r instanceof TimeUnitNode||r instanceof ImputeNode||r instanceof StackNode||r instanceof GeoJSONNode){(s=i.transform).push.apply(s,r.assemble())}if(r instanceof OutputNode){if(i.source&&i.transform.length===0){r.setSource(i.source)}else if(r.parent instanceof OutputNode){r.setSource(i.name)}else{if(!i.name){i.name="data_"+t++}r.setSource(i.name);if(r.numChildren()===1){e.push(i);var l={name:null,source:i.name,transform:[]};i=l}}}switch(r.numChildren()){case 0:if(r instanceof OutputNode&&(!i.source||i.transform.length>0)){e.push(i)}break;case 1:n(r.children[0],i);break;default:{if(!i.name){i.name="data_"+t++}var f=i.name;if(!i.source||i.transform.length>0){e.push(i)}else{f=i.source}for(var c=0,d=r.children;c<d.length;c++){var p=d[c];var l={name:null,source:f,transform:[]};n(p,l)}break}}}return n}function assembleFacetData(e){var t=[];var n=makeWalkTree(t);for(var r=0,i=e.children;r<i.length;r++){var a=i[r];n(a,{source:e.name,name:null,transform:[]})}return t}function assembleRootData(e,t){var n,r;var i=[];var a=makeWalkTree(i);var o=0;for(var s=0,u=e.sources;s<u.length;s++){var l=u[s];if(!l.hasName()){l.dataName="source_"+o++}var f=l.assemble();a(l,f)}for(var c=0,d=i;c<d.length;c++){var p=d[c];if(p.transform.length===0){delete p.transform}}var h=0;for(var g=0,m=i.entries();g<m.length;g++){var v=m[g],y=v[0],p=v[1];if(((n=p.transform)!==null&&n!==void 0?n:[]).length===0&&!p.source){i.splice(h++,0,i.splice(y,1)[0])}}for(var _=0,b=i;_<b.length;_++){var p=b[_];for(var x=0,E=(r=p.transform)!==null&&r!==void 0?r:[];x<E.length;x++){var S=E[x];if(S.type==="lookup"){S.from=e.outputNodes[S.from].getSource()}}}for(var $=0,A=i;$<A.length;$++){var p=A[$];if(p.name in t){p.values=t[p.name]}}return i}function getHeaderType(e){if(e==="top"||e==="left"||isSignalRef(e)){return"header"}return"footer"}function parseFacetHeaders(e){for(var t=0,n=FACET_CHANNELS;t<n.length;t++){var r=n[t];parseFacetHeader(e,r)}mergeChildAxis(e,"x");mergeChildAxis(e,"y")}function parseFacetHeader(e,t){var n;var r;var i=e.facet,a=e.config,o=e.child,s=e.component;if(e.channelHasField(t)){var u=i[t];var l=getHeaderProperty("title",null,a,t);var f=title(u,a,{allowDisabling:true,includeDefault:l===undefined||!!l});if(o.component.layoutHeaders[t].title){f=isArray(f)?f.join(", "):f;f+=" / "+o.component.layoutHeaders[t].title;o.component.layoutHeaders[t].title=null}var c=getHeaderProperty("labelOrient",u.header,a,t);var d=u.header!==null?getFirstDefined((r=u.header)===null||r===void 0?void 0:r.labels,a.header.labels,true):false;var p=contains(["bottom","right"],c)?"footer":"header";s.layoutHeaders[t]=(n={title:u.header!==null?f:null,facetFieldDef:u},n[p]=t==="facet"?[]:[makeHeaderComponent(e,t,d)],n)}}function makeHeaderComponent(e,t,n){var r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):undefined,axes:[]}}function mergeChildAxis(e,t){var n;var r=e.child;if(r.component.axes[t]){var i=e.component,a=i.layoutHeaders,o=i.resolve;o.axis[t]=parseGuideResolve(o,t);if(o.axis[t]==="shared"){var s=t==="x"?"column":"row";var u=a[s];for(var l=0,f=r.component.axes[t];l<f.length;l++){var c=f[l];var d=getHeaderType(c.get("orient"));(n=u[d])!==null&&n!==void 0?n:u[d]=[makeHeaderComponent(e,s,false)];var p=assembleAxis(c,"main",e.config,{header:true});if(p){u[d][0].axes.push(p)}c.mainExtracted=true}}}}function parseLayerLayoutSize(e){parseChildrenLayoutSize(e);parseNonUnitLayoutSizeForChannel(e,"width");parseNonUnitLayoutSizeForChannel(e,"height")}function parseConcatLayoutSize(e){parseChildrenLayoutSize(e);var t=e.layout.columns===1?"width":"childWidth";var n=e.layout.columns===undefined?"height":"childHeight";parseNonUnitLayoutSizeForChannel(e,t);parseNonUnitLayoutSizeForChannel(e,n)}function parseChildrenLayoutSize(e){for(var t=0,n=e.children;t<n.length;t++){var r=n[t];r.parseLayoutSize()}}function parseNonUnitLayoutSizeForChannel(e,t){var n;var r=getSizeTypeFromLayoutSizeType(t);var i=getPositionScaleChannel(r);var a=e.component.resolve;var o=e.component.layoutSize;var s;for(var u=0,l=e.children;u<l.length;u++){var f=l[u];var c=f.component.layoutSize.getWithExplicit(r);var d=(n=a.scale[i])!==null&&n!==void 0?n:defaultScaleResolve(i,e);if(d==="independent"&&c.value==="step"){s=undefined;break}if(s){if(d==="independent"&&s.value!==c.value){s=undefined;break}s=mergeValuesWithExplicit(s,c,r,"")}else{s=c}}if(s){for(var p=0,h=e.children;p<h.length;p++){var f=h[p];e.renameSignal(f.getName(r),e.getName(t));f.component.layoutSize.set(r,"merged",false)}o.setWithExplicit(t,s)}else{o.setWithExplicit(t,{explicit:false,value:undefined})}}function parseUnitLayoutSize(e){var t=e.size,n=e.component;for(var r=0,i=POSITION_SCALE_CHANNELS;r<i.length;r++){var a=i[r];var o=getSizeChannel$1(a);if(t[o]){var s=t[o];n.layoutSize.set(o,isStep(s)?"step":s,true)}else{var u=defaultUnitSize(e,o);n.layoutSize.set(o,u,false)}}}function defaultUnitSize(e,t){var n=t==="width"?"x":"y";var r=e.config;var i=e.getScaleComponent(n);if(i){var a=i.get("type");var o=i.get("range");if(hasDiscreteDomain(a)){var s=getViewConfigDiscreteSize(r.view,t);if(isVgRangeStep(o)||isStep(s)){return"step"}else{return s}}else{return getViewConfigContinuousSize(r.view,t)}}else if(e.hasProjection||e.mark==="arc"){return getViewConfigContinuousSize(r.view,t)}else{var s=getViewConfigDiscreteSize(r.view,t);return isStep(s)?s.step:s}}function facetSortFieldName(e,t,n){return vgField(t,__assign({suffix:"by_"+vgField(e)},n!==null&&n!==void 0?n:{}))}var FacetModel=function(e){__extends(t,e);function t(t,n,r,i){var a=e.call(this,t,"facet",n,r,i,t.resolve)||this;a.child=buildModel(t.spec,a,a.getName("child"),undefined,i);a.children=[a.child];a.facet=a.initFacet(t.facet);return a}t.prototype.initFacet=function(e){if(!isFacetMapping(e)){return{facet:this.initFacetFieldDef(e,"facet")}}var t=keys$1(e);var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];if(![ROW,COLUMN].includes(a)){warn(incompatibleChannel(a,"facet"));break}var o=e[a];if(o.field===undefined){warn(emptyFieldDef(o,a));break}n[a]=this.initFacetFieldDef(o,a)}return n};t.prototype.initFacetFieldDef=function(e,t){var n=initFieldDef(e,t);if(n.header){n.header=replaceExprRef(n.header)}else if(n.header===null){n.header=null}return n};t.prototype.channelHasField=function(e){return!!this.facet[e]};t.prototype.fieldDef=function(e){return this.facet[e]};t.prototype.parseData=function(){this.component.data=parseData(this);this.child.parseData()};t.prototype.parseLayoutSize=function(){parseChildrenLayoutSize(this)};t.prototype.parseSelections=function(){this.child.parseSelections();this.component.selection=this.child.component.selection};t.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()};t.prototype.parseAxesAndHeaders=function(){this.child.parseAxesAndHeaders();parseFacetHeaders(this)};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)};t.prototype.assembleSignals=function(){this.child.assembleSignals();return[]};t.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)};t.prototype.getHeaderLayoutMixins=function(){var e,t,n;var r={};for(var i=0,a=FACET_CHANNELS;i<a.length;i++){var o=a[i];for(var s=0,u=HEADER_TYPES;s<u.length;s++){var l=u[s];var f=this.component.layoutHeaders[o];var c=f[l];var d=f.facetFieldDef;if(d){var p=getHeaderProperty("titleOrient",d.header,this.config,o);if(["right","bottom"].includes(p)){var h=getHeaderChannel(o,p);(e=r.titleAnchor)!==null&&e!==void 0?e:r.titleAnchor={};r.titleAnchor[h]="end"}}if(c===null||c===void 0?void 0:c[0]){var g=o==="row"?"height":"width";var m=l==="header"?"headerBand":"footerBand";if(o!=="facet"&&!this.child.component.layoutSize.get(g)){(t=r[m])!==null&&t!==void 0?t:r[m]={};r[m][o]=.5}if(f.title){(n=r.offset)!==null&&n!==void 0?n:r.offset={};r.offset[o==="row"?"rowTitle":"columnTitle"]=10}}}}return r};t.prototype.assembleDefaultLayout=function(){var e=this.facet,t=e.column,n=e.row;var r=t?this.columnDistinctSignal():n?1:undefined;var i="all";if(!n&&this.component.resolve.scale.x==="independent"){i="none"}else if(!t&&this.component.resolve.scale.y==="independent"){i="none"}return __assign(__assign(__assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})};t.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()};t.prototype.columnDistinctSignal=function(){if(this.parent&&this.parent instanceof t){return undefined}else{var e=this.getName("column_domain");return{signal:"length(data('"+e+"'))"}}};t.prototype.assembleGroup=function(n){if(this.parent&&this.parent instanceof t){return __assign(__assign({},this.channelHasField("column")?{encode:{update:{columns:{field:vgField(this.facet.column,{prefix:"distinct"})}}}}:{}),e.prototype.assembleGroup.call(this,n))}return e.prototype.assembleGroup.call(this,n)};t.prototype.getCardinalityAggregateForChild=function(){var e=[];var n=[];var r=[];if(this.child instanceof t){if(this.child.channelHasField("column")){var i=vgField(this.child.facet.column);e.push(i);n.push("distinct");r.push("distinct_"+i)}}else{for(var a=0,o=POSITION_SCALE_CHANNELS;a<o.length;a++){var s=o[a];var u=this.child.component.scales[s];if(u&&!u.merged){var l=u.get("type");var f=u.get("range");if(hasDiscreteDomain(l)&&isVgRangeStep(f)){var c=assembleDomain(this.child,s);var d=getFieldFromDomain(c);if(d){e.push(d);n.push("distinct");r.push("distinct_"+d)}else{warn(unknownField(s))}}}}}return{fields:e,ops:n,as:r}};t.prototype.assembleFacet=function(){var e=this.component.data.facetRoot,t=e.name,n=e.data;var r=this.facet,i=r.row,a=r.column;var o=this.getCardinalityAggregateForChild(),s=o.fields,u=o.ops,l=o.as;var f=[];for(var c=0,d=FACET_CHANNELS;c<d.length;c++){var p=d[c];var h=this.facet[p];if(h){f.push(vgField(h));var g=h.bin,m=h.sort;if(isBinning(g)){f.push(vgField(h,{binSuffix:"end"}))}if(isSortField(m)){var v=m.field,y=m.op,_=y===void 0?DEFAULT_SORT_OP:y;var b=facetSortFieldName(h,m);if(i&&a){s.push(b);u.push("max");l.push(b)}else{s.push(v);u.push(_);l.push(b)}}else if(isArray(m)){var b=sortArrayIndexField(h,p);s.push(b);u.push("max");l.push(b)}}}var x=!!i&&!!a;return __assign({name:t,data:n,groupby:f},x||s.length>0?{aggregate:__assign(__assign({},x?{cross:x}:{}),s.length?{fields:s,ops:u,as:l}:{})}:{})};t.prototype.facetSortFields=function(e){var t=this.facet;var n=t[e];if(n){if(isSortField(n.sort)){return[facetSortFieldName(n,n.sort,{expr:"datum"})]}else if(isArray(n.sort)){return[sortArrayIndexField(n,e,{expr:"datum"})]}return[vgField(n,{expr:"datum"})]}return[]};t.prototype.facetSortOrder=function(e){var t=this.facet;var n=t[e];if(n){var r=n.sort;var i=(isSortField(r)?r.order:!isArray(r)&&r)||"ascending";return[i]}return[]};t.prototype.assembleLabelTitle=function(){var e;var t=this,n=t.facet,r=t.config;if(n.facet){return assembleLabelTitle(n.facet,"facet",r)}var i={row:["top","bottom"],column:["left","right"]};for(var a=0,o=HEADER_CHANNELS;a<o.length;a++){var s=o[a];if(n[s]){var u=getHeaderProperty("labelOrient",(e=n[s])===null||e===void 0?void 0:e.header,r,s);if(i[s].includes(u)){return assembleLabelTitle(n[s],s,r)}}}return undefined};t.prototype.assembleMarks=function(){var e=this;var t=this.child;var n=this.component.data.facetRoot;var r=assembleFacetData(n);var i=t.assembleGroupEncodeEntry(false);var a=this.assembleLabelTitle()||t.assembleTitle();var o=t.assembleGroupStyle();var s=__assign(__assign(__assign(__assign(__assign(__assign({name:this.getName("cell"),type:"group"},a?{title:a}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:FACET_CHANNELS.map((function(t){return e.facetSortFields(t)})).flat(),order:FACET_CHANNELS.map((function(t){return e.facetSortOrder(t)})).flat()}}),r.length>0?{data:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup(assembleFacetSignals(this,[])));return[s]};t.prototype.getMapping=function(){return this.facet};return t}(ModelWithField);function makeJoinAggregateFromFacet(e,t){var n=t.row,r=t.column;if(n&&r){var i=null;for(var a=0,o=[n,r];a<o.length;a++){var s=o[a];if(isSortField(s.sort)){var u=s.sort,l=u.field,f=u.op,c=f===void 0?DEFAULT_SORT_OP:f;e=i=new JoinAggregateTransformNode(e,{joinaggregate:[{op:c,field:l,as:facetSortFieldName(s,s.sort,{forAs:true})}],groupby:[vgField(s)]})}}return i}return null}function findSource(e,t){var n,r,i,a;for(var o=0,s=t;o<s.length;o++){var u=s[o];var l=u.data;if(e.name&&u.hasName()&&e.name!==u.dataName){continue}var f=(n=e["format"])===null||n===void 0?void 0:n.mesh;var c=(r=l.format)===null||r===void 0?void 0:r.feature;if(f&&c){continue}var d=(i=e["format"])===null||i===void 0?void 0:i.feature;if((d||c)&&d!==c){continue}var p=(a=l.format)===null||a===void 0?void 0:a.mesh;if((f||p)&&f!==p){continue}if(isInlineData(e)&&isInlineData(l)){if(deepEqual(e.values,l.values)){return u}}else if(isUrlData(e)&&isUrlData(l)){if(e.url===l.url){return u}}else if(isNamedData(e)){if(e.name===u.dataName){return u}}}return null}function parseRoot(e,t){if(e.data||!e.parent){if(e.data===null){var n=new SourceNode({values:[]});t.push(n);return n}var r=findSource(e.data,t);if(r){if(!isGenerator(e.data)){r.data.format=mergeDeep$1({},e.data.format,r.data.format)}if(!r.hasName()&&e.data.name){r.dataName=e.data.name}return r}else{var i=new SourceNode(e.data);t.push(i);return i}}else{return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}}function parseTransformArray(e,t,n){var r;var i,a;var o=0;for(var s=0,u=t.transforms;s<u.length;s++){var l=u[s];var f=undefined;var c=void 0;if(isCalculate(l)){c=e=new CalculateNode(e,l);f="derived"}else if(isFilter(l)){var d=getImplicitFromFilterTransform(l);c=e=(i=ParseNode.makeWithAncestors(e,{},d,n))!==null&&i!==void 0?i:e;e=new FilterNode(e,t,l.filter)}else if(isBin(l)){c=e=BinNode.makeFromTransform(e,l,t);f="number"}else if(isTimeUnit(l)){f="date";var p=n.getWithExplicit(l.field);if(p.value===undefined){e=new ParseNode(e,(r={},r[l.field]=f,r));n.set(l.field,f,false)}c=e=TimeUnitNode.makeFromTransform(e,l)}else if(isAggregate(l)){c=e=AggregateNode.makeFromTransform(e,l);f="number";if(requiresSelectionId(t)){e=new IdentifierNode(e)}}else if(isLookup(l)){c=e=LookupNode.make(e,t,l,o++);f="derived"}else if(isWindow(l)){c=e=new WindowTransformNode(e,l);f="number"}else if(isJoinAggregate(l)){c=e=new JoinAggregateTransformNode(e,l);f="number"}else if(isStack(l)){c=e=StackNode.makeFromTransform(e,l);f="derived"}else if(isFold(l)){c=e=new FoldTransformNode(e,l);f="derived"}else if(isFlatten(l)){c=e=new FlattenTransformNode(e,l);f="derived"}else if(isPivot(l)){c=e=new PivotTransformNode(e,l);f="derived"}else if(isSample(l)){e=new SampleTransformNode(e,l)}else if(isImpute(l)){c=e=ImputeNode.makeFromTransform(e,l);f="derived"}else if(isDensity(l)){c=e=new DensityTransformNode(e,l);f="derived"}else if(isQuantile(l)){c=e=new QuantileTransformNode(e,l);f="derived"}else if(isRegression(l)){c=e=new RegressionTransformNode(e,l);f="derived"}else if(isLoess(l)){c=e=new LoessTransformNode(e,l);f="derived"}else{warn(invalidTransformIgnored(l));continue}if(c&&f!==undefined){for(var h=0,g=(a=c.producedFields())!==null&&a!==void 0?a:[];h<g.length;h++){var m=g[h];n.set(m,f,false)}}}return e}function parseData(e){var t,n,r,i,a,o,s,u,l,f;var c=parseRoot(e,e.component.data.sources);var d=e.component.data,p=d.outputNodes,h=d.outputNodeRefCounts;var g=e.parent?e.parent.component.data.ancestorParse.clone():new AncestorParse;var m=e.data;if(isGenerator(m)){if(isSequenceGenerator(m)){c=new SequenceNode(c,m.sequence)}else if(isGraticuleGenerator(m)){c=new GraticuleNode(c,m.graticule)}g.parseNothing=true}else if(((t=m===null||m===void 0?void 0:m.format)===null||t===void 0?void 0:t.parse)===null){g.parseNothing=true}c=(n=ParseNode.makeExplicit(c,e,g))!==null&&n!==void 0?n:c;c=new IdentifierNode(c);var v=e.parent&&isLayerModel(e.parent);if(isUnitModel(e)||isFacetModel(e)){if(v){c=(r=BinNode.makeFromEncoding(c,e))!==null&&r!==void 0?r:c}}if(e.transforms.length>0){c=parseTransformArray(c,e,g)}var y=getImplicitFromSelection(e);var _=getImplicitFromEncoding(e);c=(i=ParseNode.makeWithAncestors(c,{},__assign(__assign({},y),_),g))!==null&&i!==void 0?i:c;if(isUnitModel(e)){c=GeoJSONNode.parseAll(c,e);c=GeoPointNode.parseAll(c,e)}if(isUnitModel(e)||isFacetModel(e)){if(!v){c=(a=BinNode.makeFromEncoding(c,e))!==null&&a!==void 0?a:c}c=(o=TimeUnitNode.makeFromEncoding(c,e))!==null&&o!==void 0?o:c;c=CalculateNode.parseAllForSortIndex(c,e)}var b=e.getDataName(DataSourceType.Raw);var x=new OutputNode(c,b,DataSourceType.Raw,h);p[b]=x;c=x;if(isUnitModel(e)){var E=AggregateNode.makeFromEncoding(c,e);if(E){c=E;if(requiresSelectionId(e)){c=new IdentifierNode(c)}}c=(s=ImputeNode.makeFromEncoding(c,e))!==null&&s!==void 0?s:c;c=(u=StackNode.makeFromEncoding(c,e))!==null&&u!==void 0?u:c}if(isUnitModel(e)){c=(l=FilterInvalidNode.make(c,e))!==null&&l!==void 0?l:c}var S=e.getDataName(DataSourceType.Main);var $=new OutputNode(c,S,DataSourceType.Main,h);p[S]=$;c=$;if(isUnitModel(e)){materializeSelections(e,$)}var A=null;if(isFacetModel(e)){var D=e.getName("facet");c=(f=makeJoinAggregateFromFacet(c,e.facet))!==null&&f!==void 0?f:c;A=new FacetNode(c,e,D,$.getSource());p[D]=A}return __assign(__assign({},e.component.data),{outputNodes:p,outputNodeRefCounts:h,raw:x,main:$,facetRoot:A,ancestorParse:g})}var ConcatModel=function(e){__extends(t,e);function t(t,n,r,i){var a,o,s,u;var l=e.call(this,t,"concat",n,r,i,t.resolve)||this;if(((o=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||o===void 0?void 0:o.x)==="shared"||((u=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||u===void 0?void 0:u.y)==="shared"){warn(CONCAT_CANNOT_SHARE_AXIS)}l.children=l.getChildren(t).map((function(e,t){return buildModel(e,l,l.getName("concat_"+t),undefined,i)}));return l}t.prototype.parseData=function(){this.component.data=parseData(this);for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseData()}};t.prototype.parseSelections=function(){this.component.selection={};for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseSelections();for(var r=0,i=keys$1(n.component.selection);r<i.length;r++){var a=i[r];this.component.selection[a]=n.component.selection[a]}}};t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseMarkGroup()}};t.prototype.parseAxesAndHeaders=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseAxesAndHeaders()}};t.prototype.getChildren=function(e){if(isVConcatSpec(e)){return e.vconcat}else if(isHConcatSpec(e)){return e.hconcat}return e.concat};t.prototype.parseLayoutSize=function(){parseConcatLayoutSize(this)};t.prototype.parseAxisGroup=function(){return null};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce((function(e,t){return t.assembleSelectionTopLevelSignals(e)}),e)};t.prototype.assembleSignals=function(){this.children.forEach((function(e){return e.assembleSignals()}));return[]};t.prototype.assembleLayoutSignals=function(){var e=assembleLayoutSignals(this);for(var t=0,n=this.children;t<n.length;t++){var r=n[t];e.push.apply(e,r.assembleLayoutSignals())}return e};t.prototype.assembleSelectionData=function(e){return this.children.reduce((function(e,t){return t.assembleSelectionData(e)}),e)};t.prototype.assembleMarks=function(){return this.children.map((function(e){var t=e.assembleTitle();var n=e.assembleGroupStyle();var r=e.assembleGroupEncodeEntry(false);return __assign(__assign(__assign(__assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))};t.prototype.assembleDefaultLayout=function(){var e=this.layout.columns;return __assign(__assign({},e!=null?{columns:e}:{}),{bounds:"full",align:"each"})};return t}(Model);function isFalseOrNull(e){return e===false||e===null}var AXIS_COMPONENT_PROPERTIES_INDEX=__assign(__assign({disable:1,gridScale:1,scale:1},COMMON_AXIS_PROPERTIES_INDEX),{labelExpr:1,encode:1});var AXIS_COMPONENT_PROPERTIES=keys$1(AXIS_COMPONENT_PROPERTIES_INDEX);var AxisComponent=function(e){__extends(t,e);function t(t,n,r){if(t===void 0){t={}}if(n===void 0){n={}}if(r===void 0){r=false}var i=e.call(this)||this;i.explicit=t;i.implicit=n;i.mainExtracted=r;return i}t.prototype.clone=function(){return new t(duplicate(this.explicit),duplicate(this.implicit),this.mainExtracted)};t.prototype.hasAxisPart=function(e){if(e==="axis"){return true}if(e==="grid"||e==="title"){return!!this.get(e)}return!isFalseOrNull(this.get(e))};t.prototype.hasOrientSignalRef=function(){return isSignalRef(this.explicit.orient)};return t}(Split);function labels(e,t,n){var r;var i=e.encoding,a=e.config;var o=(r=getFieldOrDatumDef(i[t]))!==null&&r!==void 0?r:getFieldOrDatumDef(i[getSecondaryRangeChannel(t)]);var s=e.axis(t)||{};var u=s.format,l=s.formatType;if(isCustomFormatType(l)){return __assign({text:formatCustomType({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:l,config:a})},n)}return n}function parseUnitAxes(e){return POSITION_SCALE_CHANNELS.reduce((function(t,n){if(e.component.scales[n]){t[n]=[parseAxis(n,e)]}return t}),{})}var OPPOSITE_ORIENT={bottom:"top",top:"bottom",left:"right",right:"left"};function parseLayerAxes(e){var t;var n=e.component,r=n.axes,i=n.resolve;var a={top:0,bottom:0,right:0,left:0};for(var o=0,s=e.children;o<s.length;o++){var u=s[o];u.parseAxesAndHeaders();for(var l=0,f=keys$1(u.component.axes);l<f.length;l++){var c=f[l];i.axis[c]=parseGuideResolve(e.component.resolve,c);if(i.axis[c]==="shared"){r[c]=mergeAxisComponents(r[c],u.component.axes[c]);if(!r[c]){i.axis[c]="independent";delete r[c]}}}}for(var d=0,p=POSITION_SCALE_CHANNELS;d<p.length;d++){var c=p[d];for(var h=0,g=e.children;h<g.length;h++){var u=g[h];if(!u.component.axes[c]){continue}if(i.axis[c]==="independent"){r[c]=((t=r[c])!==null&&t!==void 0?t:[]).concat(u.component.axes[c]);for(var m=0,v=u.component.axes[c];m<v.length;m++){var y=v[m];var _=y.getWithExplicit("orient"),b=_.value,x=_.explicit;if(isSignalRef(b)){continue}if(a[b]>0&&!x){var E=OPPOSITE_ORIENT[b];if(a[b]>a[E]){y.set("orient",E,false)}}a[b]++}}delete u.component.axes[c]}if(i.axis[c]==="independent"&&r[c]&&r[c].length>1){for(var S=0,$=r[c];S<$.length;S++){var A=$[S];if(!!A.get("grid")&&!A.explicit.grid){A.implicit.grid=false}}}}}function mergeAxisComponents(e,t){if(e){if(e.length!==t.length){return undefined}var n=e.length;for(var r=0;r<n;r++){var i=e[r];var a=t[r];if(!!i!==!!a){return undefined}else if(i&&a){var o=i.getWithExplicit("orient");var s=a.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value){return undefined}else{e[r]=mergeAxisComponent(i,a)}}}}else{return t.map((function(e){return e.clone()}))}return e}function mergeAxisComponent(e,t){var n=function(n){var r=mergeValuesWithExplicit(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(function(e,t){switch(n){case"title":return mergeTitleComponent(e,t);case"gridScale":return{explicit:e.explicit,value:getFirstDefined(e.value,t.value)}}return defaultTieBreaker(e,t,n,"axis")}));e.setWithExplicit(n,r)};for(var r=0,i=AXIS_COMPONENT_PROPERTIES;r<i.length;r++){var a=i[r];n(a)}return e}function isExplicit(e,t,n,r,i){if(t==="disable"){return n!==undefined}n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(isSignalRef(n.labelAngle)?n.labelAngle:normalizeAngle(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===getFieldDefTitle(r,i)){return true}}return e===n[t]}var propsToAlwaysIncludeConfig=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function parseAxis(e,t){var n,r,i;var a=t.axis(e);var o=new AxisComponent;var s=getFieldOrDatumDef(t.encoding[e]);var u=t.mark,l=t.config;var f=(a===null||a===void 0?void 0:a.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((r=l.axis)===null||r===void 0?void 0:r.orient)||defaultOrient(e);var c=t.getScaleComponent(e).get("type");var d=getAxisConfigs(e,c,f,t.config);var p=a!==undefined?!a:getAxisConfig("disable",l.style,a===null||a===void 0?void 0:a.style,d).configValue;o.set("disable",p,a!==undefined);if(p){return o}a=a||{};var h=getLabelAngle(s,a,e,l.style,d);var g={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:c,orient:f,labelAngle:h,mark:u,config:l};for(var m=0,v=AXIS_COMPONENT_PROPERTIES;m<v.length;m++){var y=v[m];var _=y in axisRules?axisRules[y](g):isAxisProperty(y)?a[y]:undefined;var b=_!==undefined;var x=isExplicit(_,y,a,t,e);if(b&&x){o.set(y,_,x)}else{var E=isAxisProperty(y)&&y!=="values"?getAxisConfig(y,l.style,a.style,d):{},S=E.configValue,$=S===void 0?undefined:S,A=E.configFrom,D=A===void 0?undefined:A;var w=$!==undefined;if(b&&!w){o.set(y,_,x)}else if(!(D==="vgAxisConfig")||propsToAlwaysIncludeConfig.has(y)&&w||isConditionalAxisValue($)||isSignalRef($)){o.set(y,$,false)}}}var C=(i=a.encoding)!==null&&i!==void 0?i:{};var T=AXIS_PARTS.reduce((function(n,r){var i;if(!o.hasAxisPart(r)){return n}var a=guideEncodeEntry((i=C[r])!==null&&i!==void 0?i:{},t);var s=r==="labels"?labels(t,e,a):a;if(s!==undefined&&!isEmpty(s)){n[r]={update:s}}return n}),{});if(!isEmpty(T)){o.set("encode",T,!!a.encoding||a.labelAngle!==undefined)}return o}function initLayoutSize(e){var t=e.encoding,n=e.size;for(var r=0,i=POSITION_SCALE_CHANNELS;r<i.length;r++){var a=i[r];var o=getSizeChannel$1(a);if(isStep(n[o])){if(isContinuousFieldOrDatumDef(t[a])){delete n[o];warn(stepDropped(o))}}}return n}function initMarkdef(e,t,n){var r=replaceExprRef(e);var i=getMarkPropOrConfig("orient",r,n);r.orient=orient(r.type,t,i);if(i!==undefined&&i!==r.orient){warn(orientOverridden(r.orient,i))}if(r.type==="bar"&&r.orient){var a=getMarkPropOrConfig("cornerRadiusEnd",r,n);if(a!==undefined){var o=r.orient==="horizontal"&&t.x2||r.orient==="vertical"&&t.y2?["cornerRadius"]:BAR_CORNER_RADIUS_INDEX[r.orient];for(var s=0,u=o;s<u.length;s++){var l=u[s];r[l]=a}if(r.cornerRadiusEnd!==undefined){delete r.cornerRadiusEnd}}}var f=getMarkPropOrConfig("opacity",r,n);if(f===undefined){r.opacity=opacity(r.type,t)}var c=getMarkPropOrConfig("cursor",r,n);if(c===undefined){r.cursor=cursor(r,t,n)}return r}function cursor(e,t,n){if(t.href||e.href||getMarkPropOrConfig("href",e,n)){return"pointer"}return e.cursor}function opacity(e,t){if(contains([POINT,TICK,CIRCLE,SQUARE],e)){if(!isAggregate$1(t)){return.7}}return undefined}function defaultFilled(e,t,n){var r=n.graticule;if(r){return false}var i=getMarkConfig("filled",e,t);var a=e.type;return getFirstDefined(i,a!==POINT&&a!==LINE&&a!==RULE)}function orient(e,t,n){switch(e){case POINT:case CIRCLE:case SQUARE:case TEXT:case RECT:case IMAGE:return undefined}var r=t.x,i=t.y,a=t.x2,o=t.y2;switch(e){case BAR:if(isFieldDef(r)&&(isBinned(r.bin)||isFieldDef(i)&&i.aggregate&&!r.aggregate)){return"vertical"}if(isFieldDef(i)&&(isBinned(i.bin)||isFieldDef(r)&&r.aggregate&&!i.aggregate)){return"horizontal"}if(o||a){if(n){return n}if(!a){if(isFieldDef(r)&&r.type===QUANTITATIVE&&!isBinning(r.bin)||isNumericDataDef(r)){return"horizontal"}}if(!o){if(isFieldDef(i)&&i.type===QUANTITATIVE&&!isBinning(i.bin)||isNumericDataDef(i)){return"vertical"}}}case RULE:if(a&&!(isFieldDef(r)&&isBinned(r.bin))&&o&&!(isFieldDef(i)&&isBinned(i.bin))){return undefined}case AREA:if(o){if(isFieldDef(i)&&isBinned(i.bin)){return"horizontal"}else{return"vertical"}}else if(a){if(isFieldDef(r)&&isBinned(r.bin)){return"vertical"}else{return"horizontal"}}else if(e===RULE){if(r&&!i){return"vertical"}else if(i&&!r){return"horizontal"}}case LINE:case TICK:{var s=isContinuousFieldOrDatumDef(r);var u=isContinuousFieldOrDatumDef(i);if(n){return n}else if(s&&!u){return e!=="tick"?"horizontal":"vertical"}else if(!s&&u){return e!=="tick"?"vertical":"horizontal"}else if(s&&u){var l=r;var f=i;var c=l.type===TEMPORAL;var d=f.type===TEMPORAL;if(c&&!d){return e!=="tick"?"vertical":"horizontal"}else if(!c&&d){return e!=="tick"?"horizontal":"vertical"}if(!l.aggregate&&f.aggregate){return e!=="tick"?"vertical":"horizontal"}else if(l.aggregate&&!f.aggregate){return e!=="tick"?"horizontal":"vertical"}return"vertical"}else{return undefined}}}return"vertical"}var arc={vgMark:"arc",encodeEntry:function(e){return __assign(__assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),pointPosition("x",e,{defaultPos:"mid"})),pointPosition("y",e,{defaultPos:"mid"})),rectPosition(e,"radius","arc")),rectPosition(e,"theta","arc"))}};var area={vgMark:"area",encodeEntry:function(e){return __assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),pointOrRangePosition("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),pointOrRangePosition("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),defined(e))}};var bar={vgMark:"rect",encodeEntry:function(e){return __assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),rectPosition(e,"x","bar")),rectPosition(e,"y","bar"))}};var geoshape={vgMark:"shape",encodeEntry:function(e){return __assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}))},postEncodingTransform:function(e){var t=e.encoding;var n=t.shape;var r=__assign({type:"geoshape",projection:e.projectionName()},n&&isFieldDef(n)&&n.type===GEOJSON?{field:vgField(n,{expr:"datum"})}:{});return[r]}};var image={vgMark:"image",encodeEntry:function(e){return __assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),rectPosition(e,"x","image")),rectPosition(e,"y","image")),text$1(e,"url"))}};var line={vgMark:"line",encodeEntry:function(e){return __assign(__assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),pointPosition("x",e,{defaultPos:"mid"})),pointPosition("y",e,{defaultPos:"mid"})),nonPosition("size",e,{vgChannel:"strokeWidth"})),defined(e))}};var trail={vgMark:"trail",encodeEntry:function(e){return __assign(__assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),pointPosition("x",e,{defaultPos:"mid"})),pointPosition("y",e,{defaultPos:"mid"})),nonPosition("size",e)),defined(e))}};function encodeEntry(e,t){var n=e.config;return __assign(__assign(__assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),pointPosition("x",e,{defaultPos:"mid"})),pointPosition("y",e,{defaultPos:"mid"})),nonPosition("size",e)),nonPosition("angle",e)),shapeMixins(e,n,t))}function shapeMixins(e,t,n){if(n){return{shape:{value:n}}}return nonPosition("shape",e)}var point={vgMark:"symbol",encodeEntry:function(e){return encodeEntry(e)}};var circle={vgMark:"symbol",encodeEntry:function(e){return encodeEntry(e,"circle")}};var square={vgMark:"symbol",encodeEntry:function(e){return encodeEntry(e,"square")}};var rect={vgMark:"rect",encodeEntry:function(e){return __assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),rectPosition(e,"x","rect")),rectPosition(e,"y","rect"))}};var rule={vgMark:"rule",encodeEntry:function(e){var t=e.markDef;var n=t.orient;if(!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude){return{}}return __assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),pointOrRangePosition("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),pointOrRangePosition("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),nonPosition("size",e,{vgChannel:"strokeWidth"}))}};var text={vgMark:"text",encodeEntry:function(e){var t=e.config,n=e.encoding;return __assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),pointPosition("x",e,{defaultPos:"mid"})),pointPosition("y",e,{defaultPos:"mid"})),text$1(e)),nonPosition("size",e,{vgChannel:"fontSize"})),nonPosition("angle",e)),valueIfDefined("align",align(e.markDef,n,t))),valueIfDefined("baseline",baseline(e.markDef,n,t))),pointPosition("radius",e,{defaultPos:null})),pointPosition("theta",e,{defaultPos:null}))}};function align(e,t,n){var r=getMarkPropOrConfig("align",e,n);if(r===undefined){return"center"}return undefined}function baseline(e,t,n){var r=getMarkPropOrConfig("baseline",e,n);if(r===undefined){return"middle"}return undefined}var tick={vgMark:"rect",encodeEntry:function(e){var t;var n=e.config,r=e.markDef;var i=r.orient;var a=i==="horizontal"?"width":"height";var o=i==="horizontal"?"height":"width";return __assign(__assign(__assign(__assign(__assign({},baseEncodeEntry(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),pointPosition("x",e,{defaultPos:"mid",vgChannel:"xc"})),pointPosition("y",e,{defaultPos:"mid",vgChannel:"yc"})),nonPosition("size",e,{defaultValue:defaultSize(e),vgChannel:a})),(t={},t[o]=signalOrValueRef(getMarkPropOrConfig("thickness",r,n)),t))}};function defaultSize(e){var t;var n=e.config,r=e.markDef;var i=r.orient;var a=i==="horizontal"?"width":"height";var o=e.getScaleComponent(i==="horizontal"?"x":"y");var s=(t=getMarkPropOrConfig("size",r,n,{vgChannel:a}))!==null&&t!==void 0?t:n.tick.bandSize;if(s!==undefined){return s}else{var u=o?o.get("range"):undefined;if(u&&isVgRangeStep(u)&&isNumber$1(u.step)){return u.step*3/4}var l=getViewConfigDiscreteStep(n.view,a);return l*3/4}}var markCompiler={arc:arc,area:area,bar:bar,circle:circle,geoshape:geoshape,image:image,line:line,point:point,rect:rect,rule:rule,square:square,text:text,tick:tick,trail:trail};function parseMarkGroups(e){if(contains([LINE,AREA,TRAIL],e.mark)){var t=pathGroupingFields(e.mark,e.encoding);if(t.length>0){return getPathGroups(e,t)}}else if(e.mark===BAR){var n=VG_CORNERRADIUS_CHANNELS.some((function(t){return getMarkPropOrConfig(t,e.markDef,e.config)}));if(e.stack&&!e.fieldDef("size")&&n){return getGroupsForStackedBarWithCornerRadius(e)}}return getMarkGroup(e)}var FACETED_PATH_PREFIX="faceted_path_";function getPathGroups(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:FACETED_PATH_PREFIX+e.requestDataName(DataSourceType.Main),data:e.requestDataName(DataSourceType.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:getMarkGroup(e,{fromPrefix:FACETED_PATH_PREFIX})}]}var STACK_GROUP_PREFIX="stack_group_";function getGroupsForStackedBarWithCornerRadius(e){var t=getMarkGroup(e,{fromPrefix:STACK_GROUP_PREFIX})[0];var n=e.scaleName(e.stack.fieldChannel);var r=function(t){if(t===void 0){t={}}return e.vgField(e.stack.fieldChannel,t)};var i=function(e,t){var i=[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})];return e+"("+i.map((function(e){return"scale('"+n+"',"+e+")"})).join(",")+")"};var a;var o;if(e.stack.fieldChannel==="x"){a=__assign(__assign({},pick(t.encode.update,__spreadArray(["y","yc","y2","height"],VG_CORNERRADIUS_CHANNELS))),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:true}});o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}};t.encode.update=__assign(__assign({},omit(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})}else{a=__assign(__assign({},pick(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:true}});o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}};t.encode.update=__assign(__assign({},omit(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}})}for(var s=0,u=VG_CORNERRADIUS_CHANNELS;s<u.length;s++){var l=u[s];var f=getMarkConfig(l,e.markDef,e.config);if(t.encode.update[l]){a[l]=t.encode.update[l];delete t.encode.update[l]}else if(f){a[l]=signalOrValueRef(f)}if(f){t.encode.update[l]={value:0}}}var c=[];if(e.stack.groupbyChannel){var d=e.fieldDef(e.stack.groupbyChannel);var p=vgField(d);if(p){c.push(p)}if((d===null||d===void 0?void 0:d.bin)||(d===null||d===void 0?void 0:d.timeUnit)){c.push(vgField(d,{binSuffix:"end"}))}}var h=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];a=h.reduce((function(n,r){var i,a;if(t.encode.update[r]){return __assign(__assign({},n),(i={},i[r]=t.encode.update[r],i))}else{var o=getMarkConfig(r,e.markDef,e.config);if(o!==undefined){return __assign(__assign({},n),(a={},a[r]=signalOrValueRef(o),a))}else{return n}}}),a);if(a.stroke){a.strokeForeground={value:true};a.strokeOffset={value:0}}return[{type:"group",from:{facet:{data:e.requestDataName(DataSourceType.Main),name:STACK_GROUP_PREFIX+e.requestDataName(DataSourceType.Main),groupby:c,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function getSort(e){var t=e.encoding,n=e.stack,r=e.mark,i=e.markDef,a=e.config;var o=t.order;if(!isArray(o)&&isValueDef(o)&&isNullOrFalse(o.value)||!o&&isNullOrFalse(getMarkPropOrConfig("order",i,a))){return undefined}else if((isArray(o)||isFieldDef(o))&&!n){return sortParams(o,{expr:"datum"})}else if(isPathMark(r)){var s=i.orient==="horizontal"?"y":"x";var u=t[s];if(isFieldDef(u)){var l=u.sort;if(isArray(l)){return{field:vgField(u,{prefix:s,suffix:"sort_index",expr:"datum"})}}else if(isSortField(l)){return{field:vgField({aggregate:isAggregate$1(e.encoding)?l.op:undefined,field:l.field},{expr:"datum"})}}else if(isSortByEncoding(l)){var f=e.fieldDef(l.encoding);return{field:vgField(f,{expr:"datum"}),order:l.order}}else if(l===null){return undefined}else{return{field:vgField(u,{binSuffix:e.stack&&e.stack.impute?"mid":undefined,expr:"datum"})}}}return undefined}return undefined}function getMarkGroup(e,t){if(t===void 0){t={fromPrefix:""}}var n=e.mark,r=e.markDef,i=e.encoding,a=e.config;var o=getFirstDefined(r.clip,scaleClip(e),projectionClip(e));var s=getStyles(r);var u=i.key;var l=getSort(e);var f=interactiveFlag(e);var c=getMarkPropOrConfig("aria",r,a);var d=markCompiler[n].postEncodingTransform?markCompiler[n].postEncodingTransform(e):null;return[__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign({name:e.getName("marks"),type:markCompiler[n].vgMark},o?{clip:true}:{}),s?{style:s}:{}),u?{key:u.field}:{}),l?{sort:l}:{}),f?f:{}),c===false?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(DataSourceType.Main)},encode:{update:markCompiler[n].encodeEntry(e)}}),d?{transform:d}:{})]}function scaleClip(e){var t=e.getScaleComponent("x");var n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?true:undefined}function projectionClip(e){var t=e.component.projection;return t&&!t.isFit?true:undefined}function interactiveFlag(e){if(!e.component.selection)return null;var t=keys$1(e.component.selection).length;var n=t;var r=e.parent;while(r&&n===0){n=keys$1(r.component.selection).length;r=r.parent}return n?{interactive:t>0||!!e.encoding.tooltip}:null}var UnitModel=function(e){__extends(t,e);function t(t,n,r,i,a){if(i===void 0){i={}}var o;var s=e.call(this,t,"unit",n,r,a,undefined,isFrameMixins(t)?t.view:undefined)||this;s.specifiedScales={};s.specifiedAxes={};s.specifiedLegends={};s.specifiedProjection={};s.selection=[];s.children=[];var u=isMarkDef(t.mark)?__assign({},t.mark):{type:t.mark};var l=u.type;if(u.filled===undefined){u.filled=defaultFilled(u,a,{graticule:t.data&&isGraticuleGenerator(t.data)})}var f=s.encoding=initEncoding(t.encoding||{},l,u.filled,a);s.markDef=initMarkdef(u,f,a);s.size=initLayoutSize({encoding:f,size:isFrameMixins(t)?__assign(__assign(__assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i});s.stack=stack(l,f);s.specifiedScales=s.initScales(l,f);s.specifiedAxes=s.initAxes(f);s.specifiedLegends=s.initLegends(f);s.specifiedProjection=t.projection;s.selection=((o=t.params)!==null&&o!==void 0?o:[]).filter((function(e){return isSelectionParameter(e)}));return s}Object.defineProperty(t.prototype,"hasProjection",{get:function(){var e=this.encoding;var t=this.mark===GEOSHAPE;var n=e&&GEOPOSITION_CHANNELS.some((function(t){return isFieldOrDatumDef(e[t])}));return t||n},enumerable:false,configurable:true});t.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:undefined};t.prototype.axis=function(e){return this.specifiedAxes[e]};t.prototype.legend=function(e){return this.specifiedLegends[e]};t.prototype.initScales=function(e,t){var n=this;return SCALE_CHANNELS.reduce((function(e,r){var i;var a=getFieldOrDatumDef(t[r]);if(a){e[r]=n.initScale((i=a.scale)!==null&&i!==void 0?i:{})}return e}),{})};t.prototype.initScale=function(e){var t=e.domain,n=e.range;var r=replaceExprRef(e);if(isArray(t)){r.domain=t.map(signalRefOrValue)}if(isArray(n)){r.range=n.map(signalRefOrValue)}return r};t.prototype.initAxes=function(e){var t=this;return POSITION_SCALE_CHANNELS.reduce((function(n,r){var i=e[r];if(isFieldOrDatumDef(i)||r===X&&isFieldOrDatumDef(e.x2)||r===Y&&isFieldOrDatumDef(e.y2)){var a=isFieldOrDatumDef(i)?i.axis:undefined;n[r]=a?t.initAxis(__assign({},a)):a}return n}),{})};t.prototype.initAxis=function(e){var t=keys$1(e);var n={};for(var r=0,i=t;r<i.length;r++){var a=i[r];var o=e[a];n[a]=isConditionalAxisValue(o)?signalOrValueRefWithCondition(o):signalRefOrValue(o)}return n};t.prototype.initLegends=function(e){return NONPOSITION_SCALE_CHANNELS.reduce((function(t,n){var r=getFieldOrDatumDef(e[n]);if(r&&supportLegend(n)){var i=r.legend;t[n]=i?replaceExprRef(i):i}return t}),{})};t.prototype.parseData=function(){this.component.data=parseData(this)};t.prototype.parseLayoutSize=function(){parseUnitLayoutSize(this)};t.prototype.parseSelections=function(){this.component.selection=parseUnitSelection(this,this.selection)};t.prototype.parseMarkGroup=function(){this.component.mark=parseMarkGroups(this)};t.prototype.parseAxesAndHeaders=function(){this.component.axes=parseUnitAxes(this)};t.prototype.assembleSelectionTopLevelSignals=function(e){return assembleTopLevelSignals(this,e)};t.prototype.assembleSignals=function(){return __spreadArray(__spreadArray([],assembleAxisSignals(this)),assembleUnitSelectionSignals(this,[]))};t.prototype.assembleSelectionData=function(e){return assembleUnitSelectionData(this,e)};t.prototype.assembleLayout=function(){return null};t.prototype.assembleLayoutSignals=function(){return assembleLayoutSignals(this)};t.prototype.assembleMarks=function(){var e;var t=(e=this.component.mark)!==null&&e!==void 0?e:[];if(!this.parent||!isLayerModel(this.parent)){t=assembleUnitSelectionMarks(this,t)}return t.map(this.correctDataNames)};t.prototype.getMapping=function(){return this.encoding};Object.defineProperty(t.prototype,"mark",{get:function(){return this.markDef.type},enumerable:false,configurable:true});t.prototype.channelHasField=function(e){return channelHasField(this.encoding,e)};t.prototype.fieldDef=function(e){var t=this.encoding[e];return getFieldDef(t)};t.prototype.typedFieldDef=function(e){var t=this.fieldDef(e);if(isTypedFieldDef(t)){return t}return null};return t}(ModelWithField);var LayerModel=function(e){__extends(t,e);function t(n,r,i,a,o){var s=e.call(this,n,"layer",r,i,o,n.resolve,n.view)||this;var u=__assign(__assign(__assign({},a),n.width?{width:n.width}:{}),n.height?{height:n.height}:{});s.children=n.layer.map((function(e,n){if(isLayerSpec(e)){return new t(e,s,s.getName("layer_"+n),u,o)}else if(isUnitSpec(e)){return new UnitModel(e,s,s.getName("layer_"+n),u,o)}throw new Error(invalidSpec(e))}));return s}t.prototype.parseData=function(){this.component.data=parseData(this);for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseData()}};t.prototype.parseLayoutSize=function(){parseLayerLayoutSize(this)};t.prototype.parseSelections=function(){this.component.selection={};for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseSelections();for(var r=0,i=keys$1(n.component.selection);r<i.length;r++){var a=i[r];this.component.selection[a]=n.component.selection[a]}}};t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){var n=t[e];n.parseMarkGroup()}};t.prototype.parseAxesAndHeaders=function(){parseLayerAxes(this)};t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce((function(e,t){return t.assembleSelectionTopLevelSignals(e)}),e)};t.prototype.assembleSignals=function(){return this.children.reduce((function(e,t){return e.concat(t.assembleSignals())}),assembleAxisSignals(this))};t.prototype.assembleLayoutSignals=function(){return this.children.reduce((function(e,t){return e.concat(t.assembleLayoutSignals())}),assembleLayoutSignals(this))};t.prototype.assembleSelectionData=function(e){return this.children.reduce((function(e,t){return t.assembleSelectionData(e)}),e)};t.prototype.assembleTitle=function(){var t=e.prototype.assembleTitle.call(this);if(t){return t}for(var n=0,r=this.children;n<r.length;n++){var i=r[n];t=i.assembleTitle();if(t){return t}}return undefined};t.prototype.assembleLayout=function(){return null};t.prototype.assembleMarks=function(){return assembleLayerSelectionMarks(this,this.children.flatMap((function(e){return e.assembleMarks()})))};t.prototype.assembleLegends=function(){return this.children.reduce((function(e,t){return e.concat(t.assembleLegends())}),assembleLegends(this))};return t}(Model);function buildModel(e,t,n,r,i){if(isFacetSpec(e)){return new FacetModel(e,t,n,i)}else if(isLayerSpec(e)){return new LayerModel(e,t,n,r,i)}else if(isUnitSpec(e)){return new UnitModel(e,t,n,r,i)}else if(isAnyConcatSpec(e)){return new ConcatModel(e,t,n,i)}throw new Error(invalidSpec(e))}function compile(e,t){if(t===void 0){t={}}if(t.logger){set(t.logger)}if(t.fieldTitle){setTitleFormatter(t.fieldTitle)}try{var n=initConfig(mergeConfig(t.config,e.config));var r=normalize(e,n);var i=buildModel(r,null,"",undefined,n);i.parse();optimizeDataflow(i.component.data,i);var a=assembleTopLevelModel(i,getTopLevelProperties(e,r.autosize,n,i),e.datasets,e.usermeta);return{spec:a,normalized:r}}finally{if(t.logger){reset()}if(t.fieldTitle){resetTitleFormatter()}}}function getTopLevelProperties(e,t,n,r){var i=r.component.layoutSize.get("width");var a=r.component.layoutSize.get("height");if(t===undefined){t={type:"pad"};if(r.hasAxisOrientSignalRef()){t.resize=true}}else if(isString(t)){t={type:t}}if(i&&a&&isFitType(t.type)){if(i==="step"&&a==="step"){warn(droppingFit());t.type="pad"}else if(i==="step"||a==="step"){var o=i==="step"?"width":"height";warn(droppingFit(getPositionScaleChannel(o)));var s=o==="width"?"height":"width";t.type=getFitType(s)}}return __assign(__assign(__assign({},keys$1(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),extractTopLevelProperties(n,false)),extractTopLevelProperties(e,true))}function assembleTopLevelModel(e,t,n,r){if(n===void 0){n={}}var i=e.config?stripAndRedirectConfig(e.config):undefined;var a=[].concat(e.assembleSelectionData([]),assembleRootData(e.component.data,n));var o=e.assembleProjections();var s=e.assembleTitle();var u=e.assembleGroupStyle();var l=e.assembleGroupEncodeEntry(true);var f=e.assembleLayoutSignals();f=f.filter((function(e){if((e.name==="width"||e.name==="height")&&e.value!==undefined){t[e.name]=+e.value;return false}return true}));var c=t.params,d=__rest(t,["params"]);return __assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign(__assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),s?{title:s}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup(__spreadArray(__spreadArray(__spreadArray([],f),e.assembleSelectionTopLevelSignals([])),assembleParameterSignals(c)))),i?{config:i}:{}),r?{usermeta:r}:{})}var version$2=pkg$1.version;var vegaLiteImport=Object.freeze({__proto__:null,version:version$2,compile:compile,normalize:normalize,deepEqual:deepEqual,duplicate:duplicate,pick:pick,omit:omit,stringify:stringify$1,hash:hash,isNullOrFalse:isNullOrFalse,contains:contains,some:some,every:every,mergeDeep:mergeDeep$1,unique:unique,isEqual:isEqual,setEqual:setEqual,hasIntersection:hasIntersection,prefixGenerator:prefixGenerator,fieldIntersection:fieldIntersection,isEmpty:isEmpty,keys:keys$1,vals:vals,entries:entries$1,isBoolean:isBoolean,varName:varName,logicalExpr:logicalExpr,deleteNestedProperty:deleteNestedProperty,titleCase:titleCase,accessPathWithDatum:accessPathWithDatum,flatAccessWithDatum:flatAccessWithDatum,replacePathInField:replacePathInField,replaceAll:replaceAll,removePathFromField:removePathFromField,accessPathDepth:accessPathDepth,getFirstDefined:getFirstDefined,uniqueId:uniqueId,resetIdCounter:resetIdCounter,internalField:internalField,isInternalField:isInternalField,normalizeAngle:normalizeAngle,isNumeric:isNumeric});function e(e){var t=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3),n=t[0],r=t[1];return{library:n,version:r}}var name="vega-themes";var version="2.10.0";var description="Themes for stylized Vega and Vega-Lite visualizations.";var keywords=["vega","vega-lite","themes","style"];var license="BSD-3-Clause";var author={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"};var contributors=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}];var main="build/vega-themes.js";var module="build/vega-themes.module.js";var unpkg="build/vega-themes.min.js";var jsdelivr="build/vega-themes.min.js";var types="build/vega-themes.module.d.ts";var repository={type:"git",url:"https://github.com/vega/vega-themes.git"};var files=["src","build"];var scripts={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",prepare:"beemo create-config",eslintbase:"beemo eslint .",format:"yarn eslintbase --fix",lint:"yarn eslintbase"};var devDependencies={"@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0","@wessberg/rollup-plugin-ts":"^1.3.8","browser-sync":"^2.26.14",concurrently:"^6.0.0","gh-pages":"^3.1.0",rollup:"^2.39.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-terser":"^7.0.2",typescript:"^4.2.2",vega:"^5.19.1","vega-lite":"^5.0.0","vega-lite-dev-config":"^0.16.1"};var peerDependencies={vega:"*","vega-lite":"*"};var pkg={name:name,version:version,description:description,keywords:keywords,license:license,author:author,contributors:contributors,main:main,module:module,unpkg:unpkg,jsdelivr:jsdelivr,types:types,repository:repository,files:files,scripts:scripts,devDependencies:devDependencies,peerDependencies:peerDependencies};var lightColor="#fff";var medColor="#888";var darkTheme={background:"#333",title:{color:lightColor,subtitleColor:lightColor},style:{"guide-label":{fill:lightColor},"guide-title":{fill:lightColor}},axis:{domainColor:lightColor,gridColor:medColor,tickColor:lightColor}};var markColor="#4572a7";var excelTheme={background:"#fff",arc:{fill:markColor},area:{fill:markColor},line:{stroke:markColor,strokeWidth:2},path:{stroke:markColor},rect:{fill:markColor},shape:{stroke:markColor},symbol:{fill:markColor,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:true,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:false,tickExtra:true},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}};var markColor$1="#30a2da";var axisColor="#cbcbcb";var guideLabelColor="#999";var guideTitleColor="#333";var backgroundColor="#f0f0f0";var blackTitle="#333";var fiveThirtyEightTheme={arc:{fill:markColor$1},area:{fill:markColor$1},axis:{domainColor:axisColor,grid:true,gridColor:axisColor,gridWidth:1,labelColor:guideLabelColor,labelFontSize:10,titleColor:guideTitleColor,tickColor:axisColor,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:false},background:backgroundColor,group:{fill:backgroundColor},legend:{labelColor:blackTitle,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:blackTitle,titleFontSize:14,titlePadding:10},line:{stroke:markColor$1,strokeWidth:2},path:{stroke:markColor$1,strokeWidth:.5},rect:{fill:markColor$1},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:true,shape:"circle"},shape:{stroke:markColor$1},bar:{binSpacing:2,fill:markColor$1,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}};var markColor$2="#000";var ggplot2Theme={group:{fill:"#e5e5e5"},arc:{fill:markColor$2},area:{fill:markColor$2},line:{stroke:markColor$2},path:{stroke:markColor$2},rect:{fill:markColor$2},shape:{stroke:markColor$2},symbol:{fill:markColor$2,size:40},axis:{domain:false,grid:true,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}};var headlineFontSize=22;var headlineFontWeight="normal";var labelFont="Benton Gothic, sans-serif";var labelFontSize=11.5;var labelFontWeight="normal";var markColor$3="#82c6df";var titleFont="Benton Gothic Bold, sans-serif";var titleFontWeight="normal";var titleFontSize=13;var colorSchemes={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]};var latimesTheme={background:"#ffffff",title:{anchor:"start",color:"#000000",font:titleFont,fontSize:headlineFontSize,fontWeight:headlineFontWeight},arc:{fill:markColor$3},area:{fill:markColor$3},line:{stroke:markColor$3,strokeWidth:2},path:{stroke:markColor$3},rect:{fill:markColor$3},shape:{stroke:markColor$3},symbol:{fill:markColor$3,size:30},axis:{labelFont:labelFont,labelFontSize:labelFontSize,labelFontWeight:labelFontWeight,titleFont:titleFont,titleFontSize:titleFontSize,titleFontWeight:titleFontWeight},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:labelFont,labelFontSize:labelFontSize,symbolType:"square",titleFont:titleFont,titleFontSize:titleFontSize,titleFontWeight:titleFontWeight},range:{category:colorSchemes["category-6"],diverging:colorSchemes["fireandice-6"],heatmap:colorSchemes["fire-7"],ordinal:colorSchemes["fire-7"],ramp:colorSchemes["fire-7"]}};var markColor$4="#ab5787";var axisColor$1="#979797";var quartzTheme={background:"#f9f9f9",arc:{fill:markColor$4},area:{fill:markColor$4},line:{stroke:markColor$4},path:{stroke:markColor$4},rect:{fill:markColor$4},shape:{stroke:markColor$4},symbol:{fill:markColor$4,size:30},axis:{domainColor:axisColor$1,domainWidth:.5,gridWidth:.2,labelColor:axisColor$1,tickColor:axisColor$1,tickWidth:.2,titleColor:axisColor$1},axisBand:{grid:false},axisX:{grid:true,tickSize:10},axisY:{domain:false,grid:true,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}};var markColor$5="#3e5c69";var voxTheme={background:"#fff",arc:{fill:markColor$5},area:{fill:markColor$5},line:{stroke:markColor$5},path:{stroke:markColor$5},rect:{fill:markColor$5},shape:{stroke:markColor$5},symbol:{fill:markColor$5},axis:{domainWidth:.5,grid:true,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:false},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}};var markColor$6="#1696d2";var axisColor$2="#000000";var backgroundColor$1="#FFFFFF";var font="Lato";var labelFont$1="Lato";var sourceFont="Lato";var gridColor="#DEDDDD";var titleFontSize$1=18;var colorSchemes$1={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]};var urbanInstituteTheme={background:backgroundColor$1,title:{anchor:"start",fontSize:titleFontSize$1,font:font},axisX:{domain:true,domainColor:axisColor$2,domainWidth:1,grid:false,labelFontSize:12,labelFont:labelFont$1,labelAngle:0,tickColor:axisColor$2,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:font},axisY:{domain:false,domainWidth:1,grid:true,gridColor:gridColor,gridWidth:1,labelFontSize:12,labelFont:labelFont$1,labelPadding:8,ticks:false,titleFontSize:12,titlePadding:10,titleFont:font,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:labelFont$1,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:font,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:colorSchemes$1["six-groups-cat-1"],diverging:colorSchemes$1["diverging-colors"],heatmap:colorSchemes$1["diverging-colors"],ordinal:colorSchemes$1["six-groups-seq"],ramp:colorSchemes$1["shades-blue"]},area:{fill:markColor$6},rect:{fill:markColor$6},line:{color:markColor$6,stroke:markColor$6,strokeWidth:5},trail:{color:markColor$6,stroke:markColor$6,strokeWidth:0,size:1},path:{stroke:markColor$6,strokeWidth:.5},point:{filled:true},text:{font:sourceFont,color:markColor$6,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:markColor$6,stroke:null}},arc:{fill:markColor$6},shape:{stroke:markColor$6},symbol:{fill:markColor$6,size:30}};var markColor$7="#3366CC";var gridColor$1="#ccc";var defaultFont="Arial, sans-serif";var googlechartsTheme={arc:{fill:markColor$7},area:{fill:markColor$7},path:{stroke:markColor$7},rect:{fill:markColor$7},shape:{stroke:markColor$7},symbol:{stroke:markColor$7},circle:{fill:markColor$7},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:defaultFont,fontSize:12},"guide-title":{font:defaultFont,fontSize:12},"group-title":{font:defaultFont,fontSize:12}},title:{font:defaultFont,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:gridColor$1,tickColor:gridColor$1,domain:false,grid:true},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}};var version$1=pkg.version;var themes=Object.freeze({__proto__:null,dark:darkTheme,excel:excelTheme,fivethirtyeight:fiveThirtyEightTheme,ggplot2:ggplot2Theme,googlecharts:googlechartsTheme,latimes:latimesTheme,quartz:quartzTheme,urbaninstitute:urbanInstituteTheme,version:version$1,vox:voxTheme});var defaultStyle="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n";var EL_ID="vg-tooltip-element";var DEFAULT_OPTIONS={offsetX:10,offsetY:10,id:EL_ID,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:false,sanitize:escapeHTML,maxDepth:2};function escapeHTML(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function createDefaultStyle(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e)){throw new Error("Invalid HTML ID")}return defaultStyle.toString().replace(EL_ID,e)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function __rest(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n}function formatValue(e,t,n){if(isArray(e)){return"["+e.map((function(e){return t(isString(e)?e:stringify(e,n))})).join(", ")+"]"}if(isObject(e)){var r="";var i=e,a=i.title,o=i.image,s=__rest(i,["title","image"]);if(a){r+="<h2>"+t(a)+"</h2>"}if(o){r+='<img src="'+t(o)+'">'}var u=Object.keys(s);if(u.length>0){r+="<table>";for(var l=0,f=u;l<f.length;l++){var c=f[l];var d=s[c];if(d===undefined){continue}if(isObject(d)){d=stringify(d,n)}r+='<tr><td class="key">'+t(c)+':</td><td class="value">'+t(d)+"</td></tr>"}r+="</table>"}return r||"{}"}return t(e)}function replacer(e){var t=[];return function(n,r){if(typeof r!=="object"||r===null){return r}var i=t.indexOf(this)+1;t.length=i;if(t.length>e){return"[Object]"}if(t.indexOf(r)>=0){return"[Circular]"}t.push(r);return r}}function stringify(e,t){return JSON.stringify(e,replacer(t))}function calculatePosition(e,t,n,r){var i=e.clientX+n;if(i+t.width>window.innerWidth){i=+e.clientX-n-t.width}var a=e.clientY+r;if(a+t.height>window.innerHeight){a=+e.clientY-r-t.height}return{x:i,y:a}}var Handler=function(){function e(e){this.options=Object.assign(Object.assign({},DEFAULT_OPTIONS),e);var t=this.options.id;this.el=null;this.call=this.tooltipHandler.bind(this);if(!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){var n=document.createElement("style");n.setAttribute("id",this.options.styleId);n.innerHTML=createDefaultStyle(t);var r=document.head;if(r.childNodes.length>0){r.insertBefore(n,r.childNodes[0])}else{r.appendChild(n)}}}e.prototype.tooltipHandler=function(e,t,n,r){this.el=document.getElementById(this.options.id);if(!this.el){this.el=document.createElement("div");this.el.setAttribute("id",this.options.id);this.el.classList.add("vg-tooltip");document.body.appendChild(this.el)}var i=document.fullscreenElement!=null?document.fullscreenElement:document.body;i.appendChild(this.el);if(r==null||r===""){this.el.classList.remove("visible",this.options.theme+"-theme");return}this.el.innerHTML=formatValue(r,this.options.sanitize,this.options.maxDepth);this.el.classList.add("visible",this.options.theme+"-theme");var a=calculatePosition(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY),o=a.x,s=a.y;this.el.setAttribute("style","top: "+s+"px; left: "+o+"px")};return e}();function _defineProperty(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function asyncGeneratorStep(e,t,n,r,i,a,o){try{var s=e[a](o);var u=s.value}catch(error){n(error);return}if(s.done){t(u)}else{Promise.resolve(u).then(r,i)}}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){asyncGeneratorStep(a,r,i,o,s,"next",e)}function s(e){asyncGeneratorStep(a,r,i,o,s,"throw",e)}o(undefined)}))}}var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined$1;var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function wrap(e,t,n,r){var i=t&&t.prototype instanceof Generator?t:Generator;var a=Object.create(i.prototype);var o=new Context(r||[]);a._invoke=makeInvokeMethod(e,n,o);return a}function tryCatch(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){IteratorPrototype=NativeIteratorPrototype}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction";function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function isGeneratorFunction(e){var t=typeof e==="function"&&e.constructor;return t?t===GeneratorFunction||(t.displayName||t.name)==="GeneratorFunction":false}function mark(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,GeneratorFunctionPrototype)}else{e.__proto__=GeneratorFunctionPrototype;if(!(toStringTagSymbol in e)){e[toStringTagSymbol]="GeneratorFunction"}}e.prototype=Object.create(Gp);return e}function awrap(e){return{__await:e}}function AsyncIterator(e,t){function n(r,i,a,o){var s=tryCatch(e[r],e,i);if(s.type==="throw"){o(s.arg)}else{var u=s.arg;var l=u.value;if(l&&typeof l==="object"&&hasOwn.call(l,"__await")){return t.resolve(l.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)}))}return t.resolve(l).then((function(e){u.value=e;a(u)}),(function(e){return n("throw",e,a,o)}))}}var r;function i(e,i){function a(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(a,a):a()}this._invoke=i}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this};function async(e,t,n,r,i){if(i===void 0)i=Promise;var a=new AsyncIterator(wrap(e,t,n,r),i);return isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))}function makeInvokeMethod(e,t,n){var r=GenStateSuspendedStart;return function i(a,o){if(r===GenStateExecuting){throw new Error("Generator is already running")}if(r===GenStateCompleted){if(a==="throw"){throw o}return doneResult()}n.method=a;n.arg=o;while(true){var s=n.delegate;if(s){var u=maybeInvokeDelegate(s,n);if(u){if(u===ContinueSentinel)continue;return u}}if(n.method==="next"){n.sent=n._sent=n.arg}else if(n.method==="throw"){if(r===GenStateSuspendedStart){r=GenStateCompleted;throw n.arg}n.dispatchException(n.arg)}else if(n.method==="return"){n.abrupt("return",n.arg)}r=GenStateExecuting;var l=tryCatch(e,t,n);if(l.type==="normal"){r=n.done?GenStateCompleted:GenStateSuspendedYield;if(l.arg===ContinueSentinel){continue}return{value:l.arg,done:n.done}}else if(l.type==="throw"){r=GenStateCompleted;n.method="throw";n.arg=l.arg}}}}function maybeInvokeDelegate(e,t){var n=e.iterator[t.method];if(n===undefined$1){t.delegate=null;if(t.method==="throw"){if(e.iterator["return"]){t.method="return";t.arg=undefined$1;maybeInvokeDelegate(e,t);if(t.method==="throw"){return ContinueSentinel}}t.method="throw";t.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var r=tryCatch(n,e.iterator,t.arg);if(r.type==="throw"){t.method="throw";t.arg=r.arg;t.delegate=null;return ContinueSentinel}var i=r.arg;if(!i){t.method="throw";t.arg=new TypeError("iterator result is not an object");t.delegate=null;return ContinueSentinel}if(i.done){t[e.resultName]=i.value;t.next=e.nextLoc;if(t.method!=="return"){t.method="next";t.arg=undefined$1}}else{return i}t.delegate=null;return ContinueSentinel}defineIteratorMethods(Gp);Gp[toStringTagSymbol]="Generator";Gp[iteratorSymbol]=function(){return this};Gp.toString=function(){return"[object Generator]"};function pushTryEntry(e){var t={tryLoc:e[0]};if(1 in e){t.catchLoc=e[1]}if(2 in e){t.finallyLoc=e[2];t.afterLoc=e[3]}this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal";delete t.arg;e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(pushTryEntry,this);this.reset(true)}function keys(e){var t=[];for(var n in e){t.push(n)}t.reverse();return function n(){while(t.length){var r=t.pop();if(r in e){n.value=r;n.done=false;return n}}n.done=true;return n}}function values(e){if(e){var t=e[iteratorSymbol];if(t){return t.call(e)}if(typeof e.next==="function"){return e}if(!isNaN(e.length)){var n=-1,r=function t(){while(++n<e.length){if(hasOwn.call(e,n)){t.value=e[n];t.done=false;return t}}t.value=undefined$1;t.done=true;return t};return r.next=r}}return{next:doneResult}}function doneResult(){return{value:undefined$1,done:true}}Context.prototype={constructor:Context,reset:function e(t){this.prev=0;this.next=0;this.sent=this._sent=undefined$1;this.done=false;this.delegate=null;this.method="next";this.arg=undefined$1;this.tryEntries.forEach(resetTryEntry);if(!t){for(var n in this){if(n.charAt(0)==="t"&&hasOwn.call(this,n)&&!isNaN(+n.slice(1))){this[n]=undefined$1}}}},stop:function e(){this.done=true;var t=this.tryEntries[0];var n=t.completion;if(n.type==="throw"){throw n.arg}return this.rval},dispatchException:function e(t){if(this.done){throw t}var n=this;function r(e,r){o.type="throw";o.arg=t;n.next=e;if(r){n.method="next";n.arg=undefined$1}return!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];var o=a.completion;if(a.tryLoc==="root"){return r("end")}if(a.tryLoc<=this.prev){var s=hasOwn.call(a,"catchLoc");var u=hasOwn.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc){return r(a.catchLoc,true)}else if(this.prev<a.finallyLoc){return r(a.finallyLoc)}}else if(s){if(this.prev<a.catchLoc){return r(a.catchLoc,true)}}else if(u){if(this.prev<a.finallyLoc){return r(a.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function e(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&hasOwn.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}if(a&&(t==="break"||t==="continue")&&a.tryLoc<=n&&n<=a.finallyLoc){a=null}var o=a?a.completion:{};o.type=t;o.arg=n;if(a){this.method="next";this.next=a.finallyLoc;return ContinueSentinel}return this.complete(o)},complete:function e(t,n){if(t.type==="throw"){throw t.arg}if(t.type==="break"||t.type==="continue"){this.next=t.arg}else if(t.type==="return"){this.rval=this.arg=t.arg;this.method="return";this.next="end"}else if(t.type==="normal"&&n){this.next=n}return ContinueSentinel},finish:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t){this.complete(r.completion,r.afterLoc);resetTryEntry(r);return ContinueSentinel}}},catch:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var i=r.completion;if(i.type==="throw"){var a=i.arg;resetTryEntry(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function e(t,n,r){this.delegate={iterator:values(t),resultName:n,nextLoc:r};if(this.method==="next"){this.arg=undefined$1}return ContinueSentinel}};var _regeneratorRuntime={wrap:wrap,isGeneratorFunction:isGeneratorFunction,AsyncIterator:AsyncIterator,mark:mark,awrap:awrap,async:async,keys:keys,values:values};function post(e,t,n){var r=e.open(t);var i=1e4;var a=250;var o=new URL(t),s=o.origin;var u=~~(i/a);function l(t){if(t.source===r){u=0;e.removeEventListener("message",l,false)}}e.addEventListener("message",l,false);function f(){if(u<=0){return}r.postMessage(n,s);setTimeout(f,a);u-=1}setTimeout(f,a)}var embedStyle='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper.fit-x {\n    width: 100%; }\n  .vega-embed .chart-wrapper.fit-y {\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}}function mergeDeep(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}for(var i=0,a=n;i<a.length;i++){var o=a[i];deepMerge_(e,o)}return e}function deepMerge_(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];writeConfig(e,i,t[i],true)}}var _w$vl;function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);if(t){r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))}n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};if(t%2){ownKeys(Object(n),true).forEach((function(t){_defineProperty(e,t,n[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(n))}else{ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}}return e}var vega=vegaImport;var _vegaLite=vegaLiteImport;var w=typeof window!=="undefined"?window:undefined;if(_vegaLite===undefined&&w!==null&&w!==void 0&&(_w$vl=w["vl"])!==null&&_w$vl!==void 0&&_w$vl.compile){_vegaLite=w["vl"]}var DEFAULT_ACTIONS={export:{svg:true,png:true},source:true,compiled:true,editor:true};var I18N={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"};var NAMES={vega:"Vega","vega-lite":"Vega-Lite"};var VERSION={vega:vega.version,"vega-lite":_vegaLite?_vegaLite.version:"not available"};var PREPROCESSOR={vega:function(e){return e},"vega-lite":function(e,t){return _vegaLite.compile(e,{config:t}).spec}};var SVG_CIRCLES='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>';var CHART_WRAPPER_CLASS="chart-wrapper";function isTooltipHandler(e){return typeof e==="function"}function viewSource(e,t,n,r){var i="<html><head>".concat(t,'</head><body><pre><code class="json">');var a="</code></pre>".concat(n,"</body></html>");var o=window.open("");o.document.write(i+e+a);o.document.title="".concat(NAMES[r]," JSON Source")}function guessMode(t,n){if(t.$schema){var r=e(t.$schema);if(n&&n!==r.library){var i;console.warn("The given visualization spec is written in ".concat(NAMES[r.library],", but mode argument sets ").concat((i=NAMES[n])!==null&&i!==void 0?i:n,"."))}var a=r.library;if(!semver.satisfies(VERSION[a],"^".concat(r.version.slice(1)))){console.warn("The input spec uses ".concat(NAMES[a]," ").concat(r.version,", but the current version of ").concat(NAMES[a]," is v").concat(VERSION[a],"."))}return a}if("mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t){return"vega-lite"}if("marks"in t||"signals"in t||"scales"in t||"axes"in t){return"vega"}return n!==null&&n!==void 0?n:"vega"}function isLoader(e){return!!(e&&"load"in e)}function createLoader(e){return isLoader(e)?e:vega.loader(e)}function embedOptionsFromUsermeta(e){var t;return(t=e.usermeta&&e.usermeta["embedOptions"])!==null&&t!==void 0?t:{}}function embed(e,t){return _embed2.apply(this,arguments)}function _embed2(){_embed2=_asyncToGenerator(_regeneratorRuntime.mark((function e(t,n){var r,i;var a,o,s,u,l,f,c,d,p=arguments;return _regeneratorRuntime.wrap((function e(h){while(1){switch(h.prev=h.next){case 0:a=p.length>2&&p[2]!==undefined?p[2]:{};if(!isString(n)){h.next=10;break}s=createLoader(a.loader);h.t0=JSON;h.next=6;return s.load(n);case 6:h.t1=h.sent;o=h.t0.parse.call(h.t0,h.t1);h.next=11;break;case 10:o=n;case 11:u=embedOptionsFromUsermeta(o).loader;if(!s||u){s=createLoader((l=a.loader)!==null&&l!==void 0?l:u)}h.next=15;return loadOpts(embedOptionsFromUsermeta(o),s);case 15:f=h.sent;h.next=18;return loadOpts(a,s);case 18:c=h.sent;d=_objectSpread(_objectSpread({},mergeDeep(c,f)),{},{config:mergeConfig((r=c.config)!==null&&r!==void 0?r:{},(i=f.config)!==null&&i!==void 0?i:{})});h.next=22;return _embed(t,o,d,s);case 22:return h.abrupt("return",h.sent);case 23:case"end":return h.stop()}}}),e)})));return _embed2.apply(this,arguments)}function loadOpts(e,t){return _loadOpts.apply(this,arguments)}function _loadOpts(){_loadOpts=_asyncToGenerator(_regeneratorRuntime.mark((function e(t,n){var r;var i,a;return _regeneratorRuntime.wrap((function e(o){while(1){switch(o.prev=o.next){case 0:if(!isString(t.config)){o.next=8;break}o.t1=JSON;o.next=4;return n.load(t.config);case 4:o.t2=o.sent;o.t0=o.t1.parse.call(o.t1,o.t2);o.next=9;break;case 8:o.t0=(r=t.config)!==null&&r!==void 0?r:{};case 9:i=o.t0;if(!isString(t.patch)){o.next=18;break}o.t4=JSON;o.next=14;return n.load(t.patch);case 14:o.t5=o.sent;o.t3=o.t4.parse.call(o.t4,o.t5);o.next=19;break;case 18:o.t3=t.patch;case 19:a=o.t3;return o.abrupt("return",_objectSpread(_objectSpread(_objectSpread({},t),a?{patch:a}:{}),i?{config:i}:{}));case 21:case"end":return o.stop()}}}),e)})));return _loadOpts.apply(this,arguments)}function getRoot(e){var t=e.getRootNode?e.getRootNode():document;if(t instanceof ShadowRoot){return{root:t,rootContainer:t}}else{var n;return{root:document,rootContainer:(n=document.head)!==null&&n!==void 0?n:document.body}}}function _embed(e,t){return _embed3.apply(this,arguments)}function _embed3(){_embed3=_asyncToGenerator(_regeneratorRuntime.mark((function t(n,r){var i,a,o,s,u;var l,f,c,d,p,h,g,m,v,y,_,b,x,E,S,$,A,D,w,C,T,k,O,N,R,F,L,P,I,M,z,B,U,j,H,q,G,W,V,Y,X,K,J=arguments;return _regeneratorRuntime.wrap((function t(Q){while(1){switch(Q.prev=Q.next){case 0:K=function e(){if(I){document.removeEventListener("click",I)}O.finalize()};l=J.length>2&&J[2]!==undefined?J[2]:{};f=J.length>3?J[3]:undefined;c=l.theme?mergeConfig(themes[l.theme],(i=l.config)!==null&&i!==void 0?i:{}):l.config;d=isBoolean$2(l.actions)?l.actions:mergeDeep({},DEFAULT_ACTIONS,(a=l.actions)!==null&&a!==void 0?a:{});p=_objectSpread(_objectSpread({},I18N),l.i18n);h=(o=l.renderer)!==null&&o!==void 0?o:"canvas";g=(s=l.logLevel)!==null&&s!==void 0?s:vega.Warn;m=(u=l.downloadFileName)!==null&&u!==void 0?u:"visualization";v=typeof n==="string"?document.querySelector(n):n;if(v){Q.next=12;break}throw new Error("".concat(n," does not exist"));case 12:if(l.defaultStyle!==false){y="vega-embed-style";_=getRoot(v),b=_.root,x=_.rootContainer;if(!b.getElementById(y)){E=document.createElement("style");E.id=y;E.innerText=l.defaultStyle===undefined||l.defaultStyle===true?embedStyle.toString():l.defaultStyle;x.appendChild(E)}}S=guessMode(r,l.mode);$=PREPROCESSOR[S](r,c);if(S==="vega-lite"){if($.$schema){A=e($.$schema);if(!semver.satisfies(VERSION.vega,"^".concat(A.version.slice(1)))){console.warn("The compiled spec uses Vega ".concat(A.version,", but current version is v").concat(VERSION.vega,"."))}}}v.classList.add("vega-embed");if(d){v.classList.add("has-actions")}v.innerHTML="";D=v;if(d){w=document.createElement("div");w.classList.add(CHART_WRAPPER_CLASS);v.appendChild(w);D=w}C=l.patch;if(C){if(C instanceof Function){$=C($)}else{$=applyPatch($,C,true,false).newDocument}}if(l.formatLocale){vega.formatLocale(l.formatLocale)}if(l.timeFormatLocale){vega.timeFormatLocale(l.timeFormatLocale)}T=l.ast;k=vega.parse($,S==="vega-lite"?{}:c,{ast:T});O=new(l.viewClass||vega.View)(k,_objectSpread({loader:f,logLevel:g,renderer:h},T?{expr:vega.expressionInterpreter}:{}));O.addSignalListener("autosize",(function(e,t){var n=t.type;if(n=="fit-x"){D.classList.add("fit-x");D.classList.remove("fit-y")}else if(n=="fit-y"){D.classList.remove("fit-x");D.classList.add("fit-y")}else if(n=="fit"){D.classList.add("fit-x","fit-y")}else{D.classList.remove("fit-x","fit-y")}}));if(l.tooltip!==false){if(isTooltipHandler(l.tooltip)){N=l.tooltip}else{N=new Handler(l.tooltip===true?{}:l.tooltip).call}O.tooltip(N)}R=l.hover;if(R===undefined){R=S==="vega"}if(R){F=typeof R==="boolean"?{}:R,L=F.hoverSet,P=F.updateSet;O.hover(L,P)}if(l){if(l.width!=null){O.width(l.width)}if(l.height!=null){O.height(l.height)}if(l.padding!=null){O.padding(l.padding)}}Q.next=36;return O.initialize(D,l.bind).runAsync();case 36:if(d!==false){M=v;if(l.defaultStyle!==false){z=document.createElement("details");z.title=p.CLICK_TO_VIEW_ACTIONS;v.append(z);M=z;B=document.createElement("summary");B.innerHTML=SVG_CIRCLES;z.append(B);I=function(e){if(!z.contains(e.target)){z.removeAttribute("open")}};document.addEventListener("click",I)}U=document.createElement("div");M.append(U);U.classList.add("vega-actions");if(d===true||d.export!==false){j=function e(){var t=q[H];if(d===true||d.export===true||d.export[t]){var n=p["".concat(t.toUpperCase(),"_ACTION")];var r=document.createElement("a");r.text=n;r.href="#";r.target="_blank";r.download="".concat(m,".").concat(t);r.addEventListener("mousedown",function(){var e=_asyncToGenerator(_regeneratorRuntime.mark((function e(n){var r;return _regeneratorRuntime.wrap((function e(i){while(1){switch(i.prev=i.next){case 0:n.preventDefault();i.next=3;return O.toImageURL(t,l.scaleFactor);case 3:r=i.sent;this.href=r;case 5:case"end":return i.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}());U.append(r)}};for(H=0,q=["svg","png"];H<q.length;H++){j()}}if(d===true||d.source!==false){G=document.createElement("a");G.text=p.SOURCE_ACTION;G.href="#";G.addEventListener("click",(function(e){var t,n;viewSource(jsonStringifyPrettyCompact(r),(t=l.sourceHeader)!==null&&t!==void 0?t:"",(n=l.sourceFooter)!==null&&n!==void 0?n:"",S);e.preventDefault()}));U.append(G)}if(S==="vega-lite"&&(d===true||d.compiled!==false)){W=document.createElement("a");W.text=p.COMPILED_ACTION;W.href="#";W.addEventListener("click",(function(e){var t,n;viewSource(jsonStringifyPrettyCompact($),(t=l.sourceHeader)!==null&&t!==void 0?t:"",(n=l.sourceFooter)!==null&&n!==void 0?n:"","vega");e.preventDefault()}));U.append(W)}if(d===true||d.editor!==false){Y=(V=l.editorUrl)!==null&&V!==void 0?V:"https://vega.github.io/editor/";X=document.createElement("a");X.text=p.EDITOR_ACTION;X.href="#";X.addEventListener("click",(function(e){post(window,Y,{config:c,mode:S,renderer:h,spec:jsonStringifyPrettyCompact(r)});e.preventDefault()}));U.append(X)}}return Q.abrupt("return",{view:O,spec:r,vgSpec:$,finalize:K});case 38:case"end":return Q.stop()}}}),t)})));return _embed3.apply(this,arguments)}var defaultImageVegaCss=".sc-stencila-image-vega-default-h{display:block}.sc-stencila-image-vega-default-h.imgHidden.sc-stencila-image-vega-default-s>picture>:not(.vega-embed){display:none}";var materialImageVegaCss=".sc-stencila-image-vega-material-h{display:block}.sc-stencila-image-vega-material-h.imgHidden.sc-stencila-image-vega-material-s>picture>:not(.vega-embed){display:none}";var isLoaded={vega:undefined,"vega-lite":undefined};var ImageVegaComponent=function(){function e(e){var t=this;registerInstance(this,e);this.vegaLoaded=createEvent(this,"vegaLoaded",7);this.detectVegaDependency=function(e){var n=getVegaVersion(typeof e==="object"?e.$schema:e);t.vegaDependency=n;return n};this.options={};this.plotIsRendered=false;this.getPlotContent=function(){if(t.spec!==undefined&&t.spec!==""){return t.spec}var e=t.el.querySelector('[type^="'+vegaMediaType+'"]');if(e){try{var n=e.textContent;var r=JSON.parse(n!==null&&n!==void 0?n:"");return r}catch(i){console.error("Could not parse plot data")}}return undefined};this.renderPlot=function(){var e;var n=t.getPlotContent();t.plotContainer=(e=t.plotContainer)!==null&&e!==void 0?e:createPlotContainer(t.el);if(n!==undefined){return embed(t.plotContainer,n,Object.assign({actions:{compiled:false,editor:false}},t.options)).then((function(e){t.plotIsRendered=true;return e}))}return Promise.resolve()}}e.prototype.onVegaLoaded=function(e){if(!this.plotIsRendered&&e.detail.library===this.vegaDependency.library){this.renderPlot().catch((function(e){console.log(e)}))}};e.prototype.componentWillLoad=function(){var e=this;this.detectVegaDependency(this.getPlotContent());if(!this.plotIsRendered&&isLoaded[this.vegaDependency.library]){return this.renderPlot()}else{injectScriptSrc({src:getVegaLibSrc(this.vegaDependency),onLoad:function(){isLoaded[e.vegaDependency.library]=true;e.vegaLoaded.emit({library:e.vegaDependency.library})}})}};e.prototype.componentShouldUpdate=function(e,t,n){if(n==="plotIsRendered"&&t===e){return false}return true};e.prototype.componentWillUpdate=function(){this.renderPlot().catch((function(e){console.log(e)}))};e.prototype.render=function(){return h$1(Host,{class:{imgHidden:this.plotIsRendered}})};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return e}();ImageVegaComponent.style={default:defaultImageVegaCss,material:materialImageVegaCss};export{DataTable as stencila_data_table,ImageObjectComponent as stencila_image_object,ImagePlotlyComponent as stencila_image_plotly,ImageVegaComponent as stencila_image_vega};