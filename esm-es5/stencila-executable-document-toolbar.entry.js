var __extends=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(t,r,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(t){try{c(o.next(t))}catch(e){a(e)}}function u(t){try{c(o["throw"](t))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,u)}c((o=o.apply(t,r||[])).next())}))};var __generator=this&&this.__generator||function(t,r){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},o,i,a,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(e){return function(t){return c([e,t])}}function c(s){if(o)throw new TypeError("Generator is already executing.");while(n)try{if(o=1,i&&(a=s[0]&2?i["return"]:s[0]?i["throw"]||((a=i["return"])&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;if(i=0,a)s=[s[0]&2,a.value];switch(s[0]){case 0:case 1:a=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(a=n.trys,a=a.length>0&&a[a.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){n.label=s[1];break}if(s[0]===6&&n.label<a[1]){n.label=a[1];a=s;break}if(a&&n.label<a[2]){n.label=a[2];n.ops.push(s);break}if(a[2])n.ops.pop();n.trys.pop();continue}s=r.call(t,n)}catch(e){s=[6,e];i=0}finally{o=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e};import{h,r as registerInstance,H as Host}from"./index-e3052a43.js";import{c as createCommonjsModule$1,a as commonjsGlobal,b as commonjsRequire}from"./_commonjsHelpers-8a9f3b18.js";import{C as Ce,l}from"./schema-d66ff4ac.js";import{_ as _function}from"./function-df6e836e.js";import{a as toastController,T as ToastPositions,b as ToastTypes}from"./toastController-f90e27c1.js";function identity(e){return e}function constant(e){return function(){return e}}function flow(e,t,r,n,o,i,a,s,u){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return r(t(e.apply(this,arguments)))};case 4:return function(){return n(r(t(e.apply(this,arguments))))};case 5:return function(){return o(n(r(t(e.apply(this,arguments)))))};case 6:return function(){return i(o(n(r(t(e.apply(this,arguments))))))};case 7:return function(){return a(i(o(n(r(t(e.apply(this,arguments)))))))};case 8:return function(){return s(a(i(o(n(r(t(e.apply(this,arguments))))))))};case 9:return function(){return u(s(a(i(o(n(r(t(e.apply(this,arguments)))))))))}}return}function pipe$1(e,t,r,n,o,i,a,s,u,c,l,f,p,d,h,m,v,y,g,b){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return r(t(e));case 4:return n(r(t(e)));case 5:return o(n(r(t(e))));case 6:return i(o(n(r(t(e)))));case 7:return a(i(o(n(r(t(e))))));case 8:return s(a(i(o(n(r(t(e)))))));case 9:return u(s(a(i(o(n(r(t(e))))))));case 10:return c(u(s(a(i(o(n(r(t(e)))))))));case 11:return l(c(u(s(a(i(o(n(r(t(e))))))))));case 12:return f(l(c(u(s(a(i(o(n(r(t(e)))))))))));case 13:return p(f(l(c(u(s(a(i(o(n(r(t(e))))))))))));case 14:return d(p(f(l(c(u(s(a(i(o(n(r(t(e)))))))))))));case 15:return h(d(p(f(l(c(u(s(a(i(o(n(r(t(e))))))))))))));case 16:return m(h(d(p(f(l(c(u(s(a(i(o(n(r(t(e)))))))))))))));case 17:return v(m(h(d(p(f(l(c(u(s(a(i(o(n(r(t(e))))))))))))))));case 18:return y(v(m(h(d(p(f(l(c(u(s(a(i(o(n(r(t(e)))))))))))))))));case 19:return g(y(v(m(h(d(p(f(l(c(u(s(a(i(o(n(r(t(e))))))))))))))))));case 20:return b(g(y(v(m(h(d(p(f(l(c(u(s(a(i(o(n(r(t(e)))))))))))))))))))}return}function ap$2(e,t){return function(r){return function(n){return e.ap(e.map(n,(function(e){return function(r){return t.ap(e,r)}})),r)}}}function map$3(e,t){return function(r){return function(n){return e.map(n,(function(e){return t.map(e,r)}))}}}var isSome$1=function(e){return e._tag==="Some"};var isLeft$1=function(e){return e._tag==="Left"};var isLeft=isLeft$1;var isRight=function(e){return e._tag==="Right"};var left$1=function(e){return{_tag:"Left",left:e}};var right$1=function(e){return{_tag:"Right",right:e}};var matchW=function(e,t){return function(r){return isLeft(r)?e(r.left):t(r.right)}};var match=matchW;var fold$2=match;function swap$1(e){return isLeft(e)?right$1(e.left):left$1(e.right)}var _map=function(e,t){return pipe$1(e,map$2(t))};var _ap=function(e,t){return pipe$1(e,ap$1(t))};var map$2=function(e){return function(t){return isLeft(t)?t:right$1(e(t.right))}};var bimap$1=function(e,t){return function(r){return isLeft(r)?left$1(e(r.left)):right$1(t(r.right))}};var mapLeft$1=function(e){return function(t){return isLeft(t)?left$1(e(t.left)):t}};var apW=function(e){return function(t){return isLeft(t)?t:isLeft(e)?e:right$1(t.right(e.right))}};var ap$1=apW;var URI$2="Either";var Functor$2={URI:URI$2,map:_map};var Apply$2={URI:URI$2,map:_map,ap:_ap};var isSome=isSome$1;var isNone=function(e){return e._tag==="None"};var none={_tag:"None"};var some=function(e){return{_tag:"Some",value:e}};var map$1=function(e){return function(t){return isNone(t)?none:some(e(t.value))}};var pipe=pipe$1;var URI$1="@nll/datum/Datum";var initial$1={_tag:"Initial"};var pending$1={_tag:"Pending"};var refresh=function(e){return{_tag:"Refresh",value:e}};var replete=function(e){return{_tag:"Replete",value:e}};var constInitial$1=constant(initial$1);var constPending$1=constant(pending$1);var fold$1=function(e,t,r,n){return function(o){switch(o._tag){case"Initial":return e();case"Pending":return t();case"Refresh":return r(o.value);case"Replete":return n(o.value)}}};var isInitial$1=function(e){return e._tag==="Initial"};var isPending$1=function(e){return e._tag==="Pending"};var isRefresh$1=function(e){return e._tag==="Refresh"};var isReplete=function(e){return e._tag==="Replete"};var isValued$1=function(e){return isReplete(e)||isRefresh$1(e)};var getOrElse$1=function(e,t){return function(r){return fold$1(e,t,identity,identity)(r)}};var mapC=function(e,t){return fold$1(constInitial$1,constPending$1,(function(e){return refresh(t(e))}),(function(e){return replete(t(e))}))(e)};var apC=function(e,t){return fold$1(constInitial$1,(function(){return fold$1(constInitial$1,constPending$1,constPending$1,constPending$1)(t)}),(function(e){return fold$1(constInitial$1,constPending$1,(function(t){return refresh(e(t))}),(function(t){return refresh(e(t))}))(t)}),(function(e){return fold$1(constInitial$1,constPending$1,(function(t){return refresh(e(t))}),(function(t){return replete(e(t))}))(t)}))(e)};var apC2=function(e,t){return chainC(e,(function(e){return mapC(t,e)}))};var chainC=function(e,t){return fold$1(constInitial$1,constPending$1,t,t)(e)};var reduceC$1=function(e,t,r){return fold$1((function(){return t}),(function(){return t}),(function(e){return r(t,e)}),(function(e){return r(t,e)}))(e)};var foldMapC$1=function(e){return function(t,r){return fold$1((function(){return e.empty}),(function(){return e.empty}),r,r)(t)}};var reduceRightC$1=function(e,t,r){return fold$1((function(){return t}),(function(){return t}),(function(e){return r(e,t)}),(function(e){return r(e,t)}))(e)};var traverseC$1=function(e){return function(t,r){return fold$1((function(){return e.of(initial$1)}),(function(){return e.of(pending$1)}),(function(t){return e.map(r(t),refresh)}),(function(t){return e.map(r(t),replete)}))(t)}};var sequenceC$1=function(e){return function(t){return fold$1((function(){return e.of(initial$1)}),(function(){return e.of(pending$1)}),(function(t){return e.map(t,refresh)}),(function(t){return e.map(t,replete)}))(t)}};var altC=function(e,t){return fold$1(t,t,refresh,replete)(e)};var extendC=function(e,t){return replete(t(e))};var compactC=function(e){return fold$1(constInitial$1,constPending$1,(function(e){return isSome(e)?refresh(e.value):initial$1}),(function(e){return isSome(e)?replete(e.value):initial$1}))(e)};var defaultSeparate={left:initial$1,right:initial$1};var separateC=function(e){var t=mapC(e,(function(e){return{left:isLeft(e)?replete(e.left):initial$1,right:isRight(e)?replete(e.right):initial$1}}));return getOrElse$1((function(){return defaultSeparate}),(function(){return defaultSeparate}))(t)};var filterC=function(e,t){return fold$1(constInitial$1,constPending$1,(function(r){return t(r)?e:initial$1}),(function(r){return t(r)?e:initial$1}))(e)};var filterMapC=function(e,t){return compactC(mapC(e,t))};var partitionC=function(e,t){return{left:filterC(e,(function(e){return!t(e)})),right:filterC(e,t)}};var partitionMapC=function(e,t){return separateC(mapC(e,t))};var witherC=function(e){return function(t,r){return fold$1(constant(e.of(initial$1)),constant(e.of(pending$1)),(function(t){return e.map(r(t),(function(e){return isSome(e)?refresh(e.value):initial$1}))}),(function(t){return e.map(r(t),(function(e){return isSome(e)?replete(e.value):initial$1}))}))(t)}};var wiltC=function(e){return function(t,r){var n=mapC(t,(function(t){return e.map(r(t),(function(e){return{left:isLeft(e)?replete(e.left):initial$1,right:isRight(e)?replete(e.right):initial$1}}))}));return isValued$1(n)?n.value:e.of(defaultSeparate)}};var throwErrorC=function(e){return initial$1};var datum={URI:URI$1,map:mapC,of:replete,ap:apC,chain:chainC,reduce:reduceC$1,foldMap:foldMapC$1,reduceRight:reduceRightC$1,traverse:traverseC$1,sequence:sequenceC$1,zero:constInitial$1,alt:altC,extend:extendC,compact:compactC,separate:separateC,filter:filterC,filterMap:filterMapC,partition:partitionC,partitionMap:partitionMapC,wither:witherC,wilt:wiltC,throwError:throwErrorC};var Functor$1={URI:URI$1,map:mapC};var Apply$1=Object.assign(Object.assign({},Functor$1),{ap:apC2});var Chain$1=Object.assign(Object.assign({},Apply$1),{chain:chainC});var Applicative$1=Object.assign(Object.assign({},Apply$1),{of:replete});var Alt$1=Object.assign(Object.assign({},Functor$1),{alt:altC});Object.assign(Object.assign(Object.assign({},Alt$1),Applicative$1),{zero:constInitial$1});var Monad$1=Object.assign(Object.assign({},Chain$1),{of:replete});Object.assign(Object.assign({},Monad$1),{throwError:throwErrorC});var Foldable$1={URI:URI$1,reduce:reduceC$1,reduceRight:reduceRightC$1,foldMap:foldMapC$1};var Traversable=Object.assign(Object.assign(Object.assign({},Functor$1),Foldable$1),{sequence:sequenceC$1,traverse:traverseC$1});Object.assign(Object.assign({},Functor$1),{extend:extendC});var Compactable={URI:URI$1,compact:compactC,separate:separateC};var Filterable=Object.assign(Object.assign(Object.assign({},Functor$1),Compactable),{partition:partitionC,partitionMap:partitionMapC,filter:filterC,filterMap:filterMapC});Object.assign(Object.assign(Object.assign({},Traversable),Filterable),{wilt:wiltC,wither:witherC});function right(e){return flow(right$1,e.of)}function left(e){return flow(left$1,e.of)}function rightF(e){return function(t){return e.map(t,right$1)}}function leftF(e){return function(t){return e.map(t,left$1)}}function map(e){return map$3(e,Functor$2)}function ap(e){return ap$2(e,Apply$2)}function chain(e){return function(t){return function(r){return e.chain(r,(function(r){return isLeft(r)?e.of(r):t(r.right)}))}}}function alt(e){return function(t){return function(r){return e.chain(r,(function(r){return isLeft(r)?t():e.of(r)}))}}}function bimap(e){return function(t,r){return function(n){return e.map(n,bimap$1(t,r))}}}function mapLeft(e){return function(t){return function(r){return e.map(r,mapLeft$1(t))}}}function matchE(e){return function(t,r){return function(n){return e.chain(n,match(t,r))}}}function getOrElse(e){return function(t){return function(r){return e.chain(r,match(t,e.of))}}}function orElse(e){return function(t){return function(r){return e.chain(r,(function(r){return isLeft(r)?t(r.left):e.of(r)}))}}}function swap(e){return function(t){return e.map(t,swap$1)}}function getEitherM(e){var t=ap(e);var r=map(e);var n=chain(e);var o=alt(e);var i=bimap(e);var a=mapLeft(e);var s=matchE(e);var u=getOrElse(e);var c=orElse(e);return{map:function(e,t){return pipe$1(e,r(t))},ap:function(e,r){return pipe$1(e,t(r))},of:right(e),chain:function(e,t){return pipe$1(e,n(t))},alt:function(e,t){return pipe$1(e,o(t))},bimap:function(e,t,r){return pipe$1(e,i(t,r))},mapLeft:function(e,t){return pipe$1(e,a(t))},fold:function(e,t,r){return pipe$1(e,s(t,r))},getOrElse:function(e,t){return pipe$1(e,u(t))},orElse:function(e,t){return pipe$1(e,c(t))},swap:swap(e),rightM:rightF(e),leftM:leftF(e),left:left(e)}}var URI="@nll/datum/DatumEither";var initial=initial$1;var pending=pending$1;var success=function(e){return replete(right$1(e))};var failure=function(e){return replete(left$1(e))};function constInitial(){return initial}var constPending=function(){return pending};var isInitial=isInitial$1;var isPending=isPending$1;var isRefresh=isRefresh$1;var isValued=isValued$1;var isSuccess=function(e){return isValued(e)&&isRight(e.value)};var isFailure=function(e){return isValued(e)&&isLeft(e.value)};var toRefresh=function(e){return fold$1(constPending,constPending,constant(e),refresh)(e)};var toReplete=function(e){return fold$1(constInitial,constInitial,replete,constant(e))(e)};var fold=function(e,t,r,n,o,i){return function(a){return pipe(a,fold$1(e,t,fold$2(r,n),fold$2(o,i)))}};var traverseC=function(e){return function(t,r){return fold((function(){return e.of(initial)}),(function(){return e.of(pending)}),(function(t){return e.of(refresh(left$1(t)))}),(function(t){return e.map(r(t),flow(right$1,refresh))}),(function(t){return e.of(replete(left$1(t)))}),(function(t){return e.map(r(t),flow(right$1,replete))}))(t)}};var sequenceC=function(e){return function(t){return fold((function(){return e.of(initial)}),(function(){return e.of(pending)}),(function(t){return e.of(refresh(left$1(t)))}),(function(t){return e.map(t,flow(right$1,refresh))}),(function(t){return e.of(replete(left$1(t)))}),(function(t){return e.map(t,flow(right$1,replete))}))(t)}};var reduceC=function(e,t,r){return pipe(e,fold((function(){return t}),(function(){return t}),(function(){return t}),(function(e){return r(t,e)}),(function(){return t}),(function(e){return r(t,e)})))};var foldMapC=function(e){return function(t,r){return fold((function(){return e.empty}),(function(){return e.empty}),(function(){return e.empty}),r,(function(){return e.empty}),r)(t)}};var reduceRightC=function(e,t,r){return fold((function(){return t}),(function(){return t}),(function(){return t}),(function(e){return r(e,t)}),(function(){return t}),(function(e){return r(e,t)}))(e)};Object.assign(Object.assign({URI:URI},getEitherM(datum)),{traverse:traverseC,sequence:sequenceC,reduce:reduceC,foldMap:foldMapC,reduceRight:reduceRightC});var eitherTDatum=getEitherM(Monad$1);var Functor={URI:URI,map:eitherTDatum.map};var Apply=Object.assign(Object.assign({},Functor),{ap:eitherTDatum.ap});var Chain=Object.assign(Object.assign({},Apply),{chain:eitherTDatum.chain});var Applicative=Object.assign(Object.assign({},Apply),{of:eitherTDatum.of});var Alt=Object.assign(Object.assign({},Functor),{alt:eitherTDatum.alt});Object.assign(Object.assign(Object.assign({},Alt),Applicative),{zero:constInitial});var Monad=Object.assign(Object.assign({},Chain),{of:eitherTDatum.of});Object.assign(Object.assign({},Monad),{throwError:failure});var Foldable={URI:URI,reduce:reduceC,reduceRight:reduceRightC,foldMap:foldMapC};Object.assign(Object.assign(Object.assign({},Functor),Foldable),{sequence:sequenceC,traverse:traverseC});createCommonjsModule$1((function(t,r){var n=function(e){function t(){this.fetch=false;this.DOMException=e.DOMException}t.prototype=e;return new t}(typeof self!=="undefined"?self:commonjsGlobal);(function(t){(function(r){var n={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{new Blob;return true}catch(e){return false}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function o(e){return e&&DataView.prototype.isPrototypeOf(e)}if(n.arrayBuffer){var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];var a=ArrayBuffer.isView||function(e){return e&&i.indexOf(Object.prototype.toString.call(e))>-1}}function s(e){if(typeof e!=="string"){e=String(e)}if(/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e)){throw new TypeError("Invalid character in header field name")}return e.toLowerCase()}function u(e){if(typeof e!=="string"){e=String(e)}return e}function c(e){var t={next:function(){var t=e.shift();return{done:t===undefined,value:t}}};if(n.iterable){t[Symbol.iterator]=function(){return t}}return t}function l(e){this.map={};if(e instanceof l){e.forEach((function(e,t){this.append(t,e)}),this)}else if(Array.isArray(e)){e.forEach((function(e){this.append(e[0],e[1])}),this)}else if(e){Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}}l.prototype.append=function(e,t){e=s(e);t=u(t);var r=this.map[e];this.map[e]=r?r+", "+t:t};l.prototype["delete"]=function(e){delete this.map[s(e)]};l.prototype.get=function(e){e=s(e);return this.has(e)?this.map[e]:null};l.prototype.has=function(e){return this.map.hasOwnProperty(s(e))};l.prototype.set=function(e,t){this.map[s(e)]=u(t)};l.prototype.forEach=function(e,t){for(var r in this.map){if(this.map.hasOwnProperty(r)){e.call(t,this.map[r],r,this)}}};l.prototype.keys=function(){var e=[];this.forEach((function(t,r){e.push(r)}));return c(e)};l.prototype.values=function(){var e=[];this.forEach((function(t){e.push(t)}));return c(e)};l.prototype.entries=function(){var e=[];this.forEach((function(t,r){e.push([r,t])}));return c(e)};if(n.iterable){l.prototype[Symbol.iterator]=l.prototype.entries}function f(e){if(e.bodyUsed){return Promise.reject(new TypeError("Already read"))}e.bodyUsed=true}function p(e){return new Promise((function(t,r){e.onload=function(){t(e.result)};e.onerror=function(){r(e.error)}}))}function d(e){var t=new FileReader;var r=p(t);t.readAsArrayBuffer(e);return r}function h(e){var t=new FileReader;var r=p(t);t.readAsText(e);return r}function m(e){var t=new Uint8Array(e);var r=new Array(t.length);for(var n=0;n<t.length;n++){r[n]=String.fromCharCode(t[n])}return r.join("")}function v(e){if(e.slice){return e.slice(0)}else{var t=new Uint8Array(e.byteLength);t.set(new Uint8Array(e));return t.buffer}}function y(){this.bodyUsed=false;this._initBody=function(e){this._bodyInit=e;if(!e){this._bodyText=""}else if(typeof e==="string"){this._bodyText=e}else if(n.blob&&Blob.prototype.isPrototypeOf(e)){this._bodyBlob=e}else if(n.formData&&FormData.prototype.isPrototypeOf(e)){this._bodyFormData=e}else if(n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)){this._bodyText=e.toString()}else if(n.arrayBuffer&&n.blob&&o(e)){this._bodyArrayBuffer=v(e.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else if(n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||a(e))){this._bodyArrayBuffer=v(e)}else{this._bodyText=e=Object.prototype.toString.call(e)}if(!this.headers.get("content-type")){if(typeof e==="string"){this.headers.set("content-type","text/plain;charset=UTF-8")}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set("content-type",this._bodyBlob.type)}else if(n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)){this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8")}}};if(n.blob){this.blob=function(){var e=f(this);if(e){return e}if(this._bodyBlob){return Promise.resolve(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]))}else if(this._bodyFormData){throw new Error("could not read FormData body as blob")}else{return Promise.resolve(new Blob([this._bodyText]))}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){return f(this)||Promise.resolve(this._bodyArrayBuffer)}else{return this.blob().then(d)}}}this.text=function(){var e=f(this);if(e){return e}if(this._bodyBlob){return h(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(m(this._bodyArrayBuffer))}else if(this._bodyFormData){throw new Error("could not read FormData body as text")}else{return Promise.resolve(this._bodyText)}};if(n.formData){this.formData=function(){return this.text().then(w)}}this.json=function(){return this.text().then(JSON.parse)};return this}var g=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(e){var t=e.toUpperCase();return g.indexOf(t)>-1?t:e}function _(e,t){t=t||{};var r=t.body;if(e instanceof _){if(e.bodyUsed){throw new TypeError("Already read")}this.url=e.url;this.credentials=e.credentials;if(!t.headers){this.headers=new l(e.headers)}this.method=e.method;this.mode=e.mode;this.signal=e.signal;if(!r&&e._bodyInit!=null){r=e._bodyInit;e.bodyUsed=true}}else{this.url=String(e)}this.credentials=t.credentials||this.credentials||"same-origin";if(t.headers||!this.headers){this.headers=new l(t.headers)}this.method=b(t.method||this.method||"GET");this.mode=t.mode||this.mode||null;this.signal=t.signal||this.signal;this.referrer=null;if((this.method==="GET"||this.method==="HEAD")&&r){throw new TypeError("Body not allowed for GET or HEAD requests")}this._initBody(r)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})};function w(e){var t=new FormData;e.trim().split("&").forEach((function(e){if(e){var r=e.split("=");var n=r.shift().replace(/\+/g," ");var o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}}));return t}function $(e){var t=new l;var r=e.replace(/\r?\n[\t ]+/g," ");r.split(/\r?\n/).forEach((function(e){var r=e.split(":");var n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}}));return t}y.call(_.prototype);function E(e,t){if(!t){t={}}this.type="default";this.status=t.status===undefined?200:t.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in t?t.statusText:"OK";this.headers=new l(t.headers);this.url=t.url||"";this._initBody(e)}y.call(E.prototype);E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})};E.error=function(){var e=new E(null,{status:0,statusText:""});e.type="error";return e};var C=[301,302,303,307,308];E.redirect=function(e,t){if(C.indexOf(t)===-1){throw new RangeError("Invalid status code")}return new E(null,{status:t,headers:{location:e}})};r.DOMException=t.DOMException;try{new r.DOMException}catch(R){r.DOMException=function(e,t){this.message=e;this.name=t;var r=Error(e);this.stack=r.stack};r.DOMException.prototype=Object.create(Error.prototype);r.DOMException.prototype.constructor=r.DOMException}function x(e,t){return new Promise((function(o,i){var a=new _(e,t);if(a.signal&&a.signal.aborted){return i(new r.DOMException("Aborted","AbortError"))}var s=new XMLHttpRequest;function u(){s.abort()}s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:$(s.getAllResponseHeaders()||"")};e.url="responseURL"in s?s.responseURL:e.headers.get("X-Request-URL");var t="response"in s?s.response:s.responseText;o(new E(t,e))};s.onerror=function(){i(new TypeError("Network request failed"))};s.ontimeout=function(){i(new TypeError("Network request failed"))};s.onabort=function(){i(new r.DOMException("Aborted","AbortError"))};s.open(a.method,a.url,true);if(a.credentials==="include"){s.withCredentials=true}else if(a.credentials==="omit"){s.withCredentials=false}if("responseType"in s&&n.blob){s.responseType="blob"}a.headers.forEach((function(e,t){s.setRequestHeader(t,e)}));if(a.signal){a.signal.addEventListener("abort",u);s.onreadystatechange=function(){if(s.readyState===4){a.signal.removeEventListener("abort",u)}}}s.send(typeof a._bodyInit==="undefined"?null:a._bodyInit)}))}x.polyfill=true;if(!t.fetch){t.fetch=x;t.Headers=l;t.Request=_;t.Response=E}r.Headers=l;r.Request=_;r.Response=E;r.fetch=x;return r})({})})(n);delete n.fetch.polyfill;r=n.fetch;r.default=n.fetch;r.fetch=n.fetch;r.Headers=n.Headers;r.Request=n.Request;r.Response=n.Response;t.exports=r}));var ws=null;if(typeof WebSocket!=="undefined"){ws=WebSocket}else if(typeof MozWebSocket!=="undefined"){ws=MozWebSocket}else if(typeof commonjsGlobal!=="undefined"){ws=commonjsGlobal.WebSocket||commonjsGlobal.MozWebSocket}else if(typeof window!=="undefined"){ws=window.WebSocket||window.MozWebSocket}else if(typeof self!=="undefined"){ws=self.WebSocket||self.MozWebSocket}var browser=ws;var random=function(e){return crypto.getRandomValues(new Uint8Array(e))};var customRandom=function(e,t,r){var n=(2<<Math.log(e.length-1)/Math.LN2)-1;var o=-~(1.6*n*t/e.length);return function(){var i="";while(true){var a=r(o);var s=o;while(s--){i+=e[a[s]&n]||"";if(i.length===t)return i}}}};var customAlphabet=function(e,t){return customRandom(e,t,random)};var Id=function(e){__extends(t,e);function t(t,r){var n=e.call(this,r)||this;n.family=t;return n}return t}(String);var epoch=15e11;var nanoid=customAlphabet("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",20);function generate(e){var t=e.length===2?e:e.length===0?"uu":e.length===1?e.repeat(2):e.slice(0,2);var r=(Date.now()-epoch).toString(16).padStart(10,"0");var n=nanoid();var o=t+"."+r+"."+n;return new Id(t,o)}function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var r;!function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=2]="info",e[e.debug=3]="debug"}(r||(r={}));var n,t,o="undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i="_logga"in o?null!=(t=o._logga)?t:[]:(o._logga=[],null!=(n=o._logga)?n:[]);function a(t,r,n){for(var o,a,s={tag:r,level:n,message:"string"==typeof t?t:"object"==typeof t&&null!=(o=null==t?void 0:t.message)?o:"",stack:"object"==typeof t?null==t?void 0:t.stack:void 0},u=function(t,r){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t))){n&&(t=n);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}(i);!(a=u()).done;)(0,a.value)(s)}function u(){return i}function s(e,t){void 0===t&&(t={});var r=e,n=t.tags,o=t.maxLevel,a=t.messageRegex,s=t.func;return void 0===n&&void 0===o&&void 0===a&&void 0===s||(r=function(t){(void 0===n||n.includes(t.tag))&&(void 0!==o&&t.level>o||(void 0===a||a.test(t.message))&&(void 0===s||s(t))&&e(t))}),i.push(r),r}var f=new Map;function v(e){return e.replace(/"|\\|\/|\f|\n|\r|\t/g,(function(e){switch(e){case'"':return'"';case"\\":return"\\\\";case"/":return"\\/";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t"}return e}))}function g(e,t){void 0===t&&(t={});var n=e.tag,o=e.level,i=e.message,a=e.stack,s=t.maxLevel;if(!(o>(void 0===s?r.info:s))){var u=t.throttle;if(void 0!==u){var c=(void 0!==u.signature?u.signature:"").replace(/\${tag}/,n).replace(/\${level}/,o.toString()).replace(/\${message}/,i),l=f.get(c);if(void 0!==l){var p=void 0!==u.duration?u.duration:1e3;if(Date.now()-l<p)return}f.set(c,Date.now())}if("undefined"!=typeof process&&void 0!==process.stderr&&!0!==process.stderr.isTTY){var d=t.fastTime,h='{"time":'+(void 0!==d&&d?Date.now():'"'+(new Date).toISOString()+'"')+',"tag":"'+n+'","level":'+o+',"message":"'+i+'"';void 0!==a&&(h+=',"stack":"'+v(a)+'"'),h+="}\n",process.stderr.write(h)}else{var m,y=o<0?0:o>3?3:o,g=r[y].toUpperCase().padEnd(5," ");m="undefined"!=typeof window?g+" "+n+" "+i:["🚨","⚠","🛈","🐛"][y]+" "+["[31;1m","[33;1m","[34;1m","[30;1m"][y]+g+"[0m [36m"+n+"[0m "+i;var b=t.showStack;void 0!==b&&b&&void 0!==a&&(m+="\n  "+a),console.error(m)}var _=t.exitOnError;"undefined"!=typeof process&&(void 0===_||_)&&o===r.error&&(null==process.exit||process.exit(1))}}function p(e){return{error:function(t){a(t,e,r.error)},warn:function(t){a(t,e,r.warn)},info:function(t){a(t,e,r.info)},debug:function(t){a(t,e,r.debug)}}}0===u().length&&s(g);var Lt=function(e){return function(t){return Object.keys(e).includes(t)}},Nt=function(e){return function(t){return!!qt(t)&&Lt(e)(t.type)}},Qt=function(e){var t,r=((t={})[e]=e,t);return Nt(r)},qt=function(e){return null!=e&&Object.prototype.hasOwnProperty.call(e,"type")};Qt("Article");Qt("Paragraph");Qt("ListItem");var te=function(e){return null===e?"Null":"boolean"==typeof e?"Boolean":"number"==typeof e?"Number":"string"==typeof e?"Text":Array.isArray(e)?"Array":qt(e)?e.type:"Object"};var InternalError=function(e){__extends(t,e);function t(t){var r=e.call(this,t)||this;r.name="InternalError";return r}return t}(Error);var MethodUnknownError=function(e){__extends(t,e);function t(t){var r=e.call(this,'Method "'+t+'" is unknown')||this;r.name="MethodUnknownError";r.method=t;return r}return t}(Error);var ParamRequiredError=function(e){__extends(t,e);function t(t){var r=e.call(this,'Parameter "'+t+'" is required')||this;r.name="ParamRequiredError";r.param=t;return r}return t}(Error);var CapabilityError=function(e){__extends(t,e);function t(r,n,o){if(r===void 0){r="Incapable"}if(o===void 0){o={}}var i=e.call(this,n!==undefined?t.message(r,n,o):r)||this;i.name="CapabilityError";return i}t.message=function(e,t,r){return e+': method "'+t+'" with params:\n'+Object.entries(r).map((function(e){var t=e[0],r=e[1];var n;if(qt(r)){n="<"+te(r)+">"}else{n=JSON.stringify(r);if(n!==undefined&&n.length>20){n=n.slice(0,20)+"..."}}return"  "+t+": "+n})).join("\n")};return t}(Error);var log=p("executa:executor");var Method;(function(e){e["manifest"]="manifest";e["decode"]="decode";e["encode"]="encode";e["query"]="query";e["compile"]="compile";e["build"]="build";e["execute"]="execute";e["begin"]="begin";e["end"]="end";e["pipe"]="pipe";e["cancel"]="cancel"})(Method||(Method={}));var Executor=function(){function e(e){if(e===void 0){e="ex"}this.id=generate(e).toString()}e.prototype.addresses=function(){return Promise.resolve(undefined)};e.prototype.capabilities=function(){return Promise.resolve(undefined)};e.prototype.manifest=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:e={version:1,id:this.id.toString()};return[4,this.addresses()];case 1:e.addresses=t.sent();return[4,this.capabilities()];case 2:return[2,(e.capabilities=t.sent(),e)]}}))}))};e.prototype.decode=function(e,t){return this.call(Method.decode,{source:e,format:t})};e.prototype.encode=function(e,t,r){return this.call(Method.encode,{node:e,dest:t,format:r})};e.prototype.query=function(e,t,r){return this.call(Method.query,{node:e,query:t,lang:r})};e.prototype.compile=function(e){return this.call(Method.compile,{node:e})};e.prototype.build=function(e){return this.call(Method.build,{node:e})};e.prototype.execute=function(e,t,r,n){return this.call(Method.execute,{node:e,session:t,claims:r,job:n})};e.prototype.begin=function(e,t){return this.call(Method.begin,{node:e,claims:t})};e.prototype.end=function(e,t){return this.call(Method.end,{node:e,claims:t})};e.prototype.pipe=function(e,t){return this.call(Method.pipe,{node:e,calls:t})};e.prototype.cancel=function(e){return Promise.resolve(false)};e.prototype.dispatch=function(e,t){if(t===void 0){t={}}switch(e){case Method.manifest:return this.manifest();case Method.decode:return this.decode(r(0,"source"),r(1,"format",false));case Method.encode:return this.encode(r(0,"node"),r(1,"dest",false),r(2,"format",false));case Method.query:return this.query(r(0,"node"),r(1,"query"),r(1,"lang",false));case Method.compile:return this.compile(r(0,"node"));case Method.build:return this.build(r(0,"node"));case Method.execute:return this.execute(r(0,"node"),r(1,"session",false),r(2,"claims",false),r(3,"job",false));case Method.begin:return this.begin(r(0,"node"),r(1,"claims",false));case Method.end:return this.end(r(0,"node"),r(1,"claims",false));case Method.pipe:return this.pipe(r(0,"node"),r(1,"calls"));case Method.cancel:return this.cancel(r(0,"job"))}throw new MethodUnknownError(e);function r(e,r,n){if(n===void 0){n=true}var o=t[r];if(o===undefined)o=t[e];if(n&&o===undefined)throw new ParamRequiredError(r);return o}};e.prototype.call=function(e,t){throw new CapabilityError("No capability implemented",e,t)};e.prototype.notify=function(e,t,r,n){throw new InternalError("Method notify should be implemented in derived classes")};e.prototype.notified=function(e,t,r){switch(e){case"debug":case"info":case"warn":case"error":log[e](t);break;default:log.info(t)}};e.prototype.start=function(){return Promise.resolve()};e.prototype.stop=function(){return Promise.resolve()};return e}();var Transport;(function(e){e["direct"]="direct";e["stdio"]="stdio";e["pipe"]="pipe";e["uds"]="uds";e["vsock"]="vsock";e["tcp"]="tcp";e["http"]="http";e["ws"]="ws"})(Transport||(Transport={}));var TcpAddress=function(){function e(e,t){if(t===void 0){t={scheme:"tcp",host:"127.0.0.1",port:7e3}}this.type=Transport.tcp;var r=parseTcpAddress(e,t),n=r.scheme,o=r.host,i=r.port;this.scheme=n;this.host=o;this.port=i}e.prototype.url=function(){return deparseTcpAddress(this)};return e}();var HttpAddress=function(e){__extends(t,e);function t(t,r){if(r===void 0){r={scheme:"http",host:"127.0.0.1",port:80}}var n=e.call(this,t,r)||this;n.type=Transport.http;var o=parseTcpAddress(t,r).path;n.path=o;if(typeof t==="object"){var i=t.protocol,a=t.jwt;n.protocol=i;n.jwt=a}return n}return t}(TcpAddress);var WebSocketAddress=function(e){__extends(t,e);function t(t){var r=e.call(this,t,{scheme:"ws",host:"127.0.0.1",port:80})||this;r.type=Transport.ws;return r}return t}(HttpAddress);function parseTcpAddress(e,t){var r;var n=__assign({path:undefined},t),o=n.scheme,i=n.host,a=n.path;var s;if(typeof e==="string"){var u=/^[0-9]{2,5}$/.exec(e);if(u!==null){s=parseInt(u[0])}else{var c=/(([a-z]{2,5}):\/\/)?([^:/]+)(:(\d+))?(\/(.+))?$/.exec(e);if(c===null)throw new InternalError('Could not parse address "'+e+'"');if(c[2]!==undefined)o=c[2];if(c[3]!==undefined)i=c[3];if(c[5]!==undefined)s=parseInt(c[5]);if(c[7]!==undefined)a=c[7]}}else if(typeof e==="number"){s=e}else{r=__assign({scheme:o,host:i,port:s,path:a},e),o=r.scheme,i=r.host,s=r.port,a=r.path}if(s===undefined){if(o==="http"||o==="ws")s=80;else if(o==="https"||o==="wss")s=443;else s=t.port}return{scheme:o,host:i,port:s,path:a}}function deparseTcpAddress(e){var t=e.scheme,r=e.host,n=e.port,o=e.path;var i=t+"://"+r;if(t==="tcp"||(t==="http"||t==="ws")&&n!==80||(t==="https"||t==="wss")&&n!==443)i+=":"+n;if(t!=="tcp"&&o!==undefined){if(!o.startsWith("/"))i+="/";i+=o}return i}var JsonRpcErrorCode;(function(e){e[e["ParseError"]=-32700]="ParseError";e[e["InvalidRequest"]=-32600]="InvalidRequest";e[e["MethodNotFound"]=-32601]="MethodNotFound";e[e["InvalidParams"]=-32602]="InvalidParams";e[e["InternalError"]=-32603]="InternalError";e[e["ServerError"]=-32e3]="ServerError";e[e["CapabilityError"]=-32005]="CapabilityError"})(JsonRpcErrorCode||(JsonRpcErrorCode={}));var JsonRpcError=function(){function e(e,t,r){this.name="JsonRpcError";this.code=e;this.message=t;this.data=r}e.fromError=function(t){if(t instanceof e){return t}if(t instanceof MethodUnknownError){return new e(JsonRpcErrorCode.MethodNotFound,'Method not found: "'+t.method+'"')}if(t instanceof ParamRequiredError){return new e(JsonRpcErrorCode.InvalidParams,'Invalid params: "'+t.param+'" is missing')}if(t instanceof CapabilityError){return new e(JsonRpcErrorCode.CapabilityError,t.message)}return new e(JsonRpcErrorCode.ServerError,"Internal error: "+t.message,{trace:t.stack})};e.toError=function(e){var t=e.code,r=e.message;switch(t){case JsonRpcErrorCode.CapabilityError:return new CapabilityError(r);default:return e}};return e}();var JsonRpcRequest=function(){function e(e,t,r){this.jsonrpc="2.0";if(r!==undefined&&r!==false){this.id=r}else if(r===undefined){this.id=generate("re").toString()}this.method=e;this.params=t}e.create=function(t){if(typeof t==="string")return e.parse(t);if(t!==null&&typeof t==="object"&&!Array.isArray(t))return e.hydrate(t);throw new JsonRpcError(JsonRpcErrorCode.InvalidRequest,"Invalid request type: "+typeof t)};e.hydrate=function(t){var r=t.method,n=t.params,o=t.id;if(r===undefined)throw new JsonRpcError(JsonRpcErrorCode.InvalidRequest,'Invalid request: missing property: "method"');if(typeof r!=="string")throw new JsonRpcError(JsonRpcErrorCode.InvalidRequest,'Invalid request: incorrect type for "method": '+typeof r);return new e(r,n,o===undefined?false:o)};e.parse=function(t){var r;try{r=JSON.parse(t)}catch(n){throw new JsonRpcError(JsonRpcErrorCode.ParseError,"Parse error: "+n.message)}return e.hydrate(r)};return e}();var log$1=p("executa:client");var Client=function(e){__extends(t,e);function t(t){if(t===void 0){t="cli"}var r=e.call(this,t)||this;r.requests={};r.notifications=[];r.notificationsCount=0;r.notificationsLength=1e3;return r}t.prototype.manifest=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:if(!(this.manifestCached===undefined))return[3,2];e=this;return[4,this.call(Method.manifest)];case 1:e.manifestCached=t.sent();t.label=2;case 2:return[2,this.manifestCached]}}))}))};t.prototype.cancel=function(e){return this.call(Method.cancel,{job:e})};t.prototype.call=function(e,t){if(t===void 0){t={}}return __awaiter(this,void 0,void 0,(function(){var r,n,o;var i=this;return __generator(this,(function(a){switch(a.label){case 0:r=new JsonRpcRequest(e,t);n=r.id;if(n===undefined)throw new InternalError("Request should have id defined");o=new Promise((function(e,t){i.requests[n]={id:n,date:new Date,resolve:e,reject:t}}));return[4,this.send(r)];case 1:a.sent();return[2,o]}}))}))};t.prototype.notify=function(e,t){var r=new JsonRpcRequest(e,{message:t},false);return this.send(r)};t.prototype.notified=function(e,t){var r=this,n=r.notifications,o=r.notificationsLength;this.notificationsCount+=1;n.push({id:this.notificationsCount,date:new Date,subject:e,message:t});if(n.length>o){n.splice(0,n.length-o)}};t.prototype.receive=function(e){if(typeof e==="string"){try{e=JSON.parse(e)}catch(l){log$1.error("Error parsing message as JSON: "+e);return}}var t=e.id;if(t===undefined){var r=e.method,n=e.params,o=n===void 0?[]:n;var i=Object.values(o);return this.notified(r,i[0])}if(t.length===0){log$1.error("Response is missing id: "+JSON.stringify(e));return}var a=this.requests[t];if(a===undefined){log$1.error("No request found for response with id: "+t);return}var s=a.resolve,u=a.reject;var c=e.result,l=e.error;if(!(l===null||l===undefined))u(JsonRpcError.toError(l));else{try{s(c)}catch(l){log$1.error("Unhandled error when resolving result: "+l)}}delete this.requests[t]};t.prototype.stop=function(){for(var t=0,r=Object.values(this.requests);t<r.length;t++){var n=r[t].reject;n(new Error("Client is stopping"))}return e.prototype.stop.call(this)};return t}(Executor);function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}function RetryOperation(e,t){if(typeof t==="boolean"){t={forever:t}}this._originalTimeouts=JSON.parse(JSON.stringify(e));this._timeouts=e;this._options=t||{};this._maxRetryTime=t&&t.maxRetryTime||Infinity;this._fn=null;this._errors=[];this._attempts=1;this._operationTimeout=null;this._operationTimeoutCb=null;this._timeout=null;this._operationStart=null;if(this._options.forever){this._cachedTimeouts=this._timeouts.slice(0)}}var retry_operation=RetryOperation;RetryOperation.prototype.reset=function(){this._attempts=1;this._timeouts=this._originalTimeouts};RetryOperation.prototype.stop=function(){if(this._timeout){clearTimeout(this._timeout)}this._timeouts=[];this._cachedTimeouts=null};RetryOperation.prototype.retry=function(e){if(this._timeout){clearTimeout(this._timeout)}if(!e){return false}var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime){this._errors.unshift(new Error("RetryOperation timeout occurred"));return false}this._errors.push(e);var r=this._timeouts.shift();if(r===undefined){if(this._cachedTimeouts){this._errors.splice(this._errors.length-1,this._errors.length);this._timeouts=this._cachedTimeouts.slice(0);r=this._timeouts.shift()}else{return false}}var n=this;var o=setTimeout((function(){n._attempts++;if(n._operationTimeoutCb){n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout);if(n._options.unref){n._timeout.unref()}}n._fn(n._attempts)}),r);if(this._options.unref){o.unref()}return true};RetryOperation.prototype.attempt=function(e,t){this._fn=e;if(t){if(t.timeout){this._operationTimeout=t.timeout}if(t.cb){this._operationTimeoutCb=t.cb}}var r=this;if(this._operationTimeoutCb){this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)}this._operationStart=(new Date).getTime();this._fn(this._attempts)};RetryOperation.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated");this.attempt(e)};RetryOperation.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated");this.attempt(e)};RetryOperation.prototype.start=RetryOperation.prototype.try;RetryOperation.prototype.errors=function(){return this._errors};RetryOperation.prototype.attempts=function(){return this._attempts};RetryOperation.prototype.mainError=function(){if(this._errors.length===0){return null}var e={};var t=null;var r=0;for(var n=0;n<this._errors.length;n++){var o=this._errors[n];var i=o.message;var a=(e[i]||0)+1;e[i]=a;if(a>=r){t=o;r=a}}return t};var retry=createCommonjsModule((function(e,t){t.operation=function(e){var r=t.timeouts(e);return new retry_operation(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})};t.timeouts=function(e){if(e instanceof Array){return[].concat(e)}var t={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:Infinity,randomize:false};for(var r in e){t[r]=e[r]}if(t.minTimeout>t.maxTimeout){throw new Error("minTimeout is greater than maxTimeout")}var n=[];for(var o=0;o<t.retries;o++){n.push(this.createTimeout(o,t))}if(e&&e.forever&&!n.length){n.push(this.createTimeout(o,t))}n.sort((function(e,t){return e-t}));return n};t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1;var n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));n=Math.min(n,t.maxTimeout);return n};t.wrap=function(e,r,n){if(r instanceof Array){n=r;r=null}if(!n){n=[];for(var o in e){if(typeof e[o]==="function"){n.push(o)}}}for(var i=0;i<n.length;i++){var a=n[i];var s=e[a];e[a]=function n(o){var i=t.operation(r);var a=Array.prototype.slice.call(arguments,1);var s=a.pop();a.push((function(e){if(i.retry(e)){return}if(e){arguments[0]=i.mainError()}s.apply(this,arguments)}));i.attempt((function(){o.apply(e,a)}))}.bind(e,s);e[a].options=r}}}));var retry$1=retry;var AbortError=function(e){__extends(t,e);function t(t){var r;var n=e.call(this)||this;if(t instanceof Error){n.originalError=t;r=t,t=r.message}else{n.originalError=new Error(t);n.originalError.stack=n.stack}n.name="AbortError";n.message=t;return n}return t}(Error);var decorateErrorWithCounts=function(e,t,r){var n=r.retries-(t-1);e.attemptNumber=t;e.retriesLeft=n;return e};var pRetry=function(e,t){return new Promise((function(r,n){t=__assign({onFailedAttempt:function(){},retries:10},t);var o=retry$1.operation(t);o.attempt((function(i){return __awaiter(void 0,void 0,void 0,(function(){var a,s,u;return __generator(this,(function(c){switch(c.label){case 0:c.trys.push([0,2,,10]);a=r;return[4,e(i)];case 1:a.apply(void 0,[c.sent()]);return[3,10];case 2:s=c.sent();if(!(s instanceof Error)){n(new TypeError('Non-error was thrown: "'+s+'". You should only throw errors.'));return[2]}if(!(s instanceof AbortError))return[3,3];o.stop();n(s.originalError);return[3,9];case 3:if(!(s instanceof TypeError))return[3,4];o.stop();n(s);return[3,9];case 4:decorateErrorWithCounts(s,i,t);c.label=5;case 5:c.trys.push([5,7,,8]);return[4,t.onFailedAttempt(s)];case 6:c.sent();return[3,8];case 7:u=c.sent();n(u);return[2];case 8:if(!o.retry(s)){n(o.mainError())}c.label=9;case 9:return[3,10];case 10:return[2]}}))}))}))}))};var pRetry_1=pRetry;var default_1=pRetry;var AbortError_1=AbortError;pRetry_1.default=default_1;pRetry_1.AbortError=AbortError_1;function generateProtocol(e,t){return"executa.stenci.la+1+"+e+(t!==undefined?"+"+t:"")}function isOpen(e){return e.readyState===browser.OPEN}function isClosingOrClosed(e){return e.readyState===browser.CLOSING||e.readyState===browser.CLOSED}function untilOpen(e,t){if(t===void 0){t=60}if(isClosingOrClosed(e))throw new Error("WebSocket is closing or closed");if(e.readyState!==browser.OPEN){return new Promise((function(r,n){var o=false;e.onopen=function(){o=true;r()};setTimeout((function(){if(!o)n(new Error("WebSocket timeout"))}),t*1e3)}))}return Promise.resolve()}function send(e,t,r){if(r===void 0){r=60}return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,untilOpen(e,r)];case 1:n.sent();e.send(t);return[2,Promise.resolve()]}}))}))}var log$3=p("executa:ws:client");var defaultWebSocketClientOptions={logging:true,timeout:60,retries:10};var WebSocketClient=function(e){__extends(t,e);function t(t,r){if(t===void 0){t=new WebSocketAddress}if(r===void 0){r=defaultWebSocketClientOptions}var n=e.call(this,"ws")||this;n.isStopped=false;n.retryConnect=function(e,t){if(n.isRetrying===true){return Promise.resolve()}if(n.options.logging){log$3.info("Connection closed, trying to reconnect")}n.isRetrying=true;return pRetry_1((function(){return n.start()}),{retries:n.options.retries,randomize:true,maxTimeout:5e3,onFailedAttempt:function(e){if(n.options.logging){log$3.info("Connection attempt "+e.attemptNumber+" failed. "+e.retriesLeft+" retries left.")}}}).then(e).catch((function(){t(new Error("Failed to reconnect after "+n.options.retries+" attempt(s)"))})).finally((function(){n.isRetrying=false}))};n.address=new WebSocketAddress(t);n.options=__assign(__assign({},defaultWebSocketClientOptions),r);return n}t.prototype.start=function(){var e=this;var t=this,r=t.id,n=t.address,o=t.options,i=o.retries,a=o.logging;return new Promise((function(t,o){e.socket=new browser(n.url(),generateProtocol(r,n.jwt));e.socket.onopen=function(){e.isStopped=false;t()};e.socket.onmessage=function(t){return e.receive(t.data.toString())};e.socket.onclose=function(r){if(e.isStopped)return t();var n=r.code,s=r.reason;if(n===4001){var u="Failed to authenticate with server: "+s;if(a){log$3.error(u)}o(new Error(u))}if(i>0&&e.isRetrying===undefined){return e.retryConnect(t,o)}else if(e.isRetrying===true){return undefined}else{o(new Error("Connection closed."))}};e.socket.onerror=function(r){if(a)log$3.error(r.message);if(i>0&&e.isRetrying===undefined){return e.retryConnect(t,o)}else{o(new Error(r.message))}}}))};t.prototype.send=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n;return __generator(this,(function(o){switch(o.label){case 0:t=this,r=t.socket,n=t.options.timeout;if(!(r===undefined))return[3,2];return[4,this.start()];case 1:o.sent();return[2,this.send(e)];case 2:return[2,send(r,JSON.stringify(e),n)]}}))}))};t.prototype.receive=function(t){var r=this,n=r.socket,o=r.options.logging;if(n===undefined)return;if(isOpen(n))e.prototype.receive.call(this,t);else if(o)log$3.warn("Message received while socket was closing: "+t)};t.prototype.stop=function(){this.isStopped=true;if(this.socket!==undefined)this.socket.close();return Promise.resolve()};t.discover=function(){log$3.warn("Discovery not available for WebSocket client");return Promise.resolve([])};return t}(Client);var isOutOfBound$1=function(e,t){return e<0||e>=t.length};var isEmpty$1=function(e){return e.length===0};var isOutOfBound=isOutOfBound$1;function lookup$1(e,t){return t===undefined?function(t){return lookup$1(e,t)}:isOutOfBound(e,t)?none:some(t[e])}var isEmpty=isEmpty$1;var lookup=lookup$1;var pluralize=createCommonjsModule$1((function(e,t){(function(t,r){if(typeof commonjsRequire==="function"&&"object"==="object"&&"object"==="object"){e.exports=r()}else{t.pluralize=r()}})(commonjsGlobal,(function(){var e=[];var t=[];var r={};var n={};var o={};function i(e){if(typeof e==="string"){return new RegExp("^"+e+"$","i")}return e}function a(e,t){if(e===t)return t;if(e===e.toLowerCase())return t.toLowerCase();if(e===e.toUpperCase())return t.toUpperCase();if(e[0]===e[0].toUpperCase()){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}return t.toLowerCase()}function s(e,t){return e.replace(/\$(\d{1,2})/g,(function(e,r){return t[r]||""}))}function u(e,t){return e.replace(t[0],(function(r,n){var o=s(t[1],arguments);if(r===""){return a(e[n-1],o)}return a(r,o)}))}function c(e,t,n){if(!e.length||r.hasOwnProperty(e)){return t}var o=n.length;while(o--){var i=n[o];if(i[0].test(t))return u(t,i)}return t}function l(e,t,r){return function(n){var o=n.toLowerCase();if(t.hasOwnProperty(o)){return a(n,o)}if(e.hasOwnProperty(o)){return a(n,e[o])}return c(o,n,r)}}function f(e,t,r,n){return function(n){var o=n.toLowerCase();if(t.hasOwnProperty(o))return true;if(e.hasOwnProperty(o))return false;return c(o,o,r)===o}}function p(e,t,r){var n=t===1?p.singular(e):p.plural(e);return(r?t+" ":"")+n}p.plural=l(o,n,e);p.isPlural=f(o,n,e);p.singular=l(n,o,t);p.isSingular=f(n,o,t);p.addPluralRule=function(t,r){e.push([i(t),r])};p.addSingularRule=function(e,r){t.push([i(e),r])};p.addUncountableRule=function(e){if(typeof e==="string"){r[e.toLowerCase()]=true;return}p.addPluralRule(e,"$0");p.addSingularRule(e,"$0")};p.addIrregularRule=function(e,t){t=t.toLowerCase();e=e.toLowerCase();o[e]=t;n[t]=e};[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach((function(e){return p.addIrregularRule(e[0],e[1])}));[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach((function(e){return p.addPluralRule(e[0],e[1])}));[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach((function(e){return p.addSingularRule(e[0],e[1])}));["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","species","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[eé]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(p.addUncountableRule);return p}))}));var __assign$1=undefined&&undefined.__assign||function(){__assign$1=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return __assign$1.apply(this,arguments)};var __spreadArray$2=undefined&&undefined.__spreadArray||function(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e};var mix=function(e,t,r){if(r===void 0){r=false}if(!e||!t||typeof e!=="object"||typeof t!=="object")return e;var n=__assign$1({},e);for(var o in t){if(t.hasOwnProperty(o)){if(t[o]instanceof Array&&e[o]instanceof Array){n[o]=r?__spreadArray$2(__spreadArray$2([],e[o]),t[o]):t[o]}else if(typeof t[o]==="object"&&typeof e[o]==="object"){n[o]=mix(e[o],t[o],r)}else{n[o]=t[o]}}}return n};var __spreadArray$1=undefined&&undefined.__spreadArray||function(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e};var config={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill:function(e,t){var r=t===void 0?{}:t,n=r.doThrow,o=n===void 0?true:n,i=r.instance,a=i===void 0?false:i;var s=[];for(var u=2;u<arguments.length;u++){s[u-2]=arguments[u]}var c=this.polyfills[e]||(typeof self!=="undefined"?self[e]:null)||(typeof global!=="undefined"?global[e]:null);if(o&&!c)throw new Error(e+" is not defined");return a&&c?new(c.bind.apply(c,__spreadArray$1([void 0],s))):c}};var onMatch=function(e,t,r,n){if(!e.getEntriesByName)return false;var o=e.getEntriesByName(t);if(o&&o.length>0){r(o.reverse()[0]);if(n.clearMeasures)n.clearMeasures(t);perfs.callbacks.delete(t);if(perfs.callbacks.size<1){perfs.observer.disconnect();if(n.clearResourceTimings){n.clearResourceTimings()}}return true}return false};var lazyObserver=function(e,t){if(!perfs.observer&&e&&t){perfs.observer=new t((function(t){perfs.callbacks.forEach((function(r,n){onMatch(t,n,r,e)}))}));if(e.clearResourceTimings)e.clearResourceTimings()}return perfs.observer};var perfs={callbacks:new Map,observer:null,observe:function(e,t){if(!e||!t)return;var r=config.polyfill("performance",{doThrow:false});var n=config.polyfill("PerformanceObserver",{doThrow:false});if(!lazyObserver(r,n))return;if(!onMatch(r,e,t,r)){if(perfs.callbacks.size<1)perfs.observer.observe({entryTypes:["resource","measure"]});perfs.callbacks.set(e,t)}}};var middlewareHelper=function(e){return function(t){return e.length===0?t:e.length===1?e[0](t):e.reduceRight((function(r,n,o){return o===e.length-2?n(r(t)):n(r)}))}};var WretchErrorWrapper=function(){function e(e){this.error=e}return e}();var resolver=function(e){var t=e._url,r=e._catchers,n=e._resolvers,o=e._middlewares,i=e._options;var a=new Map(r);var s=mix(config.defaults,i);var u=config.polyfill("AbortController",{doThrow:false,instance:true});if(!s["signal"]&&u){s["signal"]=u.signal}var c={ref:null,clear:function(){if(c.ref){clearTimeout(c.ref);c.ref=null}}};var l=middlewareHelper(o)(config.polyfill("fetch"))(t,s);var f=l.catch((function(e){throw new WretchErrorWrapper(e)})).then((function(e){c.clear();if(!e.ok){return e[config.errorType||"text"]().then((function(t){var r=new Error(t);r[config.errorType||"text"]=t;r["status"]=e.status;r["response"]=e;throw r}))}return e}));var p=function(t){return t.catch((function(t){c.clear();var r=t instanceof WretchErrorWrapper?t.error:t;if(t instanceof WretchErrorWrapper&&a.has("__fromFetch"))return a.get("__fromFetch")(r,e);else if(a.has(r.status))return a.get(r.status)(r,e);else if(a.has(r.name))return a.get(r.name)(r,e);else throw r}))};var d=function(e){return function(t){return e?p(f.then((function(t){return t&&t[e]()})).then((function(e){return t?t(e):e}))):p(f.then((function(e){return t?t(e):e})))}};var h={res:d(null),json:d("json"),blob:d("blob"),formData:d("formData"),arrayBuffer:d("arrayBuffer"),text:d("text"),perfs:function(e){l.then((function(t){return perfs.observe(t.url,e)}));return h},setTimeout:function(e,t){if(t===void 0){t=u}c.clear();c.ref=setTimeout((function(){return t.abort()}),e);return h},controller:function(){return[u,h]},error:function(e,t){a.set(e,t);return h},badRequest:function(e){return h.error(400,e)},unauthorized:function(e){return h.error(401,e)},forbidden:function(e){return h.error(403,e)},notFound:function(e){return h.error(404,e)},timeout:function(e){return h.error(408,e)},internalError:function(e){return h.error(500,e)},fetchError:function(e){return h.error("__fromFetch",e)},onAbort:function(e){return h.error("AbortError",e)}};return n.reduce((function(t,r){return r(t,e)}),h)};var __assign=undefined&&undefined.__assign||function(){__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return __assign.apply(this,arguments)};var __spreadArray=undefined&&undefined.__spreadArray||function(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e};var JSON_MIME="application/json";var CONTENT_TYPE_HEADER="Content-Type";var Wretcher=function(){function e(e,t,r,n,o,i){if(r===void 0){r=new Map}if(n===void 0){n=[]}if(o===void 0){o=[]}if(i===void 0){i=[]}this._url=e;this._options=t;this._catchers=r;this._resolvers=n;this._middlewares=o;this._deferredChain=i}e.factory=function(t,r){if(t===void 0){t=""}if(r===void 0){r={}}return new e(t,r)};e.prototype.selfFactory=function(t){var r=t===void 0?{}:t,n=r.url,o=n===void 0?this._url:n,i=r.options,a=i===void 0?this._options:i,s=r.catchers,u=s===void 0?this._catchers:s,c=r.resolvers,l=c===void 0?this._resolvers:c,f=r.middlewares,p=f===void 0?this._middlewares:f,d=r.deferredChain,h=d===void 0?this._deferredChain:d;return new e(o,__assign({},a),new Map(u),__spreadArray([],l),__spreadArray([],p),__spreadArray([],h))};e.prototype.defaults=function(e,t){if(t===void 0){t=false}config.defaults=t?mix(config.defaults,e):e;return this};e.prototype.errorType=function(e){config.errorType=e;return this};e.prototype.polyfills=function(e){config.polyfills=__assign(__assign({},config.polyfills),e);return this};e.prototype.url=function(e,t){if(t===void 0){t=false}if(t)return this.selfFactory({url:e});var r=this._url.split("?");return this.selfFactory({url:r.length>1?r[0]+e+"?"+r[1]:this._url+e})};e.prototype.options=function(e,t){if(t===void 0){t=true}return this.selfFactory({options:t?mix(this._options,e):e})};e.prototype.query=function(e,t){if(t===void 0){t=false}return this.selfFactory({url:appendQueryParams(this._url,e,t)})};e.prototype.headers=function(e){return this.selfFactory({options:mix(this._options,{headers:e||{}})})};e.prototype.accept=function(e){return this.headers({Accept:e})};e.prototype.content=function(e){var t;return this.headers((t={},t[CONTENT_TYPE_HEADER]=e,t))};e.prototype.auth=function(e){return this.headers({Authorization:e})};e.prototype.catcher=function(e,t){var r=new Map(this._catchers);r.set(e,t);return this.selfFactory({catchers:r})};e.prototype.signal=function(e){return this.selfFactory({options:__assign(__assign({},this._options),{signal:e.signal})})};e.prototype.resolve=function(e,t){if(t===void 0){t=false}return this.selfFactory({resolvers:t?[e]:__spreadArray(__spreadArray([],this._resolvers),[e])})};e.prototype.defer=function(e,t){if(t===void 0){t=false}return this.selfFactory({deferredChain:t?[e]:__spreadArray(__spreadArray([],this._deferredChain),[e])})};e.prototype.middlewares=function(e,t){if(t===void 0){t=false}return this.selfFactory({middlewares:t?e:__spreadArray(__spreadArray([],this._middlewares),e)})};e.prototype.method=function(e,t,r){if(t===void 0){t={}}if(r===void 0){r=null}var n=this.options(__assign(__assign({},t),{method:e}));var o=n._options.headers;n=!r?n:typeof r==="object"&&(!o||Object.entries(o).every((function(e){var t=e[0],r=e[1];return t.toLowerCase()!==CONTENT_TYPE_HEADER.toLowerCase()||r.startsWith(JSON_MIME)})))?n.json(r):n.body(r);return resolver(n._deferredChain.reduce((function(e,t){return t(e,e._url,e._options)}),n))};e.prototype.get=function(e){return this.method("GET",e)};e.prototype.delete=function(e){return this.method("DELETE",e)};e.prototype.put=function(e,t){return this.method("PUT",t,e)};e.prototype.post=function(e,t){return this.method("POST",t,e)};e.prototype.patch=function(e,t){return this.method("PATCH",t,e)};e.prototype.head=function(e){return this.method("HEAD",e)};e.prototype.opts=function(e){return this.method("OPTIONS",e)};e.prototype.replay=function(e){return this.method(this._options.method,e)};e.prototype.body=function(e){return this.selfFactory({options:__assign(__assign({},this._options),{body:e})})};e.prototype.json=function(e){var t;var r=(t=Object.entries(this._options.headers||{}).find((function(e){var t=e[0],r=e[1];return t.toLowerCase()===CONTENT_TYPE_HEADER.toLowerCase()&&r.startsWith(JSON_MIME)})))===null||t===void 0?void 0:t[1];return this.content(r||JSON_MIME).body(JSON.stringify(e))};e.prototype.formData=function(e,t){if(t===void 0){t=false}return this.body(convertFormData(e,t))};e.prototype.formUrl=function(e){return this.body(typeof e==="string"?e:convertFormUrl(e)).content("application/x-www-form-urlencoded")};return e}();var appendQueryParams=function(e,t,r){var n;if(typeof t==="string"){n=t}else{var o=config.polyfill("URLSearchParams",{instance:true});for(var i in t){if(t[i]instanceof Array){for(var a=0,s=t[i];a<s.length;a++){var u=s[a];o.append(i,u)}}else{o.append(i,t[i])}}n=o.toString()}var c=e.split("?");if(r||c.length<2)return c[0]+"?"+n;return e+"&"+n};function convertFormData(e,t,r,n){if(t===void 0){t=false}if(r===void 0){r=config.polyfill("FormData",{instance:true})}if(n===void 0){n=[]}Object.entries(e).forEach((function(e){var o=e[0],i=e[1];var a=n.reduce((function(e,t){return e?e+"["+t+"]":t}),null);a=a?a+"["+o+"]":o;if(i instanceof Array){for(var s=0,u=i;s<u.length;s++){var c=u[s];r.append(a+"[]",c)}}else if(t&&typeof i==="object"&&(!(t instanceof Array)||!t.includes(o))){if(i!==null){convertFormData(i,t,r,__spreadArray(__spreadArray([],n),[o]))}}else{r.append(a,i)}}));return r}function encodeQueryValue(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(typeof t==="object"?JSON.stringify(t):""+t)}function convertFormUrl(e){return Object.keys(e).map((function(t){var r=e[t];if(r instanceof Array){return r.map((function(e){return encodeQueryValue(t,e)})).join("&")}return encodeQueryValue(t,r)})).join("&")}var factory=Wretcher.factory;factory["default"]=Wretcher.factory;var JobStatus;(function(e){e["WAITING"]="WAITING";e["DISPATCHED"]="DISPATCHED";e["PENDING"]="PENDING";e["RECEIVED"]="RECEIVED";e["STARTED"]="STARTED";e["SUCCESS"]="SUCCESS";e["FAILURE"]="FAILURE";e["CANCELLED"]="CANCELLED";e["REVOKED"]="REVOKED";e["TERMINATED"]="TERMINATED";e["RUNNING"]="RUNNING"})(JobStatus||(JobStatus={}));var jobLogic={keepChecking:[JobStatus.WAITING,JobStatus.DISPATCHED,JobStatus.PENDING,JobStatus.RECEIVED,JobStatus.STARTED],stopChecking:[JobStatus.SUCCESS,JobStatus.FAILURE,JobStatus.CANCELLED,JobStatus.REVOKED,JobStatus.TERMINATED],readyToExecute:[JobStatus.RUNNING]};var isErrorGuard=function(e){return!(e instanceof Error)};var executableJobGuard=function(e){return e.url!==null&&jobLogic.readyToExecute.includes(e.status)};var failedJobGuard=function(e){return jobLogic.stopChecking.includes(e.status)};var jobToDatum=function(e){if(jobLogic.stopChecking.includes(e.status)){return failure(e)}else if(jobLogic.readyToExecute.includes(e.status)){return executableJobGuard(e)?success(e):failure(e)}return toReplete(failedJobGuard(e)?failure(e):success(e))};var jobFetch=factory().options({credentials:"include"});var fetchJob=function(e){return jobFetch.url(e).get().json((function(e){return e}))};var fetchJobDatum=function(e){return e===undefined?Promise.resolve(failure(new Error("No Job Url to connect to"))):_function.pipe(e,(function(e){return __awaiter(void 0,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,fetchJob(e)];case 1:t=r.sent();return[2,jobToDatum(t)]}}))}))}))};var jobErrorMessage=function(e){return isErrorGuard(e)?e.statusMessage:"An unexpected error occurred"};var jobStatusString=function(e){return _function.pipe(e,fold((function(){return"Requesting session"}),(function(){return"Requesting session"}),jobErrorMessage,(function(e){return e.statusMessage}),jobErrorMessage,(function(e){return e.statusMessage})))};var SessionStatus=function(e,t){var r=e.session,n=e.job;return h("span",{class:{executableDocumentStatus:true,danger:isFailure(r),success:isSuccess(r)}},_function.pipe(r,fold((function(){return""}),(function(){return h("span",null,h("stencila-icon",{icon:"loader-2"}),h("span",null,jobStatusString(n)))}),(function(e){return h("span",null,h("stencila-icon",{icon:"loader-2"}),h("span",null,jobErrorMessage(e)))}),(function(e){return h("span",null,isEmpty(t)?[h("stencila-icon",{icon:"loader-2"}),e.status]:h("span",null,t))}),(function(e){return h("span",null,h("stencila-icon",{icon:"error-warning"}),h("span",null,jobErrorMessage(e)))}),(function(){return h("stencila-tooltip",{text:"Compute session is active"},h("stencila-icon",{icon:"pulse"}),isEmpty(t)?null:h("span",null,t))}))))};var defaultExecutableDocumentToolbarCss=":host,stencila-executable-document-toolbar{--background:var(--color-neutral-100)}:host,stencila-executable-document-toolbar{display:block}:host([position=fixed]),stencila-executable-document-toolbar[position=fixed]{left:0;max-width:none!important;position:fixed;top:0;width:100%;z-index:1}:host([position=fixed])+*,stencila-executable-document-toolbar[position=fixed]+*{margin-top:3rem}:host .hidden-sm,stencila-executable-document-toolbar .hidden-sm{display:none}@media (min-width:640px){:host .hidden-sm,stencila-executable-document-toolbar .hidden-sm{display:inline}}:host .executableDocumentStatus,stencila-executable-document-toolbar .executableDocumentStatus{color:#4a4a4a;color:var(--color-key,#4a4a4a);font-size:.875rem;line-height:1.25rem;line-height:1}:host .executableDocumentStatus.success,stencila-executable-document-toolbar .executableDocumentStatus.success{color:#1b5430;color:var(--color-success-700,#1b5430)}:host .executableDocumentStatus.danger,stencila-executable-document-toolbar .executableDocumentStatus.danger{color:#cf445e;color:var(--color-danger-500,#cf445e)}:host .executableDocumentStatus stencila-icon,stencila-executable-document-toolbar .executableDocumentStatus stencila-icon{margin-right:.25rem}:host .executableDocumentStatus stencila-tooltip,stencila-executable-document-toolbar .executableDocumentStatus stencila-tooltip{cursor:help}:host .executableDocumentStatus span,stencila-executable-document-toolbar .executableDocumentStatus span{vertical-align:middle}";var materialExecutableDocumentToolbarCss=":host,stencila-executable-document-toolbar{--background:var(--color-neutral-100)}:host,stencila-executable-document-toolbar{display:block}:host([position=fixed]),stencila-executable-document-toolbar[position=fixed]{left:0;max-width:none!important;position:fixed;top:0;width:100%;z-index:1}:host([position=fixed])+*,stencila-executable-document-toolbar[position=fixed]+*{margin-top:3rem}:host .hidden-sm,stencila-executable-document-toolbar .hidden-sm{display:none}@media (min-width:640px){:host .hidden-sm,stencila-executable-document-toolbar .hidden-sm{display:inline}}:host .executableDocumentStatus,stencila-executable-document-toolbar .executableDocumentStatus{color:#4a4a4a;color:var(--color-key,#4a4a4a);font-size:.875rem;line-height:1.25rem;line-height:1}:host .executableDocumentStatus.success,stencila-executable-document-toolbar .executableDocumentStatus.success{color:#1b5430;color:var(--color-success-700,#1b5430)}:host .executableDocumentStatus.danger,stencila-executable-document-toolbar .executableDocumentStatus.danger{color:#cf445e;color:var(--color-danger-500,#cf445e)}:host .executableDocumentStatus stencila-icon,stencila-executable-document-toolbar .executableDocumentStatus stencila-icon{margin-right:.25rem}:host .executableDocumentStatus stencila-tooltip,stencila-executable-document-toolbar .executableDocumentStatus stencila-tooltip{cursor:help}:host .executableDocumentStatus span,stencila-executable-document-toolbar .executableDocumentStatus span{vertical-align:middle}";var notify=toastController({position:ToastPositions.topCenter});var errorNotification=function(){return notify.present("Couldn’t start a compute session",{type:ToastTypes.danger})};var StencilaExecutableDocumentToolbar=function(){function e(e){var t=this;registerInstance(this,e);this.jobPoller=undefined;this.jobPollFrequency=3e3;this.requestController=new AbortController;this.requestSignal=this.requestController.signal;this.initAbortControllers=function(){t.requestController=new AbortController;t.requestSignal=t.requestController.signal};this.position="fixed";this.session=initial;this.job=initial;this.executor=null;this.codeCount=0;this.statusMessage="";this.checkJobStatus=function(){return __awaiter(t,void 0,void 0,(function(){return __generator(this,(function(e){if(isRefresh(this.job)){return[2,this.job]}else{this.job=toRefresh(this.job);return[2,fetchJobDatum(this.jobUrl)]}return[2]}))}))};this.handleJobStatus=function(e,r,n){return _function.pipe(e,fold((function(){t.jobPoller=t.pollJobFn(t.jobPollFrequency,r,n);return pending}),(function(){return e}),(function(){return e}),(function(){return e}),(function(r){var n;window.clearInterval(t.jobPoller);t.requestController.abort();(n=t.executor)===null||n===void 0?void 0:n.stop().catch((function(e){console.warn("Failed to stop Executa",e)}));t.session=failure(r);return e}),(function(n){if(executableJobGuard(n)){window.clearInterval(t.jobPoller);t.jobPoller=t.pollJobFn(1e4);if(r){r(t.startExecutor(n.url))}}return e})),(function(e){t.job=e;return e}))};this.pollJob=function(e,r){return t.checkJobStatus().then((function(n){return t.handleJobStatus(n,e,r)})).catch((function(e){return t.handleJobStatus(failure(e))}))};this.pollJobFn=function(e,r,n){if(e===void 0){e=t.jobPollFrequency}return window.setInterval((function(){t.pollJob(r,n).catch((function(e){return failure(e)}))}),e)};this.findSession=function(){return __awaiter(t,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){if(this.sessionProviderUrl===undefined){return[2,failure(new Error("Please set a SessionProviderUrl"))]}if(isInitial(this.session)||isFailure(this.session)){this.session=pending;return[2,jobFetch.url(this.sessionProviderUrl).post().res((function(t){e.jobUrl=t.url})).then((function(){return new Promise((function(t,r){return e.handleJobStatus(initial,t,r)}))})).catch((function(t){errorNotification();e.session=failure(t);throw t}))]}return[2,Promise.resolve(this.session)]}))}))};this.startExecutor=function(e){return __awaiter(t,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:t=new WebSocketClient(e);this.executor=t;r=this;return[4,t.begin(Ce()).then((function(e){notify.present("Ready to run document",{type:ToastTypes.success});return success(e)})).catch((function(e){errorNotification();return failure(new Error(e))}))];case 1:r.session=n.sent();return[2,this.session]}}))}))};this.codeNodeSelector=function(){return __spreadArray([],Array.from(document.querySelectorAll("stencila-code-chunk, stencila-code-expression")))};this.executeHandler=function(e){return __awaiter(t,void 0,void 0,(function(){var t;var r=this;return __generator(this,(function(n){if(isPending(this.session)){notify.present("Please wait until a compute session is found",{type:ToastTypes.warn});return[2,e]}t=function(t){var r;return Object.assign(Object.assign({},e),{errors:__spreadArray(__spreadArray([],(r=e.errors)!==null&&r!==void 0?r:[]),[l({errorType:"error",errorMessage:"Could not run "+(e.type==="CodeChunk"?"code chunk":"code expression"),stackTrace:t})])})};return[2,this.findSession().then((function(){if(r.executor&&isSuccess(r.session)){return r.executor.execute(e,r.session.value.right).catch((function(e){console.error(e);return t(e)}))}return t("Couldn’t start a compute session")})).catch((function(e){return t(e)}))]}))}))};this.runAll=function(e){return __awaiter(t,void 0,void 0,(function(){var t=this;return __generator(this,(function(r){e.preventDefault();this.initAbortControllers();return[2,new Promise((function(e,r){t.requestSignal.addEventListener("abort",r);t.findSession().then((function(){return __awaiter(t,void 0,void 0,(function(){var t,n,o,i,a,s;return __generator(this,(function(u){switch(u.label){case 0:t=[];n=0;this.session=toRefresh(this.session);o=0,i=this.codeNodeSelector();u.label=1;case 1:if(!(o<i.length))return[3,4];a=i[o];this.activeNodeIndex=n;this.statusMessage=++n+" of "+this.codeCount+" code "+pluralize("node",this.codeCount);return[4,a.execute()];case 2:s=u.sent();t.push(s);if(n>=this.codeCount){this.statusMessage=""}u.label=3;case 3:o++;return[3,1];case 4:this.session=toReplete(this.session);this.requestSignal.removeEventListener("abort",r);return[2,e(t)]}}))}))})).catch((function(e){t.requestSignal.removeEventListener("abort",r);r(e)}))}))]}))}))};this.goToActiveNode=function(){var e;_function.pipe(t.codeNodeSelector(),lookup((e=t.activeNodeIndex)!==null&&e!==void 0?e:-1),map$1((function(e){var t;var r=document.querySelector("stencila-executable-document-toolbar");var n=(t=r===null||r===void 0?void 0:r.getBoundingClientRect().height)!==null&&t!==void 0?t:0;var o=e.getBoundingClientRect().top-n+window.pageYOffset;window.scrollTo({top:o,behavior:"smooth"})})))};this.executionProgress=function(){return h("stencila-tooltip",{text:"Jump to location",onClick:t.goToActiveNode},h("stencila-icon",{icon:"focus-3"}),h("span",null,t.statusMessage))}}e.prototype.componentWillLoad=function(){var e=this;var t=this.codeNodeSelector();this.codeCount=t.length;t.map((function(t){t.executeHandler=e.executeHandler}))};e.prototype.render=function(){return h(Host,{position:this.position},h("stencila-toolbar",null,h("span",{slot:"start"},h("stencila-button",{color:"stock",icon:"play",size:"small",onClick:this.runAll,disabled:this.codeCount<=0,tooltip:this.codeCount<=0?"No code nodes in the document to execute":undefined,isLoading:isPending(this.session)||isRefresh(this.session),dataEl:"Toolbar/Run Document"},isPending(this.session)||isRefresh(this.session)?"Running":["Run",h("span",{class:"hidden-sm"}," Document")])),h("span",{slot:"middle"},h(SessionStatus,{job:this.job,session:this.session},isRefresh(this.session)&&this.executionProgress())),this.sourceUrl!==undefined&&h("span",{slot:"end"},h("stencila-button",{color:"stock",href:this.sourceUrl,target:"_blank",rel:"nofollow noopener",icon:"external-link",size:"small",dataEl:"Toolbar/Project Source"},"Source"))))};return e}();StencilaExecutableDocumentToolbar.style={default:defaultExecutableDocumentToolbarCss,material:materialExecutableDocumentToolbarCss};export{StencilaExecutableDocumentToolbar as stencila_executable_document_toolbar};